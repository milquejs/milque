!function(){"use strict";var e=1e-6,t="undefined"!=typeof Float32Array?Float32Array:Array;function r(){var e=new t(16);return t!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function n(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],u=t[6],l=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],b=t[14],A=t[15],y=r*o-n*a,_=r*u-s*a,N=r*l-i*a,T=n*u-s*o,E=n*l-i*o,g=s*l-i*u,v=c*m-d*f,S=c*b-h*f,x=c*A-p*f,R=d*b-h*m,w=d*A-p*m,M=h*A-p*b,L=y*M-_*w+N*R+T*x-E*S+g*v;return L?(L=1/L,e[0]=(o*M-u*w+l*R)*L,e[1]=(s*w-n*M-i*R)*L,e[2]=(m*g-b*E+A*T)*L,e[3]=(h*E-d*g-p*T)*L,e[4]=(u*x-a*M-l*S)*L,e[5]=(r*M-s*x+i*S)*L,e[6]=(b*N-f*g-A*_)*L,e[7]=(c*g-h*N+p*_)*L,e[8]=(a*w-o*x+l*v)*L,e[9]=(n*x-r*w-i*v)*L,e[10]=(f*E-m*N+A*y)*L,e[11]=(d*N-c*E-p*y)*L,e[12]=(o*S-a*R-u*v)*L,e[13]=(r*R-n*S+s*v)*L,e[14]=(m*_-f*T-b*y)*L,e[15]=(c*T-d*_+h*y)*L,e):null}function s(){var e=new t(3);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e,r,n){var s=new t(3);return s[0]=e,s[1]=r,s[2]=n,s}function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function o(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function u(e,t){var r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function l(e,t,r){var n=t[0],s=t[1],i=t[2],a=r[0],o=r[1],u=r[2];return e[0]=s*u-i*o,e[1]=i*a-n*u,e[2]=n*o-s*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var c,d=function(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)};c=s();function h(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3];return e[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*a,e[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*a,e[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*a,e[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*a,e}!function(){var e,r=(e=new t(4),t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();function p(){var e=new t(4);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function f(t,r,n,s){var i,a,o,u,l,c=r[0],d=r[1],h=r[2],p=r[3],f=n[0],m=n[1],b=n[2],A=n[3];return(a=c*f+d*m+h*b+p*A)<0&&(a=-a,f=-f,m=-m,b=-b,A=-A),1-a>e?(i=Math.acos(a),o=Math.sin(i),u=Math.sin((1-s)*i)/o,l=Math.sin(s*i)/o):(u=1-s,l=s),t[0]=u*c+l*f,t[1]=u*d+l*m,t[2]=u*h+l*b,t[3]=u*p+l*A,t}var m,b,A,y,_,N,T,E=function(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=s*a,e[3]=i*a,e};m=s(),b=i(1,0,0),A=i(0,1,0),y=p(),_=p(),N=new t(9),t!=Float32Array&&(N[1]=0,N[2]=0,N[3]=0,N[5]=0,N[6]=0,N[7]=0),N[0]=1,N[4]=1,N[8]=1,T=N;let g=null;function v(e,t){return g||(g=function(e){let t={};if(!(e instanceof WebGLRenderingContext))throw new Error("Unknown gl context provided.");t[e.FLOAT]={TypedArray:Float32Array,size:4,uniform:e.uniform1f,arrayUniform:e.uniform1fv},t[e.FLOAT_VEC2]={TypedArray:Float32Array,size:8,uniform:e.uniform2fv,arrayType:e.FLOAT},t[e.FLOAT_VEC3]={TypedArray:Float32Array,size:12,uniform:e.uniform3fv,arrayType:e.FLOAT},t[e.FLOAT_VEC4]={TypedArray:Float32Array,size:16,uniform:e.uniform4fv,arrayType:e.FLOAT},t[e.INT]={TypedArray:Int32Array,size:4,uniform:e.uniform1i,arrayUniform:e.uniform1iv},t[e.INT_VEC2]={TypedArray:Int32Array,size:8,uniform:e.uniform2iv,arrayType:e.INT},t[e.INT_VEC3]={TypedArray:Int32Array,size:12,uniform:e.uniform3iv,arrayType:e.INT},t[e.INT_VEC4]={TypedArray:Int32Array,size:16,uniform:e.uniform4iv,arrayType:e.INT},t[e.UNSIGNED_INT]={TypedArray:Uint32Array,size:4,uniform:e.uniform1ui,arrayUniform:e.uniform1uiv},t[e.UNSIGNED_INT_VEC2]={TypedArray:Uint32Array,size:8,uniform:e.uniform2uiv,arrayType:e.UNSIGNED_INT},t[e.UNSIGNED_INT_VEC3]={TypedArray:Uint32Array,size:12,uniform:e.uniform3uiv,arrayType:e.UNSIGNED_INT},t[e.UNSIGNED_INT_VEC4]={TypedArray:Uint32Array,size:16,uniform:e.uniform4uiv,arrayType:e.UNSIGNED_INT},t[e.BOOL]={TypedArray:Uint32Array,size:4,uniform:e.uniform1i,arrayUniform:e.uniform1iv},t[e.BOOL_VEC2]={TypedArray:Uint32Array,size:8,uniform:e.uniform2iv,arrayType:e.BOOL},t[e.BOOL_VEC3]={TypedArray:Uint32Array,size:12,uniform:e.uniform3iv,arrayType:e.BOOL},t[e.BOOL_VEC4]={TypedArray:Uint32Array,size:16,uniform:e.uniform4iv,arrayType:e.BOOL},t[e.FLOAT_MAT2]={TypedArray:Float32Array,size:16,uniform:x,arrayType:e.FLOAT},t[e.FLOAT_MAT3]={TypedArray:Float32Array,size:36,uniform:R,arrayType:e.FLOAT},t[e.FLOAT_MAT4]={TypedArray:Float32Array,size:64,uniform:w,arrayType:e.FLOAT},t[e.UNSIGNED_BYTE]={TypedArray:Uint8Array,size:1},t[e.UNSIGNED_SHORT]={TypedArray:Uint16Array,size:2};"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?(t[e.FLOAT_MAT2x3]={TypedArray:Float32Array,size:24,uniform:M,arrayType:e.FLOAT},t[e.FLOAT_MAT2x4]={TypedArray:Float32Array,size:32,uniform:I,arrayType:e.FLOAT},t[e.FLOAT_MAT3x2]={TypedArray:Float32Array,size:24,uniform:L,arrayType:e.FLOAT},t[e.FLOAT_MAT3x4]={TypedArray:Float32Array,size:48,uniform:F,arrayType:e.FLOAT},t[e.FLOAT_MAT4x2]={TypedArray:Float32Array,size:32,uniform:O,arrayType:e.FLOAT},t[e.FLOAT_MAT4x3]={TypedArray:Float32Array,size:48,uniform:C,arrayType:e.FLOAT},S(e,t,D,k)):S(e,t,P,U);return t}(e)),g[t]}function S(e,t,r,n){return t[e.SAMPLER_2D]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D},t[e.SAMPLER_CUBE]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_CUBE_MAP},t[e.SAMPLER_3D]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_3D},t[e.SAMPLER_2D_SHADOW]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D},t[e.SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D_ARRAY},t[e.SAMPLER_2D_ARRAY_SHADOW]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D_ARRAY},t[e.SAMPLER_CUBE_SHADOW]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_CUBE_MAP},t[e.INT_SAMPLER_2D]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D},t[e.INT_SAMPLER_3D]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_3D},t[e.INT_SAMPLER_CUBE]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_CUBE_MAP},t[e.INT_SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D_ARRAY},t[e.UNSIGNED_INT_SAMPLER_2D]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D},t[e.UNSIGNED_INT_SAMPLER_3D]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_3D},t[e.UNSIGNED_INT_SAMPLER_CUBE]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_CUBE_MAP},t[e.UNSIGNED_INT_SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:r,arraySampler:n,bindPoint:e.TEXTURE_2D_ARRAY},t}function x(e,t){this.uniformMatrix2fv(e,!1,t)}function R(e,t){this.uniformMatrix3fv(e,!1,t)}function w(e,t){this.uniformMatrix4fv(e,!1,t)}function M(e,t){this.uniformMatrix2x3fv(e,!1,t)}function L(e,t){this.uniformMatrix3x2fv(e,!1,t)}function I(e,t){this.uniformMatrix2x4fv(e,!1,t)}function O(e,t){this.uniformMatrix4x2fv(e,!1,t)}function F(e,t){this.uniformMatrix3x4fv(e,!1,t)}function C(e,t){this.uniformMatrix4x3fv(e,!1,t)}function P(e,t){return function(r,n){this.uniform1i(r,t),this.activeTexture(this.TEXTURE0+t),this.bindTexture(e,n)}}function U(e,t,r){const n=new Int32Array(r);for(let e=0;e<r;++e)n[e]=t+e;return function(t,r){this.uniform1iv(t,n),r.forEach((function(t,r){this.activeTexture(this.TEXTURE0+n[r]),this.bindTexture(e,t)}))}}function D(e,t){return function(r,n){let s,i;n instanceof WebGLTexture?(s=n,i=null):(s=n.texture,i=n.sampler),this.uniform1i(r,t),this.activeTexture(this.TEXTURE0+t),this.bindTexture(e,s),this.bindSampler(t,i)}}function k(e,t,r){const n=new Int32Array(r);for(let e=0;e<r;++e)n[e]=t+e;return function(r,s){this.uniform1iv(r,n),s.forEach((function(r,s){let i,a;this.activeTexture(this.TEXTURE0+n[s]),r instanceof WebGLTexture?(i=r,a=null):(i=r.texture,a=r.sampler),this.bindSampler(t,a),this.bindTexture(e,i)}))}}function B(e,t,r){let{TypedArray:n}=v(e,t);return new n(r)}class z{constructor(e){this.handle=e.createProgram(),this.shaders=[],this.gl=e}shader(e,t){let r=function(e,t,r){let n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;console.error(e.getShaderInfoLog(n)+"\nFailed to compile shader:\n"+r),e.deleteShader(n)}(this.gl,e,t);return this.shaders.push(r),this}link(){return function(e,t,r){for(let n of r)e.attachShader(t,n);e.linkProgram(t);for(let n of r)e.detachShader(t,n),e.deleteShader(n);if(e.getProgramParameter(t,e.LINK_STATUS))return t;console.error(e.getProgramInfoLog(t)),e.deleteProgram(t)}(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}function V(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}function G(e,t){switch(t){case e.FLOAT:return e.uniform1f;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1i;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1i;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return H;case e.FLOAT_MAT3:return j;case e.FLOAT_MAT4:return W;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1i}if(V(e))switch(t){case e.UNSIGNED_INT:return e.uniform1ui;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return X;case e.FLOAT_MAT2x4:return q;case e.FLOAT_MAT3x2:return $;case e.FLOAT_MAT3x4:return K;case e.FLOAT_MAT4x2:return J;case e.FLOAT_MAT4x3:return Z;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1i}throw new Error("Cannot find uniform function for data type.")}function Y(e,t){switch(t){case e.FLOAT:return e.uniform1fv;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1iv;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1iv;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return H;case e.FLOAT_MAT3:return j;case e.FLOAT_MAT4:return W;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1iv}if(V(e))switch(t){case e.UNSIGNED_INT:return e.uniform1uiv;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return X;case e.FLOAT_MAT2x4:return q;case e.FLOAT_MAT3x2:return $;case e.FLOAT_MAT3x4:return K;case e.FLOAT_MAT4x2:return J;case e.FLOAT_MAT4x3:return Z;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1iv}throw new Error("Cannot find array uniform function for data type.")}function H(e,t){this.uniformMatrix2fv(e,!1,t)}function j(e,t){this.uniformMatrix3fv(e,!1,t)}function W(e,t){this.uniformMatrix4fv(e,!1,t)}function X(e,t){this.uniformMatrix2x3fv(e,!1,t)}function q(e,t){this.uniformMatrix2x4fv(e,!1,t)}function $(e,t){this.uniformMatrix3x2fv(e,!1,t)}function K(e,t){this.uniformMatrix3x4fv(e,!1,t)}function J(e,t){this.uniformMatrix4x2fv(e,!1,t)}function Z(e,t){this.uniformMatrix4x3fv(e,!1,t)}class Q{constructor(e,t){this.handle=t,this.activeUniforms=function(e,t){let r={};const n=function(e,t){let r=[];const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){let n=e.getActiveUniform(t,s);if(!n)break;r.push(n)}return r}(e,t);for(let s of n){const n=s.name,i=s.size,a=s.type,o=e.getUniformLocation(t,n);let u;u=i<=1?G(e,a):Y(e,a),r[n]={type:a,length:i,location:o,set:u}}return r}(e,t),this.activeAttributes=function(e,t){let r={};const n=function(e,t){let r=[];const n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<n;++s){let n=e.getActiveAttrib(t,s);n&&r.push(n)}return r}(e,t);for(let s of n){const n=s.name,i=s.size,a=s.type,o=e.getAttribLocation(t,n);r[n]={type:a,length:i,location:o}}return r}(e,t),this.drawContext=new ee(this)}bind(e){return e.useProgram(this.handle),this.drawContext.gl=e,this.drawContext}}class ee{constructor(e){this.parent=e,this.gl=null}uniform(e,t){const r=this.parent.activeUniforms;if(e in r){let n=r[e],s=n.location;n.set.call(this.gl,s,t)}return this}attribute(e,t,r,n=!1,s=0,i=0){const a=this.gl,o=this.parent.activeAttributes;if(e in o){let u=o[e],l=u.location;if(t){let e=function(e,t){let r=v(e,t);return"arrayType"in r?r.arrayType:t}(a,u.type);a.bindBuffer(a.ARRAY_BUFFER,t),a.vertexAttribPointer(l,r,e,n,s,i),a.enableVertexAttribArray(l)}else a.disableVertexAttribArray(l)}return this}draw(e,t,r,n,s=null){return function(e,t,r,n,s=null){s?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.drawElements(t,n,e.UNSIGNED_SHORT,r)):e.drawArrays(t,r,n)}(e,t,r,n,s),this.parent}}i(0,1,0);function te(e,s,a,o){let l=function(e,r,n,s){var i=new t(4);return i[0]=e,i[1]=r,i[2]=n,i[3]=s,i}(e,s,-1,1),c=r();n(c,a),h(l,l,c),l[2]=-1,l[3]=0,n(c,o),h(l,l,c);let d=i(l[0],l[1],l[2]);return u(d,d),d}const re=Math.PI/3;class ne extends class{constructor(e,t,r){this.canvas=e,this.projectionMatrix=t,this.viewMatrix=r,this.resize=this.resize.bind(this),e.addEventListener("resize",this.resize),setTimeout(this.resize,0)}destroy(){this.canvas.removeEventListener("resize",this.resize)}resize(){}}{constructor(e,t=re,n=.1,s=1e3){super(e,r(),r()),this.fieldOfView=t,this.clippingPlane={near:n,far:s}}resize(){const e=this.canvas.width/this.canvas.height,{near:t,far:r}=this.clippingPlane;!function(e,t,r,n,s){var i,a=1/Math.tan(t/2);e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(i=1/(n-s),e[10]=(s+n)*i,e[14]=2*s*n*i):(e[10]=-1,e[14]=-2*n)}(this.projectionMatrix,this.fieldOfView,e,t,r)}}var se='<div class="container">\r\n    <label class="hidden" id="title">display-port</label>\r\n    <label class="hidden" id="fps">00</label>\r\n    <label class="hidden" id="dimension">0x0</label>\r\n    <canvas></canvas>\r\n    <slot></slot>\r\n</div>',ie=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}";const ae="noscale",oe=Symbol("template"),ue=Symbol("style");class le extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML=ie,Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML={mode:"open"},Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get[oe](){let e=document.createElement("template");return e.innerHTML=se,Object.defineProperty(this,oe,{value:e}),e}static get[ue](){let e=document.createElement("style");return e.innerHTML=ie,Object.defineProperty(this,ue,{value:e}),e}static get properties(){return{width:Number,height:Number,disabled:Boolean,debug:Boolean,mode:{type:String,value:"fit",observed:!1}}}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}static get customEvents(){return["frame"]}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}static get observedAttributes(){return["onframe","width","height","disabled","debug","id","class"]}constructor(){super(),se.attachShadow(),se.shadowRoot.appendChild(se.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),se.shadowRoot.appendChild(se.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onframe")){let e=this.onframe;delete this.onframe,this.onframe=e}if(Object.prototype.hasOwnProperty.call(this,"width")){let e=this.width;delete this.width,this.width=e}if(Object.prototype.hasOwnProperty.call(this,"height")){let e=this.height;delete this.height,this.height=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}if(Object.prototype.hasOwnProperty.call(this,"mode")){let e=this.mode;delete this.mode,this.mode=e}this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,r){switch(e){case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"disabled":this._disabled=null!==r;break;case"debug":this._debug=null!==r;break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this)}((e,t,r)=>{switch(e){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r)}})(e,0,r)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===ae){let e=`${this._width}x${this._height}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}else{let e=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:t,canvas:this._canvasElement},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let e=this.shadowRoot.host.getBoundingClientRect();const t=e.width,r=e.height;let n=this._canvasElement,s=this._width,i=this._height;const a=this.mode;if("stretch"===a)s=t,i=r;else if(a!==ae){if(t<s||r<i||"fit"===a){let e=t/s,n=r/i;e<n?(s=t,i*=e):(s*=n,i=r)}}s=Math.floor(s),i=Math.floor(i),n.clientWidth===s&&n.clientHeight===i||(n.width=this._width,n.height=this._height,n.style=`width: ${s}px; height: ${i}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:s,height:i},bubbles:!1,composed:!0})))}}window.customElements.define("display-port",le);const ce=Math.PI/180;function de(e){return e*ce}var he=Object.freeze({__proto__:null,loadImage:async function(e,t){return new Promise(((t,r)=>{let n=new Image;n.addEventListener("load",(()=>{t(n)})),n.addEventListener("error",(e=>{r(e)})),n.src=e}))}});var pe=Object.freeze({__proto__:null,loadText:async function(e,t){return(await fetch(e)).text()}});function fe(e){const t=[],r=[],n=[],s=[],i=[],a=[],o=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,u=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,l=/vt\s+(\S+)\s+(\S+)/g,c=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,d=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g;let h,p,f,m,b,A,y=!1,_=null;for(e=e.replace(/^#.*/g,"");null!=(_=o.exec(e));)h=Number.parseFloat(_[1]),p=Number.parseFloat(_[2]),f=Number.parseFloat(_[3]),t.push(h),t.push(p),t.push(f);for(;null!=(_=u.exec(e));)h=Number.parseFloat(_[1]),p=Number.parseFloat(_[2]),f=Number.parseFloat(_[3]),n.push(h),n.push(p),n.push(f);for(;null!=(_=l.exec(e));)h=Number.parseFloat(_[1]),p=Number.parseFloat(_[2]),r.push(h),r.push(p);for(;null!=(_=c.exec(e));)h=Number.parseInt(_[2]),Number.isNaN(h)&&(h=1),p=Number.parseInt(_[6]),Number.isNaN(p)&&(p=1),f=Number.parseInt(_[10]),Number.isNaN(f)&&(f=1),s.push(h),s.push(p),s.push(f),h=Number.parseInt(_[4]),Number.isNaN(h)?(h=Number.parseInt(_[3]),p=Number.parseInt(_[7]),f=Number.parseInt(_[11]),a.push(h),a.push(p),a.push(f),i.push(1),i.push(1),i.push(1)):(p=Number.parseInt(_[8]),Number.isNaN(p)&&(p=1),f=Number.parseInt(_[12]),Number.isNaN(f)&&(f=1),a.push(h),a.push(p),a.push(f),h=Number.parseInt(_[3]),Number.isNaN(h)&&(h=1),p=Number.parseInt(_[7]),Number.isNaN(p)&&(p=1),f=Number.parseInt(_[11]),Number.isNaN(f)&&(f=1),i.push(h),i.push(p),i.push(f)),void 0!==_[13]&&(m=Number.parseInt(_[15]),Number.isNaN(m)&&(m=1),s.push(m),m=Number.parseInt(_[17]),Number.isNaN(m)?(m=Number.parseInt(_[16]),a.push(m),i.push(1)):(a.push(m),m=Number.parseInt(_[16]),i.push(m)),y=!0);for(;null!=(_=d.exec(e));)h=Number.parseInt(_[2]),p=Number.parseInt(_[6]),f=Number.parseInt(_[10]),s.push(h),s.push(p),s.push(f),i.push(1),i.push(1),i.push(1),a.push(1),a.push(1),a.push(1),void 0!==_[13]&&(m=Number.parseInt(_[14]),s.push(m),i.push(1),a.push(1),y=!0);A=s.length;const N=new Float32Array(3*A);for(let e=0;e<A;++e)b=s[e]-1,N[3*e+0]=t[3*b+0],N[3*e+1]=t[3*b+1],N[3*e+2]=t[3*b+2];A=i.length;const T=new Float32Array(2*A);for(let e=0;e<A;++e)b=i[e]-1,T[2*e+0]=r[2*b+0],T[2*e+1]=r[2*b+1];A=a.length;const E=new Float32Array(3*A);for(let e=0;e<A;++e)b=a[e]-1,E[3*e+0]=n[3*b+0],E[3*e+1]=n[3*b+1],E[3*e+2]=n[3*b+2];A=s.length;const g=new Uint16Array(A);for(let e=0;e<A;++e)g[e]=e;return y&&console.warn("WebGL does not support quad faces, only triangles."),{positions:N,texcoords:T,normals:E,indices:g}}function me(e){const t=[],r=[],n=[],s=[],i=[],a=[],o=/v( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,u=/vn( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,l=/vt( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g,c=/f( +([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))?/g,d=/f( +[\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)( [\d|.|+|\-|e]+)/g;let h,p,f,m,b,A,y=!1,_=null;for(e=e.replace(/^#.*/g,"");null!=(_=o.exec(e));)h=Number.parseFloat(_[1]),p=Number.parseFloat(_[2]),f=Number.parseFloat(_[3]),t.push(h),t.push(p),t.push(f);for(;null!=(_=u.exec(e));)h=Number.parseFloat(_[1]),p=Number.parseFloat(_[2]),f=Number.parseFloat(_[3]),n.push(h),n.push(p),n.push(f);for(;null!=(_=l.exec(e));)h=Number.parseFloat(_[1]),p=Number.parseFloat(_[2]),r.push(h),r.push(p);for(;null!=(_=c.exec(e));)h=Number.parseInt(_[2]),Number.isNaN(h)&&(h=1),p=Number.parseInt(_[6]),Number.isNaN(p)&&(p=1),f=Number.parseInt(_[10]),Number.isNaN(f)&&(f=1),s.push(h),s.push(p),s.push(f),h=Number.parseInt(_[3]),Number.isNaN(h)&&(h=1),p=Number.parseInt(_[7]),Number.isNaN(p)&&(p=1),f=Number.parseInt(_[11]),Number.isNaN(f)&&(f=1),i.push(h),i.push(p),i.push(f),h=Number.parseInt(_[4]),Number.isNaN(h)&&(h=1),p=Number.parseInt(_[8]),Number.isNaN(p)&&(p=1),f=Number.parseInt(_[12]),Number.isNaN(f)&&(f=1),a.push(h),a.push(p),a.push(f),void 0!==_[13]&&(m=Number.parseInt(_[14]),Number.isNaN(m)&&(m=1),s.push(m),m=Number.parseInt(_[15]),Number.isNaN(m)&&(m=1),i.push(m),m=Number.parseInt(_[16]),Number.isNaN(m)&&(m=1),a.push(m),y=!0);for(;null!=(_=d.exec(e));)h=Number.parseInt(_[2]),p=Number.parseInt(_[6]),f=Number.parseInt(_[10]),s.push(h),s.push(p),s.push(f),i.push(1),i.push(1),i.push(1),a.push(1),a.push(1),a.push(1),void 0!==_[13]&&(m=Number.parseInt(_[14]),s.push(m),i.push(1),a.push(1),y=!0);A=s.length;const N=new Float32Array(3*A);for(let e=0;e<A;++e)b=s[e]-1,N[3*e+0]=t[3*b+0],N[3*e+1]=t[3*b+1],N[3*e+2]=t[3*b+2];A=i.length;const T=new Float32Array(2*A);for(let e=0;e<A;++e)b=i[e]-1,T[2*e+0]=r[2*b+0],T[2*e+1]=r[2*b+1];A=a.length;const E=new Float32Array(3*A);for(let e=0;e<A;++e)b=a[e]-1,E[3*e+0]=n[3*b+0],E[3*e+1]=n[3*b+1],E[3*e+2]=n[3*b+2];A=s.length;const g=new Uint16Array(A);for(let e=0;e<A;++e)g[e]=e;return y&&console.warn("WebGL does not support quad faces, only triangles."),{positions:N,texcoords:T,normals:E,indices:g}}var be=Object.freeze({__proto__:null,loadOBJ:async function(e,t){let r=await fetch(e),n=await r.text();{const e=10;for(let t=0;t<e;++t){performance.now();me(n);performance.now()}}{const e=10;for(let t=0;t<e;++t){performance.now();fe(n);performance.now()}}return fe(n)}});!async function(e){document.addEventListener("click",(()=>{"suspended"===e.state&&e.resume()}))}(new AudioContext);i(0,0,0),i(1,0,0),i(0,1,0),i(0,0,1);class Ae{constructor(e={locky:!1}){this.locky=e.locky,this.position=s(),this.forward=i(0,0,-1),this.right=i(1,0,0),this.up=i(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,r=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*r)),this.yaw=(this.yaw+e*r)%360,this}move(e,t=0,r=0,n=1){return this.forwardAmount+=e*n,this.rightAmount+=t*n,this.upAmount+=r*n,this}apply(t){let{position:r,forward:n,right:i,up:c,forwardAmount:d,rightAmount:h,upAmount:p,pitch:f,yaw:m}=this,b=de(m),A=de(f),y=Math.cos(b),_=Math.cos(A),N=Math.sin(b);u(n,function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}(n,y*_,Math.sin(A),N*_)),u(i,l(i,n,c));let T=s(),E=r[1];return o(T,n,d),a(r,r,T),o(T,i,h),a(r,r,T),this.locky&&(r[1]=E),o(T,c,p),a(r,r,T),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,function(t,r,n,s){var i,a,o,u,l,c,d,h,p,f,m=r[0],b=r[1],A=r[2],y=s[0],_=s[1],N=s[2],T=n[0],E=n[1],g=n[2];Math.abs(m-T)<e&&Math.abs(b-E)<e&&Math.abs(A-g)<e?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(t):(d=m-T,h=b-E,p=A-g,i=_*(p*=f=1/Math.hypot(d,h,p))-N*(h*=f),a=N*(d*=f)-y*p,o=y*h-_*d,(f=Math.hypot(i,a,o))?(i*=f=1/f,a*=f,o*=f):(i=0,a=0,o=0),u=h*o-p*a,l=p*i-d*o,c=d*a-h*i,(f=Math.hypot(u,l,c))?(u*=f=1/f,l*=f,c*=f):(u=0,l=0,c=0),t[0]=i,t[1]=u,t[2]=d,t[3]=0,t[4]=a,t[5]=l,t[6]=h,t[7]=0,t[8]=o,t[9]=c,t[10]=p,t[11]=0,t[12]=-(i*m+a*b+o*A),t[13]=-(u*m+l*b+c*A),t[14]=-(d*m+h*b+p*A),t[15]=1)}(t,r,a(T,r,n),c),t}}const ye={NULL:0,DOWN:1,UP:2,MOVE:3,parse(e){if("string"!=typeof e)return ye.NULL;switch(e.toLowerCase()){case"down":return ye.DOWN;case"up":return ye.UP;case"move":return ye.MOVE;default:return ye.NULL}}};const _e=1,Ne=2;class Te{static createAdapter(e,t,r,n,s,i){return{target:e,adapterId:t,deviceName:r,keyCode:n,scale:s,eventCode:i}}constructor(){this.adapters={"*":Ee()}}add(e){for(let t of e){const{deviceName:e,keyCode:r}=t;let n;e in this.adapters?n=this.adapters[e]:(n=Ee(),this.adapters[e]=n),r in n?n[r].push(t):n[r]=[t]}}delete(e){for(let t of e){const{deviceName:e,keyCode:r}=t;if(e in this.adapters){let n=this.adapters[e];if(r in n){let e=n[r],s=e.indexOf(t);s>=0&&e.splice(s,1)}}}}clear(){for(let e in this.adapters)this.adapters[e]=Ee()}poll(e,t,r){const n=this.findAdapters(e,t);for(let e of n){const t=e.eventCode;if(t===ye.NULL){const{target:t,scale:n}=e,s=r.value*n;t.poll(s,e)}else{const{target:n,scale:s}=e,i=r.getEvent(t)*s;n.poll(i,e)}}return n.length>0}update(e,t,r){let n=!1;for(let s of this.findAdapters(e,t)){const e=s.eventCode;if(e!==ye.NULL){const{target:t,scale:i}=s,a=r.getEvent(e)*i;t.update(a,s),n=!0}}return n}reset(e,t,r){let n=!1;for(let r of this.findAdapters(e,t))r.target.reset(),n=!0;return n}findAdapters(e,t){let r=[];if(e in this.adapters){let n=this.adapters[e];t in n&&r.push(...n[t]),r.push(...n["*"])}let n=this.adapters["*"];return t in n&&r.push(...n[t]),r.push(...n["*"]),r}}function Ee(){return{"*":[]}}class ge extends class{constructor(){this.value=0}update(e){this.value=e}poll(){this.value=0}getEvent(e){return 0}getState(){return this.value}}{constructor(e){super(),this.update=this.update.bind(this),Array.isArray(e)||(e=[e]);let t=[],r=0;for(let n of e){"string"==typeof n&&(n={key:n});const{key:e,scale:s=1,event:i="null"}=n,{deviceName:a,keyCode:o}=ve(e),u=ye.parse(i),l=Number(s);let c=Te.createAdapter(this,r,a,o,l,u);t.push(c),++r}this.adapters=t,this.values=new Array(t.length).fill(0),this.next={values:new Array(t.length).fill(0),value:0}}poll(e,t){const r=t.adapterId;let n=this.values[r];this.values[r]=e,this.value=this.value-n+e,this.next.values[r]=0,this.next.value+=e-n}update(e,t){const r=t.adapterId;let n=this.next.values[r];this.next.values[r]=e,this.next.value+=e-n}reset(){this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function ve(e){let t=e.indexOf(":");if(t>=0)return{deviceName:e.substring(0,t),keyCode:e.substring(t+1)};throw new Error("Invalid key string - missing device separator ':'.")}function Se(e,t){return`${e}:${t}`}class xe{constructor(e={}){const{disabled:t=!0}=e;this.inputSource=null,this._disabled=t,this._ignoreInput=t,this.adapters=new Te,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this)}get disabled(){return this._disabled}set disabled(e){this.toggle(!e)}setInputMap(e){return this._setupInputs(this.inputSource,e),this}attach(e){return this._setupInputs(e,null),this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(e,t){const r=this.disabled;this.disabled=!0;const n=this.inputSource,s=this.inputs,i=n!==e&&n,a=this.inputs&&t;if(i||a){i&&(n.removeEventListener("poll",this.onSourcePoll),n.removeEventListener("input",this.onSourceInput));for(let e in s){let{adapters:t}=s[e];for(let e of t){const{deviceName:t,keyCode:r}=e;0===Me(n,t,r)&&n.delete(t,r)}}a&&(this.adapters.clear(),this.inputs={})}if(t){let e={};for(let r in t){let n=t[r],s=new ge(n),i=s.adapters;this.adapters.add(i),e[r]=s}this.inputs=e}if(e){!function(e){Re in e||(e[Re]={})}(e);const t=this.inputs;for(let r in t){let{adapters:n}=t[r];for(let t of n){const{deviceName:r,keyCode:n}=t;1===we(e,r,n)&&e.add(r,n)}}this.inputSource!==e&&(e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),this.inputSource=e)}this.disabled=r}onSourceInput(e){if(e.consumed||this._ignoreInput){const{deviceName:t,keyCode:r,input:n}=e;this.adapters.reset(t,r,n)}else{const{stage:t,deviceName:r,keyCode:n,input:s}=e;switch(t){case Ne:this.adapters.poll(r,n,s);break;case _e:this.adapters.update(r,n,s)}e.consumed=!0}}onSourcePoll(e){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(e=this._disabled){if(e){if(!this.inputSource)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!e,this}getInput(e){return this.inputs[e]}getInputValue(e){return e in this.inputs?this.inputs[e].value:0}}const Re=Symbol("inputRefCounts");function we(e,t,r){const n=Se(t,r);let s=e[Re],i=s[n]+1||1;return s[n]=i,i}function Me(e,t,r){const n=Se(t,r);let s=e[Re],i=s[n]-1||0;return s[n]=Math.max(i,0),i}const Le=(new xe).setInputMap({PointerX:{key:"Mouse:PosX",scale:1},PointerY:{key:"Mouse:PosY",scale:1},PointerMovementX:{key:"Mouse:PosX",event:"move"},PointerMovementY:{key:"Mouse:PosY",event:"move"},PointerMovementZ:{key:"Mouse:WheelY",event:"move"},PointerDown:[{key:"Mouse:Button0",scale:1},{key:"Mouse:Button2",scale:1}],MoveLeft:[{key:"Keyboard:ArrowLeft",scale:1},{key:"Keyboard:KeyA",scale:1}],MoveRight:[{key:"Keyboard:ArrowRight",scale:1},{key:"Keyboard:KeyD",scale:1}],MoveUp:[{key:"Keyboard:ArrowUp",scale:1},{key:"Keyboard:KeyW",scale:1}],MoveDown:[{key:"Keyboard:ArrowDown",scale:1},{key:"Keyboard:KeyS",scale:1}]}),Ie={load:async()=>({mainVertexShaderSource:await pe.loadText("main.vert"),mainFragmentShaderSource:await pe.loadText("main.frag"),cubeObj:await be.loadOBJ("cube.obj"),quadObj:await be.loadOBJ("quad.obj"),gradientClay:await he.loadImage("gradient_clay.png"),color:await he.loadImage("null.png")})};class Oe{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,r={parent:0,children:[]};return this.nodes[t]=r,Fe(e,t,this),t}createSceneNodes(e,t){let r=[];for(let n=0;n<e;++n)r.push(this.createSceneNode(t));return r}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");Ce(this.nodes[e].parent,e,this),Pe(this,e,0,Ue)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){Ce(this.nodes[e].parent,e,this),Fe(t,e,this)}replaceSceneNode(e,t){let r=this.nodes[e],n=r.parent,s=r.children.slice();if(Ce(n,e,this),r.children.length=0,t){let e=this.nodes[t];Ce(e.parent,t,this),e.children.push(...s),Fe(n,t,this)}else if(n){this.nodes[n].children.push(...s)}else this.roots.push(...s);for(let e of s)this.nodes[e].parent=n}walk(e,t={}){const{from:r,childFilter:n}=t;let s;s=r?Array.isArray(r)?r:[r]:this.roots,n&&(s=n(s,0,this));for(let t of s)Pe(this,t,0,e,n)}}function Fe(e,t,r){e?(r.nodes[e].children.push(t),r.nodes[t].parent=e):(r.roots.push(t),r.nodes[t].parent=0)}function Ce(e,t,r){if(e){let n=r.nodes[e].children,s=n.indexOf(t);n.splice(s,1),r.nodes[t].parentNode=0}else{let e=r.roots,n=e.indexOf(t);e.splice(n,1),r.nodes[t].parentNode=0}}function Pe(e,t,r,n,s){if(r>=100)return;let i=n(t,e);if(!1===i)return;let a=e.nodes[t],o=s?s(a.children,t,e):a.children;for(let t of o)Pe(e,t,r+1,n,s);"function"==typeof i&&i(t,e)}function Ue(e,t){delete t.nodes[e]}class De{constructor(e,t,r){this.shaderProgram=t,this.meshData=r;let n=r;{const t=B(e,e.FLOAT,n.positions),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.positions={source:t,buffer:r}}{const t=B(e,e.FLOAT,n.texcoords),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:r}}{const t=B(e,e.FLOAT,n.normals),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:r}}const s=B(e,e.UNSIGNED_SHORT,n.indices),i=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,s,e.STATIC_DRAW),this.elements={source:s,buffer:i},this._drawContext=new ke(this)}begin(e,t,r){let n=this.shaderProgram.bind(e);return n.uniform("u_projection",t),n.uniform("u_view",r),this._drawContext.setProgramContext(n),this._drawContext}}class ke{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,r){const{ctx:n,renderer:s}=this,{positions:i,texcoords:a,normals:o,elements:u}=s;n.attribute("a_position",i.buffer,3),n.attribute("a_texcoord",a.buffer,2),n.attribute("a_normal",o.buffer,3),n.uniform("u_model",t),r&&n.uniform("u_color",r),n.draw(e,e.TRIANGLES,0,u.source.length,u.buffer)}end(e){return this.renderer}}class Be{constructor(e,t,r){this.shaderProgram=t,this.meshData=r;let n=r;const s=B(e,e.FLOAT,n.positions),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW),this.positions={source:s,buffer:i};{const t=B(e,e.FLOAT,n.texcoords),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:r}}{const t=B(e,e.FLOAT,n.normals),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:r}}const a=B(e,e.UNSIGNED_SHORT,n.indices),o=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a,e.STATIC_DRAW),this.elements={source:a,buffer:o},this._drawContext=new ze(this)}begin(e,t,r){let n=this.shaderProgram.bind(e);return n.uniform("u_projection",t),n.uniform("u_view",r),this._drawContext.setProgramContext(n),this._drawContext}}class ze{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,r){const{ctx:n,renderer:s}=this,{positions:i,texcoords:a,normals:o,elements:u}=s;n.attribute("a_position",i.buffer,3),n.attribute("a_texcoord",a.buffer,2),n.attribute("a_normal",o.buffer,3),n.uniform("u_model",t),r&&n.uniform("u_color",r),n.draw(e,e.TRIANGLES,0,u.source.length,u.buffer)}end(e){return this.renderer}}const Ve=Symbol("template"),Ge=Symbol("style");function Ye(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];delete e[t],e[t]=r}}class He extends HTMLElement{static get[Ve](){let e=document.createElement("template");return e.innerHTML='\n        <kbd>\n            <span id="key"><slot></slot></span>\n            <span id="value" class="hidden"></span>\n        </kbd>',Object.defineProperty(this,Ve,{value:e}),e}static get[Ge](){let e=document.createElement("style");return e.innerHTML='\n        kbd {\n            position: relative;\n            display: inline-block;\n            border-radius: 3px;\n            border: 1px solid #888;\n            font-size: 0.85em;\n            font-weight: 700;\n            text-rendering: optimizeLegibility;\n            line-height: 12px;\n            height: 14px;\n            padding: 2px 4px;\n            color: #444;\n            background-color: #EEE;\n            box-shadow: inset 0 -3px 0 #AAA;\n            overflow: hidden;\n        }\n        \n        kbd:empty:after {\n            content: "<?>";\n            opacity: 0.6;\n        }\n        \n        .disabled {\n            opacity: 0.6;\n            box-shadow: none;\n            background-color: #AAA;\n        }\n\n        .hidden {\n            display: none;\n        }\n        \n        #value {\n            position: absolute;\n            top: 0;\n            bottom: 0;\n            right: 0;\n            font-size: 0.85em;\n            padding: 0 4px;\n            padding-top: 2px;\n            color: #CCC;\n            background-color: #333;\n            box-shadow: inset 0 3px 0 #222;\n        }',Object.defineProperty(this,Ge,{value:e}),e}static get observedAttributes(){return["name","value","disabled"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Ve].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Ge].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}connectedCallback(){Ye(this,"name"),Ye(this,"value")}attributeChangedCallback(e,t,r){switch(e){case"name":this._keyElement.innerText=r;break;case"value":null!==r?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=r,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==r)}}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get value(){return this.getAttribute("value")}set value(e){this.setAttribute("value",e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}}window.customElements.define("input-kbd",He);const je=Symbol("template"),We=Symbol("style");class Xe extends HTMLElement{static get[je](){let e=document.createElement("template");return e.innerHTML='\n        <table>\n            <thead>\n                <tr class="tableHeader">\n                    <th id="title" colspan=4>\n                        <slot></slot>\n                    </th>\n                </tr>\n                <tr class="colHeader">\n                    <th>name</th>\n                    <th>key</th>\n                    <th>mod</th>\n                    <th>value</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n        </table>',Object.defineProperty(this,je,{value:e}),e}static get[We](){let e=document.createElement("style");return e.innerHTML="\n        :host {\n            display: block;\n        }\n        table {\n            border-collapse: collapse;\n        }\n        table, th, td {\n            border: 1px solid gray;\n        }\n        .colHeader > th {\n            font-size: 0.8em;\n            font-family: monospace;\n            padding: 0 10px;\n            letter-spacing: 3px;\n            background-color: #AAA;\n            color: #666666;\n        }\n        th, td {\n            padding: 5px 10px;\n        }\n        td {\n            text-align: center;\n        }\n        output {\n            font-family: monospace;\n            border-radius: 0.3em;\n            padding: 3px;\n        }\n        tr:not(.primary) .name, tr:not(.primary) .value {\n            opacity: 0.3;\n        }\n        tr:nth-child(2n) {\n            background-color: #EEE;\n        }",Object.defineProperty(this,We,{value:e}),e}static get observedAttributes(){return["src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[je].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[We].cloneNode(!0)),this._src="",this._titleElement=this.shadowRoot.querySelector("#title"),this._tableElements={},this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}connectedCallback(){!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];delete e[t],e[t]=r}}(this,"src")}attributeChangedCallback(e,t,r){switch(e){case"src":if(this._src!==r)if(this._src=r,r.trim().startsWith("{")){let e=JSON.parse(r);this._setInputMap(e)}else fetch(r).then((e=>e.json())).then((e=>this._setInputMap(e)));break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",String(e))}}_setInputMap(e){let t=[];for(let r in e){qe(t,r,e[r])}this._bodyElement.innerHTML="";for(let e of t)this._bodyElement.appendChild(e)}}function qe(e,t,r){if(Array.isArray(r)){qe(e,t,r[0]);let n=r.length;for(let s=1;s<n;++s){const{key:n,event:i,scale:a}=r[s];let o=$e(t,n,i,a,0,!1);e.push(o)}return e}{const{key:n,event:s,scale:i}=r;let a=$e(t,n,s,i,0);return e.push(a),e}}function $e(e,t,r,n,s,i=!0){let a=document.createElement("tr");i&&a.classList.add("primary");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),a.appendChild(t)}{let e=document.createElement("td");e.classList.add("key");let r=new He;r.innerText=t,e.appendChild(r),a.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("samp"),s=[];"string"==typeof r&&"null"!==r&&s.push(r),"number"==typeof n&&1!==n&&s.push(`Ã—${n.toFixed(2)}`),t.innerText=s.join(" "),e.classList.add("mod"),e.appendChild(t),a.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("output");t.innerText=Number(s).toFixed(2),t.classList.add("value"),e.appendChild(t),a.appendChild(e)}return a}window.customElements.define("input-map",Xe);const Ke=Symbol("template"),Je=Symbol("style");function Ze(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];delete e[t],e[t]=r}}class Qe extends HTMLElement{static get[Ke](){let e=document.createElement("template");return e.innerHTML="",Object.defineProperty(this,Ke,{value:e}),e}static get[Je](){let e=document.createElement("style");return e.innerHTML="\n        :host {\n            display: inline-block;\n        }",Object.defineProperty(this,Je,{value:e}),e}static get observedAttributes(){return["for","src","autopoll","disabled","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Ke].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Je].cloneNode(!0)),this._src="",this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._tableBody=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot"),this._inputContext=new xe}connectedCallback(){Ze(this,"src"),Ze(this,"for"),Ze(this,"disabled"),Ze(this,"debug"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0)}disconnectedCallback(){this._inputContext.disabled=!0}attributeChangedCallback(e,t,r){switch(e){case"for":{let e=r?document.getElementById(r):document.querySelector("input-source");e?this._inputContext.attach(e.source):this._inputContext.detach()}break;case"src":if(this._src!==r)if(this._src=r,r.trim().startsWith("{")){let e=JSON.parse(r);this._inputContext.setInputMap(e)}else fetch(r).then((e=>e.json())).then((e=>this._inputContext.setInputMap(e)));break;case"disabled":this._inputContext.disabled=null!==r;break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._inputContext.setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",String(e))}}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}}window.customElements.define("input-port",Qe),document.addEventListener("DOMContentLoaded",(async function(){const e=document.querySelector("display-port"),t=document.querySelector("input-source"),n=Le.attach(t.source);s=e,s.addEventListener("focus",(()=>{document.pointerLockElement!==s&&s.requestPointerLock()})),document.addEventListener("pointerlockchange",(()=>{document.pointerLockElement!==s&&s.blur()}));var s;const a=e.canvas.getContext("webgl");if(!a)throw new Error("Your browser does not support WebGL.");a.enable(a.DEPTH_TEST);const o=await Ie.load(),u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o.gradientClay),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);const l=function(e,t){return new Q(e,t)}(a,function(e){return new z(e)}(a).shader(a.VERTEX_SHADER,o.mainVertexShaderSource).shader(a.FRAGMENT_SHADER,o.mainFragmentShaderSource).link()),c=new De(a,l,o.cubeObj),d=new Be(a,l,o.quadObj),h=function(e,t=re,r=.1,n=1e3){return new ne(e,t,r,n)}(a.canvas),f=function(e={}){return new Ae(e)}({locky:!0});f.move(-15,0,5),f.look(0,-20);const m=new Map,b=new Oe;function A(e=0,t=0,n=0,s=1,a=1,o=1,u=0,l=0,c=0,d=i(Math.random(),Math.random(),Math.random()),h={}){let f=b.createSceneNode(),A={worldMatrix:r(),localMatrix:r()};return function(e,t,r,n){var s=t[0],i=t[1],a=t[2],o=t[3],u=s+s,l=i+i,c=a+a,d=s*u,h=s*l,p=s*c,f=i*l,m=i*c,b=a*c,A=o*u,y=o*l,_=o*c,N=n[0],T=n[1],E=n[2];e[0]=(1-(f+b))*N,e[1]=(h+_)*N,e[2]=(p-y)*N,e[3]=0,e[4]=(h-_)*T,e[5]=(1-(d+b))*T,e[6]=(m+A)*T,e[7]=0,e[8]=(p+y)*E,e[9]=(m-A)*E,e[10]=(1-(d+f))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1}(A.localMatrix,function(e,t,r,n){var s=.5*Math.PI/180;t*=s,r*=s,n*=s;var i=Math.sin(t),a=Math.cos(t),o=Math.sin(r),u=Math.cos(r),l=Math.sin(n),c=Math.cos(n);return e[0]=i*u*c-a*o*l,e[1]=a*o*c+i*u*l,e[2]=a*u*l-i*o*c,e[3]=a*u*c+i*o*l,e}(p(),u,l,c),i(e,t,n),i(s,a,o)),m.set(f,A),{sceneNode:f,transform:A,color:d,...h}}const y=A(),_=((()=>{const e=.01,t=.1,r=.11,n=A(r,0,0,t,e,e,0,0,0,i(1,0,0)),s=A(0,r,0,e,t,e,0,0,0,i(0,1,0)),a=A(0,0,r,e,e,t,0,0,0,i(0,0,1)),o=A(0,0,0,e,e,e,0,0,0,i(1,1,1));b.parentSceneNode(n.sceneNode,y.sceneNode),b.parentSceneNode(s.sceneNode,y.sceneNode),b.parentSceneNode(a.sceneNode,y.sceneNode),b.parentSceneNode(o.sceneNode,y.sceneNode)})(),A()),N=((()=>{let e=A(0,-2.5,0,.8,.5,.8),t=A(0,-2,0,1.05,.2,1.05),r=A(0,-1,0,.6,1,.6),n=A(0,-1.8,0,.7,.2,.7);const s=.3;let i=A(0,.15,0,.6,.2,.6,-5),a=A(0,.05,0,1,.1,1,-5),o=A(-.3,-.3,.6,.1,.1,.1),u=A(.3,-.3,.6,.1,.1,.1),l=A(-.9,-.7,0,.2,.3,.2,0,0,90),c=A(-1,-.7+s,0,.2,.1,.2,0,0,0);c.color=l.color;let d=A(.9,-1,0,.2,.3,.2,0,0,90),h=A(1,-.7,0,.2,.1,.2,0,0,0);h.color=d.color,b.parentSceneNode(t.sceneNode,_.sceneNode),b.parentSceneNode(e.sceneNode,_.sceneNode),b.parentSceneNode(n.sceneNode,_.sceneNode),b.parentSceneNode(i.sceneNode,_.sceneNode),b.parentSceneNode(a.sceneNode,_.sceneNode),b.parentSceneNode(o.sceneNode,_.sceneNode),b.parentSceneNode(u.sceneNode,_.sceneNode),b.parentSceneNode(r.sceneNode,_.sceneNode),b.parentSceneNode(l.sceneNode,_.sceneNode),b.parentSceneNode(c.sceneNode,_.sceneNode),b.parentSceneNode(d.sceneNode,_.sceneNode),b.parentSceneNode(h.sceneNode,_.sceneNode)})(),[A(0,0,0,1,1,1),A(4,0,0,1,.5,1),A(-4,0,0,2,4,2,45)]),T=[A(0,-4,0,2,2,2)];let E=0;e.addEventListener("frame",(e=>{e.detail.deltaTime;n.inputSource.poll();const t=n.getInputValue("PointerX"),r=n.getInputValue("PointerY"),s=n.getInputValue("PointerMovementX"),i=n.getInputValue("PointerMovementY"),o=n.getInputValue("PointerMovementZ"),u=n.getInputValue("MoveRight")-n.getInputValue("MoveLeft"),l=n.getInputValue("MoveUp")-n.getInputValue("MoveDown");a.viewport(0,0,a.canvas.width,a.canvas.height),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT);let p=h;const A=a.canvas.width/a.canvas.height;f.look(100*s*A,100*-i);f.move(.5*l,.5*u),f.apply(p.viewMatrix),E+=o/1e3;let _,g=te(2*(t-.5),2*(.5-r),p.projectionMatrix,p.viewMatrix);!function(e,t,r,n){e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n}(g,f.position,g,1-E),function(e,t){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}(y.transform.localMatrix,g),b.walk(((e,t)=>{let{parent:r}=t.getSceneNodeInfo(e);!function(e,t){t?function(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3],o=t[4],u=t[5],l=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],b=t[13],A=t[14],y=t[15],_=r[0],N=r[1],T=r[2],E=r[3];e[0]=_*n+N*o+T*d+E*m,e[1]=_*s+N*u+T*h+E*b,e[2]=_*i+N*l+T*p+E*A,e[3]=_*a+N*c+T*f+E*y,_=r[4],N=r[5],T=r[6],E=r[7],e[4]=_*n+N*o+T*d+E*m,e[5]=_*s+N*u+T*h+E*b,e[6]=_*i+N*l+T*p+E*A,e[7]=_*a+N*c+T*f+E*y,_=r[8],N=r[9],T=r[10],E=r[11],e[8]=_*n+N*o+T*d+E*m,e[9]=_*s+N*u+T*h+E*b,e[10]=_*i+N*l+T*p+E*A,e[11]=_*a+N*c+T*f+E*y,_=r[12],N=r[13],T=r[14],E=r[15],e[12]=_*n+N*o+T*d+E*m,e[13]=_*s+N*u+T*h+E*b,e[14]=_*i+N*l+T*p+E*A,e[15]=_*a+N*c+T*f+E*y}(e.worldMatrix,t.worldMatrix,e.localMatrix):function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(e.worldMatrix,e.localMatrix)}(m.get(e),r?m.get(r):null)})),_=c.begin(a,p.projectionMatrix,p.viewMatrix),_.ctx.uniform("u_texture",0);for(let e of N)_.ctx.uniform("u_local",e.transform.localMatrix),_.render(a,e.transform.worldMatrix,e.color);_.end(a),_=d.begin(a,p.projectionMatrix,p.viewMatrix),_.ctx.uniform("u_texture",0);for(let e of T)_.ctx.uniform("u_local",e.transform.localMatrix),_.render(a,e.transform.worldMatrix,e.color);_.end(a)}))}))}();
