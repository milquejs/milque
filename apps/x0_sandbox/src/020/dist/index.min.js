!function(){"use strict";const t="noscale",e="stretch",n=Symbol("template"),i=Symbol("style");class r extends HTMLElement{static get[n](){let t=document.createElement("template");return t.innerHTML='\n<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <canvas></canvas>\n    <slot></slot>\n</div>',Object.defineProperty(this,n,{value:t}),t}static get[i](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n    color: #555555;\n}\n.container {\n    display: flex;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\ncanvas {\n    background: #000000;\n    margin: auto;\n    image-rendering: pixelated;\n}\nlabel {\n    font-family: monospace;\n    color: currentColor;\n    position: absolute;\n}\n#title {\n    left: 0.5rem;\n    top: 0.5rem;\n}\n#fps {\n    right: 0.5rem;\n    top: 0.5rem;\n}\n#dimension {\n    left: 0.5rem;\n    bottom: 0.5rem;\n}\n.hidden {\n    display: none;\n}\n:host([debug]) .container {\n    outline: 6px dashed rgba(0, 0, 0, 0.1);\n    outline-offset: -4px;\n    background-color: rgba(0, 0, 0, 0.1);\n}\n:host([mode="noscale"]) canvas {\n    margin: 0;\n    top: 0;\n    left: 0;\n}\n:host([mode="fit"]), :host([mode="center"]), :host([mode="stretch"]) {\n    width: 100%;\n    height: 100%;\n}\n:host([full]) {\n    width: 100vw!important;\n    height: 100vh!important;\n}\n:host([disabled]) {\n    display: none;\n}\nslot {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n\n    pointer-events: none;\n}\n::slotted(*) {\n    pointer-events: auto;\n}',Object.defineProperty(this,i,{value:t}),t}static get observedAttributes(){return["width","height","disabled","onframe","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[n].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[i].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){this.hasAttribute("mode")||(this.mode="noscale"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,n){switch(t){case"width":this._width=n;break;case"height":this._height=n;break;case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"onframe":this.onframe=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const n=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=n<=0?"--":String(Math.round(1e3/n)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===t){let t=`${this._width}x${this._height}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:n,canvas:this._canvasElement,get context(){let t=this.canvas.getContext("2d");return t.imageSmoothingEnabled=!1,t}},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let n=this.shadowRoot.host.getBoundingClientRect();const i=n.width,r=n.height;let s=this._canvasElement,a=this._width,o=this._height;const u=this.mode;if(u===e)a=i,o=r;else if(u!==t){if(i<a||r<o||"fit"===u){let t=i/a,e=r/o;t<e?(a=i,o*=t):(a*=e,o=r)}}a=Math.floor(a),o=Math.floor(o),s.clientWidth===a&&s.clientHeight===o||(s.width=this._width,s.height=this._height,s.style=`width: ${a}px; height: ${o}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:a,height:o},bubbles:!1,composed:!0})))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}get width(){return this._width}set width(t){this.setAttribute("width",t)}get height(){return this._height}set height(t){this.setAttribute("height",t)}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}window.customElements.define("display-port",r);class s{static addInputEventListener(t,e){}static removeInputEventListener(t,e){}constructor(t){this.eventTarget=t}}class a{constructor(){this.down=0,this.up=0,this.value=0,this.next={up:0,down:0}}update(t,e){"down"===t?this.next.down=e:this.next.up=e}poll(){this.value?this.up&&!this.next.up&&(this.value=0):this.next.down&&(this.value=1),this.down=this.next.down,this.up=this.next.up,this.next.down=0,this.next.up=0}toString(){return this.value}}class o{constructor(){this.value=0}update(t,e){this.value=e}poll(){}toString(){return this.value}}class u extends o{constructor(){super(),this.next=0}update(t,e){this.next+=e}poll(){this.value=this.next,this.next=0}}const l=Symbol("keyboardEventContext");class h extends s{static addInputEventListener(t,e){let n;if(l in e)n=e[l];else{n={handler:e,target:t,down:null,up:null,_keyEvent:{type:"key",target:t,device:"keyboard",key:null,event:null,value:null,control:!1,shift:!1,alt:!1}};let i=d.bind(n),r=p.bind(n);n.down=i,n.up=r,e[l]=n}return t.addEventListener("keyup",n.up),t.addEventListener("keydown",n.down),t}static removeInputEventListener(t,e){if(l in e){let n=e[l];t.removeEventListener("keyup",n.up),t.removeEventListener("keydown",n.down)}return t}constructor(t,e){if(super(t),this._buttons=[],this._managed=Array.isArray(e),this.onManagedKeyEvent=this.onManagedKeyEvent.bind(this),this.onUnmanagedKeyEvent=this.onUnmanagedKeyEvent.bind(this),this._managed){for(let t of e){let e=new a;this[t]=e,this._buttons.push(e)}h.addInputEventListener(t,this.onManagedKeyEvent)}else h.addInputEventListener(t,this.onUnmanagedKeyEvent)}get Up(){return Math.min((this.ArrowUp||0)+(this.KeyW||0),1)}get Down(){return Math.min((this.ArrowDown||0)+(this.KeyS||0),1)}get Left(){return Math.min((this.ArrowLeft||0)+(this.KeyA||0),1)}get Right(){return Math.min((this.ArrowRight||0)+(this.KeyD||0),1)}destroy(){this._managed?h.removeInputEventListener(this.eventTarget,this.onManagedKeyEvent):h.removeInputEventListener(this.eventTarget,this.onUnmanagedKeyEvent),this.eventTarget=null}poll(){for(let t of this._buttons)t.poll();return this}onUnmanagedKeyEvent(t){if(!(t.key in this)){let e=new a;this[t.key]=e,this._buttons.push(e)}return this[t.key].update(t.event,t.value),!0}onManagedKeyEvent(t){if(t.key in this)return this[t.key].update(t.event,t.value),!0}}function d(t){if(t.repeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._keyEvent;return e.key=t.code,e.event="down",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.handler.call(void 0,e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}function p(t){let e=this._keyEvent;if(e.key=t.code,e.event="up",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.handler.call(void 0,e))return t.preventDefault(),t.stopPropagation(),!1}const c=Symbol("mouseEventContext");class m extends s{static addInputEventListener(t,e){let n;if(c in e)n=e[c];else{n={handler:e,target:t,down:null,up:null,move:null,contextmenu:null,_down:!1,_keyEvent:{type:"key",target:t,device:"mouse",key:null,event:null,value:null},_posEvent:{type:"pos",target:t,device:"mouse",key:"pos",event:"move",x:0,y:0,dx:0,dy:0}};let i=f.bind(n),r=y.bind(n),s=v.bind(n),a=b.bind(n);n.down=i,n.up=r,n.move=s,n.contextmenu=a,e[c]=n}return t.addEventListener("mousedown",n.down),document.addEventListener("mouseup",n.up),t.addEventListener("contextmenu",n.contextmenu),document.addEventListener("mousemove",n.move),t}static removeInputEventListener(t,e){if(c in e){let n=e[c];t.removeEventListener("mousedown",n.down),document.removeEventListener("mouseup",n.up),t.removeEventListener("contextmenu",n.contextmenu),document.removeEventListener("mousemove",n.move)}return t}constructor(t){super(t),this.x=new o,this.y=new o,this.dx=new u,this.dy=new u,this.Button0=new a,this.Button1=new a,this.Button2=new a,this.Button3=new a,this.Button4=new a,this.onMouseEvent=this.onMouseEvent.bind(this),m.addInputEventListener(t,this.onMouseEvent)}get Left(){return this.Button0}get Middle(){return this.Button1}get Right(){return this.Button2}destroy(){m.removeInputEventListener(this.eventTarget,this.onMouseEvent),this.eventTarget=null}poll(){return this.x.poll(),this.y.poll(),this.dx.poll(),this.dy.poll(),this.Button0.poll(),this.Button1.poll(),this.Button2.poll(),this.Button3.poll(),this.Button4.poll(),this}onMouseEvent(t){let{key:e,event:n}=t;switch(e){case 0:this.Button0.update(n,t.value);break;case 1:this.Button1.update(n,t.value);break;case 2:this.Button2.update(n,t.value);break;case 3:this.Button3.update(n,t.value);break;case 4:this.Button4.update(n,t.value);break;case"pos":return this.x.update(n,t.x),this.y.update(n,t.y),this.dx.update(n,t.dx),void this.dy.update(n,t.dy)}return!0}}function f(t){this._down=!0;let e=this._keyEvent;if(e.key=t.button,e.event="down",e.value=1,this.handler.call(void 0,e)&&document.activeElement===this.target)return t.preventDefault(),t.stopPropagation(),!1}function y(t){if(this._down){this._down=!1;let e=this._keyEvent;if(e.key=t.button,e.event="up",e.value=1,this.handler.call(void 0,e))return t.preventDefault(),t.stopPropagation(),!1}}function v(t){let e=this.target,{clientWidth:n,clientHeight:i}=e,r=this.target.getBoundingClientRect(),s=t.movementX/n,a=t.movementY/i,o=(t.clientX-r.left)/n,u=(t.clientY-r.top)/i,l=this._posEvent;if(l.x=o,l.y=u,l.dx=s,l.dy=a,void 0!==this.handler.call(void 0,l))throw new Error("Return value must be 'undefined'. Mouse position and movement events cannot be consumed.")}function b(t){return t.preventDefault(),t.stopPropagation(),!1}const E=Symbol("template"),g=Symbol("style");class _ extends HTMLElement{static toInputMap(t){let e={};for(let n of t)if(n instanceof _){let t,i=n.input;switch(i in e?t=e[i]:e[i]=t=[],n.type){case"action":t.push({key:n.key,event:n.event});break;case"range":t.push({key:n.key,scale:n.scale});break;default:throw new Error("Unknown input type.")}}return e}static get[E](){let t=document.createElement("template");return t.innerHTML="\n<kbd></kbd>",Object.defineProperty(this,E,{value:t}),t}static get[g](){let t=document.createElement("style");return t.innerHTML="\n:host {\n    display: inline-block;\n}\nkbd {\n    background-color: #EEEEEE;\n    border-radius: 3px;\n    border: 1px solid #B4B4B4;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;\n    color: #333333;\n    font-size: 0.85em;\n    font-weight: 700;\n    line-height: 1;\n    padding: 2px 4px;\n    white-space: nowrap;\n}\n",Object.defineProperty(this,g,{value:t}),t}static get observedAttributes(){return["input","key","scale","event"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[E].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[g].cloneNode(!0)),this.keyElement=this.shadowRoot.querySelector("kbd")}attributeChangedCallback(t,e,n){switch(t){case"key":this.keyElement.textContent=n}}get type(){return this.hasAttribute("event")?"action":"range"}get input(){return this.getAttribute("input")}set input(t){this.setAttribute("input",t)}get key(){return this.getAttribute("key")}set key(t){this.setAttribute("key",t)}get scale(){return Number(this.getAttribute("scale"))}set scale(t){this.setAttribute("scale",t)}get event(){return this.getAttribute("event")}set event(t){this.setAttribute("event",t)}}window.customElements.define("input-key",_);class A{constructor(t,e){this.inputName=t,this.inputType=e,this.value=0,this._onchange=null,this._eventListeners=new Map}update(t){if(this.value!==t){if(this.value=t,this._eventListeners.has("change"))for(let t of this._eventListeners.get("change"))t.call(void 0,this);return!0}return!1}get onchange(){return this._onchange}set onchange(t){this._onchange&&this.removeEventListener("change",this._onchange),this._onchange=t,this.addEventListener("change",t)}addEventListener(t,e){if(this._eventListeners.has(t)){this._eventListeners.get(t).push(e)}else this._eventListeners.set(t,[e])}removeEventListener(t,e){if(this._eventListeners.has(t)){let n=this._eventListeners.get(t);n.splice(n.indexOf(e),1)}}toString(){return this.value}}class w{constructor(t,e,n){this.keyName=t,this.keyEvent=e,this.scale=n,this.value=0}consumeKey(){this.value=0}updateKey(t,e){if(e===this.keyName)if(this.keyEvent){if(this.keyEvent===t.event)return this.value=t.value*this.scale,!0}else switch(t.event){case"down":return this.value=this.scale,!0;case"up":return this.value=0,!0;default:return void(this.value=t.value*this.scale)}}}const T=Symbol("template"),N=Symbol("style");class x extends HTMLElement{static get[T](){let t=document.createElement("template");return t.innerHTML='\n<table>\n    <thead>\n        <tr class="header">\n            <th id="title" colspan=3>input-context</th>\n            <th id="poll">&nbsp;</th>\n        </tr>\n        <tr class="hint">\n            <th>input</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n<slot></slot>',Object.defineProperty(this,T,{value:t}),t}static get[N](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n}\nslot {\n    display: none;\n}\ntable {\n    border-collapse: collapse;\n}\ntable, th, td {\n    border: 1px solid gray;\n}\n#poll {\n    position: relative;\n    font-size: 0.9em;\n}\n#poll:after {\n    content: "(poll)";\n    position: absolute;\n    left: 0;\n    right: 0;\n    z-index: -1;\n    opacity: 0.1;\n    font-family: monospace;\n    letter-spacing: 3px;\n    overflow: hidden;\n}\n.hint > th {\n    font-size: 0.5em;\n    font-family: monospace;\n    padding: 0 10px;\n    letter-spacing: 3px;\n    background-color: #AAA;\n    color: #666666;\n}\nth, td {\n    padding: 5px 10px;\n}\ntd {\n    text-align: center;\n}\nkbd {\n    display: inline-block;\n    background-color: #EEEEEE;\n    border-radius: 3px;\n    border: 1px solid #B4B4B4;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;\n    color: #333333;\n    font-size: 0.85em;\n    font-weight: 700;\n    line-height: 1;\n    padding: 2px 4px;\n    white-space: nowrap;\n}\noutput {\n    font-family: monospace;\n    border-radius: 0.3em;\n    padding: 3px;\n}\n.flash {\n    animation: fadein 4s;\n}\n@keyframes fadein {\n    0%, 10% { background-color: rgba(0, 0, 255, 0.3); }\n    100% { background-color: rgba(0, 0, 255, 0); }\n}\n',Object.defineProperty(this,N,{value:t}),t}static get observedAttributes(){return["for","strict","onattach","ondetach","id","class"]}constructor(t=null){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[T].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[N].cloneNode(!0)),this._onattach=null,this._ondetach=null,this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._tableBody=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot"),this._tableInputs={},this._lastPollTime=0,this._pollWarningTimeoutHandle=0,this._animationFrameHandle=0,this._inputTarget=null,this._inputMap=t,this._inputs={},this._inputKeys={},this._keys={},this.onInputEvent=this.onInputEvent.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this),t&&L(this,t)}connectedCallback(){if(this.hasAttribute("for")||this.setAttribute("for",""),!this._inputMap){this._inputMap={};const t=_.toInputMap(this._children.assignedNodes()),e=this.src;e?fetch(e).then(t=>t.json()).then(e=>{this._inputMap={...e,...t},L(this,this._inputMap)}):(this._inputMap={...t},L(this,this._inputMap))}this._lastPollTime=0,this._pollWarningTimeoutHandle=setTimeout(()=>{this._lastPollTime<=0?(this._pollElement.textContent="✗",console.warn("[INPUT] No input updated. Did you forget to poll() the input context?")):this._pollElement.textContent="✓"},3e3),this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){cancelAnimationFrame(this._animationFrameHandle),clearTimeout(this._pollWarningTimeoutHandle)}attributeChangedCallback(t,e,n){switch(t){case"for":let t;t=n?document.getElementById(n):document.querySelector("display-port")||document.querySelector("canvas"),this._inputTarget&&this.detach(),t&&this.attach(t);break;case"onattach":this.onattach=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"ondetach":this.ondetach=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`input-context${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get for(){return this.getAttribute("for")}set for(t){this.setAttribute("for",t)}get strict(){return this.hasAttribute("strict")}set strict(t){t?this.setAttribute("strict",""):this.removeAttribute("strict")}get auto(){return this.hasAttribute("auto")}set auto(t){t?this.setAttribute("auto",""):this.removeAttribute("auto")}get onattach(){return this._onattach}set onattach(t){this._onattach&&this.removeEventListener("attach",this._onattach),this._onattach=t,this._onattach&&this.addEventListener("attach",t)}get ondetach(){return this._ondetach}set ondetach(t){this._ondetach&&this.removeEventListener("detach",this._ondetach),this._ondetach=t,this._ondetach&&this.addEventListener("detach",t)}attach(t){if(!t)throw new Error("Cannot attach input context to null.");if(this._inputTarget){if(this._inputTarget!==t)throw new Error("Input context already attached to another element.");return this}let e=t;return e&&(e.canvas?(h.addInputEventListener(e,this.onInputEvent),m.addInputEventListener(e.canvas,this.onInputEvent)):(h.addInputEventListener(e,this.onInputEvent),m.addInputEventListener(e,this.onInputEvent)),this.dispatchEvent(new CustomEvent("attach",{composed:!0,bubbles:!1,detail:{eventTarget:e,inputCallback:this.onInputEvent}}))),this._inputTarget=e,this}detach(){if(!this._inputTarget)return this;let t=this._inputTarget;return this._inputTarget=null,t.canvas?(h.removeInputEventListener(t,this.onInputEvent),m.removeInputEventListener(t.canvas,this.onInputEvent)):(h.removeInputEventListener(t,this.onInputEvent),m.removeInputEventListener(t,this.onInputEvent)),this.dispatchEvent(new CustomEvent("detach",{composed:!0,bubbles:!1,detail:{eventTarget:t,inputCallback:this.onInputEvent}})),this}poll(){this._lastPollTime=performance.now();for(let t in this._inputs){let e=this._inputs[t];switch(e.inputType){case"action":let n=!1;for(let i of this._inputKeys[t]){let t=i.value;if(t){e.update(t,i),i.consumeKey(),n=!0;break}}n||e.update(0,null);break;case"range":let i=0;for(let e of this._inputKeys[t])i+=e.value;e.update(i,null);break;default:throw new Error("Unknown input type.")}}}onInputEvent(t){let e=t.type;switch(e){case"key":{const e=t.device+":"+t.key;if(e in this._keys){let n=!1;for(let i of this._keys[e])i.updateKey(t,e)&&(n=!0);if(n)return!0}}break;case"pos":{const e=["x","y","dx","dy"];for(let n of e){t.value=t[n];const e=t.device+":"+t.key+"."+n;if(e in this._keys){let n=!1;for(let i of this._keys[e])i.updateKey(t,e)&&(n=!0);if(n)return!0}}}break;default:throw new Error(`Unknown input event type '${e}'.`)}}onAnimationFrame(t){this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.auto&&this.poll();for(let t in this._inputs){let e,n=this._inputs[t];e=n.value?Number(n.value).toFixed(2):0;let i=this._tableInputs[t];if(i.textContent!=e){i.textContent=e;let t=i.parentNode;i.parentNode.removeChild(i),t.appendChild(i)}}}getInput(t){if(t in this._inputs)return this._inputs[t];if(this.strict)throw new Error(`Cannot find input with name '${t}'.`);{let e=new A(t,"range");return this._inputs[t]=e,e}}getInputValue(t){if(t in this._inputs)return this._inputs[t].value;if(this.strict)throw new Error(`Cannot find input with name '${t}'.`);return 0}}function L(t,e){for(let n in e){let i=e[n];if(Array.isArray(i))for(let e of i)R(t,n,e),"string"==typeof e&&(e={key:e,event:"down"}),k(t,n,e);else R(t,n,i),"string"==typeof i&&(i={key:i,event:"down"}),k(t,n,i)}}function I(t){if("object"==typeof t){if("type"in t)return t.type;if("scale"in t)return"range";if("event"in t)return"action";throw new Error(`Missing 'scale' or 'event' for input option '${inputName}'.`)}if("string"==typeof t)return"action";throw new Error("Invalid type for input mapping option.")}function k(t,e,n){let i=document.createElement("tr");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),i.appendChild(t)}{let t=document.createElement("td");t.classList.add("key");let e=document.createElement("kbd");e.textContent=n.key,t.appendChild(e),i.appendChild(t)}{let t=document.createElement("td"),e=document.createElement("samp");switch(I(n)){case"action":e.textContent=n.event;break;case"range":e.textContent=Number(n.scale).toFixed(2);break;default:e.textContent="<?>"}t.classList.add("mod"),t.appendChild(e),i.appendChild(t)}if(e in t._tableInputs){let t=document.createElement("td");t.classList.add("value"),i.appendChild(t)}else{let n=document.createElement("td"),r=document.createElement("output");r.textContent=0,r.classList.add("flash"),n.classList.add("value"),n.appendChild(r),i.appendChild(n),t._tableInputs[e]=r}t._tableBody.appendChild(i)}function R(t,e,n){let i=I(n);switch(i){case"action":M(t,e,"string"==typeof n?{key:n,event:"down"}:n);break;case"range":!function(t,e,n){const{key:i,scale:r}=n;let s,a,o;if(e in t._inputs){if(s=t._inputs[e],a=t._inputKeys[e],"range"!==s.inputType)throw new Error(`Cannot register mismatched 'range' type input for '${s.inputType}' type input '${e}'.`)}else s=new A(e,"range"),a=[],t._inputs[e]=s,t._inputKeys[e]=a;i in t._keys?o=t._keys[i]:(o=[],t._keys[i]=o);let u=new w(i,null,r);o.push(u),a.push(u)}(t,e,n);break;default:throw new Error(`Unknown input type '${i}'.`)}}function M(t,e,n){const{key:i,event:r}=n;let s,a,o;if(e in t._inputs){if(s=t._inputs[e],a=t._inputKeys[e],"action"!==s.inputType)throw new Error(`Cannot register mismatched 'action' type input for '${s.inputType}' type input '${e}'.`)}else s=new A(e,"action"),a=[],t._inputs[e]=s,t._inputKeys[e]=a;i in t._keys?o=t._keys[i]:(o=[],t._keys[i]=o);let u=new w(i,r,1);o.push(u),a.push(u)}async function F(t,e){let n=await fetch(t),i=await n.text();{const t=10;for(let e=0;e<t;++e){performance.now();C(i);performance.now()}}{const t=10;for(let e=0;e<t;++e){performance.now();S(i);performance.now()}}return S(i)}function S(t){const e=[],n=[],i=[],r=[],s=[],a=[],o=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,u=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,l=/vt\s+(\S+)\s+(\S+)/g,h=/f\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*))\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*))\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*))(\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*)))?/g,d=/f\s+([^\/\s]+)\s+([^\/\s]+)\s+([^\/\s]+)/g;let p,c,m,f,y,v,b=!1,E=null;for(t=t.replace(/^#.*/g,"");null!=(E=o.exec(t));)p=Number.parseFloat(E[1]),c=Number.parseFloat(E[2]),m=Number.parseFloat(E[3]),e.push(p),e.push(c),e.push(m);for(;null!=(E=u.exec(t));)p=Number.parseFloat(E[1]),c=Number.parseFloat(E[2]),m=Number.parseFloat(E[3]),i.push(p),i.push(c),i.push(m);for(;null!=(E=l.exec(t));)p=Number.parseFloat(E[1]),c=Number.parseFloat(E[2]),n.push(p),n.push(c);for(;null!=(E=h.exec(t));)p=Number.parseInt(E[2]),Number.isNaN(p)&&(p=1),c=Number.parseInt(E[6]),Number.isNaN(c)&&(c=1),m=Number.parseInt(E[10]),Number.isNaN(m)&&(m=1),r.push(p),r.push(c),r.push(m),p=Number.parseInt(E[4]),Number.isNaN(p)?(p=Number.parseInt(E[3]),c=Number.parseInt(E[7]),m=Number.parseInt(E[11]),a.push(p),a.push(c),a.push(m),s.push(1),s.push(1),s.push(1)):(c=Number.parseInt(E[8]),Number.isNaN(c)&&(c=1),m=Number.parseInt(E[12]),Number.isNaN(m)&&(m=1),a.push(p),a.push(c),a.push(m),p=Number.parseInt(E[3]),Number.isNaN(p)&&(p=1),c=Number.parseInt(E[7]),Number.isNaN(c)&&(c=1),m=Number.parseInt(E[11]),Number.isNaN(m)&&(m=1),s.push(p),s.push(c),s.push(m)),void 0!==E[13]&&(f=Number.parseInt(E[15]),Number.isNaN(f)&&(f=1),r.push(f),f=Number.parseInt(E[17]),Number.isNaN(f)?(f=Number.parseInt(E[16]),a.push(f),s.push(1)):(a.push(f),f=Number.parseInt(E[16]),s.push(f)),b=!0);for(;null!=(E=d.exec(t));)p=Number.parseInt(E[2]),c=Number.parseInt(E[6]),m=Number.parseInt(E[10]),r.push(p),r.push(c),r.push(m),s.push(1),s.push(1),s.push(1),a.push(1),a.push(1),a.push(1),void 0!==E[13]&&(f=Number.parseInt(E[14]),r.push(f),s.push(1),a.push(1),b=!0);v=r.length;const g=new Float32Array(3*v);for(let t=0;t<v;++t)y=r[t]-1,g[3*t+0]=e[3*y+0],g[3*t+1]=e[3*y+1],g[3*t+2]=e[3*y+2];v=s.length;const _=new Float32Array(2*v);for(let t=0;t<v;++t)y=s[t]-1,_[2*t+0]=n[2*y+0],_[2*t+1]=n[2*y+1];v=a.length;const A=new Float32Array(3*v);for(let t=0;t<v;++t)y=a[t]-1,A[3*t+0]=i[3*y+0],A[3*t+1]=i[3*y+1],A[3*t+2]=i[3*y+2];v=r.length;const w=new Uint16Array(v);for(let t=0;t<v;++t)w[t]=t;return b&&console.warn("WebGL does not support quad faces, only triangles."),{positions:g,texcoords:_,normals:A,indices:w}}function C(t){const e=[],n=[],i=[],r=[],s=[],a=[],o=/v( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,u=/vn( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,l=/vt( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,h=/f( +([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))?/g,d=/f( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g;let p,c,m,f,y,v,b=!1,E=null;for(t=t.replace(/^#.*/g,"");null!=(E=o.exec(t));)p=Number.parseFloat(E[1]),c=Number.parseFloat(E[2]),m=Number.parseFloat(E[3]),e.push(p),e.push(c),e.push(m);for(;null!=(E=u.exec(t));)p=Number.parseFloat(E[1]),c=Number.parseFloat(E[2]),m=Number.parseFloat(E[3]),i.push(p),i.push(c),i.push(m);for(;null!=(E=l.exec(t));)p=Number.parseFloat(E[1]),c=Number.parseFloat(E[2]),n.push(p),n.push(c);for(;null!=(E=h.exec(t));)p=Number.parseInt(E[2]),Number.isNaN(p)&&(p=1),c=Number.parseInt(E[6]),Number.isNaN(c)&&(c=1),m=Number.parseInt(E[10]),Number.isNaN(m)&&(m=1),r.push(p),r.push(c),r.push(m),p=Number.parseInt(E[3]),Number.isNaN(p)&&(p=1),c=Number.parseInt(E[7]),Number.isNaN(c)&&(c=1),m=Number.parseInt(E[11]),Number.isNaN(m)&&(m=1),s.push(p),s.push(c),s.push(m),p=Number.parseInt(E[4]),Number.isNaN(p)&&(p=1),c=Number.parseInt(E[8]),Number.isNaN(c)&&(c=1),m=Number.parseInt(E[12]),Number.isNaN(m)&&(m=1),a.push(p),a.push(c),a.push(m),void 0!==E[13]&&(f=Number.parseInt(E[14]),Number.isNaN(f)&&(f=1),r.push(f),f=Number.parseInt(E[15]),Number.isNaN(f)&&(f=1),s.push(f),f=Number.parseInt(E[16]),Number.isNaN(f)&&(f=1),a.push(f),b=!0);for(;null!=(E=d.exec(t));)p=Number.parseInt(E[2]),c=Number.parseInt(E[6]),m=Number.parseInt(E[10]),r.push(p),r.push(c),r.push(m),s.push(1),s.push(1),s.push(1),a.push(1),a.push(1),a.push(1),void 0!==E[13]&&(f=Number.parseInt(E[14]),r.push(f),s.push(1),a.push(1),b=!0);v=r.length;const g=new Float32Array(3*v);for(let t=0;t<v;++t)y=r[t]-1,g[3*t+0]=e[3*y+0],g[3*t+1]=e[3*y+1],g[3*t+2]=e[3*y+2];v=s.length;const _=new Float32Array(2*v);for(let t=0;t<v;++t)y=s[t]-1,_[2*t+0]=n[2*y+0],_[2*t+1]=n[2*y+1];v=a.length;const A=new Float32Array(3*v);for(let t=0;t<v;++t)y=a[t]-1,A[3*t+0]=i[3*y+0],A[3*t+1]=i[3*y+1],A[3*t+2]=i[3*y+2];v=r.length;const w=new Uint16Array(v);for(let t=0;t<v;++t)w[t]=t;return b&&console.warn("WebGL does not support quad faces, only triangles."),{positions:g,texcoords:_,normals:A,indices:w}}window.customElements.define("input-context",x);var U=Object.freeze({__proto__:null,loadOBJ:F});let P={};function B(t,e){P[t]=e}function O(t){if(t in P)return P[t];throw new Error(`Unknown asset type '${t}'.`)}async function D(t,e={},n="."){if(t.indexOf(":")<0)throw new Error("Missing type for asset source.");let[i,r]=t.split(":"),s=O(i);return await s(n+"/"+r,e)}B("image",(async function(t,e){return new Promise((e,n)=>{let i=new Image;i.addEventListener("load",()=>{e(i)}),i.addEventListener("error",t=>{n(t)}),i.src=t})})),B("text",(async function(t,e){return(await fetch(t)).text()})),B("json",(async function(t,e){let n=await fetch(t);return await n.json()})),B("bytes",(async function(t,e){let n=await fetch(t);return await n.arrayBuffer()})),B("obj",F);var z=Object.freeze({__proto__:null,defineAssetLoader:B,getAssetLoader:O,loadAssetMap:async function(t,e="."){let n={};for(let i of Object.keys(t)){let r=t[i];if("string"==typeof r)n[i]=await D(r,void 0,e);else{if("object"!=typeof r)throw new Error("Unknown entry type in asset map.");if(!("src"in r))throw new Error("Missing required field 'src' for entry in asset map.");if("name"in r&&r.name!==i)throw new Error(`Cannot redefine name for asset '${i}' for entry in asset map.`);n[i]=await D(r.src,r,e)}}return n},loadAssetList:async function(t,e="."){let n={};for(let i of t)if("string"==typeof i)n[i]=await D(i,void 0,e);else{if("object"!=typeof i)throw new Error("Unknown entry type in asset list.");if(!("src"in i))throw new Error("Missing required field 'src' for entry in asset list.");n["name"in i?i.name:i.src]=await D(i.src,i,e)}return n},loadAsset:D});!async function(t){document.addEventListener("click",()=>{"suspended"===t.state&&t.resume()})}(new AudioContext);const H=Math.PI/180;function K(t){return t*H}var q=1e-6,$="undefined"!=typeof Float32Array?Float32Array:Array;function G(){var t=new $(16);return $!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function j(t,e,n){var i,r,s,a,o,u,l,h,d,p,c,m,f=n[0],y=n[1],v=n[2];return e===t?(t[12]=e[0]*f+e[4]*y+e[8]*v+e[12],t[13]=e[1]*f+e[5]*y+e[9]*v+e[13],t[14]=e[2]*f+e[6]*y+e[10]*v+e[14],t[15]=e[3]*f+e[7]*y+e[11]*v+e[15]):(i=e[0],r=e[1],s=e[2],a=e[3],o=e[4],u=e[5],l=e[6],h=e[7],d=e[8],p=e[9],c=e[10],m=e[11],t[0]=i,t[1]=r,t[2]=s,t[3]=a,t[4]=o,t[5]=u,t[6]=l,t[7]=h,t[8]=d,t[9]=p,t[10]=c,t[11]=m,t[12]=i*f+o*y+d*v+e[12],t[13]=r*f+u*y+p*v+e[13],t[14]=s*f+l*y+c*v+e[14],t[15]=a*f+h*y+m*v+e[15]),t}function X(t,e,n,i){var r,s,a,o,u,l,h,d,p,c,m,f,y,v,b,E,g,_,A,w,T,N,x,L,I=i[0],k=i[1],R=i[2],M=Math.hypot(I,k,R);return M<q?null:(I*=M=1/M,k*=M,R*=M,r=Math.sin(n),a=1-(s=Math.cos(n)),o=e[0],u=e[1],l=e[2],h=e[3],d=e[4],p=e[5],c=e[6],m=e[7],f=e[8],y=e[9],v=e[10],b=e[11],E=I*I*a+s,g=k*I*a+R*r,_=R*I*a-k*r,A=I*k*a-R*r,w=k*k*a+s,T=R*k*a+I*r,N=I*R*a+k*r,x=k*R*a-I*r,L=R*R*a+s,t[0]=o*E+d*g+f*_,t[1]=u*E+p*g+y*_,t[2]=l*E+c*g+v*_,t[3]=h*E+m*g+b*_,t[4]=o*A+d*w+f*T,t[5]=u*A+p*w+y*T,t[6]=l*A+c*w+v*T,t[7]=h*A+m*w+b*T,t[8]=o*N+d*x+f*L,t[9]=u*N+p*x+y*L,t[10]=l*N+c*x+v*L,t[11]=h*N+m*x+b*L,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Y(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function V(t,e,n){var i,r,s,a=n[0],o=n[1],u=n[2],l=Math.hypot(a,o,u);return l<q?null:(a*=l=1/l,o*=l,u*=l,i=Math.sin(e),s=1-(r=Math.cos(e)),t[0]=a*a*s+r,t[1]=o*a*s+u*i,t[2]=u*a*s-o*i,t[3]=0,t[4]=a*o*s-u*i,t[5]=o*o*s+r,t[6]=u*o*s+a*i,t[7]=0,t[8]=a*u*s+o*i,t[9]=o*u*s-a*i,t[10]=u*u*s+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function W(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function J(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Q(){var t=new $(3);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Z(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function tt(t,e,n){var i=e[0],r=e[1],s=e[2],a=n[3]*i+n[7]*r+n[11]*s+n[15];return a=a||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/a,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/a,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/a,t}function et(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var nt;nt=Q();let it=null;function rt(t,e){return it||(it=function(t){let e={};if(!(t instanceof WebGLRenderingContext))throw new Error("Unknown gl context provided.");e[t.FLOAT]={TypedArray:Float32Array,size:4,uniform:t.uniform1f,arrayUniform:t.uniform1fv},e[t.FLOAT_VEC2]={TypedArray:Float32Array,size:8,uniform:t.uniform2fv,arrayType:t.FLOAT},e[t.FLOAT_VEC3]={TypedArray:Float32Array,size:12,uniform:t.uniform3fv,arrayType:t.FLOAT},e[t.FLOAT_VEC4]={TypedArray:Float32Array,size:16,uniform:t.uniform4fv,arrayType:t.FLOAT},e[t.INT]={TypedArray:Int32Array,size:4,uniform:t.uniform1i,arrayUniform:t.uniform1iv},e[t.INT_VEC2]={TypedArray:Int32Array,size:8,uniform:t.uniform2iv,arrayType:t.INT},e[t.INT_VEC3]={TypedArray:Int32Array,size:12,uniform:t.uniform3iv,arrayType:t.INT},e[t.INT_VEC4]={TypedArray:Int32Array,size:16,uniform:t.uniform4iv,arrayType:t.INT},e[t.UNSIGNED_INT]={TypedArray:Uint32Array,size:4,uniform:t.uniform1ui,arrayUniform:t.uniform1uiv},e[t.UNSIGNED_INT_VEC2]={TypedArray:Uint32Array,size:8,uniform:t.uniform2uiv,arrayType:t.UNSIGNED_INT},e[t.UNSIGNED_INT_VEC3]={TypedArray:Uint32Array,size:12,uniform:t.uniform3uiv,arrayType:t.UNSIGNED_INT},e[t.UNSIGNED_INT_VEC4]={TypedArray:Uint32Array,size:16,uniform:t.uniform4uiv,arrayType:t.UNSIGNED_INT},e[t.BOOL]={TypedArray:Uint32Array,size:4,uniform:t.uniform1i,arrayUniform:t.uniform1iv},e[t.BOOL_VEC2]={TypedArray:Uint32Array,size:8,uniform:t.uniform2iv,arrayType:t.BOOL},e[t.BOOL_VEC3]={TypedArray:Uint32Array,size:12,uniform:t.uniform3iv,arrayType:t.BOOL},e[t.BOOL_VEC4]={TypedArray:Uint32Array,size:16,uniform:t.uniform4iv,arrayType:t.BOOL},e[t.FLOAT_MAT2]={TypedArray:Float32Array,size:16,uniform:lt,arrayType:t.FLOAT},e[t.FLOAT_MAT3]={TypedArray:Float32Array,size:36,uniform:ht,arrayType:t.FLOAT},e[t.FLOAT_MAT4]={TypedArray:Float32Array,size:64,uniform:dt,arrayType:t.FLOAT},e[t.UNSIGNED_BYTE]={TypedArray:Uint8Array,size:1},e[t.UNSIGNED_SHORT]={TypedArray:Uint16Array,size:2};"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?(e[t.FLOAT_MAT2x3]={TypedArray:Float32Array,size:24,uniform:pt,arrayType:t.FLOAT},e[t.FLOAT_MAT2x4]={TypedArray:Float32Array,size:32,uniform:mt,arrayType:t.FLOAT},e[t.FLOAT_MAT3x2]={TypedArray:Float32Array,size:24,uniform:ct,arrayType:t.FLOAT},e[t.FLOAT_MAT3x4]={TypedArray:Float32Array,size:48,uniform:yt,arrayType:t.FLOAT},e[t.FLOAT_MAT4x2]={TypedArray:Float32Array,size:32,uniform:ft,arrayType:t.FLOAT},e[t.FLOAT_MAT4x3]={TypedArray:Float32Array,size:48,uniform:vt,arrayType:t.FLOAT},ut(t,e,gt,_t)):ut(t,e,bt,Et);return e}(t)),it[e]}function st(t,e){return"sampler"in rt(t,e)}function at(t,e){return rt(t,e).uniform}function ot(t,e,n){let i=rt(t,e);return i.sampler(i.bindPoint,n)}function ut(t,e,n,i){return e[t.SAMPLER_2D]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D},e[t.SAMPLER_CUBE]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_CUBE_MAP},e[t.SAMPLER_3D]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_3D},e[t.SAMPLER_2D_SHADOW]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D},e[t.SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D_ARRAY},e[t.SAMPLER_2D_ARRAY_SHADOW]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D_ARRAY},e[t.SAMPLER_CUBE_SHADOW]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_CUBE_MAP},e[t.INT_SAMPLER_2D]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D},e[t.INT_SAMPLER_3D]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_3D},e[t.INT_SAMPLER_CUBE]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_CUBE_MAP},e[t.INT_SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D_ARRAY},e[t.UNSIGNED_INT_SAMPLER_2D]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D},e[t.UNSIGNED_INT_SAMPLER_3D]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_3D},e[t.UNSIGNED_INT_SAMPLER_CUBE]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_CUBE_MAP},e[t.UNSIGNED_INT_SAMPLER_2D_ARRAY]={TypedArray:null,size:0,sampler:n,arraySampler:i,bindPoint:t.TEXTURE_2D_ARRAY},e}function lt(t,e){this.uniformMatrix2fv(t,!1,e)}function ht(t,e){this.uniformMatrix3fv(t,!1,e)}function dt(t,e){this.uniformMatrix4fv(t,!1,e)}function pt(t,e){this.uniformMatrix2x3fv(t,!1,e)}function ct(t,e){this.uniformMatrix3x2fv(t,!1,e)}function mt(t,e){this.uniformMatrix2x4fv(t,!1,e)}function ft(t,e){this.uniformMatrix4x2fv(t,!1,e)}function yt(t,e){this.uniformMatrix3x4fv(t,!1,e)}function vt(t,e){this.uniformMatrix4x3fv(t,!1,e)}function bt(t,e){return function(n,i){this.uniform1i(n,e),this.activeTexture(this.TEXTURE0+e),this.bindTexture(t,i)}}function Et(t,e,n){const i=new Int32Array(n);for(let t=0;t<n;++t)i[t]=e+t;return function(e,n){this.uniform1iv(e,i),n.forEach((function(e,n){this.activeTexture(this.TEXTURE0+i[n]),this.bindTexture(t,e)}))}}function gt(t,e){return function(n,i){let r,s;i instanceof WebGLTexture?(r=i,s=null):(r=i.texture,s=i.sampler),this.uniform1i(n,e),this.activeTexture(this.TEXTURE0+e),this.bindTexture(t,r),this.bindSampler(e,s)}}function _t(t,e,n){const i=new Int32Array(n);for(let t=0;t<n;++t)i[t]=e+t;return function(n,r){this.uniform1iv(n,i),r.forEach((function(n,r){let s,a;this.activeTexture(this.TEXTURE0+i[r]),n instanceof WebGLTexture?(s=n,a=null):(s=n.texture,a=n.sampler),this.bindSampler(e,a),this.bindTexture(t,s)}))}}function At(t,e,n=[],i=t.STATIC_DRAW){const{TypedArray:r}=rt(t,e);let s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),n instanceof r?t.bufferData(t.ARRAY_BUFFER,n,i):t.bufferData(t.ARRAY_BUFFER,new r(n),i),{handle:s,type:e,target:t.ARRAY_BUFFER,length:n.length}}function wt(t,e=[],n=t.STATIC_DRAW){const{TypedArray:i}=rt(t,t.UNSIGNED_SHORT);let r=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),e instanceof i?t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,n):t.bufferData(t.ELEMENT_ARRAY_BUFFER,new i(e),n),{handle:r,type:t.UNSIGNED_SHORT,target:t.ELEMENT_ARRAY_BUFFER,length:e.length}}class Tt extends class{constructor(t){this.handle=t.createProgram(),this.shaders=[],this.gl=t}shader(t,e){let n=function(t,e,n){let i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.error(t.getShaderInfoLog(i)),t.deleteShader(i)}(this.gl,t,e);return this.shaders.push(n),this}link(t){return function(t,e,n){for(let i of n)t.attachShader(e,i);t.linkProgram(e);for(let i of n)t.detachShader(e,i),t.deleteShader(i);if(t.getProgramParameter(e,t.LINK_STATUS))return e;console.error(t.getProgramInfoLog(e)),t.deleteProgram(e)}(t,this.handle,this.shaders),this.shaders.length=0,this.handle}}{link(t){return super.link(t),new Nt(t,this.handle)}}class Nt{constructor(t,e){this.handle=e,this.activeUniforms=function(t,e){let n={},i=function(t,e){let n=[];const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){let i=t.getActiveUniform(e,r);if(!i)break;n.push(i)}return n}(t,e);for(let r of i){let i,s=r.type,a=r.name,o=r.size,u=t.getUniformLocation(e,a);if(st(t,s)){let e=ot(t,s,0);throw i=function(t,n,i){e.call(t,n,i)},new Error("Samplers are not yet supported.")}{let e=at(t,s);i=function(t,n,i){e.call(t,n,i)}}n[a]={type:s,length:o,location:u,set:i}}return n}(t,e),this.activeAttributes=function(t,e){let n={},i=function(t,e){let n=[];const i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;++r){let i=t.getActiveAttrib(e,r);i&&n.push(i)}return n}(t,e);for(let r of i){let i=r.type,s=r.name,a=r.size,o=t.getAttribLocation(e,s);n[s]={type:i,length:a,location:o}}return n}(t,e),this.drawContext=new xt(this)}bind(t){return t.useProgram(this.handle),this.drawContext.gl=t,this.drawContext}}class xt{constructor(t){this.parent=t,this.gl=null}uniform(t,e){const n=this.gl,i=this.parent.activeUniforms;if(t in i){let r=i[t],s=r.location;r.set(n,s,e)}return this}attribute(t,e,n,i=!1,r=0,s=0){const a=this.gl,o=this.parent.activeAttributes;if(t in o){let u=o[t],l=u.location;if(e){let t=function(t,e){let n=rt(t,e);return"arrayType"in n?n.arrayType:e}(a,u.type);a.bindBuffer(a.ARRAY_BUFFER,e),a.vertexAttribPointer(l,n,t,i,r,s),a.enableVertexAttribArray(l)}else a.disableVertexAttribArray(l)}return this}draw(t,e,n,i,r=null){return function(t,e,n,i,r=null){r?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.drawElements(e,i,t.UNSIGNED_SHORT,n)):t.drawArrays(e,n,i)}(t,e,n,i,r),this.parent}}function Lt(t){const e=t.canvas.width/t.canvas.height,{near:n,far:i}=t.clippingPlane;!function(t,e,n,i,r){var s,a=1/Math.tan(e/2);t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(s=1/(i-r),t[10]=(r+i)*s,t[14]=2*r*i*s):(t[10]=-1,t[14]=-2*i)}(t.projectionMatrix,t.fieldOfView,e,n,i)}const It=Math.PI/2;function kt(t=1,e=1,n=1,i=!0,r=!0,s=!0,a=!0,o=!0,u=!0){const l=.5*t,h=.5*e,d=.5*n,p=!0;let c=G(),m=[];if(i){const n=Rt(t,e,p);Y(c,[0,0,d]),St(c,n),m.push(n)}if(s){const e=Rt(t,n,p);W(c,-It),j(c,c,[0,0,h]),St(c,e),m.push(e)}if(r){const n=Rt(t,e,p);J(c,Math.PI),j(c,c,[0,0,d]),St(c,n),m.push(n)}if(a){const e=Rt(t,n,p);W(c,It),j(c,c,[0,0,h]),St(c,e),m.push(e)}if(o){const t=Rt(n,e,p);J(c,-It),j(c,c,[0,0,l]),St(c,t),m.push(t)}if(u){const t=Rt(n,e,p);J(c,It),j(c,c,[0,0,l]),St(c,t),m.push(t)}return Ct(...m)}function Rt(t=1,e=1,n=!0){const i=Mt(0,0,0,t,e);if(n){const n=Mt(0,0,0,t,e);return St(J(G(),Math.PI),n),Ct(i,n)}return i}function Mt(t=0,e=0,n=0,i=1,r=1){const s=.5*i,a=.5*r;return Ft([t-s,e-a,n,t+s,e-a,n,t-s,e+a,n,t+s,e+a,n],[0,0,1,0,0,1,1,1],[0,0,1,0,0,1,0,0,1,0,0,1],[0,1,2,2,1,3])}function Ft(t,e,n,i){return{positions:t,texcoords:e,normals:n,indices:i}}function St(t,e){const n=e.positions,i=e.normals,r=(s=new $(9),$!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s);var s;!function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],u=e[6],l=e[7],h=e[8],d=e[9],p=e[10],c=e[11],m=e[12],f=e[13],y=e[14],v=e[15],b=n*o-i*a,E=n*u-r*a,g=n*l-s*a,_=i*u-r*o,A=i*l-s*o,w=r*l-s*u,T=h*f-d*m,N=h*y-p*m,x=h*v-c*m,L=d*y-p*f,I=d*v-c*f,k=p*v-c*y,R=b*k-E*I+g*L+_*x-A*N+w*T;R&&(R=1/R,t[0]=(o*k-u*I+l*L)*R,t[1]=(u*x-a*k-l*N)*R,t[2]=(a*I-o*x+l*T)*R,t[3]=(r*I-i*k-s*L)*R,t[4]=(n*k-r*x+s*N)*R,t[5]=(i*x-n*I-s*T)*R,t[6]=(f*w-y*A+v*_)*R,t[7]=(y*g-m*w-v*E)*R,t[8]=(m*A-f*g+v*b)*R)}(r,t);const a=Q();for(let e=0;e<n.length;e+=3)a[0]=n[e+0],a[1]=n[e+1],a[2]=n[e+2],tt(a,a,t),n[e+0]=a[0],n[e+1]=a[1],n[e+2]=a[2],a[0]=i[e+0],a[1]=i[e+1],a[2]=i[e+2],et(a,a,r),i[e+0]=a[0],i[e+1]=a[1],i[e+2]=a[2];return e}function Ct(...t){const e=[],n=[],i=[],r=[];let s=0;for(const a of t)e.push(...a.positions),n.push(...a.texcoords),i.push(...a.normals),r.push(...a.indices.map(t=>t+s)),s+=Math.floor(a.positions.length/3);return Ft(e,n,i,r)}function Ut(t,e,n,i,r,s=i.transform){e.bind(t).uniform("u_projection",n.projectionMatrix).uniform("u_view",n.viewMatrix).uniform("u_model",s).uniform("u_color",r).attribute("a_position",i.buffers.positions.handle,3).attribute("a_texcoord",i.buffers.texcoords.handle,2).attribute("a_normal",i.buffers.normals.handle,3).draw(t,t.TRIANGLES,0,i.buffers.indices.length,i.buffers.indices.handle)}function Pt(t,e){return{buffers:Bt(t,e),transform:G()}}function Bt(t,e){return{positions:At(t,t.FLOAT,e.positions),texcoords:At(t,t.FLOAT,e.texcoords),normals:At(t,t.FLOAT,e.normals),indices:wt(t,e.indices)}}document.addEventListener("DOMContentLoaded",(async function(){const t=document.querySelector("display-port"),e=(document.querySelector("input-context"),t.canvas.getContext("webgl"));if(!e)throw new Error("Your browser does not support webgl.");e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE);const n=await z.loadAsset("text:main.vert"),i=await z.loadAsset("text:main.frag"),r=function(t){return new Tt(t)}(e).shader(e.VERTEX_SHADER,n).shader(e.FRAGMENT_SHADER,i).link(e),s=function(t,e=K(40),n=.1,i=1e3){let r={canvas:t,fieldOfView:e,clippingPlane:{near:n,far:i},_position:Q(),_up:Q(),get position(){return Z(this._position,this.viewMatrix[12],this.viewMatrix[13],this.viewMatrix[14])},get up(){return Z(this._up,0,1,0)},projectionMatrix:G(),viewMatrix:G(),destroy(){t.removeEventListener("resize",this.onResize)},onResize(){Lt(this)}};return t.addEventListener("resize",r.onResize),Lt(r),r}(e.canvas);Y(s.viewMatrix,[0,0,-20]),a=s.viewMatrix,o=s.viewMatrix,u=Math.PI/8,l=Math.sin(u),h=Math.cos(u),d=o[4],p=o[5],c=o[6],m=o[7],f=o[8],y=o[9],v=o[10],b=o[11],o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=d*h+f*l,a[5]=p*h+y*l,a[6]=c*h+v*l,a[7]=m*h+b*l,a[8]=f*h-d*l,a[9]=y*h-p*l,a[10]=v*h-c*l,a[11]=b*h-m*l,function(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],a=e[1],o=e[2],u=e[3],l=e[8],h=e[9],d=e[10],p=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-l*i,t[1]=a*r-h*i,t[2]=o*r-d*i,t[3]=u*r-p*i,t[8]=s*i+l*r,t[9]=a*i+h*r,t[10]=o*i+d*r,t[11]=u*i+p*r}(s.viewMatrix,s.viewMatrix,Math.PI/8);var a,o,u,l,h,d,p,c,m,f,y,v,b;const E=kt(1,1,1),g=Pt(e,E),_=Pt(e,kt(10,10,10,!1)),A=await z.loadAsset("obj:webgl/cube.obj"),w=Pt(e,A);V(w.transform,K(90),[0,1,1]);const T=await U.loadOBJ("webgl/astro2.obj"),N=Pt(e,T);V(N.transform,K(90),[0,1,1]),t.addEventListener("frame",t=>{const n=t.detail.deltaTime/1e3;e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),X(w.transform,w.transform,1*n,[1,1,1]),X(N.transform,N.transform,1*n,[1,1,1]),Ut(e,r,s,_,[.5,1,0,1]),Ut(e,r,s,g,[.5,1,0,1]),Ut(e,r,s,w,[0,1,.5,1],j(G(),w.transform,[0,4,0])),Ut(e,r,s,N,[0,.5,1,1],j(G(),N.transform,[0,-4,0]))})}))}();
