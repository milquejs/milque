!function(){"use strict";var e=1e-6,t="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var e=new t(16);return t!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function s(e,t){var n=t[0],s=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],u=t[7],h=t[8],c=t[9],d=t[10],p=t[11],m=t[12],f=t[13],b=t[14],v=t[15],_=n*a-s*o,E=n*l-i*o,g=n*u-r*o,y=s*l-i*a,w=s*u-r*a,A=i*u-r*l,S=h*f-c*m,N=h*b-d*m,T=h*v-p*m,x=c*b-d*f,L=c*v-p*f,M=d*v-p*b,I=_*M-E*L+g*x+y*T-w*N+A*S;return I?(I=1/I,e[0]=(a*M-l*L+u*x)*I,e[1]=(i*L-s*M-r*x)*I,e[2]=(f*A-b*w+v*y)*I,e[3]=(d*w-c*A-p*y)*I,e[4]=(l*T-o*M-u*N)*I,e[5]=(n*M-i*T+r*N)*I,e[6]=(b*g-m*A-v*E)*I,e[7]=(h*A-d*g+p*E)*I,e[8]=(o*L-a*T+u*S)*I,e[9]=(s*T-n*L-r*S)*I,e[10]=(m*w-f*g+v*_)*I,e[11]=(c*g-h*w-p*_)*I,e[12]=(a*N-o*x-l*S)*I,e[13]=(n*x-s*N+i*S)*I,e[14]=(f*E-m*y-b*_)*I,e[15]=(h*y-c*E+d*_)*I,e):null}function i(){var e=new t(3);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function r(e,n,s){var i=new t(3);return i[0]=e,i[1]=n,i[2]=s,i}function o(e,t,n,s){return e[0]=t,e[1]=n,e[2]=s,e}function a(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function l(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function u(e,t){var n=t[0],s=t[1],i=t[2],r=n*n+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function h(e,t,n){var s=t[0],i=t[1],r=t[2],o=n[0],a=n[1],l=n[2];return e[0]=i*l-r*a,e[1]=r*o-s*l,e[2]=s*a-i*o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function c(e,t,n){var s=t[0],i=t[1],r=t[2],o=t[3];return e[0]=n[0]*s+n[4]*i+n[8]*r+n[12]*o,e[1]=n[1]*s+n[5]*i+n[9]*r+n[13]*o,e[2]=n[2]*s+n[6]*i+n[10]*r+n[14]*o,e[3]=n[3]*s+n[7]*i+n[11]*r+n[15]*o,e}function d(){var e=new t(4);return t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}i(),function(){var e,n=(e=new t(4),t!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();var p;i(),r(1,0,0),r(0,1,0),d(),d(),p=new t(9),t!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1;const m="noscale";class f extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div class="container">\r\n    <label class="hidden" id="title">display-port</label>\r\n    <label class="hidden" id="fps">00</label>\r\n    <label class="hidden" id="dimension">0x0</label>\r\n    <canvas></canvas>\r\n    <slot></slot>\r\n</div>',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block;color:#555}.container{display:flex;position:relative;width:100%;height:100%}canvas{background:#000;margin:auto;-ms-interpolation-mode:nearest-neighbor;image-rendering:-moz-crisp-edges;image-rendering:pixelated}label{font-family:monospace;color:currentColor;position:absolute}#title{left:.5rem;top:.5rem}#fps{right:.5rem;top:.5rem}#dimension{left:.5rem;bottom:.5rem}.hidden{display:none}:host([debug]) .container{outline:6px dashed rgba(0,0,0,.1);outline-offset:-4px;background-color:rgba(0,0,0,.1)}:host([mode=noscale]) canvas{margin:0;top:0;left:0}:host([mode=center]),:host([mode=fit]),:host([mode=stretch]){width:100%;height:100%}:host([full]){width:100vw!important;height:100vh!important}:host([disabled]){display:none}slot{display:flex;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}::slotted(*){pointer-events:auto}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get observedAttributes(){return["onframe","width","height","disabled","debug","id","class"]}static get properties(){return{width:Number,height:Number,disabled:Boolean,debug:Boolean,mode:{type:String,value:"fit",observed:!1}}}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}static get customEvents(){return["frame"]}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onframe")){let e=this.onframe;delete this.onframe,this.onframe=e}if(Object.prototype.hasOwnProperty.call(this,"width")){let e=this.width;delete this.width,this.width=e}if(Object.prototype.hasOwnProperty.call(this,"height")){let e=this.height;delete this.height,this.height=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}if(Object.prototype.hasOwnProperty.call(this,"debug")){let e=this.debug;delete this.debug,this.debug=e}if(Object.prototype.hasOwnProperty.call(this,"mode")){let e=this.mode;delete this.mode,this.mode=e}this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,n){switch(e){case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"disabled":this._disabled=null!==n;break;case"debug":this._debug=null!==n;break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}})(e,0,n)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===m){let e=`${this._width}x${this._height}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}else{let e=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==e&&(this._dimensionElement.innerText=e)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:t,canvas:this._canvasElement},bubbles:!1,composed:!0}))}updateCanvasSize(){let e=this.shadowRoot.host.getBoundingClientRect();const t=e.width,n=e.height;let s=this._canvasElement,i=this._width,r=this._height;const o=this.mode;if("stretch"===o)i=t,r=n;else if(o!==m){if(t<i||n<r||"fit"===o){let e=t/i,s=n/r;e<s?(i=t,r*=e):(i*=s,r=n)}}i=Math.floor(i),r=Math.floor(r),s.clientWidth===i&&s.clientHeight===r||(s.width=this._width,s.height=this._height,s.style=`width: ${i}px; height: ${r}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:i,height:r},bubbles:!1,composed:!0})))}}window.customElements.define("display-port",f);const b=1,v=2,_=3,E={NULL:0,DOWN:1,UP:2,MOVE:3,parse(e){if("string"!=typeof e)return E.NULL;switch(e.toLowerCase()){case"down":return E.DOWN;case"up":return E.UP;case"move":return E.MOVE;default:return E.NULL}}},g="*";class y{static isAxis(e){return!1}static isButton(e){return!1}constructor(e,t){this.deviceName=e,this.eventTarget=t,this.listeners={}}destroy(){this.listeners={}}addInputListener(e,t){let n=this.listeners[e];n?n.push(t):(n=[t],this.listeners[e]=n)}removeInputListener(e,t){let n=this.listeners[e];n&&(n.indexOf(t),n.splice(t,1))}dispatchInput(e){const{keyCode:t}=e,n=this.listeners[t];let s=!1;if(n){for(let t of n)s|=t(e);return s}for(let t of this.listeners["*"])s|=t(e);return s}}class w{static createAdapter(e,t,n,s,i,r){return{target:e,adapterId:t,deviceName:n,keyCode:s,scale:i,eventCode:r}}constructor(){this.adapters={"*":A()}}add(e){for(let t of e){const{deviceName:e,keyCode:n}=t;let s;e in this.adapters?s=this.adapters[e]:(s=A(),this.adapters[e]=s),n in s?s[n].push(t):s[n]=[t]}}delete(e){for(let t of e){const{deviceName:e,keyCode:n}=t;if(e in this.adapters){let s=this.adapters[e];if(n in s){let e=s[n],i=e.indexOf(t);i>=0&&e.splice(i,1)}}}}clear(){for(let e in this.adapters)this.adapters[e]=A()}poll(e,t,n){const s=this.findAdapters(e,t);for(let e of s){const t=e.eventCode;if(t===E.NULL){const{target:t,scale:s}=e,i=n.value*s;t.poll(i,e)}else{const{target:s,scale:i}=e,r=n.getEvent(t)*i;s.poll(r,e)}}return s.length>0}update(e,t,n){let s=!1;for(let i of this.findAdapters(e,t)){const e=i.eventCode;if(e!==E.NULL){const{target:t,scale:r}=i,o=n.getEvent(e)*r;t.update(o,i),s=!0}}return s}reset(e,t,n){let s=!1;for(let n of this.findAdapters(e,t))n.target.reset(),s=!0;return s}findAdapters(e,t){let n=[];if(e in this.adapters){let s=this.adapters[e];t in s&&n.push(...s[t]),n.push(...s["*"])}let s=this.adapters["*"];return t in s&&n.push(...s[t]),n.push(...s["*"]),n}}function A(){return{[g]:[]}}class S{constructor(){this.value=0}update(e){this.value=e}poll(){this.value=0}getEvent(e){return 0}getState(){return this.value}}class N extends S{constructor(){super(),this.update=this.update.bind(this),this.adapters=[],this.values=[],this.next={values:[],value:0}}hydrate(e){Array.isArray(e)||(e=[e]);let t=[],n=0;for(let s of e){"string"==typeof s&&(s={key:s});const{key:e,scale:i=1,event:r="null"}=s,{deviceName:o,keyCode:a}=T(e),l=E.parse(r),u=Number(i);let h=w.createAdapter(this,n,o,a,u,l);t.push(h),++n}this.adapters=t,this.values=new Array(t.length).fill(0),this.next={values:new Array(t.length).fill(0),value:0}}poll(e,t){const n=t.adapterId;let s=this.values[n];this.values[n]=e,this.value=this.value-s+e,this.next.values[n]=0,this.next.value+=e-s}update(e,t){const n=t.adapterId;let s=this.next.values[n];this.next.values[n]=e,this.next.value+=e-s}reset(){this.values.fill(0),this.value=0,this.next.values.fill(0),this.next.value=0}}function T(e){let t=e.indexOf(":");if(t>=0)return{deviceName:e.substring(0,t),keyCode:e.substring(t+1)};throw new Error("Invalid key string - missing device separator ':'.")}function x(e,t){return`${e}:${t}`}class L extends S{constructor(){super(),this.delta=0,this.next={delta:0}}update(e,t){this.value=e,this.next.delta+=t}poll(){this.delta=this.next.delta,this.next.delta=0}getEvent(e){switch(e){case E.MOVE:return this.delta;default:return super.getEvent(e)}}}class M extends S{constructor(){super(),this.down=!1,this.up=!1,this.next={down:!1,up:!1}}update(e){e?this.next.down=!0:this.next.up=!0}poll(){const{up:e,down:t}=this.next;this.value?this.up&&!e&&(this.value=0):t&&(this.value=1),this.down=t,this.up=e,this.next.down=!1,this.next.up=!1}getEvent(e){switch(e){case E.DOWN:return 1&this.down;case E.UP:return 1&this.up;default:return super.getEvent(e)}}}const I=1,R=2;class O{constructor(e){this.onInputEvent=this.onInputEvent.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this);let t={},n={};for(let s of e){const e=s.deviceName;if(e in t)throw new Error(`Another device with name '${e}' already exists.`);t[e]=s,n[e]={},s.addInputListener(g,this.onInputEvent)}this.devices=t,this.keySources=n,this.listeners={poll:[],update:[]},this._autopoll=!1,this._animationFrameHandle=null}destroy(){this.clearKeySources();for(let e in this.devices){let t=this.devices[e];t.removeInputListener(g,this.onInputEvent),t.destroy()}this.devices={}}poll(e=performance.now()){for(const e in this.keySources){const t=this.keySources[e];for(const n in t){let s=t[n];s.poll(),this.dispatchInputEvent(R,e,n,s)}}this.dispatchPollEvent(e)}addEventListener(e,t){e in this.listeners?this.listeners[e].unshift(t):this.listeners[e]=[t]}removeEventListener(e,t){if(e in this.listeners){let n=this.listeners[e],s=n.indexOf(t);n.splice(s,1)}}countEventListeners(e){if(!(e in this.listeners))throw new Error(`Cannot count listeners for unknown event '${e}'.`);return this.listeners[e].length}dispatchEvent(e,t){for(let n of this.listeners[e])n(t)}dispatchInputEvent(e,t,n,s){this.dispatchEvent("input",{stage:e,deviceName:t,keyCode:n,input:s})}dispatchPollEvent(e){this.dispatchEvent("poll",{now:e})}onInputEvent(e){const t=e.deviceName;switch(e.type){case b:{const n=e.keyCode;let s=this.keySources[t][n];if(s)return s.update(e.event===E.DOWN),this.dispatchInputEvent(I,t,n,s),!0}break;case v:{let n=this.keySources[t],s=n.PosX;s&&(s.update(e.x,e.dx),this.dispatchInputEvent(I,t,"PosX",s));let i=n.PosY;i&&(i.update(e.y,e.dy),this.dispatchInputEvent(I,t,"PosY",i))}break;case _:{let n=this.keySources[t],s=n.WheelX;s&&(s.update(e.dx,e.dx),this.dispatchInputEvent(I,t,"WheelX",s));let i=n.WheelY;i&&(i.update(e.dy,e.dy),this.dispatchInputEvent(I,t,"WheelY",i));let r=n.WheelZ;r&&(r.update(e.dz,e.dz),this.dispatchInputEvent(I,t,"WheelZ",r))}}}onAnimationFrame(e){this._autopoll&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.poll(e))}set autopoll(e){this._autopoll=e,this._animationFrameHandle&&(cancelAnimationFrame(this._animationFrameHandle),this._animationFrameHandle=null),e&&(this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame))}get autopoll(){return this._autopoll}addKeySource(e,t){if(!(e in this.devices))throw new Error("Invalid device name - missing device with name in source.");let n,s=this.devices[e];if(s.constructor.isAxis(t))n=new L;else{if(!s.constructor.isButton(t))throw new Error(`Unknown key code '${t}' for device ${e}.`);n=new M}if(this.keySources[e][t])throw new Error("Cannot add duplicate key source for the same device and key code.");return this.keySources[e][t]=n,this}deleteKeySource(e,t){if(!this.keySources[e][t])throw new Error("Cannot delete missing key source for the device and key code.");delete this.keySources[e][t]}getKeySource(e,t){return this.keySources[e][t]}hasKeySource(e,t){return e in this.keySources&&t in this.keySources[e]}clearKeySources(){for(let e in this.devices)this.keySources[e]={}}}class C extends y{static isAxis(e){return!1}static isButton(e){return!0}constructor(e,t={}){super("Keyboard",e);const{repeat:n=!1}=t;this.repeat=n,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:E.NULL,type:b,value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat)return e.preventDefault(),e.stopPropagation(),!1;let t=this._eventObject;return t.keyCode=e.code,t.event=E.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onKeyUp(e){let t=this._eventObject;if(t.keyCode=e.code,t.event=E.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}}class k extends y{static isAxis(e){return"PosX"===e||"PosY"===e||"WheelX"===e||"WheelY"===e||"WheelZ"===e}static isButton(e){return!this.isAxis(e)}constructor(e,t={eventsOnFocus:!0}){super("Mouse",e),this.canvasTarget=e instanceof HTMLCanvasElement&&e||e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e,this.eventsOnFocus=t.eventsOnFocus,this._downHasFocus=!1,this._eventObject={target:e,deviceName:this.deviceName,keyCode:"",event:E.NULL,type:b,value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,deviceName:this.deviceName,keyCode:"Position",event:E.MOVE,type:v,x:0,y:0,dx:0,dy:0},this._wheelObject={target:e,deviceName:this.deviceName,keyCode:"Wheel",event:E.MOVE,type:_,dx:0,dy:0,dz:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let t=this._eventObject;if(t.keyCode="Button"+e.button,t.event=E.DOWN,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let t=this._wheelObject;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:t.dx=10*e.deltaX,t.dy=10*e.deltaY,t.dz=10*e.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:t.dx=100*e.deltaX,t.dy=100*e.deltaY,t.dz=100*e.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:t.dx=e.deltaX,t.dy=e.deltaY,t.dz=e.deltaZ}if(this.dispatchInput(t))return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let t=this._eventObject;return t.keyCode="Button"+e.button,t.event=E.UP,t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInput(t)?(e.preventDefault(),e.stopPropagation(),!1):void 0}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const t=this.canvasTarget,{clientWidth:n,clientHeight:s}=t,i=t.getBoundingClientRect();let r=e.movementX/n,o=e.movementY/s,a=(e.clientX-i.left)/n,l=(e.clientY-i.top)/s,u=this._positionObject;u.x=a,u.y=l,u.dx=r,u.dy=o,this.dispatchInput(u)}}const F=Symbol("keySourceRefCount");const P=Symbol("inputEventSource");function D(e){return Object.prototype.hasOwnProperty.call(e,P)&&Object.getOwnPropertyDescriptor(e,P).value}class U extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<div>\r\n    <label id="title">\r\n        input-source\r\n    </label>\r\n    <span>|</span>\r\n    <p>\r\n        <label for="poll">poll</label>\r\n        <output id="poll"></output>\r\n    </p>\r\n    <p>\r\n        <label for="focus">focus</label>\r\n        <output id="focus"></output>\r\n    </p>\r\n</div>\r\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=':host{display:inline-block}div{font-family:monospace;color:#666;outline:1px solid #666;padding:4px}p{display:inline;margin:0;padding:0}#focus:empty:after,#poll:empty:after{content:"✗";color:red}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static for(e){return new U(e)}static get observedAttributes(){return["oninput","onpoll","for","autopoll","id","class"]}static get properties(){return{for:String,autopoll:Boolean}}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get customEvents(){return["input","poll"]}get onpoll(){return this._onpoll}set onpoll(e){this._onpoll&&this.removeEventListener("poll",this._onpoll),this._onpoll=e,this._onpoll&&this.addEventListener("poll",e)}get oninput(){return this._oninput}set oninput(e){this._oninput&&this.removeEventListener("input",this._oninput),this._oninput=e,this._oninput&&this.addEventListener("input",e)}constructor(e){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._containerElement=this.shadowRoot.querySelector("div"),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._pollCount=0,this._pollCountDelay=0,this._eventTarget=null,this._eventSource=null,this._keySourceRefCount={},this.onSourcePoll=this.onSourcePoll.bind(this),this.onSourceInput=this.onSourceInput.bind(this),this.onTargetFocus=this.onTargetFocus.bind(this),this.onTargetBlur=this.onTargetBlur.bind(this),e&&this.setEventTarget(e)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"oninput")){let e=this.oninput;delete this.oninput,this.oninput=e}if(Object.prototype.hasOwnProperty.call(this,"onpoll")){let e=this.onpoll;delete this.onpoll,this.onpoll=e}if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.hasAttribute("for")||this._eventTarget||this.setEventTarget(this)}disconnectedCallback(){this.clearEventTarget()}attributeChangedCallback(e,t,n){switch(e){case"for":this._for=n;break;case"autopoll":this._autopoll=null!==n;break;case"oninput":this.oninput=new Function("event","with(document){with(this){"+n+"}}").bind(this);break;case"onpoll":this.onpoll=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"for":this.setEventTarget(n?document.getElementById(n):this);break;case"id":case"class":{let e=this.className?"."+this.className:"",t=this.hasAttribute("id")?"#"+this.getAttribute("id"):"";this._titleElement.innerHTML=e+t}}})(e,0,n)}poll(e){this._eventSource.poll(e)}onSourceInput({stage:e,deviceName:t,keyCode:n,input:s}){this.dispatchEvent(new CustomEvent("input",{composed:!0,bubbles:!1,detail:{stage:e,deviceName:t,keyCode:n,input:s}}))}onSourcePoll({now:e}){this._pollCount+=1,this.dispatchEvent(new CustomEvent("poll",{composed:!0,bubbles:!1})),e-this._pollCountDelay>1e3&&(this._pollCountDelay=e,this._pollCount>0?(this._pollElement.innerHTML="✓",this._pollCount=0):this._pollElement.innerHTML="")}onTargetFocus(){this._focusElement.innerHTML="✓"}onTargetBlur(){this._focusElement.innerHTML=""}setEventTarget(e){if(this.clearEventTarget(),!e)throw new Error("Cannot set null as event target for input source.");let t;D(e)?t=function(e){return Object.getOwnPropertyDescriptor(e,P).value}(e):(t=new O([new C(e),new k(e)]),function(e,t){Object.defineProperty(e,P,{value:t,configurable:!0})}(e,t),function(e){F in e||(e[F]={})}(t)),this._eventSource=t,this._eventTarget=e;let n=this.autopoll;n&&(this._eventSource.autopoll=n),t.addEventListener("poll",this.onSourcePoll),t.addEventListener("input",this.onSourceInput),e.addEventListener("focus",this.onTargetFocus),e.addEventListener("blur",this.onTargetBlur)}clearEventTarget(){let e=this._eventTarget,t=this._eventSource;this._eventTarget=null,this._eventSource=null,e&&(e.removeEventListener("focus",this.onTargetFocus),e.removeEventListener("blur",this.onTargetBlur),t.removeEventListener("poll",this.onSourcePoll),t.removeEventListener("input",this.onSourceInput),t.countEventListeners("input")<=0&&(t.destroy(),function(e){Object.defineProperty(e,P,{value:null,configurable:!0})}(e)))}enableKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");let n=this._eventSource;1===function(e,t,n){const s=x(t,n);let i=e[F],r=i[s]+1||1;return i[s]=r,r}(n,e,t)&&n.addKeySource(e,t)}disableKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");let n=this._eventSource;0===function(e,t,n){const s=x(t,n);let i=e[F],r=i[s]-1||0;return i[s]=Math.max(r,0),r}(n,e,t)&&n.deleteKeySource(e,t)}getKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");return this._eventSource.getKeySource(e,t)}hasKeySource(e,t){if(!e||!t)throw new Error("Invalid device name or key code for key source.");return this._eventSource.hasKeySource(e,t)}clearKeySources(){let e=this._eventSource;e.clearKeySources(),function(e){e[F]={}}(e)}get keySources(){return this._eventSource.keySources}get devices(){return this._eventSource.devices}}window.customElements.define("input-source",U);class B{constructor(e=null,t=null,n=!0){this.source=null,this._disabled=n,this._ignoreInput=n,this.adapters=new w,this.inputs={},this.onSourceInput=this.onSourceInput.bind(this),this.onSourcePoll=this.onSourcePoll.bind(this),(e||t)&&this._setupInputs(j(e),t),n||this.attach()}get disabled(){return this._disabled}set disabled(e){this.toggle(!e)}setInputMap(e){return this._setupInputs(this.source,e),this}setInputSource(e){return this._setupInputs(j(e),null),this}attach(){if(!this.source)throw new Error("Missing input source to attach context.");return this.toggle(!0),this}detach(){return this.toggle(!1),this._setupInputs(null,null),this}_setupInputs(e,t){const n=this.disabled;this.disabled=!0;const s=this.source,i=this.inputs,r=s!==e&&s,o=this.inputs&&t;if(r||o){r&&(s.removeEventListener("poll",this.onSourcePoll),s.removeEventListener("input",this.onSourceInput));for(let e in i){let{adapters:t}=i[e];for(let e of t){const{deviceName:t,keyCode:n}=e;s.disableKeySource(t,n)}}o&&(this.adapters.clear(),this.inputs={})}if(t){let e={};for(let n in t){let s=t[n],r=i[n]||new N;r.hydrate(s);let o=r.adapters;this.adapters.add(o),e[n]=r}this.inputs=e}if(e){const t=this.inputs;for(let n in t){let{adapters:s}=t[n];for(let t of s){const{deviceName:n,keyCode:s}=t;e.enableKeySource(n,s)}}this.source!==e&&(e.addEventListener("poll",this.onSourcePoll),e.addEventListener("input",this.onSourceInput),this.source=e)}this.disabled=n}onSourceInput(e){if(e.detail.consumed||this._ignoreInput){const{deviceName:t,keyCode:n,input:s}=e;this.adapters.reset(t,n,s)}else{const{stage:t,deviceName:n,keyCode:s,input:i}=e.detail;switch(t){case R:this.adapters.poll(n,s,i);break;case I:this.adapters.update(n,s,i);break;default:throw new Error("Unknown input source stage.")}e.consumed=!0}}onSourcePoll(e){this._ignoreInput!==this.disabled&&(this._ignoreInput=this.disabled)}toggle(e=this._disabled){if(e){if(!this.source)throw new Error("Input source must be set before enabling input context.");Object.keys(this.inputs).length<=0&&console.warn("No inputs found for enabled input context - did you forget to setInputMap()?")}return this._disabled=!e,this}getInput(e){if(e in this.inputs)return this.inputs[e];{let t=new N;return this.inputs[e]=t,t}}hasInput(e){return e in this.inputs&&this.inputs[e].adapters.length>0}getInputValue(e){return e in this.inputs?this.inputs[e].value:0}}function j(e){if(e instanceof U)return e;{let t=e,n=D(t),s=new U(t);return n||(s.autopoll=!0),s}}class H extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<kbd>\r\n    <span id="key"><slot></slot></span>\r\n    <span id="value" class="hidden"></span>\r\n</kbd>\r\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML='kbd{position:relative;display:inline-block;border-radius:3px;border:1px solid #888;font-size:.85em;font-weight:700;text-rendering:optimizeLegibility;line-height:12px;height:14px;padding:2px 4px;color:#444;background-color:#eee;box-shadow:inset 0 -3px 0 #aaa;overflow:hidden}kbd:empty:after{content:"<?>";opacity:.6}.disabled{opacity:.6;box-shadow:none;background-color:#aaa}.hidden{display:none}#value{position:absolute;top:0;bottom:0;right:0;font-size:.85em;padding:2px 4px 0;color:#ccc;background-color:#333;box-shadow:inset 0 3px 0 #222}',Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{name:String,value:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._keyboardElement=this.shadowRoot.querySelector("kbd"),this._keyElement=this.shadowRoot.querySelector("#key"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(e,t,n){switch(e){case"name":this._name=n;break;case"value":this._value=n;break;case"disabled":this._disabled=null!==n}((e,t,n)=>{switch(e){case"name":this._keyElement.innerText=n;break;case"value":null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.innerText=n,this._keyboardElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._keyboardElement.classList.toggle("disabled",null!==n)}})(e,0,n)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}static get observedAttributes(){return["name","value","disabled"]}}window.customElements.define("input-key",H);class V extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML='<table>\r\n    <thead>\r\n        <tr class="tableHeader">\r\n            <th colspan=4>\r\n                <slot id="title">input-map</slot>\r\n            </th>\r\n        </tr>\r\n        <tr class="colHeader">\r\n            <th>name</th>\r\n            <th>key</th>\r\n            <th>mod</th>\r\n            <th>value</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n    </tbody>\r\n</table>\r\n',Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:block}table{border-collapse:collapse}table,td,th{border:1px solid #666}td,th{padding:5px 10px}td{text-align:center}thead th{padding:0}.colHeader>th{font-size:.8em;padding:0 10px;letter-spacing:3px;background-color:#aaa;color:#666}.colHeader>th,output{font-family:monospace}output{border-radius:.3em;padding:3px}tr:not(.primary) .name,tr:not(.primary) .value{opacity:.3}tr:nth-child(2n){background-color:#eee}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get customEvents(){return["load"]}get onload(){return this._onload}set onload(e){this._onload&&this.removeEventListener("load",this._onload),this._onload=e,this._onload&&this.addEventListener("load",e)}static get observedAttributes(){return["onload","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._src="",this._inputMap=null,this._tableElements={},this._titleElement=this.shadowRoot.querySelector("#title"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot")}get map(){return this._inputMap}get mapElements(){return this._tableElements}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"onload")){let e=this.onload;delete this.onload,this.onload=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"onload":this.onload=new Function("event","with(document){with(this){"+n+"}}").bind(this)}((e,t,n)=>{switch(e){case"src":if(this._src!==n)if(this._src=n,n.trim().startsWith("{")){let e=JSON.parse(n);this._setInputMap(e)}else fetch(n).then((e=>e.json())).then((e=>this._setInputMap(e)));break;case"id":case"class":this._titleElement.innerHTML=`input-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}})(e,0,n)}get src(){return this.getAttribute("src")}set src(e){switch(typeof e){case"object":{let t=JSON.stringify(e);this._src=t,this._setInputMap(e),this.setAttribute("src",t)}break;case"string":this.setAttribute("src",e);break;default:this.setAttribute("src",JSON.stringify(e))}}_setInputMap(e){let t={},n=[];for(let s in e){let i=[];W(i,s,e[s]),t[s]=i,n.push(...i)}this._bodyElement.innerHTML="";for(let e of n)this._bodyElement.appendChild(e);this._inputMap=e,this._tableElements=t,this.dispatchEvent(new CustomEvent("load",{bubbles:!1,composed:!0,detail:{map:e}}))}}function W(e,t,n){if(Array.isArray(n)){W(e,t,n[0]);let s=n.length;for(let i=1;i<s;++i)e.push(Y(t,n[i],!1))}else e.push(Y(t,n,!0));return e}function Y(e,t,n=!0){if("object"==typeof t){const{key:s,event:i,scale:r}=t;return K(e,s,i,r,0,n)}return K(e,t,null,1,0,n)}function K(e,t,n,s,i,r=!0){let o=document.createElement("tr");r&&o.classList.add("primary");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),o.appendChild(t)}{let e=document.createElement("td");e.classList.add("key");let n=new H;n.innerText=t,e.appendChild(n),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("samp"),i=[];"string"==typeof n&&"null"!==n&&i.push(n),"number"==typeof s&&1!==s&&i.push(`×(${s.toFixed(2)})`),t.innerText=i.join(" "),e.classList.add("mod"),e.appendChild(t),o.appendChild(e)}{let e=document.createElement("td"),t=document.createElement("output");t.innerText=Number(i).toFixed(2),t.classList.add("value"),e.appendChild(t),o.appendChild(e)}return o}window.customElements.define("input-map",V);class q extends HTMLElement{static get[Symbol.for("cuttleTemplate")](){let e=document.createElement("template");return e.innerHTML="<input-map>\r\n    <slot></slot>\r\n    <input-source></input-source>\r\n</input-map>\r\n",Object.defineProperty(this,Symbol.for("cuttleTemplate"),{value:e}),e}static get[Symbol.for("cuttleStyle")](){let e=document.createElement("style");return e.innerHTML=":host{display:inline-block}",Object.defineProperty(this,Symbol.for("cuttleStyle"),{value:e}),e}static get properties(){return{for:String,disabled:Boolean}}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}static get observedAttributes(){return["for","disabled","src","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleTemplate")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("cuttleStyle")].cloneNode(!0)),this._inputContext=new B,this._mapElement=this.shadowRoot.querySelector("input-map"),this._sourceElement=this.shadowRoot.querySelector("input-source"),this.onInputMapLoad=this.onInputMapLoad.bind(this),this.onInputSourcePoll=this.onInputSourcePoll.bind(this),this._mapElement.addEventListener("load",this.onInputMapLoad),this._sourceElement.addEventListener("poll",this.onInputSourcePoll)}get context(){return this._inputContext}get source(){return this._sourceElement}get map(){return this._mapElement.map}onInputMapLoad(){let e=this._sourceElement,t=this._mapElement.map;e&&t&&(this._inputContext.setInputMap(t).setInputSource(e).attach(),this._inputContext.disabled=this._disabled)}onInputSourcePoll(){for(let[e,t]of Object.entries(this._mapElement.mapElements)){let n=this._inputContext.getInputValue(e);t[0].querySelector("output").innerText=Number(n).toFixed(2)}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}!function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}(this,"src")}attributeChangedCallback(e,t,n){switch(e){case"for":this._for=n;break;case"disabled":this._disabled=null!==n}((e,t,n)=>{switch(e){case"for":{let e=document.getElementById(n);D(n?e:this._sourceElement)||(this._sourceElement.autopoll=!0),e instanceof U&&e._eventTarget?(this._sourceElement.setEventTarget(e._eventTarget),this._sourceElement.className=e.className,this._sourceElement.id=e.id):this._sourceElement.for=n;let t=this._sourceElement,s=this._mapElement.map;s&&(this._inputContext.setInputMap(s).setInputSource(t).attach(),this._inputContext.disabled=this._disabled)}break;case"src":this._mapElement.src=n;break;case"disabled":{let e=this._sourceElement,t=this._mapElement.map;e&&t&&(this._inputContext.disabled=this._disabled)}break;case"id":this._sourceElement.id=n;break;case"class":this._sourceElement.className=n}})(e,0,n)}get src(){return this._mapElement.src}set src(e){this._mapElement.src=e}getInput(e){return this._inputContext.getInput(e)}getInputValue(e){return this._inputContext.getInputValue(e)}}function G(e,i,o,a){let l=function(e,n,s,i){var r=new t(4);return r[0]=e,r[1]=n,r[2]=s,r[3]=i,r}(e,i,-1,1),h=n();s(h,o),c(l,l,h),l[2]=-1,l[3]=0,s(h,a),c(l,l,h);let d=r(l[0],l[1],l[2]);return u(d,d),d}window.customElements.define("input-context",q),r(0,1,0);const z=Math.PI/3;class X extends class{constructor(e,t,n){this.canvas=e,this.projectionMatrix=t,this.viewMatrix=n,this.resize=this.resize.bind(this),e.addEventListener("resize",this.resize),setTimeout(this.resize,0)}destroy(){this.canvas.removeEventListener("resize",this.resize)}resize(){}}{constructor(e,t=z,s=.1,i=1e3){super(e,n(),n()),this.fieldOfView=t,this.clippingPlane={near:s,far:i}}resize(){const e=this.canvas.width/this.canvas.height,{near:t,far:n}=this.clippingPlane;!function(e,t,n,s,i){var r,o=1/Math.tan(t/2);e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(r=1/(s-i),e[10]=(i+s)*r,e[14]=2*i*s*r):(e[10]=-1,e[14]=-2*s)}(this.projectionMatrix,this.fieldOfView,e,t,n)}}const $=Math.PI/180;class Z{constructor(e={locky:!1}){this.locky=e.locky,this.position=i(),this.forward=r(0,0,-1),this.right=r(1,0,0),this.up=r(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,n=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*n)),this.yaw=(this.yaw+e*n)%360,this}move(e,t=0,n=0,s=1){return this.forwardAmount+=e*s,this.rightAmount+=t*s,this.upAmount+=n*s,this}apply(t){let{position:n,forward:s,right:r,up:c,forwardAmount:d,rightAmount:p,upAmount:m,pitch:f,yaw:b}=this,v=b*$,_=f*$,E=Math.cos(v),g=Math.cos(_),y=Math.sin(v),w=E*g,A=Math.sin(_),S=y*g;u(s,o(s,w,this.locky?0:A,S)),u(r,h(r,s,c));let N=i();return l(N,s,d),a(n,n,N),l(N,r,p),a(n,n,N),l(N,c,m),a(n,n,N),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.locky&&o(s,w,A,S),function(t,n,s,i){var r,o,a,l,u,h,c,d,p,m,f=n[0],b=n[1],v=n[2],_=i[0],E=i[1],g=i[2],y=s[0],w=s[1],A=s[2];Math.abs(f-y)<e&&Math.abs(b-w)<e&&Math.abs(v-A)<e?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(t):(c=f-y,d=b-w,p=v-A,r=E*(p*=m=1/Math.hypot(c,d,p))-g*(d*=m),o=g*(c*=m)-_*p,a=_*d-E*c,(m=Math.hypot(r,o,a))?(r*=m=1/m,o*=m,a*=m):(r=0,o=0,a=0),l=d*a-p*o,u=p*r-c*a,h=c*o-d*r,(m=Math.hypot(l,u,h))?(l*=m=1/m,u*=m,h*=m):(l=0,u=0,h=0),t[0]=r,t[1]=l,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=d,t[7]=0,t[8]=a,t[9]=h,t[10]=p,t[11]=0,t[12]=-(r*f+o*b+a*v),t[13]=-(l*f+u*b+h*v),t[14]=-(c*f+d*b+p*v),t[15]=1)}(t,n,a(N,n,s),c),t}}function J(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}function Q(e,t){switch(t){case e.FLOAT:return 1;case e.FLOAT_VEC2:return 2;case e.FLOAT_VEC3:return 3;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 4;case e.FLOAT_MAT3:return 9;case e.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function ee(e,t,n){return new(function(e,t){switch(t){case e.BYTE:return Int8Array;case e.UNSIGNED_BYTE:return Uint8Array;case e.SHORT:return Int16Array;case e.UNSIGNED_SHORT:return Uint16Array;case e.INT:return Int32Array;case e.UNSIGNED_INT:return Uint32Array;case e.FLOAT:return Float32Array;default:throw new Error("Cannot find valid typed array for buffer type.")}}(e,t))(n)}function te(e,t){switch(t){case e.FLOAT:return e.uniform1f;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1i;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1i;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return se;case e.FLOAT_MAT3:return ie;case e.FLOAT_MAT4:return re;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1i}if(J(e))switch(t){case e.UNSIGNED_INT:return e.uniform1ui;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return oe;case e.FLOAT_MAT2x4:return ae;case e.FLOAT_MAT3x2:return le;case e.FLOAT_MAT3x4:return ue;case e.FLOAT_MAT4x2:return he;case e.FLOAT_MAT4x3:return ce;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1i}throw new Error("Cannot find uniform function for gl enum.")}function ne(e,t){switch(t){case e.FLOAT:return e.uniform1fv;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1iv;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1iv;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return se;case e.FLOAT_MAT3:return ie;case e.FLOAT_MAT4:return re;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1iv}if(J(e))switch(t){case e.UNSIGNED_INT:return e.uniform1uiv;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return oe;case e.FLOAT_MAT2x4:return ae;case e.FLOAT_MAT3x2:return le;case e.FLOAT_MAT3x4:return ue;case e.FLOAT_MAT4x2:return he;case e.FLOAT_MAT4x3:return ce;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1iv}throw new Error("Cannot find array uniform function for gl enum.")}function se(e,t){this.uniformMatrix2fv(e,!1,t)}function ie(e,t){this.uniformMatrix3fv(e,!1,t)}function re(e,t){this.uniformMatrix4fv(e,!1,t)}function oe(e,t){this.uniformMatrix2x3fv(e,!1,t)}function ae(e,t){this.uniformMatrix2x4fv(e,!1,t)}function le(e,t){this.uniformMatrix3x2fv(e,!1,t)}function ue(e,t){this.uniformMatrix3x4fv(e,!1,t)}function he(e,t){this.uniformMatrix4x2fv(e,!1,t)}function ce(e,t){this.uniformMatrix4x3fv(e,!1,t)}class de{static from(e,t){return new de(e,t)}constructor(e,t){this.handle=t||e.createProgram(),this.shaders=[],this.gl=e}shader(e,t){let n=function(e,t,n){let s=e.createShader(t);return e.shaderSource(s,n),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS)||(console.error(e.getShaderInfoLog(s)+`\nFailed to compile shader:\n${n}`),e.deleteShader(s)),s}(this.gl,e,t);return this.shaders.push(n),this}link(){return function(e,t,n){for(let s of n)e.attachShader(t,s);e.linkProgram(t);for(let s of n)e.detachShader(t,s),e.deleteShader(s);e.getProgramParameter(t,e.LINK_STATUS)||(console.error(e.getProgramInfoLog(t)),e.deleteProgram(t))}(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}class pe extends de{constructor(e){super(e)}link(){const e=super.link();return new me(this.gl,e)}}class me{static from(e){return new pe(e)}constructor(e,t){this.handle=t,this.activeUniforms=function(e,t){let n={};const s=function(e,t){let n=[];const s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<s;++i){let s=e.getActiveUniform(t,i);if(!s)break;n.push(s)}return n}(e,t);for(let i of s){const s=i.name,r=i.size,o=i.type,a=e.getUniformLocation(t,s);let l;l=r<=1?te(e,o):ne(e,o),n[s]={type:o,length:r,location:a,set:l}}return n}(e,t),this.activeAttributes=function(e,t){let n={};const s=function(e,t){let n=[];const s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<s;++i){let s=e.getActiveAttrib(t,i);s&&n.push(s)}return n}(e,t);for(let i of s){const s=i.name,r=i.size,o=i.type,a=e.getAttribLocation(t,s),l=Q(e,o);n[s]={type:o,length:r,location:a,size:l}}return n}(e,t),this.drawContext=new fe(e,this)}bind(e){return e.useProgram(this.handle),this.drawContext.gl=e,this.drawContext}}class fe{constructor(e,t){this.gl=e,this.parent=t}uniform(e,t){const n=this.parent.activeUniforms;if(e in n){let s=n[e],i=s.location;s.set.call(this.gl,i,t)}return this}attribute(e,t,n,s=!1,i=0,r=0){const o=this.gl,a=this.parent.activeAttributes;if(e in a){let l=a[e],u=l.location,h=l.size;n?(o.bindBuffer(o.ARRAY_BUFFER,n),o.vertexAttribPointer(u,h,t,s,i,r),o.enableVertexAttribArray(u)):o.disableVertexAttribArray(u)}return this}draw(e,t,n,s,i=null){return function(e,t,n,s,i){i?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.drawElements(t,s,e.UNSIGNED_SHORT,n)):e.drawArrays(t,n,s)}(e,t,n,s,i),this.parent}}async function be(e,t){return(await fetch(e)).text()}async function ve(e,t){return new Promise(((t,n)=>{let s=new Image;s.addEventListener("load",(()=>{t(s)})),s.addEventListener("error",(e=>{n(e)})),s.src=e}))}async function _e(e,t){let n=await fetch(e);return function(e){const t=[],n=[],s=[],i=[],r=[],o=[],a=/^#.*/g,l=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,u=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vt\s+(\S+)\s+(\S+)/g,c=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,d=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g;let p,m,f,b,v,_,E=!1,g=null;e=e.replace(a,"");for(;null!=(g=l.exec(e));)p=Number.parseFloat(g[1]),m=Number.parseFloat(g[2]),f=Number.parseFloat(g[3]),t.push(p),t.push(m),t.push(f);for(;null!=(g=u.exec(e));)p=Number.parseFloat(g[1]),m=Number.parseFloat(g[2]),f=Number.parseFloat(g[3]),s.push(p),s.push(m),s.push(f);for(;null!=(g=h.exec(e));)p=Number.parseFloat(g[1]),m=Number.parseFloat(g[2]),n.push(p),n.push(m);for(;null!=(g=c.exec(e));)p=Number.parseInt(g[2]),Number.isNaN(p)&&(p=1),m=Number.parseInt(g[6]),Number.isNaN(m)&&(m=1),f=Number.parseInt(g[10]),Number.isNaN(f)&&(f=1),i.push(p),i.push(m),i.push(f),p=Number.parseInt(g[4]),Number.isNaN(p)?(p=Number.parseInt(g[3]),m=Number.parseInt(g[7]),f=Number.parseInt(g[11]),o.push(p),o.push(m),o.push(f),r.push(1),r.push(1),r.push(1)):(m=Number.parseInt(g[8]),Number.isNaN(m)&&(m=1),f=Number.parseInt(g[12]),Number.isNaN(f)&&(f=1),o.push(p),o.push(m),o.push(f),p=Number.parseInt(g[3]),Number.isNaN(p)&&(p=1),m=Number.parseInt(g[7]),Number.isNaN(m)&&(m=1),f=Number.parseInt(g[11]),Number.isNaN(f)&&(f=1),r.push(p),r.push(m),r.push(f)),void 0!==g[13]&&(b=Number.parseInt(g[15]),Number.isNaN(b)&&(b=1),i.push(b),b=Number.parseInt(g[17]),Number.isNaN(b)?(b=Number.parseInt(g[16]),o.push(b),r.push(1)):(o.push(b),b=Number.parseInt(g[16]),r.push(b)),E=!0);for(;null!=(g=d.exec(e));)p=Number.parseInt(g[2]),m=Number.parseInt(g[6]),f=Number.parseInt(g[10]),i.push(p),i.push(m),i.push(f),r.push(1),r.push(1),r.push(1),o.push(1),o.push(1),o.push(1),void 0!==g[13]&&(b=Number.parseInt(g[14]),i.push(b),r.push(1),o.push(1),E=!0);_=i.length;const y=new Float32Array(3*_);for(let e=0;e<_;++e)v=i[e]-1,y[3*e+0]=t[3*v+0],y[3*e+1]=t[3*v+1],y[3*e+2]=t[3*v+2];_=r.length;const w=new Float32Array(2*_);for(let e=0;e<_;++e)v=r[e]-1,w[2*e+0]=n[2*v+0],w[2*e+1]=n[2*v+1];_=o.length;const A=new Float32Array(3*_);for(let e=0;e<_;++e)v=o[e]-1,A[3*e+0]=s[3*v+0],A[3*e+1]=s[3*v+1],A[3*e+2]=s[3*v+2];_=i.length;const S=new Uint16Array(_);for(let e=0;e<_;++e)S[e]=e;E&&console.warn("WebGL does not support quad faces, only triangles.");return{positions:y,texcoords:w,normals:A,indices:S}}(await n.text())}const Ee={load:async()=>({mainVertexShaderSource:await be("main.vert"),mainFragmentShaderSource:await be("main.frag"),cubeObj:await _e("cube.obj"),quadObj:await _e("quad.obj"),gradientClay:await ve("gradient_clay.png"),color:await ve("null.png")})};class ge{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,n={parent:0,children:[]};return this.nodes[t]=n,ye(e,t,this),t}createSceneNodes(e,t){let n=[];for(let s=0;s<e;++s)n.push(this.createSceneNode(t));return n}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");we(this.nodes[e].parent,e,this),Ae(this,e,0,Se)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){we(this.nodes[e].parent,e,this),ye(t,e,this)}replaceSceneNode(e,t){let n=this.nodes[e],s=n.parent,i=n.children.slice();if(we(s,e,this),n.children.length=0,t){let e=this.nodes[t];we(e.parent,t,this),e.children.push(...i),ye(s,t,this)}else if(s){this.nodes[s].children.push(...i)}else this.roots.push(...i);for(let e of i)this.nodes[e].parent=s}walk(e,t={}){const{from:n,childFilter:s}=t;let i;i=n?Array.isArray(n)?n:[n]:this.roots,s&&(i=s(i,0,this));for(let t of i)Ae(this,t,0,e,s)}}function ye(e,t,n){e?(n.nodes[e].children.push(t),n.nodes[t].parent=e):(n.roots.push(t),n.nodes[t].parent=0)}function we(e,t,n){if(e){let s=n.nodes[e].children,i=s.indexOf(t);s.splice(i,1),n.nodes[t].parentNode=0}else{let e=n.roots,s=e.indexOf(t);e.splice(s,1),n.nodes[t].parentNode=0}}function Ae(e,t,n,s,i){if(n>=100)return;let r=s(t,e);if(!1===r)return;let o=e.nodes[t],a=i?i(o.children,t,e):o.children;for(let t of a)Ae(e,t,n+1,s,i);"function"==typeof r&&r(t,e)}function Se(e,t){delete t.nodes[e]}class Ne{constructor(e,t,n){this.shaderProgram=t,this.meshData=n;let s=n;{const t=ee(e,e.FLOAT,s.positions),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.positions={source:t,buffer:n}}{const t=ee(e,e.FLOAT,s.texcoords),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:n}}{const t=ee(e,e.FLOAT,s.normals),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:n}}const i=ee(e,e.UNSIGNED_SHORT,s.indices),r=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),this.elements={source:i,buffer:r},this._drawContext=new Te(this)}begin(e,t,n){let s=this.shaderProgram.bind(e);return s.uniform("u_projection",t),s.uniform("u_view",n),this._drawContext.setProgramContext(s),this._drawContext}}class Te{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,n){const{ctx:s,renderer:i}=this,{positions:r,texcoords:o,normals:a,elements:l}=i;s.attribute("a_position",e.FLOAT,r.buffer,3),s.attribute("a_texcoord",e.FLOAT,o.buffer,2),s.attribute("a_normal",e.FLOAT,a.buffer,3),s.uniform("u_model",t),n&&s.uniform("u_color",n),s.draw(e,e.TRIANGLES,0,l.source.length,l.buffer)}end(e){return this.renderer}}class xe{constructor(e,t,n){this.shaderProgram=t,this.meshData=n;let s=n;const i=ee(e,e.FLOAT,s.positions),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this.positions={source:i,buffer:r};{const t=ee(e,e.FLOAT,s.texcoords),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.texcoords={source:t,buffer:n}}{const t=ee(e,e.FLOAT,s.normals),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),this.normals={source:t,buffer:n}}const o=ee(e,e.UNSIGNED_SHORT,s.indices),a=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o,e.STATIC_DRAW),this.elements={source:o,buffer:a},this._drawContext=new Le(this)}begin(e,t,n){let s=this.shaderProgram.bind(e);return s.uniform("u_projection",t),s.uniform("u_view",n),this._drawContext.setProgramContext(s),this._drawContext}}class Le{constructor(e){this.renderer=e,this.ctx=null}setProgramContext(e){return this.ctx=e,this}render(e,t,n){const{ctx:s,renderer:i}=this,{positions:r,texcoords:o,normals:a,elements:l}=i;s.attribute("a_position",e.FLOAT,r.buffer,3),s.attribute("a_texcoord",e.FLOAT,o.buffer,2),s.attribute("a_normal",e.FLOAT,a.buffer,3),s.uniform("u_model",t),n&&s.uniform("u_color",n),s.draw(e,e.TRIANGLES,0,l.source.length,l.buffer)}end(e){return this.renderer}}document.addEventListener("DOMContentLoaded",(async function(){const e=document.querySelector("display-port"),t=document.querySelector("input-context");s=e,s.addEventListener("focus",(()=>{document.pointerLockElement!==s&&s.requestPointerLock()})),document.addEventListener("pointerlockchange",(()=>{document.pointerLockElement!==s&&s.blur()}));var s;const i=e.canvas.getContext("webgl");if(!i)throw new Error("Your browser does not support WebGL.");i.enable(i.DEPTH_TEST);const o=await Ee.load(),a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o.gradientClay),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);const l=me.from(i).shader(i.VERTEX_SHADER,o.mainVertexShaderSource).shader(i.FRAGMENT_SHADER,o.mainFragmentShaderSource).link(),u=new Ne(i,l,o.cubeObj),h=new xe(i,l,o.quadObj),c=new X(i.canvas),p=new Z({locky:!0});p.move(-15,0,5),p.look(0,-20);const m=new Map,f=new ge;function b(e=0,t=0,s=0,i=1,o=1,a=1,l=0,u=0,h=0,c=r(Math.random(),Math.random(),Math.random()),p={}){let b=f.createSceneNode(),v={worldMatrix:n(),localMatrix:n()};return function(e,t,n,s){var i=t[0],r=t[1],o=t[2],a=t[3],l=i+i,u=r+r,h=o+o,c=i*l,d=i*u,p=i*h,m=r*u,f=r*h,b=o*h,v=a*l,_=a*u,E=a*h,g=s[0],y=s[1],w=s[2];e[0]=(1-(m+b))*g,e[1]=(d+E)*g,e[2]=(p-_)*g,e[3]=0,e[4]=(d-E)*y,e[5]=(1-(c+b))*y,e[6]=(f+v)*y,e[7]=0,e[8]=(p+_)*w,e[9]=(f-v)*w,e[10]=(1-(c+m))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1}(v.localMatrix,function(e,t,n,s){var i=.5*Math.PI/180;t*=i,n*=i,s*=i;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),l=Math.cos(n),u=Math.sin(s),h=Math.cos(s);return e[0]=r*l*h-o*a*u,e[1]=o*a*h+r*l*u,e[2]=o*l*u-r*a*h,e[3]=o*l*h+r*a*u,e}(d(),l,u,h),r(e,t,s),r(i,o,a)),m.set(b,v),{sceneNode:b,transform:v,color:c,...p}}const v=b();(()=>{const e=.01,t=.1,n=.11,s=b(n,0,0,t,e,e,0,0,0,r(1,0,0)),i=b(0,n,0,e,t,e,0,0,0,r(0,1,0)),o=b(0,0,n,e,e,t,0,0,0,r(0,0,1)),a=b(0,0,0,e,e,e,0,0,0,r(1,1,1));f.parentSceneNode(s.sceneNode,v.sceneNode),f.parentSceneNode(i.sceneNode,v.sceneNode),f.parentSceneNode(o.sceneNode,v.sceneNode),f.parentSceneNode(a.sceneNode,v.sceneNode)})();const _=b();(()=>{let e=b(0,-2.5,0,.8,.5,.8),t=b(0,-2,0,1.05,.2,1.05),n=b(0,-1,0,.6,1,.6),s=b(0,-1.8,0,.7,.2,.7);const i=.3;let r=b(0,.15,0,.6,.2,.6,-5),o=b(0,.05,0,1,.1,1,-5),a=b(-.3,-.3,.6,.1,.1,.1),l=b(.3,-.3,.6,.1,.1,.1),u=b(-.9,-.7,0,.2,.3,.2,0,0,90),h=b(-1,-.7+i,0,.2,.1,.2,0,0,0);h.color=u.color;let c=b(.9,-1,0,.2,.3,.2,0,0,90),d=b(1,-.7,0,.2,.1,.2,0,0,0);d.color=c.color,f.parentSceneNode(t.sceneNode,_.sceneNode),f.parentSceneNode(e.sceneNode,_.sceneNode),f.parentSceneNode(s.sceneNode,_.sceneNode),f.parentSceneNode(r.sceneNode,_.sceneNode),f.parentSceneNode(o.sceneNode,_.sceneNode),f.parentSceneNode(a.sceneNode,_.sceneNode),f.parentSceneNode(l.sceneNode,_.sceneNode),f.parentSceneNode(n.sceneNode,_.sceneNode),f.parentSceneNode(u.sceneNode,_.sceneNode),f.parentSceneNode(h.sceneNode,_.sceneNode),f.parentSceneNode(c.sceneNode,_.sceneNode),f.parentSceneNode(d.sceneNode,_.sceneNode)})();const E=[b(0,0,0,1,1,1),b(4,0,0,1,.5,1),b(-4,0,0,2,4,2,45)],g=[b(0,-4,0,2,2,2)];let y=0;e.addEventListener("frame",(e=>{e.detail.deltaTime,t.source.poll();const n=t.context.getInputValue("PointerX"),s=t.context.getInputValue("PointerY"),r=t.context.getInputValue("PointerMovementX"),o=t.context.getInputValue("PointerMovementY"),a=t.context.getInputValue("PointerMovementZ"),l=t.context.getInputValue("MoveRight")-t.context.getInputValue("MoveLeft"),d=t.context.getInputValue("MoveUp")-t.context.getInputValue("MoveDown");i.viewport(0,0,i.canvas.width,i.canvas.height),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT);let b=c;const _=i.canvas.width/i.canvas.height;p.look(100*r*_,100*-o);p.move(.5*d,.5*l),p.apply(b.viewMatrix),y+=a/1e3;let w,A=G(2*(n-.5),2*(.5-s),b.projectionMatrix,b.viewMatrix);!function(e,t,n,s){e[0]=t[0]+n[0]*s,e[1]=t[1]+n[1]*s,e[2]=t[2]+n[2]*s}(A,p.position,A,1-y),function(e,t){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}(v.transform.localMatrix,A),f.walk(((e,t)=>{let{parent:n}=t.getSceneNodeInfo(e);!function(e,t){t?function(e,t,n){var s=t[0],i=t[1],r=t[2],o=t[3],a=t[4],l=t[5],u=t[6],h=t[7],c=t[8],d=t[9],p=t[10],m=t[11],f=t[12],b=t[13],v=t[14],_=t[15],E=n[0],g=n[1],y=n[2],w=n[3];e[0]=E*s+g*a+y*c+w*f,e[1]=E*i+g*l+y*d+w*b,e[2]=E*r+g*u+y*p+w*v,e[3]=E*o+g*h+y*m+w*_,E=n[4],g=n[5],y=n[6],w=n[7],e[4]=E*s+g*a+y*c+w*f,e[5]=E*i+g*l+y*d+w*b,e[6]=E*r+g*u+y*p+w*v,e[7]=E*o+g*h+y*m+w*_,E=n[8],g=n[9],y=n[10],w=n[11],e[8]=E*s+g*a+y*c+w*f,e[9]=E*i+g*l+y*d+w*b,e[10]=E*r+g*u+y*p+w*v,e[11]=E*o+g*h+y*m+w*_,E=n[12],g=n[13],y=n[14],w=n[15],e[12]=E*s+g*a+y*c+w*f,e[13]=E*i+g*l+y*d+w*b,e[14]=E*r+g*u+y*p+w*v,e[15]=E*o+g*h+y*m+w*_}(e.worldMatrix,t.worldMatrix,e.localMatrix):function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(e.worldMatrix,e.localMatrix)}(m.get(e),n?m.get(n):null)})),w=u.begin(i,b.projectionMatrix,b.viewMatrix),w.ctx.uniform("u_texture",0);for(let e of E)w.ctx.uniform("u_local",e.transform.localMatrix),w.render(i,e.transform.worldMatrix,e.color);w.end(i),w=h.begin(i,b.projectionMatrix,b.viewMatrix),w.ctx.uniform("u_texture",0);for(let e of g)w.ctx.uniform("u_local",e.transform.localMatrix),w.render(i,e.transform.worldMatrix,e.color);w.end(i)}))}))}();
