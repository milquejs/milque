(()=>{var fs=Object.create,Qe=Object.defineProperty,ds=Object.getPrototypeOf,ps=Object.prototype.hasOwnProperty,ms=Object.getOwnPropertyNames,_s=Object.getOwnPropertyDescriptor;var vs=n=>Qe(n,"__esModule",{value:!0});var gs=(n,e)=>()=>(n&&(e=n(n=0)),e),Re=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Ze=(n,e)=>{for(var t in e)Qe(n,t,{get:e[t],enumerable:!0})},xs=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ms(e))!ps.call(n,r)&&r!=="default"&&Qe(n,r,{get:()=>e[r],enumerable:!(t=_s(e,r))||t.enumerable});return n},Es=n=>xs(vs(Qe(n!=null?fs(ds(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Yn={};Ze(Yn,{basename:()=>Jn,default:()=>mo,delimiter:()=>Qn,dirname:()=>Zn,extname:()=>er,isAbsolute:()=>kt,join:()=>Xn,normalize:()=>Ht,relative:()=>Wn,resolve:()=>ot,sep:()=>qn});function $n(n,e){for(var t=0,r=n.length-1;r>=0;r--){var s=n[r];s==="."?n.splice(r,1):s===".."?(n.splice(r,1),t++):t&&(n.splice(r,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function ot(){for(var n="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var r=t>=0?arguments[t]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;n=r+"/"+n,e=r.charAt(0)==="/"}return n=$n(Ut(n.split("/"),function(s){return!!s}),!e).join("/"),(e?"/":"")+n||"."}function Ht(n){var e=kt(n),t=po(n,-1)==="/";return n=$n(Ut(n.split("/"),function(r){return!!r}),!e).join("/"),!n&&!e&&(n="."),n&&t&&(n+="/"),(e?"/":"")+n}function kt(n){return n.charAt(0)==="/"}function Xn(){var n=Array.prototype.slice.call(arguments,0);return Ht(Ut(n,function(e,t){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function Wn(n,e){n=ot(n).substr(1),e=ot(e).substr(1);function t(h){for(var d=0;d<h.length&&h[d]==="";d++);for(var x=h.length-1;x>=0&&h[x]==="";x--);return d>x?[]:h.slice(d,x-d+1)}for(var r=t(n.split("/")),s=t(e.split("/")),i=Math.min(r.length,s.length),o=i,a=0;a<i;a++)if(r[a]!==s[a]){o=a;break}for(var l=[],a=o;a<r.length;a++)l.push("..");return l=l.concat(s.slice(o)),l.join("/")}function Zn(n){var e=Ft(n),t=e[0],r=e[1];return!t&&!r?".":(r&&(r=r.substr(0,r.length-1)),t+r)}function Jn(n,e){var t=Ft(n)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t}function er(n){return Ft(n)[3]}function Ut(n,e){if(n.filter)return n.filter(e);for(var t=[],r=0;r<n.length;r++)e(n[r],r,n)&&t.push(n[r]);return t}var fo,Ft,qn,Qn,mo,po,tr=gs(()=>{fo=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Ft=function(n){return fo.exec(n).slice(1)};qn="/",Qn=":";mo={extname:er,basename:Jn,dirname:Zn,sep:qn,delimiter:Qn,relative:Wn,join:Xn,isAbsolute:kt,normalize:Ht,resolve:ot};po="ab".substr(-1)==="b"?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}});var lt=Re((Bl,at)=>{var be=(tr(),Yn);be&&be.default?at.exports=be.default:be&&(at.exports=be);if(be)for(let n in be)at.exports[n]=be[n]});var ze=Re((Dl,nr)=>{"use strict";var _o=lt(),Ee="\\\\/",rr=`[^${Ee}]`,Ae="\\.",vo="\\+",go="\\?",ut="\\/",xo="(?=.)",sr="[^/]",jt=`(?:${ut}|$)`,ir=`(?:^|${ut})`,zt=`${Ae}{1,2}${jt}`,Eo=`(?!${Ae})`,yo=`(?!${ir}${zt})`,wo=`(?!${Ae}{0,1}${jt})`,Ao=`(?!${zt})`,To=`[^.${ut}]`,bo=`${sr}*?`,or={DOT_LITERAL:Ae,PLUS_LITERAL:vo,QMARK_LITERAL:go,SLASH_LITERAL:ut,ONE_CHAR:xo,QMARK:sr,END_ANCHOR:jt,DOTS_SLASH:zt,NO_DOT:Eo,NO_DOTS:yo,NO_DOT_SLASH:wo,NO_DOTS_SLASH:Ao,QMARK_NO_DOT:To,STAR:bo,START_ANCHOR:ir},So={...or,SLASH_LITERAL:`[${Ee}]`,QMARK:rr,STAR:`${rr}*?`,DOTS_SLASH:`${Ae}{1,2}(?:[${Ee}]|$)`,NO_DOT:`(?!${Ae})`,NO_DOTS:`(?!(?:^|[${Ee}])${Ae}{1,2}(?:[${Ee}]|$))`,NO_DOT_SLASH:`(?!${Ae}{0,1}(?:[${Ee}]|$))`,NO_DOTS_SLASH:`(?!${Ae}{1,2}(?:[${Ee}]|$))`,QMARK_NO_DOT:`[^.${Ee}]`,START_ANCHOR:`(?:^|[${Ee}])`,END_ANCHOR:`(?:[${Ee}]|$)`},Ro={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};nr.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Ro,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:_o.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?So:or}}});var ht=Re(oe=>{"use strict";var Mo=lt(),Lo=!1,{REGEX_BACKSLASH:Co,REGEX_REMOVE_BACKSLASH:Io,REGEX_SPECIAL_CHARS:Oo,REGEX_SPECIAL_CHARS_GLOBAL:No}=ze();oe.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);oe.hasRegexChars=n=>Oo.test(n);oe.isRegexChar=n=>n.length===1&&oe.hasRegexChars(n);oe.escapeRegex=n=>n.replace(No,"\\$1");oe.toPosixSlashes=n=>n.replace(Co,"/");oe.removeBackslashes=n=>n.replace(Io,e=>e==="\\"?"":e);oe.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};oe.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:Lo===!0||Mo.sep==="\\";oe.escapeLast=(n,e,t)=>{let r=n.lastIndexOf(e,t);return r===-1?n:n[r-1]==="\\"?oe.escapeLast(n,e,r-1):`${n.slice(0,r)}\\${n.slice(r)}`};oe.removePrefix=(n,e={})=>{let t=n;return t.startsWith("./")&&(t=t.slice(2),e.prefix="./"),t};oe.wrapOutput=(n,e={},t={})=>{let r=t.contains?"":"^",s=t.contains?"":"$",i=`${r}(?:${n})${s}`;return e.negated===!0&&(i=`(?:^(?!${i}).*$)`),i}});var pr=Re((Fl,ar)=>{"use strict";var lr=ht(),{CHAR_ASTERISK:Kt,CHAR_AT:Bo,CHAR_BACKWARD_SLASH:Ke,CHAR_COMMA:Do,CHAR_DOT:Vt,CHAR_EXCLAMATION_MARK:Gt,CHAR_FORWARD_SLASH:ur,CHAR_LEFT_CURLY_BRACE:Yt,CHAR_LEFT_PARENTHESES:$t,CHAR_LEFT_SQUARE_BRACKET:Po,CHAR_PLUS:Fo,CHAR_QUESTION_MARK:hr,CHAR_RIGHT_CURLY_BRACE:Uo,CHAR_RIGHT_PARENTHESES:cr,CHAR_RIGHT_SQUARE_BRACKET:ko}=ze(),fr=n=>n===ur||n===Ke,dr=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},Ho=(n,e)=>{let t=e||{},r=n.length-1,s=t.parts===!0||t.scanToEnd===!0,i=[],o=[],a=[],l=n,h=-1,d=0,x=0,T=!1,L=!1,m=!1,w=!1,R=!1,N=!1,U=!1,C=!1,D=!1,k=!1,z=0,H,A,b={value:"",depth:0,isGlob:!1},$=()=>h>=r,p=()=>l.charCodeAt(h+1),j=()=>(H=A,l.charCodeAt(++h));for(;h<r;){A=j();let Q;if(A===Ke){U=b.backslashes=!0,A=j(),A===Yt&&(N=!0);continue}if(N===!0||A===Yt){for(z++;$()!==!0&&(A=j());){if(A===Ke){U=b.backslashes=!0,j();continue}if(A===Yt){z++;continue}if(N!==!0&&A===Vt&&(A=j())===Vt){if(T=b.isBrace=!0,m=b.isGlob=!0,k=!0,s===!0)continue;break}if(N!==!0&&A===Do){if(T=b.isBrace=!0,m=b.isGlob=!0,k=!0,s===!0)continue;break}if(A===Uo&&(z--,z===0)){N=!1,T=b.isBrace=!0,k=!0;break}}if(s===!0)continue;break}if(A===ur){if(i.push(h),o.push(b),b={value:"",depth:0,isGlob:!1},k===!0)continue;if(H===Vt&&h===d+1){d+=2;continue}x=h+1;continue}if(t.noext!==!0&&(A===Fo||A===Bo||A===Kt||A===hr||A===Gt)===!0&&p()===$t){if(m=b.isGlob=!0,w=b.isExtglob=!0,k=!0,A===Gt&&h===d&&(D=!0),s===!0){for(;$()!==!0&&(A=j());){if(A===Ke){U=b.backslashes=!0,A=j();continue}if(A===cr){m=b.isGlob=!0,k=!0;break}}continue}break}if(A===Kt){if(H===Kt&&(R=b.isGlobstar=!0),m=b.isGlob=!0,k=!0,s===!0)continue;break}if(A===hr){if(m=b.isGlob=!0,k=!0,s===!0)continue;break}if(A===Po){for(;$()!==!0&&(Q=j());){if(Q===Ke){U=b.backslashes=!0,j();continue}if(Q===ko){L=b.isBracket=!0,m=b.isGlob=!0,k=!0;break}}if(s===!0)continue;break}if(t.nonegate!==!0&&A===Gt&&h===d){C=b.negated=!0,d++;continue}if(t.noparen!==!0&&A===$t){if(m=b.isGlob=!0,s===!0){for(;$()!==!0&&(A=j());){if(A===$t){U=b.backslashes=!0,A=j();continue}if(A===cr){k=!0;break}}continue}break}if(m===!0){if(k=!0,s===!0)continue;break}}t.noext===!0&&(w=!1,m=!1);let F=l,se="",f="";d>0&&(se=l.slice(0,d),l=l.slice(d),x-=d),F&&m===!0&&x>0?(F=l.slice(0,x),f=l.slice(x)):m===!0?(F="",f=l):F=l,F&&F!==""&&F!=="/"&&F!==l&&fr(F.charCodeAt(F.length-1))&&(F=F.slice(0,-1)),t.unescape===!0&&(f&&(f=lr.removeBackslashes(f)),F&&U===!0&&(F=lr.removeBackslashes(F)));let c={prefix:se,input:n,start:d,base:F,glob:f,isBrace:T,isBracket:L,isGlob:m,isExtglob:w,isGlobstar:R,negated:C,negatedExtglob:D};if(t.tokens===!0&&(c.maxDepth=0,fr(A)||o.push(b),c.tokens=o),t.parts===!0||t.tokens===!0){let Q;for(let P=0;P<i.length;P++){let ne=Q?Q+1:d,Z=i[P],J=n.slice(ne,Z);t.tokens&&(P===0&&d!==0?(o[P].isPrefix=!0,o[P].value=se):o[P].value=J,dr(o[P]),c.maxDepth+=o[P].depth),(P!==0||J!=="")&&a.push(J),Q=Z}if(Q&&Q+1<n.length){let P=n.slice(Q+1);a.push(P),t.tokens&&(o[o.length-1].value=P,dr(o[o.length-1]),c.maxDepth+=o[o.length-1].depth)}c.slashes=i,c.parts=a}return c};ar.exports=Ho});var gr=Re((Ul,mr)=>{"use strict";var ct=ze(),le=ht(),{MAX_LENGTH:ft,POSIX_REGEX_SOURCE:jo,REGEX_NON_SPECIAL_CHARS:zo,REGEX_SPECIAL_CHARS_BACKREF:Ko,REPLACEMENTS:_r}=ct,Vo=(n,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...n,e);n.sort();let t=`[${n.join("-")}]`;try{new RegExp(t)}catch(r){return n.map(s=>le.escapeRegex(s)).join("..")}return t},Be=(n,e)=>`Missing ${n}: "${e}" - use "\\\\${e}" to match literal characters`,vr=(n,e)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=_r[n]||n;let t={...e},r=typeof t.maxLength=="number"?Math.min(ft,t.maxLength):ft,s=n.length;if(s>r)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${r}`);let i={type:"bos",value:"",output:t.prepend||""},o=[i],a=t.capture?"":"?:",l=le.isWindows(e),h=ct.globChars(l),d=ct.extglobChars(h),{DOT_LITERAL:x,PLUS_LITERAL:T,SLASH_LITERAL:L,ONE_CHAR:m,DOTS_SLASH:w,NO_DOT:R,NO_DOT_SLASH:N,NO_DOTS_SLASH:U,QMARK:C,QMARK_NO_DOT:D,STAR:k,START_ANCHOR:z}=h,H=y=>`(${a}(?:(?!${z}${y.dot?w:x}).)*?)`,A=t.dot?"":R,b=t.dot?C:D,$=t.bash===!0?H(t):k;t.capture&&($=`(${$})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);let p={input:n,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=le.removePrefix(n,p),s=n.length;let j=[],F=[],se=[],f=i,c,Q=()=>p.index===s-1,P=p.peek=(y=1)=>n[p.index+y],ne=p.advance=()=>n[++p.index]||"",Z=()=>n.slice(p.index+1),J=(y="",K=0)=>{p.consumed+=y,p.index+=K},ce=y=>{p.output+=y.output!=null?y.output:y.value,J(y.value)},ie=()=>{let y=1;for(;P()==="!"&&(P(2)!=="("||P(3)==="?");)ne(),p.start++,y++;return y%2==0?!1:(p.negated=!0,p.start++,!0)},me=y=>{p[y]++,se.push(y)},ue=y=>{p[y]--,se.pop()},I=y=>{if(f.type==="globstar"){let K=p.braces>0&&(y.type==="comma"||y.type==="brace"),g=y.extglob===!0||j.length&&(y.type==="pipe"||y.type==="paren");y.type!=="slash"&&y.type!=="paren"&&!K&&!g&&(p.output=p.output.slice(0,-f.output.length),f.type="star",f.value="*",f.output=$,p.output+=f.output)}if(j.length&&y.type!=="paren"&&(j[j.length-1].inner+=y.value),(y.value||y.output)&&ce(y),f&&f.type==="text"&&y.type==="text"){f.value+=y.value,f.output=(f.output||"")+y.value;return}y.prev=f,o.push(y),f=y},fe=(y,K)=>{let g={...d[K],conditions:1,inner:""};g.prev=f,g.parens=p.parens,g.output=p.output;let O=(t.capture?"(":"")+g.open;me("parens"),I({type:y,value:K,output:p.output?"":m}),I({type:"paren",extglob:!0,value:ne(),output:O}),j.push(g)},Ie=y=>{let K=y.close+(t.capture?")":""),g;if(y.type==="negate"){let O=$;y.inner&&y.inner.length>1&&y.inner.includes("/")&&(O=H(t)),(O!==$||Q()||/^\)+$/.test(Z()))&&(K=y.close=`)$))${O}`),y.inner.includes("*")&&(g=Z())&&/^\.[^\\/.]+$/.test(g)&&(K=y.close=`)${g})${O})`),y.prev.type==="bos"&&(p.negatedExtglob=!0)}I({type:"paren",extglob:!0,value:c,output:K}),ue("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let y=!1,K=n.replace(Ko,(g,O,Y,ee,X,_e)=>ee==="\\"?(y=!0,g):ee==="?"?O?O+ee+(X?C.repeat(X.length):""):_e===0?b+(X?C.repeat(X.length):""):C.repeat(Y.length):ee==="."?x.repeat(Y.length):ee==="*"?O?O+ee+(X?$:""):$:O?g:`\\${g}`);return y===!0&&(t.unescape===!0?K=K.replace(/\\/g,""):K=K.replace(/\\+/g,g=>g.length%2==0?"\\\\":g?"\\":"")),K===n&&t.contains===!0?(p.output=n,p):(p.output=le.wrapOutput(K,p,e),p)}for(;!Q();){if(c=ne(),c==="\0")continue;if(c==="\\"){let g=P();if(g==="/"&&t.bash!==!0||g==="."||g===";")continue;if(!g){c+="\\",I({type:"text",value:c});continue}let O=/^\\+/.exec(Z()),Y=0;if(O&&O[0].length>2&&(Y=O[0].length,p.index+=Y,Y%2!=0&&(c+="\\")),t.unescape===!0?c=ne():c+=ne(),p.brackets===0){I({type:"text",value:c});continue}}if(p.brackets>0&&(c!=="]"||f.value==="["||f.value==="[^")){if(t.posix!==!1&&c===":"){let g=f.value.slice(1);if(g.includes("[")&&(f.posix=!0,g.includes(":"))){let O=f.value.lastIndexOf("["),Y=f.value.slice(0,O),ee=f.value.slice(O+2),X=jo[ee];if(X){f.value=Y+X,p.backtrack=!0,ne(),!i.output&&o.indexOf(f)===1&&(i.output=m);continue}}}(c==="["&&P()!==":"||c==="-"&&P()==="]")&&(c=`\\${c}`),c==="]"&&(f.value==="["||f.value==="[^")&&(c=`\\${c}`),t.posix===!0&&c==="!"&&f.value==="["&&(c="^"),f.value+=c,ce({value:c});continue}if(p.quotes===1&&c!=='"'){c=le.escapeRegex(c),f.value+=c,ce({value:c});continue}if(c==='"'){p.quotes=p.quotes===1?0:1,t.keepQuotes===!0&&I({type:"text",value:c});continue}if(c==="("){me("parens"),I({type:"paren",value:c});continue}if(c===")"){if(p.parens===0&&t.strictBrackets===!0)throw new SyntaxError(Be("opening","("));let g=j[j.length-1];if(g&&p.parens===g.parens+1){Ie(j.pop());continue}I({type:"paren",value:c,output:p.parens?")":"\\)"}),ue("parens");continue}if(c==="["){if(t.nobracket===!0||!Z().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(Be("closing","]"));c=`\\${c}`}else me("brackets");I({type:"bracket",value:c});continue}if(c==="]"){if(t.nobracket===!0||f&&f.type==="bracket"&&f.value.length===1){I({type:"text",value:c,output:`\\${c}`});continue}if(p.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(Be("opening","["));I({type:"text",value:c,output:`\\${c}`});continue}ue("brackets");let g=f.value.slice(1);if(f.posix!==!0&&g[0]==="^"&&!g.includes("/")&&(c=`/${c}`),f.value+=c,ce({value:c}),t.literalBrackets===!1||le.hasRegexChars(g))continue;let O=le.escapeRegex(f.value);if(p.output=p.output.slice(0,-f.value.length),t.literalBrackets===!0){p.output+=O,f.value=O;continue}f.value=`(${a}${O}|${f.value})`,p.output+=f.value;continue}if(c==="{"&&t.nobrace!==!0){me("braces");let g={type:"brace",value:c,output:"(",outputIndex:p.output.length,tokensIndex:p.tokens.length};F.push(g),I(g);continue}if(c==="}"){let g=F[F.length-1];if(t.nobrace===!0||!g){I({type:"text",value:c,output:c});continue}let O=")";if(g.dots===!0){let Y=o.slice(),ee=[];for(let X=Y.length-1;X>=0&&(o.pop(),Y[X].type!=="brace");X--)Y[X].type!=="dots"&&ee.unshift(Y[X].value);O=Vo(ee,t),p.backtrack=!0}if(g.comma!==!0&&g.dots!==!0){let Y=p.output.slice(0,g.outputIndex),ee=p.tokens.slice(g.tokensIndex);g.value=g.output="\\{",c=O="\\}",p.output=Y;for(let X of ee)p.output+=X.output||X.value}I({type:"brace",value:c,output:O}),ue("braces"),F.pop();continue}if(c==="|"){j.length>0&&j[j.length-1].conditions++,I({type:"text",value:c});continue}if(c===","){let g=c,O=F[F.length-1];O&&se[se.length-1]==="braces"&&(O.comma=!0,g="|"),I({type:"comma",value:c,output:g});continue}if(c==="/"){if(f.type==="dot"&&p.index===p.start+1){p.start=p.index+1,p.consumed="",p.output="",o.pop(),f=i;continue}I({type:"slash",value:c,output:L});continue}if(c==="."){if(p.braces>0&&f.type==="dot"){f.value==="."&&(f.output=x);let g=F[F.length-1];f.type="dots",f.output+=c,f.value+=c,g.dots=!0;continue}if(p.braces+p.parens===0&&f.type!=="bos"&&f.type!=="slash"){I({type:"text",value:c,output:x});continue}I({type:"dot",value:c,output:x});continue}if(c==="?"){if(!(f&&f.value==="(")&&t.noextglob!==!0&&P()==="("&&P(2)!=="?"){fe("qmark",c);continue}if(f&&f.type==="paren"){let O=P(),Y=c;if(O==="<"&&!le.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(f.value==="("&&!/[!=<:]/.test(O)||O==="<"&&!/<([!=]|\w+>)/.test(Z()))&&(Y=`\\${c}`),I({type:"text",value:c,output:Y});continue}if(t.dot!==!0&&(f.type==="slash"||f.type==="bos")){I({type:"qmark",value:c,output:D});continue}I({type:"qmark",value:c,output:C});continue}if(c==="!"){if(t.noextglob!==!0&&P()==="("&&(P(2)!=="?"||!/[!=<:]/.test(P(3)))){fe("negate",c);continue}if(t.nonegate!==!0&&p.index===0){ie();continue}}if(c==="+"){if(t.noextglob!==!0&&P()==="("&&P(2)!=="?"){fe("plus",c);continue}if(f&&f.value==="("||t.regex===!1){I({type:"plus",value:c,output:T});continue}if(f&&(f.type==="bracket"||f.type==="paren"||f.type==="brace")||p.parens>0){I({type:"plus",value:c});continue}I({type:"plus",value:T});continue}if(c==="@"){if(t.noextglob!==!0&&P()==="("&&P(2)!=="?"){I({type:"at",extglob:!0,value:c,output:""});continue}I({type:"text",value:c});continue}if(c!=="*"){(c==="$"||c==="^")&&(c=`\\${c}`);let g=zo.exec(Z());g&&(c+=g[0],p.index+=g[0].length),I({type:"text",value:c});continue}if(f&&(f.type==="globstar"||f.star===!0)){f.type="star",f.star=!0,f.value+=c,f.output=$,p.backtrack=!0,p.globstar=!0,J(c);continue}let y=Z();if(t.noextglob!==!0&&/^\([^?]/.test(y)){fe("star",c);continue}if(f.type==="star"){if(t.noglobstar===!0){J(c);continue}let g=f.prev,O=g.prev,Y=g.type==="slash"||g.type==="bos",ee=O&&(O.type==="star"||O.type==="globstar");if(t.bash===!0&&(!Y||y[0]&&y[0]!=="/")){I({type:"star",value:c,output:""});continue}let X=p.braces>0&&(g.type==="comma"||g.type==="brace"),_e=j.length&&(g.type==="pipe"||g.type==="paren");if(!Y&&g.type!=="paren"&&!X&&!_e){I({type:"star",value:c,output:""});continue}for(;y.slice(0,3)==="/**";){let Te=n[p.index+4];if(Te&&Te!=="/")break;y=y.slice(3),J("/**",3)}if(g.type==="bos"&&Q()){f.type="globstar",f.value+=c,f.output=H(t),p.output=f.output,p.globstar=!0,J(c);continue}if(g.type==="slash"&&g.prev.type!=="bos"&&!ee&&Q()){p.output=p.output.slice(0,-(g.output+f.output).length),g.output=`(?:${g.output}`,f.type="globstar",f.output=H(t)+(t.strictSlashes?")":"|$)"),f.value+=c,p.globstar=!0,p.output+=g.output+f.output,J(c);continue}if(g.type==="slash"&&g.prev.type!=="bos"&&y[0]==="/"){let Te=y[1]!==void 0?"|$":"";p.output=p.output.slice(0,-(g.output+f.output).length),g.output=`(?:${g.output}`,f.type="globstar",f.output=`${H(t)}${L}|${L}${Te})`,f.value+=c,p.output+=g.output+f.output,p.globstar=!0,J(c+ne()),I({type:"slash",value:"/",output:""});continue}if(g.type==="bos"&&y[0]==="/"){f.type="globstar",f.value+=c,f.output=`(?:^|${L}|${H(t)}${L})`,p.output=f.output,p.globstar=!0,J(c+ne()),I({type:"slash",value:"/",output:""});continue}p.output=p.output.slice(0,-f.output.length),f.type="globstar",f.output=H(t),f.value+=c,p.output+=f.output,p.globstar=!0,J(c);continue}let K={type:"star",value:c,output:$};if(t.bash===!0){K.output=".*?",(f.type==="bos"||f.type==="slash")&&(K.output=A+K.output),I(K);continue}if(f&&(f.type==="bracket"||f.type==="paren")&&t.regex===!0){K.output=c,I(K);continue}(p.index===p.start||f.type==="slash"||f.type==="dot")&&(f.type==="dot"?(p.output+=N,f.output+=N):t.dot===!0?(p.output+=U,f.output+=U):(p.output+=A,f.output+=A),P()!=="*"&&(p.output+=m,f.output+=m)),I(K)}for(;p.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(Be("closing","]"));p.output=le.escapeLast(p.output,"["),ue("brackets")}for(;p.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(Be("closing",")"));p.output=le.escapeLast(p.output,"("),ue("parens")}for(;p.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(Be("closing","}"));p.output=le.escapeLast(p.output,"{"),ue("braces")}if(t.strictSlashes!==!0&&(f.type==="star"||f.type==="bracket")&&I({type:"maybe_slash",value:"",output:`${L}?`}),p.backtrack===!0){p.output="";for(let y of p.tokens)p.output+=y.output!=null?y.output:y.value,y.suffix&&(p.output+=y.suffix)}return p};vr.fastpaths=(n,e)=>{let t={...e},r=typeof t.maxLength=="number"?Math.min(ft,t.maxLength):ft,s=n.length;if(s>r)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${r}`);n=_r[n]||n;let i=le.isWindows(e),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:l,DOTS_SLASH:h,NO_DOT:d,NO_DOTS:x,NO_DOTS_SLASH:T,STAR:L,START_ANCHOR:m}=ct.globChars(i),w=t.dot?x:d,R=t.dot?T:d,N=t.capture?"":"?:",U={negated:!1,prefix:""},C=t.bash===!0?".*?":L;t.capture&&(C=`(${C})`);let D=A=>A.noglobstar===!0?C:`(${N}(?:(?!${m}${A.dot?h:o}).)*?)`,k=A=>{switch(A){case"*":return`${w}${l}${C}`;case".*":return`${o}${l}${C}`;case"*.*":return`${w}${C}${o}${l}${C}`;case"*/*":return`${w}${C}${a}${l}${R}${C}`;case"**":return w+D(t);case"**/*":return`(?:${w}${D(t)}${a})?${R}${l}${C}`;case"**/*.*":return`(?:${w}${D(t)}${a})?${R}${C}${o}${l}${C}`;case"**/.*":return`(?:${w}${D(t)}${a})?${o}${l}${C}`;default:{let b=/^(.*?)\.(\w+)$/.exec(A);if(!b)return;let $=k(b[1]);return $?$+o+b[2]:void 0}}},z=le.removePrefix(n,U),H=k(z);return H&&t.strictSlashes!==!0&&(H+=`${a}?`),H};mr.exports=vr});var Er=Re((kl,xr)=>{"use strict";var Go=lt(),Yo=pr(),Xt=gr(),Wt=ht(),$o=ze(),Xo=n=>n&&typeof n=="object"&&!Array.isArray(n),q=(n,e,t=!1)=>{if(Array.isArray(n)){let d=n.map(T=>q(T,e,t));return T=>{for(let L of d){let m=L(T);if(m)return m}return!1}}let r=Xo(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let s=e||{},i=Wt.isWindows(e),o=r?q.compileRe(n,e):q.makeRe(n,e,!1,!0),a=o.state;delete o.state;let l=()=>!1;if(s.ignore){let d={...e,ignore:null,onMatch:null,onResult:null};l=q(s.ignore,d,t)}let h=(d,x=!1)=>{let{isMatch:T,match:L,output:m}=q.test(d,o,e,{glob:n,posix:i}),w={glob:n,state:a,regex:o,posix:i,input:d,output:m,match:L,isMatch:T};return typeof s.onResult=="function"&&s.onResult(w),T===!1?(w.isMatch=!1,x?w:!1):l(d)?(typeof s.onIgnore=="function"&&s.onIgnore(w),w.isMatch=!1,x?w:!1):(typeof s.onMatch=="function"&&s.onMatch(w),x?w:!0)};return t&&(h.state=a),h};q.test=(n,e,t,{glob:r,posix:s}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let i=t||{},o=i.format||(s?Wt.toPosixSlashes:null),a=n===r,l=a&&o?o(n):n;return a===!1&&(l=o?o(n):n,a=l===r),(a===!1||i.capture===!0)&&(i.matchBase===!0||i.basename===!0?a=q.matchBase(n,e,t,s):a=e.exec(l)),{isMatch:Boolean(a),match:a,output:l}};q.matchBase=(n,e,t,r=Wt.isWindows(t))=>(e instanceof RegExp?e:q.makeRe(e,t)).test(Go.basename(n));q.isMatch=(n,e,t)=>q(e,t)(n);q.parse=(n,e)=>Array.isArray(n)?n.map(t=>q.parse(t,e)):Xt(n,{...e,fastpaths:!1});q.scan=(n,e)=>Yo(n,e);q.compileRe=(n,e,t=!1,r=!1)=>{if(t===!0)return n.output;let s=e||{},i=s.contains?"":"^",o=s.contains?"":"$",a=`${i}(?:${n.output})${o}`;n&&n.negated===!0&&(a=`^(?!${a}).*$`);let l=q.toRegex(a,e);return r===!0&&(l.state=n),l};q.makeRe=(n,e={},t=!1,r=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let s={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(s.output=Xt.fastpaths(n,e)),s.output||(s=Xt(n,e)),q.compileRe(s,e,t,r)};q.toRegex=(n,e)=>{try{let t=e||{};return new RegExp(n,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}};q.constants=$o;xr.exports=q});var wr=Re((Hl,yr)=>{"use strict";yr.exports=Er()});var ys=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,ws=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,_n="noscale",xt="fit",vn="scale",gn="fill",xn="stretch",As=300,Ts=150,bs=xt,Ss=200,En=class extends HTMLElement{static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=ys,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=ws,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._contentElement=this.shadowRoot.querySelector(".content"),this._innerElement=this.shadowRoot.querySelector("#inner"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=As,this._height=Ts,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Oe(this,"mode"),Oe(this,"debug"),Oe(this,"disabled"),Oe(this,"width"),Oe(this,"height"),Oe(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",bs),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,r){switch(e){case"debug":this._debug=r!==null;break;case"disabled":this._disabled=r!==null;break;case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this);break}switch(e){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r);break}}getContext(e="2d",t=void 0){return this._canvasElement.getContext(e,t)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);let t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this._debug){let r=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.textContent!==r&&(this._fpsElement.textContent=r),this.mode===_n){let i=`${this._width}x${this._height}`;this._dimensionElement.textContent!==i&&(this._dimensionElement.textContent=i)}else{let i=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==i&&(this._dimensionElement.textContent=i)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:t,canvas:this._canvasElement},bubbles:!1,composed:!0}))}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(e,t){(e!==this._resizeCanvasWidth||t!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=e,this._resizeCanvasHeight=t,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,Ss))}updateCanvasSize(e=!0){let t=this.shadowRoot.host.getBoundingClientRect(),r=t.width,s=t.height,i=this._canvasElement,o=this._width,a=this._height,l=this.mode;if(l===xn||l===gn)o=r,a=s;else if(l!==_n&&(r<o||s<a||l===xt||l==vn)){let d=r/o,x=s/a;d<x?(o=r,a=a*d):(o=o*x,a=s)}if(o=Math.floor(o),a=Math.floor(a),typeof e=="undefined"&&(e=i.clientWidth!==o||i.clientHeight!==a),!e){this.delayCanvasResize(o,a);return}let h=Math.min(o/this._width,a/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${h}em`,e){l===vn?(i.width=this._width,i.height=this._height):l!==xn&&(i.width=o,i.height=a);let d=this._contentElement.style;d.width=`${o}px`,d.height=`${a}px`,(l===xt||l===gn)&&(this._width=o,this._height=a),this.dispatchEvent(new CustomEvent("resize",{detail:{width:o,height:a},bubbles:!1,composed:!0}))}}};En.define();function Oe(n,e){if(Object.prototype.hasOwnProperty.call(n,e)){let t=n[e];delete n[e],n[e]=t}}var Et=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(e){this._size=e,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(e){this._size=e}getState(e){throw new Error("Missing implementation.")}onUpdate(e,t,r){throw new Error("Missing implementation.")}onStatus(e,t){throw new Error("Missing implementation.")}onPoll(e){this._lastPollingTime=e}onBind(e,t={}){e>=this._size&&this.resize(e+1)}onUnbind(){this.resize(0)}},ke=class extends Et{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(e=0){super(e);let t=new Array;for(let r=0;r<e;++r)t.push(this.constructor.createAxisBindingState());this._state=t,this._value=0,this._delta=0}resize(e){let t=this._state,r=t.length,s;if(e<=r)s=t.slice(0,e);else{s=t;for(let i=r;i<e;++i)s.push(this.constructor.createAxisBindingState())}this._state=s,super.resize(e)}getState(e){return this._state[e].value}onPoll(e){let t=this._state,r=0,s=0,i=t.length;for(let o=0;o<i;++o){let a=t[o];r+=a.value*(a.inverted?-1:1),s+=a.delta,t[o].delta=0}this._value=r,this._delta=s,super.onPoll(e)}onUpdate(e,t,r){typeof t=="undefined"?this.onAxisChange(e,r):this.onAxisMove(e,t,r)}onStatus(e,t){this.onAxisStatus(e,t)}onBind(e,t={}){super.onBind(e,t);let{inverted:r=!1}=t,s=this._state;s[e].inverted=r}onAxisMove(e,t,r){let s=this._state[e];s.value=t,s.delta+=r}onAxisChange(e,t){let r=this._state[e];r.value+=t,r.delta+=t}onAxisStatus(e,t){let r=this._state[e],s=r.value;r.value=t,r.delta=t-s}},Rs=241,yn=254,Ms=239,Me=1,yt=2,wt=4,At=8,Tt=16,Je=class extends Et{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(e=0){super(e);this._state=new Uint8Array(e),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(e){let t=this._state,r=t.length,s;e<=r?s=t.slice(0,e):(s=new Uint8Array(e),s.set(t)),this._state=s,super.resize(e)}getState(e){let t=this._state[e],r=t&Tt?-1:1;return(t&Me?1:0)*r}onPoll(e){let t=this._state,r=0,s=0,i=0,o=0,a=0,l=t.length;for(let h=0;h<l;++h){let d=t[h],x=d&Me,T=d&Tt;s|=x,i|=d&yt,o|=d&wt,a|=d&At,r+=(x?1:0)*(T?-1:1),t[h]&=Rs}this._value=r,this._down=s!==0,this._pressed=i!==0,this._repeated=o!==0,this._released=a!==0,super.onPoll(e)}onUpdate(e,t,r){r>0?this.onButtonPressed(e):this.onButtonReleased(e)}onStatus(e,t){this.onButtonStatus(e,t!==0)}onBind(e,t={}){super.onBind(e,t);let{inverted:r=!1}=t,s=this._state;r?s[e]|=Tt:s[e]&=Ms}onButtonPressed(e){let t=this._state,r=t[e];r&Me||(r|=yt,r|=Me),r|=wt,t[e]=r}onButtonReleased(e){let t=this._state,r=t[e];r&Me&&(r|=At,r&=yn),t[e]=r}onButtonStatus(e,t){let r=this._state,s=r[e],i=Boolean(s&Me);t?s|=Me:s&=yn,i&&!t&&(s|=At),!i&&t&&(s|=yt,s|=wt),r[e]=s}},et=class{static parse(e){e=e.trim();let t=e.indexOf(".");if(t<0)throw new Error("Missing device separator for key code.");let r=e.substring(0,t);if(r.length<0)throw new Error("Missing device for key code.");let s=e.substring(t+1);if(s.length<0)throw new Error("Missing code for key code.");return new et(r,s)}constructor(e,t){this.device=e,this.code=t}toString(){return`${this.device}.${this.code}`}};function Ls(n,e){return new et(n,e)}var bt=class{get polling(){return this.ref?this.ref.polling:!1}get value(){return this.ref?this.ref.value:0}constructor(e){this.name=e,this.ref=null}register(e){throw new Error("Unsupported operation.")}getState(e){return this.ref?this.ref.getState(e):0}},E=class{static parse(e){e=e.trim();let t=e.indexOf(".");if(t<0)throw new Error("Missing device separator for key code.");let r=e.substring(0,t);if(r.length<0)throw new Error("Missing device for key code.");let s=e.substring(t+1);if(s.length<0)throw new Error("Missing code for key code.");return new E(r,s)}constructor(e,t){this.device=e,this.code=t}toString(){return`${this.device}.${this.code}`}};function wn(n,e){return new E(n,e)}function Cs(n){return"device"in n&&"code"in n}var S="Keyboard",de="Mouse",Is=new E(S,"KeyA"),Os=new E(S,"KeyB"),Ns=new E(S,"KeyC"),Bs=new E(S,"KeyD"),Ds=new E(S,"KeyE"),Ps=new E(S,"KeyF"),Fs=new E(S,"KeyG"),Us=new E(S,"KeyH"),ks=new E(S,"KeyI"),Hs=new E(S,"KeyJ"),js=new E(S,"KeyK"),zs=new E(S,"KeyL"),Ks=new E(S,"KeyM"),Vs=new E(S,"KeyN"),Gs=new E(S,"KeyO"),Ys=new E(S,"KeyP"),$s=new E(S,"KeyQ"),Xs=new E(S,"KeyR"),Ws=new E(S,"KeyS"),qs=new E(S,"KeyT"),Qs=new E(S,"KeyU"),Zs=new E(S,"KeyV"),Js=new E(S,"KeyW"),ei=new E(S,"KeyX"),ti=new E(S,"KeyY"),ni=new E(S,"KeyZ"),ri=new E(S,"Digit0"),si=new E(S,"Digit1"),ii=new E(S,"Digit2"),oi=new E(S,"Digit3"),ai=new E(S,"Digit4"),li=new E(S,"Digit5"),ui=new E(S,"Digit6"),hi=new E(S,"Digit7"),ci=new E(S,"Digit8"),fi=new E(S,"Digit9"),di=new E(S,"Minus"),pi=new E(S,"Equal"),mi=new E(S,"BracketLeft"),_i=new E(S,"BracketRight"),vi=new E(S,"Semicolon"),gi=new E(S,"Quote"),xi=new E(S,"Backquote"),Ei=new E(S,"Backslash"),yi=new E(S,"Comma"),wi=new E(S,"Period"),Ai=new E(S,"Slash"),Ti=new E(S,"Escape"),bi=new E(S,"Space"),Si=new E(S,"CapsLock"),Ri=new E(S,"Backspace"),Mi=new E(S,"Delete"),Li=new E(S,"Tab"),Ci=new E(S,"Enter"),Ii=new E(S,"ArrowUp"),Oi=new E(S,"ArrowDown"),Ni=new E(S,"ArrowLeft"),Bi=new E(S,"ArrowRight"),Di=new E(de,"Button0"),Pi=new E(de,"Button1"),Fi=new E(de,"Button2"),Ui=new E(de,"Button3"),ki=new E(de,"Button4"),Hi=new E(de,"PosX"),ji=new E(de,"PosY"),zi=new E(de,"WheelX"),Ki=new E(de,"WheelY"),Vi=new E(de,"WheelZ"),ae=Object.freeze({__proto__:null,from:wn,isKeyCode:Cs,KEYBOARD:S,MOUSE:de,KEY_A:Is,KEY_B:Os,KEY_C:Ns,KEY_D:Bs,KEY_E:Ds,KEY_F:Ps,KEY_G:Fs,KEY_H:Us,KEY_I:ks,KEY_J:Hs,KEY_K:js,KEY_L:zs,KEY_M:Ks,KEY_N:Vs,KEY_O:Gs,KEY_P:Ys,KEY_Q:$s,KEY_R:Xs,KEY_S:Ws,KEY_T:qs,KEY_U:Qs,KEY_V:Zs,KEY_W:Js,KEY_X:ei,KEY_Y:ti,KEY_Z:ni,DIGIT_0:ri,DIGIT_1:si,DIGIT_2:ii,DIGIT_3:oi,DIGIT_4:ai,DIGIT_5:li,DIGIT_6:ui,DIGIT_7:hi,DIGIT_8:ci,DIGIT_9:fi,MINUS:di,EQUAL:pi,BRACKET_LEFT:mi,BRACKET_RIGHT:_i,SEMICOLON:vi,QUOTE:gi,BACKQUOTE:xi,BACKSLASH:Ei,COMMA:yi,PERIOD:wi,SLASH:Ai,ESCAPE:Ti,SPACE:bi,CAPS_LOCK:Si,BACKSPACE:Ri,DELETE:Mi,TAB:Li,ENTER:Ci,ARROW_UP:Ii,ARROW_DOWN:Oi,ARROW_LEFT:Ni,ARROW_RIGHT:Bi,MOUSE_BUTTON_0:Di,MOUSE_BUTTON_1:Pi,MOUSE_BUTTON_2:Fi,MOUSE_BUTTON_3:Ui,MOUSE_BUTTON_4:ki,MOUSE_POS_X:Hi,MOUSE_POS_Y:ji,MOUSE_WHEEL_X:zi,MOUSE_WHEEL_Y:Ki,MOUSE_WHEEL_Z:Vi});function An(n){Array.isArray(n)||(n=[n]);let e=[];for(let t of n){let r;try{r=E.parse(t)}catch(s){let i=Gi(t).toUpperCase();if(!(i in ae))throw new Error("Invalid key code string - "+s);r=ae[i]}e.push(r)}return e}function Gi(n){return n.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,function(e,t,r){return t+(r&&"_"+r)}).toLowerCase()}var ve=class extends bt{static fromBind(e,t,r,s=void 0){return new ve(e,Ls(t,r),s)}static fromString(e,...t){let r=An(t);return new ve(e,r)}get delta(){return this.ref?this.ref.delta:0}constructor(e,t,r=void 0){super(e);this.keyCodes=Array.isArray(t)?t:[t],this.opts=r}register(e){let t=this.name,r=this.opts;for(let s of this.keyCodes)e.bindAxis(t,s.device,s.code,r);return this.ref=e.getAxis(t),this}},W=class extends bt{static fromBind(e,t,r,s=void 0){return new W(e,wn(t,r),s)}static fromString(e,...t){let r=An(t);return new W(e,r)}get pressed(){return this.ref?this.ref.pressed:!1}get repeated(){return this.ref?this.ref.repeated:!1}get released(){return this.ref?this.ref.released:!1}get down(){return this.ref?this.ref.down:!1}constructor(e,t,r=void 0){super(e);this.keyCodes=Array.isArray(t)?t:[t],this.opts=r}register(e){let t=this.name,r=this.opts;for(let s of this.keyCodes)e.bindButton(t,s.device,s.code,r);return this.ref=e.getButton(t),this}};var St=class{static isAxis(e){return!1}static isButton(e){return!1}constructor(e,t){if(!t)throw new Error(`Missing event target for device ${e}.`);this.name=e,this.eventTarget=t,this.listeners={input:[]}}setEventTarget(e){if(!e)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=e}destroy(){let e=this.listeners;for(let t in e)e[t].length=0}addEventListener(e,t){let r=this.listeners;e in r?r[e].push(t):r[e]=[t]}removeEventListener(e,t){let r=this.listeners;if(e in r){let s=r[e],i=s.indexOf(t);i>=0&&s.splice(i,1)}}dispatchInputEvent(e){let t=0;for(let r of this.listeners.input)t|=r(e);return Boolean(t)}},Tn=class extends St{static isAxis(e){return!1}static isButton(e){return!0}constructor(e,t,r={}){super(e,t);let{ignoreRepeat:s=!0}=r;this.ignoreRepeat=s,this._eventObject={target:t,device:e,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}setEventTarget(e){this.eventTarget&&this.destroy(),super.setEventTarget(e),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat&&this.ignoreRepeat)return e.preventDefault(),e.stopPropagation(),!1;let t=this._eventObject;if(t.code=e.code,t.event="pressed",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t))return e.preventDefault(),e.stopPropagation(),!1}onKeyUp(e){let t=this._eventObject;if(t.code=e.code,t.event="released",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t))return e.preventDefault(),e.stopPropagation(),!1}},Rt=10,Mt=100,bn=class extends St{static isAxis(e){return e==="PosX"||e==="PosY"||e==="WheelX"||e==="WheelY"||e==="WheelZ"}static isButton(e){return!this.isAxis(e)}constructor(e,t,r={}){super(e,t);let{eventsOnFocus:s=!0}=r;this.eventsOnFocus=s,this.canvasTarget=this.getCanvasFromEventTarget(t),this._downHasFocus=!1,this._eventObject={target:t,device:e,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:t,device:e,code:"",event:"move",value:0,movement:0},this._wheelObject={target:t,device:e,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(e){this.eventTarget&&this.destroy(),super.setEventTarget(e),this.canvasTarget=this.getCanvasFromEventTarget(e),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let t=this._eventObject;if(t.code="Button"+e.button,t.event="pressed",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let t,r,s;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:t=e.deltaX*Rt,r=e.deltaY*Rt,s=e.deltaZ*Rt;break;case WheelEvent.DOM_DELTA_PAGE:t=e.deltaX*Mt,r=e.deltaY*Mt,s=e.deltaZ*Mt;break;case WheelEvent.DOM_DELTA_PIXEL:default:t=e.deltaX,r=e.deltaY,s=e.deltaZ;break}let i=0,o=this._wheelObject;if(o.code="WheelX",o.movement=t,i|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=r,i|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=s,i|=this.dispatchInputEvent(o),i)return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let t=this._eventObject;if(t.code="Button"+e.button,t.event="released",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t))return e.preventDefault(),e.stopPropagation(),!1}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let t=this.canvasTarget,{clientWidth:r,clientHeight:s}=t,i=t.getBoundingClientRect(),o=e.movementX/r,a=e.movementY/s,l=(e.clientX-i.left)/r,h=(e.clientY-i.top)/s,d=this._positionObject;d.code="PosX",d.value=l,d.movement=o,this.dispatchInputEvent(d),d.code="PosY",d.value=h,d.movement=a,this.dispatchInputEvent(d)}getCanvasFromEventTarget(e){return e instanceof HTMLCanvasElement?e:e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e}},Yi=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,$i=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Lt=class extends HTMLElement{static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Yi,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=$i,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(e,t,r){switch(e){case"name":this._name=r,this._nameElement.textContent=r;break;case"value":this._value=r,r!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=r,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=r!==null,this._kbdElement.classList.toggle("disabled",r!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}};Lt.define();var Xi=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,Wi=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,Sn=class{constructor(e){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=e}get running(){return this.animationFrameHandle!==null}start(){let e=this.animationFrameHandle;e&&cancelAnimationFrame(e),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let e=this.animationFrameHandle;e&&cancelAnimationFrame(e),this.animationFrameHandle=null}onAnimationFrame(e){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(e)}},Rn=class{constructor(e){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=e}onPoll(e){for(let t of this.bindings.getInputs())t.onPoll(e)}onInput(e){let{device:t,code:r,event:s,value:i,movement:o,control:a,shift:l,alt:h}=e,d=this.bindings.getBindings(t,r);switch(s){case"pressed":for(let{input:x,index:T}of d)x.onUpdate(T,1,1);break;case"released":for(let{input:x,index:T}of d)x.onUpdate(T,0,-1);break;case"move":for(let{input:x,index:T}of d)x.onUpdate(T,i,o);break;case"wheel":for(let{input:x,index:T}of d)x.onUpdate(T,void 0,o);break}return d.length>0}},Ct=class{constructor(e,t,r,s){this.device=e,this.code=t,this.input=r,this.index=s}},Mn=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let e of this.inputMap.keys())e.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(e,t,r,s={}){let i,o=this.inputMap;if(o.has(e)){let l=o.get(e),h=e.size;e.onBind(h,s),i=new Ct(t,r,e,h),l.push(i)}else{let l=[];o.set(e,l);let h=0;e.onBind(h,s),i=new Ct(t,r,e,h),l.push(i)}let a=this.bindingMap;t in a?r in a[t]?a[t][r].push(i):a[t][r]=[i]:a[t]={[r]:[i]}}unbind(e){let t=this.inputMap;if(t.has(e)){let r=this.bindingMap,s=t.get(e);for(let i of s){let{device:o,code:a}=i,l=r[o][a],h=l.indexOf(i);l.splice(h,1)}s.length=0,e.onUnbind(),t.delete(e)}}isBound(e){return this.inputMap.has(e)}getInputs(){return this.inputMap.keys()}getBindingsByInput(e){return this.inputMap.get(e)}getBindings(e,t){let r=this.bindingMap;if(e in r){let s=r[e];if(t in s)return s[t]}return[]}},Ln=class{constructor(e,t={}){this.inputs={},this.devices=[new bn("Mouse",e),new Tn("Keyboard",e)],this.bindings=new Mn,this.adapter=new Rn(this.bindings),this.autopoller=new Sn(this.adapter),this.eventTarget=e,this.anyButton=new Je(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new ke(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),e.addEventListener("focus",this.onEventTargetFocus),e.addEventListener("blur",this.onEventTargetBlur);for(let r of this.devices)r.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(e=void 0){this.toggleAutoPoll(e)}destroy(){let e=this.listeners;for(let r in e)e[r].length=0;this.autopoller.running&&this.autopoller.stop();for(let r of this.devices)r.removeEventListener("input",this.onInput),r.destroy();let t=this.eventTarget;t.removeEventListener("focus",this.onEventTargetFocus),t.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(e){let t=this.eventTarget;t.removeEventListener("focus",this.onEventTargetFocus),t.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=e;for(let r of this.devices)r.setEventTarget(e);e.addEventListener("focus",this.onEventTargetFocus),e.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(e=void 0){let t=this.autopoller.running,r=typeof e=="undefined"?!t:Boolean(e);r!==t&&(r?this.autopoller.start():this.autopoller.stop())}addEventListener(e,t){let r=this.listeners;e in r?r[e].push(t):r[e]=[t]}removeEventListener(e,t){let r=this.listeners;if(e in r){let s=r[e],i=s.indexOf(t);i>=0&&s.splice(i,1)}}dispatchEvent(e){let{type:t}=e,r=0;for(let s of this.listeners[t])r|=s(e);return Boolean(r)}poll(e=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(e)}onInput(e){let t=this.adapter.onInput(e);switch(e.event){case"pressed":this.anyButtonDevice=e.device,this.anyButtonCode=e.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=e.device,this.anyButtonCode=e.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=e.device,this.anyAxisCode=e.code,this.anyAxis.onUpdate(0,e.value,e.movement);break}return t}onPoll(e){this.adapter.onPoll(e),this.anyButton.onPoll(e),this.anyAxis.onPoll(e)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let e of this.bindings.getInputs())e.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(e){for(let t of e)t.register(this)}bindButton(e,t,r,s=void 0){let i;this.hasButton(e)?i=this.getButton(e):(i=new Je(1),this.inputs[e]=i),this.bindings.bind(i,t,r,s),this.onBind()}bindAxis(e,t,r,s=void 0){let i;this.hasAxis(e)?i=this.getAxis(e):(i=new ke(1),this.inputs[e]=i),this.bindings.bind(i,t,r,s),this.onBind()}bindAxisButtons(e,t,r,s){let i;this.hasAxis(e)?i=this.getAxis(e):(i=new ke(2),this.inputs[e]=i),this.bindings.bind(i,t,s),this.bindings.bind(i,t,r,{inverted:!0}),this.onBind()}unbindButton(e){if(this.hasButton(e)){let t=this.getButton(e);delete this.inputs[e],this.bindings.unbind(t),this.onUnbind()}}unbindAxis(e){if(this.hasAxis(e)){let t=this.getAxis(e);delete this.inputs[e],this.bindings.unbind(t),this.onUnbind()}}getInput(e){return this.inputs[e]}getButton(e){return this.inputs[e]}getAxis(e){return this.inputs[e]}hasButton(e){return e in this.inputs&&this.inputs[e]instanceof Je}hasAxis(e){return e in this.inputs&&this.inputs[e]instanceof ke}isButtonDown(e){return this.inputs[e].down}isButtonPressed(e){return this.inputs[e].pressed}isButtonReleased(e){return this.inputs[e].released}getInputValue(e){return this.inputs[e].value}getButtonValue(e){return this.inputs[e].value}getAxisValue(e){return this.inputs[e].value}getAxisDelta(e){return this.inputs[e].delta}isAnyButtonDown(e=void 0){if(typeof e=="undefined")return this.anyButton.down;{let t=this.inputs;for(let r of e)if(t[r].down)return!0}return!1}isAnyButtonPressed(e=void 0){if(typeof e=="undefined")return this.anyButton.pressed;{let t=this.inputs;for(let r of e)if(t[r].pressed)return!0}return!1}isAnyButtonReleased(e=void 0){if(typeof e=="undefined")return this.anyButton.released;{let t=this.inputs;for(let r of e)if(t[r].released)return!0}return!1}getAnyAxisValue(e=void 0){if(typeof e=="undefined")return this.anyAxis.value;{let t=this.inputs;for(let r of e){let s=t[r];if(s.value)return s.value}}return 0}getAnyAxisDelta(e=void 0){if(typeof e=="undefined")return this.anyAxis.delta;{let t=this.inputs;for(let r of e){let s=t[r];if(s.delta)return s.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},Cn=class extends HTMLElement{static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Xi,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=Wi,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let e=this;this._for="",this._eventTarget=e,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){this._context&&(this._context.removeEventListener("bind",this.onInputContextBind),this._context.removeEventListener("unbind",this.onInputContextUnbind),this._context.removeEventListener("blur",this.onInputContextBlur),this._context.removeEventListener("focus",this.onInputContextFocus),this._context.destroy(),this._context=null)}attributeChangedCallback(e,t,r){switch(e){case"for":{this._for=r;let s,i;r?(s=document.getElementById(r),i=`${s.tagName.toLowerCase()}#${r}`):(s=this,i="input-port"),this._eventTarget=s,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${i}`}break;case"autopoll":this._autopoll=r!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){this.updateTable()}onInputContextUnbind(){this.updateTable()}onInputContextFocus(){this._focusElement.innerHTML="\u2713"}onInputContextBlur(){this._focusElement.innerHTML=""}getContext(e="axisbutton",t=void 0){switch(e){case"axisbutton":return this._context||(this._context=new Ln(this._eventTarget,t),this._context.addEventListener("bind",this.onInputContextBind),this._context.addEventListener("unbind",this.onInputContextUnbind),this._context.addEventListener("blur",this.onInputContextBlur),this._context.addEventListener("focus",this.onInputContextFocus),this._autopoll&&this._context.toggleAutoPoll(!0)),this._context;default:throw new Error(`Input context id '${e}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let e=this._context,t=e.inputs,r=e.bindings,s={},i=[];for(let o of Object.keys(t)){let a=t[o],l=!0;for(let h of r.getBindingsByInput(a)){let d=qi(`${a.constructor.name}.${o}`,`${h.device}.${h.code}`,0,l);i.push(d),l&&(s[o]=d.querySelector("output"),l=!1)}}this._outputElements=s,this._bodyElement.innerHTML="";for(let o of i)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let r of Object.keys(this._outputElements)){let s=this._outputElements[r],i=t[r].value;s.innerText=Number(i).toFixed(2)}}else{for(let e of Object.keys(this._outputElements)){let t=this._outputElements[e];t.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let r of Object.values(t))if(!r.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};Cn.define();function qi(n,e,t,r=!0){let s=document.createElement("tr");r&&s.classList.add("primary");{let i=document.createElement("td");i.textContent=n,i.classList.add("name"),s.appendChild(i)}{let i=document.createElement("td"),o=document.createElement("output");r?o.innerText=Number(t).toFixed(2):o.innerText="---",o.classList.add("value"),i.appendChild(o),s.appendChild(i)}{let i=document.createElement("td");i.classList.add("key");let o=new Lt;o.innerText=e,i.appendChild(o),s.appendChild(i)}return s}var Ll=Symbol("keyboardSource");var Cl=Symbol("mouseSource");var In={},Qi=function(n,e,t,r,s){var i=new Worker(In[e]||(In[e]=URL.createObjectURL(new Blob([n],{type:"text/javascript"}))));return i.onerror=function(o){return s(o.error,null)},i.onmessage=function(o){return s(null,o.data)},i.postMessage(t,r),i},re=Uint8Array,ge=Uint16Array,He=Uint32Array,It=new re([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ot=new re([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),On=new re([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nn=function(n,e){for(var t=new ge(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var s=new He(t[30]),r=1;r<30;++r)for(var i=t[r];i<t[r+1];++i)s[i]=i-t[r]<<5|r;return[t,s]},Bn=Nn(It,2),Nt=Bn[0],Zi=Bn[1];Nt[28]=258,Zi[258]=28;var Dn=Nn(Ot,0),Pn=Dn[0],Ol=Dn[1],tt=new ge(32768);for(var V=0;V<32768;++V)we=(V&43690)>>>1|(V&21845)<<1,we=(we&52428)>>>2|(we&13107)<<2,we=(we&61680)>>>4|(we&3855)<<4,tt[V]=((we&65280)>>>8|(we&255)<<8)>>>1;var we,Ne=function(n,e,t){for(var r=n.length,s=0,i=new ge(e);s<r;++s)++i[n[s]-1];var o=new ge(e);for(s=0;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;var a;if(t){a=new ge(1<<e);var l=15-e;for(s=0;s<r;++s)if(n[s])for(var h=s<<4|n[s],d=e-n[s],x=o[n[s]-1]++<<d,T=x|(1<<d)-1;x<=T;++x)a[tt[x]>>>l]=h}else for(a=new ge(r),s=0;s<r;++s)n[s]&&(a[s]=tt[o[n[s]-1]++]>>>15-n[s]);return a},je=new re(288);for(var V=0;V<144;++V)je[V]=8;for(var V=144;V<256;++V)je[V]=9;for(var V=256;V<280;++V)je[V]=7;for(var V=280;V<288;++V)je[V]=8;var Fn=new re(32);for(var V=0;V<32;++V)Fn[V]=5;var Un=Ne(je,9,1);var kn=Ne(Fn,5,1),nt=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},he=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},rt=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Hn=function(n){return(n/8|0)+(n&7&&1)},st=function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var r=new(n instanceof ge?ge:n instanceof He?He:re)(t-e);return r.set(n.subarray(e,t)),r},jn=function(n,e,t){var r=n.length;if(!r||t&&!t.l&&r<5)return e||new re(0);var s=!e||t,i=!t||t.i;t||(t={}),e||(e=new re(r*3));var o=function(I){var fe=e.length;if(I>fe){var Ie=new re(Math.max(fe*2,I));Ie.set(e),e=Ie}},a=t.f||0,l=t.p||0,h=t.b||0,d=t.l,x=t.d,T=t.m,L=t.n,m=r*8;do{if(!d){t.f=a=he(n,l,1);var w=he(n,l+1,3);if(l+=3,w)if(w==1)d=Un,x=kn,T=9,L=5;else if(w==2){var C=he(n,l,31)+257,D=he(n,l+10,15)+4,k=C+he(n,l+5,31)+1;l+=14;for(var z=new re(k),H=new re(19),A=0;A<D;++A)H[On[A]]=he(n,l+A*3,7);l+=D*3;for(var b=nt(H),$=(1<<b)-1,p=Ne(H,b,1),A=0;A<k;){var j=p[he(n,l,$)];l+=j&15;var R=j>>>4;if(R<16)z[A++]=R;else{var F=0,se=0;for(R==16?(se=3+he(n,l,3),l+=2,F=z[A-1]):R==17?(se=3+he(n,l,7),l+=3):R==18&&(se=11+he(n,l,127),l+=7);se--;)z[A++]=F}}var f=z.subarray(0,C),c=z.subarray(C);T=nt(f),L=nt(c),d=Ne(f,T,1),x=Ne(c,L,1)}else throw"invalid block type";else{var R=Hn(l)+4,N=n[R-4]|n[R-3]<<8,U=R+N;if(U>r){if(i)throw"unexpected EOF";break}s&&o(h+N),e.set(n.subarray(R,U),h),t.b=h+=N,t.p=l=U*8;continue}if(l>m){if(i)throw"unexpected EOF";break}}s&&o(h+131072);for(var Q=(1<<T)-1,P=(1<<L)-1,ne=l;;ne=l){var F=d[rt(n,l)&Q],Z=F>>>4;if(l+=F&15,l>m){if(i)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(Z<256)e[h++]=Z;else if(Z==256){ne=l,d=null;break}else{var J=Z-254;if(Z>264){var A=Z-257,ce=It[A];J=he(n,l,(1<<ce)-1)+Nt[A],l+=ce}var ie=x[rt(n,l)&P],me=ie>>>4;if(!ie)throw"invalid distance";l+=ie&15;var c=Pn[me];if(me>3){var ce=Ot[me];c+=rt(n,l)&(1<<ce)-1,l+=ce}if(l>m){if(i)throw"unexpected EOF";break}s&&o(h+131072);for(var ue=h+J;h<ue;h+=4)e[h]=e[h-c],e[h+1]=e[h+1-c],e[h+2]=e[h+2-c],e[h+3]=e[h+3-c];h=ue}}t.l=d,t.p=ne,t.b=h,d&&(a=1,t.m=T,t.d=x,t.n=L)}while(!a);return h==e.length?e:st(e,0,h)};var Ji=new re(0);var eo=function(n,e){var t={};for(var r in n)t[r]=n[r];for(var r in e)t[r]=e[r];return t},zn=function(n,e,t){for(var r=n(),s=n.toString(),i=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<r.length;++o){var a=r[o],l=i[o];if(typeof a=="function"){e+=";"+l+"=";var h=a.toString();if(a.prototype)if(h.indexOf("[native code]")!=-1){var d=h.indexOf(" ",8)+1;e+=h.slice(d,h.indexOf("(",d))}else{e+=h;for(var x in a.prototype)e+=";"+l+".prototype."+x+"="+a.prototype[x].toString()}else e+=h}else t[l]=a}return[e,t]},it=[],to=function(n){var e=[];for(var t in n)(n[t]instanceof re||n[t]instanceof ge||n[t]instanceof He)&&e.push((n[t]=new n[t].constructor(n[t])).buffer);return e},no=function(n,e,t,r){var s;if(!it[t]){for(var i="",o={},a=n.length-1,l=0;l<a;++l)s=zn(n[l],i,o),i=s[0],o=s[1];it[t]=zn(n[a],i,o)}var h=eo({},it[t][1]);return Qi(it[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,h,to(h),r)},ro=function(){return[re,ge,He,It,Ot,On,Nt,Pn,Un,kn,tt,Ne,nt,he,rt,Hn,st,jn,Bt,Kn,Vn]};var Kn=function(n){return postMessage(n,[n.buffer])},Vn=function(n){return n&&n.size&&new re(n.size)},so=function(n,e,t,r,s,i){var o=no(t,r,s,function(a,l){o.terminate(),i(a,l)});return o.postMessage([n,e],e.consume?[n.buffer]:[]),function(){o.terminate()}};var xe=function(n,e){return n[e]|n[e+1]<<8},pe=function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},Dt=function(n,e){return pe(n,e)+pe(n,e+4)*4294967296};function io(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return so(n,e,[ro],function(r){return Kn(Bt(r.data[0],Vn(r.data[1])))},1,t)}function Bt(n,e){return jn(n,e)}var Nl=typeof TextEncoder!="undefined"&&new TextEncoder,Pt=typeof TextDecoder!="undefined"&&new TextDecoder,oo=0;try{Pt.decode(Ji,{stream:!0}),oo=1}catch(n){}var ao=function(n){for(var e="",t=0;;){var r=n[t++],s=(r>127)+(r>223)+(r>239);if(t+s>n.length)return[e,st(n,t-1)];s?s==3?(r=((r&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):s&1?e+=String.fromCharCode((r&31)<<6|n[t++]&63):e+=String.fromCharCode((r&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(r)}};function lo(n,e){if(e){for(var t="",r=0;r<n.length;r+=16384)t+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return t}else{if(Pt)return Pt.decode(n);var s=ao(n),i=s[0],o=s[1];if(o.length)throw"invalid utf-8 data";return i}}var uo=function(n,e){return e+30+xe(n,e+26)+xe(n,e+28)},co=function(n,e,t){var r=xe(n,e+28),s=lo(n.subarray(e+46,e+46+r),!(xe(n,e+8)&2048)),i=e+46+r,o=pe(n,e+20),a=t&&o==4294967295?ho(n,i):[o,pe(n,e+24),pe(n,e+42)],l=a[0],h=a[1],d=a[2];return[xe(n,e+10),l,h,s,i+xe(n,e+30)+xe(n,e+32),d]},ho=function(n,e){for(;xe(n,e)!=1;e+=4+xe(n,e+2));return[Dt(n,e+12),Dt(n,e+4),Dt(n,e+20)]};function Gn(n,e){if(typeof e!="function")throw"no callback";for(var t=[],r=function(){for(var T=0;T<t.length;++T)t[T]()},s={},i=n.length-22;pe(n,i)!=101010256;--i)if(!i||n.length-i>65558){e("invalid zip file",null);return}var o=xe(n,i+8);o||e(null,{});var a=o,l=pe(n,i+16),h=l==4294967295;if(h){if(i=pe(n,i-12),pe(n,i)!=101075792){e("invalid zip file",null);return}a=o=pe(n,i+32),l=pe(n,i+48)}for(var d=function(T){var L=co(n,l,h),m=L[0],w=L[1],R=L[2],N=L[3],U=L[4],C=L[5],D=uo(n,C);l=U;var k=function(H,A){H?(r(),e(H,null)):(s[N]=A,--o||e(null,s))};if(!m)k(null,st(n,D,D+w));else if(m==8){var z=n.subarray(D,D+w);if(w<32e4)try{k(null,Bt(z,new re(R)))}catch(H){k(H,null)}else t.push(io(z,{size:R},k))}else k("unknown compression type "+m,null)},x=0;x<a;++x)d(x);return r}var Ar=Es(wr()),Tr=class{constructor(){this._buffers={}}clear(){this._buffers={}}put(e,t){this._buffers[e]=t}get(e){return this._buffers[e]}keys(){return Object.keys(this._buffers)}},Wo="",qo="",Qo=5e3;function br(n){return this.test(n)}function Zo(n,e){console.error(n,e)}var De=class extends HTMLElement{static createFileMatcher(e){if(typeof e=="string"){let t=(0,Ar.makeRe)(e),r=br.bind(t);return r.key=e,r}else if(e instanceof RegExp){let t=e,r=br.bind(t);return r.key=e.source,r}else throw new Error("Filter must be either a RegExp or glob string.")}static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Wo,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=qo,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("asset-pack",De)}static get observedAttributes(){return["src"]}set src(e){this.setAttribute("src",e)}get src(){return this._src}constructor(){super();let e=this.attachShadow({mode:"open"});e.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._src="",this._files=new Tr,this._cache={},this._loading={},this.onLoad=this.onLoad.bind(this),this.loaded=!1}get files(){return this._files}cacheAsset(e,t,r={}){let{ephemeral:s}=r,i=this._cache[e],o=this._loading[e];this._cache[e]=t,this.dispatchEvent(new CustomEvent("cache",{composed:!0,bubbles:!1,detail:{uri:e,current:t}})),o&&(o.resolve(t),delete this._loading[t]),s&&this._cache[t]===t&&(i?this._cache[t]=i:delete this._cache[t])}async loadAsset(e,t=Qo){let r=this._cache[e];if(r)return r;if(e in this._loading)return this._loading[e].promise;{let s=new Sr(t);return this._loading[e]=s,s.promise}}clearAssets(){for(let e of Object.values(this._loading))e.reject(new Error("Stop loading to clear all assets."));this._loading={},this._cache={}}deleteAsset(e){e in this._loading&&(this._loading[e].reject(new Error("Stop loading to delete asset.")),delete this._loading[e]),e in this._cache&&delete this._cache[e]}getAsset(e){return this._cache[e]}getAssetURIs(){return Object.keys(this._cache)}hasAsset(e){let t=this._cache[e];return t?Boolean(t):!1}isAssetCached(e){return e in this._cache}isAssetLoading(e){return e in this._loading}connectedCallback(){Jo(this,"src")}attributeChangedCallback(e,t,r){switch(e){case"src":this._src=r,r&&(this.loaded=!1,fetch(r).then(this.onLoad).catch(s=>Zo("Failed to load asset pack:",s)));break}}async onLoad(e){let t=await e.arrayBuffer();await new Promise((r,s)=>{Gn(new Uint8Array(t),(i,o)=>{if(i)s(i);else{let a=this._files;Promise.all(Object.entries(o).map(([l,h])=>(a.put(l,h),this.cacheAsset(l,h)))).then(()=>r()).catch(s)}})}),this.dispatchEvent(new CustomEvent("load",{composed:!0})),this.loaded=!0}};De.define();function Jo(n,e){if(Object.prototype.hasOwnProperty.call(n,e)){let t=n[e];delete n[e],n[e]=t}}var Sr=class{constructor(e){this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=e>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${e} ms.`)},e):null,this._promise=new Promise((t,r)=>{this._value?t(this._value):this._resolve=t,this._reason?r(this._reason):this._reject=r})}get promise(){return this._promise}resolve(e){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(e):this._value=e}reject(e){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(e):this._reason=e}};window.addEventListener("error",dt,!0);window.addEventListener("unhandledrejection",dt,!0);function dt(n){typeof n=="object"?n instanceof PromiseRejectionEvent?dt(n.reason):n instanceof ErrorEvent?dt(n.error):n instanceof Error?window.alert(n.stack):window.alert(JSON.stringify(n)):window.alert(n)}var qt={on(n,e,t=e){let r;if(this.__events.has(n)?r=this.__events.get(n):(r=new Map,this.__events.set(n,r)),!r.has(t))r.set(t,e);else throw new Error(`Found callback for event '${n}' with the same handle '${t}'.`);return this},off(n,e){if(this.__events.has(n)){let t=this.__events.get(n);if(t.has(e))t.delete(e);else throw new Error(`Unable to find callback for event '${n}' with handle '${e}'.`)}else throw new Error(`Unable to find event '${n}'.`);return this},once(n,e,t=e){let r=(...s)=>{this.off(n,t),e.apply(this.__context||this,s)};return this.on(n,r,t)},emit(n,...e){if(this.__events.has(n)){let t=[],r=Array.from(this.__events.get(n).values());for(let s of r){let i=s.apply(this.__context||this,e);i&&t.push(i)}return t}else return this.__events.set(n,new Map),[]}};function ea(n=void 0){let e=Object.create(qt);return e.__events=new Map,e.__context=n,e}function ta(n,e=void 0){let t=Object.assign(n,qt);return t.__events=new Map,t.__context=e,t}function na(n,e=void 0){let t=n.prototype;return Object.assign(t,qt),t.__events=new Map,t.__context=e,t}var Rr={create:ea,assign:ta,mixin:na},ra=5,sa=4,ia=3,oa=2,aa=1,la=0,Gl={[ra]:Ve("#7F8C8D"),[sa]:Ve("#2ECC71"),[ia]:Ve("#4794C8"),[oa]:Ve("#F39C12"),[aa]:Ve("#C0392B"),[la]:[""]};function Ve(n){return[`background: ${n}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}var Yl=Symbol("level"),$l=Symbol("domain");var Pe=0,ua=class{constructor(e){this._heap=[],this._comparator=e}get size(){return this._heap.length}clear(){this._heap.length=0}push(...e){for(let t of e)this._heap.push(t),this._shiftUp()}pop(){let e=this.peek(),t=ha(this);return t>Pe&&this._swap(Pe,t),this._heap.pop(),this._shiftDown(),e}replace(e){let t=this.peek();return this._heap[Pe]=e,this._shiftDown(),t}peek(){return this._heap[Pe]}_compare(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let r=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=r}_shiftUp(){let e=this._heap.length-1,t;for(;e>Pe&&this._compare(e,t=ca(e));)this._swap(e,t),e=t}_shiftDown(){let e=this._heap.length,t=Pe,r,s=Mr(t),i=s<e,o=Lr(t),a=o<e;for(;i&&this._compare(s,t)||a&&this._compare(o,t);)r=a&&this._compare(o,s)?o:s,this._swap(t,r),t=r,s=Mr(t),i=s<e,o=Lr(t),a=o<e}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}};function ha(n){return n._heap.length-1}function ca(n){return(n+1>>>1)-1}function Mr(n){return(n<<1)+1}function Lr(n){return n+1<<1}var Xl=Math.PI/180,Wl=180/Math.PI;var Qt=class{constructor(e,t,r){this.display=e,this.inputs=t,this.assets=r,this.deltaTime=0,this.prevTime=0,this.now=0,this.events=Rr.create()}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}once(e,t){return this.events.once(e,t),this}emit(e,...t){this.events.emit(e,...t)}};async function Zt(n,e=void 0){if(typeof n=="string"){let a=await(await fetch(n)).arrayBuffer();if(typeof e=="undefined"){let l=n.lastIndexOf(".");if(l<0)throw new Error("Cannot load from url - unknown image type.");e="image/"+n.slice(l+1)}return Zt(a,e)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=n;typeof e=="undefined"&&(e="image/png");let r=new Blob([t],{type:e}),s=URL.createObjectURL(r),i=new Image;return new Promise((o,a)=>{i.addEventListener("load",()=>{o(i)}),i.addEventListener("error",l=>{a(l)}),i.src=s})}async function Jt(n){if(typeof n=="string"){let r=await(await fetch(n)).arrayBuffer();return Jt(r)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let e=n;return fa(new TextDecoder().decode(e))}function fa(n){let e=[],t=[],r=[],s=[],i=[],o=[],a=/^#.*/g,l=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,d=/vt\s+(\S+)\s+(\S+)/g,x=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,T=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g,L=!1,m=null,w,R,N,U;for(n=n.replace(a,"");(m=l.exec(n))!=null;)w=Number.parseFloat(m[1]),R=Number.parseFloat(m[2]),N=Number.parseFloat(m[3]),e.push(w),e.push(R),e.push(N);for(;(m=h.exec(n))!=null;)w=Number.parseFloat(m[1]),R=Number.parseFloat(m[2]),N=Number.parseFloat(m[3]),r.push(w),r.push(R),r.push(N);for(;(m=d.exec(n))!=null;)w=Number.parseFloat(m[1]),R=Number.parseFloat(m[2]),t.push(w),t.push(R);for(;(m=x.exec(n))!=null;)w=Number.parseInt(m[2]),Number.isNaN(w)&&(w=1),R=Number.parseInt(m[6]),Number.isNaN(R)&&(R=1),N=Number.parseInt(m[10]),Number.isNaN(N)&&(N=1),s.push(w),s.push(R),s.push(N),w=Number.parseInt(m[4]),Number.isNaN(w)?(w=Number.parseInt(m[3]),R=Number.parseInt(m[7]),N=Number.parseInt(m[11]),o.push(w),o.push(R),o.push(N),i.push(1),i.push(1),i.push(1)):(R=Number.parseInt(m[8]),Number.isNaN(R)&&(R=1),N=Number.parseInt(m[12]),Number.isNaN(N)&&(N=1),o.push(w),o.push(R),o.push(N),w=Number.parseInt(m[3]),Number.isNaN(w)&&(w=1),R=Number.parseInt(m[7]),Number.isNaN(R)&&(R=1),N=Number.parseInt(m[11]),Number.isNaN(N)&&(N=1),i.push(w),i.push(R),i.push(N)),typeof m[13]!="undefined"&&(U=Number.parseInt(m[15]),Number.isNaN(U)&&(U=1),s.push(U),U=Number.parseInt(m[17]),Number.isNaN(U)?(U=Number.parseInt(m[16]),o.push(U),i.push(1)):(o.push(U),U=Number.parseInt(m[16]),i.push(U)),L=!0);for(;(m=T.exec(n))!=null;)w=Number.parseInt(m[2]),R=Number.parseInt(m[6]),N=Number.parseInt(m[10]),s.push(w),s.push(R),s.push(N),i.push(1),i.push(1),i.push(1),o.push(1),o.push(1),o.push(1),typeof m[13]!="undefined"&&(U=Number.parseInt(m[14]),s.push(U),i.push(1),o.push(1),L=!0);let C,D;D=s.length;let k=new Float32Array(D*3);for(let b=0;b<D;++b)C=s[b]-1,k[b*3+0]=e[C*3+0],k[b*3+1]=e[C*3+1],k[b*3+2]=e[C*3+2];D=i.length;let z=new Float32Array(D*2);for(let b=0;b<D;++b)C=i[b]-1,z[b*2+0]=t[C*2+0],z[b*2+1]=t[C*2+1];D=o.length;let H=new Float32Array(D*3);for(let b=0;b<D;++b)C=o[b]-1,H[b*3+0]=r[C*3+0],H[b*3+1]=r[C*3+1],H[b*3+2]=r[C*3+2];D=s.length;let A=new Uint16Array(D);for(let b=0;b<D;++b)A[b]=b;return L&&console.warn("WebGL does not support quad faces, only triangles."),{positions:k,texcoords:z,normals:H,indices:A}}async function en(n){if(typeof n=="string"){let i=await(await fetch(n)).arrayBuffer();return en(i)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let e=n,t=new TextDecoder().decode(e),r={};for(let s of t.split(`
`)){if(s=s.trim(),s<=0||s.startsWith("#")||s.startsWith("//"))continue;let i=[],o=0,a=s.indexOf(" ");for(;a>=0;)i.push(s.substring(o,a)),o=a+1,a=s.indexOf(" ",o);i.push(s.substring(o));let l=i[0],h=Number.parseInt(i[1]),d=Number.parseInt(i[2]),x=Number.parseInt(i[3]),T=Number.parseInt(i[4]),L=i.length>=6?Number.parseInt(i[5]):1,m=i.length>=7?Number.parseInt(i[6]):L,w=i.length>=8?Number.parseInt(i[7]):L>m?Math.ceil(L/m):1;r[l]={u:h,v:d,w:x,h:T,frames:L,cols:m,rows:w,name:l}}return r}async function Ge(n,e){if(typeof n=="string"){let o=await(await fetch(n)).arrayBuffer();return Ge(o)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=n,r=new ArrayBuffer(t.byteLength);return new Uint8Array(r).set(t),await e.decodeAudioData(r)}async function tn(n){if(typeof n=="string"){let r=await(await fetch(n)).arrayBuffer();return tn(r)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let e=n;return da(new TextDecoder().decode(e))}var pa=/(.+?)\s+(.*)/,ma=/(.+)=(.+)/;function da(n){let e=n.split(`
`),t={},r={},s={},i=[],o=[];for(let l of e){let h=pa.exec(l);if(!h)continue;let[d,x,T]=h;switch(x){case"info":Ye(t,T);break;case"common":Ye(r,T);break;case"page":Ye(s,T);break;case"chars":break;case"char":let L={};Ye(L,T),"id"in L&&i.push(L);break;case"kerning":let m={};Ye(m,T),"first"in m&&o.push(m);break;default:}}return{info:t,common:r,page:s,chars:i,kernings:o}}function Ye(n,e){let t=e.split(/\s+/);for(let r of t){let s=ma.exec(r);if(!s)continue;let[i,o,a]=s,l=JSON.parse(`[${a}]`);l.length===1?n[o]=l[0]:n[o]=l}}async function pt(n){if(typeof n=="string"){let r=await(await fetch(n)).arrayBuffer();return pt(r)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let e=n;return new TextDecoder().decode(e)}var nn=Symbol("audioContext"),Le=class{static getAudioContext(){if(nn in this)return this[nn];{let e=new AudioContext;return _a(e),this[nn]=e,e}}constructor(e,t){this.audioContext=e,this.audioBuffer=t,this._playing=!1,this._started=!1,this._source=null,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}destroy(){this._source&&this._source.disconnect(),this._source=null,this._started=!1,this._playing=!1}onAudioSourceEnded(){this._playing=!1}play(e={}){let t=this.audioBuffer;if(!t)return;this._source&&this.destroy();let{pitch:r=void 0,gain:s=void 0,pan:i=void 0,loop:o=!1}=e,a=this.audioContext,l=a.createBufferSource();l.addEventListener("ended",this.onAudioSourceEnded),l.buffer=t,l.loop=o;let h=l;if(r&&(l.detune.value=r*100),s){let d=a.createGain();d.gain.value=s,h=h.connect(d)}if(i){let d=a.createStereoPanner();d.pan.value=i,h=h.connect(d)}h.connect(a.destination),l.start(),this._source=l,this._started=!0,this._playing=!0}pause(){this._source.stop(),this._playing=!1}isStarted(){return this._started}isPlaying(){return this._playing}isPaused(){return this._started&&!this._playing}};function _a(n){let e=()=>{n.state==="suspended"&&n.resume()};document.addEventListener("click",e)}var ou=ve.fromString("cursorX","Mouse.PosX"),au=ve.fromString("cursorY","Mouse.PosY"),lu=W.fromString("activate","Mouse.Button0"),uu=W.fromString("mark","Mouse.Button2"),hu=W.fromString("restart","Keyboard.KeyR");var fu=Symbol("IslandRendererInfo");var rn=class{next(){return 0}},Cr=class extends rn{next(){return Math.random()}},Ir=class extends rn{constructor(e){super();this.seed=e,this.a=e}next(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}},M=class{static get RAND(){let e=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:e}),e}constructor(e=void 0){typeof e=="number"?this.generator=new Ir(e):e?this.generator=e:this.generator=new Cr,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(e){return this.RAND.choose(e)}choose(e){return e[Math.floor(this.generator.next()*e.length)]}static range(e,t){return this.RAND.range(e,t)}range(e,t){return(t-e)*this.generator.next()+e}static rangeInt(e,t){return this.RAND.rangeInt(e,t)}rangeInt(e,t){return Math.trunc(this.range(e,t))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};document.title="Archaea";document.title="Architect";var xa=W.fromString("moveLeft","Keyboard.KeyA"),Ea=W.fromString("moveRight","Keyboard.KeyD"),ya=W.fromString("moveUp","Keyboard.KeyW"),wa=W.fromString("moveDown","Keyboard.KeyS"),Wu=ve.fromString("cursorX","Mouse.PosX"),qu=ve.fromString("cursorY","Mouse.PosY"),Aa=W.fromString("shoot","Keyboard.Space");document.title="Bioform";var mt=1e-6,$e=typeof Float32Array!="undefined"?Float32Array:Array,sn=Math.random;var dh=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var _t={};Ze(_t,{add:()=>Ca,angle:()=>Za,bezier:()=>Va,ceil:()=>Ia,clone:()=>Sa,copy:()=>Ma,create:()=>Or,cross:()=>ja,dist:()=>ol,distance:()=>Fr,div:()=>il,divide:()=>Pr,dot:()=>Hr,equals:()=>nl,exactEquals:()=>tl,floor:()=>Oa,forEach:()=>hl,fromValues:()=>Ra,hermite:()=>Ka,inverse:()=>ka,len:()=>ll,length:()=>Nr,lerp:()=>za,max:()=>Ba,min:()=>Na,mul:()=>sl,multiply:()=>Dr,negate:()=>Ua,normalize:()=>Ha,random:()=>Ga,rotateX:()=>Wa,rotateY:()=>qa,rotateZ:()=>Qa,round:()=>Da,scale:()=>Pa,scaleAndAdd:()=>Fa,set:()=>La,sqrDist:()=>al,sqrLen:()=>ul,squaredDistance:()=>Ur,squaredLength:()=>kr,str:()=>el,sub:()=>rl,subtract:()=>Br,transformMat3:()=>$a,transformMat4:()=>Ya,transformQuat:()=>Xa,zero:()=>Ja});function Or(){var n=new $e(3);return $e!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Sa(n){var e=new $e(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Nr(n){var e=n[0],t=n[1],r=n[2];return Math.hypot(e,t,r)}function Ra(n,e,t){var r=new $e(3);return r[0]=n,r[1]=e,r[2]=t,r}function Ma(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function La(n,e,t,r){return n[0]=e,n[1]=t,n[2]=r,n}function Ca(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function Br(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function Dr(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function Pr(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function Ia(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function Oa(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function Na(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function Ba(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function Da(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function Pa(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function Fa(n,e,t,r){return n[0]=e[0]+t[0]*r,n[1]=e[1]+t[1]*r,n[2]=e[2]+t[2]*r,n}function Fr(n,e){var t=e[0]-n[0],r=e[1]-n[1],s=e[2]-n[2];return Math.hypot(t,r,s)}function Ur(n,e){var t=e[0]-n[0],r=e[1]-n[1],s=e[2]-n[2];return t*t+r*r+s*s}function kr(n){var e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function Ua(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function ka(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function Ha(n,e){var t=e[0],r=e[1],s=e[2],i=t*t+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Hr(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ja(n,e,t){var r=e[0],s=e[1],i=e[2],o=t[0],a=t[1],l=t[2];return n[0]=s*l-i*a,n[1]=i*o-r*l,n[2]=r*a-s*o,n}function za(n,e,t,r){var s=e[0],i=e[1],o=e[2];return n[0]=s+r*(t[0]-s),n[1]=i+r*(t[1]-i),n[2]=o+r*(t[2]-o),n}function Ka(n,e,t,r,s,i){var o=i*i,a=o*(2*i-3)+1,l=o*(i-2)+i,h=o*(i-1),d=o*(3-2*i);return n[0]=e[0]*a+t[0]*l+r[0]*h+s[0]*d,n[1]=e[1]*a+t[1]*l+r[1]*h+s[1]*d,n[2]=e[2]*a+t[2]*l+r[2]*h+s[2]*d,n}function Va(n,e,t,r,s,i){var o=1-i,a=o*o,l=i*i,h=a*o,d=3*i*a,x=3*l*o,T=l*i;return n[0]=e[0]*h+t[0]*d+r[0]*x+s[0]*T,n[1]=e[1]*h+t[1]*d+r[1]*x+s[1]*T,n[2]=e[2]*h+t[2]*d+r[2]*x+s[2]*T,n}function Ga(n,e){e=e||1;var t=sn()*2*Math.PI,r=sn()*2-1,s=Math.sqrt(1-r*r)*e;return n[0]=Math.cos(t)*s,n[1]=Math.sin(t)*s,n[2]=r*e,n}function Ya(n,e,t){var r=e[0],s=e[1],i=e[2],o=t[3]*r+t[7]*s+t[11]*i+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*s+t[8]*i+t[12])/o,n[1]=(t[1]*r+t[5]*s+t[9]*i+t[13])/o,n[2]=(t[2]*r+t[6]*s+t[10]*i+t[14])/o,n}function $a(n,e,t){var r=e[0],s=e[1],i=e[2];return n[0]=r*t[0]+s*t[3]+i*t[6],n[1]=r*t[1]+s*t[4]+i*t[7],n[2]=r*t[2]+s*t[5]+i*t[8],n}function Xa(n,e,t){var r=t[0],s=t[1],i=t[2],o=t[3],a=e[0],l=e[1],h=e[2],d=s*h-i*l,x=i*a-r*h,T=r*l-s*a,L=s*T-i*x,m=i*d-r*T,w=r*x-s*d,R=o*2;return d*=R,x*=R,T*=R,L*=2,m*=2,w*=2,n[0]=a+d+L,n[1]=l+x+m,n[2]=h+T+w,n}function Wa(n,e,t,r){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function qa(n,e,t,r){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Qa(n,e,t,r){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Za(n,e){var t=n[0],r=n[1],s=n[2],i=e[0],o=e[1],a=e[2],l=Math.sqrt(t*t+r*r+s*s),h=Math.sqrt(i*i+o*o+a*a),d=l*h,x=d&&Hr(n,e)/d;return Math.acos(Math.min(Math.max(x,-1),1))}function Ja(n){return n[0]=0,n[1]=0,n[2]=0,n}function el(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function tl(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function nl(n,e){var t=n[0],r=n[1],s=n[2],i=e[0],o=e[1],a=e[2];return Math.abs(t-i)<=mt*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(r-o)<=mt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=mt*Math.max(1,Math.abs(s),Math.abs(a))}var rl=Br,sl=Dr,il=Pr,ol=Fr,al=Ur,ll=Nr,ul=kr,hl=function(){var n=Or();return function(e,t,r,s,i,o){var a,l;for(t||(t=3),r||(r=0),s?l=Math.min(s*t+r,e.length):l=e.length,a=r;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}}();var yh=_t.fromValues(0,1,0);var wh=Math.PI/3;var Ah=Math.PI/180;var zr=16,fl=(()=>{let n=[],e=zr,t=Math.PI*2/e,r=1,s=0,i,o;for(let a=0;a<=e;++a)i=Math.cos(a*t),o=Math.sin(a*t),n.push(0,0),n.push(r,s),n.push(i,o),r=i,s=o;return n})(),Oh=Math.trunc(fl.length/2),dl=(()=>{let n=[],e=zr,t=Math.PI*2/e,r=1,s=0,i,o;for(let a=0;a<=e;++a)i=Math.cos(a*t),o=Math.sin(a*t),n.push(r,s),n.push(i,o),r=i,s=o;return n})(),Nh=Math.trunc(dl.length/2);var pl=16,un=16,Hh=un/2,ml=pl*un,jh=1/ml;var _l=.3,fc=1-_l;var vl=60,wc=1e3/vl;var Kr=16,gl=(()=>{let n=[],e=Kr,t=Math.PI*2/e,r=1,s=0,i,o;for(let a=0;a<=e;++a)i=Math.cos(a*t),o=Math.sin(a*t),n.push(0,0),n.push(r,s),n.push(i,o),r=i,s=o;return n})(),Nc=Math.trunc(gl.length/2),xl=(()=>{let n=[],e=Kr,t=Math.PI*2/e,r=1,s=0,i,o;for(let a=0;a<=e;++a)i=Math.cos(a*t),o=Math.sin(a*t),n.push(r,s),n.push(i,o),r=i,s=o;return n})(),Bc=Math.trunc(xl.length/2);var El=[2,4],yl=[.3,1],wl=30;function Vr(n,e){let t={x:[],y:[],size:[],speed:[],length:0,width:n,height:e};for(let r=0;r<wl;++r)t.x.push(M.range(0,n)),t.y.push(M.range(0,e)),t.size.push(M.range(...El)),t.speed.push(M.range(...yl)),t.length++;return t}function Gr(n,e,t="white"){for(let r=0;r<e.length;++r){let s=e.x[r],i=e.y[r],o=e.size[r],a=o/2;n.fillStyle=t,n.fillRect(s-a,i-a,o,o)}}function Yr(n,e=1,t=0){let{length:r,width:s,height:i}=n;for(let o=0;o<r;++o){let a=e*n.speed[o],l=t*n.speed[o];n.x[o]+=a,n.y[o]+=l,a<0?n.x[o]<0&&(n.x[o]=s,n.y[o]=M.range(0,i)):a>0&&n.x[o]>s&&(n.x[o]=0,n.y[o]=M.range(0,i)),l<0?n.y[o]<0&&(n.x[o]=M.range(0,s),n.y[o]=i):l>0&&n.y[o]>i&&(n.x[o]=M.range(0,s),n.y[o]=0)}}var cn={};Ze(cn,{Backward:()=>Xr,Debug:()=>Zr,Fire:()=>Qr,Forward:()=>$r,RotateLeft:()=>Wr,RotateRight:()=>qr});var $r=new W("forward",[ae.KEY_W,ae.ARROW_UP]),Xr=new W("backward",[ae.KEY_S,ae.ARROW_DOWN]),Wr=new W("rotateLeft",[ae.KEY_A,ae.ARROW_LEFT]),qr=new W("rotateRight",[ae.KEY_D,ae.ARROW_RIGHT]),Qr=new W("fire",ae.SPACE),Zr=new W("debug",ae.BACKQUOTE);var gt={};Ze(gt,{BackgroundMusic:()=>fn,SoundBoom:()=>rs,SoundDead:()=>es,SoundPop:()=>ts,SoundShoot:()=>ns,SoundStart:()=>Jr,bindRefs:()=>ss,loadRefs:()=>is});async function Ce(n){let e=Le.getAudioContext(),t=await Ge(n,e);return new Le(e,t)}var Al=5e3,ye=class{constructor(e,t=null,r=null){this.uri=e,this.source=t,this.loader=r,this.parent=null,this._cacheCurrent=null,this._cacheOptions=void 0,this._loadResolves=[],this._loadRejects=[]}get current(){return this.parent?this.parent.getAsset(this.uri):null}async load(e=Al){let t=this.parent,r=this.uri;if(t){if(t.isAssetLoading(r))return await t.loadAsset(r,e);if(t.isAssetCached(r))return t.getAsset(r);{let s=this.loader,i=this.source,[o,a]=await Promise.all([t.loadAsset(r,e),Tl(t,r,i,s,e)]);return o}}else return await Promise.race([new Promise((i,o)=>{this._loadResolves.push(i),this._loadRejects.push(o)}),new Promise((i,o)=>setTimeout(()=>{this._loadResolves.length>0?o(new Error("Timeout reached while waiting for asset ref binding.")):i(this.current)},e))])}cache(e,t=void 0){if(!this.parent){this._cacheCurrent=e,this._cacheOptions=t;return}this.parent.cacheAsset(this.uri,e,t)}register(e){if(this.parent=e,this._cacheCurrent){let t=this._cacheCurrent,r=this._cacheOptions;this._cacheCurrent=null,this._cacheOptions=null,this.cache(t,r)}if(this._loadResolves.length>0){let t=this._loadResolves,r=this._loadRejects;this._loadResolves=[],this._loadRejects=[],this.load().then(s=>{for(let i of t)i(s)}).catch(s=>{for(let i of r)i(s)})}}};async function Tl(n,e,t,r,s){let i=null;if(t?typeof t=="function"?i=await t():typeof t=="string"?i=await n.loadAsset(t,s):i=t:i=e,r){if(typeof i!="string"&&!(i instanceof Uint8Array))throw new Error("Unable to load from source - must be either a string or Uint8Array.");i=await r(i)}i&&i!==e&&n.cacheAsset(e,i)}var Jr=new ye("sound://start.wav","res/start.wav",Ce),es=new ye("sound://dead.wav","res/dead.wav",Ce),ts=new ye("sound://pop.wav","res/boop.wav",Ce),ns=new ye("sound://shoot.wav","res/click.wav",Ce),rs=new ye("sound://boom.wav","res/boom.wav",Ce),fn=new ye("sound://music.wav","res/music.wav",Ce);function ss(n,e){for(let t of e)t instanceof ye&&t.register(n)}async function is(n){let e=[];for(let t of n)t instanceof ye&&e.push(t.load());await Promise.all(e)}document.title="Starfield";async function os(n){let{display:e,assets:t,inputs:r}=n,s=e.canvas,i=s.getContext("2d"),o={load:Ie,start:y,update:K,render:X},a=5,l=4,h=8,d=[[-h,-h,h*2+s.width,h],[-h,0,h,s.height],[-h,s.height,h*2+s.width,h],[s.width,0,h,s.height]],x=[3e3,1e4],T=1,L=100,m=1,w=2,R=4,N=2e3,U=100,C=10,D=4,k=2,z=600,H=.1,A=["red","red","red","yellow","orange"],b=["blue","blue","blue","dodgerblue","gray","darkgray","yellow"],$=["gray","darkgray","lightgray"],p="[ wasd_ ]",j=[-2,2],F=1.5,se=.1,f=.4,c=.1,Q=.02,P=.008,ne=.1,Z=.001,J="gold",ce=[1e4,3e4],ie=4,me=["white","violet","violet"],ue=30,I=.7,fe=!1;await o.load(),o.start(),e.addEventListener("frame",u=>{let{deltaTime:_}=u.detail;o.update(_),o.render(i)});async function Ie(){console.log("Loading..."),r.bindBindings(Object.values(cn)),ss(t,Object.values(gt)),await is(Object.values(gt)),console.log("...loading complete!")}function y(){this.level=0,this.score=0,this.highScore=Number(localStorage.getItem("highscore")),this.flashScoreDelta=0,this.flashHighScoreDelta=0,this.flashShootDelta=0,this.player={scene:this,x:s.width/2,y:s.height/2,rotation:0,dx:0,dy:0,dr:0,get left(){return Wr.value},get right(){return qr.value},get up(){return $r.value},get down(){return Xr.value},get fire(){return Qr.value},cooldown:0,powerMode:0,shoot(){if(!(this.scene.bullets.length>U)&&!(this.cooldown>0)){if(this.powerMode>0){for(let u=-1;u<=1;++u){let _=this.rotation+u*Math.PI/4,B=pn(this.scene,this.x-Math.cos(_)*a,this.y-Math.sin(_)*a,-Math.cos(_)*R+this.dx,-Math.sin(_)*R+this.dy);this.scene.bullets.push(B)}--this.powerMode}else{let u=pn(this.scene,this.x-Math.cos(this.rotation)*a,this.y-Math.sin(this.rotation)*a,-Math.cos(this.rotation)*R+this.dx,-Math.sin(this.rotation)*R+this.dy);this.scene.bullets.push(u)}this.cooldown=C,ns.current.play()}}},this.asteroids=[],this.asteroidSpawner={scene:this,spawnTicks:x[1],reset(){this.spawnTicks=x[1]},spawn(){if(this.scene.asteroids.length>L)return;let u=M.choose(d),_=Fe(this.scene,M.range(u[0],u[0]+u[2]),M.range(u[1],u[1]+u[3]),M.range(-m,m),M.range(-m,m),h);this.scene.asteroids.push(_)},update(u){this.scene.gamePause||(this.spawnTicks-=u,this.spawnTicks<=0&&(this.spawn(),this.spawnTicks=M.range(...x)))}},this.bullets=[],this.particles=[],this.powerUps=[],this.powerUpSpawner={scene:this,reset(){},spawn(){let u=M.choose(d),_=ls(this.scene,M.range(u[0],u[0]+u[2]),M.range(u[1],u[1]+u[3]),M.range(-m,m),M.range(-m,m));this.scene.powerUps.push(_)},update(u){}},this.starfield=Vr(s.width,s.height),this.gamePause=!0,this.showPlayer=!0,this.gameStart=!0,this.gameWait=!0,this.hint=p}function K(u){if(Zr.pressed&&(fe=!fe),this.gameWait&&r.isAnyButtonPressed()&&(this.gameStart&&(fn.current.play(),this.score=0,this.flashScore=!0,this.level=0,this.gameStart=!1,this.player.powerMode=0,this.powerUps.length=0,this.asteroidSpawner.reset(),this.powerUpSpawner.reset()),this.gameWait=!1,us(this)),this.gamePause){for(let v of this.particles)v.age+=u,v.age>z?v.destroy():(v.x+=v.dx,v.y+=v.dy,_e(v,D*2,D*2));return}let _=this.player.right-this.player.left,B=this.player.down-this.player.up,G=this.player.fire;this.player.dx+=B*Math.cos(this.player.rotation)*Q,this.player.dy+=B*Math.sin(this.player.rotation)*Q,this.player.dx*=1-Z,this.player.dy*=1-Z,this.player.dr+=_*P,this.player.dr*=1-ne,this.player.x+=this.player.dx,this.player.y+=this.player.dy,this.player.rotation+=this.player.dr,--this.player.cooldown,_e(this.player,a*2,a*2),G&&(this.player.shoot(),this.flashShootDelta=1),B&&cs(this,this.player.x,this.player.y,-B*Math.cos(this.player.rotation)*F,-B*Math.sin(this.player.rotation)*F,M.choose.bind(null,$));for(let v of this.bullets)v.age+=u,v.age>N?v.destroy():(v.x+=v.dx,v.y+=v.dy,_e(v,w*2,w*2));for(let v of this.bullets)for(let te of this.asteroids)if(Te(v,te,te.size)){this.flashScore=1,this.score++,this.score>this.highScore&&(this.flashHighScore=this.score-this.highScore,this.highScore=this.score,localStorage.setItem("highscore",this.highScore)),We(this,te.x,te.y,10,M.choose.bind(null,b)),ts.current.play(),v.destroy(),te.breakUp(v.dx*H,v.dy*H);break}for(let v of this.particles)v.age+=u,v.age>z?v.destroy():(v.x+=v.dx,v.y+=v.dy,_e(v,D*2,D*2));for(let v of this.asteroids)v.x+=v.dx,v.y+=v.dy,_e(v,v.size*2,v.size*2);for(let v of this.asteroids)if(Te(v,this.player,v.size+a)){We(this,v.x,v.y,10,M.choose.bind(null,b)),v.destroy(),hs(this);break}for(let v of this.powerUps)v.x+=v.dx,v.y+=v.dy,_e(v,ie*2,ie*2);for(let v of this.powerUps)if(Te(v,this.player,ie+a)){We(this,v.x,v.y,10,M.choose.bind(null,me)),v.destroy(),this.player.powerMode+=ue;break}Yr(this.starfield),this.asteroidSpawner.update(u),this.powerUpSpawner.update(u),!this.gamePause&&this.asteroids.length<=0&&(this.gamePause=!0,this.showPlayer=!0,Jr.current.play(),setTimeout(()=>this.gameWait=!0,1e3))}function g(u,_){u.translate(_.x,_.y),u.rotate(_.rotation),u.fillStyle="slategray",u.fillRect(-_.size,-_.size,_.size*2,_.size*2),u.setTransform(1,0,0,1,0,0)}function O(u,_){u.translate(_.x,_.y),u.rotate(_.rotation),u.beginPath(),u.strokeStyle="violet",u.arc(0,0,ie,0,Math.PI*2),u.moveTo(-ie/2,0),u.lineTo(ie/2,0),u.moveTo(0,-ie/2),u.lineTo(0,ie/2),u.stroke(),u.setTransform(1,0,0,1,0,0)}function Y(u,_){u.translate(_.x,_.y),u.rotate(_.rotation),u.fillStyle=J,u.fillRect(-w,-w,w*4,w*2),u.setTransform(1,0,0,1,0,0)}function ee(u,_){u.translate(_.x,_.y),u.rotate(_.rotation),u.fillStyle=_.color;let B=D*(1-_.age/z);u.fillRect(-B,-B,B*2,B*2),u.setTransform(1,0,0,1,0,0)}function X(u){u.fillStyle="black",u.fillRect(0,0,s.width,s.height),Gr(u,this.starfield),u.fillStyle="rgba(255, 255, 255, 0.2)",u.textAlign="center",u.textBaseline="middle",u.font="16px sans-serif",u.fillText(this.hint,s.width/2,s.height/2-32),this.flashScore>0?(u.fillStyle=`rgba(255, 255, 255, ${this.flashScore+.2})`,this.flashScore-=c):u.fillStyle="rgba(255, 255, 255, 0.2)",u.font="48px sans-serif",u.fillText("= "+String(this.score).padStart(2,"0")+" =",s.width/2,s.height/2),this.flashHighScore>0?(u.fillStyle=`rgba(255, 255, 255, ${this.flashHighScore+.2})`,this.flashHighScore-=c):u.fillStyle="rgba(255, 255, 255, 0.2)",u.font="16px sans-serif",u.fillText(String(this.highScore).padStart(2,"0"),s.width/2,s.height/2+32),u.fillStyle="rgba(255, 255, 255, 0.2)",u.font="24px sans-serif",u.textAlign="right",u.fillText(Math.ceil(this.asteroidSpawner.spawnTicks/1e3),s.width,s.height-12);for(let _ of this.asteroids)g(u,_),Xe(u,_.x,_.y,_.size);for(let _ of this.powerUps)O(u,_),Xe(u,_.x,_.y,ie);for(let _ of this.bullets)Y(u,_),Xe(u,_.x,_.y,w);for(let _ of this.particles)ee(u,_);if(this.showPlayer){u.translate(this.player.x,this.player.y),u.rotate(this.player.rotation),u.fillStyle="white";let _=a;u.fillRect(-_,-_,_*2,_*2);let B=-1,G=0,v=0;this.flashShootDelta>0?(u.fillStyle=`rgb(${200*this.flashShootDelta+55*Math.sin(performance.now()/(C*2))}, 0, 0)`,this.flashShootDelta-=c,v=this.flashShootDelta*2,B=this.flashShootDelta):u.fillStyle="black",u.fillRect(-_-v/2+B,-(_/4)-v/2+G,_+v,_/2+v),u.setTransform(1,0,0,1,0,0)}Xe(u,this.player.x,this.player.y,a)}function _e(u,_,B){u.x<-_&&(u.x=s.width),u.y<-B&&(u.y=s.height),u.x>s.width+_/2&&(u.x=-_),u.y>s.height+B/2&&(u.y=-B)}function Te(u,_,B){let G=u.x-_.x,v=u.y-_.y;return G*G+v*v<=B*B}function Xe(u,_,B,G){!fe||(u.translate(_,B),u.beginPath(),u.arc(0,0,G,0,Math.PI*2),u.strokeStyle="lime",u.stroke(),u.setTransform(1,0,0,1,0,0))}function ls(u,_,B,G,v){return{scene:u,x:_,y:B,dx:G,dy:v,rotation:Math.atan2(v,G),destroy(){this.scene.powerUps.splice(this.scene.powerUps.indexOf(this),1)}}}function Fe(u,_,B,G,v,te){return{scene:u,x:_,y:B,dx:G,dy:v,size:te,rotation:Math.atan2(v,G),breakUp(Se=0,qe=0){if(this.destroy(),this.size>l){let Ue=[];Ue.push(Fe(this.scene,this.x+M.range(-h,h),this.y+M.range(-h,h),M.range(-m,m)+Se,M.range(-m,m)+qe,l)),Ue.push(Fe(this.scene,this.x+M.range(-h,h),this.y+M.range(-h,h),M.range(-m,m)+Se,M.range(-m,m)+qe,l)),Ue.push(Fe(this.scene,this.x+M.range(-h,h),this.y+M.range(-h,h),M.range(-m,m)+Se,M.range(-m,m)+qe,l)),Ue.push(Fe(this.scene,this.x+M.range(-h,h),this.y+M.range(-h,h),M.range(-m,m)+Se,M.range(-m,m)+qe,l)),this.scene.asteroids.push(...Ue)}},destroy(){this.scene.asteroids.splice(this.scene.asteroids.indexOf(this),1)}}}function pn(u,_,B,G,v){return{scene:u,x:_,y:B,dx:G,dy:v,rotation:Math.atan2(v,G),age:0,destroy(){this.scene.bullets.splice(this.scene.bullets.indexOf(this),1)}}}function mn(u,_,B,G,v,te){return typeof te=="function"&&(te=te.call(null)),{scene:u,x:_,y:B,dx:G,dy:v,rotation:Math.atan2(v,G),age:0,color:te,destroy(){this.scene.particles.splice(this.scene.particles.indexOf(this),1)}}}function us(u){u.bullets.length=0,u.asteroids.length=0,u.particles.length=0,u.player.x=s.width/2,u.player.y=s.height/2,u.player.dx=0,u.player.dy=0,u.level++,u.gamePause=!1,u.showPlayer=!0;for(let B=0;B<T*u.level;++B)u.asteroidSpawner.spawn();M.next()>I&&u.powerUpSpawner.spawn();let _=fn.current;_.isPlaying()||_.play({loop:!0})}function hs(u){u.gamePause=!0,u.showPlayer=!1,We(u,u.player.x,u.player.y,100,M.choose.bind(null,A)),es.current.play(),rs.current.play(),setTimeout(()=>u.gameStart=u.gameWait=!0,1e3)}function cs(u,_,B,G,v,te){if(M.next()>.3){let Se=mn(u,_+M.range(...j),B+M.range(...j),G,v,te);Se.age=M.range(z*se,z*f),u.particles.push(Se)}}function We(u,_,B,G=10,v){for(let te=0;te<G;++te)u.particles.push(mn(u,_,B,M.range(-1,1)*k,M.range(-1,1)*k,v))}}var dn=class{constructor(e){this._assetPack=e,this._pipeline={},this.onAssetCache=this.onAssetCache.bind(this),e.addEventListener("cache",this.onAssetCache)}async pipe(e,t){let r=De.createFileMatcher(e),s=r.key,i;s in this._pipeline?i=this._pipeline[s]:(i=new as(r),this._pipeline[s]=i),i.addHandler(t);for(let o of this._assetPack.getAssetURIs()){let a=this._assetPack.getAsset(o);i.matches(o)&&await t(a,o)}}async onAssetCache(e){let t=e.detail.uri,r=e.detail.value;await Promise.all(Object.values(this._pipeline).map(s=>s.matches(t)?s.process(t,r):null))}},as=class{constructor(e){this.filter=e,this.handlers=[]}matches(e){return this.filter(e)}async process(e,t){return Promise.all(this.handlers.map(r=>r(e,t)))}addHandler(e){this.handlers.push(e)}};window.addEventListener("DOMContentLoaded",bl);async function bl(){let n=document.querySelector("#display"),e=document.querySelector("#inputs").getContext("axisbutton"),t=document.querySelector("#assets"),r=new Promise((o,a)=>{t.addEventListener("load",o),t.addEventListener("error",a)});t.src="res.pack",await r;let s=new dn(t);await s.pipe("res/**/*.md",async(o,a)=>t.cacheAsset("txt:"+a.substring(4),await pt(o))),await s.pipe("res/**/*.txt",async(o,a)=>t.cacheAsset("txt:"+a.substring(4),await pt(o))),await s.pipe("res/**/*.png",async(o,a)=>t.cacheAsset("image:"+a.substring(4),await Zt(o,"image/png"))),await s.pipe("res/**/*.obj",async(o,a)=>t.cacheAsset("obj:"+a.substring(4),await Jt(o))),await s.pipe("res/**/*.atlas",async(o,a)=>t.cacheAsset("atlas:"+a.substring(4),await en(o))),await s.pipe("res/**/*.fnt",async(o,a)=>t.cacheAsset("fnt:"+a.substring(4),await tn(o))),await s.pipe("res/**/*.wav",async(o,a)=>{let l=Le.getAudioContext(),h=await Ge(o,l),d=new Le(l,h);return t.cacheAsset("sound:"+a.substring(4),d)});let i=new Qt(n,e,t);n.addEventListener("frame",o=>{let{deltaTime:a,prevTime:l,now:h}=o.detail;i.deltaTime=a,i.prevTime=l,i.now=h,e.poll(h),i.emit("frame")}),await os(i)}})();
//# sourceMappingURL=main.js.map
