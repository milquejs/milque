(()=>{var os=Object.create,it=Object.defineProperty;var ls=Object.getOwnPropertyDescriptor;var hs=Object.getOwnPropertyNames;var cs=Object.getPrototypeOf,us=Object.prototype.hasOwnProperty;var fs=e=>it(e,"__esModule",{value:!0});var ps=(e,t)=>()=>(e&&(t=e(e=0)),t),Ce=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),De=(e,t)=>{for(var r in t)it(e,r,{get:t[r],enumerable:!0})},ds=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of hs(t))!us.call(e,n)&&n!=="default"&&it(e,n,{get:()=>t[n],enumerable:!(r=ls(t,n))||r.enumerable});return e},ms=e=>ds(fs(it(e!=null?os(cs(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var vn={};De(vn,{basename:()=>dn,default:()=>ja,delimiter:()=>fn,dirname:()=>pn,extname:()=>mn,isAbsolute:()=>Kt,join:()=>hn,normalize:()=>Gt,relative:()=>cn,resolve:()=>ot,sep:()=>un});function ln(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];i==="."?e.splice(n,1):i===".."?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function ot(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:"/";if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)continue;e=n+"/"+e,t=n.charAt(0)==="/"}return e=ln(jt(e.split("/"),function(i){return!!i}),!t).join("/"),(t?"/":"")+e||"."}function Gt(e){var t=Kt(e),r=$a(e,-1)==="/";return e=ln(jt(e.split("/"),function(n){return!!n}),!t).join("/"),!e&&!t&&(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function Kt(e){return e.charAt(0)==="/"}function hn(){var e=Array.prototype.slice.call(arguments,0);return Gt(jt(e,function(t,r){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function cn(e,t){e=ot(e).substr(1),t=ot(t).substr(1);function r(h){for(var c=0;c<h.length&&h[c]==="";c++);for(var u=h.length-1;u>=0&&h[u]==="";u--);return c>u?[]:h.slice(c,u-c+1)}for(var n=r(e.split("/")),i=r(t.split("/")),s=Math.min(n.length,i.length),a=s,o=0;o<s;o++)if(n[o]!==i[o]){a=o;break}for(var l=[],o=a;o<n.length;o++)l.push("..");return l=l.concat(i.slice(a)),l.join("/")}function pn(e){var t=Vt(e),r=t[0],n=t[1];return!r&&!n?".":(n&&(n=n.substr(0,n.length-1)),r+n)}function dn(e,t){var r=Vt(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r}function mn(e){return Vt(e)[3]}function jt(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var Ka,Vt,un,fn,ja,$a,xn=ps(()=>{Ka=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Vt=function(e){return Ka.exec(e).slice(1)};un="/",fn=":";ja={extname:mn,basename:dn,dirname:pn,sep:un,delimiter:fn,relative:cn,join:hn,isAbsolute:Kt,normalize:Gt,resolve:ot};$a="ab".substr(-1)==="b"?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}});var ht=Ce((Yf,lt)=>{var Ne=(xn(),vn);if(Ne&&Ne.default){lt.exports=Ne.default;for(let e in Ne)lt.exports[e]=Ne[e]}else Ne&&(lt.exports=Ne)});var Ke=Ce((Vf,An)=>{"use strict";var Wa=ht(),_e="\\\\/",gn=`[^${_e}]`,we="\\.",Xa="\\+",qa="\\?",ct="\\/",Qa="(?=.)",_n="[^/]",$t=`(?:${ct}|$)`,yn=`(?:^|${ct})`,Wt=`${we}{1,2}${$t}`,Za=`(?!${we})`,Ja=`(?!${yn}${Wt})`,eo=`(?!${we}{0,1}${$t})`,to=`(?!${Wt})`,ro=`[^.${ct}]`,no=`${_n}*?`,En={DOT_LITERAL:we,PLUS_LITERAL:Xa,QMARK_LITERAL:qa,SLASH_LITERAL:ct,ONE_CHAR:Qa,QMARK:_n,END_ANCHOR:$t,DOTS_SLASH:Wt,NO_DOT:Za,NO_DOTS:Ja,NO_DOT_SLASH:eo,NO_DOTS_SLASH:to,QMARK_NO_DOT:ro,STAR:no,START_ANCHOR:yn},io={...En,SLASH_LITERAL:`[${_e}]`,QMARK:gn,STAR:`${gn}*?`,DOTS_SLASH:`${we}{1,2}(?:[${_e}]|$)`,NO_DOT:`(?!${we})`,NO_DOTS:`(?!(?:^|[${_e}])${we}{1,2}(?:[${_e}]|$))`,NO_DOT_SLASH:`(?!${we}{0,1}(?:[${_e}]|$))`,NO_DOTS_SLASH:`(?!${we}{1,2}(?:[${_e}]|$))`,QMARK_NO_DOT:`[^.${_e}]`,START_ANCHOR:`(?:^|[${_e}])`,END_ANCHOR:`(?:[${_e}]|$)`},so={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};An.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:so,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Wa.sep,extglobChars(e){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(e){return e===!0?io:En}}});var ut=Ce(ae=>{"use strict";var ao=ht(),oo=!1,{REGEX_BACKSLASH:lo,REGEX_REMOVE_BACKSLASH:ho,REGEX_SPECIAL_CHARS:co,REGEX_SPECIAL_CHARS_GLOBAL:uo}=Ke();ae.isObject=e=>e!==null&&typeof e=="object"&&!Array.isArray(e);ae.hasRegexChars=e=>co.test(e);ae.isRegexChar=e=>e.length===1&&ae.hasRegexChars(e);ae.escapeRegex=e=>e.replace(uo,"\\$1");ae.toPosixSlashes=e=>e.replace(lo,"/");ae.removeBackslashes=e=>e.replace(ho,t=>t==="\\"?"":t);ae.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return e.length===3&&e[0]>=9||e[0]===8&&e[1]>=10};ae.isWindows=e=>e&&typeof e.windows=="boolean"?e.windows:oo===!0||ao.sep==="\\";ae.escapeLast=(e,t,r)=>{let n=e.lastIndexOf(t,r);return n===-1?e:e[n-1]==="\\"?ae.escapeLast(e,t,n-1):`${e.slice(0,n)}\\${e.slice(n)}`};ae.removePrefix=(e,t={})=>{let r=e;return r.startsWith("./")&&(r=r.slice(2),t.prefix="./"),r};ae.wrapOutput=(e,t={},r={})=>{let n=r.contains?"":"^",i=r.contains?"":"$",s=`${n}(?:${e})${i}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var In=Ce((Kf,Ln)=>{"use strict";var wn=ut(),{CHAR_ASTERISK:Xt,CHAR_AT:fo,CHAR_BACKWARD_SLASH:je,CHAR_COMMA:po,CHAR_DOT:qt,CHAR_EXCLAMATION_MARK:Qt,CHAR_FORWARD_SLASH:Tn,CHAR_LEFT_CURLY_BRACE:Zt,CHAR_LEFT_PARENTHESES:Jt,CHAR_LEFT_SQUARE_BRACKET:mo,CHAR_PLUS:vo,CHAR_QUESTION_MARK:Mn,CHAR_RIGHT_CURLY_BRACE:xo,CHAR_RIGHT_PARENTHESES:bn,CHAR_RIGHT_SQUARE_BRACKET:go}=Ke(),Sn=e=>e===Tn||e===je,Rn=e=>{e.isPrefix!==!0&&(e.depth=e.isGlobstar?Infinity:1)},_o=(e,t)=>{let r=t||{},n=e.length-1,i=r.parts===!0||r.scanToEnd===!0,s=[],a=[],o=[],l=e,h=-1,c=0,u=0,f=!1,m=!1,d=!1,v=!1,p=!1,E=!1,L=!1,T=!1,b=!1,S=!1,M=0,O,A,w={value:"",depth:0,isGlob:!1},D=()=>h>=n,x=()=>l.charCodeAt(h+1),P=()=>(O=A,l.charCodeAt(++h));for(;h<n;){A=P();let $;if(A===je){L=w.backslashes=!0,A=P(),A===Zt&&(E=!0);continue}if(E===!0||A===Zt){for(M++;D()!==!0&&(A=P());){if(A===je){L=w.backslashes=!0,P();continue}if(A===Zt){M++;continue}if(E!==!0&&A===qt&&(A=P())===qt){if(f=w.isBrace=!0,d=w.isGlob=!0,S=!0,i===!0)continue;break}if(E!==!0&&A===po){if(f=w.isBrace=!0,d=w.isGlob=!0,S=!0,i===!0)continue;break}if(A===xo&&(M--,M===0)){E=!1,f=w.isBrace=!0,S=!0;break}}if(i===!0)continue;break}if(A===Tn){if(s.push(h),a.push(w),w={value:"",depth:0,isGlob:!1},S===!0)continue;if(O===qt&&h===c+1){c+=2;continue}u=h+1;continue}if(r.noext!==!0&&(A===vo||A===fo||A===Xt||A===Mn||A===Qt)===!0&&x()===Jt){if(d=w.isGlob=!0,v=w.isExtglob=!0,S=!0,A===Qt&&h===c&&(b=!0),i===!0){for(;D()!==!0&&(A=P());){if(A===je){L=w.backslashes=!0,A=P();continue}if(A===bn){d=w.isGlob=!0,S=!0;break}}continue}break}if(A===Xt){if(O===Xt&&(p=w.isGlobstar=!0),d=w.isGlob=!0,S=!0,i===!0)continue;break}if(A===Mn){if(d=w.isGlob=!0,S=!0,i===!0)continue;break}if(A===mo){for(;D()!==!0&&($=P());){if($===je){L=w.backslashes=!0,P();continue}if($===go){m=w.isBracket=!0,d=w.isGlob=!0,S=!0;break}}if(i===!0)continue;break}if(r.nonegate!==!0&&A===Qt&&h===c){T=w.negated=!0,c++;continue}if(r.noparen!==!0&&A===Jt){if(d=w.isGlob=!0,i===!0){for(;D()!==!0&&(A=P());){if(A===Jt){L=w.backslashes=!0,A=P();continue}if(A===bn){S=!0;break}}continue}break}if(d===!0){if(S=!0,i===!0)continue;break}}r.noext===!0&&(v=!1,d=!1);let y=l,N="",g="";c>0&&(N=l.slice(0,c),l=l.slice(c),u-=c),y&&d===!0&&u>0?(y=l.slice(0,u),g=l.slice(u)):d===!0?(y="",g=l):y=l,y&&y!==""&&y!=="/"&&y!==l&&Sn(y.charCodeAt(y.length-1))&&(y=y.slice(0,-1)),r.unescape===!0&&(g&&(g=wn.removeBackslashes(g)),y&&L===!0&&(y=wn.removeBackslashes(y)));let _={prefix:N,input:e,start:c,base:y,glob:g,isBrace:f,isBracket:m,isGlob:d,isExtglob:v,isGlobstar:p,negated:T,negatedExtglob:b};if(r.tokens===!0&&(_.maxDepth=0,Sn(A)||a.push(w),_.tokens=a),r.parts===!0||r.tokens===!0){let $;for(let H=0;H<s.length;H++){let Z=$?$+1:c,J=s[H],te=e.slice(Z,J);r.tokens&&(H===0&&c!==0?(a[H].isPrefix=!0,a[H].value=N):a[H].value=te,Rn(a[H]),_.maxDepth+=a[H].depth),(H!==0||te!=="")&&o.push(te),$=J}if($&&$+1<e.length){let H=e.slice($+1);o.push(H),r.tokens&&(a[a.length-1].value=H,Rn(a[a.length-1]),_.maxDepth+=a[a.length-1].depth)}_.slashes=s,_.parts=o}return _};Ln.exports=_o});var Nn=Ce((jf,On)=>{"use strict";var ft=Ke(),ce=ut(),{MAX_LENGTH:pt,POSIX_REGEX_SOURCE:yo,REGEX_NON_SPECIAL_CHARS:Eo,REGEX_SPECIAL_CHARS_BACKREF:Ao,REPLACEMENTS:Cn}=ft,wo=(e,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...e,t);e.sort();let r=`[${e.join("-")}]`;try{new RegExp(r)}catch(n){return e.map(i=>ce.escapeRegex(i)).join("..")}return r},Ue=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,er=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");e=Cn[e]||e;let r={...t},n=typeof r.maxLength=="number"?Math.min(pt,r.maxLength):pt,i=e.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);let s={type:"bos",value:"",output:r.prepend||""},a=[s],o=r.capture?"":"?:",l=ce.isWindows(t),h=ft.globChars(l),c=ft.extglobChars(h),{DOT_LITERAL:u,PLUS_LITERAL:f,SLASH_LITERAL:m,ONE_CHAR:d,DOTS_SLASH:v,NO_DOT:p,NO_DOT_SLASH:E,NO_DOTS_SLASH:L,QMARK:T,QMARK_NO_DOT:b,STAR:S,START_ANCHOR:M}=h,O=C=>`(${o}(?:(?!${M}${C.dot?v:u}).)*?)`,A=r.dot?"":p,w=r.dot?T:b,D=r.bash===!0?O(r):S;r.capture&&(D=`(${D})`),typeof r.noext=="boolean"&&(r.noextglob=r.noext);let x={input:e,index:-1,start:0,dot:r.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};e=ce.removePrefix(e,x),i=e.length;let P=[],y=[],N=[],g=s,_,$=()=>x.index===i-1,H=x.peek=(C=1)=>e[x.index+C],Z=x.advance=()=>e[++x.index]||"",J=()=>e.slice(x.index+1),te=(C="",K=0)=>{x.consumed+=C,x.index+=K},ve=C=>{x.output+=C.output!=null?C.output:C.value,te(C.value)},Ve=()=>{let C=1;for(;H()==="!"&&(H(2)!=="("||H(3)==="?");)Z(),x.start++,C++;return C%2==0?!1:(x.negated=!0,x.start++,!0)},be=C=>{x[C]++,N.push(C)},xe=C=>{x[C]--,N.pop()},U=C=>{if(g.type==="globstar"){let K=x.braces>0&&(C.type==="comma"||C.type==="brace"),R=C.extglob===!0||P.length&&(C.type==="pipe"||C.type==="paren");C.type!=="slash"&&C.type!=="paren"&&!K&&!R&&(x.output=x.output.slice(0,-g.output.length),g.type="star",g.value="*",g.output=D,x.output+=g.output)}if(P.length&&C.type!=="paren"&&(P[P.length-1].inner+=C.value),(C.value||C.output)&&ve(C),g&&g.type==="text"&&C.type==="text"){g.value+=C.value,g.output=(g.output||"")+C.value;return}C.prev=g,a.push(C),g=C},Ie=(C,K)=>{let R={...c[K],conditions:1,inner:""};R.prev=g,R.parens=x.parens,R.output=x.output;let k=(r.capture?"(":"")+R.open;be("parens"),U({type:C,value:K,output:x.output?"":d}),U({type:"paren",extglob:!0,value:Z(),output:k}),P.push(R)},rt=C=>{let K=C.close+(r.capture?")":""),R;if(C.type==="negate"){let k=D;if(C.inner&&C.inner.length>1&&C.inner.includes("/")&&(k=O(r)),(k!==D||$()||/^\)+$/.test(J()))&&(K=C.close=`)$))${k}`),C.inner.includes("*")&&(R=J())&&/^\.[^\\/.]+$/.test(R)){let W=er(R,{...t,fastpaths:!1}).output;K=C.close=`)${W})${k})`}C.prev.type==="bos"&&(x.negatedExtglob=!0)}U({type:"paren",extglob:!0,value:_,output:K}),xe("parens")};if(r.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(e)){let C=!1,K=e.replace(Ao,(R,k,W,re,Q,Lt)=>re==="\\"?(C=!0,R):re==="?"?k?k+re+(Q?T.repeat(Q.length):""):Lt===0?w+(Q?T.repeat(Q.length):""):T.repeat(W.length):re==="."?u.repeat(W.length):re==="*"?k?k+re+(Q?D:""):D:k?R:`\\${R}`);return C===!0&&(r.unescape===!0?K=K.replace(/\\/g,""):K=K.replace(/\\+/g,R=>R.length%2==0?"\\\\":R?"\\":"")),K===e&&r.contains===!0?(x.output=e,x):(x.output=ce.wrapOutput(K,x,t),x)}for(;!$();){if(_=Z(),_==="\0")continue;if(_==="\\"){let R=H();if(R==="/"&&r.bash!==!0||R==="."||R===";")continue;if(!R){_+="\\",U({type:"text",value:_});continue}let k=/^\\+/.exec(J()),W=0;if(k&&k[0].length>2&&(W=k[0].length,x.index+=W,W%2!=0&&(_+="\\")),r.unescape===!0?_=Z():_+=Z(),x.brackets===0){U({type:"text",value:_});continue}}if(x.brackets>0&&(_!=="]"||g.value==="["||g.value==="[^")){if(r.posix!==!1&&_===":"){let R=g.value.slice(1);if(R.includes("[")&&(g.posix=!0,R.includes(":"))){let k=g.value.lastIndexOf("["),W=g.value.slice(0,k),re=g.value.slice(k+2),Q=yo[re];if(Q){g.value=W+Q,x.backtrack=!0,Z(),!s.output&&a.indexOf(g)===1&&(s.output=d);continue}}}(_==="["&&H()!==":"||_==="-"&&H()==="]")&&(_=`\\${_}`),_==="]"&&(g.value==="["||g.value==="[^")&&(_=`\\${_}`),r.posix===!0&&_==="!"&&g.value==="["&&(_="^"),g.value+=_,ve({value:_});continue}if(x.quotes===1&&_!=='"'){_=ce.escapeRegex(_),g.value+=_,ve({value:_});continue}if(_==='"'){x.quotes=x.quotes===1?0:1,r.keepQuotes===!0&&U({type:"text",value:_});continue}if(_==="("){be("parens"),U({type:"paren",value:_});continue}if(_===")"){if(x.parens===0&&r.strictBrackets===!0)throw new SyntaxError(Ue("opening","("));let R=P[P.length-1];if(R&&x.parens===R.parens+1){rt(P.pop());continue}U({type:"paren",value:_,output:x.parens?")":"\\)"}),xe("parens");continue}if(_==="["){if(r.nobracket===!0||!J().includes("]")){if(r.nobracket!==!0&&r.strictBrackets===!0)throw new SyntaxError(Ue("closing","]"));_=`\\${_}`}else be("brackets");U({type:"bracket",value:_});continue}if(_==="]"){if(r.nobracket===!0||g&&g.type==="bracket"&&g.value.length===1){U({type:"text",value:_,output:`\\${_}`});continue}if(x.brackets===0){if(r.strictBrackets===!0)throw new SyntaxError(Ue("opening","["));U({type:"text",value:_,output:`\\${_}`});continue}xe("brackets");let R=g.value.slice(1);if(g.posix!==!0&&R[0]==="^"&&!R.includes("/")&&(_=`/${_}`),g.value+=_,ve({value:_}),r.literalBrackets===!1||ce.hasRegexChars(R))continue;let k=ce.escapeRegex(g.value);if(x.output=x.output.slice(0,-g.value.length),r.literalBrackets===!0){x.output+=k,g.value=k;continue}g.value=`(${o}${k}|${g.value})`,x.output+=g.value;continue}if(_==="{"&&r.nobrace!==!0){be("braces");let R={type:"brace",value:_,output:"(",outputIndex:x.output.length,tokensIndex:x.tokens.length};y.push(R),U(R);continue}if(_==="}"){let R=y[y.length-1];if(r.nobrace===!0||!R){U({type:"text",value:_,output:_});continue}let k=")";if(R.dots===!0){let W=a.slice(),re=[];for(let Q=W.length-1;Q>=0&&(a.pop(),W[Q].type!=="brace");Q--)W[Q].type!=="dots"&&re.unshift(W[Q].value);k=wo(re,r),x.backtrack=!0}if(R.comma!==!0&&R.dots!==!0){let W=x.output.slice(0,R.outputIndex),re=x.tokens.slice(R.tokensIndex);R.value=R.output="\\{",_=k="\\}",x.output=W;for(let Q of re)x.output+=Q.output||Q.value}U({type:"brace",value:_,output:k}),xe("braces"),y.pop();continue}if(_==="|"){P.length>0&&P[P.length-1].conditions++,U({type:"text",value:_});continue}if(_===","){let R=_,k=y[y.length-1];k&&N[N.length-1]==="braces"&&(k.comma=!0,R="|"),U({type:"comma",value:_,output:R});continue}if(_==="/"){if(g.type==="dot"&&x.index===x.start+1){x.start=x.index+1,x.consumed="",x.output="",a.pop(),g=s;continue}U({type:"slash",value:_,output:m});continue}if(_==="."){if(x.braces>0&&g.type==="dot"){g.value==="."&&(g.output=u);let R=y[y.length-1];g.type="dots",g.output+=_,g.value+=_,R.dots=!0;continue}if(x.braces+x.parens===0&&g.type!=="bos"&&g.type!=="slash"){U({type:"text",value:_,output:u});continue}U({type:"dot",value:_,output:u});continue}if(_==="?"){if(!(g&&g.value==="(")&&r.noextglob!==!0&&H()==="("&&H(2)!=="?"){Ie("qmark",_);continue}if(g&&g.type==="paren"){let k=H(),W=_;if(k==="<"&&!ce.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(g.value==="("&&!/[!=<:]/.test(k)||k==="<"&&!/<([!=]|\w+>)/.test(J()))&&(W=`\\${_}`),U({type:"text",value:_,output:W});continue}if(r.dot!==!0&&(g.type==="slash"||g.type==="bos")){U({type:"qmark",value:_,output:b});continue}U({type:"qmark",value:_,output:T});continue}if(_==="!"){if(r.noextglob!==!0&&H()==="("&&(H(2)!=="?"||!/[!=<:]/.test(H(3)))){Ie("negate",_);continue}if(r.nonegate!==!0&&x.index===0){Ve();continue}}if(_==="+"){if(r.noextglob!==!0&&H()==="("&&H(2)!=="?"){Ie("plus",_);continue}if(g&&g.value==="("||r.regex===!1){U({type:"plus",value:_,output:f});continue}if(g&&(g.type==="bracket"||g.type==="paren"||g.type==="brace")||x.parens>0){U({type:"plus",value:_});continue}U({type:"plus",value:f});continue}if(_==="@"){if(r.noextglob!==!0&&H()==="("&&H(2)!=="?"){U({type:"at",extglob:!0,value:_,output:""});continue}U({type:"text",value:_});continue}if(_!=="*"){(_==="$"||_==="^")&&(_=`\\${_}`);let R=Eo.exec(J());R&&(_+=R[0],x.index+=R[0].length),U({type:"text",value:_});continue}if(g&&(g.type==="globstar"||g.star===!0)){g.type="star",g.star=!0,g.value+=_,g.output=D,x.backtrack=!0,x.globstar=!0,te(_);continue}let C=J();if(r.noextglob!==!0&&/^\([^?]/.test(C)){Ie("star",_);continue}if(g.type==="star"){if(r.noglobstar===!0){te(_);continue}let R=g.prev,k=R.prev,W=R.type==="slash"||R.type==="bos",re=k&&(k.type==="star"||k.type==="globstar");if(r.bash===!0&&(!W||C[0]&&C[0]!=="/")){U({type:"star",value:_,output:""});continue}let Q=x.braces>0&&(R.type==="comma"||R.type==="brace"),Lt=P.length&&(R.type==="pipe"||R.type==="paren");if(!W&&R.type!=="paren"&&!Q&&!Lt){U({type:"star",value:_,output:""});continue}for(;C.slice(0,3)==="/**";){let nt=e[x.index+4];if(nt&&nt!=="/")break;C=C.slice(3),te("/**",3)}if(R.type==="bos"&&$()){g.type="globstar",g.value+=_,g.output=O(r),x.output=g.output,x.globstar=!0,te(_);continue}if(R.type==="slash"&&R.prev.type!=="bos"&&!re&&$()){x.output=x.output.slice(0,-(R.output+g.output).length),R.output=`(?:${R.output}`,g.type="globstar",g.output=O(r)+(r.strictSlashes?")":"|$)"),g.value+=_,x.globstar=!0,x.output+=R.output+g.output,te(_);continue}if(R.type==="slash"&&R.prev.type!=="bos"&&C[0]==="/"){let nt=C[1]!==void 0?"|$":"";x.output=x.output.slice(0,-(R.output+g.output).length),R.output=`(?:${R.output}`,g.type="globstar",g.output=`${O(r)}${m}|${m}${nt})`,g.value+=_,x.output+=R.output+g.output,x.globstar=!0,te(_+Z()),U({type:"slash",value:"/",output:""});continue}if(R.type==="bos"&&C[0]==="/"){g.type="globstar",g.value+=_,g.output=`(?:^|${m}|${O(r)}${m})`,x.output=g.output,x.globstar=!0,te(_+Z()),U({type:"slash",value:"/",output:""});continue}x.output=x.output.slice(0,-g.output.length),g.type="globstar",g.output=O(r),g.value+=_,x.output+=g.output,x.globstar=!0,te(_);continue}let K={type:"star",value:_,output:D};if(r.bash===!0){K.output=".*?",(g.type==="bos"||g.type==="slash")&&(K.output=A+K.output),U(K);continue}if(g&&(g.type==="bracket"||g.type==="paren")&&r.regex===!0){K.output=_,U(K);continue}(x.index===x.start||g.type==="slash"||g.type==="dot")&&(g.type==="dot"?(x.output+=E,g.output+=E):r.dot===!0?(x.output+=L,g.output+=L):(x.output+=A,g.output+=A),H()!=="*"&&(x.output+=d,g.output+=d)),U(K)}for(;x.brackets>0;){if(r.strictBrackets===!0)throw new SyntaxError(Ue("closing","]"));x.output=ce.escapeLast(x.output,"["),xe("brackets")}for(;x.parens>0;){if(r.strictBrackets===!0)throw new SyntaxError(Ue("closing",")"));x.output=ce.escapeLast(x.output,"("),xe("parens")}for(;x.braces>0;){if(r.strictBrackets===!0)throw new SyntaxError(Ue("closing","}"));x.output=ce.escapeLast(x.output,"{"),xe("braces")}if(r.strictSlashes!==!0&&(g.type==="star"||g.type==="bracket")&&U({type:"maybe_slash",value:"",output:`${m}?`}),x.backtrack===!0){x.output="";for(let C of x.tokens)x.output+=C.output!=null?C.output:C.value,C.suffix&&(x.output+=C.suffix)}return x};er.fastpaths=(e,t)=>{let r={...t},n=typeof r.maxLength=="number"?Math.min(pt,r.maxLength):pt,i=e.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);e=Cn[e]||e;let s=ce.isWindows(t),{DOT_LITERAL:a,SLASH_LITERAL:o,ONE_CHAR:l,DOTS_SLASH:h,NO_DOT:c,NO_DOTS:u,NO_DOTS_SLASH:f,STAR:m,START_ANCHOR:d}=ft.globChars(s),v=r.dot?u:c,p=r.dot?f:c,E=r.capture?"":"?:",L={negated:!1,prefix:""},T=r.bash===!0?".*?":m;r.capture&&(T=`(${T})`);let b=A=>A.noglobstar===!0?T:`(${E}(?:(?!${d}${A.dot?h:a}).)*?)`,S=A=>{switch(A){case"*":return`${v}${l}${T}`;case".*":return`${a}${l}${T}`;case"*.*":return`${v}${T}${a}${l}${T}`;case"*/*":return`${v}${T}${o}${l}${p}${T}`;case"**":return v+b(r);case"**/*":return`(?:${v}${b(r)}${o})?${p}${l}${T}`;case"**/*.*":return`(?:${v}${b(r)}${o})?${p}${T}${a}${l}${T}`;case"**/.*":return`(?:${v}${b(r)}${o})?${a}${l}${T}`;default:{let w=/^(.*?)\.(\w+)$/.exec(A);if(!w)return;let D=S(w[1]);return D?D+a+w[2]:void 0}}},M=ce.removePrefix(e,L),O=S(M);return O&&r.strictSlashes!==!0&&(O+=`${o}?`),O};On.exports=er});var Pn=Ce(($f,Bn)=>{"use strict";var To=ht(),Mo=In(),tr=Nn(),rr=ut(),bo=Ke(),So=e=>e&&typeof e=="object"&&!Array.isArray(e),q=(e,t,r=!1)=>{if(Array.isArray(e)){let c=e.map(f=>q(f,t,r));return f=>{for(let m of c){let d=m(f);if(d)return d}return!1}}let n=So(e)&&e.tokens&&e.input;if(e===""||typeof e!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");let i=t||{},s=rr.isWindows(t),a=n?q.compileRe(e,t):q.makeRe(e,t,!1,!0),o=a.state;delete a.state;let l=()=>!1;if(i.ignore){let c={...t,ignore:null,onMatch:null,onResult:null};l=q(i.ignore,c,r)}let h=(c,u=!1)=>{let{isMatch:f,match:m,output:d}=q.test(c,a,t,{glob:e,posix:s}),v={glob:e,state:o,regex:a,posix:s,input:c,output:d,match:m,isMatch:f};return typeof i.onResult=="function"&&i.onResult(v),f===!1?(v.isMatch=!1,u?v:!1):l(c)?(typeof i.onIgnore=="function"&&i.onIgnore(v),v.isMatch=!1,u?v:!1):(typeof i.onMatch=="function"&&i.onMatch(v),u?v:!0)};return r&&(h.state=o),h};q.test=(e,t,r,{glob:n,posix:i}={})=>{if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e==="")return{isMatch:!1,output:""};let s=r||{},a=s.format||(i?rr.toPosixSlashes:null),o=e===n,l=o&&a?a(e):e;return o===!1&&(l=a?a(e):e,o=l===n),(o===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?o=q.matchBase(e,t,r,i):o=t.exec(l)),{isMatch:Boolean(o),match:o,output:l}};q.matchBase=(e,t,r,n=rr.isWindows(r))=>(t instanceof RegExp?t:q.makeRe(t,r)).test(To.basename(e));q.isMatch=(e,t,r)=>q(t,r)(e);q.parse=(e,t)=>Array.isArray(e)?e.map(r=>q.parse(r,t)):tr(e,{...t,fastpaths:!1});q.scan=(e,t)=>Mo(e,t);q.compileRe=(e,t,r=!1,n=!1)=>{if(r===!0)return e.output;let i=t||{},s=i.contains?"":"^",a=i.contains?"":"$",o=`${s}(?:${e.output})${a}`;e&&e.negated===!0&&(o=`^(?!${o}).*$`);let l=q.toRegex(o,t);return n===!0&&(l.state=e),l};q.makeRe=(e,t={},r=!1,n=!1)=>{if(!e||typeof e!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(e[0]==="."||e[0]==="*")&&(i.output=tr.fastpaths(e,t)),i.output||(i=tr(e,t)),q.compileRe(i,t,r,n)};q.toRegex=(e,t)=>{try{let r=t||{};return new RegExp(e,r.flags||(r.nocase?"i":""))}catch(r){if(t&&t.debug===!0)throw r;return/$^/}};q.constants=bo;Bn.exports=q});var Fn=Ce((Wf,Dn)=>{"use strict";Dn.exports=Pn()});var vs=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,xs=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,$r="noscale",It="fit",Wr="scale",Xr="fill",qr="stretch",gs=300,_s=150,ys=It,Es=200,Qr=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=vs,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=xs,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=t.querySelector("canvas"),this._contentElement=t.querySelector(".content"),this._innerElement=t.querySelector("#inner"),this._titleElement=t.querySelector("#title"),this._fpsElement=t.querySelector("#fps"),this._dimensionElement=t.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=gs,this._height=_s,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Fe(this,"mode"),Fe(this,"debug"),Fe(this,"disabled"),Fe(this,"width"),Fe(this,"height"),Fe(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",ys),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,r,n){switch(t){case"debug":this._debug=n!==null;break;case"disabled":this._disabled=n!==null;break;case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this);break}switch(t){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n);break}}getContext(t="2d",r=void 0){return this._canvasElement.getContext(t,r)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);let r=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let s=r<=0?"--":String(Math.round(1e3/r)).padStart(2,"0");if(this._fpsElement.textContent!==s&&(this._fpsElement.textContent=s),this.mode===$r){let o=`${this._width}x${this._height}`;this._dimensionElement.textContent!==o&&(this._dimensionElement.textContent=o)}else{let o=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==o&&(this._dimensionElement.textContent=o)}}let i=this._frameEvent.detail;i.now=t,i.prevTime=this._prevAnimationFrameTime,i.deltaTime=r,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(t,r){(t!==this._resizeCanvasWidth||r!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=r,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,Es))}updateCanvasSize(t=!0){let r=this.shadowRoot.host.getBoundingClientRect(),n=r.width,i=r.height,s=this._canvasElement,a=this._width,o=this._height,l=this.mode;if(l===qr||l===Xr)a=n,o=i;else if(l!==$r&&(n<a||i<o||l===It||l==Wr)){let c=n/a,u=i/o;c<u?(a=n,o=o*c):(a=a*u,o=i)}if(a=Math.floor(a),o=Math.floor(o),typeof t=="undefined"&&(t=s.clientWidth!==a||s.clientHeight!==o),!t){this.delayCanvasResize(a,o);return}let h=Math.min(a/this._width,o/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${h}em`,t){l===Wr?(s.width=this._width,s.height=this._height):l!==qr&&(s.width=a,s.height=o);let c=this._contentElement.style;c.width=`${a}px`,c.height=`${o}px`,(l===It||l===Xr)&&(this._width=a,this._height=o);let f=this._resizeEvent.detail;f.width=a,f.height=o,this.dispatchEvent(this._resizeEvent)}}};Qr.define();function Fe(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let r=e[t];delete e[t],e[t]=r}}var Ct=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,r,n){throw new Error("Missing implementation.")}onStatus(t,r){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,r=void 0){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Ge=class extends Ct{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let r=new Array,n=this.constructor;for(let i=0;i<t;++i)r.push(n.createAxisBindingState());this._state=r,this._value=0,this._delta=0}resize(t){let r=this._state,n=r.length,i;if(t<=n)i=r.slice(0,t);else{i=r;let s=this.constructor;for(let a=n;a<t;++a)i.push(s.createAxisBindingState())}this._state=i,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let r=this._state,n=0,i=0,s=r.length;for(let a=0;a<s;++a){let o=r[a];n+=o.value*(o.inverted?-1:1),i+=o.delta,r[a].delta=0}this._value=n,this._delta=i,super.onPoll(t)}onUpdate(t,r,n){typeof r=="undefined"?this.onAxisChange(t,n):this.onAxisMove(t,r,n)}onStatus(t,r){this.onAxisStatus(t,r)}onBind(t,r=void 0){super.onBind(t,r);let{inverted:n=!1}=r||{},i=this._state;i[t].inverted=n}onAxisMove(t,r,n){let i=this._state[t];i.value=r,i.delta+=n}onAxisChange(t,r){let n=this._state[t];n.value+=r,n.delta+=r}onAxisStatus(t,r){let n=this._state[t],i=n.value;n.value=r,n.delta=r-i}},As=241,Zr=254,ws=239,Oe=1,Ot=2,Nt=4,Bt=8,Pt=16,st=class extends Ct{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let r=this._state,n=r.length,i;t<=n?i=r.slice(0,t):(i=new Uint8Array(t),i.set(r)),this._state=i,super.resize(t)}getState(t){let r=this._state[t],n=r&Pt?-1:1;return(r&Oe?1:0)*n}onPoll(t){let r=this._state,n=0,i=0,s=0,a=0,o=0,l=r.length;for(let h=0;h<l;++h){let c=r[h],u=c&Oe,f=c&Pt;i|=u,s|=c&Ot,a|=c&Nt,o|=c&Bt,n+=(u?1:0)*(f?-1:1),r[h]&=As}this._value=n,this._down=i!==0,this._pressed=s!==0,this._repeated=a!==0,this._released=o!==0,super.onPoll(t)}onUpdate(t,r,n){n>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,r){this.onButtonStatus(t,r!==0)}onBind(t,r={inverted:!1}){super.onBind(t,r);let{inverted:n=!1}=r,i=this._state;n?i[t]|=Pt:i[t]&=ws}onButtonPressed(t){let r=this._state,n=r[t];n&Oe||(n|=Ot,n|=Oe),n|=Nt,r[t]=n}onButtonReleased(t){let r=this._state,n=r[t];n&Oe&&(n|=Bt,n&=Zr),r[t]=n}onButtonStatus(t,r){let n=this._state,i=n[t],s=Boolean(i&Oe);r?i|=Oe:i&=Zr,s&&!r&&(i|=Bt),!s&&r&&(i|=Ot,i|=Nt),n[t]=i}},I=class{static parse(t){t=t.trim();let r=t.indexOf(".");if(r<0)throw new Error("Missing device separator for key code.");let n=t.substring(0,r);if(n.length<0)throw new Error("Missing device for key code.");let i=t.substring(r+1);if(i.length<0)throw new Error("Missing code for key code.");return new I(n,i)}constructor(t,r){this.device=t,this.code=r}toString(){return`${this.device}.${this.code}`}};function Dt(e,t){return new I(e,t)}function Ts(e){return"device"in e&&"code"in e}var B="Keyboard",fe="Mouse",Ms=new I(B,"KeyA"),bs=new I(B,"KeyB"),Ss=new I(B,"KeyC"),Rs=new I(B,"KeyD"),Ls=new I(B,"KeyE"),Is=new I(B,"KeyF"),Cs=new I(B,"KeyG"),Os=new I(B,"KeyH"),Ns=new I(B,"KeyI"),Bs=new I(B,"KeyJ"),Ps=new I(B,"KeyK"),Ds=new I(B,"KeyL"),Fs=new I(B,"KeyM"),Us=new I(B,"KeyN"),ks=new I(B,"KeyO"),zs=new I(B,"KeyP"),Hs=new I(B,"KeyQ"),Ys=new I(B,"KeyR"),Vs=new I(B,"KeyS"),Gs=new I(B,"KeyT"),Ks=new I(B,"KeyU"),js=new I(B,"KeyV"),$s=new I(B,"KeyW"),Ws=new I(B,"KeyX"),Xs=new I(B,"KeyY"),qs=new I(B,"KeyZ"),Qs=new I(B,"Digit0"),Zs=new I(B,"Digit1"),Js=new I(B,"Digit2"),ea=new I(B,"Digit3"),ta=new I(B,"Digit4"),ra=new I(B,"Digit5"),na=new I(B,"Digit6"),ia=new I(B,"Digit7"),sa=new I(B,"Digit8"),aa=new I(B,"Digit9"),oa=new I(B,"Minus"),la=new I(B,"Equal"),ha=new I(B,"BracketLeft"),ca=new I(B,"BracketRight"),ua=new I(B,"Semicolon"),fa=new I(B,"Quote"),pa=new I(B,"Backquote"),da=new I(B,"Backslash"),ma=new I(B,"Comma"),va=new I(B,"Period"),xa=new I(B,"Slash"),ga=new I(B,"Escape"),_a=new I(B,"Space"),ya=new I(B,"CapsLock"),Ea=new I(B,"Backspace"),Aa=new I(B,"Delete"),wa=new I(B,"Tab"),Ta=new I(B,"Enter"),Ma=new I(B,"ArrowUp"),ba=new I(B,"ArrowDown"),Sa=new I(B,"ArrowLeft"),Ra=new I(B,"ArrowRight"),La=new I(fe,"Button0"),Ia=new I(fe,"Button1"),Ca=new I(fe,"Button2"),Oa=new I(fe,"Button3"),Na=new I(fe,"Button4"),Ba=new I(fe,"PosX"),Pa=new I(fe,"PosY"),Da=new I(fe,"WheelX"),Fa=new I(fe,"WheelY"),Ua=new I(fe,"WheelZ"),he=Object.freeze({__proto__:null,ARROW_DOWN:ba,ARROW_LEFT:Sa,ARROW_RIGHT:Ra,ARROW_UP:Ma,BACKQUOTE:pa,BACKSLASH:da,BACKSPACE:Ea,BRACKET_LEFT:ha,BRACKET_RIGHT:ca,CAPS_LOCK:ya,COMMA:ma,DELETE:Aa,DIGIT_0:Qs,DIGIT_1:Zs,DIGIT_2:Js,DIGIT_3:ea,DIGIT_4:ta,DIGIT_5:ra,DIGIT_6:na,DIGIT_7:ia,DIGIT_8:sa,DIGIT_9:aa,ENTER:Ta,EQUAL:la,ESCAPE:ga,KEYBOARD:B,KEY_A:Ms,KEY_B:bs,KEY_C:Ss,KEY_D:Rs,KEY_E:Ls,KEY_F:Is,KEY_G:Cs,KEY_H:Os,KEY_I:Ns,KEY_J:Bs,KEY_K:Ps,KEY_L:Ds,KEY_M:Fs,KEY_N:Us,KEY_O:ks,KEY_P:zs,KEY_Q:Hs,KEY_R:Ys,KEY_S:Vs,KEY_T:Gs,KEY_U:Ks,KEY_V:js,KEY_W:$s,KEY_X:Ws,KEY_Y:Xs,KEY_Z:qs,MINUS:oa,MOUSE:fe,MOUSE_BUTTON_0:La,MOUSE_BUTTON_1:Ia,MOUSE_BUTTON_2:Ca,MOUSE_BUTTON_3:Oa,MOUSE_BUTTON_4:Na,MOUSE_POS_X:Ba,MOUSE_POS_Y:Pa,MOUSE_WHEEL_X:Da,MOUSE_WHEEL_Y:Fa,MOUSE_WHEEL_Z:Ua,PERIOD:va,QUOTE:fa,SEMICOLON:ua,SLASH:xa,SPACE:_a,TAB:wa,from:Dt,isKeyCode:Ts}),Ft=class{get polling(){return this.ref?this.ref.polling:!1}get value(){return!this.ref||this.disabled?0:this.ref.value}constructor(t){this.name=t,this.ref=null,this.disabled=!1}bindTo(t){throw new Error("Unsupported operation.")}disable(t=!0){return this.disabled=t,this}getState(t){return!this.ref||this.disabled?0:this.ref.getState(t)}};function Jr(e){Array.isArray(e)||(e=[e]);let t=[];for(let r of e){let n;try{n=I.parse(r)}catch(i){let s=ka(r).toUpperCase();if(!(s in he))throw new Error("Invalid key code string - "+i);n=he[s]}t.push(n)}return t}function ka(e){return e.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,function(t,r,n){return r+(n&&"_"+n)}).toLowerCase()}var ge=class extends Ft{static fromBind(t,r,n,i=void 0){return new ge(t,Dt(r,n),i)}static fromString(t,...r){let n=Jr(r);return new ge(t,n)}get delta(){return!this.ref||this.disabled?0:this.ref.delta}constructor(t,r,n=void 0){super(t);this.keyCodes=Array.isArray(r)?r:[r],this.opts=n}bindTo(t){let r=this.name,n=this.opts;for(let i of this.keyCodes)t.bindAxis(r,i.device,i.code,n);return this.ref=t.getAxis(r),this}},X=class extends Ft{static fromBind(t,r,n,i=void 0){return new X(t,Dt(r,n),i)}static fromString(t,...r){let n=Jr(r);return new X(t,n)}get pressed(){return!this.ref||this.disabled?!1:this.ref.pressed}get repeated(){return!this.ref||this.disabled?!1:this.ref.repeated}get released(){return!this.ref||this.disabled?!1:this.ref.released}get down(){return!this.ref||this.disabled?!1:this.ref.down}constructor(t,r,n=void 0){super(t);this.keyCodes=Array.isArray(r)?r:[r],this.opts=n}bindTo(t){let r=this.name,n=this.opts;for(let i of this.keyCodes)t.bindButton(r,i.device,i.code,n);return this.ref=t.getButton(r),this}};var Ut=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,r){if(!r)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=r,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let r in t)t[r].length=0}addEventListener(t,r){let n=this.listeners;t in n?n[t].push(r):n[t]=[r]}removeEventListener(t,r){let n=this.listeners;if(t in n){let i=n[t],s=i.indexOf(r);s>=0&&i.splice(s,1)}}dispatchInputEvent(t){let r=0;for(let n of this.listeners.input)r|=n(t);return Boolean(r)}},en=class extends Ut{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,r,n={}){super(t,r);let{ignoreRepeat:i=!0}=n;this.ignoreRepeat=i,this._eventObject={target:r,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),r.addEventListener("keydown",this.onKeyDown),r.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let r=this._eventObject;if(r.code=t.code,r.event="pressed",r.value=1,r.control=t.ctrlKey,r.shift=t.shiftKey,r.alt=t.altKey,this.dispatchInputEvent(r))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let r=this._eventObject;if(r.code=t.code,r.event="released",r.value=1,r.control=t.ctrlKey,r.shift=t.shiftKey,r.alt=t.altKey,this.dispatchInputEvent(r))return t.preventDefault(),t.stopPropagation(),!1}},kt=10,zt=100,tn=class extends Ut{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,r,n={}){super(t,r);let{eventsOnFocus:i=!0}=n;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(r),this._downHasFocus=!1,this._eventObject={target:r,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:r,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:r,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),r.addEventListener("mousedown",this.onMouseDown),r.addEventListener("contextmenu",this.onContextMenu),r.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let r=this._eventObject;if(r.code="Button"+t.button,r.event="pressed",r.value=1,r.control=t.ctrlKey,r.shift=t.shiftKey,r.alt=t.altKey,this.dispatchInputEvent(r)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let r,n,i;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:r=t.deltaX*kt,n=t.deltaY*kt,i=t.deltaZ*kt;break;case WheelEvent.DOM_DELTA_PAGE:r=t.deltaX*zt,n=t.deltaY*zt,i=t.deltaZ*zt;break;case WheelEvent.DOM_DELTA_PIXEL:default:r=t.deltaX,n=t.deltaY,i=t.deltaZ;break}let s=0,a=this._wheelObject;if(a.code="WheelX",a.movement=r,s|=this.dispatchInputEvent(a),a.code="WheelY",a.movement=n,s|=this.dispatchInputEvent(a),a.code="WheelZ",a.movement=i,s|=this.dispatchInputEvent(a),s)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let r=this._eventObject;if(r.code="Button"+t.button,r.event="released",r.value=1,r.control=t.ctrlKey,r.shift=t.shiftKey,r.alt=t.altKey,this.dispatchInputEvent(r))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let r=this.canvasTarget,{clientWidth:n,clientHeight:i}=r,s=r.getBoundingClientRect(),a=t.movementX/n,o=t.movementY/i,l=(t.clientX-s.left)/n,h=(t.clientY-s.top)/i,c=this._positionObject;c.code="PosX",c.value=l,c.movement=a,this.dispatchInputEvent(c),c.code="PosY",c.value=h,c.movement=o,this.dispatchInputEvent(c)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},za=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,Ha=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Ht=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=za,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Ha,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();let t=this.constructor,r=this.attachShadow({mode:"open"});r.appendChild(t[Symbol.for("templateNode")].content.cloneNode(!0)),r.appendChild(t[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=r.querySelector("kbd"),this._nameElement=r.querySelector("#name"),this._valueElement=r.querySelector("#value")}attributeChangedCallback(t,r,n){switch(t){case"name":this._name=n,this._nameElement.textContent=n;break;case"value":this._value=n,n!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=n,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=n!==null,this._kbdElement.classList.toggle("disabled",n!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};Ht.define();var Ya=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,Va=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,rn=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},nn=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let r of this.bindings.getInputs())r.onPoll(t)}onInput(t){let{device:r,code:n,event:i,value:s,movement:a,control:o,shift:l,alt:h}=t,c=this.bindings.getBindings(r,n);switch(i){case"pressed":for(let{input:u,index:f}of c)u.onUpdate(f,1,1);break;case"released":for(let{input:u,index:f}of c)u.onUpdate(f,0,-1);break;case"move":for(let{input:u,index:f}of c)u.onUpdate(f,s,a);break;case"wheel":for(let{input:u,index:f}of c)u.onUpdate(f,void 0,a);break}return c.length>0}},Yt=class{constructor(t,r,n,i){this.device=t,this.code=r,this.input=n,this.index=i}},sn=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,r,n,i={inverted:!1}){let s,a=this.inputMap;if(a.has(t)){let l=a.get(t),h=t.size;t.onBind(h,i),s=new Yt(r,n,t,h),l.push(s)}else{let l=[];a.set(t,l);let h=0;t.onBind(h,i),s=new Yt(r,n,t,h),l.push(s)}let o=this.bindingMap;r in o?n in o[r]?o[r][n].push(s):o[r][n]=[s]:o[r]={[n]:[s]}}unbind(t){let r=this.inputMap;if(r.has(t)){let n=this.bindingMap,i=r.get(t);for(let s of i){let{device:a,code:o}=s,l=n[a][o],h=l.indexOf(s);l.splice(h,1)}i.length=0,t.onUnbind(),r.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,r){let n=this.bindingMap;if(t in n){let i=n[t];if(r in i)return i[r]}return[]}},an=class{constructor(t,r=void 0){this.inputs={},this.devices=[new tn("Mouse",t),new en("Keyboard",t)],this.bindings=new sn,this.adapter=new nn(this.bindings),this.autopoller=new rn(this.adapter),this.eventTarget=t,this.anyButton=new st(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Ge(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let n of this.devices)n.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let n in t)t[n].length=0;this.autopoller.running&&this.autopoller.stop();for(let n of this.devices)n.removeEventListener("input",this.onInput),n.destroy();let r=this.eventTarget;r.removeEventListener("focus",this.onEventTargetFocus),r.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let r=this.eventTarget;r.removeEventListener("focus",this.onEventTargetFocus),r.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let n of this.devices)n.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let r=this.autopoller.running,n=typeof t=="undefined"?!r:Boolean(t);n!==r&&(n?this.autopoller.start():this.autopoller.stop())}addEventListener(t,r){let n=this.listeners;t in n?n[t].push(r):n[t]=[r]}removeEventListener(t,r){let n=this.listeners;if(t in n){let i=n[t],s=i.indexOf(r);s>=0&&i.splice(s,1)}}dispatchEvent(t){let{type:r}=t,n=0;for(let i of this.listeners[r])n|=i(t)?1:0;return Boolean(n)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let r=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return r}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){Array.isArray(t)||(t=Object.values(t));for(let r of t)r.bindTo(this)}bindBinding(t){t.bindTo(this)}bindButton(t,r,n,i=void 0){let s;this.hasButton(t)?s=this.getButton(t):(s=new st(1),this.inputs[t]=s),this.bindings.bind(s,r,n,i),this.onBind()}bindAxis(t,r,n,i=void 0){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Ge(1),this.inputs[t]=s),this.bindings.bind(s,r,n,i),this.onBind()}bindAxisButtons(t,r,n,i){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Ge(2),this.inputs[t]=s),this.bindings.bind(s,r,i),this.bindings.bind(s,r,n,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let r=this.getButton(t);delete this.inputs[t],this.bindings.unbind(r),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let r=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(r),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof st}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Ge}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let r=this.inputs;for(let n of t)if(r[n].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let r=this.inputs;for(let n of t)if(r[n].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let r=this.inputs;for(let n of t)if(r[n].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let r=this.inputs;for(let n of t){let i=r[n];if(i.value)return i.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let r=this.inputs;for(let n of t){let i=r[n];if(i.delta)return i.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},on=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Ya,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Va,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=t.querySelector("#title"),this._pollElement=t.querySelector("#poll"),this._focusElement=t.querySelector("#focus"),this._bodyElement=t.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let r=this;this._for="",this._eventTarget=r,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let t=this._context;t&&(t.removeEventListener("bind",this.onInputContextBind),t.removeEventListener("unbind",this.onInputContextUnbind),t.removeEventListener("blur",this.onInputContextBlur),t.removeEventListener("focus",this.onInputContextFocus),t.destroy(),this._context=null)}attributeChangedCallback(t,r,n){switch(t){case"for":{this._for=n;let i,s;n?(i=document.getElementById(n),s=`${i.tagName.toLowerCase()}#${n}`):(i=this,s="input-port"),this._eventTarget=i,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${s}`}break;case"autopoll":this._autopoll=n!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(t="axisbutton",r=void 0){switch(t){case"axisbutton":if(!this._context){let n=new an(this._eventTarget,r);n.addEventListener("bind",this.onInputContextBind),n.addEventListener("unbind",this.onInputContextUnbind),n.addEventListener("blur",this.onInputContextBlur),n.addEventListener("focus",this.onInputContextFocus),this._autopoll&&n.toggleAutoPoll(!0),this._context=n}return this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,r=t.inputs,n=t.bindings,i={},s=[];for(let a of Object.keys(r)){let o=r[a],l=!0;for(let h of n.getBindingsByInput(o)){let c=Ga(`${o.constructor.name}.${a}`,`${h.device}.${h.code}`,0,l);s.push(c),l&&(i[a]=c.querySelector("output"),l=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let a of s)this._bodyElement.appendChild(a)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let r=this._context.inputs;for(let n of Object.keys(this._outputElements)){let i=this._outputElements[n],s=r[n].value;i.innerText=Number(s).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let r=this._outputElements[t];r.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let r=this._context.inputs;for(let n of Object.values(r))if(!n.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};on.define();function Ga(e,t,r,n=!0){let i=document.createElement("tr");n&&i.classList.add("primary");{let s=document.createElement("td");s.textContent=e,s.classList.add("name"),i.appendChild(s)}{let s=document.createElement("td"),a=document.createElement("output");n?a.innerText=Number(r).toFixed(2):a.innerText="---",a.classList.add("value"),s.appendChild(a),i.appendChild(s)}{let s=document.createElement("td");s.classList.add("key");let a=new Ht;a.innerText=t,s.appendChild(a),i.appendChild(s)}return i}var Uf=Symbol("keyboardSource");var kf=Symbol("mouseSource");window.addEventListener("error",at,!0);window.addEventListener("unhandledrejection",at,!0);function at(e){typeof e=="object"?e instanceof PromiseRejectionEvent?at(e.reason):e instanceof ErrorEvent?at(e.error):e instanceof Error?window.alert(e.stack):window.alert(JSON.stringify(e)):window.alert(e)}var ei=ms(Fn());var Un={},Ro=function(e,t,r,n,i){var s=new Worker(Un[t]||(Un[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return s.onmessage=function(a){var o=a.data,l=o.$e$;if(l){var h=new Error(l[0]);h.code=l[1],h.stack=l[2],i(h,null)}else i(null,o)},s.postMessage(r,n),s},ne=Uint8Array,Se=Uint16Array,nr=Uint32Array,ir=new ne([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sr=new ne([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kn=new ne([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zn=function(e,t){for(var r=new Se(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var i=new nr(r[30]),n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)i[s]=s-r[n]<<5|n;return[r,i]},Hn=zn(ir,2),ar=Hn[0],Lo=Hn[1];ar[28]=258,Lo[258]=28;var Yn=zn(sr,0),Vn=Yn[0],Xf=Yn[1],dt=new Se(32768);for(var j=0;j<32768;++j)Te=(j&43690)>>>1|(j&21845)<<1,Te=(Te&52428)>>>2|(Te&13107)<<2,Te=(Te&61680)>>>4|(Te&3855)<<4,dt[j]=((Te&65280)>>>8|(Te&255)<<8)>>>1;var Te,ke=function(e,t,r){for(var n=e.length,i=0,s=new Se(t);i<n;++i)e[i]&&++s[e[i]-1];var a=new Se(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(r){o=new Se(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var h=i<<4|e[i],c=t-e[i],u=a[e[i]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)o[dt[u]>>>l]=h}else for(o=new Se(n),i=0;i<n;++i)e[i]&&(o[i]=dt[a[e[i]-1]++]>>>15-e[i]);return o},$e=new ne(288);for(var j=0;j<144;++j)$e[j]=8;for(var j=144;j<256;++j)$e[j]=9;for(var j=256;j<280;++j)$e[j]=7;for(var j=280;j<288;++j)$e[j]=8;var Gn=new ne(32);for(var j=0;j<32;++j)Gn[j]=5;var Kn=ke($e,9,1);var jn=ke(Gn,5,1),mt=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},ue=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},vt=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},$n=function(e){return(e+7)/8|0},xt=function(e,t,r){(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length);var n=new(e.BYTES_PER_ELEMENT==2?Se:e.BYTES_PER_ELEMENT==4?nr:ne)(r-t);return n.set(e.subarray(t,r)),n};var Wn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],oe=function(e,t,r){var n=new Error(t||Wn[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,oe),!r)throw n;return n},Xn=function(e,t,r){var n=e.length;if(!n||r&&r.f&&!r.l)return t||new ne(0);var i=!t||r,s=!r||r.i;r||(r={}),t||(t=new ne(n*3));var a=function(U){var Ie=t.length;if(U>Ie){var rt=new ne(Math.max(Ie*2,U));rt.set(t),t=rt}},o=r.f||0,l=r.p||0,h=r.b||0,c=r.l,u=r.d,f=r.m,m=r.n,d=n*8;do{if(!c){o=ue(e,l,1);var v=ue(e,l+1,3);if(l+=3,v)if(v==1)c=Kn,u=jn,f=9,m=5;else if(v==2){var T=ue(e,l,31)+257,b=ue(e,l+10,15)+4,S=T+ue(e,l+5,31)+1;l+=14;for(var M=new ne(S),O=new ne(19),A=0;A<b;++A)O[kn[A]]=ue(e,l+A*3,7);l+=b*3;for(var w=mt(O),D=(1<<w)-1,x=ke(O,w,1),A=0;A<S;){var P=x[ue(e,l,D)];l+=P&15;var p=P>>>4;if(p<16)M[A++]=p;else{var y=0,N=0;for(p==16?(N=3+ue(e,l,3),l+=2,y=M[A-1]):p==17?(N=3+ue(e,l,7),l+=3):p==18&&(N=11+ue(e,l,127),l+=7);N--;)M[A++]=y}}var g=M.subarray(0,T),_=M.subarray(T);f=mt(g),m=mt(_),c=ke(g,f,1),u=ke(_,m,1)}else oe(1);else{var p=$n(l)+4,E=e[p-4]|e[p-3]<<8,L=p+E;if(L>n){s&&oe(0);break}i&&a(h+E),t.set(e.subarray(p,L),h),r.b=h+=E,r.p=l=L*8,r.f=o;continue}if(l>d){s&&oe(0);break}}i&&a(h+131072);for(var $=(1<<f)-1,H=(1<<m)-1,Z=l;;Z=l){var y=c[vt(e,l)&$],J=y>>>4;if(l+=y&15,l>d){s&&oe(0);break}if(y||oe(2),J<256)t[h++]=J;else if(J==256){Z=l,c=null;break}else{var te=J-254;if(J>264){var A=J-257,ve=ir[A];te=ue(e,l,(1<<ve)-1)+ar[A],l+=ve}var Ve=u[vt(e,l)&H],be=Ve>>>4;Ve||oe(3),l+=Ve&15;var _=Vn[be];if(be>3){var ve=sr[be];_+=vt(e,l)&(1<<ve)-1,l+=ve}if(l>d){s&&oe(0);break}i&&a(h+131072);for(var xe=h+te;h<xe;h+=4)t[h]=t[h-_],t[h+1]=t[h+1-_],t[h+2]=t[h+2-_],t[h+3]=t[h+3-_];h=xe}}r.l=c,r.p=Z,r.b=h,r.f=o,c&&(o=1,r.m=f,r.d=u,r.n=m)}while(!o);return h==t.length?t:xt(t,0,h)};var Io=new ne(0);var Co=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},qn=function(e,t,r){for(var n=e(),i=e.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<n.length;++a){var o=n[a],l=s[a];if(typeof o=="function"){t+=";"+l+"=";var h=o.toString();if(o.prototype)if(h.indexOf("[native code]")!=-1){var c=h.indexOf(" ",8)+1;t+=h.slice(c,h.indexOf("(",c))}else{t+=h;for(var u in o.prototype)t+=";"+l+".prototype."+u+"="+o.prototype[u].toString()}else t+=h}else r[l]=o}return[t,r]},gt=[],Oo=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},No=function(e,t,r,n){var i;if(!gt[r]){for(var s="",a={},o=e.length-1,l=0;l<o;++l)i=qn(e[l],s,a),s=i[0],a=i[1];gt[r]=qn(e[o],s,a)}var h=Co({},gt[r][1]);return Ro(gt[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,h,Oo(h),n)},Bo=function(){return[ne,Se,nr,ir,sr,kn,ar,Vn,Kn,jn,dt,Wn,ke,mt,ue,vt,$n,xt,oe,Xn,lr,Qn,Zn]};var Qn=function(e){return postMessage(e,[e.buffer])},Zn=function(e){return e&&e.size&&new ne(e.size)},Po=function(e,t,r,n,i,s){var a=No(r,n,i,function(o,l){a.terminate(),s(o,l)});return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}};var ye=function(e,t){return e[t]|e[t+1]<<8},pe=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},or=function(e,t){return pe(e,t)+pe(e,t+4)*4294967296};function Do(e,t,r){return r||(r=t,t={}),typeof r!="function"&&oe(7),Po(e,t,[Bo],function(n){return Qn(lr(n.data[0],Zn(n.data[1])))},1,r)}function lr(e,t){return Xn(e,t)}var qf=typeof TextEncoder!="undefined"&&new TextEncoder,hr=typeof TextDecoder!="undefined"&&new TextDecoder,Fo=0;try{hr.decode(Io,{stream:!0}),Fo=1}catch(e){}var Uo=function(e){for(var t="",r=0;;){var n=e[r++],i=(n>127)+(n>223)+(n>239);if(r+i>e.length)return[t,xt(e,r-1)];i?i==3?(n=((n&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?t+=String.fromCharCode((n&31)<<6|e[r++]&63):t+=String.fromCharCode((n&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(n)}};function ko(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}else{if(hr)return hr.decode(e);var i=Uo(e),s=i[0],a=i[1];return a.length&&oe(8),s}}var zo=function(e,t){return t+30+ye(e,t+26)+ye(e,t+28)},Ho=function(e,t,r){var n=ye(e,t+28),i=ko(e.subarray(t+46,t+46+n),!(ye(e,t+8)&2048)),s=t+46+n,a=pe(e,t+20),o=r&&a==4294967295?Yo(e,s):[a,pe(e,t+24),pe(e,t+42)],l=o[0],h=o[1],c=o[2];return[ye(e,t+10),l,h,i,s+ye(e,t+30)+ye(e,t+32),c]},Yo=function(e,t){for(;ye(e,t)!=1;t+=4+ye(e,t+2));return[or(e,t+12),or(e,t+4),or(e,t+20)]};var Jn=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function cr(e,t,r){r||(r=t,t={}),typeof r!="function"&&oe(7);var n=[],i=function(){for(var p=0;p<n.length;++p)n[p]()},s={},a=function(p,E){Jn(function(){r(p,E)})};Jn(function(){a=r});for(var o=e.length-22;pe(e,o)!=101010256;--o)if(!o||e.length-o>65558)return a(oe(13,0,1),null),i;var l=ye(e,o+8);if(l){var h=l,c=pe(e,o+16),u=c==4294967295||h==65535;if(u){var f=pe(e,o-12);u=pe(e,f)==101075792,u&&(h=l=pe(e,f+32),c=pe(e,f+48))}for(var m=t&&t.filter,d=function(p){var E=Ho(e,c,u),L=E[0],T=E[1],b=E[2],S=E[3],M=E[4],O=E[5],A=zo(e,O);c=M;var w=function(x,P){x?(i(),a(x,null)):(P&&(s[S]=P),--l||a(null,s))};if(!m||m({name:S,size:T,originalSize:b,compression:L}))if(!L)w(null,xt(e,A,A+T));else if(L==8){var D=e.subarray(A,A+T);if(T<32e4)try{w(null,lr(D,new ne(b)))}catch(x){w(x,null)}else n.push(Do(D,{size:b},w))}else w(oe(14,"unknown compression type "+L,1),null);else w(null,null)},v=0;v<h;++v)d(v)}else a(null,{});return i}var We=class{constructor(t){let r;typeof t=="object"&&t instanceof We?r=t.source:r=String(t),this.source=r,this._re=(0,ei.makeRe)(r)}test(t){return this._re.test(t)}},Vo=/^([_\w\d]+)\:\/\//,ti=5e3;async function Go(e,t,r,n,i=ti){let{cache:s,loadings:a}=e;if(t in s)return s[t];let o;if(t in a){if(o=a[t],o.active)return a[t].promise}else o=new fr(i),a[t]=o;let l=[o.promise];return Vo.test(r)?l.push(ri(e,r,i).then(h=>n(h)).then(h=>ze(e,t,h))):l.push(fetch(r).then(h=>h.arrayBuffer()).then(h=>n(h)).then(h=>ze(e,t,h))),await Promise.race(l)}function ze(e,t,r){let{cache:n,loadings:i}=e;return n[t]=r,t in i&&(i[t].resolve(r),delete i[t]),r}function Ko(e,t){let{cache:r,loadings:n}=e;t in n&&(n[t].reject(new Error("Stop loading to delete asset.")),delete n[t]),t in r&&delete r[t]}async function ri(e,t,r=ti){let{cache:n,loadings:i}=e;if(t in n)return n[t];if(t in i)return i[t].promise;{let s=new fr(r);return i[t]=s,s.promise}}function jo(e,t){let{defaults:r}=e;for(let n of r)if(n.glob.test(t))return ur(e,n.uri);return null}function ur(e,t){return e.cache[t]}function $o(e){return Object.keys(e.cache)}var fr=class{constructor(t){this.active=!1,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(t)&&t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((r,n)=>{this._value?r(this._value):this._resolve=r,this._reason?n(this._reason):this._reject=n})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}},Re=class{constructor(t,r,n){this.uri=t,this.source=r,this.loader=n,this.store=null}get current(){return ur(this.store,this.uri)}set current(t){ze(this.store,this.uri,t)}get default(){return jo(this.store,this.uri)}get loaded(){return ri(this.store,this.uri)}async preload(t,r=void 0,n=void 0){return this.store=t,typeof n!="undefined"?ze(t,this.uri,n):await Go(this.store,this.uri,this.source,this.loader,r),this}async unload(){return Ko(this.store,this.uri),this.store=null,this}},Wo=5e3,Xe={cache:{},loadings:{},defaults:[]};async function Xo(e,t=void 0){let r="raw://",i=await(await fetch(e)).arrayBuffer();await new Promise((s,a)=>{cr(new Uint8Array(i),(o,l)=>{if(o)a(o);else{for(let[h,c]of Object.entries(l)){h=h.replaceAll("\\","/");let u=h.indexOf("/");u>=0&&(h=h.substring(u+1));let f=r+h;ze(Xe,f,c),t&&t(c,f,h)}s()}})})}async function qo(e,t){let n=await(await fetch(e)).arrayBuffer();await new Promise((i,s)=>{cr(new Uint8Array(n),(a,o)=>{if(a)s(a);else{for(let[l,h]of Object.entries(o))l=l.replaceAll("\\","/"),t(h,l);i()}})})}async function Qo(e,t=Wo){let r=[];for(let n of e)r.push(n.preload(Xe,t));await Promise.allSettled(r)}function Zo(e,t){return ze(Xe,e,t)}function Jo(){return $o(Xe)}function ni(e){return ur(Xe,e)}function el(e){return ni(e)}var ie=Object.freeze({__proto__:null,cache:Zo,current:ni,get:el,keys:Jo,loadAssetPack:qo,loadAssetPackAsRaw:Xo,loadAssetRefs:Qo});var pr=class{constructor(){this._pipeline={}}async pipe(t,r){let n=new We(t),i=n.source,s;i in this._pipeline?s=this._pipeline[i]:(s=new ii(n),this._pipeline[i]=s),s.addHandler(r);for(let a of ie.keys())s.matches(a)&&await r(ie.current(a),a)}},ii=class{constructor(t){this.filter=t,this.handlers=[]}matches(t){return this.filter.test(t)}async process(t,r){return Promise.all(this.handlers.map(n=>n(t,r)))}addHandler(t){this.handlers.push(t)}};var dr={on(e,t,r=t){let n;if(this.__events.has(e)?n=this.__events.get(e):(n=new Map,this.__events.set(e,n)),!n.has(r))n.set(r,t);else throw new Error(`Found callback for event '${e}' with the same handle '${r}'.`);return this},off(e,t){if(this.__events.has(e)){let r=this.__events.get(e);if(r.has(t))r.delete(t);else throw new Error(`Unable to find callback for event '${e}' with handle '${t}'.`)}else throw new Error(`Unable to find event '${e}'.`);return this},once(e,t,r=t){let n=(...i)=>{this.off(e,r),t.apply(this.__context||this,i)};return this.on(e,n,r)},emit(e,...t){if(this.__events.has(e)){let r=[],n=Array.from(this.__events.get(e).values());for(let i of n){let s=i.apply(this.__context||this,t);s&&r.push(s)}return r}else return this.__events.set(e,new Map),[]}};function tl(e=void 0){let t=Object.create(dr);return t.__events=new Map,t.__context=e,t}function rl(e,t=void 0){let r=Object.assign(e,dr);return r.__events=new Map,r.__context=t,r}function nl(e,t=void 0){let r=e.prototype;return Object.assign(r,dr),r.__events=new Map,r.__context=t,r}var si={create:tl,assign:rl,mixin:nl},il=5,sl=4,al=3,ol=2,ll=1,hl=0,rp={[il]:qe("#7F8C8D"),[sl]:qe("#2ECC71"),[al]:qe("#4794C8"),[ol]:qe("#F39C12"),[ll]:qe("#C0392B"),[hl]:[""]};function qe(e){return[`background: ${e}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}var np=Symbol("level"),ip=Symbol("domain");var He=0,cl=class{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(let r of t)this._heap.push(r),this._shiftUp()}pop(){let t=this.peek(),r=ul(this);return r>He&&this._swap(He,r),this._heap.pop(),this._shiftDown(),t}replace(t){let r=this.peek();return this._heap[He]=t,this._shiftDown(),r}peek(){return this._heap[He]}_compare(t,r){return this._comparator(this._heap[t],this._heap[r])}_swap(t,r){let n=this._heap[t];this._heap[t]=this._heap[r],this._heap[r]=n}_shiftUp(){let t=this._heap.length-1,r;for(;t>He&&this._compare(t,r=fl(t));)this._swap(t,r),t=r}_shiftDown(){let t=this._heap.length,r=He,n,i=ai(r),s=i<t,a=oi(r),o=a<t;for(;s&&this._compare(i,r)||o&&this._compare(a,r);)n=o&&this._compare(a,i)?a:i,this._swap(r,n),r=n,i=ai(r),s=i<t,a=oi(r),o=a<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}};function ul(e){return e._heap.length-1}function fl(e){return(e+1>>>1)-1}function ai(e){return(e<<1)+1}function oi(e){return e+1<<1}function mr(e,t,r){return Math.min(r,Math.max(t,e))}var sp=Math.PI/180,ap=180/Math.PI;var vr=class{constructor(t,r){this.display=t,this.inputs=r,this.assets=ie,this.deltaTime=0,this.prevTime=0,this.now=0,this.events=si.create()}on(t,r){return this.events.on(t,r),this}off(t,r){return this.events.off(t,r),this}once(t,r){return this.events.once(t,r),this}emit(t,...r){this.events.emit(t,...r)}};async function xr(e,t=void 0){if(typeof e=="string"){let o=await(await fetch(e)).arrayBuffer();if(typeof t=="undefined"){let l=e.lastIndexOf(".");if(l<0)throw new Error("Cannot load from url - unknown image type.");t="image/"+e.slice(l+1)}return xr(o,t)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let r=e;typeof t=="undefined"&&(t="image/png");let n=new Blob([r],{type:t}),i=URL.createObjectURL(n),s=new Image;return new Promise((a,o)=>{s.addEventListener("load",()=>{a(s)}),s.addEventListener("error",l=>{o(l)}),s.src=i})}async function gr(e){if(typeof e=="string"){let n=await(await fetch(e)).arrayBuffer();return gr(n)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e;return pl(new TextDecoder().decode(t))}function pl(e){let t=[],r=[],n=[],i=[],s=[],a=[],o=/^#.*/g,l=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,c=/vt\s+(\S+)\s+(\S+)/g,u=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,f=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g,m=!1,d=null,v,p,E,L;for(e=e.replace(o,"");(d=l.exec(e))!=null;)v=Number.parseFloat(d[1]),p=Number.parseFloat(d[2]),E=Number.parseFloat(d[3]),t.push(v),t.push(p),t.push(E);for(;(d=h.exec(e))!=null;)v=Number.parseFloat(d[1]),p=Number.parseFloat(d[2]),E=Number.parseFloat(d[3]),n.push(v),n.push(p),n.push(E);for(;(d=c.exec(e))!=null;)v=Number.parseFloat(d[1]),p=Number.parseFloat(d[2]),r.push(v),r.push(p);for(;(d=u.exec(e))!=null;)v=Number.parseInt(d[2]),Number.isNaN(v)&&(v=1),p=Number.parseInt(d[6]),Number.isNaN(p)&&(p=1),E=Number.parseInt(d[10]),Number.isNaN(E)&&(E=1),i.push(v),i.push(p),i.push(E),v=Number.parseInt(d[4]),Number.isNaN(v)?(v=Number.parseInt(d[3]),p=Number.parseInt(d[7]),E=Number.parseInt(d[11]),a.push(v),a.push(p),a.push(E),s.push(1),s.push(1),s.push(1)):(p=Number.parseInt(d[8]),Number.isNaN(p)&&(p=1),E=Number.parseInt(d[12]),Number.isNaN(E)&&(E=1),a.push(v),a.push(p),a.push(E),v=Number.parseInt(d[3]),Number.isNaN(v)&&(v=1),p=Number.parseInt(d[7]),Number.isNaN(p)&&(p=1),E=Number.parseInt(d[11]),Number.isNaN(E)&&(E=1),s.push(v),s.push(p),s.push(E)),typeof d[13]!="undefined"&&(L=Number.parseInt(d[15]),Number.isNaN(L)&&(L=1),i.push(L),L=Number.parseInt(d[17]),Number.isNaN(L)?(L=Number.parseInt(d[16]),a.push(L),s.push(1)):(a.push(L),L=Number.parseInt(d[16]),s.push(L)),m=!0);for(;(d=f.exec(e))!=null;)v=Number.parseInt(d[2]),p=Number.parseInt(d[6]),E=Number.parseInt(d[10]),i.push(v),i.push(p),i.push(E),s.push(1),s.push(1),s.push(1),a.push(1),a.push(1),a.push(1),typeof d[13]!="undefined"&&(L=Number.parseInt(d[14]),i.push(L),s.push(1),a.push(1),m=!0);let T,b;b=i.length;let S=new Float32Array(b*3);for(let w=0;w<b;++w)T=i[w]-1,S[w*3+0]=t[T*3+0],S[w*3+1]=t[T*3+1],S[w*3+2]=t[T*3+2];b=s.length;let M=new Float32Array(b*2);for(let w=0;w<b;++w)T=s[w]-1,M[w*2+0]=r[T*2+0],M[w*2+1]=r[T*2+1];b=a.length;let O=new Float32Array(b*3);for(let w=0;w<b;++w)T=a[w]-1,O[w*3+0]=n[T*3+0],O[w*3+1]=n[T*3+1],O[w*3+2]=n[T*3+2];b=i.length;let A=new Uint16Array(b);for(let w=0;w<b;++w)A[w]=w;return m&&console.warn("WebGL does not support quad faces, only triangles."),{positions:S,texcoords:M,normals:O,indices:A}}async function _r(e){if(typeof e=="string"){let s=await(await fetch(e)).arrayBuffer();return _r(s)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e,r=new TextDecoder().decode(t),n={};for(let i of r.split(`
`)){if(i=i.trim(),i<=0||i.startsWith("#")||i.startsWith("//"))continue;let s=[],a=0,o=i.indexOf(" ");for(;o>=0;)s.push(i.substring(a,o)),a=o+1,o=i.indexOf(" ",a);s.push(i.substring(a));let l=s[0],h=Number.parseInt(s[1]),c=Number.parseInt(s[2]),u=Number.parseInt(s[3]),f=Number.parseInt(s[4]),m=s.length>=6?Number.parseInt(s[5]):1,d=s.length>=7?Number.parseInt(s[6]):m,v=s.length>=8?Number.parseInt(s[7]):m>d?Math.ceil(m/d):1;n[l]={u:h,v:c,w:u,h:f,frames:m,cols:d,rows:v,name:l}}return n}async function Qe(e,t){if(typeof e=="string"){let a=await(await fetch(e)).arrayBuffer();return Qe(a)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let r=e,n=new ArrayBuffer(r.byteLength);return new Uint8Array(n).set(r),await t.decodeAudioData(n)}async function yr(e){if(typeof e=="string"){let n=await(await fetch(e)).arrayBuffer();return yr(n)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e;return vl(new TextDecoder().decode(t))}var dl=/(.+?)\s+(.*)/,ml=/(.+)=(.+)/;function vl(e){let t=e.split(`
`),r={},n={},i={},s=[],a=[];for(let l of t){let h=dl.exec(l);if(!h)continue;let[c,u,f]=h;switch(u){case"info":Ze(r,f);break;case"common":Ze(n,f);break;case"page":Ze(i,f);break;case"chars":break;case"char":let m={};Ze(m,f),"id"in m&&s.push(m);break;case"kerning":let d={};Ze(d,f),"first"in d&&a.push(d);break;default:}}return{info:r,common:n,page:i,chars:s,kernings:a}}function Ze(e,t){let r=t.split(/\s+/);for(let n of r){let i=ml.exec(n);if(!i)continue;let[s,a,o]=i,l=JSON.parse(`[${o}]`);l.length===1?e[a]=l[0]:e[a]=l}}async function _t(e){if(typeof e=="string"){let n=await(await fetch(e)).arrayBuffer();return _t(n)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e;return new TextDecoder().decode(t)}var Er=Symbol("audioContext"),Be=class{static getAudioContext(){if(Er in this)return this[Er];{let t=new AudioContext;return xl(t),this[Er]=t,t}}constructor(t,r){this.audioContext=t,this.audioBuffer=r,this._playing=!1,this._started=!1,this._source=null,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}destroy(){this._source&&this._source.disconnect(),this._source=null,this._started=!1,this._playing=!1}onAudioSourceEnded(){this._playing=!1}play(t={}){let r=this.audioBuffer;if(!r)return;this._source&&this.destroy();let{pitch:n=void 0,gain:i=void 0,pan:s=void 0,loop:a=!1}=t,o=this.audioContext,l=o.createBufferSource();l.addEventListener("ended",this.onAudioSourceEnded),l.buffer=r,l.loop=a;let h=l;if(n&&(l.detune.value=n*100),i){let c=o.createGain();c.gain.value=i,h=h.connect(c)}if(s){let c=o.createStereoPanner();c.pan.value=s,h=h.connect(c)}h.connect(o.destination),l.start(),this._source=l,this._started=!0,this._playing=!0}pause(){this._source.stop(),this._playing=!1}isStarted(){return this._started}isPlaying(){return this._playing}isPaused(){return this._started&&!this._playing}};function xl(e){let t=()=>{e.state==="suspended"&&e.resume()};document.addEventListener("click",t)}var _p=ge.fromString("cursorX","Mouse.PosX"),yp=ge.fromString("cursorY","Mouse.PosY"),Ep=X.fromString("activate","Mouse.Button0"),Ap=X.fromString("mark","Mouse.Button2"),wp=X.fromString("restart","Keyboard.KeyR");var Tp=Symbol("IslandRendererInfo");var Ar=class{next(){return 0}},li=class extends Ar{next(){return Math.random()}},hi=class extends Ar{constructor(t){super();this.seed=t,this.a=t}next(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}},F=class{static get RAND(){let t=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:t}),t}constructor(t=void 0){typeof t=="number"?this.generator=new hi(t):t?this.generator=t:this.generator=new li,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(t){return this.RAND.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,r){return this.RAND.range(t,r)}range(t,r){return(r-t)*this.generator.next()+t}static rangeInt(t,r){return this.RAND.rangeInt(t,r)}rangeInt(t,r){return Math.trunc(this.range(t,r))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};document.title="Archaea";document.title="Architect";var _l=X.fromString("moveLeft","Keyboard.KeyA"),yl=X.fromString("moveRight","Keyboard.KeyD"),El=X.fromString("moveUp","Keyboard.KeyW"),Al=X.fromString("moveDown","Keyboard.KeyS"),ld=ge.fromString("cursorX","Mouse.PosX"),hd=ge.fromString("cursorY","Mouse.PosY"),wl=X.fromString("shoot","Keyboard.Space");document.title="Bioform";var z=1e-6,G=typeof Float32Array!="undefined"?Float32Array:Array,le=Math.random;var Md=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function ci(){var e=new G(9);return G!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}var V={};De(V,{add:()=>ch,adjoint:()=>Bl,clone:()=>Rl,copy:()=>Ll,create:()=>Sl,determinant:()=>Pl,equals:()=>dh,exactEquals:()=>ph,frob:()=>hh,fromQuat:()=>Jl,fromQuat2:()=>Wl,fromRotation:()=>Gl,fromRotationTranslation:()=>pi,fromRotationTranslationScale:()=>Ql,fromRotationTranslationScaleOrigin:()=>Zl,fromScaling:()=>Vl,fromTranslation:()=>Yl,fromValues:()=>Il,fromXRotation:()=>Kl,fromYRotation:()=>jl,fromZRotation:()=>$l,frustum:()=>eh,getRotation:()=>ql,getScaling:()=>di,getTranslation:()=>Xl,identity:()=>ui,invert:()=>Nl,lookAt:()=>ah,mul:()=>mh,multiply:()=>fi,multiplyScalar:()=>uh,multiplyScalarAndAdd:()=>fh,ortho:()=>ih,orthoNO:()=>vi,orthoZO:()=>sh,perspective:()=>th,perspectiveFromFieldOfView:()=>nh,perspectiveNO:()=>mi,perspectiveZO:()=>rh,rotate:()=>Ul,rotateX:()=>kl,rotateY:()=>zl,rotateZ:()=>Hl,scale:()=>Fl,set:()=>Cl,str:()=>lh,sub:()=>vh,subtract:()=>xi,targetTo:()=>oh,translate:()=>Dl,transpose:()=>Ol});function Sl(){var e=new G(16);return G!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Rl(e){var t=new G(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ll(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Il(e,t,r,n,i,s,a,o,l,h,c,u,f,m,d,v){var p=new G(16);return p[0]=e,p[1]=t,p[2]=r,p[3]=n,p[4]=i,p[5]=s,p[6]=a,p[7]=o,p[8]=l,p[9]=h,p[10]=c,p[11]=u,p[12]=f,p[13]=m,p[14]=d,p[15]=v,p}function Cl(e,t,r,n,i,s,a,o,l,h,c,u,f,m,d,v,p){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=h,e[9]=c,e[10]=u,e[11]=f,e[12]=m,e[13]=d,e[14]=v,e[15]=p,e}function ui(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ol(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=i,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Nl(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],m=t[11],d=t[12],v=t[13],p=t[14],E=t[15],L=r*o-n*a,T=r*l-i*a,b=r*h-s*a,S=n*l-i*o,M=n*h-s*o,O=i*h-s*l,A=c*v-u*d,w=c*p-f*d,D=c*E-m*d,x=u*p-f*v,P=u*E-m*v,y=f*E-m*p,N=L*y-T*P+b*x+S*D-M*w+O*A;return N?(N=1/N,e[0]=(o*y-l*P+h*x)*N,e[1]=(i*P-n*y-s*x)*N,e[2]=(v*O-p*M+E*S)*N,e[3]=(f*M-u*O-m*S)*N,e[4]=(l*D-a*y-h*w)*N,e[5]=(r*y-i*D+s*w)*N,e[6]=(p*b-d*O-E*T)*N,e[7]=(c*O-f*b+m*T)*N,e[8]=(a*P-o*D+h*A)*N,e[9]=(n*D-r*P-s*A)*N,e[10]=(d*M-v*b+E*L)*N,e[11]=(u*b-c*M-m*L)*N,e[12]=(o*w-a*x-l*A)*N,e[13]=(r*x-n*w+i*A)*N,e[14]=(v*T-d*S-p*L)*N,e[15]=(c*S-u*T+f*L)*N,e):null}function Bl(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],m=t[11],d=t[12],v=t[13],p=t[14],E=t[15];return e[0]=o*(f*E-m*p)-u*(l*E-h*p)+v*(l*m-h*f),e[1]=-(n*(f*E-m*p)-u*(i*E-s*p)+v*(i*m-s*f)),e[2]=n*(l*E-h*p)-o*(i*E-s*p)+v*(i*h-s*l),e[3]=-(n*(l*m-h*f)-o*(i*m-s*f)+u*(i*h-s*l)),e[4]=-(a*(f*E-m*p)-c*(l*E-h*p)+d*(l*m-h*f)),e[5]=r*(f*E-m*p)-c*(i*E-s*p)+d*(i*m-s*f),e[6]=-(r*(l*E-h*p)-a*(i*E-s*p)+d*(i*h-s*l)),e[7]=r*(l*m-h*f)-a*(i*m-s*f)+c*(i*h-s*l),e[8]=a*(u*E-m*v)-c*(o*E-h*v)+d*(o*m-h*u),e[9]=-(r*(u*E-m*v)-c*(n*E-s*v)+d*(n*m-s*u)),e[10]=r*(o*E-h*v)-a*(n*E-s*v)+d*(n*h-s*o),e[11]=-(r*(o*m-h*u)-a*(n*m-s*u)+c*(n*h-s*o)),e[12]=-(a*(u*p-f*v)-c*(o*p-l*v)+d*(o*f-l*u)),e[13]=r*(u*p-f*v)-c*(n*p-i*v)+d*(n*f-i*u),e[14]=-(r*(o*p-l*v)-a*(n*p-i*v)+d*(n*l-i*o)),e[15]=r*(o*f-l*u)-a*(n*f-i*u)+c*(n*l-i*o),e}function Pl(e){var t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],f=e[11],m=e[12],d=e[13],v=e[14],p=e[15],E=t*a-r*s,L=t*o-n*s,T=t*l-i*s,b=r*o-n*a,S=r*l-i*a,M=n*l-i*o,O=h*d-c*m,A=h*v-u*m,w=h*p-f*m,D=c*v-u*d,x=c*p-f*d,P=u*p-f*v;return E*P-L*x+T*D+b*w-S*A+M*O}function fi(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],f=t[9],m=t[10],d=t[11],v=t[12],p=t[13],E=t[14],L=t[15],T=r[0],b=r[1],S=r[2],M=r[3];return e[0]=T*n+b*o+S*u+M*v,e[1]=T*i+b*l+S*f+M*p,e[2]=T*s+b*h+S*m+M*E,e[3]=T*a+b*c+S*d+M*L,T=r[4],b=r[5],S=r[6],M=r[7],e[4]=T*n+b*o+S*u+M*v,e[5]=T*i+b*l+S*f+M*p,e[6]=T*s+b*h+S*m+M*E,e[7]=T*a+b*c+S*d+M*L,T=r[8],b=r[9],S=r[10],M=r[11],e[8]=T*n+b*o+S*u+M*v,e[9]=T*i+b*l+S*f+M*p,e[10]=T*s+b*h+S*m+M*E,e[11]=T*a+b*c+S*d+M*L,T=r[12],b=r[13],S=r[14],M=r[15],e[12]=T*n+b*o+S*u+M*v,e[13]=T*i+b*l+S*f+M*p,e[14]=T*s+b*h+S*m+M*E,e[15]=T*a+b*c+S*d+M*L,e}function Dl(e,t,r){var n=r[0],i=r[1],s=r[2],a,o,l,h,c,u,f,m,d,v,p,E;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*s+t[12],e[13]=t[1]*n+t[5]*i+t[9]*s+t[13],e[14]=t[2]*n+t[6]*i+t[10]*s+t[14],e[15]=t[3]*n+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],l=t[2],h=t[3],c=t[4],u=t[5],f=t[6],m=t[7],d=t[8],v=t[9],p=t[10],E=t[11],e[0]=a,e[1]=o,e[2]=l,e[3]=h,e[4]=c,e[5]=u,e[6]=f,e[7]=m,e[8]=d,e[9]=v,e[10]=p,e[11]=E,e[12]=a*n+c*i+d*s+t[12],e[13]=o*n+u*i+v*s+t[13],e[14]=l*n+f*i+p*s+t[14],e[15]=h*n+m*i+E*s+t[15]),e}function Fl(e,t,r){var n=r[0],i=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ul(e,t,r,n){var i=n[0],s=n[1],a=n[2],o=Math.hypot(i,s,a),l,h,c,u,f,m,d,v,p,E,L,T,b,S,M,O,A,w,D,x,P,y,N,g;return o<z?null:(o=1/o,i*=o,s*=o,a*=o,l=Math.sin(r),h=Math.cos(r),c=1-h,u=t[0],f=t[1],m=t[2],d=t[3],v=t[4],p=t[5],E=t[6],L=t[7],T=t[8],b=t[9],S=t[10],M=t[11],O=i*i*c+h,A=s*i*c+a*l,w=a*i*c-s*l,D=i*s*c-a*l,x=s*s*c+h,P=a*s*c+i*l,y=i*a*c+s*l,N=s*a*c-i*l,g=a*a*c+h,e[0]=u*O+v*A+T*w,e[1]=f*O+p*A+b*w,e[2]=m*O+E*A+S*w,e[3]=d*O+L*A+M*w,e[4]=u*D+v*x+T*P,e[5]=f*D+p*x+b*P,e[6]=m*D+E*x+S*P,e[7]=d*D+L*x+M*P,e[8]=u*y+v*N+T*g,e[9]=f*y+p*N+b*g,e[10]=m*y+E*N+S*g,e[11]=d*y+L*N+M*g,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function kl(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+h*n,e[5]=a*i+c*n,e[6]=o*i+u*n,e[7]=l*i+f*n,e[8]=h*i-s*n,e[9]=c*i-a*n,e[10]=u*i-o*n,e[11]=f*i-l*n,e}function zl(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],h=t[8],c=t[9],u=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-h*n,e[1]=a*i-c*n,e[2]=o*i-u*n,e[3]=l*i-f*n,e[8]=s*n+h*i,e[9]=a*n+c*i,e[10]=o*n+u*i,e[11]=l*n+f*i,e}function Hl(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],h=t[4],c=t[5],u=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+h*n,e[1]=a*i+c*n,e[2]=o*i+u*n,e[3]=l*i+f*n,e[4]=h*i-s*n,e[5]=c*i-a*n,e[6]=u*i-o*n,e[7]=f*i-l*n,e}function Yl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Vl(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gl(e,t,r){var n=r[0],i=r[1],s=r[2],a=Math.hypot(n,i,s),o,l,h;return a<z?null:(a=1/a,n*=a,i*=a,s*=a,o=Math.sin(t),l=Math.cos(t),h=1-l,e[0]=n*n*h+l,e[1]=i*n*h+s*o,e[2]=s*n*h-i*o,e[3]=0,e[4]=n*i*h-s*o,e[5]=i*i*h+l,e[6]=s*i*h+n*o,e[7]=0,e[8]=n*s*h+i*o,e[9]=i*s*h-n*o,e[10]=s*s*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Kl(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jl(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $l(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pi(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=n+n,l=i+i,h=s+s,c=n*o,u=n*l,f=n*h,m=i*l,d=i*h,v=s*h,p=a*o,E=a*l,L=a*h;return e[0]=1-(m+v),e[1]=u+L,e[2]=f-E,e[3]=0,e[4]=u-L,e[5]=1-(c+v),e[6]=d+p,e[7]=0,e[8]=f+E,e[9]=d-p,e[10]=1-(c+m),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Wl(e,t){var r=new G(3),n=-t[0],i=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=n*n+i*i+s*s+a*a;return u>0?(r[0]=(o*a+c*n+l*s-h*i)*2/u,r[1]=(l*a+c*i+h*n-o*s)*2/u,r[2]=(h*a+c*s+o*i-l*n)*2/u):(r[0]=(o*a+c*n+l*s-h*i)*2,r[1]=(l*a+c*i+h*n-o*s)*2,r[2]=(h*a+c*s+o*i-l*n)*2),pi(e,t,r),e}function Xl(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function di(e,t){var r=t[0],n=t[1],i=t[2],s=t[4],a=t[5],o=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(l,h,c),e}function ql(e,t){var r=new G(3);di(r,t);var n=1/r[0],i=1/r[1],s=1/r[2],a=t[0]*n,o=t[1]*i,l=t[2]*s,h=t[4]*n,c=t[5]*i,u=t[6]*s,f=t[8]*n,m=t[9]*i,d=t[10]*s,v=a+c+d,p=0;return v>0?(p=Math.sqrt(v+1)*2,e[3]=.25*p,e[0]=(u-m)/p,e[1]=(f-l)/p,e[2]=(o-h)/p):a>c&&a>d?(p=Math.sqrt(1+a-c-d)*2,e[3]=(u-m)/p,e[0]=.25*p,e[1]=(o+h)/p,e[2]=(f+l)/p):c>d?(p=Math.sqrt(1+c-a-d)*2,e[3]=(f-l)/p,e[0]=(o+h)/p,e[1]=.25*p,e[2]=(u+m)/p):(p=Math.sqrt(1+d-a-c)*2,e[3]=(o-h)/p,e[0]=(f+l)/p,e[1]=(u+m)/p,e[2]=.25*p),e}function Ql(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=t[3],l=i+i,h=s+s,c=a+a,u=i*l,f=i*h,m=i*c,d=s*h,v=s*c,p=a*c,E=o*l,L=o*h,T=o*c,b=n[0],S=n[1],M=n[2];return e[0]=(1-(d+p))*b,e[1]=(f+T)*b,e[2]=(m-L)*b,e[3]=0,e[4]=(f-T)*S,e[5]=(1-(u+p))*S,e[6]=(v+E)*S,e[7]=0,e[8]=(m+L)*M,e[9]=(v-E)*M,e[10]=(1-(u+d))*M,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Zl(e,t,r,n,i){var s=t[0],a=t[1],o=t[2],l=t[3],h=s+s,c=a+a,u=o+o,f=s*h,m=s*c,d=s*u,v=a*c,p=a*u,E=o*u,L=l*h,T=l*c,b=l*u,S=n[0],M=n[1],O=n[2],A=i[0],w=i[1],D=i[2],x=(1-(v+E))*S,P=(m+b)*S,y=(d-T)*S,N=(m-b)*M,g=(1-(f+E))*M,_=(p+L)*M,$=(d+T)*O,H=(p-L)*O,Z=(1-(f+v))*O;return e[0]=x,e[1]=P,e[2]=y,e[3]=0,e[4]=N,e[5]=g,e[6]=_,e[7]=0,e[8]=$,e[9]=H,e[10]=Z,e[11]=0,e[12]=r[0]+A-(x*A+N*w+$*D),e[13]=r[1]+w-(P*A+g*w+H*D),e[14]=r[2]+D-(y*A+_*w+Z*D),e[15]=1,e}function Jl(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r+r,o=n+n,l=i+i,h=r*a,c=n*a,u=n*o,f=i*a,m=i*o,d=i*l,v=s*a,p=s*o,E=s*l;return e[0]=1-u-d,e[1]=c+E,e[2]=f-p,e[3]=0,e[4]=c-E,e[5]=1-h-d,e[6]=m+v,e[7]=0,e[8]=f+p,e[9]=m-v,e[10]=1-h-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function eh(e,t,r,n,i,s,a){var o=1/(r-t),l=1/(i-n),h=1/(s-a);return e[0]=s*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(i+n)*l,e[10]=(a+s)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*h,e[15]=0,e}function mi(e,t,r,n,i){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var th=mi;function rh(e,t,r,n,i){var s=1/Math.tan(t/2),a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(a=1/(n-i),e[10]=i*a,e[14]=i*n*a):(e[10]=-1,e[14]=-n),e}function nh(e,t,r,n){var i=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),h=2/(i+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((a-o)*l*.5),e[9]=(i-s)*h*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function vi(e,t,r,n,i,s,a){var o=1/(t-r),l=1/(n-i),h=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*l,e[14]=(a+s)*h,e[15]=1,e}var ih=vi;function sh(e,t,r,n,i,s,a){var o=1/(t-r),l=1/(n-i),h=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(t+r)*o,e[13]=(i+n)*l,e[14]=s*h,e[15]=1,e}function ah(e,t,r,n){var i,s,a,o,l,h,c,u,f,m,d=t[0],v=t[1],p=t[2],E=n[0],L=n[1],T=n[2],b=r[0],S=r[1],M=r[2];return Math.abs(d-b)<z&&Math.abs(v-S)<z&&Math.abs(p-M)<z?ui(e):(c=d-b,u=v-S,f=p-M,m=1/Math.hypot(c,u,f),c*=m,u*=m,f*=m,i=L*f-T*u,s=T*c-E*f,a=E*u-L*c,m=Math.hypot(i,s,a),m?(m=1/m,i*=m,s*=m,a*=m):(i=0,s=0,a=0),o=u*a-f*s,l=f*i-c*a,h=c*s-u*i,m=Math.hypot(o,l,h),m?(m=1/m,o*=m,l*=m,h*=m):(o=0,l=0,h=0),e[0]=i,e[1]=o,e[2]=c,e[3]=0,e[4]=s,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=f,e[11]=0,e[12]=-(i*d+s*v+a*p),e[13]=-(o*d+l*v+h*p),e[14]=-(c*d+u*v+f*p),e[15]=1,e)}function oh(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=n[0],l=n[1],h=n[2],c=i-r[0],u=s-r[1],f=a-r[2],m=c*c+u*u+f*f;m>0&&(m=1/Math.sqrt(m),c*=m,u*=m,f*=m);var d=l*f-h*u,v=h*c-o*f,p=o*u-l*c;return m=d*d+v*v+p*p,m>0&&(m=1/Math.sqrt(m),d*=m,v*=m,p*=m),e[0]=d,e[1]=v,e[2]=p,e[3]=0,e[4]=u*p-f*v,e[5]=f*d-c*p,e[6]=c*v-u*d,e[7]=0,e[8]=c,e[9]=u,e[10]=f,e[11]=0,e[12]=i,e[13]=s,e[14]=a,e[15]=1,e}function lh(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function hh(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ch(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function xi(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function uh(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function fh(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function ph(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function dh(e,t){var r=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],f=e[10],m=e[11],d=e[12],v=e[13],p=e[14],E=e[15],L=t[0],T=t[1],b=t[2],S=t[3],M=t[4],O=t[5],A=t[6],w=t[7],D=t[8],x=t[9],P=t[10],y=t[11],N=t[12],g=t[13],_=t[14],$=t[15];return Math.abs(r-L)<=z*Math.max(1,Math.abs(r),Math.abs(L))&&Math.abs(n-T)<=z*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(i-b)<=z*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(s-S)<=z*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(a-M)<=z*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-O)<=z*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(l-A)<=z*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(h-w)<=z*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(c-D)<=z*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(u-x)<=z*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(f-P)<=z*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-y)<=z*Math.max(1,Math.abs(m),Math.abs(y))&&Math.abs(d-N)<=z*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(v-g)<=z*Math.max(1,Math.abs(v),Math.abs(g))&&Math.abs(p-_)<=z*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(E-$)<=z*Math.max(1,Math.abs(E),Math.abs($))}var mh=fi,vh=xi;var ee={};De(ee,{add:()=>Fc,calculateW:()=>bc,clone:()=>Nc,conjugate:()=>Ic,copy:()=>Pc,create:()=>Dr,dot:()=>Fi,equals:()=>Vc,exactEquals:()=>Yc,exp:()=>Ni,fromEuler:()=>Cc,fromMat3:()=>Pi,fromValues:()=>Bc,getAngle:()=>Ac,getAxisAngle:()=>Ec,identity:()=>yc,invert:()=>Lc,len:()=>zc,length:()=>Ui,lerp:()=>kc,ln:()=>Bi,mul:()=>Uc,multiply:()=>Oi,normalize:()=>Fr,pow:()=>Sc,random:()=>Rc,rotateX:()=>wc,rotateY:()=>Tc,rotateZ:()=>Mc,rotationTo:()=>Gc,scale:()=>Di,set:()=>Dc,setAxes:()=>jc,setAxisAngle:()=>Ci,slerp:()=>Mt,sqlerp:()=>Kc,sqrLen:()=>Hc,squaredLength:()=>ki,str:()=>Oc});var Y={};De(Y,{add:()=>yh,angle:()=>zh,bezier:()=>Oh,ceil:()=>Eh,clone:()=>xh,copy:()=>gh,create:()=>yt,cross:()=>Je,dist:()=>Wh,distance:()=>Ai,div:()=>$h,divide:()=>Ei,dot:()=>At,equals:()=>Gh,exactEquals:()=>Vh,floor:()=>Ah,forEach:()=>Qh,fromValues:()=>Et,hermite:()=>Ch,inverse:()=>Lh,len:()=>Tr,length:()=>gi,lerp:()=>Ih,max:()=>Th,min:()=>wh,mul:()=>jh,multiply:()=>yi,negate:()=>Rh,normalize:()=>wr,random:()=>Nh,rotateX:()=>Fh,rotateY:()=>Uh,rotateZ:()=>kh,round:()=>Mh,scale:()=>bh,scaleAndAdd:()=>Sh,set:()=>_h,sqrDist:()=>Xh,sqrLen:()=>qh,squaredDistance:()=>wi,squaredLength:()=>Ti,str:()=>Yh,sub:()=>Kh,subtract:()=>_i,transformMat3:()=>Ph,transformMat4:()=>Bh,transformQuat:()=>Dh,zero:()=>Hh});function yt(){var e=new G(3);return G!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function xh(e){var t=new G(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function gi(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function Et(e,t,r){var n=new G(3);return n[0]=e,n[1]=t,n[2]=r,n}function gh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _h(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function yh(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function _i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function yi(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ei(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Eh(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ah(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function wh(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Th(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Mh(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function bh(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Sh(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Ai(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function wi(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function Ti(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function Rh(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Lh(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function wr(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function At(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Je(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=i*l-s*o,e[1]=s*a-n*l,e[2]=n*o-i*a,e}function Ih(e,t,r,n){var i=t[0],s=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=a+n*(r[2]-a),e}function Ch(e,t,r,n,i,s){var a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,h=a*(s-1),c=a*(3-2*s);return e[0]=t[0]*o+r[0]*l+n[0]*h+i[0]*c,e[1]=t[1]*o+r[1]*l+n[1]*h+i[1]*c,e[2]=t[2]*o+r[2]*l+n[2]*h+i[2]*c,e}function Oh(e,t,r,n,i,s){var a=1-s,o=a*a,l=s*s,h=o*a,c=3*s*o,u=3*l*a,f=l*s;return e[0]=t[0]*h+r[0]*c+n[0]*u+i[0]*f,e[1]=t[1]*h+r[1]*c+n[1]*u+i[1]*f,e[2]=t[2]*h+r[2]*c+n[2]*u+i[2]*f,e}function Nh(e,t){t=t||1;var r=le()*2*Math.PI,n=le()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function Bh(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[3]*n+r[7]*i+r[11]*s+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/a,e}function Ph(e,t,r){var n=t[0],i=t[1],s=t[2];return e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8],e}function Dh(e,t,r){var n=r[0],i=r[1],s=r[2],a=r[3],o=t[0],l=t[1],h=t[2],c=i*h-s*l,u=s*o-n*h,f=n*l-i*o,m=i*f-s*u,d=s*c-n*f,v=n*u-i*c,p=a*2;return c*=p,u*=p,f*=p,m*=2,d*=2,v*=2,e[0]=o+c+m,e[1]=l+u+d,e[2]=h+f+v,e}function Fh(e,t,r,n){var i=[],s=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Uh(e,t,r,n){var i=[],s=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function kh(e,t,r,n){var i=[],s=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function zh(e,t){var r=e[0],n=e[1],i=e[2],s=t[0],a=t[1],o=t[2],l=Math.sqrt(r*r+n*n+i*i),h=Math.sqrt(s*s+a*a+o*o),c=l*h,u=c&&At(e,t)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function Hh(e){return e[0]=0,e[1]=0,e[2]=0,e}function Yh(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Vh(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Gh(e,t){var r=e[0],n=e[1],i=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=z*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=z*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=z*Math.max(1,Math.abs(i),Math.abs(o))}var Kh=_i,jh=yi,$h=Ei,Wh=Ai,Xh=wi,Tr=gi,qh=Ti,Qh=function(){var e=yt();return function(t,r,n,i,s,a){var o,l;for(r||(r=3),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();var Ee={};De(Ee,{add:()=>Lr,ceil:()=>Zh,clone:()=>Mr,copy:()=>Sr,create:()=>Mi,cross:()=>ac,dist:()=>mc,distance:()=>Li,div:()=>dc,divide:()=>Ri,dot:()=>Or,equals:()=>Pr,exactEquals:()=>Br,floor:()=>Jh,forEach:()=>_c,fromValues:()=>br,inverse:()=>sc,len:()=>xc,length:()=>wt,lerp:()=>Nr,max:()=>tc,min:()=>ec,mul:()=>pc,multiply:()=>Si,negate:()=>ic,normalize:()=>Cr,random:()=>oc,round:()=>rc,scale:()=>Ir,scaleAndAdd:()=>nc,set:()=>Rr,sqrDist:()=>vc,sqrLen:()=>gc,squaredDistance:()=>Ii,squaredLength:()=>Tt,str:()=>uc,sub:()=>fc,subtract:()=>bi,transformMat4:()=>lc,transformQuat:()=>hc,zero:()=>cc});function Mi(){var e=new G(4);return G!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Mr(e){var t=new G(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function br(e,t,r,n){var i=new G(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function Sr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Rr(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function Lr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function bi(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Si(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Ri(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Zh(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Jh(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ec(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function tc(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function rc(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Ir(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function nc(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Li(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,n,i,s)}function Ii(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return r*r+n*n+i*i+s*s}function wt(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function Tt(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function ic(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function sc(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Cr(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r*r+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=s*a,e}function Or(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ac(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],h=r[2]*n[3]-r[3]*n[2],c=t[0],u=t[1],f=t[2],m=t[3];return e[0]=u*h-f*l+m*o,e[1]=-(c*h)+f*a-m*s,e[2]=c*l-u*a+m*i,e[3]=-(c*o)+u*s-f*i,e}function Nr(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=t[3];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=a+n*(r[2]-a),e[3]=o+n*(r[3]-o),e}function oc(e,t){t=t||1;var r,n,i,s,a,o;do r=le()*2-1,n=le()*2-1,a=r*r+n*n;while(a>=1);do i=le()*2-1,s=le()*2-1,o=i*i+s*s;while(o>=1);var l=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*n,e[2]=t*i*l,e[3]=t*s*l,e}function lc(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*a,e}function hc(e,t,r){var n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],l=r[2],h=r[3],c=h*n+o*s-l*i,u=h*i+l*n-a*s,f=h*s+a*i-o*n,m=-a*n-o*i-l*s;return e[0]=c*h+m*-a+u*-l-f*-o,e[1]=u*h+m*-o+f*-a-c*-l,e[2]=f*h+m*-l+c*-o-u*-a,e[3]=t[3],e}function cc(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function uc(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Br(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Pr(e,t){var r=e[0],n=e[1],i=e[2],s=e[3],a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(r-a)<=z*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=z*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=z*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-h)<=z*Math.max(1,Math.abs(s),Math.abs(h))}var fc=bi,pc=Si,dc=Ri,mc=Li,vc=Ii,xc=wt,gc=Tt,_c=function(){var e=Mi();return function(t,r,n,i,s,a){var o,l;for(r||(r=4),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function Dr(){var e=new G(4);return G!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function yc(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ci(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Ec(e,t){var r=Math.acos(t[3])*2,n=Math.sin(r/2);return n>z?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function Ac(e,t){var r=Fi(e,t);return Math.acos(2*r*r-1)}function Oi(e,t,r){var n=t[0],i=t[1],s=t[2],a=t[3],o=r[0],l=r[1],h=r[2],c=r[3];return e[0]=n*c+a*o+i*h-s*l,e[1]=i*c+a*l+s*o-n*h,e[2]=s*c+a*h+n*l-i*o,e[3]=a*c-n*o-i*l-s*h,e}function wc(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*o,e[1]=i*l+s*o,e[2]=s*l-i*o,e[3]=a*l-n*o,e}function Tc(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l-s*o,e[1]=i*l+a*o,e[2]=s*l+n*o,e[3]=a*l-i*o,e}function Mc(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*o,e[1]=i*l-n*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e}function bc(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e}function Ni(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=Math.sqrt(r*r+n*n+i*i),o=Math.exp(s),l=a>0?o*Math.sin(a)/a:0;return e[0]=r*l,e[1]=n*l,e[2]=i*l,e[3]=o*Math.cos(a),e}function Bi(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=Math.sqrt(r*r+n*n+i*i),o=a>0?Math.atan2(a,s)/a:0;return e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=.5*Math.log(r*r+n*n+i*i+s*s),e}function Sc(e,t,r){return Bi(e,t),Di(e,e,r),Ni(e,e),e}function Mt(e,t,r,n){var i=t[0],s=t[1],a=t[2],o=t[3],l=r[0],h=r[1],c=r[2],u=r[3],f,m,d,v,p;return m=i*l+s*h+a*c+o*u,m<0&&(m=-m,l=-l,h=-h,c=-c,u=-u),1-m>z?(f=Math.acos(m),d=Math.sin(f),v=Math.sin((1-n)*f)/d,p=Math.sin(n*f)/d):(v=1-n,p=n),e[0]=v*i+p*l,e[1]=v*s+p*h,e[2]=v*a+p*c,e[3]=v*o+p*u,e}function Rc(e){var t=le(),r=le(),n=le(),i=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*n),e[3]=s*Math.cos(2*Math.PI*n),e}function Lc(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],a=r*r+n*n+i*i+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-n*o,e[2]=-i*o,e[3]=s*o,e}function Ic(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Pi(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[s*3+s]-t[a*3+a]+1),e[i]=.5*n,n=.5/n,e[3]=(t[s*3+a]-t[a*3+s])*n,e[s]=(t[s*3+i]+t[i*3+s])*n,e[a]=(t[a*3+i]+t[i*3+a])*n}return e}function Cc(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var s=Math.sin(t),a=Math.cos(t),o=Math.sin(r),l=Math.cos(r),h=Math.sin(n),c=Math.cos(n);return e[0]=s*l*c-a*o*h,e[1]=a*o*c+s*l*h,e[2]=a*l*h-s*o*c,e[3]=a*l*c+s*o*h,e}function Oc(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Nc=Mr,Bc=br,Pc=Sr,Dc=Rr,Fc=Lr,Uc=Oi,Di=Ir,Fi=Or,kc=Nr,Ui=wt,zc=Ui,ki=Tt,Hc=ki,Fr=Cr,Yc=Br,Vc=Pr,Gc=function(){var e=yt(),t=Et(1,0,0),r=Et(0,1,0);return function(n,i,s){var a=At(i,s);return a<-.999999?(Je(e,t,i),Tr(e)<1e-6&&Je(e,r,i),wr(e,e),Ci(n,e,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Je(e,i,s),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+a,Fr(n,n))}}(),Kc=function(){var e=Dr(),t=Dr();return function(r,n,i,s,a,o){return Mt(e,n,a,o),Mt(t,i,s,o),Mt(r,e,t,2*o*(1-o)),r}}(),jc=function(){var e=ci();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Fr(t,Pi(t,e))}}();var Ye={};De(Ye,{add:()=>Qc,angle:()=>xu,ceil:()=>Zc,clone:()=>$c,copy:()=>Xc,create:()=>zi,cross:()=>hu,dist:()=>bu,distance:()=>Gi,div:()=>Mu,divide:()=>Vi,dot:()=>lu,equals:()=>Eu,exactEquals:()=>yu,floor:()=>Jc,forEach:()=>Lu,fromValues:()=>Wc,inverse:()=>au,len:()=>Au,length:()=>ji,lerp:()=>cu,max:()=>tu,min:()=>eu,mul:()=>Tu,multiply:()=>Yi,negate:()=>su,normalize:()=>ou,random:()=>uu,rotate:()=>vu,round:()=>ru,scale:()=>nu,scaleAndAdd:()=>iu,set:()=>qc,sqrDist:()=>Su,sqrLen:()=>Ru,squaredDistance:()=>Ki,squaredLength:()=>$i,str:()=>_u,sub:()=>wu,subtract:()=>Hi,transformMat2:()=>fu,transformMat2d:()=>pu,transformMat3:()=>du,transformMat4:()=>mu,zero:()=>gu});function zi(){var e=new G(2);return G!=Float32Array&&(e[0]=0,e[1]=0),e}function $c(e){var t=new G(2);return t[0]=e[0],t[1]=e[1],t}function Wc(e,t){var r=new G(2);return r[0]=e,r[1]=t,r}function Xc(e,t){return e[0]=t[0],e[1]=t[1],e}function qc(e,t,r){return e[0]=t,e[1]=r,e}function Qc(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Hi(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Yi(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function Vi(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Zc(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Jc(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function eu(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function tu(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function ru(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function nu(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function iu(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function Gi(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function Ki(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function ji(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function $i(e){var t=e[0],r=e[1];return t*t+r*r}function su(e,t){return e[0]=-t[0],e[1]=-t[1],e}function au(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function ou(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function lu(e,t){return e[0]*t[0]+e[1]*t[1]}function hu(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function cu(e,t,r,n){var i=t[0],s=t[1];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e}function uu(e,t){t=t||1;var r=le()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function fu(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function pu(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function du(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function mu(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}function vu(e,t,r,n){var i=t[0]-r[0],s=t[1]-r[1],a=Math.sin(n),o=Math.cos(n);return e[0]=i*o-s*a+r[0],e[1]=i*a+s*o+r[1],e}function xu(e,t){var r=e[0],n=e[1],i=t[0],s=t[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+s*s),o=a&&(r*i+n*s)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function gu(e){return e[0]=0,e[1]=0,e}function _u(e){return"vec2("+e[0]+", "+e[1]+")"}function yu(e,t){return e[0]===t[0]&&e[1]===t[1]}function Eu(e,t){var r=e[0],n=e[1],i=t[0],s=t[1];return Math.abs(r-i)<=z*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=z*Math.max(1,Math.abs(n),Math.abs(s))}var Au=ji,wu=Hi,Tu=Yi,Mu=Vi,bu=Gi,Su=Ki,Ru=$i,Lu=function(){var e=zi();return function(t,r,n,i,s,a){var o,l;for(r||(r=2),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],s(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}}();var kd=Y.fromValues(0,1,0);var Wi=class{constructor(t,r){this.projectionMatrix=t,this.viewMatrix=r}resize(t=void 0,r=void 0){return this}},zd=Math.PI/3;var et=class extends Wi{constructor(t=void 0,r=void 0,n=void 0,i=void 0,s=-1e3,a=1e3){super(V.create(),V.create());this.orthoBounds={left:typeof t=="undefined"?void 0:Number(t),top:typeof r=="undefined"?void 0:Number(r),right:typeof n=="undefined"?void 0:Number(n),bottom:typeof i=="undefined"?void 0:Number(i)},this.clippingPlane={near:Number(s),far:Number(a)}}resize(t=void 0,r=void 0){let{near:n,far:i}=this.clippingPlane,{left:s,top:a,right:o,bottom:l}=this.orthoBounds,h=this.projectionMatrix,c=typeof t!="undefined",u=typeof s!="undefined";if(c)if(u){let f=t/r;V.ortho(h,s*f,o*f,l,a,n,i)}else V.ortho(h,0,t,r,0,n,i);else u?V.ortho(h,s,o,l,a,n,i):V.ortho(h,-1,1,1,-1,-1,1);return this}},Hd=Math.PI/180;function de(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext}var Ur=class{constructor(t,r){this.gl=t,this.target=r}data(t,r=void 0){let n=this.gl,i=this.target;if(typeof t=="number")n.bufferData(i,t,r||n.STATIC_DRAW);else{if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");n.bufferData(i,t,r||n.STATIC_DRAW)}return this}subData(t,r=0,n=void 0,i=void 0){let s=this.gl,a=this.target;if(ArrayBuffer.isView(t))if(typeof n!="undefined")if(de(s))s.bufferSubData(a,r,t,n,i);else{let o=i?t.subarray(n,n+i):t.subarray(n);s.bufferSubData(a,r,o)}else s.bufferSubData(a,r,t);else throw new Error("Source data must be a typed array.");return this}},Xi=class{constructor(t,r,n=void 0){this.dataContext=new Ur(t,r),this.handle=n||t.createBuffer(),t.bindBuffer(r,this.handle)}get gl(){return this.dataContext.gl}get target(){return this.dataContext.target}data(t,r=void 0){return this.dataContext.data(t,r),this}subData(t,r=0,n=void 0,i=void 0){return this.dataContext.subData(t,r,n,i),this}build(){return this.handle}},qi=class{constructor(t,r,n,i){this.gl=t,this.target=r,this.handle=i,this.type=n,this.bindContext=new Ur(t,this.target)}bind(t){return t.bindBuffer(this.target,this.handle),this.bindContext.gl=t,this.bindContext}},Le={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131};function Iu(e,t){let r=[],n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){let s=e.getActiveUniform(t,i);if(!s)break;r.push(s)}return r}function Cu(e,t){let r=[],n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;++i){let s=e.getActiveAttrib(t,i);!s||r.push(s)}return r}function bt(e,t){switch(t){case e.FLOAT:case e.INT:case e.UNSIGNED_INT:case e.BOOL:return 1;case e.FLOAT_VEC2:case e.INT_VEC2:case e.BOOL_VEC2:return 2;case e.FLOAT_VEC3:case e.INT_VEC3:case e.BOOL_VEC3:return 3;case e.FLOAT_VEC4:case e.INT_VEC4:case e.BOOL_VEC4:return 4;case e.FLOAT_MAT2:return 4;case e.FLOAT_MAT3:return 9;case e.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function Ou(e,t){switch(t){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:return Nu}if(de(e)){let r=e;switch(t){case e.INT:case e.INT_VEC2:case e.INT_VEC3:case e.INT_VEC4:case e.BOOL:case e.BOOL_VEC2:case e.BOOL_VEC3:case e.BOOL_VEC4:return Bu;case e.FLOAT_MAT2:return Du;case e.FLOAT_MAT3:return Fu;case e.FLOAT_MAT4:return Uu;case r.UNSIGNED_INT:case r.UNSIGNED_INT_VEC2:case r.UNSIGNED_INT_VEC3:case r.UNSIGNED_INT_VEC4:return Pu}}throw new Error("Cannot find attribute function for gl enum.")}function Nu(e,t,r,n,i=!1,s=0,a=0,o=void 0){if(this.bindBuffer(this.ARRAY_BUFFER,t),this.enableVertexAttribArray(e),this.vertexAttribPointer(e,r,n,i,s,a),o!==void 0){if(!de(this))throw new Error("Cannot use attribute divisor in WebGL 1.");this.vertexAttribDivisor(e,o)}}function Bu(e,t,r,n,i=!1,s=0,a=0,o=void 0){if(!de(this))throw new Error("Cannot use attribute divisor in WebGL 1.");let l=this;l.bindBuffer(l.ARRAY_BUFFER,t),l.enableVertexAttribArray(e),l.vertexAttribIPointer(e,r,n,s,a),o!==void 0&&l.vertexAttribDivisor(e,o)}function Pu(e,t,r,n,i=!1,s=0,a=0,o=void 0){if(!de(this))throw new Error("Cannot use attribute divisor in WebGL 1.");let l=this;l.bindBuffer(l.ARRAY_BUFFER,t),l.enableVertexAttribArray(e),l.vertexAttribIPointer(e,r,n,s,a),o!==void 0&&l.vertexAttribDivisor(e,o)}function Du(e,t,r,n,i=!1,s=0,a=0,o=void 0){let l=bt(this,this.FLOAT_MAT2),h=l*l;kr(h,l,e,t,r,n,i,s,a,o)}function Fu(e,t,r,n,i=!1,s=0,a=0,o=void 0){let l=bt(this,this.FLOAT_MAT3),h=l*l;kr(h,l,e,t,r,n,i,s,a,o)}function Uu(e,t,r,n,i=!1,s=0,a=0,o=void 0){let l=bt(this,this.FLOAT_MAT4),h=l*l;kr(h,l,e,t,r,n,i,s,a,o)}function kr(e,t,r,n,i,s,a,o,l,h){if(!de(this))throw new Error("Cannot use attribute divisor in WebGL 1.");let c=this;c.bindBuffer(c.ARRAY_BUFFER,n);let u=i/t,f=e*i,m=o/t;for(let d=0;d<t;++d){let v=r+d;c.enableVertexAttribArray(v),c.vertexAttribPointer(v,u,s,a,f,l+m*d),h!==void 0&&c.vertexAttribDivisor(v,h)}}function ku(e,t){let r={},n=Cu(e,t);for(let i of n){let s=i.name,a=i.size,o=i.type,l=e.getAttribLocation(t,s),h=Ou(e,o),c=bt(e,o);r[s]={type:o,length:a,location:l,size:c,applier:h,set value([u,f,m,d,v,p,E]){this.applier(this.location,u,f,m,d,v,p,E)}}}return r}function zu(e,t,r){let n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){let s=e.getShaderInfoLog(n)+`
Failed to compile shader:
${r}`;throw e.deleteShader(n),new Error(s)}return n}async function Hu(e,t,r){for(let s of r)e.attachShader(t,s);e.linkProgram(t);let n=e.getExtension("KHR_parallel_shader_compile");if(n){let s=1e3/60,a;do await new Promise((o,l)=>setTimeout(o,s)),a=e.getProgramParameter(t,n.COMPLETION_STATUS_KHR);while(!a)}for(let s of r)e.detachShader(t,s),e.deleteShader(s);if(!e.getProgramParameter(t,e.LINK_STATUS)){let s=e.getProgramInfoLog(t);throw e.deleteProgram(t),new Error(s)}return t}function Yu(e,t,r,n,i=void 0){i?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.drawElements(t,n,e.UNSIGNED_SHORT,r)):e.drawArrays(t,r,n)}function Vu(e,t){let r=e;switch(t){case r.FLOAT:return r.uniform1f;case r.FLOAT_VEC2:return r.uniform2fv;case r.FLOAT_VEC3:return r.uniform3fv;case r.FLOAT_VEC4:return r.uniform4fv;case r.INT:return r.uniform1i;case r.INT_VEC2:return r.uniform2iv;case r.INT_VEC3:return r.uniform3iv;case r.INT_VEC4:return r.uniform4iv;case r.BOOL:return r.uniform1i;case r.BOOL_VEC2:return r.uniform2iv;case r.BOOL_VEC3:return r.uniform3iv;case r.BOOL_VEC4:return r.uniform4iv;case r.FLOAT_MAT2:return Gu;case r.FLOAT_MAT3:return Ku;case r.FLOAT_MAT4:return ju;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1i}if(de(e)){let n=e;switch(t){case n.UNSIGNED_INT:return n.uniform1ui;case n.UNSIGNED_INT_VEC2:return n.uniform2uiv;case n.UNSIGNED_INT_VEC3:return n.uniform3uiv;case n.UNSIGNED_INT_VEC4:return n.uniform4uiv;case n.FLOAT_MAT2x3:return $u;case n.FLOAT_MAT2x4:return Wu;case n.FLOAT_MAT3x2:return Xu;case n.FLOAT_MAT3x4:return qu;case n.FLOAT_MAT4x2:return Qu;case n.FLOAT_MAT4x3:return Zu;case n.SAMPLER_3D:case n.SAMPLER_2D_SHADOW:case n.SAMPLER_2D_ARRAY:case n.SAMPLER_2D_ARRAY_SHADOW:case n.SAMPLER_CUBE_SHADOW:case n.INT_SAMPLER_2D:case n.INT_SAMPLER_3D:case n.INT_SAMPLER_CUBE:case n.INT_SAMPLER_2D_ARRAY:case n.UNSIGNED_INT_SAMPLER_2D:case n.UNSIGNED_INT_SAMPLER_3D:case n.UNSIGNED_INT_SAMPLER_CUBE:case n.UNSIGNED_INT_SAMPLER_2D_ARRAY:return n.uniform1i}}throw new Error("Cannot find uniform function for gl enum.")}function Gu(e,t){this.uniformMatrix2fv(e,!1,t)}function Ku(e,t){this.uniformMatrix3fv(e,!1,t)}function ju(e,t){this.uniformMatrix4fv(e,!1,t)}function $u(e,t){this.uniformMatrix2x3fv(e,!1,t)}function Wu(e,t){this.uniformMatrix2x4fv(e,!1,t)}function Xu(e,t){this.uniformMatrix3x2fv(e,!1,t)}function qu(e,t){this.uniformMatrix3x4fv(e,!1,t)}function Qu(e,t){this.uniformMatrix4x2fv(e,!1,t)}function Zu(e,t){this.uniformMatrix4x3fv(e,!1,t)}function Ju(e,t){let r={},n=Iu(e,t);for(let i of n){let s=i.name,a=i.size,o=i.type,l=e.getUniformLocation(t,s),h=Vu(e,o);r[s]={type:o,length:a,location:l,applier:h,set value(c){this.applier.call(e,this.location,c)}}}return r}function ef(e,t,r){if("handle"in r&&r.handle instanceof WebGLVertexArrayObject){if(!de(e))throw new Error("Vertex array objects are only supported in WebGL 2.");let n=e,i=r;n.bindVertexArray(i.handle)}else{let n=r,i=t.attributes;for(let s in i){if(!(s in n.attributes))throw new Error(`Missing buffer for attribute '${s}'.`);let a=n.attributes[s],{location:o,applier:l}=i[a.name];l.call(e,o,a.buffer,a.size,a.type,a.normalize,a.stride,a.offset,a.divisor)}n.element&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.element.buffer)}}function tf(e,t,r=void 0){let n=af(e,t),i=sf(e,r),s;if(i)s=i.length;else{let a=Object.keys(n);if(a.length>0){let o=n[a[0]];s=Math.trunc(o.length/o.size)}else s=0}return{attributes:n,element:i,vertexCount:s}}function rf(e,t,r){if(!de(e))throw new Error("Vertex array objects is only supported on WebGL2.");let n=e,i=n.createVertexArray();n.bindVertexArray(i);for(let s of r)ef(n,s,t);return n.bindVertexArray(null),{handle:i,element:t.element,vertexCount:t.vertexCount}}function nf(e,t,r=e.TRIANGLES,n=0,i=t.vertexCount,s=void 0){let a=t.element;if(a){let o=a.type;if(s!==void 0){if(!de(e))throw new Error("Instanced element drawing is only supported on WebGL2.");e.drawElementsInstanced(r,i,o,n,s)}else e.drawElements(r,i,o,n)}else if(s!==void 0){if(!de(e))throw new Error("Instanced array drawing is only supported on WebGL2.");e.drawArraysInstanced(r,n,i,s)}else e.drawArrays(r,n,i)}function sf(e,t=void 0){if(!t)return null;if(typeof t!="object")throw new Error("Element attribute options must be an object.");let{type:r=e.UNSIGNED_SHORT,buffer:n,usage:i=e.STATIC_DRAW,length:s}=t;if(n instanceof WebGLBuffer)e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n);else if(ArrayBuffer.isView(n)){let a=n;n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a,i),r===void 0&&(r=tt(e,a)),s===void 0&&(s=a.length)}else if(Array.isArray(n)){let a=n;n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),i),s===void 0&&(s=a.length)}else if(typeof n=="number"){let a=n;n=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,a,i),s===void 0&&(s=a)}else throw new Error("Invalid buffer for element attribute options.");if(r===void 0&&(r=e.UNSIGNED_SHORT),s===void 0){let a=e.getBufferParameter(e.ELEMENT_ARRAY_BUFFER,e.BUFFER_SIZE);s=Math.trunc(a/St(e,r))}return lf(n,r,s)}function af(e,t){let r={};for(let n of Object.keys(t)){let i=t[n];if(!i)continue;if(typeof i!="object")throw new Error("Array attribute options must be an object.");let{name:s=n,buffer:a,size:o=3,type:l,normalize:h=!1,stride:c=0,offset:u=0,divisor:f=void 0,usage:m=e.STATIC_DRAW,length:d}=i;if(a instanceof WebGLBuffer)e.bindBuffer(e.ARRAY_BUFFER,a);else if(ArrayBuffer.isView(a)){let v=a;a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,v,m),l===void 0&&(l=tt(e,v)),d===void 0&&(d=v.length)}else if(Array.isArray(a)){let v=a;l===void 0&&(l=e.FLOAT),d===void 0&&(d=v.length),a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a);let p=zr(e,l);e.bufferData(e.ARRAY_BUFFER,new p(v),m)}else if(typeof a=="number"){let v=a;a=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,v,m),d===void 0&&(d=v)}else throw new Error(`Invalid buffer '${a}' for array attribute options.`);if(l===void 0&&(l=e.FLOAT),d===void 0){let v=e.getBufferParameter(e.ARRAY_BUFFER,e.BUFFER_SIZE);d=Math.trunc(v/St(e,l))}o===void 0&&(o=of(s,d)),r[s]=hf(s,a,d,o,l,h,c,u,f)}return r}function of(e,t){let r;if(e.includes("texcoord")?r=2:e.includes("color")?r=4:r=3,t%r!=0)throw new Error(`Could not determine vertex size - guessed ${r} but array length ${t} is not evenly divisible.`);return r}function lf(e,t,r){return{buffer:e,type:t,length:r}}function hf(e,t,r,n,i,s,a,o,l){return{name:e,buffer:t,length:r,size:n,type:i,normalize:s,stride:a,offset:o,divisor:l}}function cf(e,t,r){let n=zr(e,t);return new n(r)}function uf(e,t,r,n=e.STATIC_DRAW){if(!ArrayBuffer.isView(r))throw new Error("Source data must be a typed array.");let i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,r,n),i}function zr(e,t){switch(t){case e.BYTE:return Int8Array;case e.UNSIGNED_BYTE:return Uint8Array;case e.SHORT:return Int16Array;case e.UNSIGNED_SHORT:return Uint16Array;case e.INT:return Int32Array;case e.UNSIGNED_INT:return Uint32Array;case e.FLOAT:return Float32Array;default:throw new Error(`Cannot find valid typed array for buffer type '${t}'.`)}}function tt(e,t){if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int32Array)return e.INT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Float32Array)return e.FLOAT;throw new Error("Cannot find valid data type for buffer source.")}var ff={[Le.BYTE]:1,[Le.UNSIGNED_BYTE]:1,[Le.SHORT]:2,[Le.UNSIGNED_SHORT]:2,[Le.INT]:4,[Le.UNSIGNED_INT]:4,[Le.FLOAT]:4,[Le.HALF_FLOAT]:2};function St(e,t){return ff[t]}function pf(e,t){switch(t){case Int8Array:return e.BYTE;case Uint8Array:return e.UNSIGNED_BYTE;case Int16Array:return e.SHORT;case Uint16Array:return e.UNSIGNED_SHORT;case Int32Array:return e.INT;case Uint32Array:return e.UNSIGNED_INT;case Float32Array:return e.FLOAT;default:throw new Error("Cannot find valid buffer type for typed array.")}}function df(e,t,r){return e.bindBuffer(t,r),e.getBufferParameter(t,e.BUFFER_USAGE)}function Qi(e,t,r){return e.bindBuffer(t,r),e.getBufferParameter(t,e.BUFFER_SIZE)}function mf(e,t,r,n){return Math.trunc(Qi(e,t,r)/St(e,n))}var Ae=Object.freeze({__proto__:null,createBuffer:uf,createBufferInfo:tf,createBufferSource:cf,createVertexArrayInfo:rf,drawBufferInfo:nf,getBufferByteCount:Qi,getBufferLength:mf,getBufferTypeForBufferSource:tt,getBufferTypeForTypedArray:pf,getBufferUsage:df,getByteCountForBufferType:St,getTypedArrayForBufferType:zr}),me=class{constructor(t,r,n=void 0){this.bufferBuilder=new Xi(t,r,n),this.bufferType=t.FLOAT}get gl(){return this.bufferBuilder.gl}get handle(){return this.bufferBuilder.handle}get target(){return this.bufferBuilder.target}data(t,r=void 0){return this.bufferBuilder.data(t,r),typeof t!="number"&&(this.bufferType=tt(this.gl,t)),this}subData(t,r=void 0,n=void 0,i=void 0){return this.bufferBuilder.subData(t,r,n,i),this.bufferType=tt(this.gl,t),this}build(){let t=this.bufferBuilder.build(),r=this.gl,n=this.target,i=this.bufferType;return new qi(r,n,i,t)}},Zi=class{constructor(t,r){this.handle=r,this.activeUniforms=Ju(t,r),this.activeAttributes=ku(t,r),this.drawContext=new Ji(t,this)}bind(t){return t.useProgram(this.handle),this.drawContext.gl=t,this.drawContext}},Ji=class{constructor(t,r){this.gl=t,this.parent=r}uniform(t,r){let n=this.parent.activeUniforms;if(t in n){let i=n[t],s=i.location;i.applier.call(this.gl,s,r)}return this}attribute(t,r,n,i=!1,s=0,a=0){let o=this.gl,l=this.parent.activeAttributes;if(t in l){let h=l[t],c=h.location,u=h.size;n?(o.bindBuffer(o.ARRAY_BUFFER,n),o.vertexAttribPointer(c,u,r,i,s,a),o.enableVertexAttribArray(c)):o.disableVertexAttribArray(c)}return this}draw(t,r,n,i,s=null){return Yu(t,r,n,i,s),this.parent}},es=class{constructor(t,r=void 0){this.handle=r||t.createProgram(),this.shaders=[],this.gl=t}shader(t,r){let n=this.gl,i=zu(n,t,r);return this.shaders.push(i),this}link(){let t=this.gl;return Hu(t,this.handle,this.shaders),this.shaders.length=0,this.handle}},Me=class{constructor(t,r=void 0){this.programBuilder=new es(t,r)}get gl(){return this.programBuilder.gl}get handle(){return this.programBuilder.handle}get shaders(){return this.programBuilder.shaders}shader(t,r){return this.programBuilder.shader(t,r),this}link(){let t=this.programBuilder.link();return new Zi(this.gl,t)}};var se={red(e){return e>>16&255},redf(e){return(e>>16&255)/255},green(e){return e>>8&255},greenf(e){return(e>>8&255)/255},blue(e){return e&255},bluef(e){return(e&255)/255},alpha(e){return e>>24&255},alphaf(e){return(e>>24&255)/255},hexf(e,t,r,n=1){let i=Math.floor(Math.max(Math.min(e,1),0)*255),s=Math.floor(Math.max(Math.min(t,1),0)*255),a=Math.floor(Math.max(Math.min(r,1),0)*255);return(Math.floor(Math.max(Math.min(n,1),0)*255)&255)<<24|(i&255)<<16|(s&255)<<8|a&255},mix(e=0,t=16777215,r=.5){if(t<e){let u=e;e=t,t=u}let n=this.redf(e),i=this.greenf(e),s=this.bluef(e),a=this.alphaf(e),o=(this.redf(t)-n)*r+n,l=(this.greenf(t)-i)*r+i,h=(this.bluef(t)-s)*r+s,c=(this.alphaf(t)-a)*r+a;return c<.01&&(c=void 0),this.hexf(o,l,h,c)}};var ts=16,xf=(()=>{let e=[],t=ts,r=Math.PI*2/t,n=1,i=0,s,a;for(let o=0;o<=t;++o)s=Math.cos(o*r),a=Math.sin(o*r),e.push(0,0),e.push(n,i),e.push(s,a),n=s,i=a;return e})(),qd=Math.trunc(xf.length/2),gf=(()=>{let e=[],t=ts,r=Math.PI*2/t,n=1,i=0,s,a;for(let o=0;o<=t;++o)s=Math.cos(o*r),a=Math.sin(o*r),e.push(n,i),e.push(s,a),n=s,i=a;return e})(),Qd=Math.trunc(gf.length/2);var _f=16,Hr=16,i0=Hr/2,yf=_f*Hr,s0=1/yf;var Ef=.3,L0=1-Ef;var Yr=class{constructor(t,r=t.canvas,n=new et){this.gl=t,this.canvas=r,this.camera=n,this.projectionViewMatrix=V.create(),this.modelMatrix=V.create(),this.colorVector=Y.create(),this.depthFloat=0,this.opacityFloat=1,this.transformStack=[],this.transformMatrix=V.create(),this.translationVector=Y.create(),this.rotationQuat=ee.create(),this.scaleVector=Y.fromValues(1,1,1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)}reset(){this.resize(),this.clear(0,0,0,1),this.setColorVector(1,1,1),this.setDepthFloat(0),this.setOpacityFloat(1),this.resetTransform(),this.transformStack.length=0}resize(){let t=this.gl,r=t.canvas.width,n=t.canvas.height;t.viewport(0,0,r,n);let i=this.camera;i.resize(r,n);let s=this.projectionViewMatrix;V.mul(s,i.projectionMatrix,i.viewMatrix)}clear(t,r,n,i=1){let s=this.gl;s.clearColor(t,r,n,i),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)}setColorVector(t,r,n){return Y.set(this.colorVector,t,r,n),this}setColor(t){return this.setColorVector(se.redf(t),se.greenf(t),se.bluef(t))}setDepthFloat(t){return this.depthFloat=t,this}setOpacityFloat(t){return this.opacityFloat=t,this}setTranslation(t,r,n=0){return Y.set(this.translationVector,t,r,n),this}setRotation(t){return ee.fromEuler(this.rotationQuat,0,0,t),this}setScale(t,r){return Y.set(this.scaleVector,t,r,1),this}resetTransform(){Y.zero(this.translationVector),ee.identity(this.rotationQuat),Y.set(this.scaleVector,1,1,1)}pushTransform(){let t=V.fromRotationTranslationScale(V.create(),this.rotationQuat,this.translationVector,this.scaleVector);this.transformStack.push(t),this.resetTransform()}popTransform(){let t=this.transformStack.pop();V.getRotation(this.rotationQuat,t),V.getTranslation(this.translationVector,t),V.getScaling(this.scaleVector,t)}applyTransform(t){for(let r=this.transformStack.length-1;r>=0;--r)V.mul(t,this.transformStack[r],t);return V.mul(t,V.fromRotationTranslationScale(this.transformMatrix,this.rotationQuat,this.translationVector,this.scaleVector),t),t}};var Af=`
attribute vec2 a_position;

uniform mat4 u_projection_view;
uniform mat4 u_model;

void main() {
    gl_Position = u_projection_view * u_model * vec4(a_position.xy, 0.0, 1.0);
}`,wf=`
precision mediump float;

uniform vec3 u_color;
uniform float u_opacity_inv;

void main() {
    gl_FragColor = vec4(u_color.rgb, 1.0 - u_opacity_inv);
}`,ns=16,is=(()=>{let e=[],t=ns,r=Math.PI*2/t,n=1,i=0,s,a;for(let o=0;o<=t;++o)s=Math.cos(o*r),a=Math.sin(o*r),e.push(0,0),e.push(n,i),e.push(s,a),n=s,i=a;return e})(),Tf=Math.trunc(is.length/2),ss=(()=>{let e=[],t=ns,r=Math.PI*2/t,n=1,i=0,s,a;for(let o=0;o<=t;++o)s=Math.cos(o*r),a=Math.sin(o*r),e.push(n,i),e.push(s,a),n=s,i=a;return e})(),Mf=Math.trunc(ss.length/2),Rt=[0,0,1,0,0,1,1,1,1,0,0,1],bf=[0,0,1,1],Vr=class extends Yr{constructor(t,r=void 0,n=void 0){super(t,r,n);this.shapeProgram=new Me(t).shader(t.VERTEX_SHADER,Af).shader(t.FRAGMENT_SHADER,wf).link(),this.meshQuad=new me(t,t.ARRAY_BUFFER).data(Ae.createBufferSource(t,t.FLOAT,Rt)).build(),this.meshLine=new me(t,t.ARRAY_BUFFER).data(Ae.createBufferSource(t,t.FLOAT,bf)).build(),this.meshCircle=new me(t,t.ARRAY_BUFFER).data(Ae.createBufferSource(t,t.FLOAT,is)).build(),this.meshLineCircle=new me(t,t.ARRAY_BUFFER).data(Ae.createBufferSource(t,t.FLOAT,ss)).build()}resize(){super.resize(),this.shapeProgram.bind(this.gl).uniform("u_projection_view",this.projectionViewMatrix)}setColorVector(t,r,n){return super.setColorVector(t,r,n),this.shapeProgram.bind(this.gl).uniform("u_color",this.colorVector),this}setOpacityFloat(t){return super.setOpacityFloat(t),this.shapeProgram.bind(this.gl).uniform("u_opacity_inv",1-this.opacityFloat),this}drawLine(t=0,r=0,n=t+16,i=r){let s=this.gl,a=this.depthFloat,o=n-t,l=i-r,h=this.modelMatrix;return V.fromRotationTranslationScale(h,ee.create(),Y.fromValues(t,r,a),Y.fromValues(o,l,1)),this.applyTransform(h),this.shapeProgram.bind(s).attribute("a_position",s.FLOAT,this.meshLine.handle).uniform("u_model",h).draw(s,s.LINES,0,2),this}drawRay(t=0,r=0,n=0,i=16){let s=Math.PI*n/180;return this.drawLine(t,r,t+Math.cos(s)*i,r+Math.sin(s)*i)}drawBox(t=0,r=0,n=8,i=n){return this.drawBoxImpl(this.gl.TRIANGLES,t,r,this.depthFloat,n,i)}drawLineBox(t=0,r=0,n=8,i=n){return this.drawBoxImpl(this.gl.LINE_LOOP,t,r,this.depthFloat,n,i)}drawRect(t=0,r=0,n=16,i=16){let s=(n-t)/2,a=(i-r)/2;return this.drawBox(t+s,r+a,s,a)}drawLineRect(t=0,r=0,n=16,i=16){let s=(n-t)/2,a=(i-r)/2;return this.drawLineBox(t+s,r+a,s,a)}drawCircle(t=0,r=0,n=8){return this.drawCircleImpl(this.meshCircle,Tf,this.gl.TRIANGLES,t,r,this.depthFloat,n)}drawLineCircle(t=0,r=0,n=8){return this.drawCircleImpl(this.meshLineCircle,Mf,this.gl.LINE_LOOP,t,r,this.depthFloat,n)}drawBoxImpl(t,r,n,i,s,a){let o=this.gl,l=this.modelMatrix;return V.fromRotationTranslationScaleOrigin(l,ee.create(),Y.fromValues(r,n,i),Y.fromValues(s*2,a*2,1),Y.fromValues(.5,.5,0)),this.applyTransform(l),this.shapeProgram.bind(o).attribute("a_position",o.FLOAT,this.meshQuad.handle).uniform("u_model",l).draw(o,t,0,6),this}drawCircleImpl(t,r,n,i,s,a,o){let l=this.gl,h=this.modelMatrix;return V.fromRotationTranslationScale(h,ee.create(),Y.fromValues(i,s,a),Y.fromValues(o,o,1)),this.applyTransform(h),this.shapeProgram.bind(l).attribute("a_position",l.FLOAT,t.handle).uniform("u_model",h).draw(l,n,0,r),this}};var Sf=`
attribute vec2 a_position;
attribute vec2 a_texcoord;

varying vec2 v_texcoord;

uniform mat4 u_projection_view;
uniform mat4 u_model;

void main() {
    vec4 position = u_projection_view * u_model
        * vec4(a_position.xy, 0.0, 1.0);
    v_texcoord = a_texcoord;
    gl_Position = position;
}`,Rf=`
precision mediump float;

varying vec2 v_texcoord;

uniform sampler2D u_texture;
uniform vec2 u_texture_size;
uniform vec4 u_sprite;
uniform vec3 u_color;
uniform float u_opacity_inv;

void main() {
    float spriteWidth = u_sprite.z - u_sprite.x;
    float spriteHeight = u_sprite.w - u_sprite.y;
    vec2 texcoord = vec2(
        (u_sprite.x / u_texture_size.x) + v_texcoord.x * (spriteWidth / u_texture_size.x),
        (u_sprite.y / u_texture_size.y) + v_texcoord.y * (spriteHeight / u_texture_size.y));
    vec4 texcolor = texture2D(u_texture, texcoord);
    if (texcolor.a <= 0.0) discard;
    gl_FragColor = vec4(
        texcolor.r * u_color.r,
        texcolor.g * u_color.g,
        texcolor.b * u_color.b,
        texcolor.a * (1.0 - u_opacity_inv));
}`,Gr=class extends Vr{constructor(t,r=void 0,n=void 0){super(t,r,n);this.texturedProgram=new Me(t).shader(t.VERTEX_SHADER,Sf).shader(t.FRAGMENT_SHADER,Rf).link(),this.meshQuadTextured={position:new me(t,t.ARRAY_BUFFER).data(Ae.createBufferSource(t,t.FLOAT,Rt)).build(),texcoord:new me(t,t.ARRAY_BUFFER).data(Ae.createBufferSource(t,t.FLOAT,Rt)).build()},this.spriteVector=Ee.fromValues(0,0,1,1),this.textureSize=Ye.fromValues(1,1),this.textureHandle=null,this.textureList=new Array(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS))}resize(){super.resize(),this.texturedProgram.bind(this.gl).uniform("u_projection_view",this.projectionViewMatrix)}setColorVector(t,r,n){return super.setColorVector(t,r,n),this.texturedProgram.bind(this.gl).uniform("u_color",this.colorVector),this}setOpacityFloat(t){return super.setOpacityFloat(t),this.texturedProgram.bind(this.gl).uniform("u_opacity_inv",1-this.opacityFloat),this}setTextureImage(t,r){let n=this.textureList,i=n.length;if(t<0||t>=i)throw new Error(`Invalid texture unit - must be within range [0, ${i-1}]`);let s=this.gl,a=n[t];a&&If(s,a.handle);let o=Lf(s,r);return n[t]=o,s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,o.handle),this}drawTexturedBox(t=0,r=0,n=0,i=void 0,s=void 0,a=0,o=0,l=void 0,h=void 0){let{width:c,height:u}=this.textureList[t];Ye.set(this.textureSize,c,u),typeof l=="undefined"&&(l=c),typeof h=="undefined"&&(h=u),Ee.set(this.spriteVector,a,o,l,h);let f=l-a,m=h-o,d=!1;typeof i=="undefined"?i=f/2:d=!0,typeof s=="undefined"&&(d?s=i:s=m/2);let v=i*2,p=s*2,E=v/f,L=p/m;return this.drawTexturedQuadImpl(t,r,n,this.depthFloat,E,L)}drawTexturedRect(t=0,r=0,n=0,i=void 0,s=void 0,a=0,o=0,l=void 0,h=void 0){let{width:c,height:u}=this.textureList[t];typeof l=="undefined"&&(l=c),typeof h=="undefined"&&(h=u),Ye.set(this.textureSize,c,u),Ee.set(this.spriteVector,a,o,l,h),typeof i=="undefined"&&(i=r+c),typeof s=="undefined"&&(s=n+u);let f=i-r,m=s-n,d=l-a,v=h-o,p=f/d,E=m/v,L=r+d/2*p,T=n+v/2*E;return this.drawTexturedQuadImpl(t,L,T,this.depthFloat,p,E)}drawTexturedQuadImpl(t,r,n,i,s,a){let o=this.gl,l=this.spriteVector,h=l[2]-l[0],c=l[3]-l[1],u=this.modelMatrix;V.fromRotationTranslationScaleOrigin(u,ee.fromEuler(ee.create(),0,0,0),Y.fromValues(r-h/2,n-c/2,i),Y.fromValues(s,a,1),Y.fromValues(h/2,c/2,0)),V.scale(u,u,Y.fromValues(h,c,1)),this.applyTransform(u);let f=this.meshQuadTextured,m=this.textureSize;return this.texturedProgram.bind(o).attribute("a_position",o.FLOAT,f.position.handle).attribute("a_texcoord",o.FLOAT,f.texcoord.handle).uniform("u_model",u).uniform("u_texture",t).uniform("u_sprite",l).uniform("u_texture_size",m).draw(o,o.TRIANGLES,0,6),this}};function Lf(e,t){if(!(t instanceof Image))throw new Error(`Not a valid image ${t}.`);let r=0,n=e.RGBA,i=e.RGBA,s=e.UNSIGNED_BYTE,a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,r,n,i,s,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),{handle:a,width:t.width,height:t.height}}function If(e,t){e.deleteTexture(t)}var Cf=`
attribute vec2 a_position;

varying vec2 v_position;

uniform mat4 u_projection_view;
uniform mat4 u_model;

void main() {
    gl_Position = u_projection_view * u_model * vec4(a_position.xy, 0.0, 1.0);
    v_position = a_position;
}`,Of=`
precision mediump float;

varying vec2 v_position;

uniform vec3 u_color;
uniform float u_opacity_inv;

uniform vec3 u_color_from;
uniform vec3 u_color_to;

uniform vec4 u_gradient_rect;

void main() {
    // float fx = (gl_FragCoord.x - u_gradient_rect.x) / u_gradient_rect.z;
    float fy = (gl_FragCoord.y - u_gradient_rect.y) / u_gradient_rect.w;
    gl_FragColor = vec4(mix(u_color_to, u_color_from, fy), 1.0 - u_opacity_inv);
}`,Kr=class extends Gr{constructor(t,r=void 0,n=void 0){super(t,r,n);this.gradientProgram=new Me(t).shader(t.VERTEX_SHADER,Cf).shader(t.FRAGMENT_SHADER,Of).link(),this.gradientColor=Y.create(),this.gradientVector=Ee.create()}resize(){super.resize(),this.gradientProgram.bind(this.gl).uniform("u_projection_view",this.projectionViewMatrix)}setColorVector(t,r,n){return super.setColorVector(t,r,n),this.gradientProgram.bind(this.gl).uniform("u_color",this.colorVector),this}setOpacityFloat(t){return super.setOpacityFloat(t),this.gradientProgram.bind(this.gl).uniform("u_opacity_inv",1-this.opacityFloat),this}drawGradientRect(t=16777215,r=0,n=0,i=0,s=this.canvas.width,a=this.canvas.height){let o=(s-n)/2,l=(a-i)/2,h=n+o,c=i+l,u=this.depthFloat,f=this.gl,m=this.modelMatrix;return V.fromRotationTranslationScaleOrigin(m,ee.fromEuler(ee.create(),0,0,0),Y.fromValues(h,c,u),Y.fromValues(o*2,l*2,1),Y.fromValues(.5,.5,0)),this.applyTransform(m),this.gradientProgram.bind(f).attribute("a_position",f.FLOAT,this.meshQuad.handle).uniform("u_model",m).uniform("u_color_from",Y.set(this.gradientColor,se.redf(t),se.greenf(t),se.bluef(t))).uniform("u_color_to",Y.set(this.gradientColor,se.redf(r),se.greenf(r),se.bluef(r))).uniform("u_gradient_rect",Ee.set(this.gradientVector,n,this.canvas.height-a,o*2,l*2)).draw(f,f.TRIANGLES,0,6),this}};var jr=class extends Kr{constructor(t,r=void 0,n=void 0){super(t,r,n);this.bmFontMap={}}setBMFontTexture(t,r,n){let i={};for(let s of n.chars){let a=s.x,o=s.y,l=a+s.width,h=o+s.height;i[s.id]={u:a,v:o,s:l,t:h}}this.bmFontMap[t]=i,this.setTextureImage(t,r)}drawText(t,r,n,i){let s=n,a=13,o=18;for(let l=0;l<r.length;++l){let h=r.charAt(l);if(h===`
`){i+=o,n=s;continue}else if(h===" "){n+=a;continue}else{n+=a;let c=r.charCodeAt(l),{u,v:f,s:m,t:d}=this.bmFontMap[t][c],v=m-u,p=d-f;this.drawTexturedBox(t,n,i,v/2,p/2,u,f,m,d)}}}};document.title="Moonset";async function as(e){let{display:t,assets:r}=e,n=t.canvas,i=new jr(n.getContext("webgl"));i.reset();let s=r.get("image:water_tile.png"),a=r.get("fnt:m5x7.fnt"),o=r.get("image:m5x7.png"),l=r.get("image:star.png"),h=r.get("image:blur_stroke.png"),c=r.get("image:circle.png"),u=r.get("image:mountains.png"),f=r.get("image:cloud.png"),m=[16448250],d=8550580,v=11845350,p=[11837670,13484018],E=[],L=[],T=[],b=[];for(let M=0;M<40;++M)E.push({x:F.rangeInt(0,n.width),y:F.rangeInt(0,n.height),scale:F.range(.1,.4),opacity:F.range(.3,1),color:F.choose(m),wiggleSpeed:F.range(.8,1.2),wiggleOffset:F.range(0,2)});for(let M=0;M<12;++M){let O=F.range(-n.width/2,n.width),A=F.range(0,n.height),w;A<n.width*.6?w=p[0]:w=p[1];let D=F.range(1,2);L.push({x:O,y:A,color:w,progress:F.range(0,n.height),speed:F.range(.1,1.5),opacity:F.range(.1,.3),radius:F.range(.5,1)*D,length:F.range(1,2)*D})}for(let M=0;M<4;++M){let O=F.range(-n.width/2,n.width),A=F.rangeInt(0,n.height),w=p[1];T.push({x:O,y:A,color:w,progress:0,speed:F.range(.1,.5),opacity:F.range(.1,.5),radius:F.range(.5,1)*3,length:F.range(1,2)*3})}for(let M=0;M<6;++M){let O=F.range(0,n.width),A=F.range(0,n.height),w=se.mix(v,d,mr(A/n.height-.06,0,1)),D=F.range(50,80);b.push({x:O,y:A,opacity:1,color:w,height:D})}let S=[];for(let M=0;M<8;++M){let O=F.range(0,n.width),A=F.range(0,n.height*.6),w=F.range(2,4),D=F.range(.2,1),x=16777215,P=14741247;S.push({x:O,y:A,w,h:D,highlight:x,lowlight:P,progress:0,speed:F.range(.5,3)})}t.addEventListener("frame",M=>{let{deltaTime:O,now:A}=M.detail,w=30;O*=w,A*=w;for(let y of L)if(y.progress+=O/50*y.speed,y.progress>y.y*2+y.length){let N=F.range(-n.width/2,n.width);y.x=N,y.y=n.height,y.progress=0,y.speed=F.range(.1,2),y.opacity=F.range(.1,.3),y.radius=F.range(.5,1),y.length=F.range(1,2)}for(let y of T)if(y.progress+=O/50*y.speed,y.progress>y.y*2+y.length){let N=F.range(-n.width/2,n.width);y.x=N,y.y=n.height,y.progress=0,y.speed=F.range(.1,.5),y.opacity=F.range(.1,.5),y.radius=F.range(.5,1)*3,y.length=F.range(1,2)*3}for(let y of S)y.progress+=O/100*y.speed,y.progress>n.width-y.x+300&&(y.w=F.range(2,4),y.h=F.range(.2,1),y.x=-n.width,y.y=F.range(0,n.height*.6),y.progress=0,y.speed=F.range(.5,3));i.resize(),i.reset(),i.drawGradientRect(d,v,0,0,n.width,n.height);for(let y of b)i.setColor(y.color),i.setScale(n.width/16,y.height/16),i.setTranslation(y.x,y.y),i.drawCircle(),i.resetTransform();i.setTextureImage(2,h),i.setRotation(-45);for(let y of L){let N=y.progress/100;i.setColor(y.color),i.setOpacityFloat(Math.min(N,y.opacity)),i.setScale(y.length,y.radius),i.setTranslation(y.x,y.y),i.drawTexturedBox(2,y.progress)}for(let y of T){let N=y.progress/100;i.setColor(y.color),i.setOpacityFloat(Math.min(N,y.opacity)),i.setScale(y.length,y.radius),i.setTranslation(y.x,y.y),i.drawTexturedBox(2,y.progress)}i.setOpacityFloat(1),i.resetTransform();let D=A/400%n.width,x=A/400%n.height;for(let y of E){i.setColor(y.color),i.setOpacityFloat(y.opacity),i.setTextureImage(0,l);let N=Math.sin(A/500*y.wiggleSpeed+y.wiggleOffset)+1,g=(y.x+D)%n.width,_=(y.y+x)%n.height;i.drawTexturedBox(0,g,n.height-_,16*y.scale,16*y.scale+N*y.scale*8)}i.setOpacityFloat(1),i.setColor(m[0]),i.setTextureImage(3,c),i.drawTexturedBox(3,n.width*.66,60),i.setTextureImage(4,f);let P=-f.height/2;for(let y of S){let N=y.x+y.progress;i.setColor(y.highlight),i.setScale(y.w*1.2,y.h*1.2),i.setTranslation(N,y.y);let g=N/n.width;i.drawTexturedBox(4,10*(-g*2+1),P),i.setColor(y.lowlight),i.setScale(y.w,y.h),i.setTranslation(N,y.y),i.drawTexturedBox(4,0,P)}i.resetTransform(),i.setColor(7496529),i.drawRect(0,n.height-100,n.width,n.height),i.setColor(15651071),i.setTextureImage(4,u),i.drawTexturedBox(4,n.width/2,n.height-100)})}var u1=new X("forward",[he.KEY_W,he.ARROW_UP]),f1=new X("backward",[he.KEY_S,he.ARROW_DOWN]),p1=new X("rotateLeft",[he.KEY_A,he.ARROW_LEFT]),d1=new X("rotateRight",[he.KEY_D,he.ARROW_RIGHT]),m1=new X("fire",he.SPACE),v1=new X("debug",he.BACKQUOTE);async function Pe(e){let t=Be.getAudioContext(),r=await Qe(e,t);return new Be(t,r)}var A1=new Re("sound://start.wav","res/start.wav",Pe),w1=new Re("sound://dead.wav","res/dead.wav",Pe),T1=new Re("sound://pop.wav","res/boop.wav",Pe),M1=new Re("sound://shoot.wav","res/click.wav",Pe),b1=new Re("sound://boom.wav","res/boom.wav",Pe),S1=new Re("sound://music.wav","res/music.wav",Pe);document.title="Starfield";window.addEventListener("DOMContentLoaded",Pf);async function Pf(){let e=document.querySelector("#display"),t=document.querySelector("#inputs").getContext("axisbutton"),r=new pr;await ie.loadAssetPackAsRaw("res.pack",(i,s,a)=>ie.cache("res/"+a,i)),await r.pipe("res/**/*.md",async(i,s)=>ie.cache("txt:"+s.substring(4),await _t(i))),await r.pipe("res/**/*.txt",async(i,s)=>ie.cache("txt:"+s.substring(4),await _t(i))),await r.pipe("res/**/*.png",async(i,s)=>ie.cache("image:"+s.substring(4),await xr(i,"image/png"))),await r.pipe("res/**/*.obj",async(i,s)=>ie.cache("obj:"+s.substring(4),await gr(i))),await r.pipe("res/**/*.atlas",async(i,s)=>ie.cache("atlas:"+s.substring(4),await _r(i))),await r.pipe("res/**/*.fnt",async(i,s)=>ie.cache("fnt:"+s.substring(4),await yr(i))),await r.pipe("res/**/*.wav",async(i,s)=>{let a=Be.getAudioContext(),o=await Qe(i,a),l=new Be(a,o);return ie.cache("sound:"+s.substring(4),l)});let n=new vr(e,t);e.addEventListener("frame",i=>{let{deltaTime:s,prevTime:a,now:o}=i.detail;n.deltaTime=s,n.prevTime=a,n.now=o,t.poll(o),n.emit("frame")}),await as(n)}})();
//# sourceMappingURL=main.js.map
