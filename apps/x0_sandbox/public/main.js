(()=>{var zi=Object.create,Ye=Object.defineProperty,Hi=Object.getPrototypeOf,Ki=Object.prototype.hasOwnProperty,Yi=Object.getOwnPropertyNames,ji=Object.getOwnPropertyDescriptor;var $i=e=>Ye(e,"__esModule",{value:!0});var Gi=(e,t)=>()=>(e&&(t=e(e=0)),t),Ee=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),be=(e,t)=>{for(var n in t)Ye(e,n,{get:t[n],enumerable:!0})},Vi=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Yi(t))!Ki.call(e,r)&&r!=="default"&&Ye(e,r,{get:()=>t[r],enumerable:!(n=ji(t,r))||n.enumerable});return e},qi=e=>Vi($i(Ye(e!=null?zi(Hi(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var er={};be(er,{basename:()=>or,default:()=>Ka,delimiter:()=>sr,dirname:()=>ar,extname:()=>lr,isAbsolute:()=>Ut,join:()=>nr,normalize:()=>kt,relative:()=>rr,resolve:()=>Ze,sep:()=>ir});function tr(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];i==="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function Ze(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=tr(Ft(e.split("/"),function(i){return!!i}),!t).join("/"),(t?"/":"")+e||"."}function kt(e){var t=Ut(e),n=Ha(e,-1)==="/";return e=tr(Ft(e.split("/"),function(r){return!!r}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function Ut(e){return e.charAt(0)==="/"}function nr(){var e=Array.prototype.slice.call(arguments,0);return kt(Ft(e,function(t,n){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function rr(e,t){e=Ze(e).substr(1),t=Ze(t).substr(1);function n(h){for(var c=0;c<h.length&&h[c]==="";c++);for(var u=h.length-1;u>=0&&h[u]==="";u--);return c>u?[]:h.slice(c,u-c+1)}for(var r=n(e.split("/")),i=n(t.split("/")),s=Math.min(r.length,i.length),a=s,o=0;o<s;o++)if(r[o]!==i[o]){a=o;break}for(var l=[],o=a;o<r.length;o++)l.push("..");return l=l.concat(i.slice(a)),l.join("/")}function ar(e){var t=Pt(e),n=t[0],r=t[1];return!n&&!r?".":(r&&(r=r.substr(0,r.length-1)),n+r)}function or(e,t){var n=Pt(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n}function lr(e){return Pt(e)[3]}function Ft(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}var za,Pt,ir,sr,Ka,Ha,hr=Gi(()=>{za=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Pt=function(e){return za.exec(e).slice(1)};ir="/",sr=":";Ka={extname:lr,basename:or,dirname:ar,sep:ir,delimiter:sr,relative:rr,join:nr,isAbsolute:Ut,normalize:kt,resolve:Ze};Ha="ab".substr(-1)==="b"?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}});var Je=Ee((Uu,Qe)=>{var _e=(hr(),er);_e&&_e.default?Qe.exports=_e.default:_e&&(Qe.exports=_e);if(_e)for(let e in _e)Qe.exports[e]=_e[e]});var De=Ee((ku,cr)=>{"use strict";var Ya=Je(),de="\\\\/",ur=`[^${de}]`,ve="\\.",ja="\\+",$a="\\?",et="\\/",Ga="(?=.)",fr="[^/]",zt=`(?:${et}|$)`,pr=`(?:^|${et})`,Ht=`${ve}{1,2}${zt}`,Va=`(?!${ve})`,qa=`(?!${pr}${Ht})`,Xa=`(?!${ve}{0,1}${zt})`,Wa=`(?!${Ht})`,Za=`[^.${et}]`,Qa=`${fr}*?`,dr={DOT_LITERAL:ve,PLUS_LITERAL:ja,QMARK_LITERAL:$a,SLASH_LITERAL:et,ONE_CHAR:Ga,QMARK:fr,END_ANCHOR:zt,DOTS_SLASH:Ht,NO_DOT:Va,NO_DOTS:qa,NO_DOT_SLASH:Xa,NO_DOTS_SLASH:Wa,QMARK_NO_DOT:Za,STAR:Qa,START_ANCHOR:pr},Ja={...dr,SLASH_LITERAL:`[${de}]`,QMARK:ur,STAR:`${ur}*?`,DOTS_SLASH:`${ve}{1,2}(?:[${de}]|$)`,NO_DOT:`(?!${ve})`,NO_DOTS:`(?!(?:^|[${de}])${ve}{1,2}(?:[${de}]|$))`,NO_DOT_SLASH:`(?!${ve}{0,1}(?:[${de}]|$))`,NO_DOTS_SLASH:`(?!${ve}{1,2}(?:[${de}]|$))`,QMARK_NO_DOT:`[^.${de}]`,START_ANCHOR:`(?:^|[${de}])`,END_ANCHOR:`(?:[${de}]|$)`},eo={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};cr.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:eo,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Ya.sep,extglobChars(e){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(e){return e===!0?Ja:dr}}});var tt=Ee(ne=>{"use strict";var to=Je(),no=!1,{REGEX_BACKSLASH:ro,REGEX_REMOVE_BACKSLASH:io,REGEX_SPECIAL_CHARS:so,REGEX_SPECIAL_CHARS_GLOBAL:ao}=De();ne.isObject=e=>e!==null&&typeof e=="object"&&!Array.isArray(e);ne.hasRegexChars=e=>so.test(e);ne.isRegexChar=e=>e.length===1&&ne.hasRegexChars(e);ne.escapeRegex=e=>e.replace(ao,"\\$1");ne.toPosixSlashes=e=>e.replace(ro,"/");ne.removeBackslashes=e=>e.replace(io,t=>t==="\\"?"":t);ne.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return e.length===3&&e[0]>=9||e[0]===8&&e[1]>=10};ne.isWindows=e=>e&&typeof e.windows=="boolean"?e.windows:no===!0||to.sep==="\\";ne.escapeLast=(e,t,n)=>{let r=e.lastIndexOf(t,n);return r===-1?e:e[r-1]==="\\"?ne.escapeLast(e,t,r-1):`${e.slice(0,r)}\\${e.slice(r)}`};ne.removePrefix=(e,t={})=>{let n=e;return n.startsWith("./")&&(n=n.slice(2),t.prefix="./"),n};ne.wrapOutput=(e,t={},n={})=>{let r=n.contains?"":"^",i=n.contains?"":"$",s=`${r}(?:${e})${i}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var Ar=Ee((Hu,mr)=>{"use strict";var vr=tt(),{CHAR_ASTERISK:Kt,CHAR_AT:oo,CHAR_BACKWARD_SLASH:Pe,CHAR_COMMA:lo,CHAR_DOT:Yt,CHAR_EXCLAMATION_MARK:jt,CHAR_FORWARD_SLASH:xr,CHAR_LEFT_CURLY_BRACE:$t,CHAR_LEFT_PARENTHESES:Gt,CHAR_LEFT_SQUARE_BRACKET:ho,CHAR_PLUS:co,CHAR_QUESTION_MARK:gr,CHAR_RIGHT_CURLY_BRACE:uo,CHAR_RIGHT_PARENTHESES:_r,CHAR_RIGHT_SQUARE_BRACKET:fo}=De(),yr=e=>e===xr||e===Pe,Er=e=>{e.isPrefix!==!0&&(e.depth=e.isGlobstar?Infinity:1)},po=(e,t)=>{let n=t||{},r=e.length-1,i=n.parts===!0||n.scanToEnd===!0,s=[],a=[],o=[],l=e,h=-1,c=0,u=0,f=!1,d=!1,m=!1,v=!1,p=!1,y=!1,L=!1,E=!1,M=!1,b=!1,R=0,O,A,w={value:"",depth:0,isGlob:!1},D=()=>h>=r,_=()=>l.charCodeAt(h+1),B=()=>(O=A,l.charCodeAt(++h));for(;h<r;){A=B();let Y;if(A===Pe){L=w.backslashes=!0,A=B(),A===$t&&(y=!0);continue}if(y===!0||A===$t){for(R++;D()!==!0&&(A=B());){if(A===Pe){L=w.backslashes=!0,B();continue}if(A===$t){R++;continue}if(y!==!0&&A===Yt&&(A=B())===Yt){if(f=w.isBrace=!0,m=w.isGlob=!0,b=!0,i===!0)continue;break}if(y!==!0&&A===lo){if(f=w.isBrace=!0,m=w.isGlob=!0,b=!0,i===!0)continue;break}if(A===uo&&(R--,R===0)){y=!1,f=w.isBrace=!0,b=!0;break}}if(i===!0)continue;break}if(A===xr){if(s.push(h),a.push(w),w={value:"",depth:0,isGlob:!1},b===!0)continue;if(O===Yt&&h===c+1){c+=2;continue}u=h+1;continue}if(n.noext!==!0&&(A===co||A===oo||A===Kt||A===gr||A===jt)===!0&&_()===Gt){if(m=w.isGlob=!0,v=w.isExtglob=!0,b=!0,A===jt&&h===c&&(M=!0),i===!0){for(;D()!==!0&&(A=B());){if(A===Pe){L=w.backslashes=!0,A=B();continue}if(A===_r){m=w.isGlob=!0,b=!0;break}}continue}break}if(A===Kt){if(O===Kt&&(p=w.isGlobstar=!0),m=w.isGlob=!0,b=!0,i===!0)continue;break}if(A===gr){if(m=w.isGlob=!0,b=!0,i===!0)continue;break}if(A===ho){for(;D()!==!0&&(Y=B());){if(Y===Pe){L=w.backslashes=!0,B();continue}if(Y===fo){d=w.isBracket=!0,m=w.isGlob=!0,b=!0;break}}if(i===!0)continue;break}if(n.nonegate!==!0&&A===jt&&h===c){E=w.negated=!0,c++;continue}if(n.noparen!==!0&&A===Gt){if(m=w.isGlob=!0,i===!0){for(;D()!==!0&&(A=B());){if(A===Gt){L=w.backslashes=!0,A=B();continue}if(A===_r){b=!0;break}}continue}break}if(m===!0){if(b=!0,i===!0)continue;break}}n.noext===!0&&(v=!1,m=!1);let N=l,P="",x="";c>0&&(P=l.slice(0,c),l=l.slice(c),u-=c),N&&m===!0&&u>0?(N=l.slice(0,u),x=l.slice(u)):m===!0?(N="",x=l):N=l,N&&N!==""&&N!=="/"&&N!==l&&yr(N.charCodeAt(N.length-1))&&(N=N.slice(0,-1)),n.unescape===!0&&(x&&(x=vr.removeBackslashes(x)),N&&L===!0&&(N=vr.removeBackslashes(N)));let g={prefix:P,input:e,start:c,base:N,glob:x,isBrace:f,isBracket:d,isGlob:m,isExtglob:v,isGlobstar:p,negated:E,negatedExtglob:M};if(n.tokens===!0&&(g.maxDepth=0,yr(A)||a.push(w),g.tokens=a),n.parts===!0||n.tokens===!0){let Y;for(let z=0;z<s.length;z++){let W=Y?Y+1:c,Z=s[z],Q=e.slice(W,Z);n.tokens&&(z===0&&c!==0?(a[z].isPrefix=!0,a[z].value=P):a[z].value=Q,Er(a[z]),g.maxDepth+=a[z].depth),(z!==0||Q!=="")&&o.push(Q),Y=Z}if(Y&&Y+1<e.length){let z=e.slice(Y+1);o.push(z),n.tokens&&(a[a.length-1].value=z,Er(a[a.length-1]),g.maxDepth+=a[a.length-1].depth)}g.slashes=s,g.parts=o}return g};mr.exports=po});var Tr=Ee((Ku,wr)=>{"use strict";var nt=De(),ie=tt(),{MAX_LENGTH:rt,POSIX_REGEX_SOURCE:mo,REGEX_NON_SPECIAL_CHARS:vo,REGEX_SPECIAL_CHARS_BACKREF:xo,REPLACEMENTS:Mr}=nt,go=(e,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...e,t);e.sort();let n=`[${e.join("-")}]`;try{new RegExp(n)}catch(r){return e.map(i=>ie.escapeRegex(i)).join("..")}return n},Re=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,br=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");e=Mr[e]||e;let n={...t},r=typeof n.maxLength=="number"?Math.min(rt,n.maxLength):rt,i=e.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);let s={type:"bos",value:"",output:n.prepend||""},a=[s],o=n.capture?"":"?:",l=ie.isWindows(t),h=nt.globChars(l),c=nt.extglobChars(h),{DOT_LITERAL:u,PLUS_LITERAL:f,SLASH_LITERAL:d,ONE_CHAR:m,DOTS_SLASH:v,NO_DOT:p,NO_DOT_SLASH:y,NO_DOTS_SLASH:L,QMARK:E,QMARK_NO_DOT:M,STAR:b,START_ANCHOR:R}=h,O=I=>`(${o}(?:(?!${R}${I.dot?v:u}).)*?)`,A=n.dot?"":p,w=n.dot?E:M,D=n.bash===!0?O(n):b;n.capture&&(D=`(${D})`),typeof n.noext=="boolean"&&(n.noextglob=n.noext);let _={input:e,index:-1,start:0,dot:n.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};e=ie.removePrefix(e,_),i=e.length;let B=[],N=[],P=[],x=s,g,Y=()=>_.index===i-1,z=_.peek=(I=1)=>e[_.index+I],W=_.advance=()=>e[++_.index]||"",Z=()=>e.slice(_.index+1),Q=(I="",j=0)=>{_.consumed+=I,_.index+=j},he=I=>{_.output+=I.output!=null?I.output:I.value,Q(I.value)},Ce=()=>{let I=1;for(;z()==="!"&&(z(2)!=="("||z(3)==="?");)W(),_.start++,I++;return I%2==0?!1:(_.negated=!0,_.start++,!0)},ge=I=>{_[I]++,P.push(I)},ce=I=>{_[I]--,P.pop()},F=I=>{if(x.type==="globstar"){let j=_.braces>0&&(I.type==="comma"||I.type==="brace"),T=I.extglob===!0||B.length&&(I.type==="pipe"||I.type==="paren");I.type!=="slash"&&I.type!=="paren"&&!j&&!T&&(_.output=_.output.slice(0,-x.output.length),x.type="star",x.value="*",x.output=D,_.output+=x.output)}if(B.length&&I.type!=="paren"&&(B[B.length-1].inner+=I.value),(I.value||I.output)&&he(I),x&&x.type==="text"&&I.type==="text"){x.value+=I.value,x.output=(x.output||"")+I.value;return}I.prev=x,a.push(I),x=I},ye=(I,j)=>{let T={...c[j],conditions:1,inner:""};T.prev=x,T.parens=_.parens,T.output=_.output;let U=(n.capture?"(":"")+T.open;ge("parens"),F({type:I,value:j,output:_.output?"":m}),F({type:"paren",extglob:!0,value:W(),output:U}),B.push(T)},He=I=>{let j=I.close+(n.capture?")":""),T;if(I.type==="negate"){let U=D;I.inner&&I.inner.length>1&&I.inner.includes("/")&&(U=O(n)),(U!==D||Y()||/^\)+$/.test(Z()))&&(j=I.close=`)$))${U}`),I.inner.includes("*")&&(T=Z())&&/^\.[^\\/.]+$/.test(T)&&(j=I.close=`)${T})${U})`),I.prev.type==="bos"&&(_.negatedExtglob=!0)}F({type:"paren",extglob:!0,value:g,output:j}),ce("parens")};if(n.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(e)){let I=!1,j=e.replace(xo,(T,U,G,ee,X,xt)=>ee==="\\"?(I=!0,T):ee==="?"?U?U+ee+(X?E.repeat(X.length):""):xt===0?w+(X?E.repeat(X.length):""):E.repeat(G.length):ee==="."?u.repeat(G.length):ee==="*"?U?U+ee+(X?D:""):D:U?T:`\\${T}`);return I===!0&&(n.unescape===!0?j=j.replace(/\\/g,""):j=j.replace(/\\+/g,T=>T.length%2==0?"\\\\":T?"\\":"")),j===e&&n.contains===!0?(_.output=e,_):(_.output=ie.wrapOutput(j,_,t),_)}for(;!Y();){if(g=W(),g==="\0")continue;if(g==="\\"){let T=z();if(T==="/"&&n.bash!==!0||T==="."||T===";")continue;if(!T){g+="\\",F({type:"text",value:g});continue}let U=/^\\+/.exec(Z()),G=0;if(U&&U[0].length>2&&(G=U[0].length,_.index+=G,G%2!=0&&(g+="\\")),n.unescape===!0?g=W():g+=W(),_.brackets===0){F({type:"text",value:g});continue}}if(_.brackets>0&&(g!=="]"||x.value==="["||x.value==="[^")){if(n.posix!==!1&&g===":"){let T=x.value.slice(1);if(T.includes("[")&&(x.posix=!0,T.includes(":"))){let U=x.value.lastIndexOf("["),G=x.value.slice(0,U),ee=x.value.slice(U+2),X=mo[ee];if(X){x.value=G+X,_.backtrack=!0,W(),!s.output&&a.indexOf(x)===1&&(s.output=m);continue}}}(g==="["&&z()!==":"||g==="-"&&z()==="]")&&(g=`\\${g}`),g==="]"&&(x.value==="["||x.value==="[^")&&(g=`\\${g}`),n.posix===!0&&g==="!"&&x.value==="["&&(g="^"),x.value+=g,he({value:g});continue}if(_.quotes===1&&g!=='"'){g=ie.escapeRegex(g),x.value+=g,he({value:g});continue}if(g==='"'){_.quotes=_.quotes===1?0:1,n.keepQuotes===!0&&F({type:"text",value:g});continue}if(g==="("){ge("parens"),F({type:"paren",value:g});continue}if(g===")"){if(_.parens===0&&n.strictBrackets===!0)throw new SyntaxError(Re("opening","("));let T=B[B.length-1];if(T&&_.parens===T.parens+1){He(B.pop());continue}F({type:"paren",value:g,output:_.parens?")":"\\)"}),ce("parens");continue}if(g==="["){if(n.nobracket===!0||!Z().includes("]")){if(n.nobracket!==!0&&n.strictBrackets===!0)throw new SyntaxError(Re("closing","]"));g=`\\${g}`}else ge("brackets");F({type:"bracket",value:g});continue}if(g==="]"){if(n.nobracket===!0||x&&x.type==="bracket"&&x.value.length===1){F({type:"text",value:g,output:`\\${g}`});continue}if(_.brackets===0){if(n.strictBrackets===!0)throw new SyntaxError(Re("opening","["));F({type:"text",value:g,output:`\\${g}`});continue}ce("brackets");let T=x.value.slice(1);if(x.posix!==!0&&T[0]==="^"&&!T.includes("/")&&(g=`/${g}`),x.value+=g,he({value:g}),n.literalBrackets===!1||ie.hasRegexChars(T))continue;let U=ie.escapeRegex(x.value);if(_.output=_.output.slice(0,-x.value.length),n.literalBrackets===!0){_.output+=U,x.value=U;continue}x.value=`(${o}${U}|${x.value})`,_.output+=x.value;continue}if(g==="{"&&n.nobrace!==!0){ge("braces");let T={type:"brace",value:g,output:"(",outputIndex:_.output.length,tokensIndex:_.tokens.length};N.push(T),F(T);continue}if(g==="}"){let T=N[N.length-1];if(n.nobrace===!0||!T){F({type:"text",value:g,output:g});continue}let U=")";if(T.dots===!0){let G=a.slice(),ee=[];for(let X=G.length-1;X>=0&&(a.pop(),G[X].type!=="brace");X--)G[X].type!=="dots"&&ee.unshift(G[X].value);U=go(ee,n),_.backtrack=!0}if(T.comma!==!0&&T.dots!==!0){let G=_.output.slice(0,T.outputIndex),ee=_.tokens.slice(T.tokensIndex);T.value=T.output="\\{",g=U="\\}",_.output=G;for(let X of ee)_.output+=X.output||X.value}F({type:"brace",value:g,output:U}),ce("braces"),N.pop();continue}if(g==="|"){B.length>0&&B[B.length-1].conditions++,F({type:"text",value:g});continue}if(g===","){let T=g,U=N[N.length-1];U&&P[P.length-1]==="braces"&&(U.comma=!0,T="|"),F({type:"comma",value:g,output:T});continue}if(g==="/"){if(x.type==="dot"&&_.index===_.start+1){_.start=_.index+1,_.consumed="",_.output="",a.pop(),x=s;continue}F({type:"slash",value:g,output:d});continue}if(g==="."){if(_.braces>0&&x.type==="dot"){x.value==="."&&(x.output=u);let T=N[N.length-1];x.type="dots",x.output+=g,x.value+=g,T.dots=!0;continue}if(_.braces+_.parens===0&&x.type!=="bos"&&x.type!=="slash"){F({type:"text",value:g,output:u});continue}F({type:"dot",value:g,output:u});continue}if(g==="?"){if(!(x&&x.value==="(")&&n.noextglob!==!0&&z()==="("&&z(2)!=="?"){ye("qmark",g);continue}if(x&&x.type==="paren"){let U=z(),G=g;if(U==="<"&&!ie.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(x.value==="("&&!/[!=<:]/.test(U)||U==="<"&&!/<([!=]|\w+>)/.test(Z()))&&(G=`\\${g}`),F({type:"text",value:g,output:G});continue}if(n.dot!==!0&&(x.type==="slash"||x.type==="bos")){F({type:"qmark",value:g,output:M});continue}F({type:"qmark",value:g,output:E});continue}if(g==="!"){if(n.noextglob!==!0&&z()==="("&&(z(2)!=="?"||!/[!=<:]/.test(z(3)))){ye("negate",g);continue}if(n.nonegate!==!0&&_.index===0){Ce();continue}}if(g==="+"){if(n.noextglob!==!0&&z()==="("&&z(2)!=="?"){ye("plus",g);continue}if(x&&x.value==="("||n.regex===!1){F({type:"plus",value:g,output:f});continue}if(x&&(x.type==="bracket"||x.type==="paren"||x.type==="brace")||_.parens>0){F({type:"plus",value:g});continue}F({type:"plus",value:f});continue}if(g==="@"){if(n.noextglob!==!0&&z()==="("&&z(2)!=="?"){F({type:"at",extglob:!0,value:g,output:""});continue}F({type:"text",value:g});continue}if(g!=="*"){(g==="$"||g==="^")&&(g=`\\${g}`);let T=vo.exec(Z());T&&(g+=T[0],_.index+=T[0].length),F({type:"text",value:g});continue}if(x&&(x.type==="globstar"||x.star===!0)){x.type="star",x.star=!0,x.value+=g,x.output=D,_.backtrack=!0,_.globstar=!0,Q(g);continue}let I=Z();if(n.noextglob!==!0&&/^\([^?]/.test(I)){ye("star",g);continue}if(x.type==="star"){if(n.noglobstar===!0){Q(g);continue}let T=x.prev,U=T.prev,G=T.type==="slash"||T.type==="bos",ee=U&&(U.type==="star"||U.type==="globstar");if(n.bash===!0&&(!G||I[0]&&I[0]!=="/")){F({type:"star",value:g,output:""});continue}let X=_.braces>0&&(T.type==="comma"||T.type==="brace"),xt=B.length&&(T.type==="pipe"||T.type==="paren");if(!G&&T.type!=="paren"&&!X&&!xt){F({type:"star",value:g,output:""});continue}for(;I.slice(0,3)==="/**";){let Ke=e[_.index+4];if(Ke&&Ke!=="/")break;I=I.slice(3),Q("/**",3)}if(T.type==="bos"&&Y()){x.type="globstar",x.value+=g,x.output=O(n),_.output=x.output,_.globstar=!0,Q(g);continue}if(T.type==="slash"&&T.prev.type!=="bos"&&!ee&&Y()){_.output=_.output.slice(0,-(T.output+x.output).length),T.output=`(?:${T.output}`,x.type="globstar",x.output=O(n)+(n.strictSlashes?")":"|$)"),x.value+=g,_.globstar=!0,_.output+=T.output+x.output,Q(g);continue}if(T.type==="slash"&&T.prev.type!=="bos"&&I[0]==="/"){let Ke=I[1]!==void 0?"|$":"";_.output=_.output.slice(0,-(T.output+x.output).length),T.output=`(?:${T.output}`,x.type="globstar",x.output=`${O(n)}${d}|${d}${Ke})`,x.value+=g,_.output+=T.output+x.output,_.globstar=!0,Q(g+W()),F({type:"slash",value:"/",output:""});continue}if(T.type==="bos"&&I[0]==="/"){x.type="globstar",x.value+=g,x.output=`(?:^|${d}|${O(n)}${d})`,_.output=x.output,_.globstar=!0,Q(g+W()),F({type:"slash",value:"/",output:""});continue}_.output=_.output.slice(0,-x.output.length),x.type="globstar",x.output=O(n),x.value+=g,_.output+=x.output,_.globstar=!0,Q(g);continue}let j={type:"star",value:g,output:D};if(n.bash===!0){j.output=".*?",(x.type==="bos"||x.type==="slash")&&(j.output=A+j.output),F(j);continue}if(x&&(x.type==="bracket"||x.type==="paren")&&n.regex===!0){j.output=g,F(j);continue}(_.index===_.start||x.type==="slash"||x.type==="dot")&&(x.type==="dot"?(_.output+=y,x.output+=y):n.dot===!0?(_.output+=L,x.output+=L):(_.output+=A,x.output+=A),z()!=="*"&&(_.output+=m,x.output+=m)),F(j)}for(;_.brackets>0;){if(n.strictBrackets===!0)throw new SyntaxError(Re("closing","]"));_.output=ie.escapeLast(_.output,"["),ce("brackets")}for(;_.parens>0;){if(n.strictBrackets===!0)throw new SyntaxError(Re("closing",")"));_.output=ie.escapeLast(_.output,"("),ce("parens")}for(;_.braces>0;){if(n.strictBrackets===!0)throw new SyntaxError(Re("closing","}"));_.output=ie.escapeLast(_.output,"{"),ce("braces")}if(n.strictSlashes!==!0&&(x.type==="star"||x.type==="bracket")&&F({type:"maybe_slash",value:"",output:`${d}?`}),_.backtrack===!0){_.output="";for(let I of _.tokens)_.output+=I.output!=null?I.output:I.value,I.suffix&&(_.output+=I.suffix)}return _};br.fastpaths=(e,t)=>{let n={...t},r=typeof n.maxLength=="number"?Math.min(rt,n.maxLength):rt,i=e.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);e=Mr[e]||e;let s=ie.isWindows(t),{DOT_LITERAL:a,SLASH_LITERAL:o,ONE_CHAR:l,DOTS_SLASH:h,NO_DOT:c,NO_DOTS:u,NO_DOTS_SLASH:f,STAR:d,START_ANCHOR:m}=nt.globChars(s),v=n.dot?u:c,p=n.dot?f:c,y=n.capture?"":"?:",L={negated:!1,prefix:""},E=n.bash===!0?".*?":d;n.capture&&(E=`(${E})`);let M=A=>A.noglobstar===!0?E:`(${y}(?:(?!${m}${A.dot?h:a}).)*?)`,b=A=>{switch(A){case"*":return`${v}${l}${E}`;case".*":return`${a}${l}${E}`;case"*.*":return`${v}${E}${a}${l}${E}`;case"*/*":return`${v}${E}${o}${l}${p}${E}`;case"**":return v+M(n);case"**/*":return`(?:${v}${M(n)}${o})?${p}${l}${E}`;case"**/*.*":return`(?:${v}${M(n)}${o})?${p}${E}${a}${l}${E}`;case"**/.*":return`(?:${v}${M(n)}${o})?${a}${l}${E}`;default:{let w=/^(.*?)\.(\w+)$/.exec(A);if(!w)return;let D=b(w[1]);return D?D+a+w[2]:void 0}}},R=ie.removePrefix(e,L),O=b(R);return O&&n.strictSlashes!==!0&&(O+=`${o}?`),O};wr.exports=br});var Rr=Ee((Yu,Sr)=>{"use strict";var _o=Je(),yo=Ar(),Vt=Tr(),qt=tt(),Eo=De(),Ao=e=>e&&typeof e=="object"&&!Array.isArray(e),V=(e,t,n=!1)=>{if(Array.isArray(e)){let c=e.map(f=>V(f,t,n));return f=>{for(let d of c){let m=d(f);if(m)return m}return!1}}let r=Ao(e)&&e.tokens&&e.input;if(e===""||typeof e!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let i=t||{},s=qt.isWindows(t),a=r?V.compileRe(e,t):V.makeRe(e,t,!1,!0),o=a.state;delete a.state;let l=()=>!1;if(i.ignore){let c={...t,ignore:null,onMatch:null,onResult:null};l=V(i.ignore,c,n)}let h=(c,u=!1)=>{let{isMatch:f,match:d,output:m}=V.test(c,a,t,{glob:e,posix:s}),v={glob:e,state:o,regex:a,posix:s,input:c,output:m,match:d,isMatch:f};return typeof i.onResult=="function"&&i.onResult(v),f===!1?(v.isMatch=!1,u?v:!1):l(c)?(typeof i.onIgnore=="function"&&i.onIgnore(v),v.isMatch=!1,u?v:!1):(typeof i.onMatch=="function"&&i.onMatch(v),u?v:!0)};return n&&(h.state=o),h};V.test=(e,t,n,{glob:r,posix:i}={})=>{if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e==="")return{isMatch:!1,output:""};let s=n||{},a=s.format||(i?qt.toPosixSlashes:null),o=e===r,l=o&&a?a(e):e;return o===!1&&(l=a?a(e):e,o=l===r),(o===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?o=V.matchBase(e,t,n,i):o=t.exec(l)),{isMatch:Boolean(o),match:o,output:l}};V.matchBase=(e,t,n,r=qt.isWindows(n))=>(t instanceof RegExp?t:V.makeRe(t,n)).test(_o.basename(e));V.isMatch=(e,t,n)=>V(t,n)(e);V.parse=(e,t)=>Array.isArray(e)?e.map(n=>V.parse(n,t)):Vt(e,{...t,fastpaths:!1});V.scan=(e,t)=>yo(e,t);V.compileRe=(e,t,n=!1,r=!1)=>{if(n===!0)return e.output;let i=t||{},s=i.contains?"":"^",a=i.contains?"":"$",o=`${s}(?:${e.output})${a}`;e&&e.negated===!0&&(o=`^(?!${o}).*$`);let l=V.toRegex(o,t);return r===!0&&(l.state=e),l};V.makeRe=(e,t={},n=!1,r=!1)=>{if(!e||typeof e!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(e[0]==="."||e[0]==="*")&&(i.output=Vt.fastpaths(e,t)),i.output||(i=Vt(e,t)),V.compileRe(i,t,n,r)};V.toRegex=(e,t)=>{try{let n=t||{};return new RegExp(e,n.flags||(n.nocase?"i":""))}catch(n){if(t&&t.debug===!0)throw n;return/$^/}};V.constants=Eo;Sr.exports=V});var Ir=Ee((ju,Lr)=>{"use strict";Lr.exports=Rr()});var Xi=`<div class="container">
    <label class="hidden" id="title">display-port</label>
    <label class="hidden" id="fps">00</label>
    <label class="hidden" id="dimension">0x0</label>
    <div class="content">
        <canvas>
            Oh no! Your browser does not support canvas.
        </canvas>
        <slot id="inner"></slot>
    </div>
    <slot name="frame"></slot>
</div>`,Wi=`:host {
    display: inline-block;
    color: #555555;
}

.container {
    display: flex;
    position: relative;
    width: 100%;
    height: 100%;
}

.content {
    position: relative;
    margin: auto;
}

.content > *:not(canvas) {
    width: 100%;
    height: 100%;
}

canvas {
    background: #000000;
    image-rendering: pixelated;
}

label {
    position: absolute;
    font-family: monospace;
    color: currentColor;
}

#inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
}

#title {
    left: 0.5rem;
    top: 0.5rem;
}

#fps {
    right: 0.5rem;
    top: 0.5rem;
}

#dimension {
    left: 0.5rem;
    bottom: 0.5rem;
}

.hidden {
    display: none;
}

:host([debug]) .container {
    outline: 6px dashed rgba(0, 0, 0, 0.1);
    outline-offset: -4px;
    background-color: rgba(0, 0, 0, 0.1);
}

:host([mode="noscale"]) canvas {
    margin: 0;
    top: 0;
    left: 0;
}

:host([mode="stretch"]) canvas,
:host([mode="scale"]) canvas {
    width: 100%;
    height: 100%;
}

:host([mode="fit"]),
:host([mode="scale"]),
:host([mode="center"]),
:host([mode="stretch"]),
:host([mode="fill"]) {
    width: 100%;
    height: 100%;
}

:host([full]) {
    width: 100vw !important;
    height: 100vh !important;
}

:host([disabled]) {
    display: none;
}

slot {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
}

::slotted(*) {
    pointer-events: auto;
}
`,wn="noscale",gt="fit",Mn="scale",bn="fill",Tn="stretch",Zi=300,Qi=150,Ji=gt,es=200,Sn=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Xi,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Wi,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._contentElement=this.shadowRoot.querySelector(".content"),this._innerElement=this.shadowRoot.querySelector("#inner"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=Zi,this._height=Qi,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Te(this,"mode"),Te(this,"debug"),Te(this,"disabled"),Te(this,"width"),Te(this,"height"),Te(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",Ji),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,n,r){switch(t){case"debug":this._debug=r!==null;break;case"disabled":this._disabled=r!==null;break;case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this);break}switch(t){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r);break}}getContext(t="2d",n=void 0){return this._canvasElement.getContext(t,n)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);let n=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let r=n<=0?"--":String(Math.round(1e3/n)).padStart(2,"0");if(this._fpsElement.textContent!==r&&(this._fpsElement.textContent=r),this.mode===wn){let s=`${this._width}x${this._height}`;this._dimensionElement.textContent!==s&&(this._dimensionElement.textContent=s)}else{let s=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==s&&(this._dimensionElement.textContent=s)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,prevTime:this._prevAnimationFrameTime,deltaTime:n,canvas:this._canvasElement},bubbles:!1,composed:!0}))}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(t,n){(t!==this._resizeCanvasWidth||n!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=n,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,es))}updateCanvasSize(t=!0){let n=this.shadowRoot.host.getBoundingClientRect(),r=n.width,i=n.height,s=this._canvasElement,a=this._width,o=this._height,l=this.mode;if(l===Tn||l===bn)a=r,o=i;else if(l!==wn&&(r<a||i<o||l===gt||l==Mn)){let c=r/a,u=i/o;c<u?(a=r,o=o*c):(a=a*u,o=i)}if(a=Math.floor(a),o=Math.floor(o),typeof t=="undefined"&&(t=s.clientWidth!==a||s.clientHeight!==o),!t){this.delayCanvasResize(a,o);return}let h=Math.min(a/this._width,o/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${h}em`,t){l===Mn?(s.width=this._width,s.height=this._height):l!==Tn&&(s.width=a,s.height=o);let c=this._contentElement.style;c.width=`${a}px`,c.height=`${o}px`,(l===gt||l===bn)&&(this._width=a,this._height=o),this.dispatchEvent(new CustomEvent("resize",{detail:{width:a,height:o},bubbles:!1,composed:!0}))}}};Sn.define();function Te(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}var _t=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,n,r){throw new Error("Missing implementation.")}onStatus(t,n){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,n={}){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Oe=class extends _t{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let n=new Array;for(let r=0;r<t;++r)n.push(this.constructor.createAxisBindingState());this._state=n,this._value=0,this._delta=0}resize(t){let n=this._state,r=n.length,i;if(t<=r)i=n.slice(0,t);else{i=n;for(let s=r;s<t;++s)i.push(this.constructor.createAxisBindingState())}this._state=i,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let n=this._state,r=0,i=0,s=n.length;for(let a=0;a<s;++a){let o=n[a];r+=o.value*(o.inverted?-1:1),i+=o.delta,n[a].delta=0}this._value=r,this._delta=i,super.onPoll(t)}onUpdate(t,n,r){typeof n=="undefined"?this.onAxisChange(t,r):this.onAxisMove(t,n,r)}onStatus(t,n){this.onAxisStatus(t,n)}onBind(t,n={}){super.onBind(t,n);let{inverted:r=!1}=n,i=this._state;i[t].inverted=r}onAxisMove(t,n,r){let i=this._state[t];i.value=n,i.delta+=r}onAxisChange(t,n){let r=this._state[t];r.value+=n,r.delta+=n}onAxisStatus(t,n){let r=this._state[t],i=r.value;r.value=n,r.delta=n-i}},ts=241,Rn=254,ns=239,Ae=1,yt=2,Et=4,At=8,wt=16,je=class extends _t{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let n=this._state,r=n.length,i;t<=r?i=n.slice(0,t):(i=new Uint8Array(t),i.set(n)),this._state=i,super.resize(t)}getState(t){let n=this._state[t],r=n&wt?-1:1;return(n&Ae?1:0)*r}onPoll(t){let n=this._state,r=0,i=0,s=0,a=0,o=0,l=n.length;for(let h=0;h<l;++h){let c=n[h],u=c&Ae,f=c&wt;i|=u,s|=c&yt,a|=c&Et,o|=c&At,r+=(u?1:0)*(f?-1:1),n[h]&=ts}this._value=r,this._down=i!==0,this._pressed=s!==0,this._repeated=a!==0,this._released=o!==0,super.onPoll(t)}onUpdate(t,n,r){r>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,n){this.onButtonStatus(t,n!==0)}onBind(t,n={}){super.onBind(t,n);let{inverted:r=!1}=n,i=this._state;r?i[t]|=wt:i[t]&=ns}onButtonPressed(t){let n=this._state,r=n[t];r&Ae||(r|=yt,r|=Ae),r|=Et,n[t]=r}onButtonReleased(t){let n=this._state,r=n[t];r&Ae&&(r|=At,r&=Rn),n[t]=r}onButtonStatus(t,n){let r=this._state,i=r[t],s=Boolean(i&Ae);n?i|=Ae:i&=Rn,s&&!n&&(i|=At),!s&&n&&(i|=yt,i|=Et),r[t]=i}},$e=class{static parse(t){t=t.trim();let n=t.indexOf(".");if(n<0)throw new Error("Missing device separator for key code.");let r=t.substring(0,n);if(r.length<0)throw new Error("Missing device for key code.");let i=t.substring(n+1);if(i.length<0)throw new Error("Missing code for key code.");return new $e(r,i)}constructor(t,n){this.device=t,this.code=n}toString(){return`${this.device}.${this.code}`}};function rs(e,t){return new $e(e,t)}var Mt=class{get polling(){return this.ref?this.ref.polling:!1}get value(){return this.ref?this.ref.value:0}constructor(t){this.name=t,this.ref=null}register(t){throw new Error("Unsupported operation.")}getState(t){return this.ref?this.ref.getState(t):0}},S=class{static parse(t){t=t.trim();let n=t.indexOf(".");if(n<0)throw new Error("Missing device separator for key code.");let r=t.substring(0,n);if(r.length<0)throw new Error("Missing device for key code.");let i=t.substring(n+1);if(i.length<0)throw new Error("Missing code for key code.");return new S(r,i)}constructor(t,n){this.device=t,this.code=n}toString(){return`${this.device}.${this.code}`}};function Ln(e,t){return new S(e,t)}function is(e){return"device"in e&&"code"in e}var C="Keyboard",ae="Mouse",ss=new S(C,"KeyA"),as=new S(C,"KeyB"),os=new S(C,"KeyC"),ls=new S(C,"KeyD"),hs=new S(C,"KeyE"),cs=new S(C,"KeyF"),us=new S(C,"KeyG"),fs=new S(C,"KeyH"),ps=new S(C,"KeyI"),ds=new S(C,"KeyJ"),ms=new S(C,"KeyK"),vs=new S(C,"KeyL"),xs=new S(C,"KeyM"),gs=new S(C,"KeyN"),_s=new S(C,"KeyO"),ys=new S(C,"KeyP"),Es=new S(C,"KeyQ"),As=new S(C,"KeyR"),ws=new S(C,"KeyS"),Ms=new S(C,"KeyT"),bs=new S(C,"KeyU"),Ts=new S(C,"KeyV"),Ss=new S(C,"KeyW"),Rs=new S(C,"KeyX"),Ls=new S(C,"KeyY"),Is=new S(C,"KeyZ"),Cs=new S(C,"Digit0"),Os=new S(C,"Digit1"),Ns=new S(C,"Digit2"),Bs=new S(C,"Digit3"),Ds=new S(C,"Digit4"),Ps=new S(C,"Digit5"),Fs=new S(C,"Digit6"),Us=new S(C,"Digit7"),ks=new S(C,"Digit8"),zs=new S(C,"Digit9"),Hs=new S(C,"Minus"),Ks=new S(C,"Equal"),Ys=new S(C,"BracketLeft"),js=new S(C,"BracketRight"),$s=new S(C,"Semicolon"),Gs=new S(C,"Quote"),Vs=new S(C,"Backquote"),qs=new S(C,"Backslash"),Xs=new S(C,"Comma"),Ws=new S(C,"Period"),Zs=new S(C,"Slash"),Qs=new S(C,"Escape"),Js=new S(C,"Space"),ea=new S(C,"CapsLock"),ta=new S(C,"Backspace"),na=new S(C,"Delete"),ra=new S(C,"Tab"),ia=new S(C,"Enter"),sa=new S(C,"ArrowUp"),aa=new S(C,"ArrowDown"),oa=new S(C,"ArrowLeft"),la=new S(C,"ArrowRight"),ha=new S(ae,"Button0"),ca=new S(ae,"Button1"),ua=new S(ae,"Button2"),fa=new S(ae,"Button3"),pa=new S(ae,"Button4"),da=new S(ae,"PosX"),ma=new S(ae,"PosY"),va=new S(ae,"WheelX"),xa=new S(ae,"WheelY"),ga=new S(ae,"WheelZ"),In=Object.freeze({__proto__:null,from:Ln,isKeyCode:is,KEYBOARD:C,MOUSE:ae,KEY_A:ss,KEY_B:as,KEY_C:os,KEY_D:ls,KEY_E:hs,KEY_F:cs,KEY_G:us,KEY_H:fs,KEY_I:ps,KEY_J:ds,KEY_K:ms,KEY_L:vs,KEY_M:xs,KEY_N:gs,KEY_O:_s,KEY_P:ys,KEY_Q:Es,KEY_R:As,KEY_S:ws,KEY_T:Ms,KEY_U:bs,KEY_V:Ts,KEY_W:Ss,KEY_X:Rs,KEY_Y:Ls,KEY_Z:Is,DIGIT_0:Cs,DIGIT_1:Os,DIGIT_2:Ns,DIGIT_3:Bs,DIGIT_4:Ds,DIGIT_5:Ps,DIGIT_6:Fs,DIGIT_7:Us,DIGIT_8:ks,DIGIT_9:zs,MINUS:Hs,EQUAL:Ks,BRACKET_LEFT:Ys,BRACKET_RIGHT:js,SEMICOLON:$s,QUOTE:Gs,BACKQUOTE:Vs,BACKSLASH:qs,COMMA:Xs,PERIOD:Ws,SLASH:Zs,ESCAPE:Qs,SPACE:Js,CAPS_LOCK:ea,BACKSPACE:ta,DELETE:na,TAB:ra,ENTER:ia,ARROW_UP:sa,ARROW_DOWN:aa,ARROW_LEFT:oa,ARROW_RIGHT:la,MOUSE_BUTTON_0:ha,MOUSE_BUTTON_1:ca,MOUSE_BUTTON_2:ua,MOUSE_BUTTON_3:fa,MOUSE_BUTTON_4:pa,MOUSE_POS_X:da,MOUSE_POS_Y:ma,MOUSE_WHEEL_X:va,MOUSE_WHEEL_Y:xa,MOUSE_WHEEL_Z:ga});function Cn(e){Array.isArray(e)||(e=[e]);let t=[];for(let n of e){let r;try{r=S.parse(n)}catch(i){let s=_a(n).toUpperCase();if(!(s in In))throw new Error("Invalid key code string - "+i);r=In[s]}t.push(r)}return t}function _a(e){return e.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,function(t,n,r){return n+(r&&"_"+r)}).toLowerCase()}var ue=class extends Mt{static fromBind(t,n,r,i=void 0){return new ue(t,rs(n,r),i)}static fromString(t,...n){let r=Cn(n);return new ue(t,r)}get delta(){return this.ref?this.ref.delta:0}constructor(t,n,r=void 0){super(t);this.keyCodes=Array.isArray(n)?n:[n],this.opts=r}register(t){let n=this.name,r=this.opts;for(let i of this.keyCodes)t.bindAxis(n,i.device,i.code,r);return this.ref=t.getAxis(n),this}},te=class extends Mt{static fromBind(t,n,r,i=void 0){return new te(t,Ln(n,r),i)}static fromString(t,...n){let r=Cn(n);return new te(t,r)}get pressed(){return this.ref?this.ref.pressed:!1}get repeated(){return this.ref?this.ref.repeated:!1}get released(){return this.ref?this.ref.released:!1}get down(){return this.ref?this.ref.down:!1}constructor(t,n,r=void 0){super(t);this.keyCodes=Array.isArray(n)?n:[n],this.opts=r}register(t){let n=this.name,r=this.opts;for(let i of this.keyCodes)t.bindButton(n,i.device,i.code,r);return this.ref=t.getButton(n),this}};var bt=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,n){if(!n)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=n,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let n in t)t[n].length=0}addEventListener(t,n){let r=this.listeners;t in r?r[t].push(n):r[t]=[n]}removeEventListener(t,n){let r=this.listeners;if(t in r){let i=r[t],s=i.indexOf(n);s>=0&&i.splice(s,1)}}dispatchInputEvent(t){let n=0;for(let r of this.listeners.input)n|=r(t);return Boolean(n)}},On=class extends bt{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,n,r={}){super(t,n);let{ignoreRepeat:i=!0}=r;this.ignoreRepeat=i,this._eventObject={target:n,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),n.addEventListener("keydown",this.onKeyDown),n.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let n=this._eventObject;if(n.code=t.code,n.event="pressed",n.value=1,n.control=t.ctrlKey,n.shift=t.shiftKey,n.alt=t.altKey,this.dispatchInputEvent(n))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let n=this._eventObject;if(n.code=t.code,n.event="released",n.value=1,n.control=t.ctrlKey,n.shift=t.shiftKey,n.alt=t.altKey,this.dispatchInputEvent(n))return t.preventDefault(),t.stopPropagation(),!1}},Tt=10,St=100,Nn=class extends bt{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,n,r={}){super(t,n);let{eventsOnFocus:i=!0}=r;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(n),this._downHasFocus=!1,this._eventObject={target:n,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:n,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:n,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),n.addEventListener("mousedown",this.onMouseDown),n.addEventListener("contextmenu",this.onContextMenu),n.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let n=this._eventObject;if(n.code="Button"+t.button,n.event="pressed",n.value=1,n.control=t.ctrlKey,n.shift=t.shiftKey,n.alt=t.altKey,this.dispatchInputEvent(n)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let n,r,i;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:n=t.deltaX*Tt,r=t.deltaY*Tt,i=t.deltaZ*Tt;break;case WheelEvent.DOM_DELTA_PAGE:n=t.deltaX*St,r=t.deltaY*St,i=t.deltaZ*St;break;case WheelEvent.DOM_DELTA_PIXEL:default:n=t.deltaX,r=t.deltaY,i=t.deltaZ;break}let s=0,a=this._wheelObject;if(a.code="WheelX",a.movement=n,s|=this.dispatchInputEvent(a),a.code="WheelY",a.movement=r,s|=this.dispatchInputEvent(a),a.code="WheelZ",a.movement=i,s|=this.dispatchInputEvent(a),s)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let n=this._eventObject;if(n.code="Button"+t.button,n.event="released",n.value=1,n.control=t.ctrlKey,n.shift=t.shiftKey,n.alt=t.altKey,this.dispatchInputEvent(n))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let n=this.canvasTarget,{clientWidth:r,clientHeight:i}=n,s=n.getBoundingClientRect(),a=t.movementX/r,o=t.movementY/i,l=(t.clientX-s.left)/r,h=(t.clientY-s.top)/i,c=this._positionObject;c.code="PosX",c.value=l,c.movement=a,this.dispatchInputEvent(c),c.code="PosY",c.value=h,c.movement=o,this.dispatchInputEvent(c)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},ya=`<kbd>
    <span id="name"><slot></slot></span>
    <span id="value" class="hidden"></span>
</kbd>
`,Ea=`kbd {
    position: relative;
    display: inline-block;
    border-radius: 3px;
    border: 1px solid #888888;
    font-size: 0.85em;
    font-weight: 700;
    text-rendering: optimizeLegibility;
    line-height: 12px;
    height: 14px;
    padding: 2px 4px;
    color: #444444;
    background-color: #eeeeee;
    box-shadow: inset 0 -3px 0 #aaaaaa;
    overflow: hidden;
}

kbd:empty::after {
    content: "<?>";
    opacity: 0.6;
}

.disabled {
    opacity: 0.6;
    box-shadow: none;
    background-color: #aaaaaa;
}

.hidden {
    display: none;
}

#value {
    position: absolute;
    top: 0;
    bottom: 0;
    right: 0;
    font-size: 0.85em;
    padding: 0 4px;
    padding-top: 2px;
    color: #cccccc;
    background-color: #333333;
    box-shadow: inset 0 3px 0 #222222;
}
`,Rt=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=ya,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Ea,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,n,r){switch(t){case"name":this._name=r,this._nameElement.textContent=r;break;case"value":this._value=r,r!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=r,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=r!==null,this._kbdElement.classList.toggle("disabled",r!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};Rt.define();var Aa=`<table>
    <thead>
        <tr class="tableHeader">
            <th colspan=3>
                <span class="tableTitle">
                    <label id="title">
                        input-source
                    </label>
                    <span id="slotContainer">
                        <slot></slot>
                    </span>
                    <p>
                        <label for="poll">poll</label>
                        <output id="poll"></output>
                    </p>
                    <p>
                        <label for="focus">focus</label>
                        <output id="focus"></output>
                    </p>
                </span>
            </th>
        </tr>
        <tr class="colHeader">
            <th>name</th>
            <th>value</th>
            <th>key</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
`,wa=`:host {
    display: block;
}

table {
    border-collapse: collapse;
    font-family: monospace;
}

table,
th,
td {
    border: 1px solid #666666;
}

th,
td {
    padding: 5px 10px;
}

td {
    text-align: center;
}

thead th {
    padding: 0;
}

.colHeader > th {
    font-size: 0.8em;
    padding: 0 10px;
    letter-spacing: 3px;
    background-color: #aaaaaa;
    color: #666666;
}

tbody output {
    border-radius: 0.3em;
    padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
    opacity: 0.3;
}

tr:nth-child(2n) {
    background-color: #eeeeee;
}

.tableHeader {
    color: #666666;
}

.tableTitle {
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 4px;
}

#slotContainer {
    flex: 1;
}

p {
    display: inline;
    margin: 0;
    padding: 0;
    padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
    content: "\u2717";
    color: #ff0000;
}
`,Bn=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},Dn=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let n of this.bindings.getInputs())n.onPoll(t)}onInput(t){let{device:n,code:r,event:i,value:s,movement:a,control:o,shift:l,alt:h}=t,c=this.bindings.getBindings(n,r);switch(i){case"pressed":for(let{input:u,index:f}of c)u.onUpdate(f,1,1);break;case"released":for(let{input:u,index:f}of c)u.onUpdate(f,0,-1);break;case"move":for(let{input:u,index:f}of c)u.onUpdate(f,s,a);break;case"wheel":for(let{input:u,index:f}of c)u.onUpdate(f,void 0,a);break}return c.length>0}},Lt=class{constructor(t,n,r,i){this.device=t,this.code=n,this.input=r,this.index=i}},Pn=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,n,r,i={}){let s,a=this.inputMap;if(a.has(t)){let l=a.get(t),h=t.size;t.onBind(h,i),s=new Lt(n,r,t,h),l.push(s)}else{let l=[];a.set(t,l);let h=0;t.onBind(h,i),s=new Lt(n,r,t,h),l.push(s)}let o=this.bindingMap;n in o?r in o[n]?o[n][r].push(s):o[n][r]=[s]:o[n]={[r]:[s]}}unbind(t){let n=this.inputMap;if(n.has(t)){let r=this.bindingMap,i=n.get(t);for(let s of i){let{device:a,code:o}=s,l=r[a][o],h=l.indexOf(s);l.splice(h,1)}i.length=0,t.onUnbind(),n.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,n){let r=this.bindingMap;if(t in r){let i=r[t];if(n in i)return i[n]}return[]}},Fn=class{constructor(t,n={}){this.inputs={},this.devices=[new Nn("Mouse",t),new On("Keyboard",t)],this.bindings=new Pn,this.adapter=new Dn(this.bindings),this.autopoller=new Bn(this.adapter),this.eventTarget=t,this.anyButton=new je(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Oe(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let r of this.devices)r.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t=void 0){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let r in t)t[r].length=0;this.autopoller.running&&this.autopoller.stop();for(let r of this.devices)r.removeEventListener("input",this.onInput),r.destroy();let n=this.eventTarget;n.removeEventListener("focus",this.onEventTargetFocus),n.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let n=this.eventTarget;n.removeEventListener("focus",this.onEventTargetFocus),n.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let r of this.devices)r.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let n=this.autopoller.running,r=typeof t=="undefined"?!n:Boolean(t);r!==n&&(r?this.autopoller.start():this.autopoller.stop())}addEventListener(t,n){let r=this.listeners;t in r?r[t].push(n):r[t]=[n]}removeEventListener(t,n){let r=this.listeners;if(t in r){let i=r[t],s=i.indexOf(n);s>=0&&i.splice(s,1)}}dispatchEvent(t){let{type:n}=t,r=0;for(let i of this.listeners[n])r|=i(t);return Boolean(r)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let n=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return n}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){for(let n of t)n.register(this)}bindButton(t,n,r,i=void 0){let s;this.hasButton(t)?s=this.getButton(t):(s=new je(1),this.inputs[t]=s),this.bindings.bind(s,n,r,i),this.onBind()}bindAxis(t,n,r,i=void 0){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Oe(1),this.inputs[t]=s),this.bindings.bind(s,n,r,i),this.onBind()}bindAxisButtons(t,n,r,i){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Oe(2),this.inputs[t]=s),this.bindings.bind(s,n,i),this.bindings.bind(s,n,r,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let n=this.getButton(t);delete this.inputs[t],this.bindings.unbind(n),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let n=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(n),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof je}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Oe}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let n=this.inputs;for(let r of t)if(n[r].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let n=this.inputs;for(let r of t)if(n[r].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let n=this.inputs;for(let r of t)if(n[r].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let n=this.inputs;for(let r of t){let i=n[r];if(i.value)return i.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let n=this.inputs;for(let r of t){let i=n[r];if(i.delta)return i.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},Un=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Aa,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=wa,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let t=this;this._for="",this._eventTarget=t,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){this._context&&(this._context.removeEventListener("bind",this.onInputContextBind),this._context.removeEventListener("unbind",this.onInputContextUnbind),this._context.removeEventListener("blur",this.onInputContextBlur),this._context.removeEventListener("focus",this.onInputContextFocus),this._context.destroy(),this._context=null)}attributeChangedCallback(t,n,r){switch(t){case"for":{this._for=r;let i,s;r?(i=document.getElementById(r),s=`${i.tagName.toLowerCase()}#${r}`):(i=this,s="input-port"),this._eventTarget=i,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${s}`}break;case"autopoll":this._autopoll=r!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){this.updateTable()}onInputContextUnbind(){this.updateTable()}onInputContextFocus(){this._focusElement.innerHTML="\u2713"}onInputContextBlur(){this._focusElement.innerHTML=""}getContext(t="axisbutton",n=void 0){switch(t){case"axisbutton":return this._context||(this._context=new Fn(this._eventTarget,n),this._context.addEventListener("bind",this.onInputContextBind),this._context.addEventListener("unbind",this.onInputContextUnbind),this._context.addEventListener("blur",this.onInputContextBlur),this._context.addEventListener("focus",this.onInputContextFocus),this._autopoll&&this._context.toggleAutoPoll(!0)),this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,n=t.inputs,r=t.bindings,i={},s=[];for(let a of Object.keys(n)){let o=n[a],l=!0;for(let h of r.getBindingsByInput(o)){let c=Ma(`${o.constructor.name}.${a}`,`${h.device}.${h.code}`,0,l);s.push(c),l&&(i[a]=c.querySelector("output"),l=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let a of s)this._bodyElement.appendChild(a)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let n=this._context.inputs;for(let r of Object.keys(this._outputElements)){let i=this._outputElements[r],s=n[r].value;i.innerText=Number(s).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let n=this._outputElements[t];n.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let n=this._context.inputs;for(let r of Object.values(n))if(!r.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};Un.define();function Ma(e,t,n,r=!0){let i=document.createElement("tr");r&&i.classList.add("primary");{let s=document.createElement("td");s.textContent=e,s.classList.add("name"),i.appendChild(s)}{let s=document.createElement("td"),a=document.createElement("output");r?a.innerText=Number(n).toFixed(2):a.innerText="---",a.classList.add("value"),s.appendChild(a),i.appendChild(s)}{let s=document.createElement("td");s.classList.add("key");let a=new Rt;a.innerText=t,s.appendChild(a),i.appendChild(s)}return i}var Nu=Symbol("keyboardSource");var Bu=Symbol("mouseSource");var kn={},ba=function(e,t,n,r,i){var s=new Worker(kn[t]||(kn[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))));return s.onerror=function(a){return i(a.error,null)},s.onmessage=function(a){return i(null,a.data)},s.postMessage(n,r),s},J=Uint8Array,fe=Uint16Array,Ne=Uint32Array,It=new J([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ct=new J([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zn=new J([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Hn=function(e,t){for(var n=new fe(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var i=new Ne(n[30]),r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},Kn=Hn(It,2),Ot=Kn[0],Ta=Kn[1];Ot[28]=258,Ta[258]=28;var Yn=Hn(Ct,0),jn=Yn[0],Pu=Yn[1],Ge=new fe(32768);for(var $=0;$<32768;++$)me=($&43690)>>>1|($&21845)<<1,me=(me&52428)>>>2|(me&13107)<<2,me=(me&61680)>>>4|(me&3855)<<4,Ge[$]=((me&65280)>>>8|(me&255)<<8)>>>1;var me,Se=function(e,t,n){for(var r=e.length,i=0,s=new fe(t);i<r;++i)++s[e[i]-1];var a=new fe(t);for(i=0;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(n){o=new fe(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var h=i<<4|e[i],c=t-e[i],u=a[e[i]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)o[Ge[u]>>>l]=h}else for(o=new fe(r),i=0;i<r;++i)e[i]&&(o[i]=Ge[a[e[i]-1]++]>>>15-e[i]);return o},Be=new J(288);for(var $=0;$<144;++$)Be[$]=8;for(var $=144;$<256;++$)Be[$]=9;for(var $=256;$<280;++$)Be[$]=7;for(var $=280;$<288;++$)Be[$]=8;var $n=new J(32);for(var $=0;$<32;++$)$n[$]=5;var Gn=Se(Be,9,1);var Vn=Se($n,5,1),Ve=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},se=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},qe=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},qn=function(e){return(e/8|0)+(e&7&&1)},Xe=function(e,t,n){(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length);var r=new(e instanceof fe?fe:e instanceof Ne?Ne:J)(n-t);return r.set(e.subarray(t,n)),r},Xn=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new J(0);var i=!t||n,s=!n||n.i;n||(n={}),t||(t=new J(r*3));var a=function(F){var ye=t.length;if(F>ye){var He=new J(Math.max(ye*2,F));He.set(t),t=He}},o=n.f||0,l=n.p||0,h=n.b||0,c=n.l,u=n.d,f=n.m,d=n.n,m=r*8;do{if(!c){n.f=o=se(e,l,1);var v=se(e,l+1,3);if(l+=3,v)if(v==1)c=Gn,u=Vn,f=9,d=5;else if(v==2){var E=se(e,l,31)+257,M=se(e,l+10,15)+4,b=E+se(e,l+5,31)+1;l+=14;for(var R=new J(b),O=new J(19),A=0;A<M;++A)O[zn[A]]=se(e,l+A*3,7);l+=M*3;for(var w=Ve(O),D=(1<<w)-1,_=Se(O,w,1),A=0;A<b;){var B=_[se(e,l,D)];l+=B&15;var p=B>>>4;if(p<16)R[A++]=p;else{var N=0,P=0;for(p==16?(P=3+se(e,l,3),l+=2,N=R[A-1]):p==17?(P=3+se(e,l,7),l+=3):p==18&&(P=11+se(e,l,127),l+=7);P--;)R[A++]=N}}var x=R.subarray(0,E),g=R.subarray(E);f=Ve(x),d=Ve(g),c=Se(x,f,1),u=Se(g,d,1)}else throw"invalid block type";else{var p=qn(l)+4,y=e[p-4]|e[p-3]<<8,L=p+y;if(L>r){if(s)throw"unexpected EOF";break}i&&a(h+y),t.set(e.subarray(p,L),h),n.b=h+=y,n.p=l=L*8;continue}if(l>m){if(s)throw"unexpected EOF";break}}i&&a(h+131072);for(var Y=(1<<f)-1,z=(1<<d)-1,W=l;;W=l){var N=c[qe(e,l)&Y],Z=N>>>4;if(l+=N&15,l>m){if(s)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(Z<256)t[h++]=Z;else if(Z==256){W=l,c=null;break}else{var Q=Z-254;if(Z>264){var A=Z-257,he=It[A];Q=se(e,l,(1<<he)-1)+Ot[A],l+=he}var Ce=u[qe(e,l)&z],ge=Ce>>>4;if(!Ce)throw"invalid distance";l+=Ce&15;var g=jn[ge];if(ge>3){var he=Ct[ge];g+=qe(e,l)&(1<<he)-1,l+=he}if(l>m){if(s)throw"unexpected EOF";break}i&&a(h+131072);for(var ce=h+Q;h<ce;h+=4)t[h]=t[h-g],t[h+1]=t[h+1-g],t[h+2]=t[h+2-g],t[h+3]=t[h+3-g];h=ce}}n.l=c,n.p=W,n.b=h,c&&(o=1,n.m=f,n.d=u,n.n=d)}while(!o);return h==t.length?t:Xe(t,0,h)};var Sa=new J(0);var Ra=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},Wn=function(e,t,n){for(var r=e(),i=e.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<r.length;++a){var o=r[a],l=s[a];if(typeof o=="function"){t+=";"+l+"=";var h=o.toString();if(o.prototype)if(h.indexOf("[native code]")!=-1){var c=h.indexOf(" ",8)+1;t+=h.slice(c,h.indexOf("(",c))}else{t+=h;for(var u in o.prototype)t+=";"+l+".prototype."+u+"="+o.prototype[u].toString()}else t+=h}else n[l]=o}return[t,n]},We=[],La=function(e){var t=[];for(var n in e)(e[n]instanceof J||e[n]instanceof fe||e[n]instanceof Ne)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t},Ia=function(e,t,n,r){var i;if(!We[n]){for(var s="",a={},o=e.length-1,l=0;l<o;++l)i=Wn(e[l],s,a),s=i[0],a=i[1];We[n]=Wn(e[o],s,a)}var h=Ra({},We[n][1]);return ba(We[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,h,La(h),r)},Ca=function(){return[J,fe,Ne,It,Ct,zn,Ot,jn,Gn,Vn,Ge,Se,Ve,se,qe,qn,Xe,Xn,Nt,Zn,Qn]};var Zn=function(e){return postMessage(e,[e.buffer])},Qn=function(e){return e&&e.size&&new J(e.size)},Oa=function(e,t,n,r,i,s){var a=Ia(n,r,i,function(o,l){a.terminate(),s(o,l)});return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}};var pe=function(e,t){return e[t]|e[t+1]<<8},oe=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Bt=function(e,t){return oe(e,t)+oe(e,t+4)*4294967296};function Na(e,t,n){if(n||(n=t,t={}),typeof n!="function")throw"no callback";return Oa(e,t,[Ca],function(r){return Zn(Nt(r.data[0],Qn(r.data[1])))},1,n)}function Nt(e,t){return Xn(e,t)}var Fu=typeof TextEncoder!="undefined"&&new TextEncoder,Dt=typeof TextDecoder!="undefined"&&new TextDecoder,Ba=0;try{Dt.decode(Sa,{stream:!0}),Ba=1}catch(e){}var Da=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,Xe(e,n-1)];i?i==3?(r=((r&15)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?t+=String.fromCharCode((r&31)<<6|e[n++]&63):t+=String.fromCharCode((r&15)<<12|(e[n++]&63)<<6|e[n++]&63):t+=String.fromCharCode(r)}};function Pa(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}else{if(Dt)return Dt.decode(e);var i=Da(e),s=i[0],a=i[1];if(a.length)throw"invalid utf-8 data";return s}}var Fa=function(e,t){return t+30+pe(e,t+26)+pe(e,t+28)},ka=function(e,t,n){var r=pe(e,t+28),i=Pa(e.subarray(t+46,t+46+r),!(pe(e,t+8)&2048)),s=t+46+r,a=oe(e,t+20),o=n&&a==4294967295?Ua(e,s):[a,oe(e,t+24),oe(e,t+42)],l=o[0],h=o[1],c=o[2];return[pe(e,t+10),l,h,i,s+pe(e,t+30)+pe(e,t+32),c]},Ua=function(e,t){for(;pe(e,t)!=1;t+=4+pe(e,t+2));return[Bt(e,t+12),Bt(e,t+4),Bt(e,t+20)]};function Jn(e,t){if(typeof t!="function")throw"no callback";for(var n=[],r=function(){for(var f=0;f<n.length;++f)n[f]()},i={},s=e.length-22;oe(e,s)!=101010256;--s)if(!s||e.length-s>65558){t("invalid zip file",null);return}var a=pe(e,s+8);a||t(null,{});var o=a,l=oe(e,s+16),h=l==4294967295;if(h){if(s=oe(e,s-12),oe(e,s)!=101075792){t("invalid zip file",null);return}o=a=oe(e,s+32),l=oe(e,s+48)}for(var c=function(f){var d=ka(e,l,h),m=d[0],v=d[1],p=d[2],y=d[3],L=d[4],E=d[5],M=Fa(e,E);l=L;var b=function(O,A){O?(r(),t(O,null)):(i[y]=A,--a||t(null,i))};if(!m)b(null,Xe(e,M,M+v));else if(m==8){var R=e.subarray(M,M+v);if(v<32e4)try{b(null,Nt(R,new J(p)))}catch(O){b(O,null)}else n.push(Na(R,{size:p},b))}else b("unknown compression type "+m,null)},u=0;u<o;++u)c(u);return r}var Cr=qi(Ir()),Or=class{constructor(){this._buffers={}}clear(){this._buffers={}}put(t,n){this._buffers[t]=n}get(t){return this._buffers[t]}keys(){return Object.keys(this._buffers)}},wo="",Mo="",bo=5e3,it=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=wo,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Mo,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("asset-pack",it)}static get observedAttributes(){return["src"]}set src(t){this.setAttribute("src",t)}get src(){return this._src}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._src="",this._files=new Or,this._cache={},this._loading={},this._pipeline={},this.onLoad=this.onLoad.bind(this)}get files(){return this._files}async pipe(t,n){let r;if(typeof t=="string")r=t,r in this._pipeline||(t=(0,Cr.makeRe)(t));else if(t instanceof RegExp)r=t.source;else throw new Error("Filter must be either a RegExp or glob string.");let i;r in this._pipeline?i=this._pipeline[r]:(i=new Nr(t),this._pipeline[r]=i),i.addHandler(n),await Promise.all(Object.entries(this._cache).map(([s,a])=>i.matches(s)?n(a,s):null))}async cache(t,n,r={}){let{ephemeral:i}=r,s=this._cache[t],a=this._loading[t];this._cache[t]=n,await Promise.all(Object.values(this._pipeline).map(o=>o.matches(t)?o.process(t,n):null)),a&&(a.resolve(n),delete this._loading[n]),i&&this._cache[n]===n&&(s?this._cache[n]=s:delete this._cache[n])}async loadAsset(t,n=bo){let r=this._cache[t];if(r)return r;if(t in this._loading)return this._loading[t].promise;{let i=new Br(n);return this._loading[t]=i,i.promise}}clearAssets(){for(let t of Object.values(this._loading))t.reject(new Error("Stop loading to clear all assets."));this._loading={},this._cache={}}deleteAsset(t){t in this._loading&&(this._loading[t].reject(new Error("Stop loading to delete asset.")),delete this._loading[t]),t in this._cache&&delete this._cache[t]}getAsset(t){return this._cache[t]}hasAsset(t){let n=this._cache[t];return n||!1}connectedCallback(){To(this,"src")}attributeChangedCallback(t,n,r){switch(t){case"src":this._src=r,r&&fetch(r).then(this.onLoad).catch(i=>console.error(`Failed to load asset pack: ${i}`));break}}async onLoad(t){let n=await t.arrayBuffer();await new Promise((r,i)=>{Jn(new Uint8Array(n),(s,a)=>{if(s)i(s);else{let o=this._files;Promise.all(Object.entries(a).map(([l,h])=>(o.put(l,h),this.cache(l,h)))).then(()=>r()).catch(i)}})}),this.dispatchEvent(new CustomEvent("load",{composed:!0}))}};it.define();function To(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){let n=e[t];delete e[t],e[t]=n}}var Nr=class{constructor(t){this.filter=t,this.handlers=[]}matches(t){return this.filter.test(t)}async process(t,n){return Promise.all(this.handlers.map(r=>r(t,n)))}addHandler(t){this.handlers.push(t)}},Br=class{constructor(t){this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((n,r)=>{this._value?n(this._value):this._resolve=n,this._reason?r(this._reason):this._reject=r})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}};window.addEventListener("error",st,!0);window.addEventListener("unhandledrejection",st,!0);function st(e){typeof e=="object"?e instanceof PromiseRejectionEvent?st(e.reason):e instanceof ErrorEvent?st(e.error):e instanceof Error?window.alert(e.stack):window.alert(JSON.stringify(e)):window.alert(e)}var Xt={on(e,t,n=t){let r;if(this.__events.has(e)?r=this.__events.get(e):(r=new Map,this.__events.set(e,r)),!r.has(n))r.set(n,t);else throw new Error(`Found callback for event '${e}' with the same handle '${n}'.`);return this},off(e,t){if(this.__events.has(e)){let n=this.__events.get(e);if(n.has(t))n.delete(t);else throw new Error(`Unable to find callback for event '${e}' with handle '${t}'.`)}else throw new Error(`Unable to find event '${e}'.`);return this},once(e,t,n=t){let r=(...i)=>{this.off(e,n),t.apply(this.__context||this,i)};return this.on(e,r,n)},emit(e,...t){if(this.__events.has(e)){let n=[],r=Array.from(this.__events.get(e).values());for(let i of r){let s=i.apply(this.__context||this,t);s&&n.push(s)}return n}else return this.__events.set(e,new Map),[]}};function So(e=void 0){let t=Object.create(Xt);return t.__events=new Map,t.__context=e,t}function Ro(e,t=void 0){let n=Object.assign(e,Xt);return n.__events=new Map,n.__context=t,n}function Lo(e,t=void 0){let n=e.prototype;return Object.assign(n,Xt),n.__events=new Map,n.__context=t,n}var Dr={create:So,assign:Ro,mixin:Lo},Io=5,Co=4,Oo=3,No=2,Bo=1,Do=0,Xu={[Io]:Fe("#7F8C8D"),[Co]:Fe("#2ECC71"),[Oo]:Fe("#4794C8"),[No]:Fe("#F39C12"),[Bo]:Fe("#C0392B"),[Do]:[""]};function Fe(e){return[`background: ${e}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}var Wu=Symbol("level"),Zu=Symbol("domain");var Le=0,Po=class{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(let n of t)this._heap.push(n),this._shiftUp()}pop(){let t=this.peek(),n=Fo(this);return n>Le&&this._swap(Le,n),this._heap.pop(),this._shiftDown(),t}replace(t){let n=this.peek();return this._heap[Le]=t,this._shiftDown(),n}peek(){return this._heap[Le]}_compare(t,n){return this._comparator(this._heap[t],this._heap[n])}_swap(t,n){let r=this._heap[t];this._heap[t]=this._heap[n],this._heap[n]=r}_shiftUp(){let t=this._heap.length-1,n;for(;t>Le&&this._compare(t,n=Uo(t));)this._swap(t,n),t=n}_shiftDown(){let t=this._heap.length,n=Le,r,i=Pr(n),s=i<t,a=Fr(n),o=a<t;for(;s&&this._compare(i,n)||o&&this._compare(a,n);)r=o&&this._compare(a,i)?a:i,this._swap(n,r),n=r,i=Pr(n),s=i<t,a=Fr(n),o=a<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}};function Fo(e){return e._heap.length-1}function Uo(e){return(e+1>>>1)-1}function Pr(e){return(e<<1)+1}function Fr(e){return e+1<<1}var Qu=Math.PI/180,Ju=180/Math.PI;var Wt=class{constructor(t,n,r){this.display=t,this.inputs=n,this.assets=r,this.deltaTime=0,this.prevTime=0,this.now=0,this.events=Dr.create()}on(t,n){return this.events.on(t,n),this}off(t,n){return this.events.off(t,n),this}once(t,n){return this.events.once(t,n),this}emit(t,...n){this.events.emit(t,...n)}};async function Zt(e,t=void 0){if(typeof e=="string"){let o=await(await fetch(e)).arrayBuffer();if(typeof t=="undefined"){let l=e.lastIndexOf(".");if(l<0)throw new Error("Cannot load from url - unknown image type.");t="image/"+e.slice(l+1)}return Zt(o,t)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let n=e;typeof t=="undefined"&&(t="image/png");let r=new Blob([n],{type:t}),i=URL.createObjectURL(r),s=new Image;return new Promise((a,o)=>{s.addEventListener("load",()=>{a(s)}),s.addEventListener("error",l=>{o(l)}),s.src=i})}async function Qt(e){if(typeof e=="string"){let r=await(await fetch(e)).arrayBuffer();return Qt(r)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e;return ko(new TextDecoder().decode(t))}function ko(e){let t=[],n=[],r=[],i=[],s=[],a=[],o=/^#.*/g,l=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,c=/vt\s+(\S+)\s+(\S+)/g,u=/f\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*))(\s+(([^/\s]*)\/([^/\s]*)\/?([^/\s]*)))?/g,f=/f\s+([^/\s]+)\s+([^/\s]+)\s+([^/\s]+)/g,d=!1,m=null,v,p,y,L;for(e=e.replace(o,"");(m=l.exec(e))!=null;)v=Number.parseFloat(m[1]),p=Number.parseFloat(m[2]),y=Number.parseFloat(m[3]),t.push(v),t.push(p),t.push(y);for(;(m=h.exec(e))!=null;)v=Number.parseFloat(m[1]),p=Number.parseFloat(m[2]),y=Number.parseFloat(m[3]),r.push(v),r.push(p),r.push(y);for(;(m=c.exec(e))!=null;)v=Number.parseFloat(m[1]),p=Number.parseFloat(m[2]),n.push(v),n.push(p);for(;(m=u.exec(e))!=null;)v=Number.parseInt(m[2]),Number.isNaN(v)&&(v=1),p=Number.parseInt(m[6]),Number.isNaN(p)&&(p=1),y=Number.parseInt(m[10]),Number.isNaN(y)&&(y=1),i.push(v),i.push(p),i.push(y),v=Number.parseInt(m[4]),Number.isNaN(v)?(v=Number.parseInt(m[3]),p=Number.parseInt(m[7]),y=Number.parseInt(m[11]),a.push(v),a.push(p),a.push(y),s.push(1),s.push(1),s.push(1)):(p=Number.parseInt(m[8]),Number.isNaN(p)&&(p=1),y=Number.parseInt(m[12]),Number.isNaN(y)&&(y=1),a.push(v),a.push(p),a.push(y),v=Number.parseInt(m[3]),Number.isNaN(v)&&(v=1),p=Number.parseInt(m[7]),Number.isNaN(p)&&(p=1),y=Number.parseInt(m[11]),Number.isNaN(y)&&(y=1),s.push(v),s.push(p),s.push(y)),typeof m[13]!="undefined"&&(L=Number.parseInt(m[15]),Number.isNaN(L)&&(L=1),i.push(L),L=Number.parseInt(m[17]),Number.isNaN(L)?(L=Number.parseInt(m[16]),a.push(L),s.push(1)):(a.push(L),L=Number.parseInt(m[16]),s.push(L)),d=!0);for(;(m=f.exec(e))!=null;)v=Number.parseInt(m[2]),p=Number.parseInt(m[6]),y=Number.parseInt(m[10]),i.push(v),i.push(p),i.push(y),s.push(1),s.push(1),s.push(1),a.push(1),a.push(1),a.push(1),typeof m[13]!="undefined"&&(L=Number.parseInt(m[14]),i.push(L),s.push(1),a.push(1),d=!0);let E,M;M=i.length;let b=new Float32Array(M*3);for(let w=0;w<M;++w)E=i[w]-1,b[w*3+0]=t[E*3+0],b[w*3+1]=t[E*3+1],b[w*3+2]=t[E*3+2];M=s.length;let R=new Float32Array(M*2);for(let w=0;w<M;++w)E=s[w]-1,R[w*2+0]=n[E*2+0],R[w*2+1]=n[E*2+1];M=a.length;let O=new Float32Array(M*3);for(let w=0;w<M;++w)E=a[w]-1,O[w*3+0]=r[E*3+0],O[w*3+1]=r[E*3+1],O[w*3+2]=r[E*3+2];M=i.length;let A=new Uint16Array(M);for(let w=0;w<M;++w)A[w]=w;return d&&console.warn("WebGL does not support quad faces, only triangles."),{positions:b,texcoords:R,normals:O,indices:A}}async function Jt(e){if(typeof e=="string"){let s=await(await fetch(e)).arrayBuffer();return Jt(s)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e,n=new TextDecoder().decode(t),r={};for(let i of n.split(`
`)){if(i=i.trim(),i<=0||i.startsWith("#")||i.startsWith("//"))continue;let s=[],a=0,o=i.indexOf(" ");for(;o>=0;)s.push(i.substring(a,o)),a=o+1,o=i.indexOf(" ",a);s.push(i.substring(a));let l=s[0],h=Number.parseInt(s[1]),c=Number.parseInt(s[2]),u=Number.parseInt(s[3]),f=Number.parseInt(s[4]),d=s.length>=6?Number.parseInt(s[5]):1,m=s.length>=7?Number.parseInt(s[6]):d,v=s.length>=8?Number.parseInt(s[7]):d>m?Math.ceil(d/m):1;r[l]={u:h,v:c,w:u,h:f,frames:d,cols:m,rows:v,name:l}}return r}async function en(e,t){if(typeof e=="string"){let a=await(await fetch(e)).arrayBuffer();return en(a)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let n=e,r=new ArrayBuffer(n.byteLength);return new Uint8Array(r).set(n),await t.decodeAudioData(r)}async function tn(e){if(typeof e=="string"){let r=await(await fetch(e)).arrayBuffer();return tn(r)}else if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let t=e;return zo(new TextDecoder().decode(t))}var Ho=/(.+?)\s+(.*)/,Ko=/(.+)=(.+)/;function zo(e){let t=e.split(`
`),n={},r={},i={},s=[],a=[];for(let l of t){let h=Ho.exec(l);if(!h)continue;let[c,u,f]=h;switch(u){case"info":Ue(n,f);break;case"common":Ue(r,f);break;case"page":Ue(i,f);break;case"chars":break;case"char":let d={};Ue(d,f),"id"in d&&s.push(d);break;case"kerning":let m={};Ue(m,f),"first"in m&&a.push(m);break;default:}}let o={info:n,common:r,page:i,chars:s,kernings:a};return console.log(o),o}function Ue(e,t){let n=t.split(/\s+/);for(let r of n){let i=Ko.exec(r);if(!i)continue;let[s,a,o]=i,l=JSON.parse(`[${o}]`);l.length===1?e[a]=l[0]:e[a]=l}}var nn=Symbol("audioContext"),at=class{static getAudioContext(){if(nn in this)return this[nn];{let t=new AudioContext;return Yo(t),this[nn]=t,t}}constructor(t,n){this.audioContext=t,this.audioBuffer=n,this._playing=!1,this._started=!1,this._source=null,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}destroy(){this._source&&this._source.disconnect(),this._source=null,this._started=!1,this._playing=!1}onAudioSourceEnded(){this._playing=!1}play(t={}){let n=this.audioBuffer;if(!n)return;this._source&&this.destroy();let{pitch:r=void 0,gain:i=void 0,pan:s=void 0,loop:a=!1}=t,o=this.audioContext,l=o.createBufferSource();l.addEventListener("ended",this.onAudioSourceEnded),l.buffer=n,l.loop=a;let h=l;if(r&&(l.detune.value=r*100),i){let c=o.createGain();c.gain.value=i,h=h.connect(c)}if(s){let c=o.createStereoPanner();c.pan.value=s,h=h.connect(c)}h.connect(o.destination),l.start(),this._source=l,this._started=!0,this._playing=!0}pause(){this._source.stop(),this._playing=!1}isStarted(){return this._started}isPlaying(){return this._playing}isPaused(){return this._started&&!this._playing}};function Yo(e){let t=()=>{e.state==="suspended"&&e.resume()};document.addEventListener("click",t)}var cf=ue.fromString("cursorX","Mouse.PosX"),uf=ue.fromString("cursorY","Mouse.PosY"),ff=te.fromString("activate","Mouse.Button0"),pf=te.fromString("mark","Mouse.Button2"),df=te.fromString("restart","Keyboard.KeyR");var vf=Symbol("IslandRendererInfo");document.title="Archaea";document.title="Architect";var Go=te.fromString("moveLeft","Keyboard.KeyA"),Vo=te.fromString("moveRight","Keyboard.KeyD"),qo=te.fromString("moveUp","Keyboard.KeyW"),Xo=te.fromString("moveDown","Keyboard.KeyS"),ep=ue.fromString("cursorX","Mouse.PosX"),tp=ue.fromString("cursorY","Mouse.PosY"),Wo=te.fromString("shoot","Keyboard.Space");document.title="Bioform";var k=1e-6,K=typeof Float32Array!="undefined"?Float32Array:Array,re=Math.random;var gp=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Ur(){var e=new K(9);return K!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}var H={};be(H,{add:()=>Bl,adjoint:()=>al,clone:()=>el,copy:()=>tl,create:()=>Jo,determinant:()=>ol,equals:()=>Ul,exactEquals:()=>Fl,frob:()=>Nl,fromQuat:()=>bl,fromQuat2:()=>yl,fromRotation:()=>vl,fromRotationTranslation:()=>Hr,fromRotationTranslationScale:()=>wl,fromRotationTranslationScaleOrigin:()=>Ml,fromScaling:()=>ml,fromTranslation:()=>dl,fromValues:()=>nl,fromXRotation:()=>xl,fromYRotation:()=>gl,fromZRotation:()=>_l,frustum:()=>Tl,getRotation:()=>Al,getScaling:()=>Kr,getTranslation:()=>El,identity:()=>kr,invert:()=>sl,lookAt:()=>Il,mul:()=>kl,multiply:()=>zr,multiplyScalar:()=>Dl,multiplyScalarAndAdd:()=>Pl,ortho:()=>Ll,perspective:()=>Sl,perspectiveFromFieldOfView:()=>Rl,rotate:()=>cl,rotateX:()=>ul,rotateY:()=>fl,rotateZ:()=>pl,scale:()=>hl,set:()=>rl,str:()=>Ol,sub:()=>zl,subtract:()=>Yr,targetTo:()=>Cl,translate:()=>ll,transpose:()=>il});function Jo(){var e=new K(16);return K!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function el(e){var t=new K(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nl(e,t,n,r,i,s,a,o,l,h,c,u,f,d,m,v){var p=new K(16);return p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=i,p[5]=s,p[6]=a,p[7]=o,p[8]=l,p[9]=h,p[10]=c,p[11]=u,p[12]=f,p[13]=d,p[14]=m,p[15]=v,p}function rl(e,t,n,r,i,s,a,o,l,h,c,u,f,d,m,v,p){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=h,e[9]=c,e[10]=u,e[11]=f,e[12]=d,e[13]=m,e[14]=v,e[15]=p,e}function kr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function il(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function sl(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],d=t[11],m=t[12],v=t[13],p=t[14],y=t[15],L=n*o-r*a,E=n*l-i*a,M=n*h-s*a,b=r*l-i*o,R=r*h-s*o,O=i*h-s*l,A=c*v-u*m,w=c*p-f*m,D=c*y-d*m,_=u*p-f*v,B=u*y-d*v,N=f*y-d*p,P=L*N-E*B+M*_+b*D-R*w+O*A;return P?(P=1/P,e[0]=(o*N-l*B+h*_)*P,e[1]=(i*B-r*N-s*_)*P,e[2]=(v*O-p*R+y*b)*P,e[3]=(f*R-u*O-d*b)*P,e[4]=(l*D-a*N-h*w)*P,e[5]=(n*N-i*D+s*w)*P,e[6]=(p*M-m*O-y*E)*P,e[7]=(c*O-f*M+d*E)*P,e[8]=(a*B-o*D+h*A)*P,e[9]=(r*D-n*B-s*A)*P,e[10]=(m*R-v*M+y*L)*P,e[11]=(u*M-c*R-d*L)*P,e[12]=(o*w-a*_-l*A)*P,e[13]=(n*_-r*w+i*A)*P,e[14]=(v*E-m*b-p*L)*P,e[15]=(c*b-u*E+f*L)*P,e):null}function al(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],d=t[11],m=t[12],v=t[13],p=t[14],y=t[15];return e[0]=o*(f*y-d*p)-u*(l*y-h*p)+v*(l*d-h*f),e[1]=-(r*(f*y-d*p)-u*(i*y-s*p)+v*(i*d-s*f)),e[2]=r*(l*y-h*p)-o*(i*y-s*p)+v*(i*h-s*l),e[3]=-(r*(l*d-h*f)-o*(i*d-s*f)+u*(i*h-s*l)),e[4]=-(a*(f*y-d*p)-c*(l*y-h*p)+m*(l*d-h*f)),e[5]=n*(f*y-d*p)-c*(i*y-s*p)+m*(i*d-s*f),e[6]=-(n*(l*y-h*p)-a*(i*y-s*p)+m*(i*h-s*l)),e[7]=n*(l*d-h*f)-a*(i*d-s*f)+c*(i*h-s*l),e[8]=a*(u*y-d*v)-c*(o*y-h*v)+m*(o*d-h*u),e[9]=-(n*(u*y-d*v)-c*(r*y-s*v)+m*(r*d-s*u)),e[10]=n*(o*y-h*v)-a*(r*y-s*v)+m*(r*h-s*o),e[11]=-(n*(o*d-h*u)-a*(r*d-s*u)+c*(r*h-s*o)),e[12]=-(a*(u*p-f*v)-c*(o*p-l*v)+m*(o*f-l*u)),e[13]=n*(u*p-f*v)-c*(r*p-i*v)+m*(r*f-i*u),e[14]=-(n*(o*p-l*v)-a*(r*p-i*v)+m*(r*l-i*o)),e[15]=n*(o*f-l*u)-a*(r*f-i*u)+c*(r*l-i*o),e}function ol(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],f=e[11],d=e[12],m=e[13],v=e[14],p=e[15],y=t*a-n*s,L=t*o-r*s,E=t*l-i*s,M=n*o-r*a,b=n*l-i*a,R=r*l-i*o,O=h*m-c*d,A=h*v-u*d,w=h*p-f*d,D=c*v-u*m,_=c*p-f*m,B=u*p-f*v;return y*B-L*_+E*D+M*w-b*A+R*O}function zr(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],f=t[9],d=t[10],m=t[11],v=t[12],p=t[13],y=t[14],L=t[15],E=n[0],M=n[1],b=n[2],R=n[3];return e[0]=E*r+M*o+b*u+R*v,e[1]=E*i+M*l+b*f+R*p,e[2]=E*s+M*h+b*d+R*y,e[3]=E*a+M*c+b*m+R*L,E=n[4],M=n[5],b=n[6],R=n[7],e[4]=E*r+M*o+b*u+R*v,e[5]=E*i+M*l+b*f+R*p,e[6]=E*s+M*h+b*d+R*y,e[7]=E*a+M*c+b*m+R*L,E=n[8],M=n[9],b=n[10],R=n[11],e[8]=E*r+M*o+b*u+R*v,e[9]=E*i+M*l+b*f+R*p,e[10]=E*s+M*h+b*d+R*y,e[11]=E*a+M*c+b*m+R*L,E=n[12],M=n[13],b=n[14],R=n[15],e[12]=E*r+M*o+b*u+R*v,e[13]=E*i+M*l+b*f+R*p,e[14]=E*s+M*h+b*d+R*y,e[15]=E*a+M*c+b*m+R*L,e}function ll(e,t,n){var r=n[0],i=n[1],s=n[2],a,o,l,h,c,u,f,d,m,v,p,y;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(a=t[0],o=t[1],l=t[2],h=t[3],c=t[4],u=t[5],f=t[6],d=t[7],m=t[8],v=t[9],p=t[10],y=t[11],e[0]=a,e[1]=o,e[2]=l,e[3]=h,e[4]=c,e[5]=u,e[6]=f,e[7]=d,e[8]=m,e[9]=v,e[10]=p,e[11]=y,e[12]=a*r+c*i+m*s+t[12],e[13]=o*r+u*i+v*s+t[13],e[14]=l*r+f*i+p*s+t[14],e[15]=h*r+d*i+y*s+t[15]),e}function hl(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function cl(e,t,n,r){var i=r[0],s=r[1],a=r[2],o=Math.hypot(i,s,a),l,h,c,u,f,d,m,v,p,y,L,E,M,b,R,O,A,w,D,_,B,N,P,x;return o<k?null:(o=1/o,i*=o,s*=o,a*=o,l=Math.sin(n),h=Math.cos(n),c=1-h,u=t[0],f=t[1],d=t[2],m=t[3],v=t[4],p=t[5],y=t[6],L=t[7],E=t[8],M=t[9],b=t[10],R=t[11],O=i*i*c+h,A=s*i*c+a*l,w=a*i*c-s*l,D=i*s*c-a*l,_=s*s*c+h,B=a*s*c+i*l,N=i*a*c+s*l,P=s*a*c-i*l,x=a*a*c+h,e[0]=u*O+v*A+E*w,e[1]=f*O+p*A+M*w,e[2]=d*O+y*A+b*w,e[3]=m*O+L*A+R*w,e[4]=u*D+v*_+E*B,e[5]=f*D+p*_+M*B,e[6]=d*D+y*_+b*B,e[7]=m*D+L*_+R*B,e[8]=u*N+v*P+E*x,e[9]=f*N+p*P+M*x,e[10]=d*N+y*P+b*x,e[11]=m*N+L*P+R*x,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ul(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+h*r,e[5]=a*i+c*r,e[6]=o*i+u*r,e[7]=l*i+f*r,e[8]=h*i-s*r,e[9]=c*i-a*r,e[10]=u*i-o*r,e[11]=f*i-l*r,e}function fl(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],a=t[1],o=t[2],l=t[3],h=t[8],c=t[9],u=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-h*r,e[1]=a*i-c*r,e[2]=o*i-u*r,e[3]=l*i-f*r,e[8]=s*r+h*i,e[9]=a*r+c*i,e[10]=o*r+u*i,e[11]=l*r+f*i,e}function pl(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],a=t[1],o=t[2],l=t[3],h=t[4],c=t[5],u=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+h*r,e[1]=a*i+c*r,e[2]=o*i+u*r,e[3]=l*i+f*r,e[4]=h*i-s*r,e[5]=c*i-a*r,e[6]=u*i-o*r,e[7]=f*i-l*r,e}function dl(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ml(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vl(e,t,n){var r=n[0],i=n[1],s=n[2],a=Math.hypot(r,i,s),o,l,h;return a<k?null:(a=1/a,r*=a,i*=a,s*=a,o=Math.sin(t),l=Math.cos(t),h=1-l,e[0]=r*r*h+l,e[1]=i*r*h+s*o,e[2]=s*r*h-i*o,e[3]=0,e[4]=r*i*h-s*o,e[5]=i*i*h+l,e[6]=s*i*h+r*o,e[7]=0,e[8]=r*s*h+i*o,e[9]=i*s*h-r*o,e[10]=s*s*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function xl(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gl(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _l(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hr(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=r+r,l=i+i,h=s+s,c=r*o,u=r*l,f=r*h,d=i*l,m=i*h,v=s*h,p=a*o,y=a*l,L=a*h;return e[0]=1-(d+v),e[1]=u+L,e[2]=f-y,e[3]=0,e[4]=u-L,e[5]=1-(c+v),e[6]=m+p,e[7]=0,e[8]=f+y,e[9]=m-p,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function yl(e,t){var n=new K(3),r=-t[0],i=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=r*r+i*i+s*s+a*a;return u>0?(n[0]=(o*a+c*r+l*s-h*i)*2/u,n[1]=(l*a+c*i+h*r-o*s)*2/u,n[2]=(h*a+c*s+o*i-l*r)*2/u):(n[0]=(o*a+c*r+l*s-h*i)*2,n[1]=(l*a+c*i+h*r-o*s)*2,n[2]=(h*a+c*s+o*i-l*r)*2),Hr(e,t,n),e}function El(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Kr(e,t){var n=t[0],r=t[1],i=t[2],s=t[4],a=t[5],o=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(s,a,o),e[2]=Math.hypot(l,h,c),e}function Al(e,t){var n=new K(3);Kr(n,t);var r=1/n[0],i=1/n[1],s=1/n[2],a=t[0]*r,o=t[1]*i,l=t[2]*s,h=t[4]*r,c=t[5]*i,u=t[6]*s,f=t[8]*r,d=t[9]*i,m=t[10]*s,v=a+c+m,p=0;return v>0?(p=Math.sqrt(v+1)*2,e[3]=.25*p,e[0]=(u-d)/p,e[1]=(f-l)/p,e[2]=(o-h)/p):a>c&&a>m?(p=Math.sqrt(1+a-c-m)*2,e[3]=(u-d)/p,e[0]=.25*p,e[1]=(o+h)/p,e[2]=(f+l)/p):c>m?(p=Math.sqrt(1+c-a-m)*2,e[3]=(f-l)/p,e[0]=(o+h)/p,e[1]=.25*p,e[2]=(u+d)/p):(p=Math.sqrt(1+m-a-c)*2,e[3]=(o-h)/p,e[0]=(f+l)/p,e[1]=(u+d)/p,e[2]=.25*p),e}function wl(e,t,n,r){var i=t[0],s=t[1],a=t[2],o=t[3],l=i+i,h=s+s,c=a+a,u=i*l,f=i*h,d=i*c,m=s*h,v=s*c,p=a*c,y=o*l,L=o*h,E=o*c,M=r[0],b=r[1],R=r[2];return e[0]=(1-(m+p))*M,e[1]=(f+E)*M,e[2]=(d-L)*M,e[3]=0,e[4]=(f-E)*b,e[5]=(1-(u+p))*b,e[6]=(v+y)*b,e[7]=0,e[8]=(d+L)*R,e[9]=(v-y)*R,e[10]=(1-(u+m))*R,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Ml(e,t,n,r,i){var s=t[0],a=t[1],o=t[2],l=t[3],h=s+s,c=a+a,u=o+o,f=s*h,d=s*c,m=s*u,v=a*c,p=a*u,y=o*u,L=l*h,E=l*c,M=l*u,b=r[0],R=r[1],O=r[2],A=i[0],w=i[1],D=i[2],_=(1-(v+y))*b,B=(d+M)*b,N=(m-E)*b,P=(d-M)*R,x=(1-(f+y))*R,g=(p+L)*R,Y=(m+E)*O,z=(p-L)*O,W=(1-(f+v))*O;return e[0]=_,e[1]=B,e[2]=N,e[3]=0,e[4]=P,e[5]=x,e[6]=g,e[7]=0,e[8]=Y,e[9]=z,e[10]=W,e[11]=0,e[12]=n[0]+A-(_*A+P*w+Y*D),e[13]=n[1]+w-(B*A+x*w+z*D),e[14]=n[2]+D-(N*A+g*w+W*D),e[15]=1,e}function bl(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=n+n,o=r+r,l=i+i,h=n*a,c=r*a,u=r*o,f=i*a,d=i*o,m=i*l,v=s*a,p=s*o,y=s*l;return e[0]=1-u-m,e[1]=c+y,e[2]=f-p,e[3]=0,e[4]=c-y,e[5]=1-h-m,e[6]=d+v,e[7]=0,e[8]=f+p,e[9]=d-v,e[10]=1-h-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tl(e,t,n,r,i,s,a){var o=1/(n-t),l=1/(i-r),h=1/(s-a);return e[0]=s*2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*l,e[6]=0,e[7]=0,e[8]=(n+t)*o,e[9]=(i+r)*l,e[10]=(a+s)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*h,e[15]=0,e}function Sl(e,t,n,r,i){var s=1/Math.tan(t/2),a;return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(a=1/(r-i),e[10]=(i+r)*a,e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e}function Rl(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),h=2/(i+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((a-o)*l*.5),e[9]=(i-s)*h*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function Ll(e,t,n,r,i,s,a){var o=1/(t-n),l=1/(r-i),h=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+n)*o,e[13]=(i+r)*l,e[14]=(a+s)*h,e[15]=1,e}function Il(e,t,n,r){var i,s,a,o,l,h,c,u,f,d,m=t[0],v=t[1],p=t[2],y=r[0],L=r[1],E=r[2],M=n[0],b=n[1],R=n[2];return Math.abs(m-M)<k&&Math.abs(v-b)<k&&Math.abs(p-R)<k?kr(e):(c=m-M,u=v-b,f=p-R,d=1/Math.hypot(c,u,f),c*=d,u*=d,f*=d,i=L*f-E*u,s=E*c-y*f,a=y*u-L*c,d=Math.hypot(i,s,a),d?(d=1/d,i*=d,s*=d,a*=d):(i=0,s=0,a=0),o=u*a-f*s,l=f*i-c*a,h=c*s-u*i,d=Math.hypot(o,l,h),d?(d=1/d,o*=d,l*=d,h*=d):(o=0,l=0,h=0),e[0]=i,e[1]=o,e[2]=c,e[3]=0,e[4]=s,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=f,e[11]=0,e[12]=-(i*m+s*v+a*p),e[13]=-(o*m+l*v+h*p),e[14]=-(c*m+u*v+f*p),e[15]=1,e)}function Cl(e,t,n,r){var i=t[0],s=t[1],a=t[2],o=r[0],l=r[1],h=r[2],c=i-n[0],u=s-n[1],f=a-n[2],d=c*c+u*u+f*f;d>0&&(d=1/Math.sqrt(d),c*=d,u*=d,f*=d);var m=l*f-h*u,v=h*c-o*f,p=o*u-l*c;return d=m*m+v*v+p*p,d>0&&(d=1/Math.sqrt(d),m*=d,v*=d,p*=d),e[0]=m,e[1]=v,e[2]=p,e[3]=0,e[4]=u*p-f*v,e[5]=f*m-c*p,e[6]=c*v-u*m,e[7]=0,e[8]=c,e[9]=u,e[10]=f,e[11]=0,e[12]=i,e[13]=s,e[14]=a,e[15]=1,e}function Ol(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Nl(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Bl(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Yr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Dl(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Pl(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Fl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Ul(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],f=e[10],d=e[11],m=e[12],v=e[13],p=e[14],y=e[15],L=t[0],E=t[1],M=t[2],b=t[3],R=t[4],O=t[5],A=t[6],w=t[7],D=t[8],_=t[9],B=t[10],N=t[11],P=t[12],x=t[13],g=t[14],Y=t[15];return Math.abs(n-L)<=k*Math.max(1,Math.abs(n),Math.abs(L))&&Math.abs(r-E)<=k*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(i-M)<=k*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(s-b)<=k*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-R)<=k*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(o-O)<=k*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(l-A)<=k*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(h-w)<=k*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(c-D)<=k*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(u-_)<=k*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(f-B)<=k*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(d-N)<=k*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(m-P)<=k*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(v-x)<=k*Math.max(1,Math.abs(v),Math.abs(x))&&Math.abs(p-g)<=k*Math.max(1,Math.abs(p),Math.abs(g))&&Math.abs(y-Y)<=k*Math.max(1,Math.abs(y),Math.abs(Y))}var kl=zr,zl=Yr;var le={};be(le,{add:()=>oc,calculateW:()=>Wh,clone:()=>rc,conjugate:()=>ec,copy:()=>sc,create:()=>xn,dot:()=>ii,equals:()=>pc,exactEquals:()=>fc,exp:()=>ai,fromEuler:()=>tc,fromMat3:()=>hi,fromValues:()=>ic,getAngle:()=>Gh,getAxisAngle:()=>$h,identity:()=>jh,invert:()=>Jh,len:()=>cc,length:()=>ci,lerp:()=>hc,ln:()=>oi,mul:()=>lc,multiply:()=>si,normalize:()=>gn,pow:()=>Zh,random:()=>Qh,rotateX:()=>Vh,rotateY:()=>qh,rotateZ:()=>Xh,rotationTo:()=>dc,scale:()=>li,set:()=>ac,setAxes:()=>vc,setAxisAngle:()=>ri,slerp:()=>ft,sqlerp:()=>mc,sqrLen:()=>uc,squaredLength:()=>ui,str:()=>nc});var q={};be(q,{add:()=>jl,angle:()=>ch,bezier:()=>nh,ceil:()=>$l,clone:()=>Hl,copy:()=>Kl,create:()=>ot,cross:()=>ke,dist:()=>gh,distance:()=>qr,div:()=>xh,divide:()=>Vr,dot:()=>ht,equals:()=>dh,exactEquals:()=>ph,floor:()=>Gl,forEach:()=>Eh,fromValues:()=>lt,hermite:()=>th,inverse:()=>Jl,len:()=>sn,length:()=>jr,lerp:()=>eh,max:()=>ql,min:()=>Vl,mul:()=>vh,multiply:()=>Gr,negate:()=>Ql,normalize:()=>rn,random:()=>rh,rotateX:()=>oh,rotateY:()=>lh,rotateZ:()=>hh,round:()=>Xl,scale:()=>Wl,scaleAndAdd:()=>Zl,set:()=>Yl,sqrDist:()=>_h,sqrLen:()=>yh,squaredDistance:()=>Xr,squaredLength:()=>Wr,str:()=>fh,sub:()=>mh,subtract:()=>$r,transformMat3:()=>sh,transformMat4:()=>ih,transformQuat:()=>ah,zero:()=>uh});function ot(){var e=new K(3);return K!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Hl(e){var t=new K(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function jr(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function lt(e,t,n){var r=new K(3);return r[0]=e,r[1]=t,r[2]=n,r}function Kl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Yl(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function jl(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function $r(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Gr(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Vr(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function $l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Gl(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Vl(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ql(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Xl(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Wl(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Zl(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function qr(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function Xr(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function Wr(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Ql(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Jl(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function rn(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function ht(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ke(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[0],o=n[1],l=n[2];return e[0]=i*l-s*o,e[1]=s*a-r*l,e[2]=r*o-i*a,e}function eh(e,t,n,r){var i=t[0],s=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=a+r*(n[2]-a),e}function th(e,t,n,r,i,s){var a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,h=a*(s-1),c=a*(3-2*s);return e[0]=t[0]*o+n[0]*l+r[0]*h+i[0]*c,e[1]=t[1]*o+n[1]*l+r[1]*h+i[1]*c,e[2]=t[2]*o+n[2]*l+r[2]*h+i[2]*c,e}function nh(e,t,n,r,i,s){var a=1-s,o=a*a,l=s*s,h=o*a,c=3*s*o,u=3*l*a,f=l*s;return e[0]=t[0]*h+n[0]*c+r[0]*u+i[0]*f,e[1]=t[1]*h+n[1]*c+r[1]*u+i[1]*f,e[2]=t[2]*h+n[2]*c+r[2]*u+i[2]*f,e}function rh(e,t){t=t||1;var n=re()*2*Math.PI,r=re()*2-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function ih(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[3]*r+n[7]*i+n[11]*s+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/a,e}function sh(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e}function ah(e,t,n){var r=n[0],i=n[1],s=n[2],a=n[3],o=t[0],l=t[1],h=t[2],c=i*h-s*l,u=s*o-r*h,f=r*l-i*o,d=i*f-s*u,m=s*c-r*f,v=r*u-i*c,p=a*2;return c*=p,u*=p,f*=p,d*=2,m*=2,v*=2,e[0]=o+c+d,e[1]=l+u+m,e[2]=h+f+v,e}function oh(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function lh(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function hh(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function ch(e,t){var n=e[0],r=e[1],i=e[2],s=t[0],a=t[1],o=t[2],l=Math.sqrt(n*n+r*r+i*i),h=Math.sqrt(s*s+a*a+o*o),c=l*h,u=c&&ht(e,t)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function uh(e){return e[0]=0,e[1]=0,e[2]=0,e}function fh(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function ph(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function dh(e,t){var n=e[0],r=e[1],i=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(n-s)<=k*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=k*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=k*Math.max(1,Math.abs(i),Math.abs(o))}var mh=$r,vh=Gr,xh=Vr,gh=qr,_h=Xr,sn=jr,yh=Wr,Eh=function(){var e=ot();return function(t,n,r,i,s,a){var o,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,t.length):l=t.length,o=r;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();var we={};be(we,{add:()=>cn,ceil:()=>Ah,clone:()=>an,copy:()=>ln,create:()=>Zr,cross:()=>Ih,dist:()=>kh,distance:()=>ti,div:()=>Uh,divide:()=>ei,dot:()=>pn,equals:()=>vn,exactEquals:()=>mn,floor:()=>wh,forEach:()=>Yh,fromValues:()=>on,inverse:()=>Lh,len:()=>Hh,length:()=>ct,lerp:()=>dn,max:()=>bh,min:()=>Mh,mul:()=>Fh,multiply:()=>Jr,negate:()=>Rh,normalize:()=>fn,random:()=>Ch,round:()=>Th,scale:()=>un,scaleAndAdd:()=>Sh,set:()=>hn,sqrDist:()=>zh,sqrLen:()=>Kh,squaredDistance:()=>ni,squaredLength:()=>ut,str:()=>Dh,sub:()=>Ph,subtract:()=>Qr,transformMat4:()=>Oh,transformQuat:()=>Nh,zero:()=>Bh});function Zr(){var e=new K(4);return K!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function an(e){var t=new K(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function on(e,t,n,r){var i=new K(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function ln(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function hn(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function cn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Qr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Jr(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function ei(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Ah(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function wh(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Mh(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function bh(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function Th(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function un(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Sh(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function ti(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.hypot(n,r,i,s)}function ni(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s}function ct(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.hypot(t,n,r,i)}function ut(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function Rh(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Lh(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function fn(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=n*n+r*r+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=s*a,e}function pn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ih(e,t,n,r){var i=n[0]*r[1]-n[1]*r[0],s=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],o=n[1]*r[2]-n[2]*r[1],l=n[1]*r[3]-n[3]*r[1],h=n[2]*r[3]-n[3]*r[2],c=t[0],u=t[1],f=t[2],d=t[3];return e[0]=u*h-f*l+d*o,e[1]=-(c*h)+f*a-d*s,e[2]=c*l-u*a+d*i,e[3]=-(c*o)+u*s-f*i,e}function dn(e,t,n,r){var i=t[0],s=t[1],a=t[2],o=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=a+r*(n[2]-a),e[3]=o+r*(n[3]-o),e}function Ch(e,t){t=t||1;var n,r,i,s,a,o;do n=re()*2-1,r=re()*2-1,a=n*n+r*r;while(a>=1);do i=re()*2-1,s=re()*2-1,o=i*i+s*s;while(o>=1);var l=Math.sqrt((1-a)/o);return e[0]=t*n,e[1]=t*r,e[2]=t*i*l,e[3]=t*s*l,e}function Oh(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*a,e}function Nh(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[0],o=n[1],l=n[2],h=n[3],c=h*r+o*s-l*i,u=h*i+l*r-a*s,f=h*s+a*i-o*r,d=-a*r-o*i-l*s;return e[0]=c*h+d*-a+u*-l-f*-o,e[1]=u*h+d*-o+f*-a-c*-l,e[2]=f*h+d*-l+c*-o-u*-a,e[3]=t[3],e}function Bh(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Dh(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vn(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],a=t[0],o=t[1],l=t[2],h=t[3];return Math.abs(n-a)<=k*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=k*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-l)<=k*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-h)<=k*Math.max(1,Math.abs(s),Math.abs(h))}var Ph=Qr,Fh=Jr,Uh=ei,kh=ti,zh=ni,Hh=ct,Kh=ut,Yh=function(){var e=Zr();return function(t,n,r,i,s,a){var o,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,t.length):l=t.length,o=r;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function xn(){var e=new K(4);return K!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function jh(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ri(e,t,n){n=n*.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function $h(e,t){var n=Math.acos(t[3])*2,r=Math.sin(n/2);return r>k?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Gh(e,t){var n=ii(e,t);return Math.acos(2*n*n-1)}function si(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=n[0],l=n[1],h=n[2],c=n[3];return e[0]=r*c+a*o+i*h-s*l,e[1]=i*c+a*l+s*o-r*h,e[2]=s*c+a*h+r*l-i*o,e[3]=a*c-r*o-i*l-s*h,e}function Vh(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*o,e[1]=i*l+s*o,e[2]=s*l-i*o,e[3]=a*l-r*o,e}function qh(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=r*l-s*o,e[1]=i*l+a*o,e[2]=s*l+r*o,e[3]=a*l-i*o,e}function Xh(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*o,e[1]=i*l-r*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e}function Wh(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e}function ai(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=Math.sqrt(n*n+r*r+i*i),o=Math.exp(s),l=a>0?o*Math.sin(a)/a:0;return e[0]=n*l,e[1]=r*l,e[2]=i*l,e[3]=o*Math.cos(a),e}function oi(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=Math.sqrt(n*n+r*r+i*i),o=a>0?Math.atan2(a,s)/a:0;return e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=.5*Math.log(n*n+r*r+i*i+s*s),e}function Zh(e,t,n){return oi(e,t),li(e,e,n),ai(e,e),e}function ft(e,t,n,r){var i=t[0],s=t[1],a=t[2],o=t[3],l=n[0],h=n[1],c=n[2],u=n[3],f,d,m,v,p;return d=i*l+s*h+a*c+o*u,d<0&&(d=-d,l=-l,h=-h,c=-c,u=-u),1-d>k?(f=Math.acos(d),m=Math.sin(f),v=Math.sin((1-r)*f)/m,p=Math.sin(r*f)/m):(v=1-r,p=r),e[0]=v*i+p*l,e[1]=v*s+p*h,e[2]=v*a+p*c,e[3]=v*o+p*u,e}function Qh(e){var t=re(),n=re(),r=re(),i=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=s*Math.sin(2*Math.PI*r),e[3]=s*Math.cos(2*Math.PI*r),e}function Jh(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=n*n+r*r+i*i+s*s,o=a?1/a:0;return e[0]=-n*o,e[1]=-r*o,e[2]=-i*o,e[3]=s*o,e}function ec(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function hi(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[s*3+s]-t[a*3+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[s*3+a]-t[a*3+s])*r,e[s]=(t[s*3+i]+t[i*3+s])*r,e[a]=(t[a*3+i]+t[i*3+a])*r}return e}function tc(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var s=Math.sin(t),a=Math.cos(t),o=Math.sin(n),l=Math.cos(n),h=Math.sin(r),c=Math.cos(r);return e[0]=s*l*c-a*o*h,e[1]=a*o*c+s*l*h,e[2]=a*l*h-s*o*c,e[3]=a*l*c+s*o*h,e}function nc(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var rc=an,ic=on,sc=ln,ac=hn,oc=cn,lc=si,li=un,ii=pn,hc=dn,ci=ct,cc=ci,ui=ut,uc=ui,gn=fn,fc=mn,pc=vn,dc=function(){var e=ot(),t=lt(1,0,0),n=lt(0,1,0);return function(r,i,s){var a=ht(i,s);return a<-.999999?(ke(e,t,i),sn(e)<1e-6&&ke(e,n,i),rn(e,e),ri(r,e,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ke(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+a,gn(r,r))}}(),mc=function(){var e=xn(),t=xn();return function(n,r,i,s,a,o){return ft(e,r,a,o),ft(t,i,s,o),ft(n,e,t,2*o*(1-o)),n}}(),vc=function(){var e=Ur();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],gn(t,hi(t,e))}}();var Ie={};be(Ie,{add:()=>Ec,angle:()=>Hc,ceil:()=>Ac,clone:()=>xc,copy:()=>_c,create:()=>fi,cross:()=>Nc,dist:()=>Wc,distance:()=>vi,div:()=>Xc,divide:()=>mi,dot:()=>Oc,equals:()=>$c,exactEquals:()=>jc,floor:()=>wc,forEach:()=>Jc,fromValues:()=>gc,inverse:()=>Ic,len:()=>Gc,length:()=>gi,lerp:()=>Bc,max:()=>bc,min:()=>Mc,mul:()=>qc,multiply:()=>di,negate:()=>Lc,normalize:()=>Cc,random:()=>Dc,rotate:()=>zc,round:()=>Tc,scale:()=>Sc,scaleAndAdd:()=>Rc,set:()=>yc,sqrDist:()=>Zc,sqrLen:()=>Qc,squaredDistance:()=>xi,squaredLength:()=>_i,str:()=>Yc,sub:()=>Vc,subtract:()=>pi,transformMat2:()=>Pc,transformMat2d:()=>Fc,transformMat3:()=>Uc,transformMat4:()=>kc,zero:()=>Kc});function fi(){var e=new K(2);return K!=Float32Array&&(e[0]=0,e[1]=0),e}function xc(e){var t=new K(2);return t[0]=e[0],t[1]=e[1],t}function gc(e,t){var n=new K(2);return n[0]=e,n[1]=t,n}function _c(e,t){return e[0]=t[0],e[1]=t[1],e}function yc(e,t,n){return e[0]=t,e[1]=n,e}function Ec(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function pi(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function di(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function mi(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function Ac(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function wc(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Mc(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function bc(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function Tc(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Sc(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function Rc(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function vi(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function xi(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function gi(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function _i(e){var t=e[0],n=e[1];return t*t+n*n}function Lc(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Ic(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Cc(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Oc(e,t){return e[0]*t[0]+e[1]*t[1]}function Nc(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function Bc(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e}function Dc(e,t){t=t||1;var n=re()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Pc(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}function Fc(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e}function Uc(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}function kc(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}function zc(e,t,n,r){var i=t[0]-n[0],s=t[1]-n[1],a=Math.sin(r),o=Math.cos(r);return e[0]=i*o-s*a+n[0],e[1]=i*a+s*o+n[1],e}function Hc(e,t){var n=e[0],r=e[1],i=t[0],s=t[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+s*s),o=a&&(n*i+r*s)/a;return Math.acos(Math.min(Math.max(o,-1),1))}function Kc(e){return e[0]=0,e[1]=0,e}function Yc(e){return"vec2("+e[0]+", "+e[1]+")"}function jc(e,t){return e[0]===t[0]&&e[1]===t[1]}function $c(e,t){var n=e[0],r=e[1],i=t[0],s=t[1];return Math.abs(n-i)<=k*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=k*Math.max(1,Math.abs(r),Math.abs(s))}var Gc=gi,Vc=pi,qc=di,Xc=mi,Wc=vi,Zc=xi,Qc=_i,Jc=function(){var e=fi();return function(t,n,r,i,s,a){var o,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,t.length):l=t.length,o=r;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],s(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}}();var Op=q.fromValues(0,1,0);var yi=class{constructor(t,n){this.projectionMatrix=t,this.viewMatrix=n}resize(t=void 0,n=void 0){return this}},Np=Math.PI/3;var pt=class extends yi{constructor(t=void 0,n=void 0,r=void 0,i=void 0,s=-1e3,a=1e3){super(H.create(),H.create());this.orthoBounds={left:typeof t=="undefined"?void 0:Number(t),top:typeof n=="undefined"?void 0:Number(n),right:typeof r=="undefined"?void 0:Number(r),bottom:typeof i=="undefined"?void 0:Number(i)},this.clippingPlane={near:Number(s),far:Number(a)}}resize(t=void 0,n=void 0){let{near:r,far:i}=this.clippingPlane,{left:s,top:a,right:o,bottom:l}=this.orthoBounds,h=this.projectionMatrix,c=typeof t!="undefined",u=typeof s!="undefined";if(c)if(u){let f=t/n;H.ortho(h,s*f,o*f,l,a,r,i)}else H.ortho(h,0,t,n,0,r,i);else u?H.ortho(h,s,o,l,a,r,i):H.ortho(h,-1,1,1,-1,-1,1);return this}},Bp=Math.PI/180;function _n(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext}var yn=class{constructor(t,n){this.gl=t,this.target=n}data(t,n=void 0){let r=this.gl,i=this.target;if(typeof t=="number")r.bufferData(i,t,n||r.STATIC_DRAW);else{if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");r.bufferData(i,t,n||r.STATIC_DRAW)}return this}subData(t,n=0,r=void 0,i=void 0){let s=this.gl,a=this.target;if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");if(r)if(_n(s))s.bufferSubData(a,n,t,r,i);else{let o=i?t.subarray(r,r+i):t.subarray(r);s.bufferSubData(a,n,o)}else s.bufferSubData(a,n,t);return this}},Ei=class{constructor(t,n,r=void 0){this.dataContext=new yn(t,n),this.handle=r||t.createBuffer(),t.bindBuffer(n,this.handle)}get gl(){return this.dataContext.gl}get target(){return this.dataContext.target}data(t,n=void 0){return this.dataContext.data(t,n),this}subData(t,n=0,r=void 0,i=void 0){return this.dataContext.subData(t,n,r,i),this}build(){return this.handle}},Ai=class{constructor(t,n,r,i){this.gl=t,this.target=n,this.handle=i,this.type=r,this.bindContext=new yn(t,this.target)}bind(t){return t.bindBuffer(this.target,this.handle),this.bindContext.gl=t,this.bindContext}};function eu(e,t,n){let r=wi(e,t);return new r(n)}function tu(e,t,n,r=void 0){let i=e.createBuffer();if(e.bindBuffer(t,i),!ArrayBuffer.isView(n))throw new Error("Source data must be a typed array.");return e.bufferData(t,n,r||e.STATIC_DRAW),i}function wi(e,t){switch(t){case e.BYTE:return Int8Array;case e.UNSIGNED_BYTE:return Uint8Array;case e.SHORT:return Int16Array;case e.UNSIGNED_SHORT:return Uint16Array;case e.INT:return Int32Array;case e.UNSIGNED_INT:return Uint32Array;case e.FLOAT:return Float32Array;default:throw new Error("Cannot find valid typed array for buffer type.")}}function En(e,t){switch(t){case Int8Array:return e.BYTE;case Uint8Array:return e.UNSIGNED_BYTE;case Int16Array:return e.SHORT;case Uint16Array:return e.UNSIGNED_SHORT;case Int32Array:return e.INT;case Uint32Array:return e.UNSIGNED_INT;case Float32Array:return e.FLOAT;default:throw new Error("Cannot find valid buffer type for typed array.")}}function nu(e,t,n){return e.bindBuffer(t,n),e.getBufferParameter(t,e.BUFFER_USAGE)}var dt=Object.freeze({__proto__:null,createBufferSource:eu,createBuffer:tu,getBufferTypedArray:wi,getTypedArrayBufferType:En,getBufferUsage:nu}),ze=class{constructor(t,n,r=void 0){this.bufferBuilder=new Ei(t,n,r),this.bufferType=t.FLOAT}get gl(){return this.bufferBuilder.gl}get handle(){return this.bufferBuilder.handle}get target(){return this.bufferBuilder.target}data(t,n=void 0){if(this.bufferBuilder.data(t,n),typeof t!="number"){let r=t.constructor;this.bufferType=En(this.gl,r)}return this}subData(t,n=void 0,r=void 0,i=void 0){this.bufferBuilder.subData(t,n,r,i);let s=t.constructor;return this.bufferType=En(this.gl,s),this}build(){let t=this.bufferBuilder.build(),n=this.gl,r=this.target,i=this.bufferType;return new Ai(n,r,i,t)}};function ru(e,t){switch(t){case e.FLOAT:return e.uniform1f;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1i;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1i;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return Mi;case e.FLOAT_MAT3:return bi;case e.FLOAT_MAT4:return Ti;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1i}if(_n(e))switch(t){case e.UNSIGNED_INT:return e.uniform1ui;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return Si;case e.FLOAT_MAT2x4:return Ri;case e.FLOAT_MAT3x2:return Li;case e.FLOAT_MAT3x4:return Ii;case e.FLOAT_MAT4x2:return Ci;case e.FLOAT_MAT4x3:return Oi;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1i}throw new Error("Cannot find uniform function for gl enum.")}function iu(e,t){switch(t){case e.FLOAT:return e.uniform1fv;case e.FLOAT_VEC2:return e.uniform2fv;case e.FLOAT_VEC3:return e.uniform3fv;case e.FLOAT_VEC4:return e.uniform4fv;case e.INT:return e.uniform1iv;case e.INT_VEC2:return e.uniform2iv;case e.INT_VEC3:return e.uniform3iv;case e.INT_VEC4:return e.uniform4iv;case e.BOOL:return e.uniform1iv;case e.BOOL_VEC2:return e.uniform2iv;case e.BOOL_VEC3:return e.uniform3iv;case e.BOOL_VEC4:return e.uniform4iv;case e.FLOAT_MAT2:return Mi;case e.FLOAT_MAT3:return bi;case e.FLOAT_MAT4:return Ti;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return e.uniform1iv}if(_n(e))switch(t){case e.UNSIGNED_INT:return e.uniform1uiv;case e.UNSIGNED_INT_VEC2:return e.uniform2uiv;case e.UNSIGNED_INT_VEC3:return e.uniform3uiv;case e.UNSIGNED_INT_VEC4:return e.uniform4uiv;case e.FLOAT_MAT2x3:return Si;case e.FLOAT_MAT2x4:return Ri;case e.FLOAT_MAT3x2:return Li;case e.FLOAT_MAT3x4:return Ii;case e.FLOAT_MAT4x2:return Ci;case e.FLOAT_MAT4x3:return Oi;case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return e.uniform1iv}throw new Error("Cannot find array uniform function for gl enum.")}function Mi(e,t){this.uniformMatrix2fv(e,!1,t)}function bi(e,t){this.uniformMatrix3fv(e,!1,t)}function Ti(e,t){this.uniformMatrix4fv(e,!1,t)}function Si(e,t){this.uniformMatrix2x3fv(e,!1,t)}function Ri(e,t){this.uniformMatrix2x4fv(e,!1,t)}function Li(e,t){this.uniformMatrix3x2fv(e,!1,t)}function Ii(e,t){this.uniformMatrix3x4fv(e,!1,t)}function Ci(e,t){this.uniformMatrix4x2fv(e,!1,t)}function Oi(e,t){this.uniformMatrix4x3fv(e,!1,t)}function su(e,t){let n=[],r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){let s=e.getActiveUniform(t,i);if(!s)break;n.push(s)}return n}function au(e,t){let n=[],r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;++i){let s=e.getActiveAttrib(t,i);!s||n.push(s)}return n}function ou(e,t){let n={},r=su(e,t);for(let i of r){let s=i.name,a=i.size,o=i.type,l=e.getUniformLocation(t,s),h;a<=1?h=ru(e,o):h=iu(e,o),n[s]={type:o,length:a,location:l,set:h}}return n}function lu(e,t){switch(t){case e.FLOAT:return 1;case e.FLOAT_VEC2:return 2;case e.FLOAT_VEC3:return 3;case e.FLOAT_VEC4:return 4;case e.FLOAT_MAT2:return 4;case e.FLOAT_MAT3:return 9;case e.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function hu(e,t){let n={},r=au(e,t);for(let i of r){let s=i.name,a=i.size,o=i.type,l=e.getAttribLocation(t,s),h=lu(e,o);n[s]={type:o,length:a,location:l,size:h}}return n}function cu(e,t,n){let r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||(console.error(e.getShaderInfoLog(r)+`
Failed to compile shader:
${n}`),e.deleteShader(r)),r}function uu(e,t,n){for(let i of n)e.attachShader(t,i);e.linkProgram(t);for(let i of n)e.detachShader(t,i),e.deleteShader(i);return e.getProgramParameter(t,e.LINK_STATUS)||(console.error(e.getProgramInfoLog(t)),e.deleteProgram(t)),t}function fu(e,t,n,r,i=void 0){i?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.drawElements(t,r,e.UNSIGNED_SHORT,n)):e.drawArrays(t,n,r)}var Ni=class{constructor(t,n){this.handle=n,this.activeUniforms=ou(t,n),this.activeAttributes=hu(t,n),this.drawContext=new Bi(t,this)}bind(t){return t.useProgram(this.handle),this.drawContext.gl=t,this.drawContext}},Bi=class{constructor(t,n){this.gl=t,this.parent=n}uniform(t,n){let r=this.parent.activeUniforms;if(t in r){let i=r[t],s=i.location;i.set.call(this.gl,s,n)}return this}attribute(t,n,r,i=!1,s=0,a=0){let o=this.gl,l=this.parent.activeAttributes;if(t in l){let h=l[t],c=h.location,u=h.size;r?(o.bindBuffer(o.ARRAY_BUFFER,r),o.vertexAttribPointer(c,u,n,i,s,a),o.enableVertexAttribArray(c)):o.disableVertexAttribArray(c)}return this}draw(t,n,r,i,s=null){return fu(t,n,r,i,s),this.parent}},Di=class{constructor(t,n=void 0){this.handle=n||t.createProgram(),this.shaders=[],this.gl=t}shader(t,n){let r=this.gl,i=cu(r,t,n);return this.shaders.push(i),this}link(){let t=this.gl;return uu(t,this.handle,this.shaders),this.shaders.length=0,this.handle}},mt=class{constructor(t,n=void 0){this.programBuilder=new Di(t,n)}get gl(){return this.programBuilder.gl}get handle(){return this.programBuilder.handle}get shaders(){return this.programBuilder.shaders}shader(t,n){return this.programBuilder.shader(t,n),this}link(){let t=this.programBuilder.link();return new Ni(this.gl,t)}};var xe={red(e){return e>>16&255},redf(e){return(e>>16&255)/255},green(e){return e>>8&255},greenf(e){return(e>>8&255)/255},blue(e){return e&255},bluef(e){return(e&255)/255},alpha(e){return e>>24&255},alphaf(e){return(e>>24&255)/255}};var vt=class{constructor(t){let n=t.getContext("webgl");this.gl=n,this.transformStack=[]}pushTranslation(t,n,r=0){let i=H.create();return H.fromTranslation(i,q.fromValues(t,n,r)),this.pushTransform(i)}pushRotation(t,n=0,r=0){let i=H.create();return!n&&!r?H.fromZRotation(i,Math.PI*t/180):H.fromRotationTranslationScaleOrigin(i,le.fromEuler(le.create(),0,0,t),q.fromValues(0,0,0),q.fromValues(1,1,1),q.fromValues(n,r,0)),this.pushTransform(i)}pushScaling(t,n,r=0,i=0){let s=H.create();return!r&&!i?H.fromScaling(s,q.fromValues(t,n,1)):H.fromRotationTranslationScaleOrigin(s,le.fromEuler(le.create(),0,0,0),q.fromValues(0,0,0),q.fromValues(t,n,1),q.fromValues(r,i,0)),this.pushTransform(s)}pushTransform(t){if(this.transformStack.length>0){let n=this.transformStack.length-1,r=this.transformStack[n],i=H.mul(H.create(),r,t);this.transformStack.push(i)}else this.transformStack.push(H.copy(H.create(),t));return this}popTransform(){return this.transformStack.pop(),this}peekTransform(){let t=this.transformStack.length-1;return t>=0?this.transformStack[t]:null}resetTransform(){return this.transformStack.length=0,this}};var Pi=16,pu=(()=>{let e=[],t=Pi,n=Math.PI*2/t,r=1,i=0,s,a;for(let o=0;o<=t;++o)s=Math.cos(o*n),a=Math.sin(o*n),e.push(0,0),e.push(r,i),e.push(s,a),r=s,i=a;return e})(),jp=Math.trunc(pu.length/2),du=(()=>{let e=[],t=Pi,n=Math.PI*2/t,r=1,i=0,s,a;for(let o=0;o<=t;++o)s=Math.cos(o*n),a=Math.sin(o*n),e.push(r,i),e.push(s,a),r=s,i=a;return e})(),$p=Math.trunc(du.length/2);var mu=`
attribute vec2 a_position;
attribute vec2 a_texcoord;

varying vec2 v_texcoord;

uniform mat4 u_projection_view;
uniform mat4 u_model;

void main()
{
    vec4 position = u_projection_view * u_model
        * vec4(a_position.xy, 0.0, 1.0);
    v_texcoord = a_texcoord;
    gl_Position = position;
}`,vu=`
precision mediump float;

varying vec2 v_texcoord;

uniform sampler2D u_texture;
uniform vec2 u_texture_size;
uniform vec4 u_sprite;
uniform vec3 u_color;

void main()
{
    float spriteWidth = u_sprite.z - u_sprite.x;
    float spriteHeight = u_sprite.w - u_sprite.y;
    vec2 texcoord = vec2(
        (u_sprite.x / u_texture_size.x) + v_texcoord.x * (spriteWidth / u_texture_size.x),
        (u_sprite.y / u_texture_size.y) + v_texcoord.y * (spriteHeight / u_texture_size.y));
    vec4 texcolor = texture2D(u_texture, texcoord);
    if (texcolor.a < 0.5) discard;
    gl_FragColor = vec4(
        texcolor.r * u_color.r,
        texcolor.g * u_color.g,
        texcolor.b * u_color.b,
        texcolor.a);
}`,Fi=[0,0,1,0,0,1,1,1,1,0,0,1],Me=class extends vt{constructor(t){super(t);let n=this.gl;n.enable(n.DEPTH_TEST),this.program=new mt(n).shader(n.VERTEX_SHADER,mu).shader(n.FRAGMENT_SHADER,vu).link(),this.meshQuad={position:new ze(n,n.ARRAY_BUFFER).data(dt.createBufferSource(n,n.FLOAT,Fi)).build(),texcoord:new ze(n,n.ARRAY_BUFFER).data(dt.createBufferSource(n,n.FLOAT,Fi)).build()},this.program.bind(n).attribute("a_position",n.FLOAT,this.meshQuad.position.handle).attribute("a_texcoord",n.FLOAT,this.meshQuad.texcoord.handle),this.camera=new pt,this.projectionViewMatrix=H.create(),this.modelMatrix=H.create(),this.spriteVector=we.fromValues(0,0,1,1),this.textureSize=Ie.fromValues(1,1),this.textureHandle=null,this.textureList=new Array(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),this.frameMap={},this.spriteMap={},this.defaultSprite={frames:[]},this.spriteColor=q.fromValues(1,1,1),this.program.bind(n).uniform("u_color",this.spriteColor),this.spriteDepth=0}prepare(){this.resetTransform(),this.resize(),this.clear(),this.color(16777215),this.zLevel(0)}resize(){let t=this.gl,n=t.canvas.width,r=t.canvas.height;t.viewport(0,0,n,r);let i=this.camera;i.resize(n,r);let s=this.projectionViewMatrix;H.mul(s,i.projectionMatrix,i.viewMatrix),this.program.bind(t).uniform("u_projection_view",s)}clear(t=0){let n=this.gl;n.clearColor(xe.redf(t),xe.greenf(t),xe.bluef(t),xe.alphaf(t)),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this.resetTransform()}texture(t,n,r=void 0){let i=this.textureList.length;if(t<0||t>=i)throw new Error(`Invalid texture unit - must be within range [0, ${i-1}]`);let s=this.gl,a=this.textureList[t];return a&&gu(s,a.handle),this.textureList[t]=xu(s,n),s.activeTexture(s.TEXTURE0+t),typeof r!="undefined"&&this.frame(r,t),this}frame(t,n=0,r=0,i=0,s=void 0,a=void 0){let o=this.textureList[n];if(!o)throw new Error(`Missing bound texture for texture unit ${n}.`);typeof s=="undefined"&&(s=o.width),typeof a=="undefined"&&(a=o.height);let l=this.frameMap;return l[t]=[n,r,i,s,a],this}sprite(t,n){let r=this.spriteMap;return r[t]={frames:n},this}color(t=16777215){let n=this.gl,r=this.program,i=this.spriteColor;return q.set(i,xe.redf(t),xe.greenf(t),xe.bluef(t)),r.bind(n).uniform("u_color",i),this}zLevel(t=0){return this.spriteDepth=t,this}drawRect(t,n=0,r=0,i=0,s=r,a=i){let o=this.spriteMap,l;if(t in o)l=o[t];else{let x=this.frameMap,g=this.defaultSprite,Y=g.frames;Y.length=0,t in x&&Y.push(t),l=g}let h=l.frames.length;if(h<=0)return this;n=Math.floor(n)%h;let c=this.frameMap,u=l.frames[n],f=c[u],[d,m,v,p,y]=f,L=this.textureList[d],{handle:E,width:M,height:b}=L;this.textureHandle=E,Ie.set(this.textureSize,M,b),we.set(this.spriteVector,m,v,p,y);let R=s-r,O=a-i,A=p-m,w=y-v,D=R/A,_=O/w,B=r+A/2*D,N=i+w/2*_,P=this.gl;return Ui(P,this.program,this.meshQuad,this.peekTransform(),this.modelMatrix,this.textureHandle,this.textureSize,this.spriteVector,B,N,this.spriteDepth,0,D,_),this}draw(t,n=0,r=0,i=0,s=0,a=1,o=a){let l=this.spriteMap,h;if(t in l)h=l[t];else{let A=this.frameMap,w=this.defaultSprite,D=w.frames;D.length=0,t in A&&D.push(t),h=w}let c=h.frames.length;if(c<=0)return this;n=Math.floor(n)%c;let u=this.frameMap,f=h.frames[n],d=u[f],[m,v,p,y,L]=d,E=this.textureList[m],{handle:M,width:b,height:R}=E;this.textureHandle=M,Ie.set(this.textureSize,b,R),we.set(this.spriteVector,v,p,y,L);let O=this.gl;return Ui(O,this.program,this.meshQuad,this.peekTransform(),this.modelMatrix,this.textureHandle,this.textureSize,this.spriteVector,r,i,this.spriteDepth,s,a,o),this}};function xu(e,t){if(!(t instanceof Image))throw new Error(`Not a valid image ${t}.`);let n=0,r=e.RGBA,i=e.RGBA,s=e.UNSIGNED_BYTE,a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,n,r,i,s,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),{handle:a,width:t.width,height:t.height}}function gu(e,t){e.deleteTexture(t)}function Ui(e,t,n,r,i,s,a,o,l,h,c,u,f,d){let{position:m,texcoord:v}=n,p=o[2]-o[0],y=o[3]-o[1];H.fromRotationTranslationScaleOrigin(i,le.fromEuler(le.create(),0,0,u),q.fromValues(l-p/2,h-y/2,c),q.fromValues(f,d,1),q.fromValues(p/2,y/2,0)),H.scale(i,i,q.fromValues(p,y,1)),r&&H.mul(i,r,i),s&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s)),t.bind(e).attribute("a_position",e.FLOAT,m.handle).attribute("a_texcoord",e.FLOAT,v.handle).uniform("u_model",i).uniform("u_texture",0).uniform("u_sprite",o).uniform("u_texture_size",a).draw(e,e.TRIANGLES,0,6)}var _u=16,An=16,Jp=An/2,yu=_u*An,ed=1/yu;var Eu=.3,bd=1-Eu;var Au=60,Dd=1e3/Au;async function ki(e){let{display:t,assets:n}=e,r=t.canvas,i=new Me(r),s=n.getAsset("atlas:dungeon.atlas"),a=n.getAsset("image:dungeon.png");i.texture(1,a,"dungeon.all"),bu(i,1,s),i.texture(2,n.getAsset("image:font.png"),"font.all"),Tu(i,2),i.texture(3,n.getAsset("image:water_tile.png"),"nine.all"),Ru(i,3,16,16),i.texture(4,n.getAsset("image:m5x7.png"),"bmfont.all"),Su(i,4,n.getAsset("fnt:m5x7.fnt")),t.addEventListener("frame",o=>{let{deltaTime:l}=o.detail;i.prepare(),i.pushScaling(2,2),i.color(16777215),i.zLevel(100),i.draw("lizard_m_idle_anim",0,16,16,0),i.popTransform();let h=40;Mu(i,`Hello World.
Nice to meet you!`,h+20,t.height-200+20),wu(i,h,t.height-200,t.width-h,t.height-h)})}function wu(e,t,n,r=t,i=n){let s=r-t,a=i-n,o=s/3,l=a/3,h=Math.min(o,l),c=s-h*2,u=a-h*2;e.drawRect("nine",0,t,n,t+h,n+h),e.drawRect("nine",1,t+h,n,t+h+c,n+h),e.drawRect("nine",2,t+h+c,n,t+s,n+h),e.drawRect("nine",3,t,n+h,t+h,n+h+u),e.drawRect("nine",4,t+h,n+h,t+h+c,n+h+u),e.drawRect("nine",5,t+h+c,n+h,t+s,n+h+u),e.drawRect("nine",6,t,n+h+u,t+h,n+a),e.drawRect("nine",7,t+h,n+h+u,t+h+c,n+a),e.drawRect("nine",8,t+h+c,n+h+u,t+s,n+a)}function Mu(e,t,n,r){let i=n,s=32,a=13,o=18;t=t.toUpperCase();for(let l=0;l<t.length;++l){let h=t.charAt(l);if(h===`
`){r+=o,n=i;continue}else if(h===" "){n+=a;continue}else{n+=a;let c=Math.abs(t.charCodeAt(l)-s);e.draw("bmfont",c,n,r)}}}function bu(e,t,n){for(let r of Object.values(n)){let{u:i,v:s,w:a,h:o,cols:l,rows:h,name:c}=r,u=[];for(let f=0;f<l;++f)for(let d=0;d<h;++d){let m=`${c}.${f}`;u.push(m),e.frame(m,t,i+f*a,s+d*o,i+(f+1)*a,s+(d+1)*o)}e.sprite(c,u)}}function Tu(e,t){let n=[],r=8,i=8;for(let s=0;s<40;++s){let a=s%8*r,o=Math.floor(s/8)*i,l=a+r,h=o+i,c=`font.${s}`;n.push(c),e.frame(c,t,a,o,l,h)}e.sprite("font",n)}function Su(e,t,n){let r=[];for(let i of n.chars){let s=i.x,a=i.y,o=s+i.width,l=a+i.height,h=`bmfont.${i.id}`;e.frame(h,t,s,a,o,l),r.push(h)}e.sprite("bmfont",r)}function Ru(e,t,n,r){let i=n/3,s=r/3,a=[];e.frame("nine.0",t,0,0,i,s),a.push("nine.0"),e.frame("nine.1",t,i,0,i*2,s),a.push("nine.1"),e.frame("nine.2",t,i*2,0,n,s),a.push("nine.2"),e.frame("nine.3",t,0,s,i,s*2),a.push("nine.3"),e.frame("nine.4",t,i,s,i*2,s*2),a.push("nine.4"),e.frame("nine.5",t,i*2,s,n,s*2),a.push("nine.5"),e.frame("nine.6",t,0,s*2,i,r),a.push("nine.6"),e.frame("nine.7",t,i,s*2,i*2,r),a.push("nine.7"),e.frame("nine.8",t,i*2,s*2,n,r),a.push("nine.8"),e.sprite("nine",a)}window.addEventListener("DOMContentLoaded",Lu);async function Lu(){let e=document.querySelector("#display"),t=document.querySelector("#inputs").getContext("axisbutton"),n=document.querySelector("#assets"),r=new Promise((s,a)=>{n.addEventListener("load",s),n.addEventListener("error",a)});n.src="res.pack",await r,await n.pipe("res/**/*.png",async(s,a)=>n.cache("image:"+a.substring(4),await Zt(s,"image/png"))),await n.pipe("res/**/*.obj",async(s,a)=>n.cache("obj:"+a.substring(4),await Qt(s))),await n.pipe("res/**/*.atlas",async(s,a)=>n.cache("atlas:"+a.substring(4),await Jt(s))),await n.pipe("res/**/*.fnt",async(s,a)=>n.cache("fnt:"+a.substring(4),await tn(s))),await n.pipe("res/**/*.wav",async(s,a)=>{let o=at.getAudioContext(),l=await en(s,o),h=new at(o,l);return n.cache("sound:"+a.substring(4),h)});let i=new Wt(e,t,n);e.addEventListener("frame",s=>{let{deltaTime:a,prevTime:o,now:l}=s.detail;i.deltaTime=a,i.prevTime=o,i.now=l,t.poll(l),i.emit("frame")}),await ki(i)}})();
//# sourceMappingURL=main.js.map
