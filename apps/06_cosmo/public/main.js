(()=>{var hi=Object.create,ae=Object.defineProperty;var ci=Object.getOwnPropertyDescriptor;var fi=Object.getOwnPropertyNames;var pi=Object.getPrototypeOf,di=Object.prototype.hasOwnProperty;var mi=n=>ae(n,"__esModule",{value:!0});var vi=(n,t)=>()=>(n&&(t=n(n=0)),t),Bt=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Ue=(n,t)=>{for(var e in t)ae(n,e,{get:t[e],enumerable:!0})},gi=(n,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of fi(t))!di.call(n,r)&&r!=="default"&&ae(n,r,{get:()=>t[r],enumerable:!(e=ci(t,r))||e.enumerable});return n},yi=n=>gi(mi(ae(n!=null?hi(pi(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var yr={};Ue(yr,{basename:()=>vr,default:()=>Wo,delimiter:()=>dr,dirname:()=>mr,extname:()=>gr,isAbsolute:()=>Qe,join:()=>cr,normalize:()=>Ze,relative:()=>fr,resolve:()=>ce,sep:()=>pr});function hr(n,t){for(var e=0,r=n.length-1;r>=0;r--){var s=n[r];s==="."?n.splice(r,1):s===".."?(n.splice(r,1),e++):e&&(n.splice(r,1),e--)}if(t)for(;e--;e)n.unshift("..");return n}function ce(){for(var n="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var r=e>=0?arguments[e]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;n=r+"/"+n,t=r.charAt(0)==="/"}return n=hr(Je(n.split("/"),function(s){return!!s}),!t).join("/"),(t?"/":"")+n||"."}function Ze(n){var t=Qe(n),e=Xo(n,-1)==="/";return n=hr(Je(n.split("/"),function(r){return!!r}),!t).join("/"),!n&&!t&&(n="."),n&&e&&(n+="/"),(t?"/":"")+n}function Qe(n){return n.charAt(0)==="/"}function cr(){var n=Array.prototype.slice.call(arguments,0);return Ze(Je(n,function(t,e){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function fr(n,t){n=ce(n).substr(1),t=ce(t).substr(1);function e(f){for(var h=0;h<f.length&&f[h]==="";h++);for(var d=f.length-1;d>=0&&f[d]==="";d--);return h>d?[]:f.slice(h,d-h+1)}for(var r=e(n.split("/")),s=e(t.split("/")),i=Math.min(r.length,s.length),o=i,a=0;a<i;a++)if(r[a]!==s[a]){o=a;break}for(var l=[],a=o;a<r.length;a++)l.push("..");return l=l.concat(s.slice(o)),l.join("/")}function mr(n){var t=Ve(n),e=t[0],r=t[1];return!e&&!r?".":(r&&(r=r.substr(0,r.length-1)),e+r)}function vr(n,t){var e=Ve(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function gr(n){return Ve(n)[3]}function Je(n,t){if(n.filter)return n.filter(t);for(var e=[],r=0;r<n.length;r++)t(n[r],r,n)&&e.push(n[r]);return e}var Go,Ve,pr,dr,Wo,Xo,wr=vi(()=>{Go=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Ve=function(n){return Go.exec(n).slice(1)};pr="/",dr=":";Wo={extname:gr,basename:vr,dirname:mr,sep:pr,delimiter:dr,relative:fr,join:cr,isAbsolute:Qe,normalize:Ze,resolve:ce};Xo="ab".substr(-1)==="b"?function(n,t,e){return n.substr(t,e)}:function(n,t,e){return t<0&&(t=n.length+t),n.substr(t,e)}});var pe=Bt((Mu,fe)=>{var Nt=(wr(),yr);if(Nt&&Nt.default){fe.exports=Nt.default;for(let n in Nt)fe.exports[n]=Nt[n]}else Nt&&(fe.exports=Nt)});var Wt=Bt((Iu,br)=>{"use strict";var Vo=pe(),yt="\\\\/",Er=`[^${yt}]`,_t="\\.",Zo="\\+",Qo="\\?",de="\\/",Jo="(?=.)",Ar="[^/]",tn=`(?:${de}|$)`,xr=`(?:^|${de})`,en=`${_t}{1,2}${tn}`,ta=`(?!${_t})`,ea=`(?!${xr}${en})`,na=`(?!${_t}{0,1}${tn})`,ra=`(?!${en})`,sa=`[^.${de}]`,ia=`${Ar}*?`,_r={DOT_LITERAL:_t,PLUS_LITERAL:Zo,QMARK_LITERAL:Qo,SLASH_LITERAL:de,ONE_CHAR:Jo,QMARK:Ar,END_ANCHOR:tn,DOTS_SLASH:en,NO_DOT:ta,NO_DOTS:ea,NO_DOT_SLASH:na,NO_DOTS_SLASH:ra,QMARK_NO_DOT:sa,STAR:ia,START_ANCHOR:xr},oa={..._r,SLASH_LITERAL:`[${yt}]`,QMARK:Er,STAR:`${Er}*?`,DOTS_SLASH:`${_t}{1,2}(?:[${yt}]|$)`,NO_DOT:`(?!${_t})`,NO_DOTS:`(?!(?:^|[${yt}])${_t}{1,2}(?:[${yt}]|$))`,NO_DOT_SLASH:`(?!${_t}{0,1}(?:[${yt}]|$))`,NO_DOTS_SLASH:`(?!${_t}{1,2}(?:[${yt}]|$))`,QMARK_NO_DOT:`[^.${yt}]`,START_ANCHOR:`(?:^|[${yt}])`,END_ANCHOR:`(?:[${yt}]|$)`},aa={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};br.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:aa,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Vo.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?oa:_r}}});var me=Bt(et=>{"use strict";var la=pe(),ua=!1,{REGEX_BACKSLASH:ha,REGEX_REMOVE_BACKSLASH:ca,REGEX_SPECIAL_CHARS:fa,REGEX_SPECIAL_CHARS_GLOBAL:pa}=Wt();et.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);et.hasRegexChars=n=>fa.test(n);et.isRegexChar=n=>n.length===1&&et.hasRegexChars(n);et.escapeRegex=n=>n.replace(pa,"\\$1");et.toPosixSlashes=n=>n.replace(ha,"/");et.removeBackslashes=n=>n.replace(ca,t=>t==="\\"?"":t);et.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};et.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:ua===!0||la.sep==="\\";et.escapeLast=(n,t,e)=>{let r=n.lastIndexOf(t,e);return r===-1?n:n[r-1]==="\\"?et.escapeLast(n,t,r-1):`${n.slice(0,r)}\\${n.slice(r)}`};et.removePrefix=(n,t={})=>{let e=n;return e.startsWith("./")&&(e=e.slice(2),t.prefix="./"),e};et.wrapOutput=(n,t={},e={})=>{let r=e.contains?"":"^",s=e.contains?"":"$",i=`${r}(?:${n})${s}`;return t.negated===!0&&(i=`(?:^(?!${i}).*$)`),i}});var Pr=Bt((Pu,Lr)=>{"use strict";var Sr=me(),{CHAR_ASTERISK:nn,CHAR_AT:da,CHAR_BACKWARD_SLASH:Xt,CHAR_COMMA:ma,CHAR_DOT:rn,CHAR_EXCLAMATION_MARK:sn,CHAR_FORWARD_SLASH:Tr,CHAR_LEFT_CURLY_BRACE:on,CHAR_LEFT_PARENTHESES:an,CHAR_LEFT_SQUARE_BRACKET:va,CHAR_PLUS:ga,CHAR_QUESTION_MARK:Rr,CHAR_RIGHT_CURLY_BRACE:ya,CHAR_RIGHT_PARENTHESES:Cr,CHAR_RIGHT_SQUARE_BRACKET:wa}=Wt(),Mr=n=>n===Tr||n===Xt,Ir=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},Ea=(n,t)=>{let e=t||{},r=n.length-1,s=e.parts===!0||e.scanToEnd===!0,i=[],o=[],a=[],l=n,f=-1,h=0,d=0,E=!1,C=!1,S=!1,R=!1,L=!1,U=!1,j=!1,I=!1,q=!1,K=!1,X=0,F,y,x={value:"",depth:0,isGlob:!1},$=()=>f>=r,p=()=>l.charCodeAt(f+1),P=()=>(F=y,l.charCodeAt(++f));for(;f<r;){y=P();let G;if(y===Xt){j=x.backslashes=!0,y=P(),y===on&&(U=!0);continue}if(U===!0||y===on){for(X++;$()!==!0&&(y=P());){if(y===Xt){j=x.backslashes=!0,P();continue}if(y===on){X++;continue}if(U!==!0&&y===rn&&(y=P())===rn){if(E=x.isBrace=!0,S=x.isGlob=!0,K=!0,s===!0)continue;break}if(U!==!0&&y===ma){if(E=x.isBrace=!0,S=x.isGlob=!0,K=!0,s===!0)continue;break}if(y===ya&&(X--,X===0)){U=!1,E=x.isBrace=!0,K=!0;break}}if(s===!0)continue;break}if(y===Tr){if(i.push(f),o.push(x),x={value:"",depth:0,isGlob:!1},K===!0)continue;if(F===rn&&f===h+1){h+=2;continue}d=f+1;continue}if(e.noext!==!0&&(y===ga||y===da||y===nn||y===Rr||y===sn)===!0&&p()===an){if(S=x.isGlob=!0,R=x.isExtglob=!0,K=!0,y===sn&&f===h&&(q=!0),s===!0){for(;$()!==!0&&(y=P());){if(y===Xt){j=x.backslashes=!0,y=P();continue}if(y===Cr){S=x.isGlob=!0,K=!0;break}}continue}break}if(y===nn){if(F===nn&&(L=x.isGlobstar=!0),S=x.isGlob=!0,K=!0,s===!0)continue;break}if(y===Rr){if(S=x.isGlob=!0,K=!0,s===!0)continue;break}if(y===va){for(;$()!==!0&&(G=P());){if(G===Xt){j=x.backslashes=!0,P();continue}if(G===wa){C=x.isBracket=!0,S=x.isGlob=!0,K=!0;break}}if(s===!0)continue;break}if(e.nonegate!==!0&&y===sn&&f===h){I=x.negated=!0,h++;continue}if(e.noparen!==!0&&y===an){if(S=x.isGlob=!0,s===!0){for(;$()!==!0&&(y=P());){if(y===an){j=x.backslashes=!0,y=P();continue}if(y===Cr){K=!0;break}}continue}break}if(S===!0){if(K=!0,s===!0)continue;break}}e.noext===!0&&(R=!1,S=!1);let M=l,rt="",c="";h>0&&(rt=l.slice(0,h),l=l.slice(h),d-=h),M&&S===!0&&d>0?(M=l.slice(0,d),c=l.slice(d)):S===!0?(M="",c=l):M=l,M&&M!==""&&M!=="/"&&M!==l&&Mr(M.charCodeAt(M.length-1))&&(M=M.slice(0,-1)),e.unescape===!0&&(c&&(c=Sr.removeBackslashes(c)),M&&j===!0&&(M=Sr.removeBackslashes(M)));let u={prefix:rt,input:n,start:h,base:M,glob:c,isBrace:E,isBracket:C,isGlob:S,isExtglob:R,isGlobstar:L,negated:I,negatedExtglob:q};if(e.tokens===!0&&(u.maxDepth=0,Mr(y)||o.push(x),u.tokens=o),e.parts===!0||e.tokens===!0){let G;for(let T=0;T<i.length;T++){let tt=G?G+1:h,W=i[T],V=n.slice(tt,W);e.tokens&&(T===0&&h!==0?(o[T].isPrefix=!0,o[T].value=rt):o[T].value=V,Ir(o[T]),u.maxDepth+=o[T].depth),(T!==0||V!=="")&&a.push(V),G=W}if(G&&G+1<n.length){let T=n.slice(G+1);a.push(T),e.tokens&&(o[o.length-1].value=T,Ir(o[o.length-1]),u.maxDepth+=o[o.length-1].depth)}u.slashes=i,u.parts=a}return u};Lr.exports=Ea});var Dr=Bt((Ou,Br)=>{"use strict";var ve=Wt(),it=me(),{MAX_LENGTH:ge,POSIX_REGEX_SOURCE:Aa,REGEX_NON_SPECIAL_CHARS:xa,REGEX_SPECIAL_CHARS_BACKREF:_a,REPLACEMENTS:Or}=ve,ba=(n,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...n,t);n.sort();let e=`[${n.join("-")}]`;try{new RegExp(e)}catch(r){return n.map(s=>it.escapeRegex(s)).join("..")}return e},$t=(n,t)=>`Missing ${n}: "${t}" - use "\\\\${t}" to match literal characters`,ln=(n,t)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=Or[n]||n;let e={...t},r=typeof e.maxLength=="number"?Math.min(ge,e.maxLength):ge,s=n.length;if(s>r)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${r}`);let i={type:"bos",value:"",output:e.prepend||""},o=[i],a=e.capture?"":"?:",l=it.isWindows(t),f=ve.globChars(l),h=ve.extglobChars(f),{DOT_LITERAL:d,PLUS_LITERAL:E,SLASH_LITERAL:C,ONE_CHAR:S,DOTS_SLASH:R,NO_DOT:L,NO_DOT_SLASH:U,NO_DOTS_SLASH:j,QMARK:I,QMARK_NO_DOT:q,STAR:K,START_ANCHOR:X}=f,F=g=>`(${a}(?:(?!${X}${g.dot?R:d}).)*?)`,y=e.dot?"":L,x=e.dot?I:q,$=e.bash===!0?F(e):K;e.capture&&($=`(${$})`),typeof e.noext=="boolean"&&(e.noextglob=e.noext);let p={input:n,index:-1,start:0,dot:e.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=it.removePrefix(n,p),s=n.length;let P=[],M=[],rt=[],c=i,u,G=()=>p.index===s-1,T=p.peek=(g=1)=>n[p.index+g],tt=p.advance=()=>n[++p.index]||"",W=()=>n.slice(p.index+1),V=(g="",B=0)=>{p.consumed+=g,p.index+=B},vt=g=>{p.output+=g.output!=null?g.output:g.value,V(g.value)},qt=()=>{let g=1;for(;T()==="!"&&(T(2)!=="("||T(3)==="?");)tt(),p.start++,g++;return g%2==0?!1:(p.negated=!0,p.start++,!0)},Mt=g=>{p[g]++,rt.push(g)},gt=g=>{p[g]--,rt.pop()},_=g=>{if(c.type==="globstar"){let B=p.braces>0&&(g.type==="comma"||g.type==="brace"),m=g.extglob===!0||P.length&&(g.type==="pipe"||g.type==="paren");g.type!=="slash"&&g.type!=="paren"&&!B&&!m&&(p.output=p.output.slice(0,-c.output.length),c.type="star",c.value="*",c.output=$,p.output+=c.output)}if(P.length&&g.type!=="paren"&&(P[P.length-1].inner+=g.value),(g.value||g.output)&&vt(g),c&&c.type==="text"&&g.type==="text"){c.value+=g.value,c.output=(c.output||"")+g.value;return}g.prev=c,o.push(g),c=g},Ot=(g,B)=>{let m={...h[B],conditions:1,inner:""};m.prev=c,m.parens=p.parens,m.output=p.output;let b=(e.capture?"(":"")+m.open;Mt("parens"),_({type:g,value:B,output:p.output?"":S}),_({type:"paren",extglob:!0,value:tt(),output:b}),P.push(m)},ie=g=>{let B=g.close+(e.capture?")":""),m;if(g.type==="negate"){let b=$;if(g.inner&&g.inner.length>1&&g.inner.includes("/")&&(b=F(e)),(b!==$||G()||/^\)+$/.test(W()))&&(B=g.close=`)$))${b}`),g.inner.includes("*")&&(m=W())&&/^\.[^\\/.]+$/.test(m)){let H=ln(m,{...t,fastpaths:!1}).output;B=g.close=`)${H})${b})`}g.prev.type==="bos"&&(p.negatedExtglob=!0)}_({type:"paren",extglob:!0,value:u,output:B}),gt("parens")};if(e.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let g=!1,B=n.replace(_a,(m,b,H,Z,Y,ke)=>Z==="\\"?(g=!0,m):Z==="?"?b?b+Z+(Y?I.repeat(Y.length):""):ke===0?x+(Y?I.repeat(Y.length):""):I.repeat(H.length):Z==="."?d.repeat(H.length):Z==="*"?b?b+Z+(Y?$:""):$:b?m:`\\${m}`);return g===!0&&(e.unescape===!0?B=B.replace(/\\/g,""):B=B.replace(/\\+/g,m=>m.length%2==0?"\\\\":m?"\\":"")),B===n&&e.contains===!0?(p.output=n,p):(p.output=it.wrapOutput(B,p,t),p)}for(;!G();){if(u=tt(),u==="\0")continue;if(u==="\\"){let m=T();if(m==="/"&&e.bash!==!0||m==="."||m===";")continue;if(!m){u+="\\",_({type:"text",value:u});continue}let b=/^\\+/.exec(W()),H=0;if(b&&b[0].length>2&&(H=b[0].length,p.index+=H,H%2!=0&&(u+="\\")),e.unescape===!0?u=tt():u+=tt(),p.brackets===0){_({type:"text",value:u});continue}}if(p.brackets>0&&(u!=="]"||c.value==="["||c.value==="[^")){if(e.posix!==!1&&u===":"){let m=c.value.slice(1);if(m.includes("[")&&(c.posix=!0,m.includes(":"))){let b=c.value.lastIndexOf("["),H=c.value.slice(0,b),Z=c.value.slice(b+2),Y=Aa[Z];if(Y){c.value=H+Y,p.backtrack=!0,tt(),!i.output&&o.indexOf(c)===1&&(i.output=S);continue}}}(u==="["&&T()!==":"||u==="-"&&T()==="]")&&(u=`\\${u}`),u==="]"&&(c.value==="["||c.value==="[^")&&(u=`\\${u}`),e.posix===!0&&u==="!"&&c.value==="["&&(u="^"),c.value+=u,vt({value:u});continue}if(p.quotes===1&&u!=='"'){u=it.escapeRegex(u),c.value+=u,vt({value:u});continue}if(u==='"'){p.quotes=p.quotes===1?0:1,e.keepQuotes===!0&&_({type:"text",value:u});continue}if(u==="("){Mt("parens"),_({type:"paren",value:u});continue}if(u===")"){if(p.parens===0&&e.strictBrackets===!0)throw new SyntaxError($t("opening","("));let m=P[P.length-1];if(m&&p.parens===m.parens+1){ie(P.pop());continue}_({type:"paren",value:u,output:p.parens?")":"\\)"}),gt("parens");continue}if(u==="["){if(e.nobracket===!0||!W().includes("]")){if(e.nobracket!==!0&&e.strictBrackets===!0)throw new SyntaxError($t("closing","]"));u=`\\${u}`}else Mt("brackets");_({type:"bracket",value:u});continue}if(u==="]"){if(e.nobracket===!0||c&&c.type==="bracket"&&c.value.length===1){_({type:"text",value:u,output:`\\${u}`});continue}if(p.brackets===0){if(e.strictBrackets===!0)throw new SyntaxError($t("opening","["));_({type:"text",value:u,output:`\\${u}`});continue}gt("brackets");let m=c.value.slice(1);if(c.posix!==!0&&m[0]==="^"&&!m.includes("/")&&(u=`/${u}`),c.value+=u,vt({value:u}),e.literalBrackets===!1||it.hasRegexChars(m))continue;let b=it.escapeRegex(c.value);if(p.output=p.output.slice(0,-c.value.length),e.literalBrackets===!0){p.output+=b,c.value=b;continue}c.value=`(${a}${b}|${c.value})`,p.output+=c.value;continue}if(u==="{"&&e.nobrace!==!0){Mt("braces");let m={type:"brace",value:u,output:"(",outputIndex:p.output.length,tokensIndex:p.tokens.length};M.push(m),_(m);continue}if(u==="}"){let m=M[M.length-1];if(e.nobrace===!0||!m){_({type:"text",value:u,output:u});continue}let b=")";if(m.dots===!0){let H=o.slice(),Z=[];for(let Y=H.length-1;Y>=0&&(o.pop(),H[Y].type!=="brace");Y--)H[Y].type!=="dots"&&Z.unshift(H[Y].value);b=ba(Z,e),p.backtrack=!0}if(m.comma!==!0&&m.dots!==!0){let H=p.output.slice(0,m.outputIndex),Z=p.tokens.slice(m.tokensIndex);m.value=m.output="\\{",u=b="\\}",p.output=H;for(let Y of Z)p.output+=Y.output||Y.value}_({type:"brace",value:u,output:b}),gt("braces"),M.pop();continue}if(u==="|"){P.length>0&&P[P.length-1].conditions++,_({type:"text",value:u});continue}if(u===","){let m=u,b=M[M.length-1];b&&rt[rt.length-1]==="braces"&&(b.comma=!0,m="|"),_({type:"comma",value:u,output:m});continue}if(u==="/"){if(c.type==="dot"&&p.index===p.start+1){p.start=p.index+1,p.consumed="",p.output="",o.pop(),c=i;continue}_({type:"slash",value:u,output:C});continue}if(u==="."){if(p.braces>0&&c.type==="dot"){c.value==="."&&(c.output=d);let m=M[M.length-1];c.type="dots",c.output+=u,c.value+=u,m.dots=!0;continue}if(p.braces+p.parens===0&&c.type!=="bos"&&c.type!=="slash"){_({type:"text",value:u,output:d});continue}_({type:"dot",value:u,output:d});continue}if(u==="?"){if(!(c&&c.value==="(")&&e.noextglob!==!0&&T()==="("&&T(2)!=="?"){Ot("qmark",u);continue}if(c&&c.type==="paren"){let b=T(),H=u;if(b==="<"&&!it.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(c.value==="("&&!/[!=<:]/.test(b)||b==="<"&&!/<([!=]|\w+>)/.test(W()))&&(H=`\\${u}`),_({type:"text",value:u,output:H});continue}if(e.dot!==!0&&(c.type==="slash"||c.type==="bos")){_({type:"qmark",value:u,output:q});continue}_({type:"qmark",value:u,output:I});continue}if(u==="!"){if(e.noextglob!==!0&&T()==="("&&(T(2)!=="?"||!/[!=<:]/.test(T(3)))){Ot("negate",u);continue}if(e.nonegate!==!0&&p.index===0){qt();continue}}if(u==="+"){if(e.noextglob!==!0&&T()==="("&&T(2)!=="?"){Ot("plus",u);continue}if(c&&c.value==="("||e.regex===!1){_({type:"plus",value:u,output:E});continue}if(c&&(c.type==="bracket"||c.type==="paren"||c.type==="brace")||p.parens>0){_({type:"plus",value:u});continue}_({type:"plus",value:E});continue}if(u==="@"){if(e.noextglob!==!0&&T()==="("&&T(2)!=="?"){_({type:"at",extglob:!0,value:u,output:""});continue}_({type:"text",value:u});continue}if(u!=="*"){(u==="$"||u==="^")&&(u=`\\${u}`);let m=xa.exec(W());m&&(u+=m[0],p.index+=m[0].length),_({type:"text",value:u});continue}if(c&&(c.type==="globstar"||c.star===!0)){c.type="star",c.star=!0,c.value+=u,c.output=$,p.backtrack=!0,p.globstar=!0,V(u);continue}let g=W();if(e.noextglob!==!0&&/^\([^?]/.test(g)){Ot("star",u);continue}if(c.type==="star"){if(e.noglobstar===!0){V(u);continue}let m=c.prev,b=m.prev,H=m.type==="slash"||m.type==="bos",Z=b&&(b.type==="star"||b.type==="globstar");if(e.bash===!0&&(!H||g[0]&&g[0]!=="/")){_({type:"star",value:u,output:""});continue}let Y=p.braces>0&&(m.type==="comma"||m.type==="brace"),ke=P.length&&(m.type==="pipe"||m.type==="paren");if(!H&&m.type!=="paren"&&!Y&&!ke){_({type:"star",value:u,output:""});continue}for(;g.slice(0,3)==="/**";){let oe=n[p.index+4];if(oe&&oe!=="/")break;g=g.slice(3),V("/**",3)}if(m.type==="bos"&&G()){c.type="globstar",c.value+=u,c.output=F(e),p.output=c.output,p.globstar=!0,V(u);continue}if(m.type==="slash"&&m.prev.type!=="bos"&&!Z&&G()){p.output=p.output.slice(0,-(m.output+c.output).length),m.output=`(?:${m.output}`,c.type="globstar",c.output=F(e)+(e.strictSlashes?")":"|$)"),c.value+=u,p.globstar=!0,p.output+=m.output+c.output,V(u);continue}if(m.type==="slash"&&m.prev.type!=="bos"&&g[0]==="/"){let oe=g[1]!==void 0?"|$":"";p.output=p.output.slice(0,-(m.output+c.output).length),m.output=`(?:${m.output}`,c.type="globstar",c.output=`${F(e)}${C}|${C}${oe})`,c.value+=u,p.output+=m.output+c.output,p.globstar=!0,V(u+tt()),_({type:"slash",value:"/",output:""});continue}if(m.type==="bos"&&g[0]==="/"){c.type="globstar",c.value+=u,c.output=`(?:^|${C}|${F(e)}${C})`,p.output=c.output,p.globstar=!0,V(u+tt()),_({type:"slash",value:"/",output:""});continue}p.output=p.output.slice(0,-c.output.length),c.type="globstar",c.output=F(e),c.value+=u,p.output+=c.output,p.globstar=!0,V(u);continue}let B={type:"star",value:u,output:$};if(e.bash===!0){B.output=".*?",(c.type==="bos"||c.type==="slash")&&(B.output=y+B.output),_(B);continue}if(c&&(c.type==="bracket"||c.type==="paren")&&e.regex===!0){B.output=u,_(B);continue}(p.index===p.start||c.type==="slash"||c.type==="dot")&&(c.type==="dot"?(p.output+=U,c.output+=U):e.dot===!0?(p.output+=j,c.output+=j):(p.output+=y,c.output+=y),T()!=="*"&&(p.output+=S,c.output+=S)),_(B)}for(;p.brackets>0;){if(e.strictBrackets===!0)throw new SyntaxError($t("closing","]"));p.output=it.escapeLast(p.output,"["),gt("brackets")}for(;p.parens>0;){if(e.strictBrackets===!0)throw new SyntaxError($t("closing",")"));p.output=it.escapeLast(p.output,"("),gt("parens")}for(;p.braces>0;){if(e.strictBrackets===!0)throw new SyntaxError($t("closing","}"));p.output=it.escapeLast(p.output,"{"),gt("braces")}if(e.strictSlashes!==!0&&(c.type==="star"||c.type==="bracket")&&_({type:"maybe_slash",value:"",output:`${C}?`}),p.backtrack===!0){p.output="";for(let g of p.tokens)p.output+=g.output!=null?g.output:g.value,g.suffix&&(p.output+=g.suffix)}return p};ln.fastpaths=(n,t)=>{let e={...t},r=typeof e.maxLength=="number"?Math.min(ge,e.maxLength):ge,s=n.length;if(s>r)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${r}`);n=Or[n]||n;let i=it.isWindows(t),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:l,DOTS_SLASH:f,NO_DOT:h,NO_DOTS:d,NO_DOTS_SLASH:E,STAR:C,START_ANCHOR:S}=ve.globChars(i),R=e.dot?d:h,L=e.dot?E:h,U=e.capture?"":"?:",j={negated:!1,prefix:""},I=e.bash===!0?".*?":C;e.capture&&(I=`(${I})`);let q=y=>y.noglobstar===!0?I:`(${U}(?:(?!${S}${y.dot?f:o}).)*?)`,K=y=>{switch(y){case"*":return`${R}${l}${I}`;case".*":return`${o}${l}${I}`;case"*.*":return`${R}${I}${o}${l}${I}`;case"*/*":return`${R}${I}${a}${l}${L}${I}`;case"**":return R+q(e);case"**/*":return`(?:${R}${q(e)}${a})?${L}${l}${I}`;case"**/*.*":return`(?:${R}${q(e)}${a})?${L}${I}${o}${l}${I}`;case"**/.*":return`(?:${R}${q(e)}${a})?${o}${l}${I}`;default:{let x=/^(.*?)\.(\w+)$/.exec(y);if(!x)return;let $=K(x[1]);return $?$+o+x[2]:void 0}}},X=it.removePrefix(n,j),F=K(X);return F&&e.strictSlashes!==!0&&(F+=`${a}?`),F};Br.exports=ln});var kr=Bt((Bu,Nr)=>{"use strict";var Sa=pe(),Ta=Pr(),un=Dr(),hn=me(),Ra=Wt(),Ca=n=>n&&typeof n=="object"&&!Array.isArray(n),z=(n,t,e=!1)=>{if(Array.isArray(n)){let h=n.map(E=>z(E,t,e));return E=>{for(let C of h){let S=C(E);if(S)return S}return!1}}let r=Ca(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let s=t||{},i=hn.isWindows(t),o=r?z.compileRe(n,t):z.makeRe(n,t,!1,!0),a=o.state;delete o.state;let l=()=>!1;if(s.ignore){let h={...t,ignore:null,onMatch:null,onResult:null};l=z(s.ignore,h,e)}let f=(h,d=!1)=>{let{isMatch:E,match:C,output:S}=z.test(h,o,t,{glob:n,posix:i}),R={glob:n,state:a,regex:o,posix:i,input:h,output:S,match:C,isMatch:E};return typeof s.onResult=="function"&&s.onResult(R),E===!1?(R.isMatch=!1,d?R:!1):l(h)?(typeof s.onIgnore=="function"&&s.onIgnore(R),R.isMatch=!1,d?R:!1):(typeof s.onMatch=="function"&&s.onMatch(R),d?R:!0)};return e&&(f.state=a),f};z.test=(n,t,e,{glob:r,posix:s}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let i=e||{},o=i.format||(s?hn.toPosixSlashes:null),a=n===r,l=a&&o?o(n):n;return a===!1&&(l=o?o(n):n,a=l===r),(a===!1||i.capture===!0)&&(i.matchBase===!0||i.basename===!0?a=z.matchBase(n,t,e,s):a=t.exec(l)),{isMatch:Boolean(a),match:a,output:l}};z.matchBase=(n,t,e,r=hn.isWindows(e))=>(t instanceof RegExp?t:z.makeRe(t,e)).test(Sa.basename(n));z.isMatch=(n,t,e)=>z(t,e)(n);z.parse=(n,t)=>Array.isArray(n)?n.map(e=>z.parse(e,t)):un(n,{...t,fastpaths:!1});z.scan=(n,t)=>Ta(n,t);z.compileRe=(n,t,e=!1,r=!1)=>{if(e===!0)return n.output;let s=t||{},i=s.contains?"":"^",o=s.contains?"":"$",a=`${i}(?:${n.output})${o}`;n&&n.negated===!0&&(a=`^(?!${a}).*$`);let l=z.toRegex(a,t);return r===!0&&(l.state=n),l};z.makeRe=(n,t={},e=!1,r=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let s={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(s.output=un.fastpaths(n,t)),s.output||(s=un(n,t)),z.compileRe(s,t,e,r)};z.toRegex=(n,t)=>{try{let e=t||{};return new RegExp(n,e.flags||(e.nocase?"i":""))}catch(e){if(t&&t.debug===!0)throw e;return/$^/}};z.constants=Ra;Nr.exports=z});var Hr=Bt((Du,Ur)=>{"use strict";Ur.exports=kr()});var wi=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,Ei=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,Wn="noscale";var He="fit",Xn="scale",Vn="fill",Zn="stretch",Qn=300,Jn=150,tr=He,Ai=200,le=class extends HTMLElement{static create(t={}){let{root:e=document.body,mode:r=tr,width:s=Qn,height:i=Jn,debug:o=!1}=t||{},a=new le;return a.mode=r,a.width=s,a.height=i,a.debug=o,e.appendChild(a),a}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=wi,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Ei,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=t.querySelector("canvas"),this._contentElement=t.querySelector(".content"),this._innerElement=t.querySelector("#inner"),this._titleElement=t.querySelector("#title"),this._fpsElement=t.querySelector("#fps"),this._dimensionElement=t.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=Qn,this._height=Jn,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Kt(this,"mode"),Kt(this,"debug"),Kt(this,"disabled"),Kt(this,"width"),Kt(this,"height"),Kt(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",tr),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,r){switch(t){case"debug":this._debug=r!==null;break;case"disabled":this._disabled=r!==null;break;case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this);break}switch(t){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r);break}}getContext(t="2d",e=void 0){return this._canvasElement.getContext(t,e)}pause(){window.cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=window.requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=window.requestAnimationFrame(this.update),this.updateCanvasSize(!1);let e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let i=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._fpsElement.textContent!==i&&(this._fpsElement.textContent=i),this.mode===Wn){let a=`${this._width}x${this._height}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}else{let a=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}}let s=this._frameEvent.detail;s.now=t,s.prevTime=this._prevAnimationFrameTime,s.deltaTime=e,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=null,this.updateCanvasSize(!0)}delayCanvasResize(t,e){(t!==this._resizeCanvasWidth||e!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&window.clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=window.setTimeout(this.onDelayCanvasResize,Ai))}updateCanvasSize(t=!0){let e=this.shadowRoot.host.getBoundingClientRect(),r=e.width,s=e.height,i=this._canvasElement,o=this._width,a=this._height,l=this.mode;if(l===Zn||l===Vn)o=r,a=s;else if(l!==Wn&&(r<o||s<a||l===He||l==Xn)){let h=r/o,d=s/a;h<d?(o=r,a=a*h):(o=o*d,a=s)}if(o=Math.floor(o),a=Math.floor(a),typeof t=="undefined"&&(t=i.clientWidth!==o||i.clientHeight!==a),!t){this.delayCanvasResize(o,a);return}let f=Math.min(o/this._width,a/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${f}em`,t){l===Xn?(i.width=this._width,i.height=this._height):l!==Zn&&(i.width=o,i.height=a);let h=this._contentElement.style;h.width=`${o}px`,h.height=`${a}px`,(l===He||l===Vn)&&(this._width=o,this._height=a);let E=this._resizeEvent.detail;E.width=o,E.height=a,this.dispatchEvent(this._resizeEvent)}}};le.define();function Kt(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var Ke=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,r){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e=void 0){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Gt=class extends Ke{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array,r=this.constructor;for(let s=0;s<t;++s)e.push(r.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e=this._state,r=e.length,s;if(t<=r)s=e.slice(0,t);else{s=e;let i=this.constructor;for(let o=r;o<t;++o)s.push(i.createAxisBindingState())}this._state=s,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,r=0,s=0,i=e.length;for(let o=0;o<i;++o){let a=e[o];r+=a.value*(a.inverted?-1:1),s+=a.delta,e[o].delta=0}this._value=r,this._delta=s,super.onPoll(t)}onUpdate(t,e,r){typeof e=="undefined"?this.onAxisChange(t,r):this.onAxisMove(t,e,r)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e=void 0){super.onBind(t,e);let{inverted:r=!1}=e||{},s=this._state;s[t].inverted=r}onAxisMove(t,e,r){let s=this._state[t];s.value=e,s.delta+=r}onAxisChange(t,e){let r=this._state[t];r.value+=e,r.delta+=e}onAxisStatus(t,e){let r=this._state[t],s=r.value;r.value=e,r.delta=e-s}},xi=241,er=254,_i=239,Dt=1,$e=2,Fe=4,ze=8,je=16,ue=class extends Ke{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e=this._state,r=e.length,s;t<=r?s=e.slice(0,t):(s=new Uint8Array(t),s.set(e)),this._state=s,super.resize(t)}getState(t){let e=this._state[t],r=e&je?-1:1;return(e&Dt?1:0)*r}onPoll(t){let e=this._state,r=0,s=0,i=0,o=0,a=0,l=e.length;for(let f=0;f<l;++f){let h=e[f],d=h&Dt,E=h&je;s|=d,i|=h&$e,o|=h&Fe,a|=h&ze,r+=(d?1:0)*(E?-1:1),e[f]&=xi}this._value=r,this._down=s!==0,this._pressed=i!==0,this._repeated=o!==0,this._released=a!==0,super.onPoll(t)}onUpdate(t,e,r){r>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,e!==0)}onBind(t,e={inverted:!1}){super.onBind(t,e);let{inverted:r=!1}=e,s=this._state;r?s[t]|=je:s[t]&=_i}onButtonPressed(t){let e=this._state,r=e[t];r&Dt||(r|=$e,r|=Dt),r|=Fe,e[t]=r}onButtonReleased(t){let e=this._state,r=e[t];r&Dt&&(r|=ze,r&=er),e[t]=r}onButtonStatus(t,e){let r=this._state,s=r[t],i=Boolean(s&Dt);e?s|=Dt:s&=er,i&&!e&&(s|=ze),!i&&e&&(s|=$e,s|=Fe),r[t]=s}},v=class{static parse(t){t=t.trim();let e=t.indexOf(".");if(e<0)throw new Error("Missing device separator for key code.");let r=t.substring(0,e);if(r.length<0)throw new Error("Missing device for key code.");let s=t.substring(e+1);if(s.length<0)throw new Error("Missing code for key code.");return new v(r,s)}constructor(t,e){this.device=t,this.code=e}toString(){return`${this.device}.${this.code}`}};function nr(n,t){return new v(n,t)}function bi(n){return"device"in n&&"code"in n}var w="Keyboard",ht="Mouse",Si=new v(w,"KeyA"),Ti=new v(w,"KeyB"),Ri=new v(w,"KeyC"),Ci=new v(w,"KeyD"),Mi=new v(w,"KeyE"),Ii=new v(w,"KeyF"),Li=new v(w,"KeyG"),Pi=new v(w,"KeyH"),Oi=new v(w,"KeyI"),Bi=new v(w,"KeyJ"),Di=new v(w,"KeyK"),Ni=new v(w,"KeyL"),ki=new v(w,"KeyM"),Ui=new v(w,"KeyN"),Hi=new v(w,"KeyO"),Ki=new v(w,"KeyP"),$i=new v(w,"KeyQ"),Fi=new v(w,"KeyR"),zi=new v(w,"KeyS"),ji=new v(w,"KeyT"),Yi=new v(w,"KeyU"),qi=new v(w,"KeyV"),Gi=new v(w,"KeyW"),Wi=new v(w,"KeyX"),Xi=new v(w,"KeyY"),Vi=new v(w,"KeyZ"),Zi=new v(w,"Digit0"),Qi=new v(w,"Digit1"),Ji=new v(w,"Digit2"),to=new v(w,"Digit3"),eo=new v(w,"Digit4"),no=new v(w,"Digit5"),ro=new v(w,"Digit6"),so=new v(w,"Digit7"),io=new v(w,"Digit8"),oo=new v(w,"Digit9"),ao=new v(w,"Minus"),lo=new v(w,"Equal"),uo=new v(w,"BracketLeft"),ho=new v(w,"BracketRight"),co=new v(w,"Semicolon"),fo=new v(w,"Quote"),po=new v(w,"Backquote"),mo=new v(w,"Backslash"),vo=new v(w,"Comma"),go=new v(w,"Period"),yo=new v(w,"Slash"),wo=new v(w,"Escape"),Eo=new v(w,"Space"),Ao=new v(w,"CapsLock"),xo=new v(w,"Backspace"),_o=new v(w,"Delete"),bo=new v(w,"Tab"),So=new v(w,"Enter"),To=new v(w,"ArrowUp"),Ro=new v(w,"ArrowDown"),Co=new v(w,"ArrowLeft"),Mo=new v(w,"ArrowRight"),Io=new v(ht,"Button0"),Lo=new v(ht,"Button1"),Po=new v(ht,"Button2"),Oo=new v(ht,"Button3"),Bo=new v(ht,"Button4"),Do=new v(ht,"PosX"),No=new v(ht,"PosY"),ko=new v(ht,"WheelX"),Uo=new v(ht,"WheelY"),Ho=new v(ht,"WheelZ"),st=Object.freeze({__proto__:null,ARROW_DOWN:Ro,ARROW_LEFT:Co,ARROW_RIGHT:Mo,ARROW_UP:To,BACKQUOTE:po,BACKSLASH:mo,BACKSPACE:xo,BRACKET_LEFT:uo,BRACKET_RIGHT:ho,CAPS_LOCK:Ao,COMMA:vo,DELETE:_o,DIGIT_0:Zi,DIGIT_1:Qi,DIGIT_2:Ji,DIGIT_3:to,DIGIT_4:eo,DIGIT_5:no,DIGIT_6:ro,DIGIT_7:so,DIGIT_8:io,DIGIT_9:oo,ENTER:So,EQUAL:lo,ESCAPE:wo,KEYBOARD:w,KEY_A:Si,KEY_B:Ti,KEY_C:Ri,KEY_D:Ci,KEY_E:Mi,KEY_F:Ii,KEY_G:Li,KEY_H:Pi,KEY_I:Oi,KEY_J:Bi,KEY_K:Di,KEY_L:Ni,KEY_M:ki,KEY_N:Ui,KEY_O:Hi,KEY_P:Ki,KEY_Q:$i,KEY_R:Fi,KEY_S:zi,KEY_T:ji,KEY_U:Yi,KEY_V:qi,KEY_W:Gi,KEY_X:Wi,KEY_Y:Xi,KEY_Z:Vi,MINUS:ao,MOUSE:ht,MOUSE_BUTTON_0:Io,MOUSE_BUTTON_1:Lo,MOUSE_BUTTON_2:Po,MOUSE_BUTTON_3:Oo,MOUSE_BUTTON_4:Bo,MOUSE_POS_X:Do,MOUSE_POS_Y:No,MOUSE_WHEEL_X:ko,MOUSE_WHEEL_Y:Uo,MOUSE_WHEEL_Z:Ho,PERIOD:go,QUOTE:fo,SEMICOLON:co,SLASH:yo,SPACE:Eo,TAB:bo,from:nr,isKeyCode:bi}),rr=class{get polling(){return this.ref?this.ref.polling:!1}get value(){return!this.ref||this.disabled?0:this.ref.value}constructor(t){this.name=t,this.ref=null,this.disabled=!1}bindTo(t){throw new Error("Unsupported operation.")}disable(t=!0){return this.disabled=t,this}getState(t){return!this.ref||this.disabled?0:this.ref.getState(t)}};function Ko(n){Array.isArray(n)||(n=[n]);let t=[];for(let e of n){let r;try{r=v.parse(e)}catch(s){let i=$o(e).toUpperCase();if(!(i in st))throw new Error("Invalid key code string - "+s);r=st[i]}t.push(r)}return t}function $o(n){return n.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,function(t,e,r){return e+(r&&"_"+r)}).toLowerCase()}var ct=class extends rr{static fromBind(t,e,r,s=void 0){return new ct(t,nr(e,r),s)}static fromString(t,...e){let r=Ko(e);return new ct(t,r)}get pressed(){return!this.ref||this.disabled?!1:this.ref.pressed}get repeated(){return!this.ref||this.disabled?!1:this.ref.repeated}get released(){return!this.ref||this.disabled?!1:this.ref.released}get down(){return!this.ref||this.disabled?!1:this.ref.down}constructor(t,e,r=void 0){super(t);this.keyCodes=Array.isArray(e)?e:[e],this.opts=r}bindTo(t){let e=this.name,r=this.opts;for(let s of this.keyCodes)t.bindButton(e,s.device,s.code,r);return this.ref=t.getButton(e),this}};var Ye=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let r=this.listeners;t in r?r[t].push(e):r[t]=[e]}removeEventListener(t,e){let r=this.listeners;if(t in r){let s=r[t],i=s.indexOf(e);i>=0&&s.splice(i,1)}}dispatchInputEvent(t){let e=0;for(let r of this.listeners.input)e|=r(t);return Boolean(e)}},sr=class extends Ye{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,r={}){super(t,e);let{ignoreRepeat:s=!0}=r;this.ignoreRepeat=s,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;if(e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}},qe=10,Ge=100,ir=class extends Ye{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,e,r={}){super(t,e);let{eventsOnFocus:s=!0}=r;this.eventsOnFocus=s,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,r,s;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=t.deltaX*qe,r=t.deltaY*qe,s=t.deltaZ*qe;break;case WheelEvent.DOM_DELTA_PAGE:e=t.deltaX*Ge,r=t.deltaY*Ge,s=t.deltaZ*Ge;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,r=t.deltaY,s=t.deltaZ;break}let i=0,o=this._wheelObject;if(o.code="WheelX",o.movement=e,i|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=r,i|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=s,i|=this.dispatchInputEvent(o),i)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;if(e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let e=this.canvasTarget,{clientWidth:r,clientHeight:s}=e,i=e.getBoundingClientRect(),o=t.movementX/r,a=t.movementY/s,l=(t.clientX-i.left)/r,f=(t.clientY-i.top)/s,h=this._positionObject;h.code="PosX",h.value=l,h.movement=o,this.dispatchInputEvent(h),h.code="PosY",h.value=f,h.movement=a,this.dispatchInputEvent(h)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},Fo=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,zo=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,We=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Fo,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=zo,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();let t=this.constructor,e=this.attachShadow({mode:"open"});e.appendChild(t[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(t[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=e.querySelector("kbd"),this._nameElement=e.querySelector("#name"),this._valueElement=e.querySelector("#value")}attributeChangedCallback(t,e,r){switch(t){case"name":this._name=r,this._nameElement.textContent=r;break;case"value":this._value=r,r!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=r,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=r!==null,this._kbdElement.classList.toggle("disabled",r!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};We.define();var jo=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,Yo=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,or=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},ar=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){let{device:e,code:r,event:s,value:i,movement:o,control:a,shift:l,alt:f}=t,h=this.bindings.getBindings(e,r);switch(s){case"pressed":for(let{input:d,index:E}of h)d.onUpdate(E,1,1);break;case"released":for(let{input:d,index:E}of h)d.onUpdate(E,0,-1);break;case"move":for(let{input:d,index:E}of h)d.onUpdate(E,i,o);break;case"wheel":for(let{input:d,index:E}of h)d.onUpdate(E,void 0,o);break}return h.length>0}},Xe=class{constructor(t,e,r,s){this.device=t,this.code=e,this.input=r,this.index=s}},lr=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,r,s={inverted:!1}){let i,o=this.inputMap;if(o.has(t)){let l=o.get(t),f=t.size;t.onBind(f,s),i=new Xe(e,r,t,f),l.push(i)}else{let l=[];o.set(t,l);let f=0;t.onBind(f,s),i=new Xe(e,r,t,f),l.push(i)}let a=this.bindingMap;e in a?r in a[e]?a[e][r].push(i):a[e][r]=[i]:a[e]={[r]:[i]}}unbind(t){let e=this.inputMap;if(e.has(t)){let r=this.bindingMap,s=e.get(t);for(let i of s){let{device:o,code:a}=i,l=r[o][a],f=l.indexOf(i);l.splice(f,1)}s.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let r=this.bindingMap;if(t in r){let s=r[t];if(e in s)return s[e]}return[]}},ur=class{constructor(t,e=void 0){this.inputs={},this.devices=[new ir("Mouse",t),new sr("Keyboard",t)],this.bindings=new lr,this.adapter=new ar(this.bindings),this.autopoller=new or(this.adapter),this.eventTarget=t,this.anyButton=new ue(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Gt(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let r of this.devices)r.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let r in t)t[r].length=0;this.autopoller.running&&this.autopoller.stop();for(let r of this.devices)r.removeEventListener("input",this.onInput),r.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let r of this.devices)r.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let e=this.autopoller.running,r=typeof t=="undefined"?!e:Boolean(t);r!==e&&(r?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let r=this.listeners;t in r?r[t].push(e):r[t]=[e]}removeEventListener(t,e){let r=this.listeners;if(t in r){let s=r[t],i=s.indexOf(e);i>=0&&s.splice(i,1)}}dispatchEvent(t){let{type:e}=t,r=0;for(let s of this.listeners[e])r|=s(t)?1:0;return Boolean(r)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){Array.isArray(t)||(t=Object.values(t));for(let e of t)e.bindTo(this)}bindBinding(t){t.bindTo(this)}bindButton(t,e,r,s=void 0){let i;this.hasButton(t)?i=this.getButton(t):(i=new ue(1),this.inputs[t]=i),this.bindings.bind(i,e,r,s),this.onBind()}bindAxis(t,e,r,s=void 0){let i;this.hasAxis(t)?i=this.getAxis(t):(i=new Gt(1),this.inputs[t]=i),this.bindings.bind(i,e,r,s),this.onBind()}bindAxisButtons(t,e,r,s){let i;this.hasAxis(t)?i=this.getAxis(t):(i=new Gt(2),this.inputs[t]=i),this.bindings.bind(i,e,s),this.bindings.bind(i,e,r,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof ue}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Gt}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let e=this.inputs;for(let r of t)if(e[r].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let e=this.inputs;for(let r of t)if(e[r].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let e=this.inputs;for(let r of t)if(e[r].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let e=this.inputs;for(let r of t){let s=e[r];if(s.value)return s.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let e=this.inputs;for(let r of t){let s=e[r];if(s.delta)return s.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},he=class extends HTMLElement{static create(t={}){let{root:e=document.body,for:r=void 0,autopoll:s=!1}=t||{},i=new he;return i.for=r,i.autopoll=s,e.appendChild(i),i}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=jo,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Yo,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=t.querySelector("#title"),this._pollElement=t.querySelector("#poll"),this._focusElement=t.querySelector("#focus"),this._bodyElement=t.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let e=this;this._for="",this._eventTarget=e,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let t=this._context;t&&(t.removeEventListener("bind",this.onInputContextBind),t.removeEventListener("unbind",this.onInputContextUnbind),t.removeEventListener("blur",this.onInputContextBlur),t.removeEventListener("focus",this.onInputContextFocus),t.destroy(),this._context=null)}attributeChangedCallback(t,e,r){switch(t){case"for":{this._for=r;let s,i;r?(s=document.getElementById(r),i=`${s.tagName.toLowerCase()}#${r}`):(s=this,i="input-port"),this._eventTarget=s,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${i}`}break;case"autopoll":this._autopoll=r!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(t="axisbutton",e=void 0){switch(t){case"axisbutton":if(!this._context){let r=new ur(this._eventTarget,e);r.addEventListener("bind",this.onInputContextBind),r.addEventListener("unbind",this.onInputContextUnbind),r.addEventListener("blur",this.onInputContextBlur),r.addEventListener("focus",this.onInputContextFocus),this._autopoll&&r.toggleAutoPoll(!0),this._context=r}return this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,e=t.inputs,r=t.bindings,s={},i=[];for(let o of Object.keys(e)){let a=e[o],l=!0;for(let f of r.getBindingsByInput(a)){let h=qo(`${a.constructor.name}.${o}`,`${f.device}.${f.code}`,0,l);i.push(h),l&&(s[o]=h.querySelector("output"),l=!1)}}this._outputElements=s,this._bodyElement.innerHTML="";for(let o of i)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let r of Object.keys(this._outputElements)){let s=this._outputElements[r],i=e[r].value;s.innerText=Number(i).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let e=this._outputElements[t];e.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let r of Object.values(e))if(!r.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};he.define();function qo(n,t,e,r=!0){let s=document.createElement("tr");r&&s.classList.add("primary");{let i=document.createElement("td");i.textContent=n,i.classList.add("name"),s.appendChild(i)}{let i=document.createElement("td"),o=document.createElement("output");r?o.innerText=Number(e).toFixed(2):o.innerText="---",o.classList.add("value"),i.appendChild(o),s.appendChild(i)}{let i=document.createElement("td");i.classList.add("key");let o=new We;o.innerText=t,i.appendChild(o),s.appendChild(i)}return s}var Tu=Symbol("keyboardSource");var Ru=Symbol("mouseSource");var rs=yi(Hr());var Kr={},Ma=function(n,t,e,r,s){var i=new Worker(Kr[t]||(Kr[t]=URL.createObjectURL(new Blob([n+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return i.onmessage=function(o){var a=o.data,l=a.$e$;if(l){var f=new Error(l[0]);f.code=l[1],f.stack=l[2],s(f,null)}else s(null,a)},i.postMessage(e,r),i},Q=Uint8Array,It=Uint16Array,cn=Uint32Array,fn=new Q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pn=new Q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$r=new Q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fr=function(n,t){for(var e=new It(31),r=0;r<31;++r)e[r]=t+=1<<n[r-1];for(var s=new cn(e[30]),r=1;r<30;++r)for(var i=e[r];i<e[r+1];++i)s[i]=i-e[r]<<5|r;return[e,s]},zr=Fr(fn,2),dn=zr[0],Ia=zr[1];dn[28]=258,Ia[258]=28;var jr=Fr(pn,0),Yr=jr[0],Nu=jr[1],ye=new It(32768);for(var D=0;D<32768;++D)bt=(D&43690)>>>1|(D&21845)<<1,bt=(bt&52428)>>>2|(bt&13107)<<2,bt=(bt&61680)>>>4|(bt&3855)<<4,ye[D]=((bt&65280)>>>8|(bt&255)<<8)>>>1;var bt,Ft=function(n,t,e){for(var r=n.length,s=0,i=new It(t);s<r;++s)n[s]&&++i[n[s]-1];var o=new It(t);for(s=0;s<t;++s)o[s]=o[s-1]+i[s-1]<<1;var a;if(e){a=new It(1<<t);var l=15-t;for(s=0;s<r;++s)if(n[s])for(var f=s<<4|n[s],h=t-n[s],d=o[n[s]-1]++<<h,E=d|(1<<h)-1;d<=E;++d)a[ye[d]>>>l]=f}else for(a=new It(r),s=0;s<r;++s)n[s]&&(a[s]=ye[o[n[s]-1]++]>>>15-n[s]);return a},Vt=new Q(288);for(var D=0;D<144;++D)Vt[D]=8;for(var D=144;D<256;++D)Vt[D]=9;for(var D=256;D<280;++D)Vt[D]=7;for(var D=280;D<288;++D)Vt[D]=8;var qr=new Q(32);for(var D=0;D<32;++D)qr[D]=5;var Gr=Ft(Vt,9,1);var Wr=Ft(qr,5,1),we=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},at=function(n,t,e){var r=t/8|0;return(n[r]|n[r+1]<<8)>>(t&7)&e},Ee=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},Xr=function(n){return(n+7)/8|0},Ae=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var r=new(n.BYTES_PER_ELEMENT==2?It:n.BYTES_PER_ELEMENT==4?cn:Q)(e-t);return r.set(n.subarray(t,e)),r};var Vr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],nt=function(n,t,e){var r=new Error(t||Vr[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,nt),!e)throw r;return r},Zr=function(n,t,e){var r=n.length;if(!r||e&&e.f&&!e.l)return t||new Q(0);var s=!t||e,i=!e||e.i;e||(e={}),t||(t=new Q(r*3));var o=function(_){var Ot=t.length;if(_>Ot){var ie=new Q(Math.max(Ot*2,_));ie.set(t),t=ie}},a=e.f||0,l=e.p||0,f=e.b||0,h=e.l,d=e.d,E=e.m,C=e.n,S=r*8;do{if(!h){a=at(n,l,1);var R=at(n,l+1,3);if(l+=3,R)if(R==1)h=Gr,d=Wr,E=9,C=5;else if(R==2){var I=at(n,l,31)+257,q=at(n,l+10,15)+4,K=I+at(n,l+5,31)+1;l+=14;for(var X=new Q(K),F=new Q(19),y=0;y<q;++y)F[$r[y]]=at(n,l+y*3,7);l+=q*3;for(var x=we(F),$=(1<<x)-1,p=Ft(F,x,1),y=0;y<K;){var P=p[at(n,l,$)];l+=P&15;var L=P>>>4;if(L<16)X[y++]=L;else{var M=0,rt=0;for(L==16?(rt=3+at(n,l,3),l+=2,M=X[y-1]):L==17?(rt=3+at(n,l,7),l+=3):L==18&&(rt=11+at(n,l,127),l+=7);rt--;)X[y++]=M}}var c=X.subarray(0,I),u=X.subarray(I);E=we(c),C=we(u),h=Ft(c,E,1),d=Ft(u,C,1)}else nt(1);else{var L=Xr(l)+4,U=n[L-4]|n[L-3]<<8,j=L+U;if(j>r){i&&nt(0);break}s&&o(f+U),t.set(n.subarray(L,j),f),e.b=f+=U,e.p=l=j*8,e.f=a;continue}if(l>S){i&&nt(0);break}}s&&o(f+131072);for(var G=(1<<E)-1,T=(1<<C)-1,tt=l;;tt=l){var M=h[Ee(n,l)&G],W=M>>>4;if(l+=M&15,l>S){i&&nt(0);break}if(M||nt(2),W<256)t[f++]=W;else if(W==256){tt=l,h=null;break}else{var V=W-254;if(W>264){var y=W-257,vt=fn[y];V=at(n,l,(1<<vt)-1)+dn[y],l+=vt}var qt=d[Ee(n,l)&T],Mt=qt>>>4;qt||nt(3),l+=qt&15;var u=Yr[Mt];if(Mt>3){var vt=pn[Mt];u+=Ee(n,l)&(1<<vt)-1,l+=vt}if(l>S){i&&nt(0);break}s&&o(f+131072);for(var gt=f+V;f<gt;f+=4)t[f]=t[f-u],t[f+1]=t[f+1-u],t[f+2]=t[f+2-u],t[f+3]=t[f+3-u];f=gt}}e.l=h,e.p=tt,e.b=f,e.f=a,h&&(a=1,e.m=E,e.d=d,e.n=C)}while(!a);return f==t.length?t:Ae(t,0,f)};var La=new Q(0);var Pa=function(n,t){var e={};for(var r in n)e[r]=n[r];for(var r in t)e[r]=t[r];return e},Qr=function(n,t,e){for(var r=n(),s=n.toString(),i=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<r.length;++o){var a=r[o],l=i[o];if(typeof a=="function"){t+=";"+l+"=";var f=a.toString();if(a.prototype)if(f.indexOf("[native code]")!=-1){var h=f.indexOf(" ",8)+1;t+=f.slice(h,f.indexOf("(",h))}else{t+=f;for(var d in a.prototype)t+=";"+l+".prototype."+d+"="+a.prototype[d].toString()}else t+=f}else e[l]=a}return[t,e]},xe=[],Oa=function(n){var t=[];for(var e in n)n[e].buffer&&t.push((n[e]=new n[e].constructor(n[e])).buffer);return t},Ba=function(n,t,e,r){var s;if(!xe[e]){for(var i="",o={},a=n.length-1,l=0;l<a;++l)s=Qr(n[l],i,o),i=s[0],o=s[1];xe[e]=Qr(n[a],i,o)}var f=Pa({},xe[e][1]);return Ma(xe[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",e,f,Oa(f),r)},Da=function(){return[Q,It,cn,fn,pn,$r,dn,Yr,Gr,Wr,ye,Vr,Ft,we,at,Ee,Xr,Ae,nt,Zr,vn,Jr,ts]};var Jr=function(n){return postMessage(n,[n.buffer])},ts=function(n){return n&&n.size&&new Q(n.size)},Na=function(n,t,e,r,s,i){var o=Ba(e,r,s,function(a,l){o.terminate(),i(a,l)});return o.postMessage([n,t],t.consume?[n.buffer]:[]),function(){o.terminate()}};var wt=function(n,t){return n[t]|n[t+1]<<8},ft=function(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0},mn=function(n,t){return ft(n,t)+ft(n,t+4)*4294967296};function ka(n,t,e){return e||(e=t,t={}),typeof e!="function"&&nt(7),Na(n,t,[Da],function(r){return Jr(vn(r.data[0],ts(r.data[1])))},1,e)}function vn(n,t){return Zr(n,t)}var ku=typeof TextEncoder!="undefined"&&new TextEncoder,gn=typeof TextDecoder!="undefined"&&new TextDecoder,Ua=0;try{gn.decode(La,{stream:!0}),Ua=1}catch(n){}var Ha=function(n){for(var t="",e=0;;){var r=n[e++],s=(r>127)+(r>223)+(r>239);if(e+s>n.length)return[t,Ae(n,e-1)];s?s==3?(r=((r&15)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):s&1?t+=String.fromCharCode((r&31)<<6|n[e++]&63):t+=String.fromCharCode((r&15)<<12|(n[e++]&63)<<6|n[e++]&63):t+=String.fromCharCode(r)}};function Ka(n,t){if(t){for(var e="",r=0;r<n.length;r+=16384)e+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return e}else{if(gn)return gn.decode(n);var s=Ha(n),i=s[0],o=s[1];return o.length&&nt(8),i}}var $a=function(n,t){return t+30+wt(n,t+26)+wt(n,t+28)},Fa=function(n,t,e){var r=wt(n,t+28),s=Ka(n.subarray(t+46,t+46+r),!(wt(n,t+8)&2048)),i=t+46+r,o=ft(n,t+20),a=e&&o==4294967295?za(n,i):[o,ft(n,t+24),ft(n,t+42)],l=a[0],f=a[1],h=a[2];return[wt(n,t+10),l,f,s,i+wt(n,t+30)+wt(n,t+32),h]},za=function(n,t){for(;wt(n,t)!=1;t+=4+wt(n,t+2));return[mn(n,t+12),mn(n,t+4),mn(n,t+20)]};var es=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(n){n()};function ns(n,t,e){e||(e=t,t={}),typeof e!="function"&&nt(7);var r=[],s=function(){for(var L=0;L<r.length;++L)r[L]()},i={},o=function(L,U){es(function(){e(L,U)})};es(function(){o=e});for(var a=n.length-22;ft(n,a)!=101010256;--a)if(!a||n.length-a>65558)return o(nt(13,0,1),null),s;var l=wt(n,a+8);if(l){var f=l,h=ft(n,a+16),d=h==4294967295||f==65535;if(d){var E=ft(n,a-12);d=ft(n,E)==101075792,d&&(f=l=ft(n,E+32),h=ft(n,E+48))}for(var C=t&&t.filter,S=function(L){var U=Fa(n,h,d),j=U[0],I=U[1],q=U[2],K=U[3],X=U[4],F=U[5],y=$a(n,F);h=X;var x=function(p,P){p?(s(),o(p,null)):(P&&(i[K]=P),--l||o(null,i))};if(!C||C({name:K,size:I,originalSize:q,compression:j}))if(!j)x(null,Ae(n,y,y+I));else if(j==8){var $=n.subarray(y,y+I);if(I<32e4)try{x(null,vn($,new Q(q)))}catch(p){x(p,null)}else r.push(ka($,{size:q},x))}else x(nt(14,"unknown compression type "+j,1),null);else x(null,null)},R=0;R<f;++R)S(R)}else o(null,{});return s}var Zt=class{constructor(t){let e;typeof t=="object"&&t instanceof Zt?e=t.source:e=String(t),this.source=e,this._re=(0,rs.makeRe)(e)}test(t){return this._re.test(t)}},ja=/^([_\w\d]+)\:\/\//;async function ss(n,t,e,r,s,i){let{loadings:o}=n,a;t in o?a=o[t]:(a=new zt(i),o[t]=a);let l=zt.nextAttempt(a),f=[a.promise];return ja.test(e)?f.push(is(n,e,i).then(h=>r(h,s)).then(h=>zt.isCurrentAttempt(a,l)?Qt(n,t,h):void 0)):f.push(fetch(e).then(h=>h.arrayBuffer()).then(h=>r(h)).then(h=>zt.isCurrentAttempt(a,l)?Qt(n,t,h):void 0)),await Promise.race(f)}function Qt(n,t,e){let{store:r,loadings:s}=n;return r[t]=e,t in s&&(s[t].resolve(e),delete s[t]),e}function Ya(n,t,e){let{defaults:r}=n;typeof t=="string"&&(t=new Zt(t));let s=`__default://[${r.length}]`;return Qt(n,s,e),r.push(new ls(t,s)),e}function qa(n,t){let{store:e,loadings:r}=n;t in r&&(r[t].reject(new Error("Stop loading to delete asset.")),delete r[t]),t in e&&delete e[t]}function Ga(n,t){typeof t=="string"&&(t=new Zt(t));let{store:e,loadings:r}=n;for(let[s,i]of Object.entries(r))t.test(s)&&(i.reject(new Error(`Stop loading to clear assets matching ${t}`)),delete r[s]);for(let s of Object.keys(e))t.test(s)&&delete e[s]}function Wa(n){let{store:t,loadings:e,defaults:r}=n;for(let[s,i]of Object.entries(e))i.reject(new Error("Stop loading to clear all assets.")),delete e[s];for(let s of Object.keys(t))delete t[s];r.length=0}function Xa(n,t){let{loadings:e}=n;return t in e?e[t].promise:null}async function is(n,t,e){let{store:r,loadings:s}=n;if(t in r)return r[t];if(t in s)return s[t].promise;{let i=new zt(e);return s[t]=i,i.promise}}function Va(n,t){let{defaults:e}=n;for(let r of e)if(r.glob.test(t))return _e(n,r.uri);return null}function _e(n,t){return n.store[t]}function Za(n,t){return Boolean(n.store[t])}function Qa(n){return Object.keys(n.store)}function os(n,t){return t in n.store}function as(n,t){return t in n.loadings}var ls=class{constructor(t,e){this.glob=t,this.uri=e}},zt=class{static nextAttempt(t){return++t._promiseHandle}static isCurrentAttempt(t,e){return t._promiseHandle===e}constructor(t){this._promiseHandle=0,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(t)&&t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((e,r)=>{this._value?e(this._value):this._resolve=e,this._reason?r(this._reason):this._reject=r})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}},yn=class{constructor(t=null){this.parent=t,this.store={},this.loadings={},this.defaults=[]}get(t){let e=this;if(os(e,t))return _e(e,t);let r=Va(e,t);return r||null}async resolve(t,e,r,s,i){return this.get(t)||await this.load(t,e,r,s,i)}fallback(t,e){return Ya(this,t,e)}cache(t,e){return Qt(this,t,e)}async load(t,e,r,s,i){let o=this;return os(o,t)?_e(o,t):as(o,t)?await is(o,t,i):await ss(o,t,e,r,s,i)}async reload(t,e,r,s,i){return await ss(this,t,e,r,s,i)}unload(t){qa(this,t)}clear(t){Ga(this,t)}current(t){return _e(this,t)}exists(t){return Za(this,t)}loading(t){let e=this;return as(e,t)?Xa(e,t):null}keys(){return Qa(this)}reset(){Wa(this)}},us=5e3,J=class{constructor(t,e,r=void 0,s=t,i=null){this.uri=t,this.loader=e,this.opts=r,this.initial=i,this.filepath=s,this.source=null,this.current=null}cache(t,e){return t.cache(this.uri,e),this.source=t,this.current=e,this}get(t){let e;return t.exists(this.uri)?e=t.current(this.uri):this.initial&&this.initial instanceof J?e=this.initial.get(t):e=this.initial,this.source=t,this.current=e,e}async load(t,e=us){let r;if(t.exists(this.uri))r=t.current(this.uri);else if(r=await t.load(this.uri,this.filepath,this.loader,this.opts,e),!r)if(this.initial&&this.initial instanceof J){let s=this.initial;r=await t.load(s.uri,s.filepath,s.loader,s.opts,e)}else r=this.initial;return this.source=t,this.current=r,r}async reload(t,e=us){let r=await t.reload(this.uri,this.filepath,this.loader,this.opts,e);return this.source=t,this.current=r,r}};async function be(n,t,e=void 0){let r=n,s="raw://",o=await(await fetch(t)).arrayBuffer();await new Promise((a,l)=>{ns(new Uint8Array(o),(f,h)=>{if(f)l(f);else{for(let[d,E]of Object.entries(h)){d=d.replaceAll("\\","/");let C=d.indexOf("/");C>=0&&(d=d.substring(C+1));let S=s+d;Qt(r,S,E),e&&e(E,S,d)}a()}})})}async function hs(n,t,e=5e3){let r=[];for(let s of t)r.push(s.load(n,e));await Promise.allSettled(r)}window.addEventListener("error",cs,!0);window.addEventListener("unhandledrejection",cs,!0);function cs(n){n instanceof PromiseRejectionEvent?window.alert(n.reason.stack):n instanceof ErrorEvent?window.alert(n.error.stack):window.alert(JSON.stringify(n))}var Se=1e-6,Jt=typeof Float32Array!="undefined"?Float32Array:Array,wn=Math.random;var Fu=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Te={};Ue(Te,{add:()=>rl,angle:()=>Sl,bezier:()=>gl,ceil:()=>sl,clone:()=>Ja,copy:()=>el,create:()=>fs,cross:()=>dl,dist:()=>Ol,distance:()=>gs,div:()=>Pl,divide:()=>vs,dot:()=>Es,equals:()=>Ml,exactEquals:()=>Cl,floor:()=>il,forEach:()=>kl,fromValues:()=>tl,hermite:()=>vl,inverse:()=>fl,len:()=>Dl,length:()=>ps,lerp:()=>ml,max:()=>al,min:()=>ol,mul:()=>Ll,multiply:()=>ms,negate:()=>cl,normalize:()=>pl,random:()=>yl,rotateX:()=>xl,rotateY:()=>_l,rotateZ:()=>bl,round:()=>ll,scale:()=>ul,scaleAndAdd:()=>hl,set:()=>nl,sqrDist:()=>Bl,sqrLen:()=>Nl,squaredDistance:()=>ys,squaredLength:()=>ws,str:()=>Rl,sub:()=>Il,subtract:()=>ds,transformMat3:()=>El,transformMat4:()=>wl,transformQuat:()=>Al,zero:()=>Tl});function fs(){var n=new Jt(3);return Jt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ja(n){var t=new Jt(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function ps(n){var t=n[0],e=n[1],r=n[2];return Math.hypot(t,e,r)}function tl(n,t,e){var r=new Jt(3);return r[0]=n,r[1]=t,r[2]=e,r}function el(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function nl(n,t,e,r){return n[0]=t,n[1]=e,n[2]=r,n}function rl(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function ds(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function ms(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function vs(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function sl(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function il(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function ol(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function al(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function ll(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function ul(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function hl(n,t,e,r){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function gs(n,t){var e=t[0]-n[0],r=t[1]-n[1],s=t[2]-n[2];return Math.hypot(e,r,s)}function ys(n,t){var e=t[0]-n[0],r=t[1]-n[1],s=t[2]-n[2];return e*e+r*r+s*s}function ws(n){var t=n[0],e=n[1],r=n[2];return t*t+e*e+r*r}function cl(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function fl(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function pl(n,t){var e=t[0],r=t[1],s=t[2],i=e*e+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Es(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function dl(n,t,e){var r=t[0],s=t[1],i=t[2],o=e[0],a=e[1],l=e[2];return n[0]=s*l-i*a,n[1]=i*o-r*l,n[2]=r*a-s*o,n}function ml(n,t,e,r){var s=t[0],i=t[1],o=t[2];return n[0]=s+r*(e[0]-s),n[1]=i+r*(e[1]-i),n[2]=o+r*(e[2]-o),n}function vl(n,t,e,r,s,i){var o=i*i,a=o*(2*i-3)+1,l=o*(i-2)+i,f=o*(i-1),h=o*(3-2*i);return n[0]=t[0]*a+e[0]*l+r[0]*f+s[0]*h,n[1]=t[1]*a+e[1]*l+r[1]*f+s[1]*h,n[2]=t[2]*a+e[2]*l+r[2]*f+s[2]*h,n}function gl(n,t,e,r,s,i){var o=1-i,a=o*o,l=i*i,f=a*o,h=3*i*a,d=3*l*o,E=l*i;return n[0]=t[0]*f+e[0]*h+r[0]*d+s[0]*E,n[1]=t[1]*f+e[1]*h+r[1]*d+s[1]*E,n[2]=t[2]*f+e[2]*h+r[2]*d+s[2]*E,n}function yl(n,t){t=t||1;var e=wn()*2*Math.PI,r=wn()*2-1,s=Math.sqrt(1-r*r)*t;return n[0]=Math.cos(e)*s,n[1]=Math.sin(e)*s,n[2]=r*t,n}function wl(n,t,e){var r=t[0],s=t[1],i=t[2],o=e[3]*r+e[7]*s+e[11]*i+e[15];return o=o||1,n[0]=(e[0]*r+e[4]*s+e[8]*i+e[12])/o,n[1]=(e[1]*r+e[5]*s+e[9]*i+e[13])/o,n[2]=(e[2]*r+e[6]*s+e[10]*i+e[14])/o,n}function El(n,t,e){var r=t[0],s=t[1],i=t[2];return n[0]=r*e[0]+s*e[3]+i*e[6],n[1]=r*e[1]+s*e[4]+i*e[7],n[2]=r*e[2]+s*e[5]+i*e[8],n}function Al(n,t,e){var r=e[0],s=e[1],i=e[2],o=e[3],a=t[0],l=t[1],f=t[2],h=s*f-i*l,d=i*a-r*f,E=r*l-s*a,C=s*E-i*d,S=i*h-r*E,R=r*d-s*h,L=o*2;return h*=L,d*=L,E*=L,C*=2,S*=2,R*=2,n[0]=a+h+C,n[1]=l+d+S,n[2]=f+E+R,n}function xl(n,t,e,r){var s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function _l(n,t,e,r){var s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function bl(n,t,e,r){var s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Sl(n,t){var e=n[0],r=n[1],s=n[2],i=t[0],o=t[1],a=t[2],l=Math.sqrt(e*e+r*r+s*s),f=Math.sqrt(i*i+o*o+a*a),h=l*f,d=h&&Es(n,t)/h;return Math.acos(Math.min(Math.max(d,-1),1))}function Tl(n){return n[0]=0,n[1]=0,n[2]=0,n}function Rl(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Cl(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function Ml(n,t){var e=n[0],r=n[1],s=n[2],i=t[0],o=t[1],a=t[2];return Math.abs(e-i)<=Se*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-o)<=Se*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Se*Math.max(1,Math.abs(s),Math.abs(a))}var Il=ds,Ll=ms,Pl=vs,Ol=gs,Bl=ys,Dl=ps,Nl=ws,kl=function(){var n=fs();return function(t,e,r,s,i,o){var a,l;for(e||(e=3),r||(r=0),s?l=Math.min(s*e+r,t.length):l=t.length,a=r;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],i(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();var Vu=Te.fromValues(0,1,0);var Zu=Math.PI/3;var Qu=Math.PI/180;var St=class{constructor(t,e=()=>null,r=()=>{}){this.name=t,this.new=e,this.delete=r}};function kt(n,t){let e=n.components;if(t in e)return e[t];{let r={};return e[t]=r,r}}function Ul(n,t){let e=n.components,r={};return e[t]=r,r}function As(n,t,e,r){let s=e.name,i=kt(n,s);return i[t]=r,r}function xs(n,t,e){let r=e.name,s=kt(n,r),i=s[t];delete s[t],e.delete(i)}function _s(n,t){let e=t.name,r=kt(n,e),s=Object.values(r);Ul(n,e);for(let i of s)t.delete(i)}var En=Symbol("nextAvailableEntityId");function bs(n){return++n[En]}var An=class{constructor(){this.components={},this[En]=1,this.queue=[]}flush(){for(;this.queue.length>0;){let[t,...e]=this.queue.shift();switch(t){case"attach":{let[r,s,i]=e;As(this,r,s,i)}break;case"detach":{let[r,s]=e;xs(this,r,s)}break;case"clear":{let[r]=e;_s(this,r)}break}}}createAndAttach(...t){let e=bs(this),r=[e];for(let s of t){let i=this.attach(e,s);r.push(i)}return r}create(){return bs(this)}destroy(t){for(let e of Object.values(this.components))t in e&&delete e[t]}exists(t){for(let e of Object.values(this.components))if(t in e)return!0;return!1}attach(t,e){let r=e.new();return this.queue.push(["attach",t,e,r]),r}attachImmediately(t,e){let r=e.new();return As(this,t,e,r)}detach(t,e){this.queue.push(["detach",t,e])}detachImmediately(t,e){xs(this,t,e)}clear(t){this.queue.push(["clear",t])}clearImmediately(t){_s(this,t)}get(t,e){let r=e.name,s=kt(this,r);return s?null:s[t]||null}count(t){let e=t.name,r=kt(this,e);return r?0:Object.keys(r).length}reset(){this.components={},this[En]=1,this.queue.length=0}};var Tt=class{constructor(...t){this.selectors=t}count(t){let e=0,r=this.findAll(t);for(;!r.next().done;)++e;return e}find(t){let r=this.findAll(t).next();return r.done?[]:r.value}*findAll(t){if(this.selectors.length<=0)return;let r=this.selectors[0].name,s=kt(t,r),i=new Array(this.selectors.length+1);for(let o of Object.keys(s)){let a=Number(o),l=!0;i[0]=a;let f=1;for(let h of this.selectors){let d=h.name,E=kt(t,d);if(!(a in E)){l=!1;break}let C=E[a];i[f++]=C}l&&(yield i)}}},xn=class{dispatch(t=null){}dispatchImmediately(t=null){}flush(t=1e3){}};var Ut=class extends xn{constructor(){super();this.listeners=[],this.queued=[]}on(t){return this.listeners.push(t),this}off(t){let e=this.listeners.indexOf(t);return e>=0&&this.listeners.splice(e,1),this}once(t){let e=r=>(this.off(e),t(r));return this.on(e),this}dispatch(t=null){this.queued.push(t)}dispatchImmediately(t=null){for(let e of this.listeners)if(e(t)===!0)break}flush(t=1e3){let e=0;for(;this.queued.length>0&&e++<t;){let r=this.queued.shift();this.dispatchImmediately(r)}}count(){return this.listeners.length}};function Hl(n,t){return n.priority-t.priority}var _n=class extends xn{constructor(){super();this.listeners=[],this.queued=[]}on(t,e){return this.listeners.push({priority:t,callback:e}),this.listeners.sort(Hl),this}off(t){for(let e=0;e<this.listeners.length;++e)if(this.listeners.at(e).callback===t){this.listeners.splice(e,1);break}return this}once(t,e){let r=s=>(this.off(r),e(s));return this.on(t,r)}count(){return this.listeners.length}dispatch(t=null){return this.queued.push(t),this}dispatchImmediately(t=null){for(let e of this.listeners)if(e.callback(t)===!0)break;return this}flush(t=1e3){let e=0;for(;this.queued.length>0&&e++<t;){let r=this.queued.shift();this.dispatchImmediately(r)}return this}},bn=class{constructor(t,e=void 0){let{animationFrameHandler:r=window}=e||{};this.handle=0,this.detail={prevTime:-1,currentTime:-1,deltaTime:0},this.animationFrameHandler=r,this.callback=t,this.next=this.next.bind(this),this.start=this.start.bind(this),this.cancel=this.cancel.bind(this)}next(t=performance.now()){this.handle=this.animationFrameHandler.requestAnimationFrame(this.next);let e=this.detail;e.prevTime=e.currentTime,e.currentTime=t,e.deltaTime=e.currentTime-e.prevTime,this.callback(this)}start(){return this.handle=this.animationFrameHandler.requestAnimationFrame(this.next),this}cancel(){return this.animationFrameHandler.cancelAnimationFrame(this.handle),this}};var Sn=Symbol("audioContext"),Re=class{static getAudioContext(){if(Sn in this)return this[Sn];{let t=new AudioContext;return Kl(t),this[Sn]=t,t}}constructor(t,e){this.audioContext=t,this.audioBuffer=e,this._playing=!1,this._started=!1,this._source=null,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}destroy(){this._source&&this._source.disconnect(),this._source=null,this._started=!1,this._playing=!1}onAudioSourceEnded(){this._playing=!1}play(t={}){let e=this.audioBuffer;if(!e)return;this._source&&this.destroy();let{pitch:r=void 0,gain:s=void 0,pan:i=void 0,loop:o=!1}=t,a=this.audioContext,l=a.createBufferSource();l.addEventListener("ended",this.onAudioSourceEnded),l.buffer=e,l.loop=o;let f=l;if(r&&(l.detune.value=r*100),s){let h=a.createGain();h.gain.value=s,f=f.connect(h)}if(i){let h=a.createStereoPanner();h.pan.value=i,f=f.connect(h)}f.connect(a.destination),l.start(),this._source=l,this._started=!0,this._playing=!0}pause(){this._source.stop(),this._playing=!1}isStarted(){return this._started}isPlaying(){return this._playing}isPaused(){return this._started&&!this._playing}};function Kl(n){let t=()=>{n.state==="suspended"&&n.resume()};document.addEventListener("click",t)}async function Tn(n,t){if(typeof n=="string"){let o=await(await fetch(n)).arrayBuffer();return Tn(o,t)}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let e=n,r=new ArrayBuffer(e.byteLength);return new Uint8Array(r).set(e),await t.decodeAudioData(r)}async function pt(n){let t=Re.getAudioContext(),e=await Tn(n,t);return new Re(t,e)}var Rt={SoundStart:new J("start",pt,void 0,"raw://start.wav"),SoundDead:new J("dead",pt,void 0,"raw://dead.wav"),SoundPop:new J("pop",pt,void 0,"raw://boop.wav"),SoundShoot:new J("shoot",pt,void 0,"raw://click.wav"),SoundBoom:new J("boom",pt,void 0,"raw://boom.wav"),BackgroundMusic:new J("music",pt,void 0,"raw://music.wav")};async function Ss(n){await be(n,"res.pack"),await hs(n,Object.values(Rt))}var On={};Ue(On,{Debug:()=>Pn,MoveDown:()=>In,MoveLeft:()=>Rn,MoveRight:()=>Cn,MoveUp:()=>Mn,Shoot:()=>Ln});var Rn=new ct("moveLeft",[st.ARROW_LEFT,st.KEY_A]),Cn=new ct("moveRight",[st.ARROW_RIGHT,st.KEY_D]),Mn=new ct("moveUp",[st.ARROW_UP,st.KEY_W]),In=new ct("moveDown",[st.ARROW_DOWN,st.KEY_S]),Ln=new ct("shoot",st.SPACE),Pn=new ct("debug",st.BACKSLASH);var Bn=class{next(){return 0}},Ts=class extends Bn{next(){return Math.random()}},Rs=class extends Bn{constructor(t){super();this.seed=t,this.a=t}next(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}},A=class{static get RAND(){let t=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:t}),t}constructor(t=void 0){typeof t=="number"?this.generator=new Rs(t):t?this.generator=t:this.generator=new Ts,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(t){return this.RAND.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return this.RAND.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static rangeInt(t,e){return this.RAND.rangeInt(t,e)}rangeInt(t,e){return Math.trunc(this.range(t,e))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};var Ce={showCollision:!1},te=.1;function Et(n,t,e,r){t.x<-e&&(t.x=n.width),t.y<-r&&(t.y=n.height),t.x>n.width+e/2&&(t.x=-e),t.y>n.height+r/2&&(t.y=-r)}function jt(n,t,e){let r=n.x-t.x,s=n.y-t.y;return r*r+s*s<=e*e}function Lt(n,t,e,r){!Ce.showCollision||(n.translate(t,e),n.beginPath(),n.arc(0,0,r,0,Math.PI*2),n.strokeStyle="lime",n.stroke(),n.setTransform(1,0,0,1,0,0))}function Cs(n){return new bn(n).next}function N(n,t){return n.use(t)}var Dn=4,Nn=2,ee=600,$l=9,kn=new St("Particle",()=>({x:0,y:0,dx:0,dy:0,rotation:0,age:0,color:"white"})),Ms=new Tt(kn);function Is(n){let t=N(n,dt),{canvas:e}=N(n,lt);At(n,()=>{t.clear(kn)}),mt(n,({deltaTime:r})=>{for(let[s,i]of Ms.findAll(t))i.age+=r,i.age>ee?t.destroy(s):(i.x+=i.dx,i.y+=i.dy,Et(e,i,Dn*2,Dn*2))}),ut(n,$l,r=>{for(let[s,i]of Ms.findAll(t)){r.translate(i.x,i.y),r.rotate(i.rotation),r.fillStyle=i.color;let o=Dn*(1-i.age/ee);r.fillRect(-o,-o,o*2,o*2),r.setTransform(1,0,0,1,0,0)}})}function Me(n,t,e,r,s,i,o=0){typeof i=="function"&&(i=i());let[a,l]=n.ents.createAndAttach(kn);return l.x=t,l.y=e,l.dx=r,l.dy=s,l.rotation=Math.atan2(s,r),l.age=o,l.color=i,a}function Yt(n,t,e,r=10,s){for(let i=0;i<r;++i)Me(n,t,e,A.range(-1,1)*Nn,A.range(-1,1)*Nn,s)}var k=1,Un=.1,ne=4,Fl=100,zl=1,O=8,Ie={MIN:3e3,MAX:1e4},jl=n=>n.range(Ie.MIN,Ie.MAX),Yl=["blue","blue","blue","dodgerblue","gray","darkgray","yellow"];function Ls(n){let t=N(n,xt);At(n,()=>{t.asteroids.length=0;for(let e=0;e<zl*t.level;++e)t.asteroidSpawner.spawn(t)})}function Ps(n,t,e=0,r=0){if(Os(n,t),t.size>ne){let s=[];s.push(re(n,t.x+A.range(-O,O),t.y+A.range(-O,O),A.range(-k,k)+e,A.range(-k,k)+r,ne)),s.push(re(n,t.x+A.range(-O,O),t.y+A.range(-O,O),A.range(-k,k)+e,A.range(-k,k)+r,ne)),s.push(re(n,t.x+A.range(-O,O),t.y+A.range(-O,O),A.range(-k,k)+e,A.range(-k,k)+r,ne)),s.push(re(n,t.x+A.range(-O,O),t.y+A.range(-O,O),A.range(-k,k)+e,A.range(-k,k)+r,ne)),n.asteroids.push(...s)}}function re(n,t,e,r,s,i){return{scene:n,x:t,y:e,dx:r,dy:s,size:i,rotation:Math.atan2(s,r)}}function Os(n,t){n.asteroids.splice(n.asteroids.indexOf(t),1)}function Bs(n){return{scene:n,spawnTicks:Ie.MAX,reset(){this.spawnTicks=Ie.MAX},spawn(t){if(t.asteroids.length>Fl)return;let e=A.choose(Kn(t.display)),r=re(t,A.range(e[0],e[0]+e[2]),A.range(e[1],e[1]+e[3]),A.range(-k,k),A.range(-k,k),O);t.asteroids.push(r)}}}function Ds(n,t,e){t.gamePause||(e.spawnTicks-=n,e.spawnTicks<=0&&(e.spawn(t),e.spawnTicks=jl(A.RAND)))}function Ns(n,t,e){for(let r of e)r.x+=r.dx,r.y+=r.dy,Et(t.canvas,r,r.size*2,r.size*2);for(let r of e)if(jt(r,t.player,r.size+ot)){Hn(t,r),Os(t,r),Us(t,t.player);break}}function Hn(n,t){Yt(n,t.x,t.y,10,A.choose.bind(null,Yl))}function ks(n,t,e){for(let r of e)n.translate(r.x,r.y),n.rotate(r.rotation),n.fillStyle="slategray",n.fillRect(-r.size,-r.size,r.size*2,r.size*2),n.setTransform(1,0,0,1,0,0),Lt(n,r.x,r.y,r.size)}function Kn(n){return[[-O,-O,O*2+n.width,O],[-O,0,O,n.height],[-O,n.height,O*2+n.width,O],[n.width,0,O,n.height]]}var Ct=4;var ql=["white","violet","violet"],Gl=30,Wl=.7,Le=new St("PowerUp",()=>({x:0,y:0,dx:0,dy:0,rotation:0})),$n=new Tt(Le);function Hs(n){let t=N(n,dt),e=N(n,xt);At(n,()=>{t.clear(Le),A.next()>Wl&&e.powerUpSpawner.spawn(e)})}function Xl(n,t,e,r,s){return{scene:n,x:t,y:e,dx:r,dy:s,rotation:Math.atan2(s,r)}}function Vl(n,t){n.ents.destroy(t)}function Ks(n,t){for(let[e,r]of $n.findAll(t.ents))r.x+=r.dx,r.y+=r.dy,Et(t.canvas,r,Ct*2,Ct*2);for(let[e,r]of $n.findAll(t.ents))if(jt(r,t.player,Ct+ot)){Yt(t,r.x,r.y,10,A.choose.bind(null,ql)),Vl(t,e),t.player.powerMode+=Gl;break}}function $s(n,t){for(let[e,r]of $n.findAll(t.ents))n.translate(r.x,r.y),n.rotate(r.rotation),n.beginPath(),n.strokeStyle="violet",n.arc(0,0,Ct,0,Math.PI*2),n.moveTo(-Ct/2,0),n.lineTo(Ct/2,0),n.moveTo(0,-Ct/2),n.lineTo(0,Ct/2),n.stroke(),n.setTransform(1,0,0,1,0,0),Lt(n,r.x,r.y,Ct)}function Fs(n){return{scene:n,reset(){},spawn(t){let e=A.choose(Kn(t.display));Xl(t,A.range(e[0],e[0]+e[2]),A.range(e[1],e[1]+e[3]),A.range(-k,k),A.range(-k,k))}}}function zs(n,t,e){}var Zl="[ wasd_ ]",Pe=new Ut;function At(n,t){n.before(()=>(Pe.on(t),()=>{Pe.off(t)}))}function xt(n){let{display:t,canvas:e}=N(n,lt),r=N(n,dt),s=N(n,Oe),{ctx:i}=N(n,Fn);return this.ents=r,this.assets=s,this.display=t,this.canvas=e,this.level=0,this.score=0,this.highScore=Number(localStorage.getItem("highscore")),this.flashScore=0,this.flashScoreDelta=0,this.flashHighScore=0,this.flashHighScoreDelta=0,this.flashShootDelta=0,this.dt=0,this.player=null,this.asteroids=[],this.asteroidSpawner=Bs(this),this.powerUpSpawner=Fs(this),this.gamePause=!0,this.showPlayer=!0,this.gameStart=!0,this.gameWait=!0,this.hint=Zl,mt(n,({deltaTime:o})=>{this.gamePause||(this.dt=o,Ns(o,this,this.asteroids),Ks(o,this),Ds(o,this,this.asteroidSpawner),zs(o,this,this.powerUpSpawner),!this.gamePause&&this.asteroids.length<=0&&(this.gamePause=!0,this.showPlayer=!0,Rt.SoundStart.current.play(),setTimeout(()=>this.gameWait=!0,1e3)))}),mt(n,()=>{i.isAnyButtonPressed()&&this.gameWait&&(this.gameStart&&(Rt.BackgroundMusic.current.play(),this.score=0,this.flashScore=1,this.level=0,this.gameStart=!1,this.player.powerMode=0,this.ents.clear(Le),this.asteroidSpawner.reset(),this.powerUpSpawner.reset()),this.gameWait=!1,js(this)),this.player.up=Mn.value,this.player.down=In.value,this.player.left=Rn.value,this.player.right=Cn.value,this.player.fire=Ln.value,Pn.released&&(Ce.showCollision=!Ce.showCollision)}),ut(n,0,o=>{let a=o.canvas;o.fillStyle="black",o.fillRect(0,0,a.width,a.height)}),ut(n,2,o=>{let a=o.canvas;o.fillStyle="rgba(255, 255, 255, 0.2)",o.textAlign="center",o.textBaseline="middle",o.font="16px sans-serif",o.fillText(this.hint,a.width/2,a.height/2-32),this.flashScore>0?(o.fillStyle=`rgba(255, 255, 255, ${this.flashScore+.2})`,this.flashScore-=te):o.fillStyle="rgba(255, 255, 255, 0.2)",o.font="48px sans-serif",o.fillText("= "+String(this.score).padStart(2,"0")+" =",a.width/2,a.height/2),this.flashHighScore>0?(o.fillStyle=`rgba(255, 255, 255, ${this.flashHighScore+.2})`,this.flashHighScore-=te):o.fillStyle="rgba(255, 255, 255, 0.2)",o.font="16px sans-serif",o.fillText(String(this.highScore).padStart(2,"0"),a.width/2,a.height/2+32),o.fillStyle="rgba(255, 255, 255, 0.2)",o.font="24px sans-serif",o.textAlign="right",o.fillText(`${Math.ceil(this.asteroidSpawner.spawnTicks/1e3)}`,a.width,a.height-12),ks(o,this,this.asteroids),$s(o,this)}),ut(n,11,o=>{Lt(o,this.player.x,this.player.y,ot)}),this}var se=4,Ys=100,Ht=2,Ql="gold",Jl=2e3,tu=5,Be=new St("Bullet",()=>({x:0,y:0,dx:0,dy:0,rotation:0,age:0})),zn=new Tt(Be);function eu(n,t,e,r){if(!t.gamePause){for(let[s,i]of zn.findAll(r))i.age+=n,i.age>Jl?r.destroy(s):(i.x+=i.dx,i.y+=i.dy,Et(e,i,Ht*2,Ht*2));for(let[s,i]of zn.findAll(r))for(let o of t.asteroids)if(jt(i,o,o.size)){t.flashScore=1,t.score++,t.score>t.highScore&&(t.flashHighScore=t.score-t.highScore,t.highScore=t.score,localStorage.setItem("highscore",`${t.highScore}`)),Hn(t,o),Rt.SoundPop.current.play(),r.destroy(s),Ps(t,o,i.dx*Un,i.dy*Un);break}}}function nu(n,t){for(let[e,r]of zn.findAll(t))n.translate(r.x,r.y),n.rotate(r.rotation),n.fillStyle=Ql,n.fillRect(-Ht,-Ht,Ht*4,Ht*2),n.setTransform(1,0,0,1,0,0),Lt(n,r.x,r.y,Ht)}function qs(n){let t=N(n,dt),{canvas:e}=N(n,lt),r=N(n,xt);return At(n,()=>{t.clear(Be)}),mt(n,({deltaTime:s})=>{eu(s,r,e,t)}),ut(n,tu,s=>{nu(s,t)}),{spawnBullet:De}}function De(n,t,e,r,s){let[i,o]=n.ents.createAndAttach(Be);return o.x=t,o.y=e,o.dx=r,o.dy=s,o.rotation=Math.atan2(s,r),o.age=0,i}function Gs(n){return n.ents.count(Be)}var Ws=new J("start.wav",pt),Xs=new J("boom.wav",pt),Vs=new J("shoot.wav",pt),ot=5,Ne=[-2,2],ru=.1,su=.4,iu=["red","red","red","yellow","orange"],ou=["gray","darkgray","lightgray"],Zs=10,Qs=1.5,Js=.02,au=.008,lu=.1,ti=.001,uu=10,ei=new St("Player",()=>({x:0,y:0,rotation:0,dx:0,dy:0,dr:0,left:0,right:0,up:0,down:0,fire:0,cooldown:0,powerMode:0})),ni=new Tt(ei);function ri(n){let{canvas:t}=N(n,lt),e=N(n,dt),r=N(n,xt),s=N(n,Oe);Xs.load(s),Ws.load(s),Vs.load(s);let i=hu(t,e);return r.player=i,At(n,()=>{i.x=t.width/2,i.y=t.height/2,i.dx=0,i.dy=0}),mt(n,({deltaTime:o})=>{r.gamePause||cu(o,r)}),ut(n,uu,o=>{!r.showPlayer||fu(o,r)}),i}function hu(n,t){let[e,r]=t.createAndAttach(ei);return r.x=n.width/2,r.y=n.height/2,r}function cu(n,t){let[e,r]=ni.find(t.ents);if(!r)return;let s=r.right-r.left,i=r.down-r.up,o=r.fire;r.dx+=i*Math.cos(r.rotation)*Js,r.dy+=i*Math.sin(r.rotation)*Js,r.dx*=1-ti,r.dy*=1-ti,r.dr+=s*au,r.dr*=1-lu,r.x+=r.dx,r.y+=r.dy,r.rotation+=r.dr,--r.cooldown,Et(t.canvas,r,ot*2,ot*2),o&&(pu(t,r),t.flashShootDelta=1),i&&du(t,r.x,r.y,-i*Math.cos(r.rotation)*Qs,-i*Math.sin(r.rotation)*Qs,A.choose.bind(null,ou))}function fu(n,t){let[e,r]=ni.find(t.ents);if(!r)return;n.translate(r.x,r.y),n.rotate(r.rotation),n.fillStyle="white";let s=ot;n.fillRect(-s,-s,s*2,s*2);let i=-1,o=0,a=0;t.flashShootDelta>0?(n.fillStyle=`rgb(${200*t.flashShootDelta+55*Math.sin(performance.now()/(Zs*2))}, 0, 0)`,t.flashShootDelta-=te,a=t.flashShootDelta*2,i=t.flashShootDelta):n.fillStyle="black",n.fillRect(-s-a/2+i,-(s/4)-a/2+o,s+a,s/2+a),n.setTransform(1,0,0,1,0,0)}function pu(n,t){if(!(Gs(n)>Ys)&&!(t.cooldown>0)){if(t.powerMode>0){for(let e=-1;e<=1;++e){let r=t.rotation+e*Math.PI/4;De(n,t.x-Math.cos(r)*ot,t.y-Math.sin(r)*ot,-Math.cos(r)*se+t.dx,-Math.sin(r)*se+t.dy)}--t.powerMode}else De(n,t.x-Math.cos(t.rotation)*ot,t.y-Math.sin(t.rotation)*ot,-Math.cos(t.rotation)*se+t.dx,-Math.sin(t.rotation)*se+t.dy);t.cooldown=Zs,Vs.get(n.assets).play()}}function Us(n,t){n.gamePause=!0,n.showPlayer=!1,Yt(n,t.x,t.y,100,A.choose.bind(null,iu)),Ws.get(n.assets).play(),Xs.get(n.assets).play(),setTimeout(()=>n.gameStart=n.gameWait=!0,1e3)}function du(n,t,e,r,s,i){A.next()>.3&&Me(n,t+A.range(Ne[0],Ne[1]),e+A.range(Ne[0],Ne[1]),r,s,i,A.range(ee*ru,ee*su))}var si=[2,4],ii=[.3,1],mu=30,vu=1;function oi(n){let{canvas:t}=N(n,lt),e=gu(t.width,t.height);mt(n,()=>{wu(e)}),ut(n,vu,r=>{yu(r,e)})}function gu(n,t){let e={x:[],y:[],size:[],speed:[],length:0,width:n,height:t};for(let r=0;r<mu;++r)e.x.push(A.range(0,n)),e.y.push(A.range(0,t)),e.size.push(A.range(si[0],si[1])),e.speed.push(A.range(ii[0],ii[1])),e.length++;return e}function yu(n,t,e="white"){for(let r=0;r<t.length;++r){let s=t.x[r],i=t.y[r],o=t.size[r],a=o/2;n.fillStyle=e,n.fillRect(s-a,i-a,o,o)}}function wu(n,t=1,e=0){let{length:r,width:s,height:i}=n;for(let o=0;o<r;++o){let a=t*n.speed[o],l=e*n.speed[o];n.x[o]+=a,n.y[o]+=l,a<0?n.x[o]<0&&(n.x[o]=s,n.y[o]=A.range(0,i)):a>0&&n.x[o]>s&&(n.x[o]=0,n.y[o]=A.range(0,i)),l<0?n.y[o]<0&&(n.x[o]=A.range(0,s),n.y[o]=i):l>0&&n.y[o]>i&&(n.x[o]=A.range(0,s),n.y[o]=0)}}var jn=class{constructor(){this.before=[],this.after=[],this.started=!1}attachEffect(t){if(this.started)throw new Error("Cannot attach effect when already started.");return this.before.push(t),this}attachAfterEffect(t){if(this.started)throw new Error("Cannot attach effect when already started.");return this.after.push(t),this}async startEffects(){if(this.started)throw new Error("Cannot start effects already started.");this.started=!0;let t=this.before.slice();this.before.length=0,this.after.push(...await Promise.all(t.map(e=>e&&e())))}async stopEffects(){if(!this.started)throw new Error("Cannot stop effects not yet started.");this.started=!1;let t=this.after.slice().reverse();this.after.length=0,await Promise.all(t.map(e=>e&&e()))}};var Pt=class{static async initializeContext(t){try{t.state=await t.initCallback.call({},t)}catch(e){throw new Error(`Failed to initialize system context '${t.name}' with dependencies [${t.dependencies.map(r=>r.name).join(", ")}].

${e}`,{cause:e})}return t.dependencies}static async initializeEffects(t){await t.effects.startEffects()}static markDead(t){t.dead=!0}static async terminateEffects(t){await t.effects.stopEffects()}static async terminateContext(t){await t.deadCallback(t.state),t.state=null}constructor(t,e,r,s){this.name=e,this.state=null,this.parent=t,this.effects=new jn,this.dead=!1,this.dependencies=[],this.initCallback=r,this.deadCallback=s}before(t){this.effects.attachEffect(t)}after(t){this.effects.attachAfterEffect(t)}use(t){if(this.effects.started)throw new Error("use() must be called during initialization only.");return this.dependencies.indexOf(t)<0&&this.dependencies.push(t),this.parent.getState(t)}};function ai(n){return Eu("Must be non-null!",typeof n!="undefined"&&n!==null,n)}function Eu(n,t,e){if(!t)throw new Error(`Assertion failed - ${n} But found ${e}.`);return e}var Yn=class{constructor(){this.pendingSystems=[],this.activeSystems=[]}register(t,e=void 0,r=void 0){ai(t);let s;if(typeof t=="function")s=t.name;else if(typeof t=="object")if("name"in t)s=t.name;else throw new Error("Invalid handle for system - missing name.");else s=t;e||(typeof t=="function"?e=t:e=()=>{}),r||(r=()=>{});let i=new Pt(this,s,e,r);return this.pendingSystems.push(i),this}unregister(t){let e=this.pendingSystems.findIndex(r=>r.name===t);return e>=0&&this.pendingSystems.splice(e,1),this}async start(){let t=this.pendingSystems.slice();this.pendingSystems.length=0;for(let e of t)this.activeSystems.push(e),await Pt.initializeContext(e);for(let e of t)await Pt.initializeEffects(e);return this}async stop(){let t=this.activeSystems.slice().reverse();t.forEach(Pt.markDead);for(let e of t)await Pt.terminateEffects(e);for(let e of t){await Pt.terminateContext(e);let r=this.activeSystems.indexOf(e);r>=0&&this.activeSystems.splice(r,1)}return this}getState(t){let e=this.activeSystems.find(r=>r.name===t.name);return e?e.state:null}};var li=new Ut,qn=new Ut,Au=new Ut,Gn=new _n;async function ui(){let n=await xu();requestAnimationFrame(Cs(t=>{li.dispatchImmediately(t.detail),qn.dispatchImmediately(t.detail),Gn.dispatchImmediately(n.getState(lt).ctx),Au.dispatchImmediately(t.detail)}))}async function xu(){console.log("Loading..."),await Ss(),console.log("...loading complete!");let n=new Yn;return n.register(lt).register(Fn).register(dt,void 0,t=>t.reset()).register(xt).register(oi).register(Is).register(ri).register(qs).register(Hs).register(Ls),await n.start()}function js(n){n.level++,n.gamePause=!1,n.showPlayer=!0,Pe.dispatchImmediately(n),Rt.BackgroundMusic.current.isPlaying()||Rt.BackgroundMusic.current.play({loop:!0})}async function Oe(n){let t=new yn;return await be(t,"res.pack"),t}function Fn(){let n=document.querySelector("#inputs"),t=n.getContext("axisbutton");return t.bindBindings(Object.values(On)),li.on(({currentTime:e})=>{t.poll(e)}),{inputs:n,ctx:t}}function lt(){let n=document.querySelector("#display"),t=n.canvas,e=t.getContext("2d");return{display:n,canvas:t,ctx:e}}function dt(){let n=new An;return qn.on(()=>n.flush()),n}function mt(n,t){_u(n,qn,t)}function ut(n,t,e){n.before(()=>(Gn.on(t,e),()=>{Gn.off(e)}))}function _u(n,t,e){n.before(()=>(t.on(e),()=>{t.off(e)}))}window.addEventListener("DOMContentLoaded",ui);})();
//# sourceMappingURL=main.js.map
