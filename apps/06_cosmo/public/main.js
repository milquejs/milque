(()=>{var ai=Object.create,ut=Object.defineProperty;var li=Object.getOwnPropertyDescriptor;var ui=Object.getOwnPropertyNames;var hi=Object.getPrototypeOf,ci=Object.prototype.hasOwnProperty;var fi=n=>ut(n,"__esModule",{value:!0});var pi=(n,e)=>()=>(n&&(e=n(n=0)),e),Pe=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Ut=(n,e)=>{for(var t in e)ut(n,t,{get:e[t],enumerable:!0})},di=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ui(e))!ci.call(n,r)&&r!=="default"&&ut(n,r,{get:()=>e[r],enumerable:!(t=li(e,r))||t.enumerable});return n},mi=n=>di(fi(ut(n!=null?ai(hi(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var yr={};Ut(yr,{basename:()=>vr,default:()=>qo,delimiter:()=>dr,dirname:()=>mr,extname:()=>gr,isAbsolute:()=>Zt,join:()=>cr,normalize:()=>Qt,relative:()=>fr,resolve:()=>pt,sep:()=>pr});function hr(n,e){for(var t=0,r=n.length-1;r>=0;r--){var s=n[r];s==="."?n.splice(r,1):s===".."?(n.splice(r,1),t++):t&&(n.splice(r,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function pt(){for(var n="",e=!1,t=arguments.length-1;t>=-1&&!e;t--){var r=t>=0?arguments[t]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;n=r+"/"+n,e=r.charAt(0)==="/"}return n=hr(Jt(n.split("/"),function(s){return!!s}),!e).join("/"),(e?"/":"")+n||"."}function Qt(n){var e=Zt(n),t=Yo(n,-1)==="/";return n=hr(Jt(n.split("/"),function(r){return!!r}),!e).join("/"),!n&&!e&&(n="."),n&&t&&(n+="/"),(e?"/":"")+n}function Zt(n){return n.charAt(0)==="/"}function cr(){var n=Array.prototype.slice.call(arguments,0);return Qt(Jt(n,function(e,t){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function fr(n,e){n=pt(n).substr(1),e=pt(e).substr(1);function t(f){for(var c=0;c<f.length&&f[c]==="";c++);for(var m=f.length-1;m>=0&&f[m]==="";m--);return c>m?[]:f.slice(c,m-c+1)}for(var r=t(n.split("/")),s=t(e.split("/")),i=Math.min(r.length,s.length),o=i,a=0;a<i;a++)if(r[a]!==s[a]){o=a;break}for(var l=[],a=o;a<r.length;a++)l.push("..");return l=l.concat(s.slice(o)),l.join("/")}function mr(n){var e=Vt(n),t=e[0],r=e[1];return!t&&!r?".":(r&&(r=r.substr(0,r.length-1)),t+r)}function vr(n,e){var t=Vt(n)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t}function gr(n){return Vt(n)[3]}function Jt(n,e){if(n.filter)return n.filter(e);for(var t=[],r=0;r<n.length;r++)e(n[r],r,n)&&t.push(n[r]);return t}var jo,Vt,pr,dr,qo,Yo,wr=pi(()=>{jo=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Vt=function(n){return jo.exec(n).slice(1)};pr="/",dr=":";qo={extname:gr,basename:vr,dirname:mr,sep:pr,delimiter:dr,relative:fr,join:cr,isAbsolute:Zt,normalize:Qt,resolve:pt};Yo="ab".substr(-1)==="b"?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}});var mt=Pe((Mu,dt)=>{var Be=(wr(),yr);if(Be&&Be.default){dt.exports=Be.default;for(let n in Be)dt.exports[n]=Be[n]}else Be&&(dt.exports=Be)});var Ge=Pe((Iu,br)=>{"use strict";var Go=mt(),ge="\\\\/",Er=`[^${ge}]`,Ae="\\.",Wo="\\+",Xo="\\?",vt="\\/",Vo="(?=.)",xr="[^/]",en=`(?:${vt}|$)`,Ar=`(?:^|${vt})`,tn=`${Ae}{1,2}${en}`,Qo=`(?!${Ae})`,Zo=`(?!${Ar}${tn})`,Jo=`(?!${Ae}{0,1}${en})`,ea=`(?!${tn})`,ta=`[^.${vt}]`,na=`${xr}*?`,_r={DOT_LITERAL:Ae,PLUS_LITERAL:Wo,QMARK_LITERAL:Xo,SLASH_LITERAL:vt,ONE_CHAR:Vo,QMARK:xr,END_ANCHOR:en,DOTS_SLASH:tn,NO_DOT:Qo,NO_DOTS:Zo,NO_DOT_SLASH:Jo,NO_DOTS_SLASH:ea,QMARK_NO_DOT:ta,STAR:na,START_ANCHOR:Ar},ra={..._r,SLASH_LITERAL:`[${ge}]`,QMARK:Er,STAR:`${Er}*?`,DOTS_SLASH:`${Ae}{1,2}(?:[${ge}]|$)`,NO_DOT:`(?!${Ae})`,NO_DOTS:`(?!(?:^|[${ge}])${Ae}{1,2}(?:[${ge}]|$))`,NO_DOT_SLASH:`(?!${Ae}{0,1}(?:[${ge}]|$))`,NO_DOTS_SLASH:`(?!${Ae}{1,2}(?:[${ge}]|$))`,QMARK_NO_DOT:`[^.${ge}]`,START_ANCHOR:`(?:^|[${ge}])`,END_ANCHOR:`(?:[${ge}]|$)`},sa={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};br.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:sa,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Go.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?ra:_r}}});var gt=Pe(ee=>{"use strict";var ia=mt(),oa=!1,{REGEX_BACKSLASH:aa,REGEX_REMOVE_BACKSLASH:la,REGEX_SPECIAL_CHARS:ua,REGEX_SPECIAL_CHARS_GLOBAL:ha}=Ge();ee.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);ee.hasRegexChars=n=>ua.test(n);ee.isRegexChar=n=>n.length===1&&ee.hasRegexChars(n);ee.escapeRegex=n=>n.replace(ha,"\\$1");ee.toPosixSlashes=n=>n.replace(aa,"/");ee.removeBackslashes=n=>n.replace(la,e=>e==="\\"?"":e);ee.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};ee.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:oa===!0||ia.sep==="\\";ee.escapeLast=(n,e,t)=>{let r=n.lastIndexOf(e,t);return r===-1?n:n[r-1]==="\\"?ee.escapeLast(n,e,r-1):`${n.slice(0,r)}\\${n.slice(r)}`};ee.removePrefix=(n,e={})=>{let t=n;return t.startsWith("./")&&(t=t.slice(2),e.prefix="./"),t};ee.wrapOutput=(n,e={},t={})=>{let r=t.contains?"":"^",s=t.contains?"":"$",i=`${r}(?:${n})${s}`;return e.negated===!0&&(i=`(?:^(?!${i}).*$)`),i}});var Or=Pe((Ou,Lr)=>{"use strict";var Sr=gt(),{CHAR_ASTERISK:nn,CHAR_AT:ca,CHAR_BACKWARD_SLASH:We,CHAR_COMMA:fa,CHAR_DOT:rn,CHAR_EXCLAMATION_MARK:sn,CHAR_FORWARD_SLASH:Rr,CHAR_LEFT_CURLY_BRACE:on,CHAR_LEFT_PARENTHESES:an,CHAR_LEFT_SQUARE_BRACKET:pa,CHAR_PLUS:da,CHAR_QUESTION_MARK:Tr,CHAR_RIGHT_CURLY_BRACE:ma,CHAR_RIGHT_PARENTHESES:Cr,CHAR_RIGHT_SQUARE_BRACKET:va}=Ge(),Mr=n=>n===Rr||n===We,Ir=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},ga=(n,e)=>{let t=e||{},r=n.length-1,s=t.parts===!0||t.scanToEnd===!0,i=[],o=[],a=[],l=n,f=-1,c=0,m=0,E=!1,I=!1,S=!1,T=!1,L=!1,U=!1,j=!1,M=!1,Y=!1,K=!1,X=0,F,y,A={value:"",depth:0,isGlob:!1},$=()=>f>=r,p=()=>l.charCodeAt(f+1),O=()=>(F=y,l.charCodeAt(++f));for(;f<r;){y=O();let G;if(y===We){j=A.backslashes=!0,y=O(),y===on&&(U=!0);continue}if(U===!0||y===on){for(X++;$()!==!0&&(y=O());){if(y===We){j=A.backslashes=!0,O();continue}if(y===on){X++;continue}if(U!==!0&&y===rn&&(y=O())===rn){if(E=A.isBrace=!0,S=A.isGlob=!0,K=!0,s===!0)continue;break}if(U!==!0&&y===fa){if(E=A.isBrace=!0,S=A.isGlob=!0,K=!0,s===!0)continue;break}if(y===ma&&(X--,X===0)){U=!1,E=A.isBrace=!0,K=!0;break}}if(s===!0)continue;break}if(y===Rr){if(i.push(f),o.push(A),A={value:"",depth:0,isGlob:!1},K===!0)continue;if(F===rn&&f===c+1){c+=2;continue}m=f+1;continue}if(t.noext!==!0&&(y===da||y===ca||y===nn||y===Tr||y===sn)===!0&&p()===an){if(S=A.isGlob=!0,T=A.isExtglob=!0,K=!0,y===sn&&f===c&&(Y=!0),s===!0){for(;$()!==!0&&(y=O());){if(y===We){j=A.backslashes=!0,y=O();continue}if(y===Cr){S=A.isGlob=!0,K=!0;break}}continue}break}if(y===nn){if(F===nn&&(L=A.isGlobstar=!0),S=A.isGlob=!0,K=!0,s===!0)continue;break}if(y===Tr){if(S=A.isGlob=!0,K=!0,s===!0)continue;break}if(y===pa){for(;$()!==!0&&(G=O());){if(G===We){j=A.backslashes=!0,O();continue}if(G===va){I=A.isBracket=!0,S=A.isGlob=!0,K=!0;break}}if(s===!0)continue;break}if(t.nonegate!==!0&&y===sn&&f===c){M=A.negated=!0,c++;continue}if(t.noparen!==!0&&y===an){if(S=A.isGlob=!0,s===!0){for(;$()!==!0&&(y=O());){if(y===an){j=A.backslashes=!0,y=O();continue}if(y===Cr){K=!0;break}}continue}break}if(S===!0){if(K=!0,s===!0)continue;break}}t.noext===!0&&(T=!1,S=!1);let C=l,re="",h="";c>0&&(re=l.slice(0,c),l=l.slice(c),m-=c),C&&S===!0&&m>0?(C=l.slice(0,m),h=l.slice(m)):S===!0?(C="",h=l):C=l,C&&C!==""&&C!=="/"&&C!==l&&Mr(C.charCodeAt(C.length-1))&&(C=C.slice(0,-1)),t.unescape===!0&&(h&&(h=Sr.removeBackslashes(h)),C&&j===!0&&(C=Sr.removeBackslashes(C)));let u={prefix:re,input:n,start:c,base:C,glob:h,isBrace:E,isBracket:I,isGlob:S,isExtglob:T,isGlobstar:L,negated:M,negatedExtglob:Y};if(t.tokens===!0&&(u.maxDepth=0,Mr(y)||o.push(A),u.tokens=o),t.parts===!0||t.tokens===!0){let G;for(let R=0;R<i.length;R++){let J=G?G+1:c,W=i[R],V=n.slice(J,W);t.tokens&&(R===0&&c!==0?(o[R].isPrefix=!0,o[R].value=re):o[R].value=V,Ir(o[R]),u.maxDepth+=o[R].depth),(R!==0||V!=="")&&a.push(V),G=W}if(G&&G+1<n.length){let R=n.slice(G+1);a.push(R),t.tokens&&(o[o.length-1].value=R,Ir(o[o.length-1]),u.maxDepth+=o[o.length-1].depth)}u.slashes=i,u.parts=a}return u};Lr.exports=ga});var Br=Pe((Pu,Dr)=>{"use strict";var yt=Ge(),ie=gt(),{MAX_LENGTH:wt,POSIX_REGEX_SOURCE:ya,REGEX_NON_SPECIAL_CHARS:wa,REGEX_SPECIAL_CHARS_BACKREF:Ea,REPLACEMENTS:Pr}=yt,xa=(n,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...n,e);n.sort();let t=`[${n.join("-")}]`;try{new RegExp(t)}catch(r){return n.map(s=>ie.escapeRegex(s)).join("..")}return t},He=(n,e)=>`Missing ${n}: "${e}" - use "\\\\${e}" to match literal characters`,ln=(n,e)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=Pr[n]||n;let t={...e},r=typeof t.maxLength=="number"?Math.min(wt,t.maxLength):wt,s=n.length;if(s>r)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${r}`);let i={type:"bos",value:"",output:t.prepend||""},o=[i],a=t.capture?"":"?:",l=ie.isWindows(e),f=yt.globChars(l),c=yt.extglobChars(f),{DOT_LITERAL:m,PLUS_LITERAL:E,SLASH_LITERAL:I,ONE_CHAR:S,DOTS_SLASH:T,NO_DOT:L,NO_DOT_SLASH:U,NO_DOTS_SLASH:j,QMARK:M,QMARK_NO_DOT:Y,STAR:K,START_ANCHOR:X}=f,F=g=>`(${a}(?:(?!${X}${g.dot?T:m}).)*?)`,y=t.dot?"":L,A=t.dot?M:Y,$=t.bash===!0?F(t):K;t.capture&&($=`(${$})`),typeof t.noext=="boolean"&&(t.noextglob=t.noext);let p={input:n,index:-1,start:0,dot:t.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=ie.removePrefix(n,p),s=n.length;let O=[],C=[],re=[],h=i,u,G=()=>p.index===s-1,R=p.peek=(g=1)=>n[p.index+g],J=p.advance=()=>n[++p.index]||"",W=()=>n.slice(p.index+1),V=(g="",D=0)=>{p.consumed+=g,p.index+=D},me=g=>{p.output+=g.output!=null?g.output:g.value,V(g.value)},qe=()=>{let g=1;for(;R()==="!"&&(R(2)!=="("||R(3)==="?");)J(),p.start++,g++;return g%2==0?!1:(p.negated=!0,p.start++,!0)},Ce=g=>{p[g]++,re.push(g)},ve=g=>{p[g]--,re.pop()},_=g=>{if(h.type==="globstar"){let D=p.braces>0&&(g.type==="comma"||g.type==="brace"),d=g.extglob===!0||O.length&&(g.type==="pipe"||g.type==="paren");g.type!=="slash"&&g.type!=="paren"&&!D&&!d&&(p.output=p.output.slice(0,-h.output.length),h.type="star",h.value="*",h.output=$,p.output+=h.output)}if(O.length&&g.type!=="paren"&&(O[O.length-1].inner+=g.value),(g.value||g.output)&&me(g),h&&h.type==="text"&&g.type==="text"){h.value+=g.value,h.output=(h.output||"")+g.value;return}g.prev=h,o.push(g),h=g},Oe=(g,D)=>{let d={...c[D],conditions:1,inner:""};d.prev=h,d.parens=p.parens,d.output=p.output;let b=(t.capture?"(":"")+d.open;Ce("parens"),_({type:g,value:D,output:p.output?"":S}),_({type:"paren",extglob:!0,value:J(),output:b}),O.push(d)},at=g=>{let D=g.close+(t.capture?")":""),d;if(g.type==="negate"){let b=$;if(g.inner&&g.inner.length>1&&g.inner.includes("/")&&(b=F(t)),(b!==$||G()||/^\)+$/.test(W()))&&(D=g.close=`)$))${b}`),g.inner.includes("*")&&(d=W())&&/^\.[^\\/.]+$/.test(d)){let H=ln(d,{...e,fastpaths:!1}).output;D=g.close=`)${H})${b})`}g.prev.type==="bos"&&(p.negatedExtglob=!0)}_({type:"paren",extglob:!0,value:u,output:D}),ve("parens")};if(t.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let g=!1,D=n.replace(Ea,(d,b,H,Q,q,kt)=>Q==="\\"?(g=!0,d):Q==="?"?b?b+Q+(q?M.repeat(q.length):""):kt===0?A+(q?M.repeat(q.length):""):M.repeat(H.length):Q==="."?m.repeat(H.length):Q==="*"?b?b+Q+(q?$:""):$:b?d:`\\${d}`);return g===!0&&(t.unescape===!0?D=D.replace(/\\/g,""):D=D.replace(/\\+/g,d=>d.length%2==0?"\\\\":d?"\\":"")),D===n&&t.contains===!0?(p.output=n,p):(p.output=ie.wrapOutput(D,p,e),p)}for(;!G();){if(u=J(),u==="\0")continue;if(u==="\\"){let d=R();if(d==="/"&&t.bash!==!0||d==="."||d===";")continue;if(!d){u+="\\",_({type:"text",value:u});continue}let b=/^\\+/.exec(W()),H=0;if(b&&b[0].length>2&&(H=b[0].length,p.index+=H,H%2!=0&&(u+="\\")),t.unescape===!0?u=J():u+=J(),p.brackets===0){_({type:"text",value:u});continue}}if(p.brackets>0&&(u!=="]"||h.value==="["||h.value==="[^")){if(t.posix!==!1&&u===":"){let d=h.value.slice(1);if(d.includes("[")&&(h.posix=!0,d.includes(":"))){let b=h.value.lastIndexOf("["),H=h.value.slice(0,b),Q=h.value.slice(b+2),q=ya[Q];if(q){h.value=H+q,p.backtrack=!0,J(),!i.output&&o.indexOf(h)===1&&(i.output=S);continue}}}(u==="["&&R()!==":"||u==="-"&&R()==="]")&&(u=`\\${u}`),u==="]"&&(h.value==="["||h.value==="[^")&&(u=`\\${u}`),t.posix===!0&&u==="!"&&h.value==="["&&(u="^"),h.value+=u,me({value:u});continue}if(p.quotes===1&&u!=='"'){u=ie.escapeRegex(u),h.value+=u,me({value:u});continue}if(u==='"'){p.quotes=p.quotes===1?0:1,t.keepQuotes===!0&&_({type:"text",value:u});continue}if(u==="("){Ce("parens"),_({type:"paren",value:u});continue}if(u===")"){if(p.parens===0&&t.strictBrackets===!0)throw new SyntaxError(He("opening","("));let d=O[O.length-1];if(d&&p.parens===d.parens+1){at(O.pop());continue}_({type:"paren",value:u,output:p.parens?")":"\\)"}),ve("parens");continue}if(u==="["){if(t.nobracket===!0||!W().includes("]")){if(t.nobracket!==!0&&t.strictBrackets===!0)throw new SyntaxError(He("closing","]"));u=`\\${u}`}else Ce("brackets");_({type:"bracket",value:u});continue}if(u==="]"){if(t.nobracket===!0||h&&h.type==="bracket"&&h.value.length===1){_({type:"text",value:u,output:`\\${u}`});continue}if(p.brackets===0){if(t.strictBrackets===!0)throw new SyntaxError(He("opening","["));_({type:"text",value:u,output:`\\${u}`});continue}ve("brackets");let d=h.value.slice(1);if(h.posix!==!0&&d[0]==="^"&&!d.includes("/")&&(u=`/${u}`),h.value+=u,me({value:u}),t.literalBrackets===!1||ie.hasRegexChars(d))continue;let b=ie.escapeRegex(h.value);if(p.output=p.output.slice(0,-h.value.length),t.literalBrackets===!0){p.output+=b,h.value=b;continue}h.value=`(${a}${b}|${h.value})`,p.output+=h.value;continue}if(u==="{"&&t.nobrace!==!0){Ce("braces");let d={type:"brace",value:u,output:"(",outputIndex:p.output.length,tokensIndex:p.tokens.length};C.push(d),_(d);continue}if(u==="}"){let d=C[C.length-1];if(t.nobrace===!0||!d){_({type:"text",value:u,output:u});continue}let b=")";if(d.dots===!0){let H=o.slice(),Q=[];for(let q=H.length-1;q>=0&&(o.pop(),H[q].type!=="brace");q--)H[q].type!=="dots"&&Q.unshift(H[q].value);b=xa(Q,t),p.backtrack=!0}if(d.comma!==!0&&d.dots!==!0){let H=p.output.slice(0,d.outputIndex),Q=p.tokens.slice(d.tokensIndex);d.value=d.output="\\{",u=b="\\}",p.output=H;for(let q of Q)p.output+=q.output||q.value}_({type:"brace",value:u,output:b}),ve("braces"),C.pop();continue}if(u==="|"){O.length>0&&O[O.length-1].conditions++,_({type:"text",value:u});continue}if(u===","){let d=u,b=C[C.length-1];b&&re[re.length-1]==="braces"&&(b.comma=!0,d="|"),_({type:"comma",value:u,output:d});continue}if(u==="/"){if(h.type==="dot"&&p.index===p.start+1){p.start=p.index+1,p.consumed="",p.output="",o.pop(),h=i;continue}_({type:"slash",value:u,output:I});continue}if(u==="."){if(p.braces>0&&h.type==="dot"){h.value==="."&&(h.output=m);let d=C[C.length-1];h.type="dots",h.output+=u,h.value+=u,d.dots=!0;continue}if(p.braces+p.parens===0&&h.type!=="bos"&&h.type!=="slash"){_({type:"text",value:u,output:m});continue}_({type:"dot",value:u,output:m});continue}if(u==="?"){if(!(h&&h.value==="(")&&t.noextglob!==!0&&R()==="("&&R(2)!=="?"){Oe("qmark",u);continue}if(h&&h.type==="paren"){let b=R(),H=u;if(b==="<"&&!ie.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(h.value==="("&&!/[!=<:]/.test(b)||b==="<"&&!/<([!=]|\w+>)/.test(W()))&&(H=`\\${u}`),_({type:"text",value:u,output:H});continue}if(t.dot!==!0&&(h.type==="slash"||h.type==="bos")){_({type:"qmark",value:u,output:Y});continue}_({type:"qmark",value:u,output:M});continue}if(u==="!"){if(t.noextglob!==!0&&R()==="("&&(R(2)!=="?"||!/[!=<:]/.test(R(3)))){Oe("negate",u);continue}if(t.nonegate!==!0&&p.index===0){qe();continue}}if(u==="+"){if(t.noextglob!==!0&&R()==="("&&R(2)!=="?"){Oe("plus",u);continue}if(h&&h.value==="("||t.regex===!1){_({type:"plus",value:u,output:E});continue}if(h&&(h.type==="bracket"||h.type==="paren"||h.type==="brace")||p.parens>0){_({type:"plus",value:u});continue}_({type:"plus",value:E});continue}if(u==="@"){if(t.noextglob!==!0&&R()==="("&&R(2)!=="?"){_({type:"at",extglob:!0,value:u,output:""});continue}_({type:"text",value:u});continue}if(u!=="*"){(u==="$"||u==="^")&&(u=`\\${u}`);let d=wa.exec(W());d&&(u+=d[0],p.index+=d[0].length),_({type:"text",value:u});continue}if(h&&(h.type==="globstar"||h.star===!0)){h.type="star",h.star=!0,h.value+=u,h.output=$,p.backtrack=!0,p.globstar=!0,V(u);continue}let g=W();if(t.noextglob!==!0&&/^\([^?]/.test(g)){Oe("star",u);continue}if(h.type==="star"){if(t.noglobstar===!0){V(u);continue}let d=h.prev,b=d.prev,H=d.type==="slash"||d.type==="bos",Q=b&&(b.type==="star"||b.type==="globstar");if(t.bash===!0&&(!H||g[0]&&g[0]!=="/")){_({type:"star",value:u,output:""});continue}let q=p.braces>0&&(d.type==="comma"||d.type==="brace"),kt=O.length&&(d.type==="pipe"||d.type==="paren");if(!H&&d.type!=="paren"&&!q&&!kt){_({type:"star",value:u,output:""});continue}for(;g.slice(0,3)==="/**";){let lt=n[p.index+4];if(lt&&lt!=="/")break;g=g.slice(3),V("/**",3)}if(d.type==="bos"&&G()){h.type="globstar",h.value+=u,h.output=F(t),p.output=h.output,p.globstar=!0,V(u);continue}if(d.type==="slash"&&d.prev.type!=="bos"&&!Q&&G()){p.output=p.output.slice(0,-(d.output+h.output).length),d.output=`(?:${d.output}`,h.type="globstar",h.output=F(t)+(t.strictSlashes?")":"|$)"),h.value+=u,p.globstar=!0,p.output+=d.output+h.output,V(u);continue}if(d.type==="slash"&&d.prev.type!=="bos"&&g[0]==="/"){let lt=g[1]!==void 0?"|$":"";p.output=p.output.slice(0,-(d.output+h.output).length),d.output=`(?:${d.output}`,h.type="globstar",h.output=`${F(t)}${I}|${I}${lt})`,h.value+=u,p.output+=d.output+h.output,p.globstar=!0,V(u+J()),_({type:"slash",value:"/",output:""});continue}if(d.type==="bos"&&g[0]==="/"){h.type="globstar",h.value+=u,h.output=`(?:^|${I}|${F(t)}${I})`,p.output=h.output,p.globstar=!0,V(u+J()),_({type:"slash",value:"/",output:""});continue}p.output=p.output.slice(0,-h.output.length),h.type="globstar",h.output=F(t),h.value+=u,p.output+=h.output,p.globstar=!0,V(u);continue}let D={type:"star",value:u,output:$};if(t.bash===!0){D.output=".*?",(h.type==="bos"||h.type==="slash")&&(D.output=y+D.output),_(D);continue}if(h&&(h.type==="bracket"||h.type==="paren")&&t.regex===!0){D.output=u,_(D);continue}(p.index===p.start||h.type==="slash"||h.type==="dot")&&(h.type==="dot"?(p.output+=U,h.output+=U):t.dot===!0?(p.output+=j,h.output+=j):(p.output+=y,h.output+=y),R()!=="*"&&(p.output+=S,h.output+=S)),_(D)}for(;p.brackets>0;){if(t.strictBrackets===!0)throw new SyntaxError(He("closing","]"));p.output=ie.escapeLast(p.output,"["),ve("brackets")}for(;p.parens>0;){if(t.strictBrackets===!0)throw new SyntaxError(He("closing",")"));p.output=ie.escapeLast(p.output,"("),ve("parens")}for(;p.braces>0;){if(t.strictBrackets===!0)throw new SyntaxError(He("closing","}"));p.output=ie.escapeLast(p.output,"{"),ve("braces")}if(t.strictSlashes!==!0&&(h.type==="star"||h.type==="bracket")&&_({type:"maybe_slash",value:"",output:`${I}?`}),p.backtrack===!0){p.output="";for(let g of p.tokens)p.output+=g.output!=null?g.output:g.value,g.suffix&&(p.output+=g.suffix)}return p};ln.fastpaths=(n,e)=>{let t={...e},r=typeof t.maxLength=="number"?Math.min(wt,t.maxLength):wt,s=n.length;if(s>r)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${r}`);n=Pr[n]||n;let i=ie.isWindows(e),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:l,DOTS_SLASH:f,NO_DOT:c,NO_DOTS:m,NO_DOTS_SLASH:E,STAR:I,START_ANCHOR:S}=yt.globChars(i),T=t.dot?m:c,L=t.dot?E:c,U=t.capture?"":"?:",j={negated:!1,prefix:""},M=t.bash===!0?".*?":I;t.capture&&(M=`(${M})`);let Y=y=>y.noglobstar===!0?M:`(${U}(?:(?!${S}${y.dot?f:o}).)*?)`,K=y=>{switch(y){case"*":return`${T}${l}${M}`;case".*":return`${o}${l}${M}`;case"*.*":return`${T}${M}${o}${l}${M}`;case"*/*":return`${T}${M}${a}${l}${L}${M}`;case"**":return T+Y(t);case"**/*":return`(?:${T}${Y(t)}${a})?${L}${l}${M}`;case"**/*.*":return`(?:${T}${Y(t)}${a})?${L}${M}${o}${l}${M}`;case"**/.*":return`(?:${T}${Y(t)}${a})?${o}${l}${M}`;default:{let A=/^(.*?)\.(\w+)$/.exec(y);if(!A)return;let $=K(A[1]);return $?$+o+A[2]:void 0}}},X=ie.removePrefix(n,j),F=K(X);return F&&t.strictSlashes!==!0&&(F+=`${a}?`),F};Dr.exports=ln});var kr=Pe((Du,Nr)=>{"use strict";var Aa=mt(),_a=Or(),un=Br(),hn=gt(),ba=Ge(),Sa=n=>n&&typeof n=="object"&&!Array.isArray(n),z=(n,e,t=!1)=>{if(Array.isArray(n)){let c=n.map(E=>z(E,e,t));return E=>{for(let I of c){let S=I(E);if(S)return S}return!1}}let r=Sa(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let s=e||{},i=hn.isWindows(e),o=r?z.compileRe(n,e):z.makeRe(n,e,!1,!0),a=o.state;delete o.state;let l=()=>!1;if(s.ignore){let c={...e,ignore:null,onMatch:null,onResult:null};l=z(s.ignore,c,t)}let f=(c,m=!1)=>{let{isMatch:E,match:I,output:S}=z.test(c,o,e,{glob:n,posix:i}),T={glob:n,state:a,regex:o,posix:i,input:c,output:S,match:I,isMatch:E};return typeof s.onResult=="function"&&s.onResult(T),E===!1?(T.isMatch=!1,m?T:!1):l(c)?(typeof s.onIgnore=="function"&&s.onIgnore(T),T.isMatch=!1,m?T:!1):(typeof s.onMatch=="function"&&s.onMatch(T),m?T:!0)};return t&&(f.state=a),f};z.test=(n,e,t,{glob:r,posix:s}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let i=t||{},o=i.format||(s?hn.toPosixSlashes:null),a=n===r,l=a&&o?o(n):n;return a===!1&&(l=o?o(n):n,a=l===r),(a===!1||i.capture===!0)&&(i.matchBase===!0||i.basename===!0?a=z.matchBase(n,e,t,s):a=e.exec(l)),{isMatch:Boolean(a),match:a,output:l}};z.matchBase=(n,e,t,r=hn.isWindows(t))=>(e instanceof RegExp?e:z.makeRe(e,t)).test(Aa.basename(n));z.isMatch=(n,e,t)=>z(e,t)(n);z.parse=(n,e)=>Array.isArray(n)?n.map(t=>z.parse(t,e)):un(n,{...e,fastpaths:!1});z.scan=(n,e)=>_a(n,e);z.compileRe=(n,e,t=!1,r=!1)=>{if(t===!0)return n.output;let s=e||{},i=s.contains?"":"^",o=s.contains?"":"$",a=`${i}(?:${n.output})${o}`;n&&n.negated===!0&&(a=`^(?!${a}).*$`);let l=z.toRegex(a,e);return r===!0&&(l.state=n),l};z.makeRe=(n,e={},t=!1,r=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let s={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(s.output=un.fastpaths(n,e)),s.output||(s=un(n,e)),z.compileRe(s,e,t,r)};z.toRegex=(n,e)=>{try{let t=e||{};return new RegExp(n,t.flags||(t.nocase?"i":""))}catch(t){if(e&&e.debug===!0)throw t;return/$^/}};z.constants=ba;Nr.exports=z});var Hr=Pe((Bu,Ur)=>{"use strict";Ur.exports=kr()});var vi=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,gi=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,Wn="noscale";var Ht="fit",Xn="scale",Vn="fill",Qn="stretch",Zn=300,Jn=150,er=Ht,yi=200,ht=class extends HTMLElement{static create(e={}){let{root:t=document.body,id:r=void 0,mode:s=er,width:i=Zn,height:o=Jn,debug:a=!1}=e||{},l=new ht;return l.id=r,l.mode=s,l.width=i,l.height=o,l.debug=a,t.appendChild(l),l}static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=vi,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=gi,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}constructor(){super();let e=this.attachShadow({mode:"open"});e.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=e.querySelector("canvas"),this._contentElement=e.querySelector(".content"),this._innerElement=e.querySelector("#inner"),this._titleElement=e.querySelector("#title"),this._fpsElement=e.querySelector("#fps"),this._dimensionElement=e.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=Zn,this._height=Jn,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Ue(this,"mode"),Ue(this,"debug"),Ue(this,"disabled"),Ue(this,"width"),Ue(this,"height"),Ue(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",er),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(e,t,r){switch(e){case"debug":this._debug=r!==null;break;case"disabled":this._disabled=r!==null;break;case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this);break}switch(e){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r);break}}getContext(e="2d",t=void 0){return this._canvasElement.getContext(e,t)}pause(){window.cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=window.requestAnimationFrame(this.update)}update(e){this._animationRequestHandle=window.requestAnimationFrame(this.update),this.updateCanvasSize(!1);let t=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this._debug){let i=t<=0?"--":String(Math.round(1e3/t)).padStart(2,"0");if(this._fpsElement.textContent!==i&&(this._fpsElement.textContent=i),this.mode===Wn){let a=`${this._width}x${this._height}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}else{let a=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}}let s=this._frameEvent.detail;s.now=e,s.prevTime=this._prevAnimationFrameTime,s.deltaTime=t,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=null,this.updateCanvasSize(!0)}delayCanvasResize(e,t){(e!==this._resizeCanvasWidth||t!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=e,this._resizeCanvasHeight=t,this._resizeTimeoutHandle&&window.clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=window.setTimeout(this.onDelayCanvasResize,yi))}updateCanvasSize(e=!0){let t=this.shadowRoot.host.getBoundingClientRect(),r=t.width,s=t.height,i=this._canvasElement,o=this._width,a=this._height,l=this.mode;if(l===Qn||l===Vn)o=r,a=s;else if(l!==Wn&&(r<o||s<a||l===Ht||l==Xn)){let c=r/o,m=s/a;c<m?(o=r,a=a*c):(o=o*m,a=s)}if(o=Math.floor(o),a=Math.floor(a),typeof e=="undefined"&&(e=i.clientWidth!==o||i.clientHeight!==a),!e){this.delayCanvasResize(o,a);return}let f=Math.min(o/this._width,a/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${f}em`,e){l===Xn?(i.width=this._width,i.height=this._height):l!==Qn&&(i.width=o,i.height=a);let c=this._contentElement.style;c.width=`${o}px`,c.height=`${a}px`,(l===Ht||l===Vn)&&(this._width=o,this._height=a);let E=this._resizeEvent.detail;E.width=o,E.height=a,this.dispatchEvent(this._resizeEvent)}}};ht.define();function Ue(n,e){if(Object.prototype.hasOwnProperty.call(n,e)){let t=n[e];delete n[e],n[e]=t}}var Kt=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(e){this._size=e,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(e){this._size=e}getState(e){throw new Error("Missing implementation.")}onUpdate(e,t,r){throw new Error("Missing implementation.")}onStatus(e,t){throw new Error("Missing implementation.")}onPoll(e){this._lastPollingTime=e}onBind(e,t=void 0){e>=this._size&&this.resize(e+1)}onUnbind(){this.resize(0)}},Ye=class extends Kt{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(e=0){super(e);let t=new Array,r=this.constructor;for(let s=0;s<e;++s)t.push(r.createAxisBindingState());this._state=t,this._value=0,this._delta=0}resize(e){let t=this._state,r=t.length,s;if(e<=r)s=t.slice(0,e);else{s=t;let i=this.constructor;for(let o=r;o<e;++o)s.push(i.createAxisBindingState())}this._state=s,super.resize(e)}getState(e){return this._state[e].value}onPoll(e){let t=this._state,r=0,s=0,i=t.length;for(let o=0;o<i;++o){let a=t[o];r+=a.value*(a.inverted?-1:1),s+=a.delta,t[o].delta=0}this._value=r,this._delta=s,super.onPoll(e)}onUpdate(e,t,r){typeof t=="undefined"?this.onAxisChange(e,r):this.onAxisMove(e,t,r)}onStatus(e,t){this.onAxisStatus(e,t)}onBind(e,t=void 0){super.onBind(e,t);let{inverted:r=!1}=t||{},s=this._state;s[e].inverted=r}onAxisMove(e,t,r){let s=this._state[e];s.value=t,s.delta+=r}onAxisChange(e,t){let r=this._state[e];r.value+=t,r.delta+=t}onAxisStatus(e,t){let r=this._state[e],s=r.value;r.value=t,r.delta=t-s}},wi=241,tr=254,Ei=239,De=1,$t=2,Ft=4,zt=8,jt=16,ct=class extends Kt{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(e=0){super(e);this._state=new Uint8Array(e),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(e){let t=this._state,r=t.length,s;e<=r?s=t.slice(0,e):(s=new Uint8Array(e),s.set(t)),this._state=s,super.resize(e)}getState(e){let t=this._state[e],r=t&jt?-1:1;return(t&De?1:0)*r}onPoll(e){let t=this._state,r=0,s=0,i=0,o=0,a=0,l=t.length;for(let f=0;f<l;++f){let c=t[f],m=c&De,E=c&jt;s|=m,i|=c&$t,o|=c&Ft,a|=c&zt,r+=(m?1:0)*(E?-1:1),t[f]&=wi}this._value=r,this._down=s!==0,this._pressed=i!==0,this._repeated=o!==0,this._released=a!==0,super.onPoll(e)}onUpdate(e,t,r){r>0?this.onButtonPressed(e):this.onButtonReleased(e)}onStatus(e,t){this.onButtonStatus(e,t!==0)}onBind(e,t={inverted:!1}){super.onBind(e,t);let{inverted:r=!1}=t,s=this._state;r?s[e]|=jt:s[e]&=Ei}onButtonPressed(e){let t=this._state,r=t[e];r&De||(r|=$t,r|=De),r|=Ft,t[e]=r}onButtonReleased(e){let t=this._state,r=t[e];r&De&&(r|=zt,r&=tr),t[e]=r}onButtonStatus(e,t){let r=this._state,s=r[e],i=Boolean(s&De);t?s|=De:s&=tr,i&&!t&&(s|=zt),!i&&t&&(s|=$t,s|=Ft),r[e]=s}},v=class{static parse(e){e=e.trim();let t=e.indexOf(".");if(t<0)throw new Error("Missing device separator for key code.");let r=e.substring(0,t);if(r.length<0)throw new Error("Missing device for key code.");let s=e.substring(t+1);if(s.length<0)throw new Error("Missing code for key code.");return new v(r,s)}constructor(e,t){this.device=e,this.code=t}toString(){return`${this.device}.${this.code}`}};function nr(n,e){return new v(n,e)}function xi(n){return"device"in n&&"code"in n}var w="Keyboard",ce="Mouse",Ai=new v(w,"KeyA"),_i=new v(w,"KeyB"),bi=new v(w,"KeyC"),Si=new v(w,"KeyD"),Ri=new v(w,"KeyE"),Ti=new v(w,"KeyF"),Ci=new v(w,"KeyG"),Mi=new v(w,"KeyH"),Ii=new v(w,"KeyI"),Li=new v(w,"KeyJ"),Oi=new v(w,"KeyK"),Pi=new v(w,"KeyL"),Di=new v(w,"KeyM"),Bi=new v(w,"KeyN"),Ni=new v(w,"KeyO"),ki=new v(w,"KeyP"),Ui=new v(w,"KeyQ"),Hi=new v(w,"KeyR"),Ki=new v(w,"KeyS"),$i=new v(w,"KeyT"),Fi=new v(w,"KeyU"),zi=new v(w,"KeyV"),ji=new v(w,"KeyW"),qi=new v(w,"KeyX"),Yi=new v(w,"KeyY"),Gi=new v(w,"KeyZ"),Wi=new v(w,"Digit0"),Xi=new v(w,"Digit1"),Vi=new v(w,"Digit2"),Qi=new v(w,"Digit3"),Zi=new v(w,"Digit4"),Ji=new v(w,"Digit5"),eo=new v(w,"Digit6"),to=new v(w,"Digit7"),no=new v(w,"Digit8"),ro=new v(w,"Digit9"),so=new v(w,"Minus"),io=new v(w,"Equal"),oo=new v(w,"BracketLeft"),ao=new v(w,"BracketRight"),lo=new v(w,"Semicolon"),uo=new v(w,"Quote"),ho=new v(w,"Backquote"),co=new v(w,"Backslash"),fo=new v(w,"Comma"),po=new v(w,"Period"),mo=new v(w,"Slash"),vo=new v(w,"Escape"),go=new v(w,"Space"),yo=new v(w,"CapsLock"),wo=new v(w,"Backspace"),Eo=new v(w,"Delete"),xo=new v(w,"Tab"),Ao=new v(w,"Enter"),_o=new v(w,"ArrowUp"),bo=new v(w,"ArrowDown"),So=new v(w,"ArrowLeft"),Ro=new v(w,"ArrowRight"),To=new v(ce,"Button0"),Co=new v(ce,"Button1"),Mo=new v(ce,"Button2"),Io=new v(ce,"Button3"),Lo=new v(ce,"Button4"),Oo=new v(ce,"PosX"),Po=new v(ce,"PosY"),Do=new v(ce,"WheelX"),Bo=new v(ce,"WheelY"),No=new v(ce,"WheelZ"),se=Object.freeze({__proto__:null,ARROW_DOWN:bo,ARROW_LEFT:So,ARROW_RIGHT:Ro,ARROW_UP:_o,BACKQUOTE:ho,BACKSLASH:co,BACKSPACE:wo,BRACKET_LEFT:oo,BRACKET_RIGHT:ao,CAPS_LOCK:yo,COMMA:fo,DELETE:Eo,DIGIT_0:Wi,DIGIT_1:Xi,DIGIT_2:Vi,DIGIT_3:Qi,DIGIT_4:Zi,DIGIT_5:Ji,DIGIT_6:eo,DIGIT_7:to,DIGIT_8:no,DIGIT_9:ro,ENTER:Ao,EQUAL:io,ESCAPE:vo,KEYBOARD:w,KEY_A:Ai,KEY_B:_i,KEY_C:bi,KEY_D:Si,KEY_E:Ri,KEY_F:Ti,KEY_G:Ci,KEY_H:Mi,KEY_I:Ii,KEY_J:Li,KEY_K:Oi,KEY_L:Pi,KEY_M:Di,KEY_N:Bi,KEY_O:Ni,KEY_P:ki,KEY_Q:Ui,KEY_R:Hi,KEY_S:Ki,KEY_T:$i,KEY_U:Fi,KEY_V:zi,KEY_W:ji,KEY_X:qi,KEY_Y:Yi,KEY_Z:Gi,MINUS:so,MOUSE:ce,MOUSE_BUTTON_0:To,MOUSE_BUTTON_1:Co,MOUSE_BUTTON_2:Mo,MOUSE_BUTTON_3:Io,MOUSE_BUTTON_4:Lo,MOUSE_POS_X:Oo,MOUSE_POS_Y:Po,MOUSE_WHEEL_X:Do,MOUSE_WHEEL_Y:Bo,MOUSE_WHEEL_Z:No,PERIOD:po,QUOTE:uo,SEMICOLON:lo,SLASH:mo,SPACE:go,TAB:xo,from:nr,isKeyCode:xi}),rr=class{get polling(){return this.ref?this.ref.polling:!1}get value(){return!this.ref||this.disabled?0:this.ref.value}constructor(e){this.name=e,this.ref=null,this.disabled=!1}bindTo(e){throw new Error("Unsupported operation.")}disable(e=!0){return this.disabled=e,this}getState(e){return!this.ref||this.disabled?0:this.ref.getState(e)}};function ko(n){Array.isArray(n)||(n=[n]);let e=[];for(let t of n){let r;try{r=v.parse(t)}catch(s){let i=Uo(t).toUpperCase();if(!(i in se))throw new Error("Invalid key code string - "+s);r=se[i]}e.push(r)}return e}function Uo(n){return n.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,function(e,t,r){return t+(r&&"_"+r)}).toLowerCase()}var fe=class extends rr{static fromBind(e,t,r,s=void 0){return new fe(e,nr(t,r),s)}static fromString(e,...t){let r=ko(t);return new fe(e,r)}get pressed(){return!this.ref||this.disabled?!1:this.ref.pressed}get repeated(){return!this.ref||this.disabled?!1:this.ref.repeated}get released(){return!this.ref||this.disabled?!1:this.ref.released}get down(){return!this.ref||this.disabled?!1:this.ref.down}constructor(e,t,r=void 0){super(e);this.keyCodes=Array.isArray(t)?t:[t],this.opts=r}bindTo(e){let t=this.name,r=this.opts;for(let s of this.keyCodes)e.bindButton(t,s.device,s.code,r);return this.ref=e.getButton(t),this}};var qt=class{static isAxis(e){return!1}static isButton(e){return!1}constructor(e,t){if(!t)throw new Error(`Missing event target for device ${e}.`);this.name=e,this.eventTarget=t,this.listeners={input:[]}}setEventTarget(e){if(!e)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=e}destroy(){let e=this.listeners;for(let t in e)e[t].length=0}addEventListener(e,t){let r=this.listeners;e in r?r[e].push(t):r[e]=[t]}removeEventListener(e,t){let r=this.listeners;if(e in r){let s=r[e],i=s.indexOf(t);i>=0&&s.splice(i,1)}}dispatchInputEvent(e){let t=0;for(let r of this.listeners.input)t|=r(e);return Boolean(t)}},sr=class extends qt{static isAxis(e){return!1}static isButton(e){return!0}constructor(e,t,r={}){super(e,t);let{ignoreRepeat:s=!0}=r;this.ignoreRepeat=s,this._eventObject={target:t,device:e,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}setEventTarget(e){this.eventTarget&&this.destroy(),super.setEventTarget(e),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat&&this.ignoreRepeat)return e.preventDefault(),e.stopPropagation(),!1;let t=this._eventObject;if(t.code=e.code,t.event="pressed",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t))return e.preventDefault(),e.stopPropagation(),!1}onKeyUp(e){let t=this._eventObject;if(t.code=e.code,t.event="released",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t))return e.preventDefault(),e.stopPropagation(),!1}},Yt=10,Gt=100,ir=class extends qt{static isAxis(e){return e==="PosX"||e==="PosY"||e==="WheelX"||e==="WheelY"||e==="WheelZ"}static isButton(e){return!this.isAxis(e)}constructor(e,t,r={}){super(e,t);let{eventsOnFocus:s=!0}=r;this.eventsOnFocus=s,this.canvasTarget=this.getCanvasFromEventTarget(t),this._downHasFocus=!1,this._eventObject={target:t,device:e,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:t,device:e,code:"",event:"move",value:0,movement:0},this._wheelObject={target:t,device:e,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(e){this.eventTarget&&this.destroy(),super.setEventTarget(e),this.canvasTarget=this.getCanvasFromEventTarget(e),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let t=this._eventObject;if(t.code="Button"+e.button,t.event="pressed",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let t,r,s;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:t=e.deltaX*Yt,r=e.deltaY*Yt,s=e.deltaZ*Yt;break;case WheelEvent.DOM_DELTA_PAGE:t=e.deltaX*Gt,r=e.deltaY*Gt,s=e.deltaZ*Gt;break;case WheelEvent.DOM_DELTA_PIXEL:default:t=e.deltaX,r=e.deltaY,s=e.deltaZ;break}let i=0,o=this._wheelObject;if(o.code="WheelX",o.movement=t,i|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=r,i|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=s,i|=this.dispatchInputEvent(o),i)return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let t=this._eventObject;if(t.code="Button"+e.button,t.event="released",t.value=1,t.control=e.ctrlKey,t.shift=e.shiftKey,t.alt=e.altKey,this.dispatchInputEvent(t))return e.preventDefault(),e.stopPropagation(),!1}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let t=this.canvasTarget,{clientWidth:r,clientHeight:s}=t,i=t.getBoundingClientRect(),o=e.movementX/r,a=e.movementY/s,l=(e.clientX-i.left)/r,f=(e.clientY-i.top)/s,c=this._positionObject;c.code="PosX",c.value=l,c.movement=o,this.dispatchInputEvent(c),c.code="PosY",c.value=f,c.movement=a,this.dispatchInputEvent(c)}getCanvasFromEventTarget(e){return e instanceof HTMLCanvasElement?e:e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e}},Ho=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,Ko=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Wt=class extends HTMLElement{static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Ho,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=Ko,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super();let e=this.constructor,t=this.attachShadow({mode:"open"});t.appendChild(e[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(e[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=t.querySelector("kbd"),this._nameElement=t.querySelector("#name"),this._valueElement=t.querySelector("#value")}attributeChangedCallback(e,t,r){switch(e){case"name":this._name=r,this._nameElement.textContent=r;break;case"value":this._value=r,r!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=r,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=r!==null,this._kbdElement.classList.toggle("disabled",r!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}};Wt.define();var $o=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,Fo=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,or=class{constructor(e){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=e}get running(){return this.animationFrameHandle!==null}start(){let e=this.animationFrameHandle;e&&cancelAnimationFrame(e),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let e=this.animationFrameHandle;e&&cancelAnimationFrame(e),this.animationFrameHandle=null}onAnimationFrame(e){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(e)}},ar=class{constructor(e){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=e}onPoll(e){for(let t of this.bindings.getInputs())t.onPoll(e)}onInput(e){let{device:t,code:r,event:s,value:i,movement:o,control:a,shift:l,alt:f}=e,c=this.bindings.getBindings(t,r);switch(s){case"pressed":for(let{input:m,index:E}of c)m.onUpdate(E,1,1);break;case"released":for(let{input:m,index:E}of c)m.onUpdate(E,0,-1);break;case"move":for(let{input:m,index:E}of c)m.onUpdate(E,i,o);break;case"wheel":for(let{input:m,index:E}of c)m.onUpdate(E,void 0,o);break}return c.length>0}},Xt=class{constructor(e,t,r,s){this.device=e,this.code=t,this.input=r,this.index=s}},lr=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let e of this.inputMap.keys())e.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(e,t,r,s={inverted:!1}){let i,o=this.inputMap;if(o.has(e)){let l=o.get(e),f=e.size;e.onBind(f,s),i=new Xt(t,r,e,f),l.push(i)}else{let l=[];o.set(e,l);let f=0;e.onBind(f,s),i=new Xt(t,r,e,f),l.push(i)}let a=this.bindingMap;t in a?r in a[t]?a[t][r].push(i):a[t][r]=[i]:a[t]={[r]:[i]}}unbind(e){let t=this.inputMap;if(t.has(e)){let r=this.bindingMap,s=t.get(e);for(let i of s){let{device:o,code:a}=i,l=r[o][a],f=l.indexOf(i);l.splice(f,1)}s.length=0,e.onUnbind(),t.delete(e)}}isBound(e){return this.inputMap.has(e)}getInputs(){return this.inputMap.keys()}getBindingsByInput(e){return this.inputMap.get(e)}getBindings(e,t){let r=this.bindingMap;if(e in r){let s=r[e];if(t in s)return s[t]}return[]}},ur=class{constructor(e,t=void 0){this.inputs={},this.devices=[new ir("Mouse",e),new sr("Keyboard",e)],this.bindings=new lr,this.adapter=new ar(this.bindings),this.autopoller=new or(this.adapter),this.eventTarget=e,this.anyButton=new ct(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Ye(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),e.addEventListener("focus",this.onEventTargetFocus),e.addEventListener("blur",this.onEventTargetBlur);for(let r of this.devices)r.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(e){this.toggleAutoPoll(e)}destroy(){let e=this.listeners;for(let r in e)e[r].length=0;this.autopoller.running&&this.autopoller.stop();for(let r of this.devices)r.removeEventListener("input",this.onInput),r.destroy();let t=this.eventTarget;t.removeEventListener("focus",this.onEventTargetFocus),t.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(e){let t=this.eventTarget;t.removeEventListener("focus",this.onEventTargetFocus),t.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=e;for(let r of this.devices)r.setEventTarget(e);e.addEventListener("focus",this.onEventTargetFocus),e.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(e=void 0){let t=this.autopoller.running,r=typeof e=="undefined"?!t:Boolean(e);r!==t&&(r?this.autopoller.start():this.autopoller.stop())}addEventListener(e,t){let r=this.listeners;e in r?r[e].push(t):r[e]=[t]}removeEventListener(e,t){let r=this.listeners;if(e in r){let s=r[e],i=s.indexOf(t);i>=0&&s.splice(i,1)}}dispatchEvent(e){let{type:t}=e,r=0;for(let s of this.listeners[t])r|=s(e)?1:0;return Boolean(r)}poll(e=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(e)}onInput(e){let t=this.adapter.onInput(e);switch(e.event){case"pressed":this.anyButtonDevice=e.device,this.anyButtonCode=e.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=e.device,this.anyButtonCode=e.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=e.device,this.anyAxisCode=e.code,this.anyAxis.onUpdate(0,e.value,e.movement);break}return t}onPoll(e){this.adapter.onPoll(e),this.anyButton.onPoll(e),this.anyAxis.onPoll(e)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let e of this.bindings.getInputs())e.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(e){Array.isArray(e)||(e=Object.values(e));for(let t of e)t.bindTo(this)}bindBinding(e){e.bindTo(this)}bindButton(e,t,r,s=void 0){let i;this.hasButton(e)?i=this.getButton(e):(i=new ct(1),this.inputs[e]=i),this.bindings.bind(i,t,r,s),this.onBind()}bindAxis(e,t,r,s=void 0){let i;this.hasAxis(e)?i=this.getAxis(e):(i=new Ye(1),this.inputs[e]=i),this.bindings.bind(i,t,r,s),this.onBind()}bindAxisButtons(e,t,r,s){let i;this.hasAxis(e)?i=this.getAxis(e):(i=new Ye(2),this.inputs[e]=i),this.bindings.bind(i,t,s),this.bindings.bind(i,t,r,{inverted:!0}),this.onBind()}unbindButton(e){if(this.hasButton(e)){let t=this.getButton(e);delete this.inputs[e],this.bindings.unbind(t),this.onUnbind()}}unbindAxis(e){if(this.hasAxis(e)){let t=this.getAxis(e);delete this.inputs[e],this.bindings.unbind(t),this.onUnbind()}}getInput(e){return this.inputs[e]}getButton(e){return this.inputs[e]}getAxis(e){return this.inputs[e]}hasButton(e){return e in this.inputs&&this.inputs[e]instanceof ct}hasAxis(e){return e in this.inputs&&this.inputs[e]instanceof Ye}isButtonDown(e){return this.inputs[e].down}isButtonPressed(e){return this.inputs[e].pressed}isButtonReleased(e){return this.inputs[e].released}getInputValue(e){return this.inputs[e].value}getButtonValue(e){return this.inputs[e].value}getAxisValue(e){return this.inputs[e].value}getAxisDelta(e){return this.inputs[e].delta}isAnyButtonDown(e=void 0){if(typeof e=="undefined")return this.anyButton.down;{let t=this.inputs;for(let r of e)if(t[r].down)return!0}return!1}isAnyButtonPressed(e=void 0){if(typeof e=="undefined")return this.anyButton.pressed;{let t=this.inputs;for(let r of e)if(t[r].pressed)return!0}return!1}isAnyButtonReleased(e=void 0){if(typeof e=="undefined")return this.anyButton.released;{let t=this.inputs;for(let r of e)if(t[r].released)return!0}return!1}getAnyAxisValue(e=void 0){if(typeof e=="undefined")return this.anyAxis.value;{let t=this.inputs;for(let r of e){let s=t[r];if(s.value)return s.value}}return 0}getAnyAxisDelta(e=void 0){if(typeof e=="undefined")return this.anyAxis.delta;{let t=this.inputs;for(let r of e){let s=t[r];if(s.delta)return s.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},ft=class extends HTMLElement{static create(e={}){let{root:t=document.body,id:r=void 0,for:s=void 0,autopoll:i=!1}=e||{},o=new ft;return o.id=r,o.for=s,o.autopoll=i,t.appendChild(o),o}static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=$o,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=Fo,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}constructor(){super();let e=this.attachShadow({mode:"open"});e.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=e.querySelector("#title"),this._pollElement=e.querySelector("#poll"),this._focusElement=e.querySelector("#focus"),this._bodyElement=e.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let t=this;this._for="",this._eventTarget=t,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let e=this._context;e&&(e.removeEventListener("bind",this.onInputContextBind),e.removeEventListener("unbind",this.onInputContextUnbind),e.removeEventListener("blur",this.onInputContextBlur),e.removeEventListener("focus",this.onInputContextFocus),e.destroy(),this._context=null)}attributeChangedCallback(e,t,r){switch(e){case"for":{this._for=r;let s,i;r?(s=document.getElementById(r),i=`${s.tagName.toLowerCase()}#${r}`):(s=this,i="input-port"),this._eventTarget=s,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${i}`}break;case"autopoll":this._autopoll=r!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(e="axisbutton",t=void 0){switch(e){case"axisbutton":if(!this._context){let r=new ur(this._eventTarget,t);r.addEventListener("bind",this.onInputContextBind),r.addEventListener("unbind",this.onInputContextUnbind),r.addEventListener("blur",this.onInputContextBlur),r.addEventListener("focus",this.onInputContextFocus),this._autopoll&&r.toggleAutoPoll(!0),this._context=r}return this._context;default:throw new Error(`Input context id '${e}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let e=this._context,t=e.inputs,r=e.bindings,s={},i=[];for(let o of Object.keys(t)){let a=t[o],l=!0;for(let f of r.getBindingsByInput(a)){let c=zo(`${a.constructor.name}.${o}`,`${f.device}.${f.code}`,0,l);i.push(c),l&&(s[o]=c.querySelector("output"),l=!1)}}this._outputElements=s,this._bodyElement.innerHTML="";for(let o of i)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let r of Object.keys(this._outputElements)){let s=this._outputElements[r],i=t[r].value;s.innerText=Number(i).toFixed(2)}}else{for(let e of Object.keys(this._outputElements)){let t=this._outputElements[e];t.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let r of Object.values(t))if(!r.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};ft.define();function zo(n,e,t,r=!0){let s=document.createElement("tr");r&&s.classList.add("primary");{let i=document.createElement("td");i.textContent=n,i.classList.add("name"),s.appendChild(i)}{let i=document.createElement("td"),o=document.createElement("output");r?o.innerText=Number(t).toFixed(2):o.innerText="---",o.classList.add("value"),i.appendChild(o),s.appendChild(i)}{let i=document.createElement("td");i.classList.add("key");let o=new Wt;o.innerText=e,i.appendChild(o),s.appendChild(i)}return s}var Ru=Symbol("keyboardSource");var Tu=Symbol("mouseSource");var rs=mi(Hr());var Kr={},Ra=function(n,e,t,r,s){var i=new Worker(Kr[e]||(Kr[e]=URL.createObjectURL(new Blob([n+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return i.onmessage=function(o){var a=o.data,l=a.$e$;if(l){var f=new Error(l[0]);f.code=l[1],f.stack=l[2],s(f,null)}else s(null,a)},i.postMessage(t,r),i},Z=Uint8Array,Me=Uint16Array,cn=Uint32Array,fn=new Z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pn=new Z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$r=new Z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fr=function(n,e){for(var t=new Me(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var s=new cn(t[30]),r=1;r<30;++r)for(var i=t[r];i<t[r+1];++i)s[i]=i-t[r]<<5|r;return[t,s]},zr=Fr(fn,2),dn=zr[0],Ta=zr[1];dn[28]=258,Ta[258]=28;var jr=Fr(pn,0),qr=jr[0],Nu=jr[1],Et=new Me(32768);for(var B=0;B<32768;++B)_e=(B&43690)>>>1|(B&21845)<<1,_e=(_e&52428)>>>2|(_e&13107)<<2,_e=(_e&61680)>>>4|(_e&3855)<<4,Et[B]=((_e&65280)>>>8|(_e&255)<<8)>>>1;var _e,Ke=function(n,e,t){for(var r=n.length,s=0,i=new Me(e);s<r;++s)n[s]&&++i[n[s]-1];var o=new Me(e);for(s=0;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;var a;if(t){a=new Me(1<<e);var l=15-e;for(s=0;s<r;++s)if(n[s])for(var f=s<<4|n[s],c=e-n[s],m=o[n[s]-1]++<<c,E=m|(1<<c)-1;m<=E;++m)a[Et[m]>>>l]=f}else for(a=new Me(r),s=0;s<r;++s)n[s]&&(a[s]=Et[o[n[s]-1]++]>>>15-n[s]);return a},Xe=new Z(288);for(var B=0;B<144;++B)Xe[B]=8;for(var B=144;B<256;++B)Xe[B]=9;for(var B=256;B<280;++B)Xe[B]=7;for(var B=280;B<288;++B)Xe[B]=8;var Yr=new Z(32);for(var B=0;B<32;++B)Yr[B]=5;var Gr=Ke(Xe,9,1);var Wr=Ke(Yr,5,1),xt=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},ue=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},At=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Xr=function(n){return(n+7)/8|0},_t=function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var r=new(n.BYTES_PER_ELEMENT==2?Me:n.BYTES_PER_ELEMENT==4?cn:Z)(t-e);return r.set(n.subarray(e,t)),r};var Vr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],te=function(n,e,t){var r=new Error(e||Vr[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,te),!t)throw r;return r},Qr=function(n,e,t){var r=n.length;if(!r||t&&t.f&&!t.l)return e||new Z(0);var s=!e||t,i=!t||t.i;t||(t={}),e||(e=new Z(r*3));var o=function(_){var Oe=e.length;if(_>Oe){var at=new Z(Math.max(Oe*2,_));at.set(e),e=at}},a=t.f||0,l=t.p||0,f=t.b||0,c=t.l,m=t.d,E=t.m,I=t.n,S=r*8;do{if(!c){a=ue(n,l,1);var T=ue(n,l+1,3);if(l+=3,T)if(T==1)c=Gr,m=Wr,E=9,I=5;else if(T==2){var M=ue(n,l,31)+257,Y=ue(n,l+10,15)+4,K=M+ue(n,l+5,31)+1;l+=14;for(var X=new Z(K),F=new Z(19),y=0;y<Y;++y)F[$r[y]]=ue(n,l+y*3,7);l+=Y*3;for(var A=xt(F),$=(1<<A)-1,p=Ke(F,A,1),y=0;y<K;){var O=p[ue(n,l,$)];l+=O&15;var L=O>>>4;if(L<16)X[y++]=L;else{var C=0,re=0;for(L==16?(re=3+ue(n,l,3),l+=2,C=X[y-1]):L==17?(re=3+ue(n,l,7),l+=3):L==18&&(re=11+ue(n,l,127),l+=7);re--;)X[y++]=C}}var h=X.subarray(0,M),u=X.subarray(M);E=xt(h),I=xt(u),c=Ke(h,E,1),m=Ke(u,I,1)}else te(1);else{var L=Xr(l)+4,U=n[L-4]|n[L-3]<<8,j=L+U;if(j>r){i&&te(0);break}s&&o(f+U),e.set(n.subarray(L,j),f),t.b=f+=U,t.p=l=j*8,t.f=a;continue}if(l>S){i&&te(0);break}}s&&o(f+131072);for(var G=(1<<E)-1,R=(1<<I)-1,J=l;;J=l){var C=c[At(n,l)&G],W=C>>>4;if(l+=C&15,l>S){i&&te(0);break}if(C||te(2),W<256)e[f++]=W;else if(W==256){J=l,c=null;break}else{var V=W-254;if(W>264){var y=W-257,me=fn[y];V=ue(n,l,(1<<me)-1)+dn[y],l+=me}var qe=m[At(n,l)&R],Ce=qe>>>4;qe||te(3),l+=qe&15;var u=qr[Ce];if(Ce>3){var me=pn[Ce];u+=At(n,l)&(1<<me)-1,l+=me}if(l>S){i&&te(0);break}s&&o(f+131072);for(var ve=f+V;f<ve;f+=4)e[f]=e[f-u],e[f+1]=e[f+1-u],e[f+2]=e[f+2-u],e[f+3]=e[f+3-u];f=ve}}t.l=c,t.p=J,t.b=f,t.f=a,c&&(a=1,t.m=E,t.d=m,t.n=I)}while(!a);return f==e.length?e:_t(e,0,f)};var Ca=new Z(0);var Ma=function(n,e){var t={};for(var r in n)t[r]=n[r];for(var r in e)t[r]=e[r];return t},Zr=function(n,e,t){for(var r=n(),s=n.toString(),i=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<r.length;++o){var a=r[o],l=i[o];if(typeof a=="function"){e+=";"+l+"=";var f=a.toString();if(a.prototype)if(f.indexOf("[native code]")!=-1){var c=f.indexOf(" ",8)+1;e+=f.slice(c,f.indexOf("(",c))}else{e+=f;for(var m in a.prototype)e+=";"+l+".prototype."+m+"="+a.prototype[m].toString()}else e+=f}else t[l]=a}return[e,t]},bt=[],Ia=function(n){var e=[];for(var t in n)n[t].buffer&&e.push((n[t]=new n[t].constructor(n[t])).buffer);return e},La=function(n,e,t,r){var s;if(!bt[t]){for(var i="",o={},a=n.length-1,l=0;l<a;++l)s=Zr(n[l],i,o),i=s[0],o=s[1];bt[t]=Zr(n[a],i,o)}var f=Ma({},bt[t][1]);return Ra(bt[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,f,Ia(f),r)},Oa=function(){return[Z,Me,cn,fn,pn,$r,dn,qr,Gr,Wr,Et,Vr,Ke,xt,ue,At,Xr,_t,te,Qr,vn,Jr,es]};var Jr=function(n){return postMessage(n,[n.buffer])},es=function(n){return n&&n.size&&new Z(n.size)},Pa=function(n,e,t,r,s,i){var o=La(t,r,s,function(a,l){o.terminate(),i(a,l)});return o.postMessage([n,e],e.consume?[n.buffer]:[]),function(){o.terminate()}};var ye=function(n,e){return n[e]|n[e+1]<<8},pe=function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},mn=function(n,e){return pe(n,e)+pe(n,e+4)*4294967296};function Da(n,e,t){return t||(t=e,e={}),typeof t!="function"&&te(7),Pa(n,e,[Oa],function(r){return Jr(vn(r.data[0],es(r.data[1])))},1,t)}function vn(n,e){return Qr(n,e)}var ku=typeof TextEncoder!="undefined"&&new TextEncoder,gn=typeof TextDecoder!="undefined"&&new TextDecoder,Ba=0;try{gn.decode(Ca,{stream:!0}),Ba=1}catch(n){}var Na=function(n){for(var e="",t=0;;){var r=n[t++],s=(r>127)+(r>223)+(r>239);if(t+s>n.length)return[e,_t(n,t-1)];s?s==3?(r=((r&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):s&1?e+=String.fromCharCode((r&31)<<6|n[t++]&63):e+=String.fromCharCode((r&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(r)}};function ka(n,e){if(e){for(var t="",r=0;r<n.length;r+=16384)t+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return t}else{if(gn)return gn.decode(n);var s=Na(n),i=s[0],o=s[1];return o.length&&te(8),i}}var Ua=function(n,e){return e+30+ye(n,e+26)+ye(n,e+28)},Ha=function(n,e,t){var r=ye(n,e+28),s=ka(n.subarray(e+46,e+46+r),!(ye(n,e+8)&2048)),i=e+46+r,o=pe(n,e+20),a=t&&o==4294967295?Ka(n,i):[o,pe(n,e+24),pe(n,e+42)],l=a[0],f=a[1],c=a[2];return[ye(n,e+10),l,f,s,i+ye(n,e+30)+ye(n,e+32),c]},Ka=function(n,e){for(;ye(n,e)!=1;e+=4+ye(n,e+2));return[mn(n,e+12),mn(n,e+4),mn(n,e+20)]};var ts=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(n){n()};function ns(n,e,t){t||(t=e,e={}),typeof t!="function"&&te(7);var r=[],s=function(){for(var L=0;L<r.length;++L)r[L]()},i={},o=function(L,U){ts(function(){t(L,U)})};ts(function(){o=t});for(var a=n.length-22;pe(n,a)!=101010256;--a)if(!a||n.length-a>65558)return o(te(13,0,1),null),s;var l=ye(n,a+8);if(l){var f=l,c=pe(n,a+16),m=c==4294967295||f==65535;if(m){var E=pe(n,a-12);m=pe(n,E)==101075792,m&&(f=l=pe(n,E+32),c=pe(n,E+48))}for(var I=e&&e.filter,S=function(L){var U=Ha(n,c,m),j=U[0],M=U[1],Y=U[2],K=U[3],X=U[4],F=U[5],y=Ua(n,F);c=X;var A=function(p,O){p?(s(),o(p,null)):(O&&(i[K]=O),--l||o(null,i))};if(!I||I({name:K,size:M,originalSize:Y,compression:j}))if(!j)A(null,_t(n,y,y+M));else if(j==8){var $=n.subarray(y,y+M);if(M<32e4)try{A(null,vn($,new Z(Y)))}catch(p){A(p,null)}else r.push(Da($,{size:Y},A))}else A(te(14,"unknown compression type "+j,1),null);else A(null,null)},T=0;T<f;++T)S(T)}else o(null,{});return s}var Ve=class{constructor(e){let t;typeof e=="object"&&e instanceof Ve?t=e.source:t=String(e),this.source=t,this._re=(0,rs.makeRe)(t)}test(e){return this._re.test(e)}},$a=/^([_\w\d]+)\:\/\//;async function ss(n,e,t,r,s,i){let{loadings:o}=n,a;e in o?a=o[e]:(a=new $e(i),o[e]=a);let l=$e.nextAttempt(a),f=[a.promise];return $a.test(t)?f.push(is(n,t,i).then(c=>r(c,s)).then(c=>$e.isCurrentAttempt(a,l)?Qe(n,e,c):void 0)):f.push(fetch(t).then(c=>c.arrayBuffer()).then(c=>r(c)).then(c=>$e.isCurrentAttempt(a,l)?Qe(n,e,c):void 0)),await Promise.race(f)}function Qe(n,e,t){let{store:r,loadings:s}=n;return r[e]=t,e in s&&(s[e].resolve(t),delete s[e]),t}function Fa(n,e,t){let{defaults:r}=n;typeof e=="string"&&(e=new Ve(e));let s=`__default://[${r.length}]`;return Qe(n,s,t),r.push(new ls(e,s)),t}function za(n,e){let{store:t,loadings:r}=n;e in r&&(r[e].reject(new Error("Stop loading to delete asset.")),delete r[e]),e in t&&delete t[e]}function ja(n,e){typeof e=="string"&&(e=new Ve(e));let{store:t,loadings:r}=n;for(let[s,i]of Object.entries(r))e.test(s)&&(i.reject(new Error(`Stop loading to clear assets matching ${e}`)),delete r[s]);for(let s of Object.keys(t))e.test(s)&&delete t[s]}function qa(n){let{store:e,loadings:t,defaults:r}=n;for(let[s,i]of Object.entries(t))i.reject(new Error("Stop loading to clear all assets.")),delete t[s];for(let s of Object.keys(e))delete e[s];r.length=0}function Ya(n,e){let{loadings:t}=n;return e in t?t[e].promise:null}async function is(n,e,t){let{store:r,loadings:s}=n;if(e in r)return r[e];if(e in s)return s[e].promise;{let i=new $e(t);return s[e]=i,i.promise}}function Ga(n,e){let{defaults:t}=n;for(let r of t)if(r.glob.test(e))return St(n,r.uri);return null}function St(n,e){return n.store[e]}function Wa(n,e){return Boolean(n.store[e])}function Xa(n){return Object.keys(n.store)}function os(n,e){return e in n.store}function as(n,e){return e in n.loadings}var ls=class{constructor(e,t){this.glob=e,this.uri=t}},$e=class{static nextAttempt(e){return++e._promiseHandle}static isCurrentAttempt(e,t){return e._promiseHandle===t}constructor(e){this._promiseHandle=0,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(e)&&e>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${e} ms.`)},e):null,this._promise=new Promise((t,r)=>{this._value?t(this._value):this._resolve=t,this._reason?r(this._reason):this._reject=r})}get promise(){return this._promise}resolve(e){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(e):this._value=e}reject(e){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(e):this._reason=e}},yn=class{constructor(e=null){this.parent=e,this.store={},this.loadings={},this.defaults=[]}get(e){let t=this;if(os(t,e))return St(t,e);let r=Ga(t,e);return r||null}async resolve(e,t,r,s,i){return this.get(e)||await this.load(e,t,r,s,i)}fallback(e,t){return Fa(this,e,t)}cache(e,t){return Qe(this,e,t)}async load(e,t,r,s,i){let o=this;return os(o,e)?St(o,e):as(o,e)?await is(o,e,i):await ss(o,e,t,r,s,i)}async reload(e,t,r,s,i){return await ss(this,e,t,r,s,i)}unload(e){za(this,e)}clear(e){ja(this,e)}current(e){return St(this,e)}exists(e){return Wa(this,e)}loading(e){let t=this;return as(t,e)?Ya(t,e):null}keys(){return Xa(this)}reset(){qa(this)}},us=5e3,oe=class{constructor(e,t,r=void 0,s=e,i=null){this.uri=e,this.loader=t,this.opts=r,this.initial=i,this.filepath=s,this.source=null,this.current=null}cache(e,t){return e.cache(this.uri,t),this.source=e,this.current=t,this}get(e){let t;return e.exists(this.uri)?t=e.current(this.uri):this.initial&&this.initial instanceof oe?t=this.initial.get(e):t=this.initial,this.source=e,this.current=t,t}async load(e,t=us){let r;if(e.exists(this.uri))r=e.current(this.uri);else if(r=await e.load(this.uri,this.filepath,this.loader,this.opts,t),!r)if(this.initial&&this.initial instanceof oe){let s=this.initial;r=await e.load(s.uri,s.filepath,s.loader,s.opts,t)}else r=this.initial;return this.source=e,this.current=r,r}async reload(e,t=us){let r=await e.reload(this.uri,this.filepath,this.loader,this.opts,t);return this.source=e,this.current=r,r}};async function hs(n,e,t=void 0){let r=n,s="raw://",o=await(await fetch(e)).arrayBuffer();await new Promise((a,l)=>{ns(new Uint8Array(o),(f,c)=>{if(f)l(f);else{for(let[m,E]of Object.entries(c)){m=m.replaceAll("\\","/");let I=m.indexOf("/");I>=0&&(m=m.substring(I+1));let S=s+m;Qe(r,S,E),t&&t(E,S,m)}a()}})})}async function wn(n,e){let{audioContext:t}=e||{};if(typeof n=="string"){let a=await(await fetch(n)).arrayBuffer();return wn(a,{audioContext:t})}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let r=n,s=new ArrayBuffer(r.byteLength);return new Uint8Array(s).set(r),await t.decodeAudioData(s)}window.addEventListener("error",Rt,!0);window.addEventListener("unhandledrejection",Rt,!0);var cs=!1;function Rt(n){cs||(typeof n=="object"?n instanceof PromiseRejectionEvent?Rt(n.reason):n instanceof ErrorEvent?Rt(n.error):n instanceof Error?window.alert(n.stack):window.alert(JSON.stringify(n)):window.alert(n),cs=!0)}var Tt=1e-6,Ze=typeof Float32Array!="undefined"?Float32Array:Array,En=Math.random;var Fu=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Ct={};Ut(Ct,{add:()=>el,angle:()=>Al,bezier:()=>dl,ceil:()=>tl,clone:()=>Va,copy:()=>Za,create:()=>fs,cross:()=>cl,dist:()=>Il,distance:()=>gs,div:()=>Ml,divide:()=>vs,dot:()=>Es,equals:()=>Rl,exactEquals:()=>Sl,floor:()=>nl,forEach:()=>Dl,fromValues:()=>Qa,hermite:()=>pl,inverse:()=>ul,len:()=>Ol,length:()=>ps,lerp:()=>fl,max:()=>sl,min:()=>rl,mul:()=>Cl,multiply:()=>ms,negate:()=>ll,normalize:()=>hl,random:()=>ml,rotateX:()=>wl,rotateY:()=>El,rotateZ:()=>xl,round:()=>il,scale:()=>ol,scaleAndAdd:()=>al,set:()=>Ja,sqrDist:()=>Ll,sqrLen:()=>Pl,squaredDistance:()=>ys,squaredLength:()=>ws,str:()=>bl,sub:()=>Tl,subtract:()=>ds,transformMat3:()=>gl,transformMat4:()=>vl,transformQuat:()=>yl,zero:()=>_l});function fs(){var n=new Ze(3);return Ze!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Va(n){var e=new Ze(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function ps(n){var e=n[0],t=n[1],r=n[2];return Math.hypot(e,t,r)}function Qa(n,e,t){var r=new Ze(3);return r[0]=n,r[1]=e,r[2]=t,r}function Za(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Ja(n,e,t,r){return n[0]=e,n[1]=t,n[2]=r,n}function el(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function ds(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function ms(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function vs(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function tl(n,e){return n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function nl(n,e){return n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function rl(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function sl(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function il(n,e){return n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function ol(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function al(n,e,t,r){return n[0]=e[0]+t[0]*r,n[1]=e[1]+t[1]*r,n[2]=e[2]+t[2]*r,n}function gs(n,e){var t=e[0]-n[0],r=e[1]-n[1],s=e[2]-n[2];return Math.hypot(t,r,s)}function ys(n,e){var t=e[0]-n[0],r=e[1]-n[1],s=e[2]-n[2];return t*t+r*r+s*s}function ws(n){var e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function ll(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function ul(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function hl(n,e){var t=e[0],r=e[1],s=e[2],i=t*t+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Es(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function cl(n,e,t){var r=e[0],s=e[1],i=e[2],o=t[0],a=t[1],l=t[2];return n[0]=s*l-i*a,n[1]=i*o-r*l,n[2]=r*a-s*o,n}function fl(n,e,t,r){var s=e[0],i=e[1],o=e[2];return n[0]=s+r*(t[0]-s),n[1]=i+r*(t[1]-i),n[2]=o+r*(t[2]-o),n}function pl(n,e,t,r,s,i){var o=i*i,a=o*(2*i-3)+1,l=o*(i-2)+i,f=o*(i-1),c=o*(3-2*i);return n[0]=e[0]*a+t[0]*l+r[0]*f+s[0]*c,n[1]=e[1]*a+t[1]*l+r[1]*f+s[1]*c,n[2]=e[2]*a+t[2]*l+r[2]*f+s[2]*c,n}function dl(n,e,t,r,s,i){var o=1-i,a=o*o,l=i*i,f=a*o,c=3*i*a,m=3*l*o,E=l*i;return n[0]=e[0]*f+t[0]*c+r[0]*m+s[0]*E,n[1]=e[1]*f+t[1]*c+r[1]*m+s[1]*E,n[2]=e[2]*f+t[2]*c+r[2]*m+s[2]*E,n}function ml(n,e){e=e||1;var t=En()*2*Math.PI,r=En()*2-1,s=Math.sqrt(1-r*r)*e;return n[0]=Math.cos(t)*s,n[1]=Math.sin(t)*s,n[2]=r*e,n}function vl(n,e,t){var r=e[0],s=e[1],i=e[2],o=t[3]*r+t[7]*s+t[11]*i+t[15];return o=o||1,n[0]=(t[0]*r+t[4]*s+t[8]*i+t[12])/o,n[1]=(t[1]*r+t[5]*s+t[9]*i+t[13])/o,n[2]=(t[2]*r+t[6]*s+t[10]*i+t[14])/o,n}function gl(n,e,t){var r=e[0],s=e[1],i=e[2];return n[0]=r*t[0]+s*t[3]+i*t[6],n[1]=r*t[1]+s*t[4]+i*t[7],n[2]=r*t[2]+s*t[5]+i*t[8],n}function yl(n,e,t){var r=t[0],s=t[1],i=t[2],o=t[3],a=e[0],l=e[1],f=e[2],c=s*f-i*l,m=i*a-r*f,E=r*l-s*a,I=s*E-i*m,S=i*c-r*E,T=r*m-s*c,L=o*2;return c*=L,m*=L,E*=L,I*=2,S*=2,T*=2,n[0]=a+c+I,n[1]=l+m+S,n[2]=f+E+T,n}function wl(n,e,t,r){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function El(n,e,t,r){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function xl(n,e,t,r){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],n[0]=i[0]+t[0],n[1]=i[1]+t[1],n[2]=i[2]+t[2],n}function Al(n,e){var t=n[0],r=n[1],s=n[2],i=e[0],o=e[1],a=e[2],l=Math.sqrt(t*t+r*r+s*s),f=Math.sqrt(i*i+o*o+a*a),c=l*f,m=c&&Es(n,e)/c;return Math.acos(Math.min(Math.max(m,-1),1))}function _l(n){return n[0]=0,n[1]=0,n[2]=0,n}function bl(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Sl(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function Rl(n,e){var t=n[0],r=n[1],s=n[2],i=e[0],o=e[1],a=e[2];return Math.abs(t-i)<=Tt*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(r-o)<=Tt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Tt*Math.max(1,Math.abs(s),Math.abs(a))}var Tl=ds,Cl=ms,Ml=vs,Il=gs,Ll=ys,Ol=ps,Pl=ws,Dl=function(){var n=fs();return function(e,t,r,s,i,o){var a,l;for(t||(t=3),r||(r=0),s?l=Math.min(s*t+r,e.length):l=e.length,a=r;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],i(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e}}();var Vu=Ct.fromValues(0,1,0);var Qu=Math.PI/3;var Zu=Math.PI/180;var be=class{constructor(e,t=()=>null,r=()=>{}){this.name=e,this.new=t,this.delete=r}},xs=class{constructor(){this.queries={},this.keyQueryMapping={},this.onEntityComponentChanged=this.onEntityComponentChanged.bind(this)}onEntityComponentChanged(e,t,r,s,i){for(let o of Object.values(this.keyQueryMapping)){let a=this.queries[o.key];if(i){let l=a.indexOf(t);l>=0&&a.splice(l,1)}else if(r)if(o.hasSelector(As(r))){let l=a.indexOf(t);l>=0&&a.splice(l,1)}else o.hasSelector(r)&&o.test(e,t)&&a.indexOf(t)<0&&a.push(t);else if(s){if(o.hasSelector(As(s))&&o.test(e,t))a.indexOf(t)<0&&a.push(t);else if(o.hasSelector(s)&&o.test(e,t)){let l=a.indexOf(t);l>=0&&a.splice(l,1)}}}}findAny(e,t){let r=this.findAll(e,t);return r.length<=0?null:r[Math.floor(Math.random()*r.length)]}findAll(e,t){let r=t.key,s;return r in this.keyQueryMapping?s=this.queries[r]:(s=[],this.keyQueryMapping[r]=t,this.queries[r]=s,t.hydrate(e,s)),s}count(e,t){return this.findAll(e,t).length}clear(e){let t=e.key;t in this.keyQueryMapping&&(delete this.keyQueryMapping[t],delete this.queries[t])}reset(){this.keyQueryMapping={},this.queries={}}};function As(n){return{type:"not",name:n.name,value:n}}function Je(n){return"type"in n&&n.type==="not"}var xn=class{constructor(){this.components={},this.nameClassMapping={},this.nextAvailableEntityId=1,this.queue=[],this.queryManager=new xs}entityComponentChangedCallback(e,t,r,s){this.queryManager.onEntityComponentChanged(this,e,t,r,s)}flush(){for(;this.queue.length>0;){let[e,...t]=this.queue.shift();switch(e){case"attach":{let[r,s,i]=t;this.attachImmediately(r,s,i)}break;case"detach":{let[r,s]=t;this.detachImmediately(r,s)}break;case"clear":{let[r]=t;this.clearImmediately(r)}break}}}create(){return this.nextAvailableEntityId++}destroy(e){let t=this.components;for(let r of Object.keys(t)){let s=t[r];e in s&&(delete s[e],this.entityComponentChangedCallback(e,null,this.nameClassMapping[r],!1))}this.entityComponentChangedCallback(e,null,null,!0)}exists(e,...t){if(t.length>0){for(let r of t){let s=this.mapOf(r);if(!(e in s))return!1}return!0}else for(let r of Object.values(this.components))if(e in r)return!0;return!1}attach(e,t){let r=t.new();return this.queue.push(["attach",e,t,r]),r}attachImmediately(e,t,r=void 0){typeof r=="undefined"&&(r=t.new());let s=this.mapOf(t);return s[e]=r,this.entityComponentChangedCallback(e,t,null,!1),r}detach(e,t){this.queue.push(["detach",e,t])}detachImmediately(e,t){let r=this.mapOf(t),s=r[e];delete r[e],t.delete(s),this.entityComponentChangedCallback(e,null,t,!1)}clear(e){this.queue.push(["clear",e])}clearImmediately(e){let t=e.name,r=this.components,s=r[t],i=Object.keys(s).map(Number),o=Object.values(s);r[t]={},this.nameClassMapping[t]=e;for(let a of o)e.delete(a);for(let a of i)this.entityComponentChangedCallback(a,null,e,!1)}get(e,t){return this.mapOf(t)[e]||null}count(e){return Object.keys(this.mapOf(e)).length}keysOf(e){return Object.keys(this.mapOf(e)).map(Number)}valuesOf(e){return Object.values(this.mapOf(e))}mapOf(e){let t=e.name,r=this.components;if(t in r)return r[t];{let s={};return r[t]=s,this.nameClassMapping[t]=e,s}}entityIds(){let e=new Set;for(let t of Object.values(this.components))for(let r of Object.keys(t))e.add(r);return e}componentClasses(){return Object.values(this.nameClassMapping)}reset(){let e=this.components,t=new Set;for(let r of Object.keys(e)){let s=this.nameClassMapping[r],i=e[r];for(let o of Object.keys(i))t.add(Number(o));this.clearImmediately(s)}for(let r of t)this.entityComponentChangedCallback(r,null,null,!0);t.clear(),this.queryManager.reset(),this.components={},this.nextAvailableEntityId=1,this.queue.length=0}};var Se=class{constructor(...e){this.selectors=e,this.key=e.map(t=>Je(t)?`!${t.name}`:t.name).sort().join("&")}hasSelector(e){return Je(e)?this.selectors.findIndex(t=>Je(t)&&t.name===e.name)>=0:this.selectors.findIndex(t=>t.name===e.name)>=0}test(e,t){for(let r of this.selectors)if(Je(r)){let s=r.value;if(e.exists(t,s))return!1}else{let s=r;if(!e.exists(t,s))return!1}return!0}hydrate(e,t){if(this.selectors.length<=0)return t.length=0,t;let r=e.entityIds();for(let s of r)this.test(e,s)&&t.push(s);return t}count(e){return e.queryManager.count(e,this)}findAny(e){let t=e.queryManager,r=new Array(this.selectors.length+1),s=t.findAny(e,this);return s===null?r.fill(void 0):(_s(r,e,s,this.selectors),r)}*findAll(e){let t=e.queryManager,r=new Array(this.selectors.length+1),s=t.findAll(e,this);for(let i of s)_s(r,e,i,this.selectors),yield r}};function _s(n,e,t,r){n[0]=t;let s=1;for(let i of r)Je(i)?n[s]=null:n[s]=e.get(t,i),++s;return n}var An=class{dispatch(e=null){}dispatchImmediately(e=null){}flush(e=1e3){}};var Ne=class extends An{constructor(){super();this.listeners=[],this.queued=[]}on(e){return this.listeners.push(e),this}off(e){let t=this.listeners.indexOf(e);return t>=0&&this.listeners.splice(t,1),this}once(e){let t=r=>(this.off(t),e(r));return this.on(t),this}dispatch(e=null){this.queued.push(e)}dispatchImmediately(e=null){for(let t of this.listeners)if(t(e)===!0)break}flush(e=1e3){let t=0;for(;this.queued.length>0&&t++<e;){let r=this.queued.shift();this.dispatchImmediately(r)}}count(){return this.listeners.length}};function Bl(n,e){return n.priority-e.priority}var _n=class extends An{constructor(){super();this.listeners=[],this.queued=[]}on(e,t){return this.listeners.push({priority:e,callback:t}),this.listeners.sort(Bl),this}off(e){for(let t=0;t<this.listeners.length;++t)if(this.listeners.at(t).callback===e){this.listeners.splice(t,1);break}return this}once(e,t){let r=s=>(this.off(r),t(s));return this.on(e,r)}count(){return this.listeners.length}dispatch(e=null){return this.queued.push(e),this}dispatchImmediately(e=null){for(let t of this.listeners)if(t.callback(e)===!0)break;return this}flush(e=1e3){let t=0;for(;this.queued.length>0&&t++<e;){let r=this.queued.shift();this.dispatchImmediately(r)}return this}},bn=class{constructor(e,t=void 0){let{animationFrameHandler:r=window}=t||{};this.handle=0,this.detail={prevTime:-1,currentTime:-1,deltaTime:0},this.animationFrameHandler=r,this.callback=e,this.next=this.next.bind(this),this.start=this.start.bind(this),this.cancel=this.cancel.bind(this)}next(e=performance.now()){this.handle=this.animationFrameHandler.requestAnimationFrame(this.next);let t=this.detail;t.prevTime=t.currentTime,t.currentTime=e,t.deltaTime=t.currentTime-t.prevTime,this.callback(this)}start(){return this.handle=this.animationFrameHandler.requestAnimationFrame(this.next),this}cancel(){return this.animationFrameHandler.cancelAnimationFrame(this.handle),this}};var Ln={};Ut(Ln,{Debug:()=>In,MoveDown:()=>Cn,MoveLeft:()=>Sn,MoveRight:()=>Rn,MoveUp:()=>Tn,Shoot:()=>Mn});var Sn=new fe("moveLeft",[se.ARROW_LEFT,se.KEY_A]),Rn=new fe("moveRight",[se.ARROW_RIGHT,se.KEY_D]),Tn=new fe("moveUp",[se.ARROW_UP,se.KEY_W]),Cn=new fe("moveDown",[se.ARROW_DOWN,se.KEY_S]),Mn=new fe("shoot",se.SPACE),In=new fe("debug",se.BACKSLASH);var On=class{next(){return 0}},bs=class extends On{next(){return Math.random()}},Ss=class extends On{constructor(e){super();this.seed=e,this.a=e}next(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}},x=class{static get RAND(){let e=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:e}),e}constructor(e=void 0){typeof e=="number"?this.generator=new Ss(e):e?this.generator=e:this.generator=new bs,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(e){return this.RAND.choose(e)}choose(e){return e[Math.floor(this.generator.next()*e.length)]}static range(e,t){return this.RAND.range(e,t)}range(e,t){return(t-e)*this.generator.next()+e}static rangeInt(e,t){return this.RAND.rangeInt(e,t)}rangeInt(e,t){return Math.trunc(this.range(e,t))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};var Mt={showCollision:!1},et=.1;function we(n,e,t,r){e.x<-t&&(e.x=n.width),e.y<-r&&(e.y=n.height),e.x>n.width+t/2&&(e.x=-t),e.y>n.height+r/2&&(e.y=-r)}function Fe(n,e,t){let r=n.x-e.x,s=n.y-e.y;return r*r+s*s<=t*t}function Ie(n,e,t,r){!Mt.showCollision||(n.translate(e,t),n.beginPath(),n.arc(0,0,r,0,Math.PI*2),n.strokeStyle="lime",n.stroke(),n.setTransform(1,0,0,1,0,0))}function Rs(n){return new bn(n).next}function N(n,e){return n.use(e)}function ze(n,e){let t=N(n,tt);n.before(async()=>{Promise.allSettled(e.map(r=>r.load(t)))})}var Pn=4,Dn=2,nt=600,Nl=9,Bn=new be("Particle",()=>({x:0,y:0,dx:0,dy:0,rotation:0,age:0,color:"white"})),Ts=new Se(Bn);function Cs(n){let e=N(n,de),{canvas:t}=N(n,he);Ee(n,()=>{e.clear(Bn)}),ae(n,({deltaTime:r})=>{for(let[s,i]of Ts.findAll(e))i.age+=r,i.age>nt?e.destroy(s):(i.x+=i.dx,i.y+=i.dy,we(t,i,Pn*2,Pn*2))}),ne(n,Nl,r=>{for(let[s,i]of Ts.findAll(e)){r.translate(i.x,i.y),r.rotate(i.rotation),r.fillStyle=i.color;let o=Pn*(1-i.age/nt);r.fillRect(-o,-o,o*2,o*2),r.setTransform(1,0,0,1,0,0)}})}function It(n,e,t,r,s,i,o=0){typeof i=="function"&&(i=i());let[a,l]=n.ents.createAndAttach(Bn);return l.x=e,l.y=t,l.dx=r,l.dy=s,l.rotation=Math.atan2(s,r),l.age=o,l.color=i,a}function je(n,e,t,r=10,s){for(let i=0;i<r;++i)It(n,e,t,x.range(-1,1)*Dn,x.range(-1,1)*Dn,s)}var k=1,Nn=.1,rt=4,kl=100,Ul=1,P=8,Lt={MIN:3e3,MAX:1e4},Hl=n=>n.range(Lt.MIN,Lt.MAX),Kl=["blue","blue","blue","dodgerblue","gray","darkgray","yellow"],$l=5;function Ms(n){let e=N(n,xe);Ee(n,()=>{e.asteroids.length=0;for(let t=0;t<Ul*e.level;++t)e.asteroidSpawner.spawn(e)}),ae(n,({deltaTime:t})=>{zl(t,e,e.asteroids),Fl(t,e,e.asteroidSpawner)}),ne(n,$l,t=>{jl(t,e,e.asteroids)})}function Is(n){return{scene:n,spawnTicks:Lt.MAX,reset(){this.spawnTicks=Lt.MAX},spawn(e){if(e.asteroids.length>kl)return;let t=x.choose(kn(e.display)),r=st(e,x.range(t[0],t[0]+t[2]),x.range(t[1],t[1]+t[3]),x.range(-k,k),x.range(-k,k),P);e.asteroids.push(r)}}}function Fl(n,e,t){e.gamePause||(t.spawnTicks-=n,t.spawnTicks<=0&&(t.spawn(e),t.spawnTicks=Hl(x.RAND)))}function zl(n,e,t){for(let r of t)r.x+=r.dx,r.y+=r.dy,we(e.canvas,r,r.size*2,r.size*2);for(let r of t)if(Fe(r,e.player,r.size+le)){Un(e,r),Os(e,r),Ps(e,e.player);break}}function jl(n,e,t){for(let r of t)n.translate(r.x,r.y),n.rotate(r.rotation),n.fillStyle="slategray",n.fillRect(-r.size,-r.size,r.size*2,r.size*2),n.setTransform(1,0,0,1,0,0),Ie(n,r.x,r.y,r.size)}function kn(n){return[[-P,-P,P*2+n.width,P],[-P,0,P,n.height],[-P,n.height,P*2+n.width,P],[n.width,0,P,n.height]]}function Ls(n,e,t=0,r=0){if(Os(n,e),e.size>rt){let s=[];s.push(st(n,e.x+x.range(-P,P),e.y+x.range(-P,P),x.range(-k,k)+t,x.range(-k,k)+r,rt)),s.push(st(n,e.x+x.range(-P,P),e.y+x.range(-P,P),x.range(-k,k)+t,x.range(-k,k)+r,rt)),s.push(st(n,e.x+x.range(-P,P),e.y+x.range(-P,P),x.range(-k,k)+t,x.range(-k,k)+r,rt)),s.push(st(n,e.x+x.range(-P,P),e.y+x.range(-P,P),x.range(-k,k)+t,x.range(-k,k)+r,rt)),n.asteroids.push(...s)}}function st(n,e,t,r,s,i){return{scene:n,x:e,y:t,dx:r,dy:s,size:i,rotation:Math.atan2(s,r)}}function Os(n,e){n.asteroids.splice(n.asteroids.indexOf(e),1)}function Un(n,e){je(n,e.x,e.y,10,x.choose.bind(null,Kl))}var Re=4;var ql=["white","violet","violet"],Yl=30,Gl=.7,Ot=new be("PowerUp",()=>({x:0,y:0,dx:0,dy:0,rotation:0})),Hn=new Se(Ot);function Ds(n){let e=N(n,de),t=N(n,xe);Ee(n,()=>{e.clear(Ot),x.next()>Gl&&t.powerUpSpawner.spawn(t)})}function Wl(n,e,t,r,s){return{scene:n,x:e,y:t,dx:r,dy:s,rotation:Math.atan2(s,r)}}function Xl(n,e){n.ents.destroy(e)}function Bs(n,e){for(let[t,r]of Hn.findAll(e.ents))r.x+=r.dx,r.y+=r.dy,we(e.canvas,r,Re*2,Re*2);for(let[t,r]of Hn.findAll(e.ents))if(Fe(r,e.player,Re+le)){je(e,r.x,r.y,10,x.choose.bind(null,ql)),Xl(e,t),e.player.powerMode+=Yl;break}}function Ns(n,e){for(let[t,r]of Hn.findAll(e.ents))n.translate(r.x,r.y),n.rotate(r.rotation),n.beginPath(),n.strokeStyle="violet",n.arc(0,0,Re,0,Math.PI*2),n.moveTo(-Re/2,0),n.lineTo(Re/2,0),n.moveTo(0,-Re/2),n.lineTo(0,Re/2),n.stroke(),n.setTransform(1,0,0,1,0,0),Ie(n,r.x,r.y,Re)}function ks(n){return{scene:n,reset(){},spawn(e){let t=x.choose(kn(e.display));Wl(e,x.range(t[0],t[0]+t[2]),x.range(t[1],t[1]+t[3]),x.range(-k,k),x.range(-k,k))}}}function Us(n,e,t){}var Kn=Symbol("audioContext"),Pt=class{static getAudioContext(){if(Kn in this)return this[Kn];{let e=new AudioContext;return Vl(e),this[Kn]=e,e}}constructor(e,t){this.audioContext=e,this.audioBuffer=t,this._playing=!1,this._started=!1,this._source=null,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}destroy(){this._source&&this._source.disconnect(),this._source=null,this._started=!1,this._playing=!1}onAudioSourceEnded(){this._playing=!1}play(e={}){let t=this.audioBuffer;if(!t)return;this._source&&this.destroy();let{pitch:r=void 0,gain:s=void 0,pan:i=void 0,loop:o=!1}=e,a=this.audioContext,l=a.createBufferSource();l.addEventListener("ended",this.onAudioSourceEnded),l.buffer=t,l.loop=o;let f=l;if(r&&(l.detune.value=r*100),s){let c=a.createGain();c.gain.value=s,f=f.connect(c)}if(i){let c=a.createStereoPanner();c.pan.value=i,f=f.connect(c)}f.connect(a.destination),l.start(),this._source=l,this._started=!0,this._playing=!0}pause(){this._source.stop(),this._playing=!1}isStarted(){return this._started}isPlaying(){return this._playing}isPaused(){return this._started&&!this._playing}};function Vl(n){let e=()=>{n.state==="suspended"&&n.resume()};document.addEventListener("click",e)}async function Te(n){let e=Pt.getAudioContext(),t=await wn(n,{audioContext:e});return new Pt(e,t)}var Ql="[ wasd_ ]",Hs=new oe("game.start",Te,void 0,"raw://start.wav"),it=new oe("background.music",Te,void 0,"raw://music.wav"),Dt=new Ne;function Ee(n,e){n.before(()=>(Dt.on(e),()=>{Dt.off(e)}))}function xe(n){let{display:e,canvas:t}=N(n,he),r=N(n,de),s=N(n,tt),{ctx:i}=N(n,$n);return ze(n,[Hs,it]),this.ents=r,this.assets=s,this.display=e,this.canvas=t,this.level=0,this.score=0,this.highScore=Number(localStorage.getItem("highscore")),this.flashScore=0,this.flashScoreDelta=0,this.flashHighScore=0,this.flashHighScoreDelta=0,this.flashShootDelta=0,this.dt=0,this.player=null,this.asteroids=[],this.asteroidSpawner=Is(this),this.powerUpSpawner=ks(this),this.gamePause=!0,this.showPlayer=!0,this.gameStart=!0,this.gameWait=!0,this.hint=Ql,ae(n,({deltaTime:o})=>{this.gamePause||(this.dt=o,Bs(o,this),Us(o,this,this.powerUpSpawner),!this.gamePause&&this.asteroids.length<=0&&(this.gamePause=!0,this.showPlayer=!0,Hs.current.play(),setTimeout(()=>this.gameWait=!0,1e3)))}),ae(n,()=>{i.isAnyButtonPressed()&&this.gameWait&&(this.gameStart&&(it.current.play(),this.score=0,this.flashScore=1,this.level=0,this.gameStart=!1,this.player.powerMode=0,this.ents.clear(Ot),this.asteroidSpawner.reset(),this.powerUpSpawner.reset()),this.gameWait=!1,Ks(this)),this.player.up=Tn.value,this.player.down=Cn.value,this.player.left=Sn.value,this.player.right=Rn.value,this.player.fire=Mn.value,In.released&&(Mt.showCollision=!Mt.showCollision)}),ne(n,0,o=>{let a=o.canvas;o.fillStyle="black",o.fillRect(0,0,a.width,a.height)}),ne(n,2,o=>{let a=o.canvas;o.fillStyle="rgba(255, 255, 255, 0.2)",o.textAlign="center",o.textBaseline="middle",o.font="16px sans-serif",o.fillText(this.hint,a.width/2,a.height/2-32),this.flashScore>0?(o.fillStyle=`rgba(255, 255, 255, ${this.flashScore+.2})`,this.flashScore-=et):o.fillStyle="rgba(255, 255, 255, 0.2)",o.font="48px sans-serif",o.fillText("= "+String(this.score).padStart(2,"0")+" =",a.width/2,a.height/2),this.flashHighScore>0?(o.fillStyle=`rgba(255, 255, 255, ${this.flashHighScore+.2})`,this.flashHighScore-=et):o.fillStyle="rgba(255, 255, 255, 0.2)",o.font="16px sans-serif",o.fillText(String(this.highScore).padStart(2,"0"),a.width/2,a.height/2+32),o.fillStyle="rgba(255, 255, 255, 0.2)",o.font="24px sans-serif",o.textAlign="right",o.fillText(`${Math.ceil(this.asteroidSpawner.spawnTicks/1e3)}`,a.width,a.height-12),Ns(o,this)}),ne(n,11,o=>{Ie(o,this.player.x,this.player.y,le)}),this}var ot=4,$s=100,ke=2,Zl="gold",Jl=2e3,eu=5,Fs=new oe("bullet.pop",Te,void 0,"raw://boop.wav"),Bt=new be("Bullet",()=>({x:0,y:0,dx:0,dy:0,rotation:0,age:0})),Fn=new Se(Bt);function zs(n){let e=N(n,de),{canvas:t}=N(n,he),r=N(n,xe);ze(n,[Fs]),Ee(n,()=>{e.clear(Bt)}),ae(n,({deltaTime:s})=>{tu(s,r,t,e)}),ne(n,eu,s=>{nu(s,e)})}function tu(n,e,t,r){if(!e.gamePause){for(let[s,i]of Fn.findAll(r))i.age+=n,i.age>Jl?r.destroy(s):(i.x+=i.dx,i.y+=i.dy,we(t,i,ke*2,ke*2));for(let[s,i]of Fn.findAll(r))for(let o of e.asteroids)if(Fe(i,o,o.size)){e.flashScore=1,e.score++,e.score>e.highScore&&(e.flashHighScore=e.score-e.highScore,e.highScore=e.score,localStorage.setItem("highscore",`${e.highScore}`)),Un(e,o),Fs.current.play(),r.destroy(s),Ls(e,o,i.dx*Nn,i.dy*Nn);break}}}function nu(n,e){for(let[t,r]of Fn.findAll(e))n.translate(r.x,r.y),n.rotate(r.rotation),n.fillStyle=Zl,n.fillRect(-ke,-ke,ke*4,ke*2),n.setTransform(1,0,0,1,0,0),Ie(n,r.x,r.y,ke)}function zn(n,e,t,r,s){let i=n.ents.create(),o=n.ents.attach(i,Bt);return o.x=e,o.y=t,o.dx=r,o.dy=s,o.rotation=Math.atan2(s,r),o.age=0,i}function js(n){return n.ents.count(Bt)}var qs=new oe("player.dead",Te,void 0,"raw://dead.wav"),Ys=new oe("player.boom",Te,void 0,"raw://boom.wav"),Gs=new oe("player.shoot",Te,void 0,"raw://click.wav"),le=5,Nt=[-2,2],ru=.1,su=.4,iu=["red","red","red","yellow","orange"],ou=["gray","darkgray","lightgray"],Ws=10,Xs=1.5,Vs=.02,au=.008,lu=.1,Qs=.001,uu=10,Zs=new be("Player",()=>({x:0,y:0,rotation:0,dx:0,dy:0,dr:0,left:0,right:0,up:0,down:0,fire:0,cooldown:0,powerMode:0})),Js=new Se(Zs);function ei(n){let{canvas:e}=N(n,he),t=N(n,de),r=N(n,xe);ze(n,[Ys,qs,Gs]);let s=hu(e,t);return r.player=s,Ee(n,()=>{s.x=e.width/2,s.y=e.height/2,s.dx=0,s.dy=0}),ae(n,({deltaTime:i})=>{r.gamePause||cu(i,r)}),ne(n,uu,i=>{!r.showPlayer||fu(i,r)}),s}function hu(n,e){let t=e.create(),r=e.attach(t,Zs);return r.x=n.width/2,r.y=n.height/2,r}function cu(n,e){let[t,r]=Js.findAny(e.ents);if(!r)return;let s=r.right-r.left,i=r.down-r.up,o=r.fire;r.dx+=i*Math.cos(r.rotation)*Vs,r.dy+=i*Math.sin(r.rotation)*Vs,r.dx*=1-Qs,r.dy*=1-Qs,r.dr+=s*au,r.dr*=1-lu,r.x+=r.dx,r.y+=r.dy,r.rotation+=r.dr,--r.cooldown,we(e.canvas,r,le*2,le*2),o&&(pu(e,r),e.flashShootDelta=1),i&&du(e,r.x,r.y,-i*Math.cos(r.rotation)*Xs,-i*Math.sin(r.rotation)*Xs,x.choose.bind(null,ou))}function fu(n,e){let[t,r]=Js.findAny(e.ents);if(!r)return;n.translate(r.x,r.y),n.rotate(r.rotation),n.fillStyle="white";let s=le;n.fillRect(-s,-s,s*2,s*2);let i=-1,o=0,a=0;e.flashShootDelta>0?(n.fillStyle=`rgb(${200*e.flashShootDelta+55*Math.sin(performance.now()/(Ws*2))}, 0, 0)`,e.flashShootDelta-=et,a=e.flashShootDelta*2,i=e.flashShootDelta):n.fillStyle="black",n.fillRect(-s-a/2+i,-(s/4)-a/2+o,s+a,s/2+a),n.setTransform(1,0,0,1,0,0)}function pu(n,e){if(!(js(n)>$s)&&!(e.cooldown>0)){if(e.powerMode>0){for(let t=-1;t<=1;++t){let r=e.rotation+t*Math.PI/4;zn(n,e.x-Math.cos(r)*le,e.y-Math.sin(r)*le,-Math.cos(r)*ot+e.dx,-Math.sin(r)*ot+e.dy)}--e.powerMode}else zn(n,e.x-Math.cos(e.rotation)*le,e.y-Math.sin(e.rotation)*le,-Math.cos(e.rotation)*ot+e.dx,-Math.sin(e.rotation)*ot+e.dy);e.cooldown=Ws,Gs.get(n.assets).play()}}function Ps(n,e){n.gamePause=!0,n.showPlayer=!1,je(n,e.x,e.y,100,x.choose.bind(null,iu)),qs.get(n.assets).play(),Ys.get(n.assets).play(),setTimeout(()=>n.gameStart=n.gameWait=!0,1e3)}function du(n,e,t,r,s,i){x.next()>.3&&It(n,e+x.range(Nt[0],Nt[1]),t+x.range(Nt[0],Nt[1]),r,s,i,x.range(nt*ru,nt*su))}var ti=[2,4],ni=[.3,1],mu=30,vu=1;function ri(n){let{canvas:e}=N(n,he),t=gu(e.width,e.height);ae(n,()=>{wu(t)}),ne(n,vu,r=>{yu(r,t)})}function gu(n,e){let t={x:[],y:[],size:[],speed:[],length:0,width:n,height:e};for(let r=0;r<mu;++r)t.x.push(x.range(0,n)),t.y.push(x.range(0,e)),t.size.push(x.range(ti[0],ti[1])),t.speed.push(x.range(ni[0],ni[1])),t.length++;return t}function yu(n,e,t="white"){for(let r=0;r<e.length;++r){let s=e.x[r],i=e.y[r],o=e.size[r],a=o/2;n.fillStyle=t,n.fillRect(s-a,i-a,o,o)}}function wu(n,e=1,t=0){let{length:r,width:s,height:i}=n;for(let o=0;o<r;++o){let a=e*n.speed[o],l=t*n.speed[o];n.x[o]+=a,n.y[o]+=l,a<0?n.x[o]<0&&(n.x[o]=s,n.y[o]=x.range(0,i)):a>0&&n.x[o]>s&&(n.x[o]=0,n.y[o]=x.range(0,i)),l<0?n.y[o]<0&&(n.x[o]=x.range(0,s),n.y[o]=i):l>0&&n.y[o]>i&&(n.x[o]=x.range(0,s),n.y[o]=0)}}var jn=class{constructor(){this.before=[],this.after=[],this.started=!1}attachEffect(e){if(this.started)throw new Error("Cannot attach effect when already started.");return this.before.push(e),this}attachAfterEffect(e){if(this.started)throw new Error("Cannot attach effect when already started.");return this.after.push(e),this}async startEffects(){if(this.started)throw new Error("Cannot start effects already started.");this.started=!0;let e=this.before.slice();this.before.length=0,this.after.push(...await Promise.all(e.map(t=>t&&t())))}async stopEffects(){if(!this.started)throw new Error("Cannot stop effects not yet started.");this.started=!1;let e=this.after.slice().reverse();this.after.length=0,await Promise.all(e.map(t=>t&&t()))}};var Le=class{static async initializeContext(e){try{e.state=await e.initCallback.call({},e)}catch(t){throw new Error(`Failed to initialize system context '${e.name}' with dependencies [${e.dependencies.map(r=>r.name).join(", ")}].

${t}`,{cause:t})}return e.dependencies}static async initializeEffects(e){await e.effects.startEffects()}static markDead(e){e.dead=!0}static async terminateEffects(e){await e.effects.stopEffects()}static async terminateContext(e){await e.deadCallback(e.state),e.state=null}constructor(e,t,r,s){this.name=t,this.state=null,this.parent=e,this.effects=new jn,this.dead=!1,this.dependencies=[],this.initCallback=r,this.deadCallback=s}before(e){this.effects.attachEffect(e)}after(e){this.effects.attachAfterEffect(e)}use(e){if(this.effects.started)throw new Error("use() must be called during initialization only.");return this.dependencies.indexOf(e)<0&&this.dependencies.push(e),this.parent.getState(e)}};function si(n){return Eu("Must be non-null!",typeof n!="undefined"&&n!==null,n)}function Eu(n,e,t){if(!e)throw new Error(`Assertion failed - ${n} But found ${t}.`);return t}var qn=class{constructor(){this.pendingSystems=[],this.activeSystems=[]}register(e,t=void 0,r=void 0){si(e);let s;if(typeof e=="function")s=e.name;else if(typeof e=="object")if("name"in e)s=e.name;else throw new Error("Invalid handle for system - missing name.");else s=e;t||(typeof e=="function"?t=e:t=()=>{}),r||(r=()=>{});let i=new Le(this,s,t,r);return this.pendingSystems.push(i),this}unregister(e){let t=this.pendingSystems.findIndex(r=>r.name===e);return t>=0&&this.pendingSystems.splice(t,1),this}async start(){let e=this.pendingSystems.slice();this.pendingSystems.length=0;for(let t of e)this.activeSystems.push(t),await Le.initializeContext(t);for(let t of e)await Le.initializeEffects(t);return this}async stop(){let e=this.activeSystems.slice().reverse();e.forEach(Le.markDead);for(let t of e)await Le.terminateEffects(t);for(let t of e){await Le.terminateContext(t);let r=this.activeSystems.indexOf(t);r>=0&&this.activeSystems.splice(r,1)}return this}getState(e){let t=this.activeSystems.find(r=>r.name===e.name);return t?t.state:null}};var ii=new Ne,Yn=new Ne,xu=new Ne,Gn=new _n;async function oi(){let n=await Au();requestAnimationFrame(Rs(e=>{ii.dispatchImmediately(e.detail),Yn.dispatchImmediately(e.detail),Gn.dispatchImmediately(n.getState(he).ctx),xu.dispatchImmediately(e.detail)}))}async function Au(){let n=new qn;return n.register(he).register($n).register(de,void 0,e=>e.reset()).register(tt).register(xe).register(ri).register(Cs).register(ei).register(zs).register(Ds).register(Ms),await n.start()}function Ks(n){n.level++,n.gamePause=!1,n.showPlayer=!0,Dt.dispatchImmediately(n),it.current.isPlaying()||it.current.play({loop:!0})}async function tt(n){let e=new yn;return await hs(e,"res.pack"),e}function $n(){let n=document.querySelector("#inputs"),e=n.getContext("axisbutton");return e.bindBindings(Object.values(Ln)),ii.on(({currentTime:t})=>{e.poll(t)}),{inputs:n,ctx:e}}function he(){let n=document.querySelector("#display"),e=n.canvas,t=e.getContext("2d");return{display:n,canvas:e,ctx:t}}function de(){let n=new xn;return Yn.on(()=>n.flush()),n}function ae(n,e){_u(n,Yn,e)}function ne(n,e,t){n.before(()=>(Gn.on(e,t),()=>{Gn.off(t)}))}function _u(n,e,t){n.before(()=>(e.on(t),()=>{e.off(t)}))}window.addEventListener("DOMContentLoaded",oi);})();
//# sourceMappingURL=main.js.map
