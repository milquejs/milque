(()=>{var dr=Object.create,pe=Object.defineProperty;var mr=Object.getOwnPropertyDescriptor;var gr=Object.getOwnPropertyNames;var vr=Object.getPrototypeOf,yr=Object.prototype.hasOwnProperty;var wr=n=>pe(n,"__esModule",{value:!0});var Er=(n,t)=>()=>(n&&(t=n(n=0)),t),Nt=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Ke=(n,t)=>{for(var e in t)pe(n,e,{get:t[e],enumerable:!0})},xr=(n,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of gr(t))!yr.call(n,s)&&s!=="default"&&pe(n,s,{get:()=>t[s],enumerable:!(e=mr(t,s))||e.enumerable});return n},Ar=n=>xr(wr(pe(n!=null?dr(vr(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var _s={};Ke(_s,{basename:()=>xs,default:()=>ea,delimiter:()=>ws,dirname:()=>Es,extname:()=>As,isAbsolute:()=>nn,join:()=>gs,normalize:()=>en,relative:()=>vs,resolve:()=>ve,sep:()=>ys});function ms(n,t){for(var e=0,s=n.length-1;s>=0;s--){var i=n[s];i==="."?n.splice(s,1):i===".."?(n.splice(s,1),e++):e&&(n.splice(s,1),e--)}if(t)for(;e--;e)n.unshift("..");return n}function ve(){for(var n="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var s=e>=0?arguments[e]:"/";if(typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)continue;n=s+"/"+n,t=s.charAt(0)==="/"}return n=ms(sn(n.split("/"),function(i){return!!i}),!t).join("/"),(t?"/":"")+n||"."}function en(n){var t=nn(n),e=na(n,-1)==="/";return n=ms(sn(n.split("/"),function(s){return!!s}),!t).join("/"),!n&&!t&&(n="."),n&&e&&(n+="/"),(t?"/":"")+n}function nn(n){return n.charAt(0)==="/"}function gs(){var n=Array.prototype.slice.call(arguments,0);return en(sn(n,function(t,e){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function vs(n,t){n=ve(n).substr(1),t=ve(t).substr(1);function e(u){for(var f=0;f<u.length&&u[f]==="";f++);for(var m=u.length-1;m>=0&&u[m]==="";m--);return f>m?[]:u.slice(f,m-f+1)}for(var s=e(n.split("/")),i=e(t.split("/")),r=Math.min(s.length,i.length),o=r,a=0;a<r;a++)if(s[a]!==i[a]){o=a;break}for(var l=[],a=o;a<s.length;a++)l.push("..");return l=l.concat(i.slice(o)),l.join("/")}function Es(n){var t=tn(n),e=t[0],s=t[1];return!e&&!s?".":(s&&(s=s.substr(0,s.length-1)),e+s)}function xs(n,t){var e=tn(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function As(n){return tn(n)[3]}function sn(n,t){if(n.filter)return n.filter(t);for(var e=[],s=0;s<n.length;s++)t(n[s],s,n)&&e.push(n[s]);return e}var ta,tn,ys,ws,ea,na,bs=Er(()=>{ta=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,tn=function(n){return ta.exec(n).slice(1)};ys="/",ws=":";ea={extname:As,basename:xs,dirname:Es,sep:ys,delimiter:ws,relative:vs,join:gs,isAbsolute:nn,normalize:en,resolve:ve};na="ab".substr(-1)==="b"?function(n,t,e){return n.substr(t,e)}:function(n,t,e){return t<0&&(t=n.length+t),n.substr(t,e)}});var we=Nt((Hu,ye)=>{var kt=(bs(),_s);if(kt&&kt.default){ye.exports=kt.default;for(let n in kt)ye.exports[n]=kt[n]}else kt&&(ye.exports=kt)});var Vt=Nt((Uu,Ms)=>{"use strict";var sa=we(),vt="\\\\/",Ss=`[^${vt}]`,At="\\.",ia="\\+",ra="\\?",Ee="\\/",oa="(?=.)",Cs="[^/]",rn=`(?:${Ee}|$)`,Rs=`(?:^|${Ee})`,on=`${At}{1,2}${rn}`,aa=`(?!${At})`,la=`(?!${Rs}${on})`,ua=`(?!${At}{0,1}${rn})`,ha=`(?!${on})`,ca=`[^.${Ee}]`,fa=`${Cs}*?`,Ts={DOT_LITERAL:At,PLUS_LITERAL:ia,QMARK_LITERAL:ra,SLASH_LITERAL:Ee,ONE_CHAR:oa,QMARK:Cs,END_ANCHOR:rn,DOTS_SLASH:on,NO_DOT:aa,NO_DOTS:la,NO_DOT_SLASH:ua,NO_DOTS_SLASH:ha,QMARK_NO_DOT:ca,STAR:fa,START_ANCHOR:Rs},pa={...Ts,SLASH_LITERAL:`[${vt}]`,QMARK:Ss,STAR:`${Ss}*?`,DOTS_SLASH:`${At}{1,2}(?:[${vt}]|$)`,NO_DOT:`(?!${At})`,NO_DOTS:`(?!(?:^|[${vt}])${At}{1,2}(?:[${vt}]|$))`,NO_DOT_SLASH:`(?!${At}{0,1}(?:[${vt}]|$))`,NO_DOTS_SLASH:`(?!${At}{1,2}(?:[${vt}]|$))`,QMARK_NO_DOT:`[^.${vt}]`,START_ANCHOR:`(?:^|[${vt}])`,END_ANCHOR:`(?:[${vt}]|$)`},da={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};Ms.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:da,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:sa.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?pa:Ts}}});var xe=Nt(tt=>{"use strict";var ma=we(),ga=!1,{REGEX_BACKSLASH:va,REGEX_REMOVE_BACKSLASH:ya,REGEX_SPECIAL_CHARS:wa,REGEX_SPECIAL_CHARS_GLOBAL:Ea}=Vt();tt.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);tt.hasRegexChars=n=>wa.test(n);tt.isRegexChar=n=>n.length===1&&tt.hasRegexChars(n);tt.escapeRegex=n=>n.replace(Ea,"\\$1");tt.toPosixSlashes=n=>n.replace(va,"/");tt.removeBackslashes=n=>n.replace(ya,t=>t==="\\"?"":t);tt.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};tt.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:ga===!0||ma.sep==="\\";tt.escapeLast=(n,t,e)=>{let s=n.lastIndexOf(t,e);return s===-1?n:n[s-1]==="\\"?tt.escapeLast(n,t,s-1):`${n.slice(0,s)}\\${n.slice(s)}`};tt.removePrefix=(n,t={})=>{let e=n;return e.startsWith("./")&&(e=e.slice(2),t.prefix="./"),e};tt.wrapOutput=(n,t={},e={})=>{let s=e.contains?"":"^",i=e.contains?"":"$",r=`${s}(?:${n})${i}`;return t.negated===!0&&(r=`(?:^(?!${r}).*$)`),r}});var Bs=Nt((zu,ks)=>{"use strict";var Ls=xe(),{CHAR_ASTERISK:an,CHAR_AT:xa,CHAR_BACKWARD_SLASH:Qt,CHAR_COMMA:Aa,CHAR_DOT:ln,CHAR_EXCLAMATION_MARK:un,CHAR_FORWARD_SLASH:Is,CHAR_LEFT_CURLY_BRACE:hn,CHAR_LEFT_PARENTHESES:cn,CHAR_LEFT_SQUARE_BRACKET:_a,CHAR_PLUS:ba,CHAR_QUESTION_MARK:Os,CHAR_RIGHT_CURLY_BRACE:Sa,CHAR_RIGHT_PARENTHESES:Ps,CHAR_RIGHT_SQUARE_BRACKET:Ca}=Vt(),Ns=n=>n===Is||n===Qt,Ds=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},Ra=(n,t)=>{let e=t||{},s=n.length-1,i=e.parts===!0||e.scanToEnd===!0,r=[],o=[],a=[],l=n,u=-1,f=0,m=0,E=!1,L=!1,S=!1,R=!1,I=!1,H=!1,j=!1,M=!1,q=!1,$=!1,X=0,K,y,A={value:"",depth:0,isGlob:!1},z=()=>u>=s,p=()=>l.charCodeAt(u+1),O=()=>(K=y,l.charCodeAt(++u));for(;u<s;){y=O();let W;if(y===Qt){j=A.backslashes=!0,y=O(),y===hn&&(H=!0);continue}if(H===!0||y===hn){for(X++;z()!==!0&&(y=O());){if(y===Qt){j=A.backslashes=!0,O();continue}if(y===hn){X++;continue}if(H!==!0&&y===ln&&(y=O())===ln){if(E=A.isBrace=!0,S=A.isGlob=!0,$=!0,i===!0)continue;break}if(H!==!0&&y===Aa){if(E=A.isBrace=!0,S=A.isGlob=!0,$=!0,i===!0)continue;break}if(y===Sa&&(X--,X===0)){H=!1,E=A.isBrace=!0,$=!0;break}}if(i===!0)continue;break}if(y===Is){if(r.push(u),o.push(A),A={value:"",depth:0,isGlob:!1},$===!0)continue;if(K===ln&&u===f+1){f+=2;continue}m=u+1;continue}if(e.noext!==!0&&(y===ba||y===xa||y===an||y===Os||y===un)===!0&&p()===cn){if(S=A.isGlob=!0,R=A.isExtglob=!0,$=!0,y===un&&u===f&&(q=!0),i===!0){for(;z()!==!0&&(y=O());){if(y===Qt){j=A.backslashes=!0,y=O();continue}if(y===Ps){S=A.isGlob=!0,$=!0;break}}continue}break}if(y===an){if(K===an&&(I=A.isGlobstar=!0),S=A.isGlob=!0,$=!0,i===!0)continue;break}if(y===Os){if(S=A.isGlob=!0,$=!0,i===!0)continue;break}if(y===_a){for(;z()!==!0&&(W=O());){if(W===Qt){j=A.backslashes=!0,O();continue}if(W===Ca){L=A.isBracket=!0,S=A.isGlob=!0,$=!0;break}}if(i===!0)continue;break}if(e.nonegate!==!0&&y===un&&u===f){M=A.negated=!0,f++;continue}if(e.noparen!==!0&&y===cn){if(S=A.isGlob=!0,i===!0){for(;z()!==!0&&(y=O());){if(y===cn){j=A.backslashes=!0,y=O();continue}if(y===Ps){$=!0;break}}continue}break}if(S===!0){if($=!0,i===!0)continue;break}}e.noext===!0&&(R=!1,S=!1);let T=l,st="",c="";f>0&&(st=l.slice(0,f),l=l.slice(f),m-=f),T&&S===!0&&m>0?(T=l.slice(0,m),c=l.slice(m)):S===!0?(T="",c=l):T=l,T&&T!==""&&T!=="/"&&T!==l&&Ns(T.charCodeAt(T.length-1))&&(T=T.slice(0,-1)),e.unescape===!0&&(c&&(c=Ls.removeBackslashes(c)),T&&j===!0&&(T=Ls.removeBackslashes(T)));let h={prefix:st,input:n,start:f,base:T,glob:c,isBrace:E,isBracket:L,isGlob:S,isExtglob:R,isGlobstar:I,negated:M,negatedExtglob:q};if(e.tokens===!0&&(h.maxDepth=0,Ns(y)||o.push(A),h.tokens=o),e.parts===!0||e.tokens===!0){let W;for(let C=0;C<r.length;C++){let J=W?W+1:f,G=r[C],V=n.slice(J,G);e.tokens&&(C===0&&f!==0?(o[C].isPrefix=!0,o[C].value=st):o[C].value=V,Ds(o[C]),h.maxDepth+=o[C].depth),(C!==0||V!=="")&&a.push(V),W=G}if(W&&W+1<n.length){let C=n.slice(W+1);a.push(C),e.tokens&&(o[o.length-1].value=C,Ds(o[o.length-1]),h.maxDepth+=o[o.length-1].depth)}h.slashes=r,h.parts=a}return h};ks.exports=Ra});var $s=Nt((Ku,Us)=>{"use strict";var Ae=Vt(),rt=xe(),{MAX_LENGTH:_e,POSIX_REGEX_SOURCE:Ta,REGEX_NON_SPECIAL_CHARS:Ma,REGEX_SPECIAL_CHARS_BACKREF:La,REPLACEMENTS:Hs}=Ae,Ia=(n,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...n,t);n.sort();let e=`[${n.join("-")}]`;try{new RegExp(e)}catch(s){return n.map(i=>rt.escapeRegex(i)).join("..")}return e},$t=(n,t)=>`Missing ${n}: "${t}" - use "\\\\${t}" to match literal characters`,fn=(n,t)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=Hs[n]||n;let e={...t},s=typeof e.maxLength=="number"?Math.min(_e,e.maxLength):_e,i=n.length;if(i>s)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${s}`);let r={type:"bos",value:"",output:e.prepend||""},o=[r],a=e.capture?"":"?:",l=rt.isWindows(t),u=Ae.globChars(l),f=Ae.extglobChars(u),{DOT_LITERAL:m,PLUS_LITERAL:E,SLASH_LITERAL:L,ONE_CHAR:S,DOTS_SLASH:R,NO_DOT:I,NO_DOT_SLASH:H,NO_DOTS_SLASH:j,QMARK:M,QMARK_NO_DOT:q,STAR:$,START_ANCHOR:X}=u,K=v=>`(${a}(?:(?!${X}${v.dot?R:m}).)*?)`,y=e.dot?"":I,A=e.dot?M:q,z=e.bash===!0?K(e):$;e.capture&&(z=`(${z})`),typeof e.noext=="boolean"&&(e.noextglob=e.noext);let p={input:n,index:-1,start:0,dot:e.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=rt.removePrefix(n,p),i=n.length;let O=[],T=[],st=[],c=r,h,W=()=>p.index===i-1,C=p.peek=(v=1)=>n[p.index+v],J=p.advance=()=>n[++p.index]||"",G=()=>n.slice(p.index+1),V=(v="",D=0)=>{p.consumed+=v,p.index+=D},mt=v=>{p.output+=v.output!=null?v.output:v.value,V(v.value)},qt=()=>{let v=1;for(;C()==="!"&&(C(2)!=="("||C(3)==="?");)J(),p.start++,v++;return v%2==0?!1:(p.negated=!0,p.start++,!0)},Mt=v=>{p[v]++,st.push(v)},gt=v=>{p[v]--,st.pop()},_=v=>{if(c.type==="globstar"){let D=p.braces>0&&(v.type==="comma"||v.type==="brace"),d=v.extglob===!0||O.length&&(v.type==="pipe"||v.type==="paren");v.type!=="slash"&&v.type!=="paren"&&!D&&!d&&(p.output=p.output.slice(0,-c.output.length),c.type="star",c.value="*",c.output=z,p.output+=c.output)}if(O.length&&v.type!=="paren"&&(O[O.length-1].inner+=v.value),(v.value||v.output)&&mt(v),c&&c.type==="text"&&v.type==="text"){c.value+=v.value,c.output=(c.output||"")+v.value;return}v.prev=c,o.push(v),c=v},Pt=(v,D)=>{let d={...f[D],conditions:1,inner:""};d.prev=c,d.parens=p.parens,d.output=p.output;let b=(e.capture?"(":"")+d.open;Mt("parens"),_({type:v,value:D,output:p.output?"":S}),_({type:"paren",extglob:!0,value:J(),output:b}),O.push(d)},ce=v=>{let D=v.close+(e.capture?")":""),d;if(v.type==="negate"){let b=z;if(v.inner&&v.inner.length>1&&v.inner.includes("/")&&(b=K(e)),(b!==z||W()||/^\)+$/.test(G()))&&(D=v.close=`)$))${b}`),v.inner.includes("*")&&(d=G())&&/^\.[^\\/.]+$/.test(d)){let U=fn(d,{...t,fastpaths:!1}).output;D=v.close=`)${U})${b})`}v.prev.type==="bos"&&(p.negatedExtglob=!0)}_({type:"paren",extglob:!0,value:h,output:D}),gt("parens")};if(e.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let v=!1,D=n.replace(La,(d,b,U,Q,Y,ze)=>Q==="\\"?(v=!0,d):Q==="?"?b?b+Q+(Y?M.repeat(Y.length):""):ze===0?A+(Y?M.repeat(Y.length):""):M.repeat(U.length):Q==="."?m.repeat(U.length):Q==="*"?b?b+Q+(Y?z:""):z:b?d:`\\${d}`);return v===!0&&(e.unescape===!0?D=D.replace(/\\/g,""):D=D.replace(/\\+/g,d=>d.length%2==0?"\\\\":d?"\\":"")),D===n&&e.contains===!0?(p.output=n,p):(p.output=rt.wrapOutput(D,p,t),p)}for(;!W();){if(h=J(),h==="\0")continue;if(h==="\\"){let d=C();if(d==="/"&&e.bash!==!0||d==="."||d===";")continue;if(!d){h+="\\",_({type:"text",value:h});continue}let b=/^\\+/.exec(G()),U=0;if(b&&b[0].length>2&&(U=b[0].length,p.index+=U,U%2!=0&&(h+="\\")),e.unescape===!0?h=J():h+=J(),p.brackets===0){_({type:"text",value:h});continue}}if(p.brackets>0&&(h!=="]"||c.value==="["||c.value==="[^")){if(e.posix!==!1&&h===":"){let d=c.value.slice(1);if(d.includes("[")&&(c.posix=!0,d.includes(":"))){let b=c.value.lastIndexOf("["),U=c.value.slice(0,b),Q=c.value.slice(b+2),Y=Ta[Q];if(Y){c.value=U+Y,p.backtrack=!0,J(),!r.output&&o.indexOf(c)===1&&(r.output=S);continue}}}(h==="["&&C()!==":"||h==="-"&&C()==="]")&&(h=`\\${h}`),h==="]"&&(c.value==="["||c.value==="[^")&&(h=`\\${h}`),e.posix===!0&&h==="!"&&c.value==="["&&(h="^"),c.value+=h,mt({value:h});continue}if(p.quotes===1&&h!=='"'){h=rt.escapeRegex(h),c.value+=h,mt({value:h});continue}if(h==='"'){p.quotes=p.quotes===1?0:1,e.keepQuotes===!0&&_({type:"text",value:h});continue}if(h==="("){Mt("parens"),_({type:"paren",value:h});continue}if(h===")"){if(p.parens===0&&e.strictBrackets===!0)throw new SyntaxError($t("opening","("));let d=O[O.length-1];if(d&&p.parens===d.parens+1){ce(O.pop());continue}_({type:"paren",value:h,output:p.parens?")":"\\)"}),gt("parens");continue}if(h==="["){if(e.nobracket===!0||!G().includes("]")){if(e.nobracket!==!0&&e.strictBrackets===!0)throw new SyntaxError($t("closing","]"));h=`\\${h}`}else Mt("brackets");_({type:"bracket",value:h});continue}if(h==="]"){if(e.nobracket===!0||c&&c.type==="bracket"&&c.value.length===1){_({type:"text",value:h,output:`\\${h}`});continue}if(p.brackets===0){if(e.strictBrackets===!0)throw new SyntaxError($t("opening","["));_({type:"text",value:h,output:`\\${h}`});continue}gt("brackets");let d=c.value.slice(1);if(c.posix!==!0&&d[0]==="^"&&!d.includes("/")&&(h=`/${h}`),c.value+=h,mt({value:h}),e.literalBrackets===!1||rt.hasRegexChars(d))continue;let b=rt.escapeRegex(c.value);if(p.output=p.output.slice(0,-c.value.length),e.literalBrackets===!0){p.output+=b,c.value=b;continue}c.value=`(${a}${b}|${c.value})`,p.output+=c.value;continue}if(h==="{"&&e.nobrace!==!0){Mt("braces");let d={type:"brace",value:h,output:"(",outputIndex:p.output.length,tokensIndex:p.tokens.length};T.push(d),_(d);continue}if(h==="}"){let d=T[T.length-1];if(e.nobrace===!0||!d){_({type:"text",value:h,output:h});continue}let b=")";if(d.dots===!0){let U=o.slice(),Q=[];for(let Y=U.length-1;Y>=0&&(o.pop(),U[Y].type!=="brace");Y--)U[Y].type!=="dots"&&Q.unshift(U[Y].value);b=Ia(Q,e),p.backtrack=!0}if(d.comma!==!0&&d.dots!==!0){let U=p.output.slice(0,d.outputIndex),Q=p.tokens.slice(d.tokensIndex);d.value=d.output="\\{",h=b="\\}",p.output=U;for(let Y of Q)p.output+=Y.output||Y.value}_({type:"brace",value:h,output:b}),gt("braces"),T.pop();continue}if(h==="|"){O.length>0&&O[O.length-1].conditions++,_({type:"text",value:h});continue}if(h===","){let d=h,b=T[T.length-1];b&&st[st.length-1]==="braces"&&(b.comma=!0,d="|"),_({type:"comma",value:h,output:d});continue}if(h==="/"){if(c.type==="dot"&&p.index===p.start+1){p.start=p.index+1,p.consumed="",p.output="",o.pop(),c=r;continue}_({type:"slash",value:h,output:L});continue}if(h==="."){if(p.braces>0&&c.type==="dot"){c.value==="."&&(c.output=m);let d=T[T.length-1];c.type="dots",c.output+=h,c.value+=h,d.dots=!0;continue}if(p.braces+p.parens===0&&c.type!=="bos"&&c.type!=="slash"){_({type:"text",value:h,output:m});continue}_({type:"dot",value:h,output:m});continue}if(h==="?"){if(!(c&&c.value==="(")&&e.noextglob!==!0&&C()==="("&&C(2)!=="?"){Pt("qmark",h);continue}if(c&&c.type==="paren"){let b=C(),U=h;if(b==="<"&&!rt.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(c.value==="("&&!/[!=<:]/.test(b)||b==="<"&&!/<([!=]|\w+>)/.test(G()))&&(U=`\\${h}`),_({type:"text",value:h,output:U});continue}if(e.dot!==!0&&(c.type==="slash"||c.type==="bos")){_({type:"qmark",value:h,output:q});continue}_({type:"qmark",value:h,output:M});continue}if(h==="!"){if(e.noextglob!==!0&&C()==="("&&(C(2)!=="?"||!/[!=<:]/.test(C(3)))){Pt("negate",h);continue}if(e.nonegate!==!0&&p.index===0){qt();continue}}if(h==="+"){if(e.noextglob!==!0&&C()==="("&&C(2)!=="?"){Pt("plus",h);continue}if(c&&c.value==="("||e.regex===!1){_({type:"plus",value:h,output:E});continue}if(c&&(c.type==="bracket"||c.type==="paren"||c.type==="brace")||p.parens>0){_({type:"plus",value:h});continue}_({type:"plus",value:E});continue}if(h==="@"){if(e.noextglob!==!0&&C()==="("&&C(2)!=="?"){_({type:"at",extglob:!0,value:h,output:""});continue}_({type:"text",value:h});continue}if(h!=="*"){(h==="$"||h==="^")&&(h=`\\${h}`);let d=Ma.exec(G());d&&(h+=d[0],p.index+=d[0].length),_({type:"text",value:h});continue}if(c&&(c.type==="globstar"||c.star===!0)){c.type="star",c.star=!0,c.value+=h,c.output=z,p.backtrack=!0,p.globstar=!0,V(h);continue}let v=G();if(e.noextglob!==!0&&/^\([^?]/.test(v)){Pt("star",h);continue}if(c.type==="star"){if(e.noglobstar===!0){V(h);continue}let d=c.prev,b=d.prev,U=d.type==="slash"||d.type==="bos",Q=b&&(b.type==="star"||b.type==="globstar");if(e.bash===!0&&(!U||v[0]&&v[0]!=="/")){_({type:"star",value:h,output:""});continue}let Y=p.braces>0&&(d.type==="comma"||d.type==="brace"),ze=O.length&&(d.type==="pipe"||d.type==="paren");if(!U&&d.type!=="paren"&&!Y&&!ze){_({type:"star",value:h,output:""});continue}for(;v.slice(0,3)==="/**";){let fe=n[p.index+4];if(fe&&fe!=="/")break;v=v.slice(3),V("/**",3)}if(d.type==="bos"&&W()){c.type="globstar",c.value+=h,c.output=K(e),p.output=c.output,p.globstar=!0,V(h);continue}if(d.type==="slash"&&d.prev.type!=="bos"&&!Q&&W()){p.output=p.output.slice(0,-(d.output+c.output).length),d.output=`(?:${d.output}`,c.type="globstar",c.output=K(e)+(e.strictSlashes?")":"|$)"),c.value+=h,p.globstar=!0,p.output+=d.output+c.output,V(h);continue}if(d.type==="slash"&&d.prev.type!=="bos"&&v[0]==="/"){let fe=v[1]!==void 0?"|$":"";p.output=p.output.slice(0,-(d.output+c.output).length),d.output=`(?:${d.output}`,c.type="globstar",c.output=`${K(e)}${L}|${L}${fe})`,c.value+=h,p.output+=d.output+c.output,p.globstar=!0,V(h+J()),_({type:"slash",value:"/",output:""});continue}if(d.type==="bos"&&v[0]==="/"){c.type="globstar",c.value+=h,c.output=`(?:^|${L}|${K(e)}${L})`,p.output=c.output,p.globstar=!0,V(h+J()),_({type:"slash",value:"/",output:""});continue}p.output=p.output.slice(0,-c.output.length),c.type="globstar",c.output=K(e),c.value+=h,p.output+=c.output,p.globstar=!0,V(h);continue}let D={type:"star",value:h,output:z};if(e.bash===!0){D.output=".*?",(c.type==="bos"||c.type==="slash")&&(D.output=y+D.output),_(D);continue}if(c&&(c.type==="bracket"||c.type==="paren")&&e.regex===!0){D.output=h,_(D);continue}(p.index===p.start||c.type==="slash"||c.type==="dot")&&(c.type==="dot"?(p.output+=H,c.output+=H):e.dot===!0?(p.output+=j,c.output+=j):(p.output+=y,c.output+=y),C()!=="*"&&(p.output+=S,c.output+=S)),_(D)}for(;p.brackets>0;){if(e.strictBrackets===!0)throw new SyntaxError($t("closing","]"));p.output=rt.escapeLast(p.output,"["),gt("brackets")}for(;p.parens>0;){if(e.strictBrackets===!0)throw new SyntaxError($t("closing",")"));p.output=rt.escapeLast(p.output,"("),gt("parens")}for(;p.braces>0;){if(e.strictBrackets===!0)throw new SyntaxError($t("closing","}"));p.output=rt.escapeLast(p.output,"{"),gt("braces")}if(e.strictSlashes!==!0&&(c.type==="star"||c.type==="bracket")&&_({type:"maybe_slash",value:"",output:`${L}?`}),p.backtrack===!0){p.output="";for(let v of p.tokens)p.output+=v.output!=null?v.output:v.value,v.suffix&&(p.output+=v.suffix)}return p};fn.fastpaths=(n,t)=>{let e={...t},s=typeof e.maxLength=="number"?Math.min(_e,e.maxLength):_e,i=n.length;if(i>s)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${s}`);n=Hs[n]||n;let r=rt.isWindows(t),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:l,DOTS_SLASH:u,NO_DOT:f,NO_DOTS:m,NO_DOTS_SLASH:E,STAR:L,START_ANCHOR:S}=Ae.globChars(r),R=e.dot?m:f,I=e.dot?E:f,H=e.capture?"":"?:",j={negated:!1,prefix:""},M=e.bash===!0?".*?":L;e.capture&&(M=`(${M})`);let q=y=>y.noglobstar===!0?M:`(${H}(?:(?!${S}${y.dot?u:o}).)*?)`,$=y=>{switch(y){case"*":return`${R}${l}${M}`;case".*":return`${o}${l}${M}`;case"*.*":return`${R}${M}${o}${l}${M}`;case"*/*":return`${R}${M}${a}${l}${I}${M}`;case"**":return R+q(e);case"**/*":return`(?:${R}${q(e)}${a})?${I}${l}${M}`;case"**/*.*":return`(?:${R}${q(e)}${a})?${I}${M}${o}${l}${M}`;case"**/.*":return`(?:${R}${q(e)}${a})?${o}${l}${M}`;default:{let A=/^(.*?)\.(\w+)$/.exec(y);if(!A)return;let z=$(A[1]);return z?z+o+A[2]:void 0}}},X=rt.removePrefix(n,j),K=$(X);return K&&e.strictSlashes!==!0&&(K+=`${a}?`),K};Us.exports=fn});var Ks=Nt((Fu,zs)=>{"use strict";var Oa=we(),Pa=Bs(),pn=$s(),dn=xe(),Na=Vt(),Da=n=>n&&typeof n=="object"&&!Array.isArray(n),F=(n,t,e=!1)=>{if(Array.isArray(n)){let f=n.map(E=>F(E,t,e));return E=>{for(let L of f){let S=L(E);if(S)return S}return!1}}let s=Da(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!s)throw new TypeError("Expected pattern to be a non-empty string");let i=t||{},r=dn.isWindows(t),o=s?F.compileRe(n,t):F.makeRe(n,t,!1,!0),a=o.state;delete o.state;let l=()=>!1;if(i.ignore){let f={...t,ignore:null,onMatch:null,onResult:null};l=F(i.ignore,f,e)}let u=(f,m=!1)=>{let{isMatch:E,match:L,output:S}=F.test(f,o,t,{glob:n,posix:r}),R={glob:n,state:a,regex:o,posix:r,input:f,output:S,match:L,isMatch:E};return typeof i.onResult=="function"&&i.onResult(R),E===!1?(R.isMatch=!1,m?R:!1):l(f)?(typeof i.onIgnore=="function"&&i.onIgnore(R),R.isMatch=!1,m?R:!1):(typeof i.onMatch=="function"&&i.onMatch(R),m?R:!0)};return e&&(u.state=a),u};F.test=(n,t,e,{glob:s,posix:i}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let r=e||{},o=r.format||(i?dn.toPosixSlashes:null),a=n===s,l=a&&o?o(n):n;return a===!1&&(l=o?o(n):n,a=l===s),(a===!1||r.capture===!0)&&(r.matchBase===!0||r.basename===!0?a=F.matchBase(n,t,e,i):a=t.exec(l)),{isMatch:Boolean(a),match:a,output:l}};F.matchBase=(n,t,e,s=dn.isWindows(e))=>(t instanceof RegExp?t:F.makeRe(t,e)).test(Oa.basename(n));F.isMatch=(n,t,e)=>F(t,e)(n);F.parse=(n,t)=>Array.isArray(n)?n.map(e=>F.parse(e,t)):pn(n,{...t,fastpaths:!1});F.scan=(n,t)=>Pa(n,t);F.compileRe=(n,t,e=!1,s=!1)=>{if(e===!0)return n.output;let i=t||{},r=i.contains?"":"^",o=i.contains?"":"$",a=`${r}(?:${n.output})${o}`;n&&n.negated===!0&&(a=`^(?!${a}).*$`);let l=F.toRegex(a,t);return s===!0&&(l.state=n),l};F.makeRe=(n,t={},e=!1,s=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(i.output=pn.fastpaths(n,t)),i.output||(i=pn(n,t)),F.compileRe(i,t,e,s)};F.toRegex=(n,t)=>{try{let e=t||{};return new RegExp(n,e.flags||(e.nocase?"i":""))}catch(e){if(t&&t.debug===!0)throw e;return/$^/}};F.constants=Na;zs.exports=F});var js=Nt((ju,Fs)=>{"use strict";Fs.exports=Ks()});var _r=`
<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <slot id="inner">
      <canvas>
        Oh no! Your browser does not support canvas.
      </canvas>
    </slot>
    <slot name="overlay"></slot>
  </div>
  <slot name="frame"></slot>
</div>`,br=`
:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
  overflow: hidden;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}`,Vn="noscale";var Fe="fit",Qn="scale",Zn="fill",Jn="stretch",ts=300,es=150,ns=Fe,Sr=200,Wt=class extends HTMLElement{static create(t={}){let{root:e=document.body,id:s=void 0,mode:i=ns,width:r=ts,height:o=es,debug:a=!1}=t||{},l=new Wt;return l.id=s,l.mode=i,l.width=r,l.height=o,l.debug=a,e.appendChild(l),l}static define(t=window.customElements){t.define("display-port",this)}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=_r,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=br,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=null,this._contentElement=t.querySelector(".content"),this._innerElement=t.querySelector("#inner"),this._titleElement=t.querySelector("#title"),this._fpsElement=t.querySelector("#fps"),this._dimensionElement=t.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=ts,this._height=es,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this),this.onSlotChange=this.onSlotChange.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Ut(this,"mode"),Ut(this,"debug"),Ut(this,"disabled"),Ut(this,"width"),Ut(this,"height"),Ut(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",ns),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this._innerElement.addEventListener("slotchange",this.onSlotChange),this._canvasElement=this._innerElement.querySelector("canvas"),this._canvasElement&&(this.updateCanvasSize(!0),this.resume())}disconnectedCallback(){this._innerElement.removeEventListener("slotchange",this.onSlotChange),this.pause()}attributeChangedCallback(t,e,s){switch(t){case"debug":this._debug=s!==null;break;case"disabled":this._disabled=s!==null;break;case"width":this._width=Number(s);break;case"height":this._height=Number(s);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+s+"}}").bind(this);break}switch(t){case"disabled":s?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",s),this._fpsElement.classList.toggle("hidden",s),this._dimensionElement.classList.toggle("hidden",s);break}}onSlotChange(t){let i=t.target.assignedElements({flatten:!0}).find(r=>r instanceof HTMLCanvasElement);if(!i)throw new Error("No valid canvas element found for display.");this._canvasElement=i,this.updateCanvasSize(!0),this.resume()}getContext(t="2d",e=void 0){return this._canvasElement.getContext(t,e)}pause(){window.cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=window.requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=window.requestAnimationFrame(this.update),this.updateCanvasSize(!1);let e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let r=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._fpsElement.textContent!==r&&(this._fpsElement.textContent=r),this.mode===Vn){let a=`${this._width}x${this._height}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}else{let a=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}}let i=this._frameEvent.detail;i.now=t,i.prevTime=this._prevAnimationFrameTime,i.deltaTime=e,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=null,this.updateCanvasSize(!0)}delayCanvasResize(t,e){(t!==this._resizeCanvasWidth||e!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&window.clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=window.setTimeout(this.onDelayCanvasResize,Sr))}updateCanvasSize(t=!0){let e=this.shadowRoot.host.getBoundingClientRect(),s=e.width,i=e.height,r=this._canvasElement,o=this._width,a=this._height,l=this.mode;if(l===Jn||l===Zn)o=s,a=i;else if(l!==Vn&&(s<o||i<a||l===Fe||l==Qn)){let f=s/o,m=i/a;f<m?(o=s,a=a*f):(o=o*m,a=i)}if(o=Math.floor(o),a=Math.floor(a),typeof t=="undefined"&&(t=r.clientWidth!==o||r.clientHeight!==a),!t){this.delayCanvasResize(o,a);return}let u=Math.min(o/this._width,a/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${u}em`,t){l===Qn?(r.width=this._width,r.height=this._height):l!==Jn&&(r.width=o,r.height=a);let f=this._contentElement.style;f.width=`${o}px`,f.height=`${a}px`,(l===Fe||l===Zn)&&(this._width=o,this._height=a);let E=this._resizeEvent.detail;E.width=o,E.height=a,this.dispatchEvent(this._resizeEvent)}}};function Ut(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var Cr=`<div class="container">
  <div class="padding"></div>
  <div class="innerContainer">
    <div class="padding"></div>
    <slot><canvas>Oh no! Your browser does not support canvas.</canvas></slot>
    <div class="padding"></div>
  </div>
  <div class="padding"></div>
</div>`,Rr=`
:host {
  display: inline-block;
  flex: 1;
  --width: 300px;
  --height: 150px;
}
:host([scaling="noscale"]) {
  width: var(--width);
  height: var(--height);
}
:host([sizing="viewport"]) {
    position: fixed;
    top: 0;
    left: 0;
}
.container {
  position: relative;
  display: flex;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.innerContainer {
  display: flex;
  flex-direction: column;
}
.padding {
  flex: 1;
}`,ss="scale",Tr="conatiner",is=300,rs=150,de=class extends HTMLElement{static create(t={}){let{root:e=document.body,id:s=void 0,scaling:i=ss,sizing:r=Tr,width:o=is,height:a=rs}=t||{};window.customElements.get("flex-canvas")||window.customElements.define("flex-canvas",de);let l=new de;return l.id=s,l.scaling=i,l.sizing=r,l.width=o,l.height=a,e.appendChild(l),l}static define(t=window.customElements){t.define("flex-canvas",this)}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Cr,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Rr,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static get observedAttributes(){return["sizing","width","height","resize-delay"]}get scaling(){return this.getAttribute("scaling")}set scaling(t){this.setAttribute("scaling",t)}get sizing(){return this._sizing}set sizing(t){this.setAttribute("sizing",String(t))}get resizeDelay(){return this._resizeDelay}set resizeDelay(t){this.setAttribute("resize-delay",String(t))}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get canvas(){return this.canvasElement}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._sizing="none",this._width=is,this._height=rs,this._resizeDelay=0,this.animationFrameHandle=0,this.resizeTimeoutHandle=0,this.resizeCanvasWidth=0,this.resizeCanvasHeight=0,this.canvasSlotElement=t.querySelector("slot"),this.canvasElement=null,this.onResize=this.onResize.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this),this.onSlotChange=this.onSlotChange.bind(this)}connectedCallback(){Gt(this,"scaling"),Gt(this,"sizing"),Gt(this,"width"),Gt(this,"height"),Gt(this,"resize-delay"),this.hasAttribute("scaling")||this.setAttribute("scaling",ss),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.canvasSlotElement.addEventListener("slotchange",this.onSlotChange),this.canvasElement||this.setCanvasElement(this.canvasSlotElement.querySelector("canvas"))}disconnectedCallback(){cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.canvasSlotElement.removeEventListener("slotchange",this.onSlotChange)}attributeChangedCallback(t,e,s){switch(t){case"sizing":switch(this._sizing=String(s),this._sizing){case"none":this.style.removeProperty("width"),this.style.removeProperty("height");break;case"container":this.style.setProperty("width","100%"),this.style.setProperty("height","100%");break;case"viewport":this.style.setProperty("width","100vw"),this.style.setProperty("height","100vh");break;default:let[i,r]=this._sizing.split(" ");i&&r&&(this.style.setProperty("width",i),this.style.setProperty("height",r));break}break;case"width":this._width=Number(s),this.canvasElement&&(this.canvasElement.width=this._width);break;case"height":this._height=Number(s),this.canvasElement&&(this.canvasElement.height=this._height);break;case"resize-delay":this._resizeDelay=Number(s);break}}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),!(this.clientWidth===this.resizeCanvasWidth&&this.clientHeight===this.resizeCanvasHeight)&&(this.resizeCanvasWidth=this.clientWidth,this.resizeCanvasHeight=this.clientHeight,this._resizeDelay>0?this.resizeTimeoutHandle||(this.resizeTimeoutHandle=window.setTimeout(this.onResize,this._resizeDelay)):this.onResize())}onResize(){window.clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=null;let t=this.canvasElement;if(!t)return;let e=this.scaling,s=this.getBoundingClientRect(),i=s.width,r=s.height,o=this._width,a=this._height,l=i/o,u=r/a;e==="noscale"&&(this.style.setProperty("--width",`${o}px`),this.style.setProperty("--height",`${a}px`)),e==="scale"&&(l<u?(t.style.setProperty("width",`${Math.floor(i)}px`),t.style.setProperty("height",`${Math.floor(a*l)}px`)):(t.style.setProperty("width",`${Math.floor(o*u)}px`),t.style.setProperty("height",`${Math.floor(r)}px`))),e==="stretch"&&(t.style.setProperty("width",`${Math.floor(i)}px`),t.style.setProperty("height",`${Math.floor(r)}px`)),e==="fit"&&(l<u?(o=Math.floor(i),a=Math.floor(a*l),t.style.setProperty("width",`${o}px`),t.style.setProperty("height",`${a}px`)):(o=Math.floor(o*u),a=Math.floor(r),t.style.setProperty("width",`${o}px`),t.style.setProperty("height",`${a}px`)),t.width!==o&&(t.width=o),t.height!==a&&(t.height=a)),e==="fill"&&(l<u?(o=Math.floor(i),a=Math.floor(r),t.style.setProperty("width",`${o}px`),t.style.setProperty("height",`${a}px`)):(o=Math.floor(i),a=Math.floor(r),t.style.setProperty("width",`${o}px`),t.style.setProperty("height",`${a}px`)),t.width!==o&&(t.width=o),t.height!==a&&(t.height=a))}onSlotChange(t){let i=t.target.assignedElements({flatten:!0}).find(r=>r instanceof HTMLCanvasElement);i&&this.setCanvasElement(i)}setCanvasElement(t){t.width=this._width,t.height=this._height,t.style.imageRendering="pixelated",this.canvasElement=t}getContext(t="2d",e=void 0){return this.canvasElement.getContext(t,e)}};function Gt(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var je=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,s){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e=void 0){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Xt=class extends je{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array,s=this.constructor;for(let i=0;i<t;++i)e.push(s.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e=this._state,s=e.length,i;if(t<=s)i=e.slice(0,t);else{i=e;let r=this.constructor;for(let o=s;o<t;++o)i.push(r.createAxisBindingState())}this._state=i,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,s=0,i=0,r=e.length;for(let o=0;o<r;++o){let a=e[o];s+=a.value*(a.inverted?-1:1),i+=a.delta,e[o].delta=0}this._value=s,this._delta=i,super.onPoll(t)}onUpdate(t,e,s){typeof e=="undefined"?this.onAxisChange(t,s):this.onAxisMove(t,e,s)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e=void 0){super.onBind(t,e);let{inverted:s=!1}=e||{},i=this._state;i[t].inverted=s}onAxisMove(t,e,s){let i=this._state[t];i.value=e,i.delta+=s}onAxisChange(t,e){let s=this._state[t];s.value+=e,s.delta+=e}onAxisStatus(t,e){let s=this._state[t],i=s.value;s.value=e,s.delta=e-i}},Mr=241,os=254,Lr=239,Dt=1,Ye=2,qe=4,We=8,Ge=16,me=class extends je{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e=this._state,s=e.length,i;t<=s?i=e.slice(0,t):(i=new Uint8Array(t),i.set(e)),this._state=i,super.resize(t)}getState(t){let e=this._state[t],s=e&Ge?-1:1;return(e&Dt?1:0)*s}onPoll(t){let e=this._state,s=0,i=0,r=0,o=0,a=0,l=e.length;for(let u=0;u<l;++u){let f=e[u],m=f&Dt,E=f&Ge;i|=m,r|=f&Ye,o|=f&qe,a|=f&We,s+=(m?1:0)*(E?-1:1),e[u]&=Mr}this._value=s,this._down=i!==0,this._pressed=r!==0,this._repeated=o!==0,this._released=a!==0,super.onPoll(t)}onUpdate(t,e,s){s>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,e!==0)}onBind(t,e={inverted:!1}){super.onBind(t,e);let{inverted:s=!1}=e,i=this._state;s?i[t]|=Ge:i[t]&=Lr}onButtonPressed(t){let e=this._state,s=e[t];s&Dt||(s|=Ye,s|=Dt),s|=qe,e[t]=s}onButtonReleased(t){let e=this._state,s=e[t];s&Dt&&(s|=We,s&=os),e[t]=s}onButtonStatus(t,e){let s=this._state,i=s[t],r=Boolean(i&Dt);e?i|=Dt:i&=os,r&&!e&&(i|=We),!r&&e&&(i|=Ye,i|=qe),s[t]=i}},g=class{static parse(t){t=t.trim();let e=t.indexOf(".");if(e<0)throw new Error("Missing device separator for key code.");let s=t.substring(0,e);if(s.length<0)throw new Error("Missing device for key code.");let i=t.substring(e+1);if(i.length<0)throw new Error("Missing code for key code.");return new g(s,i)}constructor(t,e){this.device=t,this.code=e}toString(){return`${this.device}.${this.code}`}};function as(n,t){return new g(n,t)}function Ir(n){return"device"in n&&"code"in n}var w="Keyboard",ct="Mouse",Or=new g(w,"KeyA"),Pr=new g(w,"KeyB"),Nr=new g(w,"KeyC"),Dr=new g(w,"KeyD"),kr=new g(w,"KeyE"),Br=new g(w,"KeyF"),Hr=new g(w,"KeyG"),Ur=new g(w,"KeyH"),$r=new g(w,"KeyI"),zr=new g(w,"KeyJ"),Kr=new g(w,"KeyK"),Fr=new g(w,"KeyL"),jr=new g(w,"KeyM"),Yr=new g(w,"KeyN"),qr=new g(w,"KeyO"),Wr=new g(w,"KeyP"),Gr=new g(w,"KeyQ"),Xr=new g(w,"KeyR"),Vr=new g(w,"KeyS"),Qr=new g(w,"KeyT"),Zr=new g(w,"KeyU"),Jr=new g(w,"KeyV"),to=new g(w,"KeyW"),eo=new g(w,"KeyX"),no=new g(w,"KeyY"),so=new g(w,"KeyZ"),io=new g(w,"Digit0"),ro=new g(w,"Digit1"),oo=new g(w,"Digit2"),ao=new g(w,"Digit3"),lo=new g(w,"Digit4"),uo=new g(w,"Digit5"),ho=new g(w,"Digit6"),co=new g(w,"Digit7"),fo=new g(w,"Digit8"),po=new g(w,"Digit9"),mo=new g(w,"Minus"),go=new g(w,"Equal"),vo=new g(w,"BracketLeft"),yo=new g(w,"BracketRight"),wo=new g(w,"Semicolon"),Eo=new g(w,"Quote"),xo=new g(w,"Backquote"),Ao=new g(w,"Backslash"),_o=new g(w,"Comma"),bo=new g(w,"Period"),So=new g(w,"Slash"),Co=new g(w,"Escape"),Ro=new g(w,"Space"),To=new g(w,"CapsLock"),Mo=new g(w,"Backspace"),Lo=new g(w,"Delete"),Io=new g(w,"Tab"),Oo=new g(w,"Enter"),Po=new g(w,"ArrowUp"),No=new g(w,"ArrowDown"),Do=new g(w,"ArrowLeft"),ko=new g(w,"ArrowRight"),Bo=new g(ct,"Button0"),Ho=new g(ct,"Button1"),Uo=new g(ct,"Button2"),$o=new g(ct,"Button3"),zo=new g(ct,"Button4"),Ko=new g(ct,"PosX"),Fo=new g(ct,"PosY"),jo=new g(ct,"WheelX"),Yo=new g(ct,"WheelY"),qo=new g(ct,"WheelZ"),it=Object.freeze({__proto__:null,ARROW_DOWN:No,ARROW_LEFT:Do,ARROW_RIGHT:ko,ARROW_UP:Po,BACKQUOTE:xo,BACKSLASH:Ao,BACKSPACE:Mo,BRACKET_LEFT:vo,BRACKET_RIGHT:yo,CAPS_LOCK:To,COMMA:_o,DELETE:Lo,DIGIT_0:io,DIGIT_1:ro,DIGIT_2:oo,DIGIT_3:ao,DIGIT_4:lo,DIGIT_5:uo,DIGIT_6:ho,DIGIT_7:co,DIGIT_8:fo,DIGIT_9:po,ENTER:Oo,EQUAL:go,ESCAPE:Co,KEYBOARD:w,KEY_A:Or,KEY_B:Pr,KEY_C:Nr,KEY_D:Dr,KEY_E:kr,KEY_F:Br,KEY_G:Hr,KEY_H:Ur,KEY_I:$r,KEY_J:zr,KEY_K:Kr,KEY_L:Fr,KEY_M:jr,KEY_N:Yr,KEY_O:qr,KEY_P:Wr,KEY_Q:Gr,KEY_R:Xr,KEY_S:Vr,KEY_T:Qr,KEY_U:Zr,KEY_V:Jr,KEY_W:to,KEY_X:eo,KEY_Y:no,KEY_Z:so,MINUS:mo,MOUSE:ct,MOUSE_BUTTON_0:Bo,MOUSE_BUTTON_1:Ho,MOUSE_BUTTON_2:Uo,MOUSE_BUTTON_3:$o,MOUSE_BUTTON_4:zo,MOUSE_POS_X:Ko,MOUSE_POS_Y:Fo,MOUSE_WHEEL_X:jo,MOUSE_WHEEL_Y:Yo,MOUSE_WHEEL_Z:qo,PERIOD:bo,QUOTE:Eo,SEMICOLON:wo,SLASH:So,SPACE:Ro,TAB:Io,from:as,isKeyCode:Ir}),ls=class{constructor(t){this.name=t,this.current=null}bindKeys(t){throw new Error("Unsupported operation.")}get(t){throw new Error("Unsupported operation.")}};function Wo(n){Array.isArray(n)||(n=[n]);let t=[];for(let e of n){let s;try{s=g.parse(e)}catch(i){let r=Go(e).toUpperCase();if(!(r in it))throw new Error("Invalid key code string - "+i);s=it[r]}t.push(s)}return t}function Go(n){return n.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,function(t,e,s){return e+(s&&"_"+s)}).toLowerCase()}var ft=class extends ls{static fromBind(t,e,s,i=void 0){return new ft(t,as(e,s),i)}static fromString(t,...e){let s=Wo(e);return new ft(t,s)}constructor(t,e,s=void 0){super(t);this.keyCodes=Array.isArray(e)?e:[e],this.opts=s,this.current=null}bindKeys(t){let e=this.name,s=this.opts;for(let i of this.keyCodes)t.bindButton(e,i.device,i.code,s);return this.current=t.getButton(e),this}get(t){let e=this.name;t.hasButton(e)||this.bindKeys(t);let s=t.getButton(e);return this.current=s,s}};var Xe=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let s=this.listeners;t in s?s[t].push(e):s[t]=[e]}removeEventListener(t,e){let s=this.listeners;if(t in s){let i=s[t],r=i.indexOf(e);r>=0&&i.splice(r,1)}}dispatchInputEvent(t){let e=0;for(let s of this.listeners.input)e|=s(t);return Boolean(e)}},us=class extends Xe{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,s={}){super(t,e);let{ignoreRepeat:i=!0}=s;this.ignoreRepeat=i,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;if(e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}},Ve=10,Qe=100,hs=class extends Xe{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,e,s={}){super(t,e);let{eventsOnFocus:i=!0}=s;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,s,i;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=t.deltaX*Ve,s=t.deltaY*Ve,i=t.deltaZ*Ve;break;case WheelEvent.DOM_DELTA_PAGE:e=t.deltaX*Qe,s=t.deltaY*Qe,i=t.deltaZ*Qe;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,s=t.deltaY,i=t.deltaZ;break}let r=0,o=this._wheelObject;if(o.code="WheelX",o.movement=e,r|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=s,r|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=i,r|=this.dispatchInputEvent(o),r)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;if(e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let e=this.canvasTarget,{clientWidth:s,clientHeight:i}=e,r=e.getBoundingClientRect(),o=t.movementX/s,a=t.movementY/i,l=(t.clientX-r.left)/s,u=(t.clientY-r.top)/i,f=this._positionObject;f.code="PosX",f.value=l,f.movement=o,this.dispatchInputEvent(f),f.code="PosY",f.value=u,f.movement=a,this.dispatchInputEvent(f)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},Xo=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,Vo=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Ze=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Xo,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Vo,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();let t=this.constructor,e=this.attachShadow({mode:"open"});e.appendChild(t[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(t[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=e.querySelector("kbd"),this._nameElement=e.querySelector("#name"),this._valueElement=e.querySelector("#value")}attributeChangedCallback(t,e,s){switch(t){case"name":this._name=s,this._nameElement.textContent=s;break;case"value":this._value=s,s!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=s,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=s!==null,this._kbdElement.classList.toggle("disabled",s!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};Ze.define();var Qo=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,Zo=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,cs=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},fs=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){let{device:e,code:s,event:i,value:r,movement:o,control:a,shift:l,alt:u}=t,f=this.bindings.getBindings(e,s);switch(i){case"pressed":for(let{input:m,index:E}of f)m.onUpdate(E,1,1);break;case"released":for(let{input:m,index:E}of f)m.onUpdate(E,0,-1);break;case"move":for(let{input:m,index:E}of f)m.onUpdate(E,r,o);break;case"wheel":for(let{input:m,index:E}of f)m.onUpdate(E,void 0,o);break}return f.length>0}},Je=class{constructor(t,e,s,i){this.device=t,this.code=e,this.input=s,this.index=i}},ps=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,s,i={inverted:!1}){let r,o=this.inputMap;if(o.has(t)){let l=o.get(t),u=t.size;t.onBind(u,i),r=new Je(e,s,t,u),l.push(r)}else{let l=[];o.set(t,l);let u=0;t.onBind(u,i),r=new Je(e,s,t,u),l.push(r)}let a=this.bindingMap;e in a?s in a[e]?a[e][s].push(r):a[e][s]=[r]:a[e]={[s]:[r]}}unbind(t){let e=this.inputMap;if(e.has(t)){let s=this.bindingMap,i=e.get(t);for(let r of i){let{device:o,code:a}=r,l=s[o][a],u=l.indexOf(r);l.splice(u,1)}i.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let s=this.bindingMap;if(t in s){let i=s[t];if(e in i)return i[e]}return[]}},ds=class{constructor(t,e=void 0){this.inputs={},this.devices=[new hs("Mouse",t),new us("Keyboard",t)],this.bindings=new ps,this.adapter=new fs(this.bindings),this.autopoller=new cs(this.adapter),this.eventTarget=t,this.anyButton=new me(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Xt(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let s of this.devices)s.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let s in t)t[s].length=0;this.autopoller.running&&this.autopoller.stop();for(let s of this.devices)s.removeEventListener("input",this.onInput),s.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let s of this.devices)s.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let e=this.autopoller.running,s=typeof t=="undefined"?!e:Boolean(t);s!==e&&(s?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let s=this.listeners;t in s?s[t].push(e):s[t]=[e]}removeEventListener(t,e){let s=this.listeners;if(t in s){let i=s[t],r=i.indexOf(e);r>=0&&i.splice(r,1)}}dispatchEvent(t){let{type:e}=t,s=0;for(let i of this.listeners[e])s|=i(t)?1:0;return Boolean(s)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindKeys(t){if(Array.isArray(t))for(let e of t)e.bindKeys(this);else if(typeof t.bindKeys=="function")t.bindKeys(this);else{t=Object.values(t);for(let e of t)e.bindKeys(this)}}bindButton(t,e,s,i=void 0){let r;this.hasButton(t)?r=this.getButton(t):(r=new me(1),this.inputs[t]=r),this.bindings.bind(r,e,s,i),this.onBind()}bindAxis(t,e,s,i=void 0){let r;this.hasAxis(t)?r=this.getAxis(t):(r=new Xt(1),this.inputs[t]=r),this.bindings.bind(r,e,s,i),this.onBind()}bindAxisButtons(t,e,s,i){let r;this.hasAxis(t)?r=this.getAxis(t):(r=new Xt(2),this.inputs[t]=r),this.bindings.bind(r,e,i),this.bindings.bind(r,e,s,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof me}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Xt}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let e=this.inputs;for(let s of t)if(e[s].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let e=this.inputs;for(let s of t)if(e[s].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let e=this.inputs;for(let s of t)if(e[s].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let e=this.inputs;for(let s of t){let i=e[s];if(i.value)return i.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let e=this.inputs;for(let s of t){let i=e[s];if(i.delta)return i.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},ge=class extends HTMLElement{static create(t={}){let{root:e=document.body,id:s=void 0,for:i=void 0,autopoll:r=!1}=t||{},o=new ge;return o.id=s,o.for=i,o.autopoll=r,e.appendChild(o),o}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Qo,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Zo,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=t.querySelector("#title"),this._pollElement=t.querySelector("#poll"),this._focusElement=t.querySelector("#focus"),this._bodyElement=t.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let e=this;this._for="",this._eventTarget=e,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let t=this._context;t&&(t.removeEventListener("bind",this.onInputContextBind),t.removeEventListener("unbind",this.onInputContextUnbind),t.removeEventListener("blur",this.onInputContextBlur),t.removeEventListener("focus",this.onInputContextFocus),t.destroy(),this._context=null)}attributeChangedCallback(t,e,s){switch(t){case"for":{this._for=s;let i,r;s?(i=document.getElementById(s),r=`${i.tagName.toLowerCase()}#${s}`):(i=this,r="input-port"),this._eventTarget=i,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${r}`}break;case"autopoll":this._autopoll=s!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(t="axisbutton",e=void 0){switch(t){case"axisbutton":if(!this._context){let s=new ds(this._eventTarget,e);s.addEventListener("bind",this.onInputContextBind),s.addEventListener("unbind",this.onInputContextUnbind),s.addEventListener("blur",this.onInputContextBlur),s.addEventListener("focus",this.onInputContextFocus),this._autopoll&&s.toggleAutoPoll(!0),this._context=s}return this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,e=t.inputs,s=t.bindings,i={},r=[];for(let o of Object.keys(e)){let a=e[o],l=!0;for(let u of s.getBindingsByInput(a)){let f=Jo(`${a.constructor.name}.${o}`,`${u.device}.${u.code}`,0,l);r.push(f),l&&(i[o]=f.querySelector("output"),l=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let o of r)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let s of Object.keys(this._outputElements)){let i=this._outputElements[s],r=e[s].value;i.innerText=Number(r).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let e=this._outputElements[t];e.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let s of Object.values(e))if(!s.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};ge.define();function Jo(n,t,e,s=!0){let i=document.createElement("tr");s&&i.classList.add("primary");{let r=document.createElement("td");r.textContent=n,r.classList.add("name"),i.appendChild(r)}{let r=document.createElement("td"),o=document.createElement("output");s?o.innerText=Number(e).toFixed(2):o.innerText="---",o.classList.add("value"),r.appendChild(o),i.appendChild(r)}{let r=document.createElement("td");r.classList.add("key");let o=new Ze;o.innerText=t,r.appendChild(o),i.appendChild(r)}return i}var Du=Symbol("keyboardSource");var ku=Symbol("mouseSource");var li=Ar(js());var Ys={},ka=function(n,t,e,s,i){var r=new Worker(Ys[t]||(Ys[t]=URL.createObjectURL(new Blob([n+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return r.onmessage=function(o){var a=o.data,l=a.$e$;if(l){var u=new Error(l[0]);u.code=l[1],u.stack=l[2],i(u,null)}else i(null,a)},r.postMessage(e,s),r},Z=Uint8Array,Lt=Uint16Array,mn=Uint32Array,gn=new Z([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vn=new Z([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qs=new Z([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ws=function(n,t){for(var e=new Lt(31),s=0;s<31;++s)e[s]=t+=1<<n[s-1];for(var i=new mn(e[30]),s=1;s<30;++s)for(var r=e[s];r<e[s+1];++r)i[r]=r-e[s]<<5|s;return[e,i]},Gs=Ws(gn,2),yn=Gs[0],Ba=Gs[1];yn[28]=258,Ba[258]=28;var Xs=Ws(vn,0),Vs=Xs[0],Yu=Xs[1],be=new Lt(32768);for(var k=0;k<32768;++k)_t=(k&43690)>>>1|(k&21845)<<1,_t=(_t&52428)>>>2|(_t&13107)<<2,_t=(_t&61680)>>>4|(_t&3855)<<4,be[k]=((_t&65280)>>>8|(_t&255)<<8)>>>1;var _t,zt=function(n,t,e){for(var s=n.length,i=0,r=new Lt(t);i<s;++i)n[i]&&++r[n[i]-1];var o=new Lt(t);for(i=0;i<t;++i)o[i]=o[i-1]+r[i-1]<<1;var a;if(e){a=new Lt(1<<t);var l=15-t;for(i=0;i<s;++i)if(n[i])for(var u=i<<4|n[i],f=t-n[i],m=o[n[i]-1]++<<f,E=m|(1<<f)-1;m<=E;++m)a[be[m]>>>l]=u}else for(a=new Lt(s),i=0;i<s;++i)n[i]&&(a[i]=be[o[n[i]-1]++]>>>15-n[i]);return a},Zt=new Z(288);for(var k=0;k<144;++k)Zt[k]=8;for(var k=144;k<256;++k)Zt[k]=9;for(var k=256;k<280;++k)Zt[k]=7;for(var k=280;k<288;++k)Zt[k]=8;var Qs=new Z(32);for(var k=0;k<32;++k)Qs[k]=5;var Zs=zt(Zt,9,1);var Js=zt(Qs,5,1),Se=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},ut=function(n,t,e){var s=t/8|0;return(n[s]|n[s+1]<<8)>>(t&7)&e},Ce=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},ti=function(n){return(n+7)/8|0},Re=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var s=new(n.BYTES_PER_ELEMENT==2?Lt:n.BYTES_PER_ELEMENT==4?mn:Z)(e-t);return s.set(n.subarray(t,e)),s};var ei=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],et=function(n,t,e){var s=new Error(t||ei[n]);if(s.code=n,Error.captureStackTrace&&Error.captureStackTrace(s,et),!e)throw s;return s},ni=function(n,t,e){var s=n.length;if(!s||e&&e.f&&!e.l)return t||new Z(0);var i=!t||e,r=!e||e.i;e||(e={}),t||(t=new Z(s*3));var o=function(_){var Pt=t.length;if(_>Pt){var ce=new Z(Math.max(Pt*2,_));ce.set(t),t=ce}},a=e.f||0,l=e.p||0,u=e.b||0,f=e.l,m=e.d,E=e.m,L=e.n,S=s*8;do{if(!f){a=ut(n,l,1);var R=ut(n,l+1,3);if(l+=3,R)if(R==1)f=Zs,m=Js,E=9,L=5;else if(R==2){var M=ut(n,l,31)+257,q=ut(n,l+10,15)+4,$=M+ut(n,l+5,31)+1;l+=14;for(var X=new Z($),K=new Z(19),y=0;y<q;++y)K[qs[y]]=ut(n,l+y*3,7);l+=q*3;for(var A=Se(K),z=(1<<A)-1,p=zt(K,A,1),y=0;y<$;){var O=p[ut(n,l,z)];l+=O&15;var I=O>>>4;if(I<16)X[y++]=I;else{var T=0,st=0;for(I==16?(st=3+ut(n,l,3),l+=2,T=X[y-1]):I==17?(st=3+ut(n,l,7),l+=3):I==18&&(st=11+ut(n,l,127),l+=7);st--;)X[y++]=T}}var c=X.subarray(0,M),h=X.subarray(M);E=Se(c),L=Se(h),f=zt(c,E,1),m=zt(h,L,1)}else et(1);else{var I=ti(l)+4,H=n[I-4]|n[I-3]<<8,j=I+H;if(j>s){r&&et(0);break}i&&o(u+H),t.set(n.subarray(I,j),u),e.b=u+=H,e.p=l=j*8,e.f=a;continue}if(l>S){r&&et(0);break}}i&&o(u+131072);for(var W=(1<<E)-1,C=(1<<L)-1,J=l;;J=l){var T=f[Ce(n,l)&W],G=T>>>4;if(l+=T&15,l>S){r&&et(0);break}if(T||et(2),G<256)t[u++]=G;else if(G==256){J=l,f=null;break}else{var V=G-254;if(G>264){var y=G-257,mt=gn[y];V=ut(n,l,(1<<mt)-1)+yn[y],l+=mt}var qt=m[Ce(n,l)&C],Mt=qt>>>4;qt||et(3),l+=qt&15;var h=Vs[Mt];if(Mt>3){var mt=vn[Mt];h+=Ce(n,l)&(1<<mt)-1,l+=mt}if(l>S){r&&et(0);break}i&&o(u+131072);for(var gt=u+V;u<gt;u+=4)t[u]=t[u-h],t[u+1]=t[u+1-h],t[u+2]=t[u+2-h],t[u+3]=t[u+3-h];u=gt}}e.l=f,e.p=J,e.b=u,e.f=a,f&&(a=1,e.m=E,e.d=m,e.n=L)}while(!a);return u==t.length?t:Re(t,0,u)};var Ha=new Z(0);var Ua=function(n,t){var e={};for(var s in n)e[s]=n[s];for(var s in t)e[s]=t[s];return e},si=function(n,t,e){for(var s=n(),i=n.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<s.length;++o){var a=s[o],l=r[o];if(typeof a=="function"){t+=";"+l+"=";var u=a.toString();if(a.prototype)if(u.indexOf("[native code]")!=-1){var f=u.indexOf(" ",8)+1;t+=u.slice(f,u.indexOf("(",f))}else{t+=u;for(var m in a.prototype)t+=";"+l+".prototype."+m+"="+a.prototype[m].toString()}else t+=u}else e[l]=a}return[t,e]},Te=[],$a=function(n){var t=[];for(var e in n)n[e].buffer&&t.push((n[e]=new n[e].constructor(n[e])).buffer);return t},za=function(n,t,e,s){var i;if(!Te[e]){for(var r="",o={},a=n.length-1,l=0;l<a;++l)i=si(n[l],r,o),r=i[0],o=i[1];Te[e]=si(n[a],r,o)}var u=Ua({},Te[e][1]);return ka(Te[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",e,u,$a(u),s)},Ka=function(){return[Z,Lt,mn,gn,vn,qs,yn,Vs,Zs,Js,be,ei,zt,Se,ut,Ce,ti,Re,et,ni,En,ii,ri]};var ii=function(n){return postMessage(n,[n.buffer])},ri=function(n){return n&&n.size&&new Z(n.size)},Fa=function(n,t,e,s,i,r){var o=za(e,s,i,function(a,l){o.terminate(),r(a,l)});return o.postMessage([n,t],t.consume?[n.buffer]:[]),function(){o.terminate()}};var yt=function(n,t){return n[t]|n[t+1]<<8},pt=function(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0},wn=function(n,t){return pt(n,t)+pt(n,t+4)*4294967296};function ja(n,t,e){return e||(e=t,t={}),typeof e!="function"&&et(7),Fa(n,t,[Ka],function(s){return ii(En(s.data[0],ri(s.data[1])))},1,e)}function En(n,t){return ni(n,t)}var qu=typeof TextEncoder!="undefined"&&new TextEncoder,xn=typeof TextDecoder!="undefined"&&new TextDecoder,Ya=0;try{xn.decode(Ha,{stream:!0}),Ya=1}catch(n){}var qa=function(n){for(var t="",e=0;;){var s=n[e++],i=(s>127)+(s>223)+(s>239);if(e+i>n.length)return[t,Re(n,e-1)];i?i==3?(s=((s&15)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,t+=String.fromCharCode(55296|s>>10,56320|s&1023)):i&1?t+=String.fromCharCode((s&31)<<6|n[e++]&63):t+=String.fromCharCode((s&15)<<12|(n[e++]&63)<<6|n[e++]&63):t+=String.fromCharCode(s)}};function Wa(n,t){if(t){for(var e="",s=0;s<n.length;s+=16384)e+=String.fromCharCode.apply(null,n.subarray(s,s+16384));return e}else{if(xn)return xn.decode(n);var i=qa(n),r=i[0],o=i[1];return o.length&&et(8),r}}var Ga=function(n,t){return t+30+yt(n,t+26)+yt(n,t+28)},Xa=function(n,t,e){var s=yt(n,t+28),i=Wa(n.subarray(t+46,t+46+s),!(yt(n,t+8)&2048)),r=t+46+s,o=pt(n,t+20),a=e&&o==4294967295?Va(n,r):[o,pt(n,t+24),pt(n,t+42)],l=a[0],u=a[1],f=a[2];return[yt(n,t+10),l,u,i,r+yt(n,t+30)+yt(n,t+32),f]},Va=function(n,t){for(;yt(n,t)!=1;t+=4+yt(n,t+2));return[wn(n,t+12),wn(n,t+4),wn(n,t+20)]};var oi=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(n){n()};function ai(n,t,e){e||(e=t,t={}),typeof e!="function"&&et(7);var s=[],i=function(){for(var I=0;I<s.length;++I)s[I]()},r={},o=function(I,H){oi(function(){e(I,H)})};oi(function(){o=e});for(var a=n.length-22;pt(n,a)!=101010256;--a)if(!a||n.length-a>65558)return o(et(13,0,1),null),i;var l=yt(n,a+8);if(l){var u=l,f=pt(n,a+16),m=f==4294967295||u==65535;if(m){var E=pt(n,a-12);m=pt(n,E)==101075792,m&&(u=l=pt(n,E+32),f=pt(n,E+48))}for(var L=t&&t.filter,S=function(I){var H=Xa(n,f,m),j=H[0],M=H[1],q=H[2],$=H[3],X=H[4],K=H[5],y=Ga(n,K);f=X;var A=function(p,O){p?(i(),o(p,null)):(O&&(r[$]=O),--l||o(null,r))};if(!L||L({name:$,size:M,originalSize:q,compression:j}))if(!j)A(null,Re(n,y,y+M));else if(j==8){var z=n.subarray(y,y+M);if(M<32e4)try{A(null,En(z,new Z(q)))}catch(p){A(p,null)}else s.push(ja(z,{size:q},A))}else A(et(14,"unknown compression type "+j,1),null);else A(null,null)},R=0;R<u;++R)S(R)}else o(null,{});return i}var Jt=class{constructor(t){let e;typeof t=="object"&&t instanceof Jt?e=t.source:e=String(t),this.source=e,this._re=(0,li.makeRe)(e)}test(t){return this._re.test(t)}},Qa=/^([_\w\d]+)\:\/\//;async function ui(n,t,e,s,i,r){let{loadings:o}=n,a;t in o?a=o[t]:(a=new Kt(r),o[t]=a);let l=Kt.nextAttempt(a),u=[a.promise];return Qa.test(e)?u.push(hi(n,e,r).then(f=>s(f,i)).then(f=>Kt.isCurrentAttempt(a,l)?te(n,t,f):void 0)):u.push(s(e).then(f=>Kt.isCurrentAttempt(a,l)?te(n,t,f):void 0)),await Promise.race(u)}function te(n,t,e){let{store:s,loadings:i}=n;return s[t]=e,t in i&&(i[t].resolve(e),delete i[t]),e}function Za(n,t,e){let{defaults:s}=n;typeof t=="string"&&(t=new Jt(t));let i=`__default://[${s.length}]`;return te(n,i,e),s.push(new pi(t,i)),e}function Ja(n,t){let{store:e,loadings:s}=n;t in s&&(s[t].reject(new Error("Stop loading to delete asset.")),delete s[t]),t in e&&delete e[t]}function tl(n,t){typeof t=="string"&&(t=new Jt(t));let{store:e,loadings:s}=n;for(let[i,r]of Object.entries(s))t.test(i)&&(r.reject(new Error(`Stop loading to clear assets matching ${t}`)),delete s[i]);for(let i of Object.keys(e))t.test(i)&&delete e[i]}function el(n){let{store:t,loadings:e,defaults:s}=n;for(let[i,r]of Object.entries(e))r.reject(new Error("Stop loading to clear all assets.")),delete e[i];for(let i of Object.keys(t))delete t[i];s.length=0}function nl(n,t){let{loadings:e}=n;return t in e?e[t].promise:null}async function hi(n,t,e){let{store:s,loadings:i}=n;if(t in s)return s[t];if(t in i)return i[t].promise;{let r=new Kt(e);return i[t]=r,r.promise}}function sl(n,t){let{defaults:e}=n;for(let s of e)if(s.glob.test(t))return Me(n,s.uri);return null}function Me(n,t){return n.store[t]}function il(n,t){return Boolean(n.store[t])}function rl(n){return Object.keys(n.store)}function ci(n,t){return t in n.store}function fi(n,t){return t in n.loadings}var pi=class{constructor(t,e){this.glob=t,this.uri=e}},Kt=class{static nextAttempt(t){return++t._promiseHandle}static isCurrentAttempt(t,e){return t._promiseHandle===e}constructor(t){this._promiseHandle=0,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(t)&&t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((e,s)=>{this._value?e(this._value):this._resolve=e,this._reason?s(this._reason):this._reject=s})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}},An=class{constructor(t=null){this.parent=t,this.store={},this.loadings={},this.defaults=[]}get(t){let e=this;if(ci(e,t))return Me(e,t);let s=sl(e,t);return s||null}async resolve(t,e,s,i,r){return this.get(t)||await this.load(t,e,s,i,r)}fallback(t,e){return Za(this,t,e)}cache(t,e){return te(this,t,e)}async load(t,e,s,i,r){let o=this;return ci(o,t)?Me(o,t):fi(o,t)?await hi(o,t,r):await ui(o,t,e,s,i,r)}async reload(t,e,s,i,r){return await ui(this,t,e,s,i,r)}unload(t){Ja(this,t)}clear(t){tl(this,t)}current(t){return Me(this,t)}exists(t){return il(this,t)}loading(t){let e=this;return fi(e,t)?nl(e,t):null}keys(){return rl(this)}reset(){el(this)}},di=5e3,ot=class{constructor(t,e,s=void 0,i=t,r=null){this.uri=t,this.loader=e,this.opts=s,this.initial=r,this.filepath=i,this.source=null,this.current=null}cache(t,e){return t.cache(this.uri,e),this.source=t,this.current=e,this}get(t){let e;return t.exists(this.uri)?e=t.current(this.uri):this.initial&&this.initial instanceof ot?e=this.initial.get(t):e=this.initial,this.source=t,this.current=e,e}async load(t,e=di){let s;if(t.exists(this.uri))s=t.current(this.uri);else if(s=await t.load(this.uri,this.filepath,this.loader,this.opts,e),!s)if(this.initial&&this.initial instanceof ot){let i=this.initial;s=await t.load(i.uri,i.filepath,i.loader,i.opts,e)}else s=this.initial;return this.source=t,this.current=s,s}async reload(t,e=di){let s=await t.reload(this.uri,this.filepath,this.loader,this.opts,e);return this.source=t,this.current=s,s}};async function mi(n,t,e=void 0){let s=n,i="raw://",o=await(await fetch(t)).arrayBuffer();await new Promise((a,l)=>{ai(new Uint8Array(o),(u,f)=>{if(u)l(u);else{for(let[m,E]of Object.entries(f)){m=m.replaceAll("\\","/");let L=m.indexOf("/");L>=0&&(m=m.substring(L+1));let S=i+m;te(s,S,E),e&&e(E,S,m)}a()}})})}async function _n(n,t){let{audioContext:e}=t||{};if(typeof n=="string"){let a=await(await fetch(n)).arrayBuffer();return _n(a,{audioContext:e})}else if(!(n instanceof ArrayBuffer||ArrayBuffer.isView(n)))throw new Error("Cannot load from source - must be an array buffer or fetchable url");let s=n,i=new ArrayBuffer(s.byteLength);return new Uint8Array(i).set(s),await e.decodeAudioData(i)}window.addEventListener("error",Le,!0);window.addEventListener("unhandledrejection",Le,!0);var gi=!1;function Le(n){gi||(typeof n=="object"?n instanceof PromiseRejectionEvent?Le(n.reason):n instanceof ErrorEvent?Le(n.error):n instanceof Error?window.alert(n.stack):window.alert(JSON.stringify(n)):window.alert(n),gi=!0)}var Ie=1e-6,ee=typeof Float32Array!="undefined"?Float32Array:Array,bn=Math.random;var Qu=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Oe={};Ke(Oe,{add:()=>hl,angle:()=>Ol,bezier:()=>bl,ceil:()=>cl,clone:()=>ol,copy:()=>ll,create:()=>vi,cross:()=>xl,dist:()=>$l,distance:()=>Ai,div:()=>Ul,divide:()=>xi,dot:()=>Si,equals:()=>kl,exactEquals:()=>Dl,floor:()=>fl,forEach:()=>jl,fromValues:()=>al,hermite:()=>_l,inverse:()=>wl,len:()=>Kl,length:()=>yi,lerp:()=>Al,max:()=>dl,min:()=>pl,mul:()=>Hl,multiply:()=>Ei,negate:()=>yl,normalize:()=>El,random:()=>Sl,rotateX:()=>Ml,rotateY:()=>Ll,rotateZ:()=>Il,round:()=>ml,scale:()=>gl,scaleAndAdd:()=>vl,set:()=>ul,sqrDist:()=>zl,sqrLen:()=>Fl,squaredDistance:()=>_i,squaredLength:()=>bi,str:()=>Nl,sub:()=>Bl,subtract:()=>wi,transformMat3:()=>Rl,transformMat4:()=>Cl,transformQuat:()=>Tl,zero:()=>Pl});function vi(){var n=new ee(3);return ee!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ol(n){var t=new ee(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function yi(n){var t=n[0],e=n[1],s=n[2];return Math.hypot(t,e,s)}function al(n,t,e){var s=new ee(3);return s[0]=n,s[1]=t,s[2]=e,s}function ll(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function ul(n,t,e,s){return n[0]=t,n[1]=e,n[2]=s,n}function hl(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function wi(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function Ei(n,t,e){return n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}function xi(n,t,e){return n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}function cl(n,t){return n[0]=Math.ceil(t[0]),n[1]=Math.ceil(t[1]),n[2]=Math.ceil(t[2]),n}function fl(n,t){return n[0]=Math.floor(t[0]),n[1]=Math.floor(t[1]),n[2]=Math.floor(t[2]),n}function pl(n,t,e){return n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function dl(n,t,e){return n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function ml(n,t){return n[0]=Math.round(t[0]),n[1]=Math.round(t[1]),n[2]=Math.round(t[2]),n}function gl(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}function vl(n,t,e,s){return n[0]=t[0]+e[0]*s,n[1]=t[1]+e[1]*s,n[2]=t[2]+e[2]*s,n}function Ai(n,t){var e=t[0]-n[0],s=t[1]-n[1],i=t[2]-n[2];return Math.hypot(e,s,i)}function _i(n,t){var e=t[0]-n[0],s=t[1]-n[1],i=t[2]-n[2];return e*e+s*s+i*i}function bi(n){var t=n[0],e=n[1],s=n[2];return t*t+e*e+s*s}function yl(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function wl(n,t){return n[0]=1/t[0],n[1]=1/t[1],n[2]=1/t[2],n}function El(n,t){var e=t[0],s=t[1],i=t[2],r=e*e+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function Si(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function xl(n,t,e){var s=t[0],i=t[1],r=t[2],o=e[0],a=e[1],l=e[2];return n[0]=i*l-r*a,n[1]=r*o-s*l,n[2]=s*a-i*o,n}function Al(n,t,e,s){var i=t[0],r=t[1],o=t[2];return n[0]=i+s*(e[0]-i),n[1]=r+s*(e[1]-r),n[2]=o+s*(e[2]-o),n}function _l(n,t,e,s,i,r){var o=r*r,a=o*(2*r-3)+1,l=o*(r-2)+r,u=o*(r-1),f=o*(3-2*r);return n[0]=t[0]*a+e[0]*l+s[0]*u+i[0]*f,n[1]=t[1]*a+e[1]*l+s[1]*u+i[1]*f,n[2]=t[2]*a+e[2]*l+s[2]*u+i[2]*f,n}function bl(n,t,e,s,i,r){var o=1-r,a=o*o,l=r*r,u=a*o,f=3*r*a,m=3*l*o,E=l*r;return n[0]=t[0]*u+e[0]*f+s[0]*m+i[0]*E,n[1]=t[1]*u+e[1]*f+s[1]*m+i[1]*E,n[2]=t[2]*u+e[2]*f+s[2]*m+i[2]*E,n}function Sl(n,t){t=t||1;var e=bn()*2*Math.PI,s=bn()*2-1,i=Math.sqrt(1-s*s)*t;return n[0]=Math.cos(e)*i,n[1]=Math.sin(e)*i,n[2]=s*t,n}function Cl(n,t,e){var s=t[0],i=t[1],r=t[2],o=e[3]*s+e[7]*i+e[11]*r+e[15];return o=o||1,n[0]=(e[0]*s+e[4]*i+e[8]*r+e[12])/o,n[1]=(e[1]*s+e[5]*i+e[9]*r+e[13])/o,n[2]=(e[2]*s+e[6]*i+e[10]*r+e[14])/o,n}function Rl(n,t,e){var s=t[0],i=t[1],r=t[2];return n[0]=s*e[0]+i*e[3]+r*e[6],n[1]=s*e[1]+i*e[4]+r*e[7],n[2]=s*e[2]+i*e[5]+r*e[8],n}function Tl(n,t,e){var s=e[0],i=e[1],r=e[2],o=e[3],a=t[0],l=t[1],u=t[2],f=i*u-r*l,m=r*a-s*u,E=s*l-i*a,L=i*E-r*m,S=r*f-s*E,R=s*m-i*f,I=o*2;return f*=I,m*=I,E*=I,L*=2,S*=2,R*=2,n[0]=a+f+L,n[1]=l+m+S,n[2]=u+E+R,n}function Ml(n,t,e,s){var i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[0],r[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),r[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function Ll(n,t,e,s){var i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),r[1]=i[1],r[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function Il(n,t,e,s){var i=[],r=[];return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],r[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),r[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),r[2]=i[2],n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function Ol(n,t){var e=n[0],s=n[1],i=n[2],r=t[0],o=t[1],a=t[2],l=Math.sqrt(e*e+s*s+i*i),u=Math.sqrt(r*r+o*o+a*a),f=l*u,m=f&&Si(n,t)/f;return Math.acos(Math.min(Math.max(m,-1),1))}function Pl(n){return n[0]=0,n[1]=0,n[2]=0,n}function Nl(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function Dl(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]}function kl(n,t){var e=n[0],s=n[1],i=n[2],r=t[0],o=t[1],a=t[2];return Math.abs(e-r)<=Ie*Math.max(1,Math.abs(e),Math.abs(r))&&Math.abs(s-o)<=Ie*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(i-a)<=Ie*Math.max(1,Math.abs(i),Math.abs(a))}var Bl=wi,Hl=Ei,Ul=xi,$l=Ai,zl=_i,Kl=yi,Fl=bi,jl=function(){var n=vi();return function(t,e,s,i,r,o){var a,l;for(e||(e=3),s||(s=0),i?l=Math.min(i*e+s,t.length):l=t.length,a=s;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],r(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}}();var rh=Oe.fromValues(0,1,0);var oh=Math.PI/3;var ah=Math.PI/180;var bt=class{constructor(t,e=()=>null,s=()=>{}){this.name=t,this.new=e,this.delete=s}},Ci=class{constructor(){this.cachedResults={},this.keyQueryMapping={},this.onEntityComponentChanged=this.onEntityComponentChanged.bind(this)}onEntityComponentChanged(t,e,s,i,r){for(let o of Object.values(this.keyQueryMapping)){let a=this.cachedResults[o.key];if(r){let l=a.indexOf(e);l>=0&&a.splice(l,1)}else if(s)if(o.hasSelector(Ri(s))){let l=a.indexOf(e);l>=0&&a.splice(l,1)}else o.hasSelector(s)&&o.test(t,e)&&a.indexOf(e)<0&&a.push(e);else if(i){if(o.hasSelector(Ri(i))&&o.test(t,e))a.indexOf(e)<0&&a.push(e);else if(o.hasSelector(i)&&o.test(t,e)){let l=a.indexOf(e);l>=0&&a.splice(l,1)}}}}findAny(t,e){let s=this.findAll(t,e);return s.length<=0?null:s[Math.floor(Math.random()*s.length)]}findAll(t,e){let s=e.key,i;return s in this.keyQueryMapping?i=this.cachedResults[s]:(i=[],this.keyQueryMapping[s]=e,this.cachedResults[s]=i,e.hydrate(t,i)),i}count(t,e){return this.findAll(t,e).length}clear(t){let e=t.key;e in this.keyQueryMapping&&(delete this.keyQueryMapping[e],delete this.cachedResults[e])}reset(){this.keyQueryMapping={},this.cachedResults={}}};function Ri(n){return{type:"not",name:n.name,value:n}}function ne(n){return"type"in n&&n.type==="not"}var Sn=class{constructor(){this.components={},this.nameClassMapping={},this.nextAvailableEntityId=1,this.queue=[],this.listeners=[],this.queries=new Ci}entityComponentChangedCallback(t,e,s,i){this.queries.onEntityComponentChanged(this,t,e,s,i);for(let r of this.listeners)r(this,t,e,s,i)}addEventListener(t,e){t==="change"&&this.listeners.push(e)}removeEventListener(t,e){if(t==="change"){let s=this.listeners.indexOf(e);s>=0&&this.listeners.splice(s,1)}}flush(){for(;this.queue.length>0;){let[t,...e]=this.queue.shift();switch(t){case"attach":{let[s,i,r]=e;this.attachImmediately(s,i,r)}break;case"detach":{let[s,i]=e;this.detachImmediately(s,i)}break;case"clear":{let[s]=e;this.clearImmediately(s)}break}}}create(){let t=this.nextAvailableEntityId++;return this.entityComponentChangedCallback(t,null,null,!1),t}destroy(t){let e=this.components;for(let s of Object.keys(e)){let i=e[s];t in i&&(delete i[t],this.entityComponentChangedCallback(t,null,this.nameClassMapping[s],!1))}this.entityComponentChangedCallback(t,null,null,!0)}exists(t,...e){if(e.length>0){for(let s of e){let i=this.mapOf(s);if(!(t in i))return!1}return!0}else for(let s of Object.values(this.components))if(t in s)return!0;return!1}attach(t,e,s=void 0){return typeof s=="undefined"&&(s=e.new()),this.queue.push(["attach",t,e,s]),s}attachImmediately(t,e,s=void 0){typeof s=="undefined"&&(s=e.new());let i=this.mapOf(e);return i[t]=s,this.entityComponentChangedCallback(t,e,null,!1),s}detach(t,e){this.queue.push(["detach",t,e])}detachImmediately(t,e){let s=this.mapOf(e),i=s[t];delete s[t],e.delete(i),this.entityComponentChangedCallback(t,null,e,!1)}clear(t){this.queue.push(["clear",t])}clearImmediately(t){let e=t.name,s=this.components,i=s[e],r=Object.keys(i).map(Number),o=Object.values(i);s[e]={},this.nameClassMapping[e]=t;for(let a of o)t.delete(a);for(let a of r)this.entityComponentChangedCallback(a,null,t,!1)}get(t,e){return this.mapOf(e)[t]||null}count(t){return Object.keys(this.mapOf(t)).length}keysOf(t){return Object.keys(this.mapOf(t)).map(Number)}valuesOf(t){return Object.values(this.mapOf(t))}mapOf(t){let e=t.name,s=this.components;if(e in s)return s[e];{let i={};return s[e]=i,this.nameClassMapping[e]=t,i}}entityIds(){let t=new Set;for(let e of Object.values(this.components))for(let s of Object.keys(e))t.add(s);return t}componentClasses(){return Object.values(this.nameClassMapping)}reset(){let t=this.components,e=new Set;for(let s of Object.keys(t)){let i=this.nameClassMapping[s],r=t[s];for(let o of Object.keys(r))e.add(Number(o));this.clearImmediately(i)}for(let s of e)this.entityComponentChangedCallback(s,null,null,!0);e.clear(),this.queries.reset(),this.components={},this.nextAvailableEntityId=1,this.queue.length=0,this.listeners.length=0}};var St=class{constructor(...t){if(t.length<=0)throw new Error("Must have at least 1 selector for query.");this.selectors=t,this.key=t.map(e=>ne(e)?`!${e.name}`:e.name).sort().join("&")}hasSelector(t){return ne(t)?this.selectors.findIndex(e=>ne(e)&&e.name===t.name)>=0:this.selectors.findIndex(e=>e.name===t.name)>=0}test(t,e){for(let s of this.selectors)if(ne(s)){let i=s.value;if(t.exists(e,i))return!1}else{let i=s;if(!t.exists(e,i))return!1}return!0}hydrate(t,e){if(this.selectors.length<=0)return e.length=0,e;let s=t.entityIds();for(let i of s)this.test(t,i)&&e.push(i);return e}count(t){return t.queries.count(t,this)}findAny(t){let e=t.queries,s=new Array(this.selectors.length+1),i=e.findAny(t,this);return i===null?s.fill(void 0):(Ti(s,t,i,this.selectors),s)}*findAll(t){let e=t.queries,s=new Array(this.selectors.length+1),i=e.findAll(t,this);for(let r of i)Ti(s,t,r,this.selectors),yield s}};function Ti(n,t,e,s){n[0]=e;let i=1;for(let r of s)ne(r)?n[i]=null:n[i]=t.get(e,r),++i;return n}var Ct=class{constructor(t){this.name=t}dispatch(t,e){t.dispatch(this,e)}dispatchImmediately(t,e){t.dispatchImmediately(this,e)}async dispatchImmediatelyAndWait(t,e){await t.dispatchImmediatelyAndWait(this,e)}on(t,e,s){return t.addEventListener(this,s,{priority:e}),this}off(t,e){return t.removeEventListener(this,e),this}once(t,e,s){let i=r=>(this.off(t,i),s(r));return this.on(t,e,i)}*poll(t,e){e=Math.min(e,t.count(this));for(let s=0;s<e;++s)yield t.poll(this)}retain(t,e){t.retain(this,e)}*pollAndRetain(t,e){this.retain(t,e);for(let s of this.poll(t,e))yield s}};function Yl(n,t){return n.priority-t.priority}var Cn=class{constructor(){this.cachedIn={},this.cachedOut={},this.callbacks={},this.maxRetains={},this.nameTopicMapping={}}addEventListener(t,e,s=void 0){let{priority:i=0}=s,r=this.callbacksOf(t);r.push({callback:e,priority:i}),r.sort(Yl)}removeEventListener(t,e){let s=this.callbacksOf(t),i=s.findIndex(r=>r.callback===e);i>=0&&s.splice(i,1)}countEventListeners(t){return this.callbacksOf(t).length}dispatch(t,e){this.incomingOf(t).push(e)}dispatchImmediately(t,e){let s=this.callbacksOf(t);for(let{callback:r}of s)if(r(e)===!0)return;this.outgoingOf(t).push(e)}async dispatchImmediatelyAndWait(t,e){let s=this.callbacksOf(t);for(let{callback:r}of s)if(await r(e)===!0)return;this.outgoingOf(t).push(e)}count(t){return this.outgoingOf(t).length}poll(t){let e=this.outgoingOf(t);return e.length<=0?null:e.shift()}retain(t,e){let s=t.name,i=Math.max(e,this.maxRetains[s]||0);this.maxRetains[s]=i}flush(t=100){for(let e of Object.keys(this.cachedIn)){let s=this.nameTopicMapping[e],i=this.cachedIn[e],r=this.cachedOut[e],o=this.maxRetains[e]||0;o<r.length&&r.splice(0,r.length-o);let a=Math.min(t,i.length);for(let l=0;l<a;++l){let u=i.shift();typeof u=="object"&&u instanceof Promise?this.dispatchImmediately(s,u):this.dispatchImmediately(s,u)}}}getPendingRetainCount(t){return this.maxRetains[t.name]||0}getPendingFlushCount(t){return this.incomingOf(t).length}reset(){this.cachedIn={},this.cachedOut={},this.callbacks={},this.maxRetains={},this.nameTopicMapping={}}incomingOf(t){let e=t.name;if(e in this.cachedIn)return this.cachedIn[e];{let s=[];return this.cachedIn[e]=s,this.cachedOut[e]=[],this.nameTopicMapping[e]=t,s}}outgoingOf(t){let e=t.name;if(e in this.cachedOut)return this.cachedOut[e];{let s=[];return this.cachedIn[e]=[],this.cachedOut[e]=s,this.nameTopicMapping[e]=t,s}}callbacksOf(t){let e=t.name;if(e in this.callbacks)return this.callbacks[e];{let s=[];return this.callbacks[e]=s,s}}},Pe=class{constructor(t,e=void 0){let{animationFrameHandler:s=window}=e||{};this.handle=0,this.detail={prevTime:-1,currentTime:-1,deltaTime:0},this.animationFrameHandler=s,this.callback=t,this.next=this.next.bind(this),this.start=this.start.bind(this),this.cancel=this.cancel.bind(this)}next(t=performance.now()){this.handle=this.animationFrameHandler.requestAnimationFrame(this.next);let e=this.detail;e.prevTime=e.currentTime,e.currentTime=t,e.deltaTime=e.currentTime-e.prevTime,this.callback(this)}start(){return this.handle=this.animationFrameHandler.requestAnimationFrame(this.next),this}cancel(){return this.animationFrameHandler.cancelAnimationFrame(this.handle),this}};var Pn={};Ke(Pn,{Debug:()=>On,MoveDown:()=>Ln,MoveLeft:()=>Rn,MoveRight:()=>Tn,MoveUp:()=>Mn,Shoot:()=>In});var Rn=new ft("moveLeft",[it.ARROW_LEFT,it.KEY_A]),Tn=new ft("moveRight",[it.ARROW_RIGHT,it.KEY_D]),Mn=new ft("moveUp",[it.ARROW_UP,it.KEY_W]),Ln=new ft("moveDown",[it.ARROW_DOWN,it.KEY_S]),In=new ft("shoot",it.SPACE),On=new ft("debug",it.BACKSLASH);var Nn=class{next(){return 0}},Mi=class extends Nn{next(){return Math.random()}},Li=class extends Nn{constructor(t){super();this.seed=t,this.a=t}next(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}},x=class{static get RAND(){let t=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:t}),t}constructor(t=void 0){typeof t=="number"?this.generator=new Li(t):t?this.generator=t:this.generator=new Mi,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(t){return this.RAND.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return this.RAND.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static rangeInt(t,e){return this.RAND.rangeInt(t,e)}rangeInt(t,e){return Math.trunc(this.range(t,e))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};var Ne={showCollision:!1},se=.1;function wt(n,t,e,s){t.x<-e&&(t.x=n.width),t.y<-s&&(t.y=n.height),t.x>n.width+e/2&&(t.x=-e),t.y>n.height+s/2&&(t.y=-s)}function Ft(n,t,e){let s=n.x-t.x,i=n.y-t.y;return s*s+i*i<=e*e}function It(n,t,e,s){!Ne.showCollision||(n.translate(t,e),n.beginPath(),n.arc(0,0,s,0,Math.PI*2),n.strokeStyle="lime",n.stroke(),n.setTransform(1,0,0,1,0,0))}function P(n,t){return n.use(t)}function Ii(n,t){n.before(t)}function jt(n,t){let e=P(n,ie);n.before(async()=>{Promise.allSettled(t.map(s=>s.load(e)))})}var Dn=4,kn=2,re=600,ql=9,Bn=new bt("Particle",()=>({x:0,y:0,dx:0,dy:0,rotation:0,age:0,color:"white"})),Oi=new St(Bn);function Pi(n){let t=P(n,dt),{canvas:e}=P(n,ht);Et(n,()=>{t.clear(Bn)}),at(n,({deltaTime:s})=>{for(let[i,r]of Oi.findAll(t))r.age+=s,r.age>re?t.destroy(i):(r.x+=r.dx,r.y+=r.dy,wt(e,r,Dn*2,Dn*2))}),nt(n,ql,s=>{for(let[i,r]of Oi.findAll(t)){s.translate(r.x,r.y),s.rotate(r.rotation),s.fillStyle=r.color;let o=Dn*(1-r.age/re);s.fillRect(-o,-o,o*2,o*2),s.setTransform(1,0,0,1,0,0)}})}function De(n,t,e,s,i,r,o=0){typeof r=="function"&&(r=r());let a=n.ents.create(),l=n.ents.attach(a,Bn);return l.x=t,l.y=e,l.dx=s,l.dy=i,l.rotation=Math.atan2(i,s),l.age=o,l.color=r,a}function Yt(n,t,e,s=10,i){for(let r=0;r<s;++r)De(n,t,e,x.range(-1,1)*kn,x.range(-1,1)*kn,i)}var B=1,Hn=.1,oe=4,Wl=100,Gl=1,N=8,ke={MIN:3e3,MAX:1e4},Xl=n=>n.range(ke.MIN,ke.MAX),Vl=["blue","blue","blue","dodgerblue","gray","darkgray","yellow"],Ql=5;function Ni(n){let t=P(n,xt);Et(n,()=>{t.asteroids.length=0;for(let e=0;e<Gl*t.level;++e)t.asteroidSpawner.spawn(t)}),at(n,({deltaTime:e})=>{Jl(e,t,t.asteroids),Zl(e,t,t.asteroidSpawner)}),nt(n,Ql,e=>{tu(e,t,t.asteroids)})}function Di(n){return{scene:n,spawnTicks:ke.MAX,reset(){this.spawnTicks=ke.MAX},spawn(t){if(t.asteroids.length>Wl)return;let e=x.choose(Un(t.display)),s=ae(t,x.range(e[0],e[0]+e[2]),x.range(e[1],e[1]+e[3]),x.range(-B,B),x.range(-B,B),N);t.asteroids.push(s)}}}function Zl(n,t,e){t.gamePause||(e.spawnTicks-=n,e.spawnTicks<=0&&(e.spawn(t),e.spawnTicks=Xl(x.RAND)))}function Jl(n,t,e){for(let s of e)s.x+=s.dx,s.y+=s.dy,wt(t.canvas,s,s.size*2,s.size*2);for(let s of e)if(Ft(s,t.player,s.size+lt)){$n(t,s),Bi(t,s),Hi(t,t.player);break}}function tu(n,t,e){for(let s of e)n.translate(s.x,s.y),n.rotate(s.rotation),n.fillStyle="slategray",n.fillRect(-s.size,-s.size,s.size*2,s.size*2),n.setTransform(1,0,0,1,0,0),It(n,s.x,s.y,s.size)}function Un(n){return[[-N,-N,N*2+n.width,N],[-N,0,N,n.height],[-N,n.height,N*2+n.width,N],[n.width,0,N,n.height]]}function ki(n,t,e=0,s=0){if(Bi(n,t),t.size>oe){let i=[];i.push(ae(n,t.x+x.range(-N,N),t.y+x.range(-N,N),x.range(-B,B)+e,x.range(-B,B)+s,oe)),i.push(ae(n,t.x+x.range(-N,N),t.y+x.range(-N,N),x.range(-B,B)+e,x.range(-B,B)+s,oe)),i.push(ae(n,t.x+x.range(-N,N),t.y+x.range(-N,N),x.range(-B,B)+e,x.range(-B,B)+s,oe)),i.push(ae(n,t.x+x.range(-N,N),t.y+x.range(-N,N),x.range(-B,B)+e,x.range(-B,B)+s,oe)),n.asteroids.push(...i)}}function ae(n,t,e,s,i,r){return{scene:n,x:t,y:e,dx:s,dy:i,size:r,rotation:Math.atan2(i,s)}}function Bi(n,t){n.asteroids.splice(n.asteroids.indexOf(t),1)}function $n(n,t){Yt(n,t.x,t.y,10,x.choose.bind(null,Vl))}var Rt=4;var eu=["white","violet","violet"],nu=30,su=.7,Be=new bt("PowerUp",()=>({x:0,y:0,dx:0,dy:0,rotation:0})),zn=new St(Be);function Ui(n){let t=P(n,dt),e=P(n,xt);Et(n,()=>{t.clear(Be),x.next()>su&&e.powerUpSpawner.spawn(e)})}function iu(n,t,e,s,i){return{scene:n,x:t,y:e,dx:s,dy:i,rotation:Math.atan2(i,s)}}function ru(n,t){n.ents.destroy(t)}function $i(n,t){for(let[e,s]of zn.findAll(t.ents))s.x+=s.dx,s.y+=s.dy,wt(t.canvas,s,Rt*2,Rt*2);for(let[e,s]of zn.findAll(t.ents))if(Ft(s,t.player,Rt+lt)){Yt(t,s.x,s.y,10,x.choose.bind(null,eu)),ru(t,e),t.player.powerMode+=nu;break}}function zi(n,t){for(let[e,s]of zn.findAll(t.ents))n.translate(s.x,s.y),n.rotate(s.rotation),n.beginPath(),n.strokeStyle="violet",n.arc(0,0,Rt,0,Math.PI*2),n.moveTo(-Rt/2,0),n.lineTo(Rt/2,0),n.moveTo(0,-Rt/2),n.lineTo(0,Rt/2),n.stroke(),n.setTransform(1,0,0,1,0,0),It(n,s.x,s.y,Rt)}function Ki(n){return{scene:n,reset(){},spawn(t){let e=x.choose(Un(t.display));iu(t,x.range(e[0],e[0]+e[2]),x.range(e[1],e[1]+e[3]),x.range(-B,B),x.range(-B,B))}}}function Fi(n,t,e){}var Kn=Symbol("audioContext"),He=class{static getAudioContext(){if(Kn in this)return this[Kn];{let t=new AudioContext;return ou(t),this[Kn]=t,t}}constructor(t,e){this.audioContext=t,this.audioBuffer=e,this._playing=!1,this._started=!1,this._source=null,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}destroy(){this._source&&this._source.disconnect(),this._source=null,this._started=!1,this._playing=!1}onAudioSourceEnded(){this._playing=!1}play(t={}){let e=this.audioBuffer;if(!e)return;this._source&&this.destroy();let{pitch:s=void 0,gain:i=void 0,pan:r=void 0,loop:o=!1}=t,a=this.audioContext,l=a.createBufferSource();l.addEventListener("ended",this.onAudioSourceEnded),l.buffer=e,l.loop=o;let u=l;if(s&&(l.detune.value=s*100),i){let f=a.createGain();f.gain.value=i,u=u.connect(f)}if(r){let f=a.createStereoPanner();f.pan.value=r,u=u.connect(f)}u.connect(a.destination),l.start(),this._source=l,this._started=!0,this._playing=!0}pause(){this._source.stop(),this._playing=!1}isStarted(){return this._started}isPlaying(){return this._playing}isPaused(){return this._started&&!this._playing}};function ou(n){let t=()=>{n.state==="suspended"&&n.resume()};document.addEventListener("click",t)}async function Tt(n){let t=He.getAudioContext(),e=await _n(n,{audioContext:t});return new He(t,e)}var au="[ wasd_ ]",ji=new ot("game.start",Tt,void 0,"raw://start.wav"),le=new ot("background.music",Tt,void 0,"raw://music.wav"),Fn=new Ct("game.nextlevel");function Et(n,t){Bt(n,Fn,0,t)}function xt(n){let{display:t,canvas:e}=P(n,ht),s=P(n,dt),i=P(n,ie),r=P(n,ue),{ctx:o}=P(n,jn);return jt(n,[ji,le]),this.ents=s,this.assets=i,this.topics=r,this.display=t,this.canvas=e,this.level=0,this.score=0,this.highScore=Number(localStorage.getItem("highscore")),this.flashScore=0,this.flashScoreDelta=0,this.flashHighScore=0,this.flashHighScoreDelta=0,this.flashShootDelta=0,this.dt=0,this.player=null,this.asteroids=[],this.asteroidSpawner=Di(this),this.powerUpSpawner=Ki(this),this.gamePause=!0,this.showPlayer=!0,this.gameStart=!0,this.gameWait=!0,this.hint=au,at(n,({deltaTime:a})=>{this.gamePause||(this.dt=a,$i(a,this),Fi(a,this,this.powerUpSpawner),!this.gamePause&&this.asteroids.length<=0&&(this.gamePause=!0,this.showPlayer=!0,ji.current.play(),setTimeout(()=>this.gameWait=!0,1e3)))}),at(n,()=>{o.isAnyButtonPressed()&&this.gameWait&&(this.gameStart&&(le.current.play(),this.score=0,this.flashScore=1,this.level=0,this.gameStart=!1,this.player.powerMode=0,this.ents.clear(Be),this.asteroidSpawner.reset(),this.powerUpSpawner.reset()),this.gameWait=!1,Yi(this)),this.player.up=Mn.current.value,this.player.down=Ln.current.value,this.player.left=Rn.current.value,this.player.right=Tn.current.value,this.player.fire=In.current.value,On.current.released&&(Ne.showCollision=!Ne.showCollision)}),nt(n,0,a=>{let l=a.canvas;a.fillStyle="black",a.fillRect(0,0,l.width,l.height)}),nt(n,2,a=>{let l=a.canvas;a.fillStyle="rgba(255, 255, 255, 0.2)",a.textAlign="center",a.textBaseline="middle",a.font="16px sans-serif",a.fillText(this.hint,l.width/2,l.height/2-32),this.flashScore>0?(a.fillStyle=`rgba(255, 255, 255, ${this.flashScore+.2})`,this.flashScore-=se):a.fillStyle="rgba(255, 255, 255, 0.2)",a.font="48px sans-serif",a.fillText("= "+String(this.score).padStart(2,"0")+" =",l.width/2,l.height/2),this.flashHighScore>0?(a.fillStyle=`rgba(255, 255, 255, ${this.flashHighScore+.2})`,this.flashHighScore-=se):a.fillStyle="rgba(255, 255, 255, 0.2)",a.font="16px sans-serif",a.fillText(String(this.highScore).padStart(2,"0"),l.width/2,l.height/2+32),a.fillStyle="rgba(255, 255, 255, 0.2)",a.font="24px sans-serif",a.textAlign="right",a.fillText(`${Math.ceil(this.asteroidSpawner.spawnTicks/1e3)}`,l.width,l.height-12),zi(a,this)}),nt(n,11,a=>{It(a,this.player.x,this.player.y,lt)}),this}var lu=5,he=4,qi=100,Ht=2,uu="gold",hu=2e3,Wi=new ot("bullet.pop",Tt,void 0,"raw://boop.wav"),Ue=new bt("Bullet",()=>({x:0,y:0,dx:0,dy:0,rotation:0,age:0})),Yn=new St(Ue);function Gi(n){let t=P(n,dt),{canvas:e}=P(n,ht),s=P(n,xt);jt(n,[Wi]),Et(n,()=>{t.clear(Ue)}),at(n,({deltaTime:i})=>{cu(i,s,e,t)}),nt(n,lu,i=>{fu(i,t)})}function cu(n,t,e,s){if(!t.gamePause){for(let[i,r]of Yn.findAll(s))r.age+=n,r.age>hu?s.destroy(i):(r.x+=r.dx,r.y+=r.dy,wt(e,r,Ht*2,Ht*2));for(let[i,r]of Yn.findAll(s))for(let o of t.asteroids)if(Ft(r,o,o.size)){t.flashScore=1,t.score++,t.score>t.highScore&&(t.flashHighScore=t.score-t.highScore,t.highScore=t.score,localStorage.setItem("highscore",`${t.highScore}`)),$n(t,o),Wi.current.play(),s.destroy(i),ki(t,o,r.dx*Hn,r.dy*Hn);break}}}function fu(n,t){for(let[e,s]of Yn.findAll(t))n.translate(s.x,s.y),n.rotate(s.rotation),n.fillStyle=uu,n.fillRect(-Ht,-Ht,Ht*4,Ht*2),n.setTransform(1,0,0,1,0,0),It(n,s.x,s.y,Ht)}function qn(n,t,e,s,i){let r=n.ents.create(),o=n.ents.attach(r,Ue);return o.x=t,o.y=e,o.dx=s,o.dy=i,o.rotation=Math.atan2(i,s),o.age=0,r}function Xi(n){return n.ents.count(Ue)}var Vi=new ot("player.dead",Tt,void 0,"raw://dead.wav"),Qi=new ot("player.boom",Tt,void 0,"raw://boom.wav"),Zi=new ot("player.shoot",Tt,void 0,"raw://click.wav"),lt=5,$e=[-2,2],pu=.1,du=.4,mu=["red","red","red","yellow","orange"],gu=["gray","darkgray","lightgray"],Ji=10,tr=1.5,er=.02,vu=.008,yu=.1,nr=.001,wu=10,sr=new bt("Player",()=>({x:0,y:0,rotation:0,dx:0,dy:0,dr:0,left:0,right:0,up:0,down:0,fire:0,cooldown:0,powerMode:0})),ir=new St(sr);function rr(n){let{canvas:t}=P(n,ht),e=P(n,dt),s=P(n,xt);jt(n,[Qi,Vi,Zi]);let i=Eu(t,e);return s.player=i,Et(n,()=>{i.x=t.width/2,i.y=t.height/2,i.dx=0,i.dy=0}),at(n,({deltaTime:r})=>{s.gamePause||xu(r,s)}),nt(n,wu,r=>{!s.showPlayer||Au(r,s)}),i}function Eu(n,t){let e=t.create(),s=t.attach(e,sr);return s.x=n.width/2,s.y=n.height/2,s}function xu(n,t){let[e,s]=ir.findAny(t.ents);if(!s)return;let i=s.right-s.left,r=s.down-s.up,o=s.fire;s.dx+=r*Math.cos(s.rotation)*er,s.dy+=r*Math.sin(s.rotation)*er,s.dx*=1-nr,s.dy*=1-nr,s.dr+=i*vu,s.dr*=1-yu,s.x+=s.dx,s.y+=s.dy,s.rotation+=s.dr,--s.cooldown,wt(t.canvas,s,lt*2,lt*2),o&&(_u(t,s),t.flashShootDelta=1),r&&bu(t,s.x,s.y,-r*Math.cos(s.rotation)*tr,-r*Math.sin(s.rotation)*tr,x.choose.bind(null,gu))}function Au(n,t){let[e,s]=ir.findAny(t.ents);if(!s)return;n.translate(s.x,s.y),n.rotate(s.rotation),n.fillStyle="white";let i=lt;n.fillRect(-i,-i,i*2,i*2);let r=-1,o=0,a=0;t.flashShootDelta>0?(n.fillStyle=`rgb(${200*t.flashShootDelta+55*Math.sin(performance.now()/(Ji*2))}, 0, 0)`,t.flashShootDelta-=se,a=t.flashShootDelta*2,r=t.flashShootDelta):n.fillStyle="black",n.fillRect(-i-a/2+r,-(i/4)-a/2+o,i+a,i/2+a),n.setTransform(1,0,0,1,0,0)}function _u(n,t){if(!(Xi(n)>qi)&&!(t.cooldown>0)){if(t.powerMode>0){for(let e=-1;e<=1;++e){let s=t.rotation+e*Math.PI/4;qn(n,t.x-Math.cos(s)*lt,t.y-Math.sin(s)*lt,-Math.cos(s)*he+t.dx,-Math.sin(s)*he+t.dy)}--t.powerMode}else qn(n,t.x-Math.cos(t.rotation)*lt,t.y-Math.sin(t.rotation)*lt,-Math.cos(t.rotation)*he+t.dx,-Math.sin(t.rotation)*he+t.dy);t.cooldown=Ji,Zi.get(n.assets).play()}}function Hi(n,t){n.gamePause=!0,n.showPlayer=!1,Yt(n,t.x,t.y,100,x.choose.bind(null,mu)),Vi.get(n.assets).play(),Qi.get(n.assets).play(),setTimeout(()=>n.gameStart=n.gameWait=!0,1e3)}function bu(n,t,e,s,i,r){x.next()>.3&&De(n,t+x.range($e[0],$e[1]),e+x.range($e[0],$e[1]),s,i,r,x.range(re*pu,re*du))}var or=[2,4],ar=[.3,1],Su=30,Cu=1;function lr(n){let{canvas:t}=P(n,ht),e=Ru(t.width,t.height);at(n,()=>{Mu(e)}),nt(n,Cu,s=>{Tu(s,e)})}function Ru(n,t){let e={x:[],y:[],size:[],speed:[],length:0,width:n,height:t};for(let s=0;s<Su;++s)e.x.push(x.range(0,n)),e.y.push(x.range(0,t)),e.size.push(x.range(or[0],or[1])),e.speed.push(x.range(ar[0],ar[1])),e.length++;return e}function Tu(n,t,e="white"){for(let s=0;s<t.length;++s){let i=t.x[s],r=t.y[s],o=t.size[s],a=o/2;n.fillStyle=e,n.fillRect(i-a,r-a,o,o)}}function Mu(n,t=1,e=0){let{length:s,width:i,height:r}=n;for(let o=0;o<s;++o){let a=t*n.speed[o],l=e*n.speed[o];n.x[o]+=a,n.y[o]+=l,a<0?n.x[o]<0&&(n.x[o]=i,n.y[o]=x.range(0,r)):a>0&&n.x[o]>i&&(n.x[o]=0,n.y[o]=x.range(0,r)),l<0?n.y[o]<0&&(n.x[o]=x.range(0,i),n.y[o]=r):l>0&&n.y[o]>r&&(n.x[o]=x.range(0,i),n.y[o]=0)}}var Wn=class{constructor(){this.before=[],this.after=[],this.started=!1}attachEffect(t){if(this.started)throw new Error("Cannot attach effect when already started.");return this.before.push(t),this}attachAfterEffect(t){if(this.started)throw new Error("Cannot attach effect when already started.");return this.after.push(t),this}async startEffects(){if(this.started)throw new Error("Cannot start effects already started.");this.started=!0;let t=this.before.slice();this.before.length=0,this.after.push(...await Promise.all(t.map(e=>e&&e())))}async stopEffects(){if(!this.started)throw new Error("Cannot stop effects not yet started.");this.started=!1;let t=this.after.slice().reverse();this.after.length=0,await Promise.all(t.map(e=>e&&e()))}};var Ot=class{static async initializeContext(t){try{t.state=await t.initCallback.call({},t)}catch(e){throw new Error(`Failed to initialize system context '${t.name}' with dependencies [${t.dependencies.map(s=>s.name).join(", ")}].

${e}`,{cause:e})}return t.dependencies}static async initializeEffects(t){await t.effects.startEffects()}static markDead(t){t.dead=!0}static async terminateEffects(t){await t.effects.stopEffects()}static async terminateContext(t){await t.deadCallback(t.state),t.state=null}constructor(t,e,s,i){this.name=e,this.state=null,this.parent=t,this.effects=new Wn,this.dead=!1,this.dependencies=[],this.initCallback=s,this.deadCallback=i}before(t){this.effects.attachEffect(t)}after(t){this.effects.attachAfterEffect(t)}use(t){if(this.effects.started)throw new Error("use() must be called during initialization only.");return this.dependencies.indexOf(t)<0&&this.dependencies.push(t),this.parent.getState(t)}isDead(){return this.dead}};function ur(n){return Lu("Must be non-null!",typeof n!="undefined"&&n!==null,n)}function Lu(n,t,e){if(!t)throw new Error(`Assertion failed - ${n} But found ${e}.`);return e}var Gn=class{constructor(){this.pendingSystems=[],this.activeSystems=[]}register(t,e=void 0,s=void 0){ur(t);let i;if(typeof t=="function")i=t.name;else if(typeof t=="object"){let o=t;if("name"in o)i=o.name;else throw new Error("Invalid handle for system - missing name.")}else i=t;e||(typeof t=="function"?e=t:e=()=>{}),s||(s=()=>{});let r=new Ot(this,i,e,s);return this.pendingSystems.push(r),this}unregister(t){let e=this.pendingSystems.findIndex(s=>s.name===t);return e>=0&&this.pendingSystems.splice(e,1),this}async start(){let t=this.pendingSystems.slice();this.pendingSystems.length=0;for(let e of t)this.activeSystems.push(e),await Ot.initializeContext(e);for(let e of t)await Ot.initializeEffects(e);return this}async stop(){let t=this.activeSystems.slice().reverse();t.forEach(Ot.markDead);for(let e of t)await Ot.terminateEffects(e);for(let e of t){await Ot.terminateContext(e);let s=this.activeSystems.indexOf(e);s>=0&&this.activeSystems.splice(s,1)}return this}getState(t){let e=this.activeSystems.find(s=>s.name===t.name);return e?e.state:null}};async function hr(){let n=new Gn;n.register(Ou).register(ht).register(jn).register(dt,void 0,t=>t.reset()).register(ie).register(ue,void 0,t=>t.reset()).register(xt).register(lr).register(Pi).register(rr).register(Gi).register(Ui).register(Ni),await n.start()}function Yi(n){n.level++,n.gamePause=!1,n.showPlayer=!0,Fn.dispatch(n.topics,n.level),le.current.isPlaying()||le.current.play({loop:!0})}var cr=new Ct("update.early"),Xn=new Ct("update"),Iu=new Ct("update.late"),fr=new Ct("draw");function Ou(n){let t=P(n,ue);Bt(n,pr,0,e=>{cr.dispatch(t,e.detail),Xn.dispatch(t,e.detail),fr.dispatch(t,n.getState(ht).ctx),Iu.dispatch(t,e.detail)})}var pr=new Ct("system.update");function ue(n){let t=new Cn;return Ii(n,()=>{let e=new Pe(s=>{pr.dispatch(t,s),t.flush()});return e.start(),()=>{e.cancel()}}),t}async function ie(n){let t=new An;return await mi(t,"res.pack"),t}function jn(n){let t=document.querySelector("#inputs"),e=t.getContext("axisbutton");return e.bindKeys(Pn),Bt(n,cr,0,({currentTime:s})=>{e.poll(s)}),{inputs:t,ctx:e}}function ht(){let n=document.querySelector("#display"),t=n.canvas,e=t.getContext("2d");return{display:n,canvas:t,ctx:e}}function dt(n){let t=new Sn;return Bt(n,Xn,0,()=>t.flush()),t}function at(n,t){Bt(n,Xn,0,t)}function nt(n,t,e){Bt(n,fr,t,e)}function Bt(n,t,e,s){let i=P(n,ue);n.before(()=>(t.on(i,e,s),()=>{t.off(i,s)}))}Wt.define();window.addEventListener("DOMContentLoaded",hr);})();
//# sourceMappingURL=main.js.map
