(()=>{var ei=Object.create,Rt=Object.defineProperty,ni=Object.getPrototypeOf,ii=Object.prototype.hasOwnProperty,si=Object.getOwnPropertyNames,ri=Object.getOwnPropertyDescriptor;var oi=n=>Rt(n,"__esModule",{value:!0});var ai=(n,t)=>()=>(n&&(t=n(n=0)),t),pt=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),li=(n,t)=>{for(var e in t)Rt(n,e,{get:t[e],enumerable:!0})},ui=(n,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of si(t))!ii.call(n,i)&&i!=="default"&&Rt(n,i,{get:()=>t[i],enumerable:!(e=ri(t,i))||e.enumerable});return n},hi=n=>ui(oi(Rt(n!=null?ei(ni(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var tn={};li(tn,{basename:()=>ln,default:()=>Ui,delimiter:()=>on,dirname:()=>an,extname:()=>un,isAbsolute:()=>he,join:()=>nn,normalize:()=>ce,relative:()=>sn,resolve:()=>kt,sep:()=>rn});function en(n,t){for(var e=0,i=n.length-1;i>=0;i--){var s=n[i];s==="."?n.splice(i,1):s===".."?(n.splice(i,1),e++):e&&(n.splice(i,1),e--)}if(t)for(;e--;e)n.unshift("..");return n}function kt(){for(var n="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var i=e>=0?arguments[e]:"/";if(typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!i)continue;n=i+"/"+n,t=i.charAt(0)==="/"}return n=en(ue(n.split("/"),function(s){return!!s}),!t).join("/"),(t?"/":"")+n||"."}function ce(n){var t=he(n),e=Pi(n,-1)==="/";return n=en(ue(n.split("/"),function(i){return!!i}),!t).join("/"),!n&&!t&&(n="."),n&&e&&(n+="/"),(t?"/":"")+n}function he(n){return n.charAt(0)==="/"}function nn(){var n=Array.prototype.slice.call(arguments,0);return ce(ue(n,function(t,e){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function sn(n,t){n=kt(n).substr(1),t=kt(t).substr(1);function e(f){for(var p=0;p<f.length&&f[p]==="";p++);for(var E=f.length-1;E>=0&&f[E]==="";E--);return p>E?[]:f.slice(p,E-p+1)}for(var i=e(n.split("/")),s=e(t.split("/")),r=Math.min(i.length,s.length),o=r,h=0;h<r;h++)if(i[h]!==s[h]){o=h;break}for(var l=[],h=o;h<i.length;h++)l.push("..");return l=l.concat(s.slice(o)),l.join("/")}function an(n){var t=le(n),e=t[0],i=t[1];return!e&&!i?".":(i&&(i=i.substr(0,i.length-1)),e+i)}function ln(n,t){var e=le(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function un(n){return le(n)[3]}function ue(n,t){if(n.filter)return n.filter(t);for(var e=[],i=0;i<n.length;i++)t(n[i],i,n)&&e.push(n[i]);return e}var $i,le,rn,on,Ui,Pi,hn=ai(()=>{$i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,le=function(n){return $i.exec(n).slice(1)};rn="/",on=":";Ui={extname:un,basename:ln,dirname:an,sep:rn,delimiter:on,relative:sn,join:nn,isAbsolute:he,normalize:ce,resolve:kt};Pi="ab".substr(-1)==="b"?function(n,t,e){return n.substr(t,e)}:function(n,t,e){return t<0&&(t=n.length+t),n.substr(t,e)}});var Ht=pt((vo,Bt)=>{var ct=(hn(),tn);ct&&ct.default?Bt.exports=ct.default:ct&&(Bt.exports=ct);if(ct)for(let n in ct)Bt.exports[n]=ct[n]});var bt=pt((go,cn)=>{"use strict";var Fi=Ht(),ot="\\\\/",fn=`[^${ot}]`,ut="\\.",zi="\\+",Gi="\\?",Dt="\\/",Yi="(?=.)",pn="[^/]",fe=`(?:${Dt}|$)`,dn=`(?:^|${Dt})`,pe=`${ut}{1,2}${fe}`,Wi=`(?!${ut})`,ji=`(?!${dn}${pe})`,qi=`(?!${ut}{0,1}${fe})`,Xi=`(?!${pe})`,Zi=`[^.${Dt}]`,Qi=`${pn}*?`,vn={DOT_LITERAL:ut,PLUS_LITERAL:zi,QMARK_LITERAL:Gi,SLASH_LITERAL:Dt,ONE_CHAR:Yi,QMARK:pn,END_ANCHOR:fe,DOTS_SLASH:pe,NO_DOT:Wi,NO_DOTS:ji,NO_DOT_SLASH:qi,NO_DOTS_SLASH:Xi,QMARK_NO_DOT:Zi,STAR:Qi,START_ANCHOR:dn},Vi={...vn,SLASH_LITERAL:`[${ot}]`,QMARK:fn,STAR:`${fn}*?`,DOTS_SLASH:`${ut}{1,2}(?:[${ot}]|$)`,NO_DOT:`(?!${ut})`,NO_DOTS:`(?!(?:^|[${ot}])${ut}{1,2}(?:[${ot}]|$))`,NO_DOT_SLASH:`(?!${ut}{0,1}(?:[${ot}]|$))`,NO_DOTS_SLASH:`(?!${ut}{1,2}(?:[${ot}]|$))`,QMARK_NO_DOT:`[^.${ot}]`,START_ANCHOR:`(?:^|[${ot}])`,END_ANCHOR:`(?:[${ot}]|$)`},Ji={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};cn.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Ji,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Fi.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?Vi:vn}}});var Nt=pt(Z=>{"use strict";var ts=Ht(),es=!1,{REGEX_BACKSLASH:ns,REGEX_REMOVE_BACKSLASH:is,REGEX_SPECIAL_CHARS:ss,REGEX_SPECIAL_CHARS_GLOBAL:rs}=bt();Z.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);Z.hasRegexChars=n=>ss.test(n);Z.isRegexChar=n=>n.length===1&&Z.hasRegexChars(n);Z.escapeRegex=n=>n.replace(rs,"\\$1");Z.toPosixSlashes=n=>n.replace(ns,"/");Z.removeBackslashes=n=>n.replace(is,t=>t==="\\"?"":t);Z.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};Z.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:es===!0||ts.sep==="\\";Z.escapeLast=(n,t,e)=>{let i=n.lastIndexOf(t,e);return i===-1?n:n[i-1]==="\\"?Z.escapeLast(n,t,i-1):`${n.slice(0,i)}\\${n.slice(i)}`};Z.removePrefix=(n,t={})=>{let e=n;return e.startsWith("./")&&(e=e.slice(2),t.prefix="./"),e};Z.wrapOutput=(n,t={},e={})=>{let i=e.contains?"":"^",s=e.contains?"":"$",r=`${i}(?:${n})${s}`;return t.negated===!0&&(r=`(?:^(?!${r}).*$)`),r}});var An=pt((yo,gn)=>{"use strict";var mn=Nt(),{CHAR_ASTERISK:de,CHAR_AT:os,CHAR_BACKWARD_SLASH:At,CHAR_COMMA:as,CHAR_DOT:ve,CHAR_EXCLAMATION_MARK:ge,CHAR_FORWARD_SLASH:yn,CHAR_LEFT_CURLY_BRACE:me,CHAR_LEFT_PARENTHESES:ye,CHAR_LEFT_SQUARE_BRACKET:ls,CHAR_PLUS:us,CHAR_QUESTION_MARK:En,CHAR_RIGHT_CURLY_BRACE:hs,CHAR_RIGHT_PARENTHESES:_n,CHAR_RIGHT_SQUARE_BRACKET:cs}=bt(),wn=n=>n===yn||n===At,bn=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},fs=(n,t)=>{let e=t||{},i=n.length-1,s=e.parts===!0||e.scanToEnd===!0,r=[],o=[],h=[],l=n,f=-1,p=0,E=0,_=!1,C=!1,x=!1,S=!1,H=!1,Y=!1,U=!1,L=!1,P=!1,O=!1,F=0,B,m,T={value:"",depth:0,isGlob:!1},K=()=>f>=i,c=()=>l.charCodeAt(f+1),I=()=>(B=m,l.charCodeAt(++f));for(;f<i;){m=I();let z;if(m===At){U=T.backslashes=!0,m=I(),m===me&&(Y=!0);continue}if(Y===!0||m===me){for(F++;K()!==!0&&(m=I());){if(m===At){U=T.backslashes=!0,I();continue}if(m===me){F++;continue}if(Y!==!0&&m===ve&&(m=I())===ve){if(_=T.isBrace=!0,x=T.isGlob=!0,O=!0,s===!0)continue;break}if(Y!==!0&&m===as){if(_=T.isBrace=!0,x=T.isGlob=!0,O=!0,s===!0)continue;break}if(m===hs&&(F--,F===0)){Y=!1,_=T.isBrace=!0,O=!0;break}}if(s===!0)continue;break}if(m===yn){if(r.push(f),o.push(T),T={value:"",depth:0,isGlob:!1},O===!0)continue;if(B===ve&&f===p+1){p+=2;continue}E=f+1;continue}if(e.noext!==!0&&(m===us||m===os||m===de||m===En||m===ge)===!0&&c()===ye){if(x=T.isGlob=!0,S=T.isExtglob=!0,O=!0,m===ge&&f===p&&(P=!0),s===!0){for(;K()!==!0&&(m=I());){if(m===At){U=T.backslashes=!0,m=I();continue}if(m===_n){x=T.isGlob=!0,O=!0;break}}continue}break}if(m===de){if(B===de&&(H=T.isGlobstar=!0),x=T.isGlob=!0,O=!0,s===!0)continue;break}if(m===En){if(x=T.isGlob=!0,O=!0,s===!0)continue;break}if(m===ls){for(;K()!==!0&&(z=I());){if(z===At){U=T.backslashes=!0,I();continue}if(z===cs){C=T.isBracket=!0,x=T.isGlob=!0,O=!0;break}}if(s===!0)continue;break}if(e.nonegate!==!0&&m===ge&&f===p){L=T.negated=!0,p++;continue}if(e.noparen!==!0&&m===ye){if(x=T.isGlob=!0,s===!0){for(;K()!==!0&&(m=I());){if(m===ye){U=T.backslashes=!0,m=I();continue}if(m===_n){O=!0;break}}continue}break}if(x===!0){if(O=!0,s===!0)continue;break}}e.noext===!0&&(S=!1,x=!1);let R=l,Q="",u="";p>0&&(Q=l.slice(0,p),l=l.slice(p),E-=p),R&&x===!0&&E>0?(R=l.slice(0,E),u=l.slice(E)):x===!0?(R="",u=l):R=l,R&&R!==""&&R!=="/"&&R!==l&&wn(R.charCodeAt(R.length-1))&&(R=R.slice(0,-1)),e.unescape===!0&&(u&&(u=mn.removeBackslashes(u)),R&&U===!0&&(R=mn.removeBackslashes(R)));let a={prefix:Q,input:n,start:p,base:R,glob:u,isBrace:_,isBracket:C,isGlob:x,isExtglob:S,isGlobstar:H,negated:L,negatedExtglob:P};if(e.tokens===!0&&(a.maxDepth=0,wn(m)||o.push(T),a.tokens=o),e.parts===!0||e.tokens===!0){let z;for(let A=0;A<r.length;A++){let X=z?z+1:p,G=r[A],W=n.slice(X,G);e.tokens&&(A===0&&p!==0?(o[A].isPrefix=!0,o[A].value=Q):o[A].value=W,bn(o[A]),a.maxDepth+=o[A].depth),(A!==0||W!=="")&&h.push(W),z=G}if(z&&z+1<n.length){let A=n.slice(z+1);h.push(A),e.tokens&&(o[o.length-1].value=A,bn(o[o.length-1]),a.maxDepth+=o[o.length-1].depth)}a.slashes=r,a.parts=h}return a};gn.exports=fs});var Sn=pt((Eo,xn)=>{"use strict";var Kt=bt(),V=Nt(),{MAX_LENGTH:$t,POSIX_REGEX_SOURCE:ps,REGEX_NON_SPECIAL_CHARS:ds,REGEX_SPECIAL_CHARS_BACKREF:vs,REPLACEMENTS:Tn}=Kt,gs=(n,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...n,t);n.sort();let e=`[${n.join("-")}]`;try{new RegExp(e)}catch(i){return n.map(s=>V.escapeRegex(s)).join("..")}return e},mt=(n,t)=>`Missing ${n}: "${t}" - use "\\\\${t}" to match literal characters`,Rn=(n,t)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=Tn[n]||n;let e={...t},i=typeof e.maxLength=="number"?Math.min($t,e.maxLength):$t,s=n.length;if(s>i)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${i}`);let r={type:"bos",value:"",output:e.prepend||""},o=[r],h=e.capture?"":"?:",l=V.isWindows(t),f=Kt.globChars(l),p=Kt.extglobChars(f),{DOT_LITERAL:E,PLUS_LITERAL:_,SLASH_LITERAL:C,ONE_CHAR:x,DOTS_SLASH:S,NO_DOT:H,NO_DOT_SLASH:Y,NO_DOTS_SLASH:U,QMARK:L,QMARK_NO_DOT:P,STAR:O,START_ANCHOR:F}=f,B=g=>`(${h}(?:(?!${F}${g.dot?S:E}).)*?)`,m=e.dot?"":H,T=e.dot?L:P,K=e.bash===!0?B(e):O;e.capture&&(K=`(${K})`),typeof e.noext=="boolean"&&(e.noextglob=e.noext);let c={input:n,index:-1,start:0,dot:e.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=V.removePrefix(n,c),s=n.length;let I=[],R=[],Q=[],u=r,a,z=()=>c.index===s-1,A=c.peek=(g=1)=>n[c.index+g],X=c.advance=()=>n[++c.index]||"",G=()=>n.slice(c.index+1),W=(g="",M=0)=>{c.consumed+=g,c.index+=M},et=g=>{c.output+=g.output!=null?g.output:g.value,W(g.value)},yt=()=>{let g=1;for(;A()==="!"&&(A(2)!=="("||A(3)==="?");)X(),c.start++,g++;return g%2==0?!1:(c.negated=!0,c.start++,!0)},ht=g=>{c[g]++,Q.push(g)},nt=g=>{c[g]--,Q.pop()},w=g=>{if(u.type==="globstar"){let M=c.braces>0&&(g.type==="comma"||g.type==="brace"),d=g.extglob===!0||I.length&&(g.type==="pipe"||g.type==="paren");g.type!=="slash"&&g.type!=="paren"&&!M&&!d&&(c.output=c.output.slice(0,-u.output.length),u.type="star",u.value="*",u.output=K,c.output+=u.output)}if(I.length&&g.type!=="paren"&&(I[I.length-1].inner+=g.value),(g.value||g.output)&&et(g),u&&u.type==="text"&&g.type==="text"){u.value+=g.value,u.output=(u.output||"")+g.value;return}g.prev=u,o.push(g),u=g},ft=(g,M)=>{let d={...p[M],conditions:1,inner:""};d.prev=u,d.parens=c.parens,d.output=c.output;let b=(e.capture?"(":"")+d.open;ht("parens"),w({type:g,value:M,output:c.output?"":x}),w({type:"paren",extglob:!0,value:X(),output:b}),I.push(d)},xt=g=>{let M=g.close+(e.capture?")":""),d;if(g.type==="negate"){let b=K;g.inner&&g.inner.length>1&&g.inner.includes("/")&&(b=B(e)),(b!==K||z()||/^\)+$/.test(G()))&&(M=g.close=`)$))${b}`),g.inner.includes("*")&&(d=G())&&/^\.[^\\/.]+$/.test(d)&&(M=g.close=`)${d})${b})`),g.prev.type==="bos"&&(c.negatedExtglob=!0)}w({type:"paren",extglob:!0,value:a,output:M}),nt("parens")};if(e.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let g=!1,M=n.replace(vs,(d,b,D,q,$,Gt)=>q==="\\"?(g=!0,d):q==="?"?b?b+q+($?L.repeat($.length):""):Gt===0?T+($?L.repeat($.length):""):L.repeat(D.length):q==="."?E.repeat(D.length):q==="*"?b?b+q+($?K:""):K:b?d:`\\${d}`);return g===!0&&(e.unescape===!0?M=M.replace(/\\/g,""):M=M.replace(/\\+/g,d=>d.length%2==0?"\\\\":d?"\\":"")),M===n&&e.contains===!0?(c.output=n,c):(c.output=V.wrapOutput(M,c,t),c)}for(;!z();){if(a=X(),a==="\0")continue;if(a==="\\"){let d=A();if(d==="/"&&e.bash!==!0||d==="."||d===";")continue;if(!d){a+="\\",w({type:"text",value:a});continue}let b=/^\\+/.exec(G()),D=0;if(b&&b[0].length>2&&(D=b[0].length,c.index+=D,D%2!=0&&(a+="\\")),e.unescape===!0?a=X():a+=X(),c.brackets===0){w({type:"text",value:a});continue}}if(c.brackets>0&&(a!=="]"||u.value==="["||u.value==="[^")){if(e.posix!==!1&&a===":"){let d=u.value.slice(1);if(d.includes("[")&&(u.posix=!0,d.includes(":"))){let b=u.value.lastIndexOf("["),D=u.value.slice(0,b),q=u.value.slice(b+2),$=ps[q];if($){u.value=D+$,c.backtrack=!0,X(),!r.output&&o.indexOf(u)===1&&(r.output=x);continue}}}(a==="["&&A()!==":"||a==="-"&&A()==="]")&&(a=`\\${a}`),a==="]"&&(u.value==="["||u.value==="[^")&&(a=`\\${a}`),e.posix===!0&&a==="!"&&u.value==="["&&(a="^"),u.value+=a,et({value:a});continue}if(c.quotes===1&&a!=='"'){a=V.escapeRegex(a),u.value+=a,et({value:a});continue}if(a==='"'){c.quotes=c.quotes===1?0:1,e.keepQuotes===!0&&w({type:"text",value:a});continue}if(a==="("){ht("parens"),w({type:"paren",value:a});continue}if(a===")"){if(c.parens===0&&e.strictBrackets===!0)throw new SyntaxError(mt("opening","("));let d=I[I.length-1];if(d&&c.parens===d.parens+1){xt(I.pop());continue}w({type:"paren",value:a,output:c.parens?")":"\\)"}),nt("parens");continue}if(a==="["){if(e.nobracket===!0||!G().includes("]")){if(e.nobracket!==!0&&e.strictBrackets===!0)throw new SyntaxError(mt("closing","]"));a=`\\${a}`}else ht("brackets");w({type:"bracket",value:a});continue}if(a==="]"){if(e.nobracket===!0||u&&u.type==="bracket"&&u.value.length===1){w({type:"text",value:a,output:`\\${a}`});continue}if(c.brackets===0){if(e.strictBrackets===!0)throw new SyntaxError(mt("opening","["));w({type:"text",value:a,output:`\\${a}`});continue}nt("brackets");let d=u.value.slice(1);if(u.posix!==!0&&d[0]==="^"&&!d.includes("/")&&(a=`/${a}`),u.value+=a,et({value:a}),e.literalBrackets===!1||V.hasRegexChars(d))continue;let b=V.escapeRegex(u.value);if(c.output=c.output.slice(0,-u.value.length),e.literalBrackets===!0){c.output+=b,u.value=b;continue}u.value=`(${h}${b}|${u.value})`,c.output+=u.value;continue}if(a==="{"&&e.nobrace!==!0){ht("braces");let d={type:"brace",value:a,output:"(",outputIndex:c.output.length,tokensIndex:c.tokens.length};R.push(d),w(d);continue}if(a==="}"){let d=R[R.length-1];if(e.nobrace===!0||!d){w({type:"text",value:a,output:a});continue}let b=")";if(d.dots===!0){let D=o.slice(),q=[];for(let $=D.length-1;$>=0&&(o.pop(),D[$].type!=="brace");$--)D[$].type!=="dots"&&q.unshift(D[$].value);b=gs(q,e),c.backtrack=!0}if(d.comma!==!0&&d.dots!==!0){let D=c.output.slice(0,d.outputIndex),q=c.tokens.slice(d.tokensIndex);d.value=d.output="\\{",a=b="\\}",c.output=D;for(let $ of q)c.output+=$.output||$.value}w({type:"brace",value:a,output:b}),nt("braces"),R.pop();continue}if(a==="|"){I.length>0&&I[I.length-1].conditions++,w({type:"text",value:a});continue}if(a===","){let d=a,b=R[R.length-1];b&&Q[Q.length-1]==="braces"&&(b.comma=!0,d="|"),w({type:"comma",value:a,output:d});continue}if(a==="/"){if(u.type==="dot"&&c.index===c.start+1){c.start=c.index+1,c.consumed="",c.output="",o.pop(),u=r;continue}w({type:"slash",value:a,output:C});continue}if(a==="."){if(c.braces>0&&u.type==="dot"){u.value==="."&&(u.output=E);let d=R[R.length-1];u.type="dots",u.output+=a,u.value+=a,d.dots=!0;continue}if(c.braces+c.parens===0&&u.type!=="bos"&&u.type!=="slash"){w({type:"text",value:a,output:E});continue}w({type:"dot",value:a,output:E});continue}if(a==="?"){if(!(u&&u.value==="(")&&e.noextglob!==!0&&A()==="("&&A(2)!=="?"){ft("qmark",a);continue}if(u&&u.type==="paren"){let b=A(),D=a;if(b==="<"&&!V.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(u.value==="("&&!/[!=<:]/.test(b)||b==="<"&&!/<([!=]|\w+>)/.test(G()))&&(D=`\\${a}`),w({type:"text",value:a,output:D});continue}if(e.dot!==!0&&(u.type==="slash"||u.type==="bos")){w({type:"qmark",value:a,output:P});continue}w({type:"qmark",value:a,output:L});continue}if(a==="!"){if(e.noextglob!==!0&&A()==="("&&(A(2)!=="?"||!/[!=<:]/.test(A(3)))){ft("negate",a);continue}if(e.nonegate!==!0&&c.index===0){yt();continue}}if(a==="+"){if(e.noextglob!==!0&&A()==="("&&A(2)!=="?"){ft("plus",a);continue}if(u&&u.value==="("||e.regex===!1){w({type:"plus",value:a,output:_});continue}if(u&&(u.type==="bracket"||u.type==="paren"||u.type==="brace")||c.parens>0){w({type:"plus",value:a});continue}w({type:"plus",value:_});continue}if(a==="@"){if(e.noextglob!==!0&&A()==="("&&A(2)!=="?"){w({type:"at",extglob:!0,value:a,output:""});continue}w({type:"text",value:a});continue}if(a!=="*"){(a==="$"||a==="^")&&(a=`\\${a}`);let d=ds.exec(G());d&&(a+=d[0],c.index+=d[0].length),w({type:"text",value:a});continue}if(u&&(u.type==="globstar"||u.star===!0)){u.type="star",u.star=!0,u.value+=a,u.output=K,c.backtrack=!0,c.globstar=!0,W(a);continue}let g=G();if(e.noextglob!==!0&&/^\([^?]/.test(g)){ft("star",a);continue}if(u.type==="star"){if(e.noglobstar===!0){W(a);continue}let d=u.prev,b=d.prev,D=d.type==="slash"||d.type==="bos",q=b&&(b.type==="star"||b.type==="globstar");if(e.bash===!0&&(!D||g[0]&&g[0]!=="/")){w({type:"star",value:a,output:""});continue}let $=c.braces>0&&(d.type==="comma"||d.type==="brace"),Gt=I.length&&(d.type==="pipe"||d.type==="paren");if(!D&&d.type!=="paren"&&!$&&!Gt){w({type:"star",value:a,output:""});continue}for(;g.slice(0,3)==="/**";){let Tt=n[c.index+4];if(Tt&&Tt!=="/")break;g=g.slice(3),W("/**",3)}if(d.type==="bos"&&z()){u.type="globstar",u.value+=a,u.output=B(e),c.output=u.output,c.globstar=!0,W(a);continue}if(d.type==="slash"&&d.prev.type!=="bos"&&!q&&z()){c.output=c.output.slice(0,-(d.output+u.output).length),d.output=`(?:${d.output}`,u.type="globstar",u.output=B(e)+(e.strictSlashes?")":"|$)"),u.value+=a,c.globstar=!0,c.output+=d.output+u.output,W(a);continue}if(d.type==="slash"&&d.prev.type!=="bos"&&g[0]==="/"){let Tt=g[1]!==void 0?"|$":"";c.output=c.output.slice(0,-(d.output+u.output).length),d.output=`(?:${d.output}`,u.type="globstar",u.output=`${B(e)}${C}|${C}${Tt})`,u.value+=a,c.output+=d.output+u.output,c.globstar=!0,W(a+X()),w({type:"slash",value:"/",output:""});continue}if(d.type==="bos"&&g[0]==="/"){u.type="globstar",u.value+=a,u.output=`(?:^|${C}|${B(e)}${C})`,c.output=u.output,c.globstar=!0,W(a+X()),w({type:"slash",value:"/",output:""});continue}c.output=c.output.slice(0,-u.output.length),u.type="globstar",u.output=B(e),u.value+=a,c.output+=u.output,c.globstar=!0,W(a);continue}let M={type:"star",value:a,output:K};if(e.bash===!0){M.output=".*?",(u.type==="bos"||u.type==="slash")&&(M.output=m+M.output),w(M);continue}if(u&&(u.type==="bracket"||u.type==="paren")&&e.regex===!0){M.output=a,w(M);continue}(c.index===c.start||u.type==="slash"||u.type==="dot")&&(u.type==="dot"?(c.output+=Y,u.output+=Y):e.dot===!0?(c.output+=U,u.output+=U):(c.output+=m,u.output+=m),A()!=="*"&&(c.output+=x,u.output+=x)),w(M)}for(;c.brackets>0;){if(e.strictBrackets===!0)throw new SyntaxError(mt("closing","]"));c.output=V.escapeLast(c.output,"["),nt("brackets")}for(;c.parens>0;){if(e.strictBrackets===!0)throw new SyntaxError(mt("closing",")"));c.output=V.escapeLast(c.output,"("),nt("parens")}for(;c.braces>0;){if(e.strictBrackets===!0)throw new SyntaxError(mt("closing","}"));c.output=V.escapeLast(c.output,"{"),nt("braces")}if(e.strictSlashes!==!0&&(u.type==="star"||u.type==="bracket")&&w({type:"maybe_slash",value:"",output:`${C}?`}),c.backtrack===!0){c.output="";for(let g of c.tokens)c.output+=g.output!=null?g.output:g.value,g.suffix&&(c.output+=g.suffix)}return c};Rn.fastpaths=(n,t)=>{let e={...t},i=typeof e.maxLength=="number"?Math.min($t,e.maxLength):$t,s=n.length;if(s>i)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${i}`);n=Tn[n]||n;let r=V.isWindows(t),{DOT_LITERAL:o,SLASH_LITERAL:h,ONE_CHAR:l,DOTS_SLASH:f,NO_DOT:p,NO_DOTS:E,NO_DOTS_SLASH:_,STAR:C,START_ANCHOR:x}=Kt.globChars(r),S=e.dot?E:p,H=e.dot?_:p,Y=e.capture?"":"?:",U={negated:!1,prefix:""},L=e.bash===!0?".*?":C;e.capture&&(L=`(${L})`);let P=m=>m.noglobstar===!0?L:`(${Y}(?:(?!${x}${m.dot?f:o}).)*?)`,O=m=>{switch(m){case"*":return`${S}${l}${L}`;case".*":return`${o}${l}${L}`;case"*.*":return`${S}${L}${o}${l}${L}`;case"*/*":return`${S}${L}${h}${l}${H}${L}`;case"**":return S+P(e);case"**/*":return`(?:${S}${P(e)}${h})?${H}${l}${L}`;case"**/*.*":return`(?:${S}${P(e)}${h})?${H}${L}${o}${l}${L}`;case"**/.*":return`(?:${S}${P(e)}${h})?${o}${l}${L}`;default:{let T=/^(.*?)\.(\w+)$/.exec(m);if(!T)return;let K=O(T[1]);return K?K+o+T[2]:void 0}}},F=V.removePrefix(n,U),B=O(F);return B&&e.strictSlashes!==!0&&(B+=`${h}?`),B};xn.exports=Rn});var Ln=pt((_o,Cn)=>{"use strict";var ms=Ht(),ys=An(),Ee=Sn(),_e=Nt(),Es=bt(),_s=n=>n&&typeof n=="object"&&!Array.isArray(n),N=(n,t,e=!1)=>{if(Array.isArray(n)){let p=n.map(_=>N(_,t,e));return _=>{for(let C of p){let x=C(_);if(x)return x}return!1}}let i=_s(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!i)throw new TypeError("Expected pattern to be a non-empty string");let s=t||{},r=_e.isWindows(t),o=i?N.compileRe(n,t):N.makeRe(n,t,!1,!0),h=o.state;delete o.state;let l=()=>!1;if(s.ignore){let p={...t,ignore:null,onMatch:null,onResult:null};l=N(s.ignore,p,e)}let f=(p,E=!1)=>{let{isMatch:_,match:C,output:x}=N.test(p,o,t,{glob:n,posix:r}),S={glob:n,state:h,regex:o,posix:r,input:p,output:x,match:C,isMatch:_};return typeof s.onResult=="function"&&s.onResult(S),_===!1?(S.isMatch=!1,E?S:!1):l(p)?(typeof s.onIgnore=="function"&&s.onIgnore(S),S.isMatch=!1,E?S:!1):(typeof s.onMatch=="function"&&s.onMatch(S),E?S:!0)};return e&&(f.state=h),f};N.test=(n,t,e,{glob:i,posix:s}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let r=e||{},o=r.format||(s?_e.toPosixSlashes:null),h=n===i,l=h&&o?o(n):n;return h===!1&&(l=o?o(n):n,h=l===i),(h===!1||r.capture===!0)&&(r.matchBase===!0||r.basename===!0?h=N.matchBase(n,t,e,s):h=t.exec(l)),{isMatch:Boolean(h),match:h,output:l}};N.matchBase=(n,t,e,i=_e.isWindows(e))=>(t instanceof RegExp?t:N.makeRe(t,e)).test(ms.basename(n));N.isMatch=(n,t,e)=>N(t,e)(n);N.parse=(n,t)=>Array.isArray(n)?n.map(e=>N.parse(e,t)):Ee(n,{...t,fastpaths:!1});N.scan=(n,t)=>ys(n,t);N.compileRe=(n,t,e=!1,i=!1)=>{if(e===!0)return n.output;let s=t||{},r=s.contains?"":"^",o=s.contains?"":"$",h=`${r}(?:${n.output})${o}`;n&&n.negated===!0&&(h=`^(?!${h}).*$`);let l=N.toRegex(h,t);return i===!0&&(l.state=n),l};N.makeRe=(n,t={},e=!1,i=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let s={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(s.output=Ee.fastpaths(n,t)),s.output||(s=Ee(n,t)),N.compileRe(s,t,e,i)};N.toRegex=(n,t)=>{try{let e=t||{};return new RegExp(n,e.flags||(e.nocase?"i":""))}catch(e){if(t&&t.debug===!0)throw e;return/$^/}};N.constants=Es;Cn.exports=N});var On=pt((wo,In)=>{"use strict";In.exports=Ln()});var ci=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,fi=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,Re="noscale",Yt="fit",Se="scale",Ce="fill",Le="stretch",pi=300,di=150,vi=Yt,gi=200,Ie=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=ci,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=fi,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._contentElement=this.shadowRoot.querySelector(".content"),this._innerElement=this.shadowRoot.querySelector("#inner"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=pi,this._height=di,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){vt(this,"mode"),vt(this,"debug"),vt(this,"disabled"),vt(this,"width"),vt(this,"height"),vt(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",vi),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,i){switch(t){case"debug":this._debug=i!==null;break;case"disabled":this._disabled=i!==null;break;case"width":this._width=Number(i);break;case"height":this._height=Number(i);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+i+"}}").bind(this);break}switch(t){case"disabled":i?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",i),this._fpsElement.classList.toggle("hidden",i),this._dimensionElement.classList.toggle("hidden",i);break}}getContext(t="2d",e=void 0){return this._canvasElement.getContext(t,e)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);let e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let i=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._fpsElement.textContent!==i&&(this._fpsElement.textContent=i),this.mode===Re){let r=`${this._width}x${this._height}`;this._dimensionElement.textContent!==r&&(this._dimensionElement.textContent=r)}else{let r=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==r&&(this._dimensionElement.textContent=r)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,prevTime:this._prevAnimationFrameTime,deltaTime:e,canvas:this._canvasElement},bubbles:!1,composed:!0}))}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(t,e){(t!==this._resizeCanvasWidth||e!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,gi))}updateCanvasSize(t=!0){let e=this.shadowRoot.host.getBoundingClientRect(),i=e.width,s=e.height,r=this._canvasElement,o=this._width,h=this._height,l=this.mode;if(l===Le||l===Ce)o=i,h=s;else if(l!==Re&&(i<o||s<h||l===Yt||l==Se)){let p=i/o,E=s/h;p<E?(o=i,h=h*p):(o=o*E,h=s)}if(o=Math.floor(o),h=Math.floor(h),typeof t=="undefined"&&(t=r.clientWidth!==o||r.clientHeight!==h),!t){this.delayCanvasResize(o,h);return}let f=Math.min(o/this._width,h/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${f}em`,t){l===Se?(r.width=this._width,r.height=this._height):l!==Le&&(r.width=o,r.height=h);let p=this._contentElement.style;p.width=`${o}px`,p.height=`${h}px`,(l===Yt||l===Ce)&&(this._width=o,this._height=h),this.dispatchEvent(new CustomEvent("resize",{detail:{width:o,height:h},bubbles:!1,composed:!0}))}}};Ie.define();function vt(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var Wt=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,i){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e={}){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Et=class extends Wt{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array;for(let i=0;i<t;++i)e.push(this.constructor.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e=this._state,i=e.length,s;if(t<=i)s=e.slice(0,t);else{s=e;for(let r=i;r<t;++r)s.push(this.constructor.createAxisBindingState())}this._state=s,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,i=0,s=0,r=e.length;for(let o=0;o<r;++o){let h=e[o];i+=h.value*(h.inverted?-1:1),s+=h.delta,e[o].delta=0}this._value=i,this._delta=s,super.onPoll(t)}onUpdate(t,e,i){typeof e=="undefined"?this.onAxisChange(t,i):this.onAxisMove(t,e,i)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e={}){super.onBind(t,e);let{inverted:i=!1}=e,s=this._state;s[t].inverted=i}onAxisMove(t,e,i){let s=this._state[t];s.value=e,s.delta+=i}onAxisChange(t,e){let i=this._state[t];i.value+=e,i.delta+=e}onAxisStatus(t,e){let i=this._state[t],s=i.value;i.value=e,i.delta=e-s}},mi=241,Oe=254,yi=239,dt=1,jt=2,qt=4,Xt=8,Zt=16,St=class extends Wt{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e=this._state,i=e.length,s;t<=i?s=e.slice(0,t):(s=new Uint8Array(t),s.set(e)),this._state=s,super.resize(t)}getState(t){let e=this._state[t],i=e&Zt?-1:1;return(e&dt?1:0)*i}onPoll(t){let e=this._state,i=0,s=0,r=0,o=0,h=0,l=e.length;for(let f=0;f<l;++f){let p=e[f],E=p&dt,_=p&Zt;s|=E,r|=p&jt,o|=p&qt,h|=p&Xt,i+=(E?1:0)*(_?-1:1),e[f]&=mi}this._value=i,this._down=s!==0,this._pressed=r!==0,this._repeated=o!==0,this._released=h!==0,super.onPoll(t)}onUpdate(t,e,i){i>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,e!==0)}onBind(t,e={}){super.onBind(t,e);let{inverted:i=!1}=e,s=this._state;i?s[t]|=Zt:s[t]&=yi}onButtonPressed(t){let e=this._state,i=e[t];i&dt||(i|=jt,i|=dt),i|=qt,e[t]=i}onButtonReleased(t){let e=this._state,i=e[t];i&dt&&(i|=Xt,i&=Oe),e[t]=i}onButtonStatus(t,e){let i=this._state,s=i[t],r=Boolean(s&dt);e?s|=dt:s&=Oe,r&&!e&&(s|=Xt),!r&&e&&(s|=jt,s|=qt),i[t]=s}};var v=class{static parse(t){t=t.trim();let e=t.indexOf(".");if(e<0)throw new Error("Missing device separator for key code.");let i=t.substring(0,e);if(i.length<0)throw new Error("Missing device for key code.");let s=t.substring(e+1);if(s.length<0)throw new Error("Missing code for key code.");return new v(i,s)}constructor(t,e){this.device=t,this.code=e}toString(){return`${this.device}.${this.code}`}};var y="Keyboard",it="Mouse",Xs=new v(y,"KeyA"),Zs=new v(y,"KeyB"),Qs=new v(y,"KeyC"),Vs=new v(y,"KeyD"),Js=new v(y,"KeyE"),tr=new v(y,"KeyF"),er=new v(y,"KeyG"),nr=new v(y,"KeyH"),ir=new v(y,"KeyI"),sr=new v(y,"KeyJ"),rr=new v(y,"KeyK"),or=new v(y,"KeyL"),ar=new v(y,"KeyM"),lr=new v(y,"KeyN"),ur=new v(y,"KeyO"),hr=new v(y,"KeyP"),cr=new v(y,"KeyQ"),fr=new v(y,"KeyR"),pr=new v(y,"KeyS"),dr=new v(y,"KeyT"),vr=new v(y,"KeyU"),gr=new v(y,"KeyV"),mr=new v(y,"KeyW"),yr=new v(y,"KeyX"),Er=new v(y,"KeyY"),_r=new v(y,"KeyZ"),wr=new v(y,"Digit0"),br=new v(y,"Digit1"),Ar=new v(y,"Digit2"),xr=new v(y,"Digit3"),Tr=new v(y,"Digit4"),Rr=new v(y,"Digit5"),Sr=new v(y,"Digit6"),Cr=new v(y,"Digit7"),Lr=new v(y,"Digit8"),Ir=new v(y,"Digit9"),Or=new v(y,"Minus"),Mr=new v(y,"Equal"),kr=new v(y,"BracketLeft"),Br=new v(y,"BracketRight"),Hr=new v(y,"Semicolon"),Dr=new v(y,"Quote"),Nr=new v(y,"Backquote"),Kr=new v(y,"Backslash"),$r=new v(y,"Comma"),Pr=new v(y,"Period"),Ur=new v(y,"Slash"),Fr=new v(y,"Escape"),zr=new v(y,"Space"),Gr=new v(y,"CapsLock"),Yr=new v(y,"Backspace"),Wr=new v(y,"Delete"),jr=new v(y,"Tab"),qr=new v(y,"Enter"),Xr=new v(y,"ArrowUp"),Zr=new v(y,"ArrowDown"),Qr=new v(y,"ArrowLeft"),Vr=new v(y,"ArrowRight"),Jr=new v(it,"Button0"),to=new v(it,"Button1"),eo=new v(it,"Button2"),no=new v(it,"Button3"),io=new v(it,"Button4"),so=new v(it,"PosX"),ro=new v(it,"PosY"),oo=new v(it,"WheelX"),ao=new v(it,"WheelY"),lo=new v(it,"WheelZ");var Qt=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let i=this.listeners;t in i?i[t].push(e):i[t]=[e]}removeEventListener(t,e){let i=this.listeners;if(t in i){let s=i[t],r=s.indexOf(e);r>=0&&s.splice(r,1)}}dispatchInputEvent(t){let e=0;for(let i of this.listeners.input)e|=i(t);return Boolean(e)}},Me=class extends Qt{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,i={}){super(t,e);let{ignoreRepeat:s=!0}=i;this.ignoreRepeat=s,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;if(e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}},Vt=10,Jt=100,ke=class extends Qt{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,e,i={}){super(t,e);let{eventsOnFocus:s=!0}=i;this.eventsOnFocus=s,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,i,s;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=t.deltaX*Vt,i=t.deltaY*Vt,s=t.deltaZ*Vt;break;case WheelEvent.DOM_DELTA_PAGE:e=t.deltaX*Jt,i=t.deltaY*Jt,s=t.deltaZ*Jt;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,i=t.deltaY,s=t.deltaZ;break}let r=0,o=this._wheelObject;if(o.code="WheelX",o.movement=e,r|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=i,r|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=s,r|=this.dispatchInputEvent(o),r)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;if(e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let e=this.canvasTarget,{clientWidth:i,clientHeight:s}=e,r=e.getBoundingClientRect(),o=t.movementX/i,h=t.movementY/s,l=(t.clientX-r.left)/i,f=(t.clientY-r.top)/s,p=this._positionObject;p.code="PosX",p.value=l,p.movement=o,this.dispatchInputEvent(p),p.code="PosY",p.value=f,p.movement=h,this.dispatchInputEvent(p)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},Ei=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,_i=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,te=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Ei,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=_i,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,e,i){switch(t){case"name":this._name=i,this._nameElement.textContent=i;break;case"value":this._value=i,i!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=i,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=i!==null,this._kbdElement.classList.toggle("disabled",i!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};te.define();var wi=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,bi=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,Be=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},He=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){let{device:e,code:i,event:s,value:r,movement:o,control:h,shift:l,alt:f}=t,p=this.bindings.getBindings(e,i);switch(s){case"pressed":for(let{input:E,index:_}of p)E.onUpdate(_,1,1);break;case"released":for(let{input:E,index:_}of p)E.onUpdate(_,0,-1);break;case"move":for(let{input:E,index:_}of p)E.onUpdate(_,r,o);break;case"wheel":for(let{input:E,index:_}of p)E.onUpdate(_,void 0,o);break}return p.length>0}},ee=class{constructor(t,e,i,s){this.device=t,this.code=e,this.input=i,this.index=s}},De=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,i,s={}){let r,o=this.inputMap;if(o.has(t)){let l=o.get(t),f=t.size;t.onBind(f,s),r=new ee(e,i,t,f),l.push(r)}else{let l=[];o.set(t,l);let f=0;t.onBind(f,s),r=new ee(e,i,t,f),l.push(r)}let h=this.bindingMap;e in h?i in h[e]?h[e][i].push(r):h[e][i]=[r]:h[e]={[i]:[r]}}unbind(t){let e=this.inputMap;if(e.has(t)){let i=this.bindingMap,s=e.get(t);for(let r of s){let{device:o,code:h}=r,l=i[o][h],f=l.indexOf(r);l.splice(f,1)}s.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let i=this.bindingMap;if(t in i){let s=i[t];if(e in s)return s[e]}return[]}},Ne=class{constructor(t,e={}){this.inputs={},this.devices=[new ke("Mouse",t),new Me("Keyboard",t)],this.bindings=new De,this.adapter=new He(this.bindings),this.autopoller=new Be(this.adapter),this.eventTarget=t,this.anyButton=new St(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Et(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let i of this.devices)i.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t=void 0){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let i in t)t[i].length=0;this.autopoller.running&&this.autopoller.stop();for(let i of this.devices)i.removeEventListener("input",this.onInput),i.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let i of this.devices)i.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let e=this.autopoller.running,i=typeof t=="undefined"?!e:Boolean(t);i!==e&&(i?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let i=this.listeners;t in i?i[t].push(e):i[t]=[e]}removeEventListener(t,e){let i=this.listeners;if(t in i){let s=i[t],r=s.indexOf(e);r>=0&&s.splice(r,1)}}dispatchEvent(t){let{type:e}=t,i=0;for(let s of this.listeners[e])i|=s(t);return Boolean(i)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){for(let e of t)e.register(this)}bindButton(t,e,i,s=void 0){let r;this.hasButton(t)?r=this.getButton(t):(r=new St(1),this.inputs[t]=r),this.bindings.bind(r,e,i,s),this.onBind()}bindAxis(t,e,i,s=void 0){let r;this.hasAxis(t)?r=this.getAxis(t):(r=new Et(1),this.inputs[t]=r),this.bindings.bind(r,e,i,s),this.onBind()}bindAxisButtons(t,e,i,s){let r;this.hasAxis(t)?r=this.getAxis(t):(r=new Et(2),this.inputs[t]=r),this.bindings.bind(r,e,s),this.bindings.bind(r,e,i,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof St}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Et}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let e=this.inputs;for(let i of t)if(e[i].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let e=this.inputs;for(let i of t)if(e[i].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let e=this.inputs;for(let i of t)if(e[i].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let e=this.inputs;for(let i of t){let s=e[i];if(s.value)return s.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let e=this.inputs;for(let i of t){let s=e[i];if(s.delta)return s.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},Ke=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=wi,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=bi,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let t=this;this._for="",this._eventTarget=t,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){this._context&&(this._context.removeEventListener("bind",this.onInputContextBind),this._context.removeEventListener("unbind",this.onInputContextUnbind),this._context.removeEventListener("blur",this.onInputContextBlur),this._context.removeEventListener("focus",this.onInputContextFocus),this._context.destroy(),this._context=null)}attributeChangedCallback(t,e,i){switch(t){case"for":{this._for=i;let s,r;i?(s=document.getElementById(i),r=`${s.tagName.toLowerCase()}#${i}`):(s=this,r="input-port"),this._eventTarget=s,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${r}`}break;case"autopoll":this._autopoll=i!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){this.updateTable()}onInputContextUnbind(){this.updateTable()}onInputContextFocus(){this._focusElement.innerHTML="\u2713"}onInputContextBlur(){this._focusElement.innerHTML=""}getContext(t="axisbutton",e=void 0){switch(t){case"axisbutton":return this._context||(this._context=new Ne(this._eventTarget,e),this._context.addEventListener("bind",this.onInputContextBind),this._context.addEventListener("unbind",this.onInputContextUnbind),this._context.addEventListener("blur",this.onInputContextBlur),this._context.addEventListener("focus",this.onInputContextFocus),this._autopoll&&this._context.toggleAutoPoll(!0)),this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,e=t.inputs,i=t.bindings,s={},r=[];for(let o of Object.keys(e)){let h=e[o],l=!0;for(let f of i.getBindingsByInput(h)){let p=Ai(`${h.constructor.name}.${o}`,`${f.device}.${f.code}`,0,l);r.push(p),l&&(s[o]=p.querySelector("output"),l=!1)}}this._outputElements=s,this._bodyElement.innerHTML="";for(let o of r)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let i of Object.keys(this._outputElements)){let s=this._outputElements[i],r=e[i].value;s.innerText=Number(r).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let e=this._outputElements[t];e.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let i of Object.values(e))if(!i.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};Ke.define();function Ai(n,t,e,i=!0){let s=document.createElement("tr");i&&s.classList.add("primary");{let r=document.createElement("td");r.textContent=n,r.classList.add("name"),s.appendChild(r)}{let r=document.createElement("td"),o=document.createElement("output");i?o.innerText=Number(e).toFixed(2):o.innerText="---",o.classList.add("value"),r.appendChild(o),s.appendChild(r)}{let r=document.createElement("td");r.classList.add("key");let o=new te;o.innerText=t,r.appendChild(o),s.appendChild(r)}return s}var uo=Symbol("keyboardSource");var ho=Symbol("mouseSource");var $e={},xi=function(n,t,e,i,s){var r=new Worker($e[t]||($e[t]=URL.createObjectURL(new Blob([n],{type:"text/javascript"}))));return r.onerror=function(o){return s(o.error,null)},r.onmessage=function(o){return s(null,o.data)},r.postMessage(e,i),r},j=Uint8Array,st=Uint16Array,_t=Uint32Array,ne=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ie=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Pe=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ue=function(n,t){for(var e=new st(31),i=0;i<31;++i)e[i]=t+=1<<n[i-1];for(var s=new _t(e[30]),i=1;i<30;++i)for(var r=e[i];r<e[i+1];++r)s[r]=r-e[i]<<5|i;return[e,s]},Fe=Ue(ne,2),se=Fe[0],Ti=Fe[1];se[28]=258,Ti[258]=28;var ze=Ue(ie,0),Ge=ze[0],fo=ze[1],Ct=new st(32768);for(var k=0;k<32768;++k)lt=(k&43690)>>>1|(k&21845)<<1,lt=(lt&52428)>>>2|(lt&13107)<<2,lt=(lt&61680)>>>4|(lt&3855)<<4,Ct[k]=((lt&65280)>>>8|(lt&255)<<8)>>>1;var lt,gt=function(n,t,e){for(var i=n.length,s=0,r=new st(t);s<i;++s)++r[n[s]-1];var o=new st(t);for(s=0;s<t;++s)o[s]=o[s-1]+r[s-1]<<1;var h;if(e){h=new st(1<<t);var l=15-t;for(s=0;s<i;++s)if(n[s])for(var f=s<<4|n[s],p=t-n[s],E=o[n[s]-1]++<<p,_=E|(1<<p)-1;E<=_;++E)h[Ct[E]>>>l]=f}else for(h=new st(i),s=0;s<i;++s)n[s]&&(h[s]=Ct[o[n[s]-1]++]>>>15-n[s]);return h},wt=new j(288);for(var k=0;k<144;++k)wt[k]=8;for(var k=144;k<256;++k)wt[k]=9;for(var k=256;k<280;++k)wt[k]=7;for(var k=280;k<288;++k)wt[k]=8;var Ye=new j(32);for(var k=0;k<32;++k)Ye[k]=5;var We=gt(wt,9,1);var je=gt(Ye,5,1),Lt=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},J=function(n,t,e){var i=t/8|0;return(n[i]|n[i+1]<<8)>>(t&7)&e},It=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},qe=function(n){return(n/8|0)+(n&7&&1)},Ot=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var i=new(n instanceof st?st:n instanceof _t?_t:j)(e-t);return i.set(n.subarray(t,e)),i},Xe=function(n,t,e){var i=n.length;if(!i||e&&!e.l&&i<5)return t||new j(0);var s=!t||e,r=!e||e.i;e||(e={}),t||(t=new j(i*3));var o=function(w){var ft=t.length;if(w>ft){var xt=new j(Math.max(ft*2,w));xt.set(t),t=xt}},h=e.f||0,l=e.p||0,f=e.b||0,p=e.l,E=e.d,_=e.m,C=e.n,x=i*8;do{if(!p){e.f=h=J(n,l,1);var S=J(n,l+1,3);if(l+=3,S)if(S==1)p=We,E=je,_=9,C=5;else if(S==2){var L=J(n,l,31)+257,P=J(n,l+10,15)+4,O=L+J(n,l+5,31)+1;l+=14;for(var F=new j(O),B=new j(19),m=0;m<P;++m)B[Pe[m]]=J(n,l+m*3,7);l+=P*3;for(var T=Lt(B),K=(1<<T)-1,c=gt(B,T,1),m=0;m<O;){var I=c[J(n,l,K)];l+=I&15;var H=I>>>4;if(H<16)F[m++]=H;else{var R=0,Q=0;for(H==16?(Q=3+J(n,l,3),l+=2,R=F[m-1]):H==17?(Q=3+J(n,l,7),l+=3):H==18&&(Q=11+J(n,l,127),l+=7);Q--;)F[m++]=R}}var u=F.subarray(0,L),a=F.subarray(L);_=Lt(u),C=Lt(a),p=gt(u,_,1),E=gt(a,C,1)}else throw"invalid block type";else{var H=qe(l)+4,Y=n[H-4]|n[H-3]<<8,U=H+Y;if(U>i){if(r)throw"unexpected EOF";break}s&&o(f+Y),t.set(n.subarray(H,U),f),e.b=f+=Y,e.p=l=U*8;continue}if(l>x){if(r)throw"unexpected EOF";break}}s&&o(f+131072);for(var z=(1<<_)-1,A=(1<<C)-1,X=l;;X=l){var R=p[It(n,l)&z],G=R>>>4;if(l+=R&15,l>x){if(r)throw"unexpected EOF";break}if(!R)throw"invalid length/literal";if(G<256)t[f++]=G;else if(G==256){X=l,p=null;break}else{var W=G-254;if(G>264){var m=G-257,et=ne[m];W=J(n,l,(1<<et)-1)+se[m],l+=et}var yt=E[It(n,l)&A],ht=yt>>>4;if(!yt)throw"invalid distance";l+=yt&15;var a=Ge[ht];if(ht>3){var et=ie[ht];a+=It(n,l)&(1<<et)-1,l+=et}if(l>x){if(r)throw"unexpected EOF";break}s&&o(f+131072);for(var nt=f+W;f<nt;f+=4)t[f]=t[f-a],t[f+1]=t[f+1-a],t[f+2]=t[f+2-a],t[f+3]=t[f+3-a];f=nt}}e.l=p,e.p=X,e.b=f,p&&(h=1,e.m=_,e.d=E,e.n=C)}while(!h);return f==t.length?t:Ot(t,0,f)};var Ri=new j(0);var Si=function(n,t){var e={};for(var i in n)e[i]=n[i];for(var i in t)e[i]=t[i];return e},Ze=function(n,t,e){for(var i=n(),s=n.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var h=i[o],l=r[o];if(typeof h=="function"){t+=";"+l+"=";var f=h.toString();if(h.prototype)if(f.indexOf("[native code]")!=-1){var p=f.indexOf(" ",8)+1;t+=f.slice(p,f.indexOf("(",p))}else{t+=f;for(var E in h.prototype)t+=";"+l+".prototype."+E+"="+h.prototype[E].toString()}else t+=f}else e[l]=h}return[t,e]},Mt=[],Ci=function(n){var t=[];for(var e in n)(n[e]instanceof j||n[e]instanceof st||n[e]instanceof _t)&&t.push((n[e]=new n[e].constructor(n[e])).buffer);return t},Li=function(n,t,e,i){var s;if(!Mt[e]){for(var r="",o={},h=n.length-1,l=0;l<h;++l)s=Ze(n[l],r,o),r=s[0],o=s[1];Mt[e]=Ze(n[h],r,o)}var f=Si({},Mt[e][1]);return xi(Mt[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",e,f,Ci(f),i)},Ii=function(){return[j,st,_t,ne,ie,Pe,se,Ge,We,je,Ct,gt,Lt,J,It,qe,Ot,Xe,re,Qe,Ve]};var Qe=function(n){return postMessage(n,[n.buffer])},Ve=function(n){return n&&n.size&&new j(n.size)},Oi=function(n,t,e,i,s,r){var o=Li(e,i,s,function(h,l){o.terminate(),r(h,l)});return o.postMessage([n,t],t.consume?[n.buffer]:[]),function(){o.terminate()}};var rt=function(n,t){return n[t]|n[t+1]<<8},tt=function(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0},oe=function(n,t){return tt(n,t)+tt(n,t+4)*4294967296};function Mi(n,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Oi(n,t,[Ii],function(i){return Qe(re(i.data[0],Ve(i.data[1])))},1,e)}function re(n,t){return Xe(n,t)}var po=typeof TextEncoder!="undefined"&&new TextEncoder,ae=typeof TextDecoder!="undefined"&&new TextDecoder,ki=0;try{ae.decode(Ri,{stream:!0}),ki=1}catch(n){}var Bi=function(n){for(var t="",e=0;;){var i=n[e++],s=(i>127)+(i>223)+(i>239);if(e+s>n.length)return[t,Ot(n,e-1)];s?s==3?(i=((i&15)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,t+=String.fromCharCode(55296|i>>10,56320|i&1023)):s&1?t+=String.fromCharCode((i&31)<<6|n[e++]&63):t+=String.fromCharCode((i&15)<<12|(n[e++]&63)<<6|n[e++]&63):t+=String.fromCharCode(i)}};function Hi(n,t){if(t){for(var e="",i=0;i<n.length;i+=16384)e+=String.fromCharCode.apply(null,n.subarray(i,i+16384));return e}else{if(ae)return ae.decode(n);var s=Bi(n),r=s[0],o=s[1];if(o.length)throw"invalid utf-8 data";return r}}var Di=function(n,t){return t+30+rt(n,t+26)+rt(n,t+28)},Ki=function(n,t,e){var i=rt(n,t+28),s=Hi(n.subarray(t+46,t+46+i),!(rt(n,t+8)&2048)),r=t+46+i,o=tt(n,t+20),h=e&&o==4294967295?Ni(n,r):[o,tt(n,t+24),tt(n,t+42)],l=h[0],f=h[1],p=h[2];return[rt(n,t+10),l,f,s,r+rt(n,t+30)+rt(n,t+32),p]},Ni=function(n,t){for(;rt(n,t)!=1;t+=4+rt(n,t+2));return[oe(n,t+12),oe(n,t+4),oe(n,t+20)]};function Je(n,t){if(typeof t!="function")throw"no callback";for(var e=[],i=function(){for(var _=0;_<e.length;++_)e[_]()},s={},r=n.length-22;tt(n,r)!=101010256;--r)if(!r||n.length-r>65558){t("invalid zip file",null);return}var o=rt(n,r+8);o||t(null,{});var h=o,l=tt(n,r+16),f=l==4294967295;if(f){if(r=tt(n,r-12),tt(n,r)!=101075792){t("invalid zip file",null);return}h=o=tt(n,r+32),l=tt(n,r+48)}for(var p=function(_){var C=Ki(n,l,f),x=C[0],S=C[1],H=C[2],Y=C[3],U=C[4],L=C[5],P=Di(n,L);l=U;var O=function(B,m){B?(i(),t(B,null)):(s[Y]=m,--o||t(null,s))};if(!x)O(null,Ot(n,P,P+S));else if(x==8){var F=n.subarray(P,P+S);if(S<32e4)try{O(null,re(F,new j(H)))}catch(B){O(B,null)}else e.push(Mi(F,{size:H},O))}else O("unknown compression type "+x,null)},E=0;E<h;++E)p(E);return i}var Mn=hi(On()),kn=class{constructor(){this._buffers={}}clear(){this._buffers={}}put(t,e){this._buffers[t]=e}get(t){return this._buffers[t]}keys(){return Object.keys(this._buffers)}},ws="",bs="",As=5e3;function Bn(n){return this.test(n)}function xs(n,t){console.error(n,t)}var Pt=class extends HTMLElement{static createFileMatcher(t){if(typeof t=="string"){let e=(0,Mn.makeRe)(t),i=Bn.bind(e);return i.key=t,i}else if(t instanceof RegExp){let e=t,i=Bn.bind(e);return i.key=t.source,i}else throw new Error("Filter must be either a RegExp or glob string.")}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=ws,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=bs,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("asset-pack",Pt)}static get observedAttributes(){return["src"]}set src(t){this.setAttribute("src",t)}get src(){return this._src}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._src="",this._files=new kn,this._cache={},this._loading={},this.onLoad=this.onLoad.bind(this),this.loaded=!1}get files(){return this._files}cacheAsset(t,e,i={}){let{ephemeral:s}=i,r=this._cache[t],o=this._loading[t];this._cache[t]=e,this.dispatchEvent(new CustomEvent("cache",{composed:!0,bubbles:!1,detail:{uri:t,current:e}})),o&&(o.resolve(e),delete this._loading[e]),s&&this._cache[e]===e&&(r?this._cache[e]=r:delete this._cache[e])}async loadAsset(t,e=As){let i=this._cache[t];if(i)return i;if(t in this._loading)return this._loading[t].promise;{let s=new Hn(e);return this._loading[t]=s,s.promise}}clearAssets(){for(let t of Object.values(this._loading))t.reject(new Error("Stop loading to clear all assets."));this._loading={},this._cache={}}deleteAsset(t){t in this._loading&&(this._loading[t].reject(new Error("Stop loading to delete asset.")),delete this._loading[t]),t in this._cache&&delete this._cache[t]}getAsset(t){return this._cache[t]}getAssetURIs(){return Object.keys(this._cache)}hasAsset(t){let e=this._cache[t];return e?Boolean(e):!1}isAssetCached(t){return t in this._cache}isAssetLoading(t){return t in this._loading}connectedCallback(){Ts(this,"src")}attributeChangedCallback(t,e,i){switch(t){case"src":this._src=i,i&&(this.loaded=!1,fetch(i).then(this.onLoad).catch(s=>xs("Failed to load asset pack:",s)));break}}async onLoad(t){let e=await t.arrayBuffer();await new Promise((i,s)=>{Je(new Uint8Array(e),(r,o)=>{if(r)s(r);else{let h=this._files;Promise.all(Object.entries(o).map(([l,f])=>(h.put(l,f),this.cacheAsset(l,f)))).then(()=>i()).catch(s)}})}),this.dispatchEvent(new CustomEvent("load",{composed:!0})),this.loaded=!0}};Pt.define();function Ts(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var Hn=class{constructor(t){this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((e,i)=>{this._value?e(this._value):this._resolve=e,this._reason?i(this._reason):this._reject=i})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}};window.addEventListener("error",Ut,!0);window.addEventListener("unhandledrejection",Ut,!0);function Ut(n){typeof n=="object"?n instanceof PromiseRejectionEvent?Ut(n.reason):n instanceof ErrorEvent?Ut(n.error):n instanceof Error?window.alert(n.stack):window.alert(JSON.stringify(n)):window.alert(n)}var we=class{next(){return 0}},Dn=class extends we{next(){return Math.random()}},Nn=class extends we{constructor(t){super();this.seed=t,this.a=t}next(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}},be=class{static get RAND(){let t=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:t}),t}constructor(t=void 0){typeof t=="number"?this.generator=new Nn(t):t?this.generator=t:this.generator=new Dn,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(t){return this.RAND.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return this.RAND.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static rangeInt(t,e){return this.RAND.rangeInt(t,e)}rangeInt(t,e){return Math.trunc(this.range(t,e))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};var Kn=["back","main","fore"],Rs={back:"#000000",main:"#333333",fore:"#888888"},Ss={back:.3,main:.5,fore:1},Cs={back:0,main:-8,fore:-16},Ls=["back","back","back","back","main","main","fore"],Is=80,Ft=new be,Os=()=>Ft.choose(Ls),Ms=n=>Math.trunc(Ft.range(0,n)),ks=()=>Math.trunc(Ft.range(16,32)),Bs=()=>Math.trunc(Ft.range(36,80)),zt=80,Ae=8,$n=6,xe=64;function Hs(n){let t="main",e={x:0,width:36,height:16,layer:t};return n.background.buildings.push(e),n.background.buildingLayers[t].push(e),e}function Pn(n,t){t.x=Ms(n.display.width),t.width=ks(),t.height=Bs();let e=t.layer,i=Os(),s=n.background.buildingLayers;s[e].splice(s[e].indexOf(t),1),s[i].push(t),t.layer=i}function Un(n){n.background={buildingLayers:{fore:[],back:[],main:[]},buildings:[],progress:0};for(let t=0;t<Is;++t){let e=Hs(n);Pn(n,e)}}function Fn(n,t){t.background.progress+=n;for(let e of Kn)for(let i of t.background.buildingLayers[e])i.x>t.display.width?(Pn(t,i),i.x-=t.display.width+i.width):i.x+=Ss[e]}function zn(n,t){let e=t.display.width,i=t.display.height;n.fillStyle="#561435",n.fillRect(0,0,e,i),n.fillStyle="#8e3e13",n.fillRect(0,0,e,i/3),n.fillStyle="#a09340",n.fillRect(0,0,e,i/10),n.fillStyle="#e8d978",n.fillRect(0,0,e,i/30);for(let h of Kn){n.fillStyle=Rs[h];for(let l of t.background.buildingLayers[h])Ns(n,t,l)}let s=i-xe;n.fillStyle="#000000";let r=s-Ae,o=t.background.progress%zt*$n;n.translate(o,r);for(let h=-zt*$n;h<e;h+=zt)n.translate(h,0),Ds(n,t),n.translate(-h,0);n.translate(-o,-r),n.fillStyle="#000000",n.fillRect(0,s,e,xe)}function Ds(n,t){let e=5,i=zt/e;for(let s=0;s<e;++s){let r=s*i,o=r%3;n.translate(r,0),n.fillRect(0,-o*2,3,Ae+o*2),n.fillRect(8,0,3,Ae),n.fillRect(0,2+o,i,3),n.translate(-r,0)}}function Ns(n,t,e){let i=Cs[e.layer],s=Math.trunc(e.x),r=Math.trunc(t.display.height-xe-e.height-i);n.translate(s,r),n.fillRect(0,0,e.width,e.height+i),n.translate(-s,-r)}var at=Symbol("animatedText"),Ks=1e6,Gn=30,Yn=300,$s=Gn,Ps=/\s/,Wn=/[.!?]/,jn=/[-,:;]/,Us=/[.-]/;function Fs(n,t){if(Ps.test(t)||Us.test(n)){if(Wn.test(n))return 800;if(jn.test(n))return 250}else{if(Wn.test(n))return 200;if(jn.test(n))return 100}return Gn}var qn=class{constructor(t,e=1){this.rootElement=t,this.targetNode=null,this.animatedNodes=new Set,this.nodeContents=new Map,this.deltaTime=0,this.prevTime=0,this.waitTime=Yn,this.targetText="",this.index=-1,this.disabled=!0,this.complete=!1,this.speed=e,this.callback=null,this.error=null,this.animationFrameHandle=null,this.onAnimationFrame=this.onAnimationFrame.bind(this)}toggle(t=!this.disabled){t?this.pause():this.resume()}pause(){this.disabled=!0,cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.deltaTime=this.waitTime}resume(){this.disabled=!1,this.canSafelyResumeWithTarget(this.targetNode)||(this.targetNode=null),this.prevTime=performance.now(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}reset(){this.targetNode=null,this.animatedNodes.clear()}skipAll(){this.targetNode&&(this.targetNode.nodeValue=this.targetText,this.targetNode=null),this.completeRemainingChildText()}onAnimationFrame(t){if(this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.targetNode==null){let r=this.findNextChildText();if(r){let o=r.previousSibling||window.getComputedStyle(r.parentElement).display==="inline";this.targetNode=r,this.targetText=this.nodeContents.get(r),this.animatedNodes.add(r),this.index=-1,this.waitTime=o?$s:Yn,this.deltaTime=0,this.complete=!1}else{this.complete=!0,this.callback.call(void 0);return}}let e=t-this.prevTime;if(this.deltaTime+=e*this.speed,this.prevTime=t,e>Ks){this.skipAll(),this.error(new Error("Frame took too long; skipping animation."));return}let i=this.targetText,s=!1;for(;!s&&this.deltaTime>=this.waitTime;){this.deltaTime-=this.waitTime;let r=++this.index;if(r<i.length){let o=i.charAt(r),h=i.charAt(r+1);this.waitTime=Fs(o,h)}else this.index=i.length,s=!0}if(s)this.targetNode.nodeValue=i,this.targetNode=null;else{let r=i.substring(0,this.index+1);this.targetNode.nodeValue=r}}canSafelyResumeWithTarget(t){if(!t||!t.isConnected)return!1;let e=t.nodeValue,i=this.targetText.substring(0,this.index+1);return e===i}completeRemainingChildText(t=this.rootElement){for(let e of t.childNodes)e instanceof Text?this.nodeContents.has(e)&&(this.animatedNodes.has(e)||(e.nodeValue=this.nodeContents.get(e),this.animatedNodes.add(e))):this.completeRemainingChildText(e)}findNextChildText(t=this.rootElement,e=null){for(let i of t.childNodes)if(i instanceof Text){let s=this.animatedNodes.has(i),r=i.nodeValue;r&&r.trim().length>0&&this.nodeContents.get(i)!==r&&(this.nodeContents.set(i,r),i.nodeValue="",s&&this.animatedNodes.delete(i)),!e&&!s&&this.nodeContents.has(i)&&(e=i)}else e=this.findNextChildText(i,e);return e}},Te={async play(n,t=1){if(!(n instanceof Element))throw new Error("Cannot animate text for non-element.");if(t<=0)throw new Error("Cannot animate text at non-positive speed.");let e=new qn(n,t);return n[at]=e,new Promise((i,s)=>{e.error=r=>{s(r)},e.callback=()=>{e.pause(),delete n[at],i()},e.resume()})},pause(n){n&&at in n&&n[at].pause()},resume(n){n&&at in n&&n[at].resume()},skip(n){n&&at in n&&n[at].skipAll()},toggle(n,t=void 0){n&&at in n&&n[at].toggle(t)}};function Xn(n){let t=document.createElement("div");t.style.position="absolute",t.style.bottom="0.8em",t.style.right="0.8em",t.innerHTML=`
        <style>
            .container {
                position: relative;
                background-color: #091b3d;
                color: #eeeeee;
                padding: 0.5em;
                width: 20em;
                height: 5em;
                overflow: auto;
                font-family: monospace;
            }
        </style>
        <div class="container">
            <article>
                There is something amiss in Marde. The stench of unrest is baked into every nook and alley and not a corner is left
                untainted
                by the foulness of its mindless residents. No windows unshattered. No doors unlocked.
            </article>
        </div>`,n.display.appendChild(t);let e=t.querySelector("article");e.addEventListener("click",()=>{Te.skip(e)}),Te.play(e),n.dialogue={text:"",element:t}}function Zn(n,t){}function Qn(n,t){}function Vn(n){let t=document.createElement("div"),e=document.createElement("button");e.textContent="VACANT",e.style.backgroundColor="#aa3333",e.style.color="#eeeeee",e.style.border="0.3em ridge #660000",e.style.fontSize="1.5em",e.style.padding="0.1em 0.5em",e.style.position="absolute",e.style.left="0.2em",e.style.bottom="0.2em",t.appendChild(e);let i=document.createElement("label");i.textContent="0000 fare",i.style.color="#eeeeee",i.style.fontSize="1.5em",i.style.position="absolute",i.style.bottom="0.2em",i.style.left="7em",t.appendChild(i),n.display.appendChild(t)}function Jn(n,t){}function ti(n,t){}window.addEventListener("DOMContentLoaded",zs);async function zs(){let n=document.querySelector("#display"),t=n.canvas.getContext("2d"),e={display:n,ctx:t,frames:0};Un(e),Xn(e),Vn(e),n.addEventListener("frame",i=>{let{deltaTime:s}=i.detail,r=s/60;Gs(r,e),Ys(t,e),e.frames+=1})}function Gs(n,t){Fn(n,t),Zn(n,t),Jn(n,t)}function Ys(n,t){n.fillStyle="#000000",n.fillRect(0,0,t.display.width,t.display.height),zn(n,t),Qn(n,t),ti(n,t)}})();
//# sourceMappingURL=main.js.map
