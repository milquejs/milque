(()=>{var ws=Object.create,nt=Object.defineProperty;var _s=Object.getOwnPropertyDescriptor;var Ms=Object.getOwnPropertyNames;var bs=Object.getPrototypeOf,As=Object.prototype.hasOwnProperty;var Cs=t=>nt(t,"__esModule",{value:!0});var Ss=(t,e)=>()=>(t&&(e=t(t=0)),e),Se=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),rt=(t,e)=>{for(var n in e)nt(t,n,{get:e[n],enumerable:!0})},ks=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ms(e))!As.call(t,r)&&r!=="default"&&nt(t,r,{get:()=>e[r],enumerable:!(n=_s(e,r))||n.enumerable});return t},Ts=t=>ks(Cs(nt(t!=null?ws(bs(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Ti={};rt(Ti,{basename:()=>Si,default:()=>Fl,delimiter:()=>Ai,dirname:()=>Ci,extname:()=>ki,isAbsolute:()=>on,join:()=>_i,normalize:()=>an,relative:()=>Mi,resolve:()=>dt,sep:()=>bi});function wi(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];i==="."?t.splice(r,1):i===".."?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function dt(){for(var t="",e=!1,n=arguments.length-1;n>=-1&&!e;n--){var r=n>=0?arguments[n]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;t=r+"/"+t,e=r.charAt(0)==="/"}return t=wi(ln(t.split("/"),function(i){return!!i}),!e).join("/"),(e?"/":"")+t||"."}function an(t){var e=on(t),n=Wl(t,-1)==="/";return t=wi(ln(t.split("/"),function(r){return!!r}),!e).join("/"),!t&&!e&&(t="."),t&&n&&(t+="/"),(e?"/":"")+t}function on(t){return t.charAt(0)==="/"}function _i(){var t=Array.prototype.slice.call(arguments,0);return an(ln(t,function(e,n){if(typeof e!="string")throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function Mi(t,e){t=dt(t).substr(1),e=dt(e).substr(1);function n(h){for(var c=0;c<h.length&&h[c]==="";c++);for(var u=h.length-1;u>=0&&h[u]==="";u--);return c>u?[]:h.slice(c,u-c+1)}for(var r=n(t.split("/")),i=n(e.split("/")),s=Math.min(r.length,i.length),a=s,o=0;o<s;o++)if(r[o]!==i[o]){a=o;break}for(var l=[],o=a;o<r.length;o++)l.push("..");return l=l.concat(i.slice(a)),l.join("/")}function Ci(t){var e=sn(t),n=e[0],r=e[1];return!n&&!r?".":(r&&(r=r.substr(0,r.length-1)),n+r)}function Si(t,e){var n=sn(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n}function ki(t){return sn(t)[3]}function ln(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}var Yl,sn,bi,Ai,Fl,Wl,Ii=Ss(()=>{Yl=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,sn=function(t){return Yl.exec(t).slice(1)};bi="/",Ai=":";Fl={extname:ki,basename:Si,dirname:Ci,sep:bi,delimiter:Ai,relative:Mi,join:_i,isAbsolute:on,normalize:an,resolve:dt};Wl="ab".substr(-1)==="b"?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}});var mt=Se((gp,vt)=>{var Ie=(Ii(),Ti);if(Ie&&Ie.default){vt.exports=Ie.default;for(let t in Ie)vt.exports[t]=Ie[t]}else Ie&&(vt.exports=Ie)});var qe=Se((xp,Ni)=>{"use strict";var jl=mt(),ge="\\\\/",Ri=`[^${ge}]`,Ee="\\.",Xl="\\+",Gl="\\?",gt="\\/",ql="(?=.)",Li="[^/]",hn=`(?:${gt}|$)`,Bi=`(?:^|${gt})`,cn=`${Ee}{1,2}${hn}`,Vl=`(?!${Ee})`,Zl=`(?!${Bi}${cn})`,Ql=`(?!${Ee}{0,1}${hn})`,Jl=`(?!${cn})`,eh=`[^.${gt}]`,th=`${Li}*?`,Oi={DOT_LITERAL:Ee,PLUS_LITERAL:Xl,QMARK_LITERAL:Gl,SLASH_LITERAL:gt,ONE_CHAR:ql,QMARK:Li,END_ANCHOR:hn,DOTS_SLASH:cn,NO_DOT:Vl,NO_DOTS:Zl,NO_DOT_SLASH:Ql,NO_DOTS_SLASH:Jl,QMARK_NO_DOT:eh,STAR:th,START_ANCHOR:Bi},nh={...Oi,SLASH_LITERAL:`[${ge}]`,QMARK:Ri,STAR:`${Ri}*?`,DOTS_SLASH:`${Ee}{1,2}(?:[${ge}]|$)`,NO_DOT:`(?!${Ee})`,NO_DOTS:`(?!(?:^|[${ge}])${Ee}{1,2}(?:[${ge}]|$))`,NO_DOT_SLASH:`(?!${Ee}{0,1}(?:[${ge}]|$))`,NO_DOTS_SLASH:`(?!${Ee}{1,2}(?:[${ge}]|$))`,QMARK_NO_DOT:`[^.${ge}]`,START_ANCHOR:`(?:^|[${ge}])`,END_ANCHOR:`(?:[${ge}]|$)`},rh={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};Ni.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:rh,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:jl.sep,extglobChars(t){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${t.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(t){return t===!0?nh:Oi}}});var xt=Se(re=>{"use strict";var ih=mt(),sh=!1,{REGEX_BACKSLASH:ah,REGEX_REMOVE_BACKSLASH:oh,REGEX_SPECIAL_CHARS:lh,REGEX_SPECIAL_CHARS_GLOBAL:hh}=qe();re.isObject=t=>t!==null&&typeof t=="object"&&!Array.isArray(t);re.hasRegexChars=t=>lh.test(t);re.isRegexChar=t=>t.length===1&&re.hasRegexChars(t);re.escapeRegex=t=>t.replace(hh,"\\$1");re.toPosixSlashes=t=>t.replace(ah,"/");re.removeBackslashes=t=>t.replace(oh,e=>e==="\\"?"":e);re.supportsLookbehinds=()=>{let t=process.version.slice(1).split(".").map(Number);return t.length===3&&t[0]>=9||t[0]===8&&t[1]>=10};re.isWindows=t=>t&&typeof t.windows=="boolean"?t.windows:sh===!0||ih.sep==="\\";re.escapeLast=(t,e,n)=>{let r=t.lastIndexOf(e,n);return r===-1?t:t[r-1]==="\\"?re.escapeLast(t,e,r-1):`${t.slice(0,r)}\\${t.slice(r)}`};re.removePrefix=(t,e={})=>{let n=t;return n.startsWith("./")&&(n=n.slice(2),e.prefix="./"),n};re.wrapOutput=(t,e={},n={})=>{let r=n.contains?"":"^",i=n.contains?"":"$",s=`${r}(?:${t})${i}`;return e.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var Yi=Se((Ep,Ui)=>{"use strict";var Di=xt(),{CHAR_ASTERISK:un,CHAR_AT:ch,CHAR_BACKWARD_SLASH:Ve,CHAR_COMMA:uh,CHAR_DOT:fn,CHAR_EXCLAMATION_MARK:pn,CHAR_FORWARD_SLASH:Pi,CHAR_LEFT_CURLY_BRACE:dn,CHAR_LEFT_PARENTHESES:vn,CHAR_LEFT_SQUARE_BRACKET:fh,CHAR_PLUS:ph,CHAR_QUESTION_MARK:Hi,CHAR_RIGHT_CURLY_BRACE:dh,CHAR_RIGHT_PARENTHESES:zi,CHAR_RIGHT_SQUARE_BRACKET:vh}=qe(),Ki=t=>t===Pi||t===Ve,$i=t=>{t.isPrefix!==!0&&(t.depth=t.isGlobstar?Infinity:1)},mh=(t,e)=>{let n=e||{},r=t.length-1,i=n.parts===!0||n.scanToEnd===!0,s=[],a=[],o=[],l=t,h=-1,c=0,u=0,f=!1,d=!1,g=!1,y=!1,p=!1,E=!1,R=!1,_=!1,S=!1,b=!1,k=0,P,w,T={value:"",depth:0,isGlob:!1},N=()=>h>=r,v=()=>l.charCodeAt(h+1),L=()=>(P=w,l.charCodeAt(++h));for(;h<r;){w=L();let F;if(w===Ve){R=T.backslashes=!0,w=L(),w===dn&&(E=!0);continue}if(E===!0||w===dn){for(k++;N()!==!0&&(w=L());){if(w===Ve){R=T.backslashes=!0,L();continue}if(w===dn){k++;continue}if(E!==!0&&w===fn&&(w=L())===fn){if(f=T.isBrace=!0,g=T.isGlob=!0,b=!0,i===!0)continue;break}if(E!==!0&&w===uh){if(f=T.isBrace=!0,g=T.isGlob=!0,b=!0,i===!0)continue;break}if(w===dh&&(k--,k===0)){E=!1,f=T.isBrace=!0,b=!0;break}}if(i===!0)continue;break}if(w===Pi){if(s.push(h),a.push(T),T={value:"",depth:0,isGlob:!1},b===!0)continue;if(P===fn&&h===c+1){c+=2;continue}u=h+1;continue}if(n.noext!==!0&&(w===ph||w===ch||w===un||w===Hi||w===pn)===!0&&v()===vn){if(g=T.isGlob=!0,y=T.isExtglob=!0,b=!0,w===pn&&h===c&&(S=!0),i===!0){for(;N()!==!0&&(w=L());){if(w===Ve){R=T.backslashes=!0,w=L();continue}if(w===zi){g=T.isGlob=!0,b=!0;break}}continue}break}if(w===un){if(P===un&&(p=T.isGlobstar=!0),g=T.isGlob=!0,b=!0,i===!0)continue;break}if(w===Hi){if(g=T.isGlob=!0,b=!0,i===!0)continue;break}if(w===fh){for(;N()!==!0&&(F=L());){if(F===Ve){R=T.backslashes=!0,L();continue}if(F===vh){d=T.isBracket=!0,g=T.isGlob=!0,b=!0;break}}if(i===!0)continue;break}if(n.nonegate!==!0&&w===pn&&h===c){_=T.negated=!0,c++;continue}if(n.noparen!==!0&&w===vn){if(g=T.isGlob=!0,i===!0){for(;N()!==!0&&(w=L());){if(w===vn){R=T.backslashes=!0,w=L();continue}if(w===zi){b=!0;break}}continue}break}if(g===!0){if(b=!0,i===!0)continue;break}}n.noext===!0&&(y=!1,g=!1);let B=l,O="",m="";c>0&&(O=l.slice(0,c),l=l.slice(c),u-=c),B&&g===!0&&u>0?(B=l.slice(0,u),m=l.slice(u)):g===!0?(B="",m=l):B=l,B&&B!==""&&B!=="/"&&B!==l&&Ki(B.charCodeAt(B.length-1))&&(B=B.slice(0,-1)),n.unescape===!0&&(m&&(m=Di.removeBackslashes(m)),B&&R===!0&&(B=Di.removeBackslashes(B)));let x={prefix:O,input:t,start:c,base:B,glob:m,isBrace:f,isBracket:d,isGlob:g,isExtglob:y,isGlobstar:p,negated:_,negatedExtglob:S};if(n.tokens===!0&&(x.maxDepth=0,Ki(w)||a.push(T),x.tokens=a),n.parts===!0||n.tokens===!0){let F;for(let K=0;K<s.length;K++){let Z=F?F+1:c,Q=s[K],ee=t.slice(Z,Q);n.tokens&&(K===0&&c!==0?(a[K].isPrefix=!0,a[K].value=O):a[K].value=ee,$i(a[K]),x.maxDepth+=a[K].depth),(K!==0||ee!=="")&&o.push(ee),F=Q}if(F&&F+1<t.length){let K=t.slice(F+1);o.push(K),n.tokens&&(a[a.length-1].value=K,$i(a[a.length-1]),x.maxDepth+=a[a.length-1].depth)}x.slashes=s,x.parts=o}return x};Ui.exports=mh});var ji=Se((wp,Wi)=>{"use strict";var yt=qe(),se=xt(),{MAX_LENGTH:Et,POSIX_REGEX_SOURCE:gh,REGEX_NON_SPECIAL_CHARS:xh,REGEX_SPECIAL_CHARS_BACKREF:yh,REPLACEMENTS:Fi}=yt,Eh=(t,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...t,e);t.sort();let n=`[${t.join("-")}]`;try{new RegExp(n)}catch(r){return t.map(i=>se.escapeRegex(i)).join("..")}return n},Be=(t,e)=>`Missing ${t}: "${e}" - use "\\\\${e}" to match literal characters`,mn=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a string");t=Fi[t]||t;let n={...e},r=typeof n.maxLength=="number"?Math.min(Et,n.maxLength):Et,i=t.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);let s={type:"bos",value:"",output:n.prepend||""},a=[s],o=n.capture?"":"?:",l=se.isWindows(e),h=yt.globChars(l),c=yt.extglobChars(h),{DOT_LITERAL:u,PLUS_LITERAL:f,SLASH_LITERAL:d,ONE_CHAR:g,DOTS_SLASH:y,NO_DOT:p,NO_DOT_SLASH:E,NO_DOTS_SLASH:R,QMARK:_,QMARK_NO_DOT:S,STAR:b,START_ANCHOR:k}=h,P=C=>`(${o}(?:(?!${k}${C.dot?y:u}).)*?)`,w=n.dot?"":p,T=n.dot?_:S,N=n.bash===!0?P(n):b;n.capture&&(N=`(${N})`),typeof n.noext=="boolean"&&(n.noextglob=n.noext);let v={input:t,index:-1,start:0,dot:n.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};t=se.removePrefix(t,v),i=t.length;let L=[],B=[],O=[],m=s,x,F=()=>v.index===i-1,K=v.peek=(C=1)=>t[v.index+C],Z=v.advance=()=>t[++v.index]||"",Q=()=>t.slice(v.index+1),ee=(C="",U=0)=>{v.consumed+=C,v.index+=U},he=C=>{v.output+=C.output!=null?C.output:C.value,ee(C.value)},De=()=>{let C=1;for(;K()==="!"&&(K(2)!=="("||K(3)==="?");)Z(),v.start++,C++;return C%2==0?!1:(v.negated=!0,v.start++,!0)},_e=C=>{v[C]++,O.push(C)},ce=C=>{v[C]--,O.pop()},H=C=>{if(m.type==="globstar"){let U=v.braces>0&&(C.type==="comma"||C.type==="brace"),M=C.extglob===!0||L.length&&(C.type==="pipe"||C.type==="paren");C.type!=="slash"&&C.type!=="paren"&&!U&&!M&&(v.output=v.output.slice(0,-m.output.length),m.type="star",m.value="*",m.output=N,v.output+=m.output)}if(L.length&&C.type!=="paren"&&(L[L.length-1].inner+=C.value),(C.value||C.output)&&he(C),m&&m.type==="text"&&C.type==="text"){m.value+=C.value,m.output=(m.output||"")+C.value;return}C.prev=m,a.push(C),m=C},Ce=(C,U)=>{let M={...c[U],conditions:1,inner:""};M.prev=m,M.parens=v.parens,M.output=v.output;let z=(n.capture?"(":"")+M.open;_e("parens"),H({type:C,value:U,output:v.output?"":g}),H({type:"paren",extglob:!0,value:Z(),output:z}),L.push(M)},et=C=>{let U=C.close+(n.capture?")":""),M;if(C.type==="negate"){let z=N;if(C.inner&&C.inner.length>1&&C.inner.includes("/")&&(z=P(n)),(z!==N||F()||/^\)+$/.test(Q()))&&(U=C.close=`)$))${z}`),C.inner.includes("*")&&(M=Q())&&/^\.[^\\/.]+$/.test(M)){let W=mn(M,{...e,fastpaths:!1}).output;U=C.close=`)${W})${z})`}C.prev.type==="bos"&&(v.negatedExtglob=!0)}H({type:"paren",extglob:!0,value:x,output:U}),ce("parens")};if(n.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(t)){let C=!1,U=t.replace(yh,(M,z,W,te,q,St)=>te==="\\"?(C=!0,M):te==="?"?z?z+te+(q?_.repeat(q.length):""):St===0?T+(q?_.repeat(q.length):""):_.repeat(W.length):te==="."?u.repeat(W.length):te==="*"?z?z+te+(q?N:""):N:z?M:`\\${M}`);return C===!0&&(n.unescape===!0?U=U.replace(/\\/g,""):U=U.replace(/\\+/g,M=>M.length%2==0?"\\\\":M?"\\":"")),U===t&&n.contains===!0?(v.output=t,v):(v.output=se.wrapOutput(U,v,e),v)}for(;!F();){if(x=Z(),x==="\0")continue;if(x==="\\"){let M=K();if(M==="/"&&n.bash!==!0||M==="."||M===";")continue;if(!M){x+="\\",H({type:"text",value:x});continue}let z=/^\\+/.exec(Q()),W=0;if(z&&z[0].length>2&&(W=z[0].length,v.index+=W,W%2!=0&&(x+="\\")),n.unescape===!0?x=Z():x+=Z(),v.brackets===0){H({type:"text",value:x});continue}}if(v.brackets>0&&(x!=="]"||m.value==="["||m.value==="[^")){if(n.posix!==!1&&x===":"){let M=m.value.slice(1);if(M.includes("[")&&(m.posix=!0,M.includes(":"))){let z=m.value.lastIndexOf("["),W=m.value.slice(0,z),te=m.value.slice(z+2),q=gh[te];if(q){m.value=W+q,v.backtrack=!0,Z(),!s.output&&a.indexOf(m)===1&&(s.output=g);continue}}}(x==="["&&K()!==":"||x==="-"&&K()==="]")&&(x=`\\${x}`),x==="]"&&(m.value==="["||m.value==="[^")&&(x=`\\${x}`),n.posix===!0&&x==="!"&&m.value==="["&&(x="^"),m.value+=x,he({value:x});continue}if(v.quotes===1&&x!=='"'){x=se.escapeRegex(x),m.value+=x,he({value:x});continue}if(x==='"'){v.quotes=v.quotes===1?0:1,n.keepQuotes===!0&&H({type:"text",value:x});continue}if(x==="("){_e("parens"),H({type:"paren",value:x});continue}if(x===")"){if(v.parens===0&&n.strictBrackets===!0)throw new SyntaxError(Be("opening","("));let M=L[L.length-1];if(M&&v.parens===M.parens+1){et(L.pop());continue}H({type:"paren",value:x,output:v.parens?")":"\\)"}),ce("parens");continue}if(x==="["){if(n.nobracket===!0||!Q().includes("]")){if(n.nobracket!==!0&&n.strictBrackets===!0)throw new SyntaxError(Be("closing","]"));x=`\\${x}`}else _e("brackets");H({type:"bracket",value:x});continue}if(x==="]"){if(n.nobracket===!0||m&&m.type==="bracket"&&m.value.length===1){H({type:"text",value:x,output:`\\${x}`});continue}if(v.brackets===0){if(n.strictBrackets===!0)throw new SyntaxError(Be("opening","["));H({type:"text",value:x,output:`\\${x}`});continue}ce("brackets");let M=m.value.slice(1);if(m.posix!==!0&&M[0]==="^"&&!M.includes("/")&&(x=`/${x}`),m.value+=x,he({value:x}),n.literalBrackets===!1||se.hasRegexChars(M))continue;let z=se.escapeRegex(m.value);if(v.output=v.output.slice(0,-m.value.length),n.literalBrackets===!0){v.output+=z,m.value=z;continue}m.value=`(${o}${z}|${m.value})`,v.output+=m.value;continue}if(x==="{"&&n.nobrace!==!0){_e("braces");let M={type:"brace",value:x,output:"(",outputIndex:v.output.length,tokensIndex:v.tokens.length};B.push(M),H(M);continue}if(x==="}"){let M=B[B.length-1];if(n.nobrace===!0||!M){H({type:"text",value:x,output:x});continue}let z=")";if(M.dots===!0){let W=a.slice(),te=[];for(let q=W.length-1;q>=0&&(a.pop(),W[q].type!=="brace");q--)W[q].type!=="dots"&&te.unshift(W[q].value);z=Eh(te,n),v.backtrack=!0}if(M.comma!==!0&&M.dots!==!0){let W=v.output.slice(0,M.outputIndex),te=v.tokens.slice(M.tokensIndex);M.value=M.output="\\{",x=z="\\}",v.output=W;for(let q of te)v.output+=q.output||q.value}H({type:"brace",value:x,output:z}),ce("braces"),B.pop();continue}if(x==="|"){L.length>0&&L[L.length-1].conditions++,H({type:"text",value:x});continue}if(x===","){let M=x,z=B[B.length-1];z&&O[O.length-1]==="braces"&&(z.comma=!0,M="|"),H({type:"comma",value:x,output:M});continue}if(x==="/"){if(m.type==="dot"&&v.index===v.start+1){v.start=v.index+1,v.consumed="",v.output="",a.pop(),m=s;continue}H({type:"slash",value:x,output:d});continue}if(x==="."){if(v.braces>0&&m.type==="dot"){m.value==="."&&(m.output=u);let M=B[B.length-1];m.type="dots",m.output+=x,m.value+=x,M.dots=!0;continue}if(v.braces+v.parens===0&&m.type!=="bos"&&m.type!=="slash"){H({type:"text",value:x,output:u});continue}H({type:"dot",value:x,output:u});continue}if(x==="?"){if(!(m&&m.value==="(")&&n.noextglob!==!0&&K()==="("&&K(2)!=="?"){Ce("qmark",x);continue}if(m&&m.type==="paren"){let z=K(),W=x;if(z==="<"&&!se.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(m.value==="("&&!/[!=<:]/.test(z)||z==="<"&&!/<([!=]|\w+>)/.test(Q()))&&(W=`\\${x}`),H({type:"text",value:x,output:W});continue}if(n.dot!==!0&&(m.type==="slash"||m.type==="bos")){H({type:"qmark",value:x,output:S});continue}H({type:"qmark",value:x,output:_});continue}if(x==="!"){if(n.noextglob!==!0&&K()==="("&&(K(2)!=="?"||!/[!=<:]/.test(K(3)))){Ce("negate",x);continue}if(n.nonegate!==!0&&v.index===0){De();continue}}if(x==="+"){if(n.noextglob!==!0&&K()==="("&&K(2)!=="?"){Ce("plus",x);continue}if(m&&m.value==="("||n.regex===!1){H({type:"plus",value:x,output:f});continue}if(m&&(m.type==="bracket"||m.type==="paren"||m.type==="brace")||v.parens>0){H({type:"plus",value:x});continue}H({type:"plus",value:f});continue}if(x==="@"){if(n.noextglob!==!0&&K()==="("&&K(2)!=="?"){H({type:"at",extglob:!0,value:x,output:""});continue}H({type:"text",value:x});continue}if(x!=="*"){(x==="$"||x==="^")&&(x=`\\${x}`);let M=xh.exec(Q());M&&(x+=M[0],v.index+=M[0].length),H({type:"text",value:x});continue}if(m&&(m.type==="globstar"||m.star===!0)){m.type="star",m.star=!0,m.value+=x,m.output=N,v.backtrack=!0,v.globstar=!0,ee(x);continue}let C=Q();if(n.noextglob!==!0&&/^\([^?]/.test(C)){Ce("star",x);continue}if(m.type==="star"){if(n.noglobstar===!0){ee(x);continue}let M=m.prev,z=M.prev,W=M.type==="slash"||M.type==="bos",te=z&&(z.type==="star"||z.type==="globstar");if(n.bash===!0&&(!W||C[0]&&C[0]!=="/")){H({type:"star",value:x,output:""});continue}let q=v.braces>0&&(M.type==="comma"||M.type==="brace"),St=L.length&&(M.type==="pipe"||M.type==="paren");if(!W&&M.type!=="paren"&&!q&&!St){H({type:"star",value:x,output:""});continue}for(;C.slice(0,3)==="/**";){let tt=t[v.index+4];if(tt&&tt!=="/")break;C=C.slice(3),ee("/**",3)}if(M.type==="bos"&&F()){m.type="globstar",m.value+=x,m.output=P(n),v.output=m.output,v.globstar=!0,ee(x);continue}if(M.type==="slash"&&M.prev.type!=="bos"&&!te&&F()){v.output=v.output.slice(0,-(M.output+m.output).length),M.output=`(?:${M.output}`,m.type="globstar",m.output=P(n)+(n.strictSlashes?")":"|$)"),m.value+=x,v.globstar=!0,v.output+=M.output+m.output,ee(x);continue}if(M.type==="slash"&&M.prev.type!=="bos"&&C[0]==="/"){let tt=C[1]!==void 0?"|$":"";v.output=v.output.slice(0,-(M.output+m.output).length),M.output=`(?:${M.output}`,m.type="globstar",m.output=`${P(n)}${d}|${d}${tt})`,m.value+=x,v.output+=M.output+m.output,v.globstar=!0,ee(x+Z()),H({type:"slash",value:"/",output:""});continue}if(M.type==="bos"&&C[0]==="/"){m.type="globstar",m.value+=x,m.output=`(?:^|${d}|${P(n)}${d})`,v.output=m.output,v.globstar=!0,ee(x+Z()),H({type:"slash",value:"/",output:""});continue}v.output=v.output.slice(0,-m.output.length),m.type="globstar",m.output=P(n),m.value+=x,v.output+=m.output,v.globstar=!0,ee(x);continue}let U={type:"star",value:x,output:N};if(n.bash===!0){U.output=".*?",(m.type==="bos"||m.type==="slash")&&(U.output=w+U.output),H(U);continue}if(m&&(m.type==="bracket"||m.type==="paren")&&n.regex===!0){U.output=x,H(U);continue}(v.index===v.start||m.type==="slash"||m.type==="dot")&&(m.type==="dot"?(v.output+=E,m.output+=E):n.dot===!0?(v.output+=R,m.output+=R):(v.output+=w,m.output+=w),K()!=="*"&&(v.output+=g,m.output+=g)),H(U)}for(;v.brackets>0;){if(n.strictBrackets===!0)throw new SyntaxError(Be("closing","]"));v.output=se.escapeLast(v.output,"["),ce("brackets")}for(;v.parens>0;){if(n.strictBrackets===!0)throw new SyntaxError(Be("closing",")"));v.output=se.escapeLast(v.output,"("),ce("parens")}for(;v.braces>0;){if(n.strictBrackets===!0)throw new SyntaxError(Be("closing","}"));v.output=se.escapeLast(v.output,"{"),ce("braces")}if(n.strictSlashes!==!0&&(m.type==="star"||m.type==="bracket")&&H({type:"maybe_slash",value:"",output:`${d}?`}),v.backtrack===!0){v.output="";for(let C of v.tokens)v.output+=C.output!=null?C.output:C.value,C.suffix&&(v.output+=C.suffix)}return v};mn.fastpaths=(t,e)=>{let n={...e},r=typeof n.maxLength=="number"?Math.min(Et,n.maxLength):Et,i=t.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);t=Fi[t]||t;let s=se.isWindows(e),{DOT_LITERAL:a,SLASH_LITERAL:o,ONE_CHAR:l,DOTS_SLASH:h,NO_DOT:c,NO_DOTS:u,NO_DOTS_SLASH:f,STAR:d,START_ANCHOR:g}=yt.globChars(s),y=n.dot?u:c,p=n.dot?f:c,E=n.capture?"":"?:",R={negated:!1,prefix:""},_=n.bash===!0?".*?":d;n.capture&&(_=`(${_})`);let S=w=>w.noglobstar===!0?_:`(${E}(?:(?!${g}${w.dot?h:a}).)*?)`,b=w=>{switch(w){case"*":return`${y}${l}${_}`;case".*":return`${a}${l}${_}`;case"*.*":return`${y}${_}${a}${l}${_}`;case"*/*":return`${y}${_}${o}${l}${p}${_}`;case"**":return y+S(n);case"**/*":return`(?:${y}${S(n)}${o})?${p}${l}${_}`;case"**/*.*":return`(?:${y}${S(n)}${o})?${p}${_}${a}${l}${_}`;case"**/.*":return`(?:${y}${S(n)}${o})?${a}${l}${_}`;default:{let T=/^(.*?)\.(\w+)$/.exec(w);if(!T)return;let N=b(T[1]);return N?N+a+T[2]:void 0}}},k=se.removePrefix(t,R),P=b(k);return P&&n.strictSlashes!==!0&&(P+=`${o}?`),P};Wi.exports=mn});var Gi=Se((_p,Xi)=>{"use strict";var wh=mt(),_h=Yi(),gn=ji(),xn=xt(),Mh=qe(),bh=t=>t&&typeof t=="object"&&!Array.isArray(t),G=(t,e,n=!1)=>{if(Array.isArray(t)){let c=t.map(f=>G(f,e,n));return f=>{for(let d of c){let g=d(f);if(g)return g}return!1}}let r=bh(t)&&t.tokens&&t.input;if(t===""||typeof t!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let i=e||{},s=xn.isWindows(e),a=r?G.compileRe(t,e):G.makeRe(t,e,!1,!0),o=a.state;delete a.state;let l=()=>!1;if(i.ignore){let c={...e,ignore:null,onMatch:null,onResult:null};l=G(i.ignore,c,n)}let h=(c,u=!1)=>{let{isMatch:f,match:d,output:g}=G.test(c,a,e,{glob:t,posix:s}),y={glob:t,state:o,regex:a,posix:s,input:c,output:g,match:d,isMatch:f};return typeof i.onResult=="function"&&i.onResult(y),f===!1?(y.isMatch=!1,u?y:!1):l(c)?(typeof i.onIgnore=="function"&&i.onIgnore(y),y.isMatch=!1,u?y:!1):(typeof i.onMatch=="function"&&i.onMatch(y),u?y:!0)};return n&&(h.state=o),h};G.test=(t,e,n,{glob:r,posix:i}={})=>{if(typeof t!="string")throw new TypeError("Expected input to be a string");if(t==="")return{isMatch:!1,output:""};let s=n||{},a=s.format||(i?xn.toPosixSlashes:null),o=t===r,l=o&&a?a(t):t;return o===!1&&(l=a?a(t):t,o=l===r),(o===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?o=G.matchBase(t,e,n,i):o=e.exec(l)),{isMatch:Boolean(o),match:o,output:l}};G.matchBase=(t,e,n,r=xn.isWindows(n))=>(e instanceof RegExp?e:G.makeRe(e,n)).test(wh.basename(t));G.isMatch=(t,e,n)=>G(e,n)(t);G.parse=(t,e)=>Array.isArray(t)?t.map(n=>G.parse(n,e)):gn(t,{...e,fastpaths:!1});G.scan=(t,e)=>_h(t,e);G.compileRe=(t,e,n=!1,r=!1)=>{if(n===!0)return t.output;let i=e||{},s=i.contains?"":"^",a=i.contains?"":"$",o=`${s}(?:${t.output})${a}`;t&&t.negated===!0&&(o=`^(?!${o}).*$`);let l=G.toRegex(o,e);return r===!0&&(l.state=t),l};G.makeRe=(t,e={},n=!1,r=!1)=>{if(!t||typeof t!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(t[0]==="."||t[0]==="*")&&(i.output=gn.fastpaths(t,e)),i.output||(i=gn(t,e)),G.compileRe(i,e,n,r)};G.toRegex=(t,e)=>{try{let n=e||{};return new RegExp(t,n.flags||(n.nocase?"i":""))}catch(n){if(e&&e.debug===!0)throw n;return/$^/}};G.constants=Mh;Xi.exports=G});var Vi=Se((Mp,qi)=>{"use strict";qi.exports=Gi()});var Is=`
<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <slot id="inner">
      <canvas>
        Oh no! Your browser does not support canvas.
      </canvas>
    </slot>
    <slot name="overlay"></slot>
  </div>
  <slot name="frame"></slot>
</div>`,Rs=`
:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
  overflow: hidden;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}`,kn="noscale";var kt="fit",Tn="scale",In="fill",Rn="stretch",Ln=300,Bn=150,On=kt,Ls=200,Pe=class extends HTMLElement{static create(e={}){let{root:n=document.body,id:r=void 0,mode:i=On,width:s=Ln,height:a=Bn,debug:o=!1}=e||{},l=new Pe;return l.id=r,l.mode=i,l.width=s,l.height=a,l.debug=o,n.appendChild(l),l}static define(e=window.customElements){e.define("display-port",this)}static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Is,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=Rs,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(e){this.setAttribute("mode",e)}get debug(){return this._debug}set debug(e){this.toggleAttribute("debug",e)}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get onframe(){return this._onframe}set onframe(e){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=e,this._onframe&&this.addEventListener("frame",e)}constructor(){super();let e=this.attachShadow({mode:"open"});e.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=null,this._contentElement=e.querySelector(".content"),this._innerElement=e.querySelector("#inner"),this._titleElement=e.querySelector("#title"),this._fpsElement=e.querySelector("#fps"),this._dimensionElement=e.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=Ln,this._height=Bn,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this),this.onSlotChange=this.onSlotChange.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Re(this,"mode"),Re(this,"debug"),Re(this,"disabled"),Re(this,"width"),Re(this,"height"),Re(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",On),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this._innerElement.addEventListener("slotchange",this.onSlotChange),this._canvasElement=this._innerElement.querySelector("canvas"),this._canvasElement&&(this.updateCanvasSize(!0),this.resume())}disconnectedCallback(){this._innerElement.removeEventListener("slotchange",this.onSlotChange),this.pause()}attributeChangedCallback(e,n,r){switch(e){case"debug":this._debug=r!==null;break;case"disabled":this._disabled=r!==null;break;case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this);break}switch(e){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r);break}}onSlotChange(e){let i=e.target.assignedElements({flatten:!0}).find(s=>s instanceof HTMLCanvasElement);if(!i)throw new Error("No valid canvas element found for display.");this._canvasElement=i,this.updateCanvasSize(!0),this.resume()}getContext(e="2d",n=void 0){return this._canvasElement.getContext(e,n)}pause(){window.cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=window.requestAnimationFrame(this.update)}update(e){this._animationRequestHandle=window.requestAnimationFrame(this.update),this.updateCanvasSize(!1);let n=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this._debug){let s=n<=0?"--":String(Math.round(1e3/n)).padStart(2,"0");if(this._fpsElement.textContent!==s&&(this._fpsElement.textContent=s),this.mode===kn){let o=`${this._width}x${this._height}`;this._dimensionElement.textContent!==o&&(this._dimensionElement.textContent=o)}else{let o=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==o&&(this._dimensionElement.textContent=o)}}let i=this._frameEvent.detail;i.now=e,i.prevTime=this._prevAnimationFrameTime,i.deltaTime=n,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=null,this.updateCanvasSize(!0)}delayCanvasResize(e,n){(e!==this._resizeCanvasWidth||n!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=e,this._resizeCanvasHeight=n,this._resizeTimeoutHandle&&window.clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=window.setTimeout(this.onDelayCanvasResize,Ls))}updateCanvasSize(e=!0){let n=this.shadowRoot.host.getBoundingClientRect(),r=n.width,i=n.height,s=this._canvasElement,a=this._width,o=this._height,l=this.mode;if(l===Rn||l===In)a=r,o=i;else if(l!==kn&&(r<a||i<o||l===kt||l==Tn)){let c=r/a,u=i/o;c<u?(a=r,o=o*c):(a=a*u,o=i)}if(a=Math.floor(a),o=Math.floor(o),typeof e=="undefined"&&(e=s.clientWidth!==a||s.clientHeight!==o),!e){this.delayCanvasResize(a,o);return}let h=Math.min(a/this._width,o/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${h}em`,e){l===Tn?(s.width=this._width,s.height=this._height):l!==Rn&&(s.width=a,s.height=o);let c=this._contentElement.style;c.width=`${a}px`,c.height=`${o}px`,(l===kt||l===In)&&(this._width=a,this._height=o);let f=this._resizeEvent.detail;f.width=a,f.height=o,this.dispatchEvent(this._resizeEvent)}}};function Re(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let n=t[e];delete t[e],t[e]=n}}var Bs=`<div class="container">
  <div class="padding"></div>
  <div class="innerContainer">
    <div class="padding"></div>
    <slot><canvas>Oh no! Your browser does not support canvas.</canvas></slot>
    <div class="padding"></div>
  </div>
  <div class="padding"></div>
</div>`,Os=`
:host {
  display: inline-block;
  flex: 1;
  --width: 300px;
  --height: 150px;
}
:host([scaling="noscale"]) {
  width: var(--width);
  height: var(--height);
}
:host([sizing="viewport"]) {
    position: fixed;
    top: 0;
    left: 0;
}
.container {
  position: relative;
  display: flex;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.innerContainer {
  display: flex;
  flex-direction: column;
}
.padding {
  flex: 1;
}`,Nn="scale",Ns="conatiner",Dn=300,Pn=150,it=class extends HTMLElement{static create(e={}){let{root:n=document.body,id:r=void 0,scaling:i=Nn,sizing:s=Ns,width:a=Dn,height:o=Pn}=e||{};window.customElements.get("flex-canvas")||window.customElements.define("flex-canvas",it);let l=new it;return l.id=r,l.scaling=i,l.sizing=s,l.width=a,l.height=o,n.appendChild(l),l}static define(e=window.customElements){e.define("flex-canvas",this)}static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Bs,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=Os,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static get observedAttributes(){return["sizing","width","height","resize-delay"]}get scaling(){return this.getAttribute("scaling")}set scaling(e){this.setAttribute("scaling",e)}get sizing(){return this._sizing}set sizing(e){this.setAttribute("sizing",String(e))}get resizeDelay(){return this._resizeDelay}set resizeDelay(e){this.setAttribute("resize-delay",String(e))}get width(){return this._width}set width(e){this.setAttribute("width",String(e))}get height(){return this._height}set height(e){this.setAttribute("height",String(e))}get canvas(){return this.canvasElement}constructor(){super();let e=this.attachShadow({mode:"open"});e.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._sizing="none",this._width=Dn,this._height=Pn,this._resizeDelay=0,this.animationFrameHandle=0,this.resizeTimeoutHandle=0,this.resizeCanvasWidth=0,this.resizeCanvasHeight=0,this.canvasSlotElement=e.querySelector("slot"),this.canvasElement=null,this.onResize=this.onResize.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this),this.onSlotChange=this.onSlotChange.bind(this)}connectedCallback(){He(this,"scaling"),He(this,"sizing"),He(this,"width"),He(this,"height"),He(this,"resize-delay"),this.hasAttribute("scaling")||this.setAttribute("scaling",Nn),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.canvasSlotElement.addEventListener("slotchange",this.onSlotChange),this.canvasElement||this.setCanvasElement(this.canvasSlotElement.querySelector("canvas"))}disconnectedCallback(){cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=null,this.canvasSlotElement.removeEventListener("slotchange",this.onSlotChange)}attributeChangedCallback(e,n,r){switch(e){case"sizing":switch(this._sizing=String(r),this._sizing){case"none":this.style.removeProperty("width"),this.style.removeProperty("height");break;case"container":this.style.setProperty("width","100%"),this.style.setProperty("height","100%");break;case"viewport":this.style.setProperty("width","100vw"),this.style.setProperty("height","100vh");break;default:let[i,s]=this._sizing.split(" ");i&&s&&(this.style.setProperty("width",i),this.style.setProperty("height",s));break}break;case"width":this._width=Number(r),this.canvasElement&&(this.canvasElement.width=this._width);break;case"height":this._height=Number(r),this.canvasElement&&(this.canvasElement.height=this._height);break;case"resize-delay":this._resizeDelay=Number(r);break}}onAnimationFrame(e){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),!(this.clientWidth===this.resizeCanvasWidth&&this.clientHeight===this.resizeCanvasHeight)&&(this.resizeCanvasWidth=this.clientWidth,this.resizeCanvasHeight=this.clientHeight,this._resizeDelay>0?this.resizeTimeoutHandle||(this.resizeTimeoutHandle=window.setTimeout(this.onResize,this._resizeDelay)):this.onResize())}onResize(){window.clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=null;let e=this.canvasElement;if(!e)return;let n=this.scaling,r=this.getBoundingClientRect(),i=r.width,s=r.height,a=this._width,o=this._height,l=i/a,h=s/o;n==="noscale"&&(this.style.setProperty("--width",`${a}px`),this.style.setProperty("--height",`${o}px`)),n==="scale"&&(l<h?(e.style.setProperty("width",`${Math.floor(i)}px`),e.style.setProperty("height",`${Math.floor(o*l)}px`)):(e.style.setProperty("width",`${Math.floor(a*h)}px`),e.style.setProperty("height",`${Math.floor(s)}px`))),n==="stretch"&&(e.style.setProperty("width",`${Math.floor(i)}px`),e.style.setProperty("height",`${Math.floor(s)}px`)),n==="fit"&&(l<h?(a=Math.floor(i),o=Math.floor(o*l),e.style.setProperty("width",`${a}px`),e.style.setProperty("height",`${o}px`)):(a=Math.floor(a*h),o=Math.floor(s),e.style.setProperty("width",`${a}px`),e.style.setProperty("height",`${o}px`)),e.width!==a&&(e.width=a),e.height!==o&&(e.height=o)),n==="fill"&&(l<h?(a=Math.floor(i),o=Math.floor(s),e.style.setProperty("width",`${a}px`),e.style.setProperty("height",`${o}px`)):(a=Math.floor(i),o=Math.floor(s),e.style.setProperty("width",`${a}px`),e.style.setProperty("height",`${o}px`)),e.width!==a&&(e.width=a),e.height!==o&&(e.height=o))}onSlotChange(e){let i=e.target.assignedElements({flatten:!0}).find(s=>s instanceof HTMLCanvasElement);i&&this.setCanvasElement(i)}setCanvasElement(e){e.width=this._width,e.height=this._height,e.style.imageRendering="pixelated",this.canvasElement=e}getContext(e="2d",n=void 0){return this.canvasElement.getContext(e,n)}};function He(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let n=t[e];delete t[e],t[e]=n}}var Tt=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(e){this._size=e,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(e){this._size=e}getState(e){throw new Error("Missing implementation.")}onUpdate(e,n,r){throw new Error("Missing implementation.")}onStatus(e,n){throw new Error("Missing implementation.")}onPoll(e){this._lastPollingTime=e}onBind(e,n=void 0){e>=this._size&&this.resize(e+1)}onUnbind(){this.resize(0)}},ze=class extends Tt{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(e=0){super(e);let n=new Array,r=this.constructor;for(let i=0;i<e;++i)n.push(r.createAxisBindingState());this._state=n,this._value=0,this._delta=0}resize(e){let n=this._state,r=n.length,i;if(e<=r)i=n.slice(0,e);else{i=n;let s=this.constructor;for(let a=r;a<e;++a)i.push(s.createAxisBindingState())}this._state=i,super.resize(e)}getState(e){return this._state[e].value}onPoll(e){let n=this._state,r=0,i=0,s=n.length;for(let a=0;a<s;++a){let o=n[a];r+=o.value*(o.inverted?-1:1),i+=o.delta,n[a].delta=0}this._value=r,this._delta=i,super.onPoll(e)}onUpdate(e,n,r){typeof n=="undefined"?this.onAxisChange(e,r):this.onAxisMove(e,n,r)}onStatus(e,n){this.onAxisStatus(e,n)}onBind(e,n=void 0){super.onBind(e,n);let{inverted:r=!1}=n||{},i=this._state;i[e].inverted=r}onAxisMove(e,n,r){let i=this._state[e];i.value=n,i.delta+=r}onAxisChange(e,n){let r=this._state[e];r.value+=n,r.delta+=n}onAxisStatus(e,n){let r=this._state[e],i=r.value;r.value=n,r.delta=n-i}},Ds=241,Hn=254,Ps=239,ke=1,It=2,Rt=4,Lt=8,Bt=16,st=class extends Tt{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(e=0){super(e);this._state=new Uint8Array(e),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(e){let n=this._state,r=n.length,i;e<=r?i=n.slice(0,e):(i=new Uint8Array(e),i.set(n)),this._state=i,super.resize(e)}getState(e){let n=this._state[e],r=n&Bt?-1:1;return(n&ke?1:0)*r}onPoll(e){let n=this._state,r=0,i=0,s=0,a=0,o=0,l=n.length;for(let h=0;h<l;++h){let c=n[h],u=c&ke,f=c&Bt;i|=u,s|=c&It,a|=c&Rt,o|=c&Lt,r+=(u?1:0)*(f?-1:1),n[h]&=Ds}this._value=r,this._down=i!==0,this._pressed=s!==0,this._repeated=a!==0,this._released=o!==0,super.onPoll(e)}onUpdate(e,n,r){r>0?this.onButtonPressed(e):this.onButtonReleased(e)}onStatus(e,n){this.onButtonStatus(e,n!==0)}onBind(e,n={inverted:!1}){super.onBind(e,n);let{inverted:r=!1}=n,i=this._state;r?i[e]|=Bt:i[e]&=Ps}onButtonPressed(e){let n=this._state,r=n[e];r&ke||(r|=It,r|=ke),r|=Rt,n[e]=r}onButtonReleased(e){let n=this._state,r=n[e];r&ke&&(r|=Lt,r&=Hn),n[e]=r}onButtonStatus(e,n){let r=this._state,i=r[e],s=Boolean(i&ke);n?i|=ke:i&=Hn,s&&!n&&(i|=Lt),!s&&n&&(i|=It,i|=Rt),r[e]=i}},A=class{static parse(e){e=e.trim();let n=e.indexOf(".");if(n<0)throw new Error("Missing device separator for key code.");let r=e.substring(0,n);if(r.length<0)throw new Error("Missing device for key code.");let i=e.substring(n+1);if(i.length<0)throw new Error("Missing code for key code.");return new A(r,i)}constructor(e,n){this.device=e,this.code=n}toString(){return`${this.device}.${this.code}`}};var I="Keyboard",ue="Mouse",ic=new A(I,"KeyA"),sc=new A(I,"KeyB"),ac=new A(I,"KeyC"),oc=new A(I,"KeyD"),lc=new A(I,"KeyE"),hc=new A(I,"KeyF"),cc=new A(I,"KeyG"),uc=new A(I,"KeyH"),fc=new A(I,"KeyI"),pc=new A(I,"KeyJ"),dc=new A(I,"KeyK"),vc=new A(I,"KeyL"),mc=new A(I,"KeyM"),gc=new A(I,"KeyN"),xc=new A(I,"KeyO"),yc=new A(I,"KeyP"),Ec=new A(I,"KeyQ"),wc=new A(I,"KeyR"),_c=new A(I,"KeyS"),Mc=new A(I,"KeyT"),bc=new A(I,"KeyU"),Ac=new A(I,"KeyV"),Cc=new A(I,"KeyW"),Sc=new A(I,"KeyX"),kc=new A(I,"KeyY"),Tc=new A(I,"KeyZ"),Ic=new A(I,"Digit0"),Rc=new A(I,"Digit1"),Lc=new A(I,"Digit2"),Bc=new A(I,"Digit3"),Oc=new A(I,"Digit4"),Nc=new A(I,"Digit5"),Dc=new A(I,"Digit6"),Pc=new A(I,"Digit7"),Hc=new A(I,"Digit8"),zc=new A(I,"Digit9"),Kc=new A(I,"Minus"),$c=new A(I,"Equal"),Uc=new A(I,"BracketLeft"),Yc=new A(I,"BracketRight"),Fc=new A(I,"Semicolon"),Wc=new A(I,"Quote"),jc=new A(I,"Backquote"),Xc=new A(I,"Backslash"),Gc=new A(I,"Comma"),qc=new A(I,"Period"),Vc=new A(I,"Slash"),Zc=new A(I,"Escape"),Qc=new A(I,"Space"),Jc=new A(I,"CapsLock"),eu=new A(I,"Backspace"),tu=new A(I,"Delete"),nu=new A(I,"Tab"),ru=new A(I,"Enter"),iu=new A(I,"ArrowUp"),su=new A(I,"ArrowDown"),au=new A(I,"ArrowLeft"),ou=new A(I,"ArrowRight"),lu=new A(ue,"Button0"),hu=new A(ue,"Button1"),cu=new A(ue,"Button2"),uu=new A(ue,"Button3"),fu=new A(ue,"Button4"),pu=new A(ue,"PosX"),du=new A(ue,"PosY"),vu=new A(ue,"WheelX"),mu=new A(ue,"WheelY"),gu=new A(ue,"WheelZ");var Ot=class{static isAxis(e){return!1}static isButton(e){return!1}constructor(e,n){if(!n)throw new Error(`Missing event target for device ${e}.`);this.name=e,this.eventTarget=n,this.listeners={input:[]}}setEventTarget(e){if(!e)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=e}destroy(){let e=this.listeners;for(let n in e)e[n].length=0}addEventListener(e,n){let r=this.listeners;e in r?r[e].push(n):r[e]=[n]}removeEventListener(e,n){let r=this.listeners;if(e in r){let i=r[e],s=i.indexOf(n);s>=0&&i.splice(s,1)}}dispatchInputEvent(e){let n=0;for(let r of this.listeners.input)n|=r(e);return Boolean(n)}},zn=class extends Ot{static isAxis(e){return!1}static isButton(e){return!0}constructor(e,n,r={}){super(e,n);let{ignoreRepeat:i=!0}=r;this.ignoreRepeat=i,this._eventObject={target:n,device:e,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),n.addEventListener("keydown",this.onKeyDown),n.addEventListener("keyup",this.onKeyUp)}setEventTarget(e){this.eventTarget&&this.destroy(),super.setEventTarget(e),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}destroy(){let e=this.eventTarget;e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(e){if(e.repeat&&this.ignoreRepeat)return e.preventDefault(),e.stopPropagation(),!1;let n=this._eventObject;if(n.code=e.code,n.event="pressed",n.value=1,n.control=e.ctrlKey,n.shift=e.shiftKey,n.alt=e.altKey,this.dispatchInputEvent(n))return e.preventDefault(),e.stopPropagation(),!1}onKeyUp(e){let n=this._eventObject;if(n.code=e.code,n.event="released",n.value=1,n.control=e.ctrlKey,n.shift=e.shiftKey,n.alt=e.altKey,this.dispatchInputEvent(n))return e.preventDefault(),e.stopPropagation(),!1}},Nt=10,Dt=100,Kn=class extends Ot{static isAxis(e){return e==="PosX"||e==="PosY"||e==="WheelX"||e==="WheelY"||e==="WheelZ"}static isButton(e){return!this.isAxis(e)}constructor(e,n,r={}){super(e,n);let{eventsOnFocus:i=!0}=r;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(n),this._downHasFocus=!1,this._eventObject={target:n,device:e,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:n,device:e,code:"",event:"move",value:0,movement:0},this._wheelObject={target:n,device:e,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),n.addEventListener("mousedown",this.onMouseDown),n.addEventListener("contextmenu",this.onContextMenu),n.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(e){this.eventTarget&&this.destroy(),super.setEventTarget(e),this.canvasTarget=this.getCanvasFromEventTarget(e),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let e=this.eventTarget;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("contextmenu",this.onContextMenu),e.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(e=!0){e?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(e){this._downHasFocus=!0;let n=this._eventObject;if(n.code="Button"+e.button,n.event="pressed",n.value=1,n.control=e.ctrlKey,n.shift=e.shiftKey,n.alt=e.altKey,this.dispatchInputEvent(n)&&document.activeElement===this.eventTarget)return e.preventDefault(),e.stopPropagation(),!1}onContextMenu(e){return e.preventDefault(),e.stopPropagation(),!1}onWheel(e){let n,r,i;switch(e.deltaMode){case WheelEvent.DOM_DELTA_LINE:n=e.deltaX*Nt,r=e.deltaY*Nt,i=e.deltaZ*Nt;break;case WheelEvent.DOM_DELTA_PAGE:n=e.deltaX*Dt,r=e.deltaY*Dt,i=e.deltaZ*Dt;break;case WheelEvent.DOM_DELTA_PIXEL:default:n=e.deltaX,r=e.deltaY,i=e.deltaZ;break}let s=0,a=this._wheelObject;if(a.code="WheelX",a.movement=n,s|=this.dispatchInputEvent(a),a.code="WheelY",a.movement=r,s|=this.dispatchInputEvent(a),a.code="WheelZ",a.movement=i,s|=this.dispatchInputEvent(a),s)return e.preventDefault(),e.stopPropagation(),!1}onMouseUp(e){if(!this._downHasFocus)return;this._downHasFocus=!1;let n=this._eventObject;if(n.code="Button"+e.button,n.event="released",n.value=1,n.control=e.ctrlKey,n.shift=e.shiftKey,n.alt=e.altKey,this.dispatchInputEvent(n))return e.preventDefault(),e.stopPropagation(),!1}onMouseMove(e){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let n=this.canvasTarget,{clientWidth:r,clientHeight:i}=n,s=n.getBoundingClientRect(),a=e.movementX/r,o=e.movementY/i,l=(e.clientX-s.left)/r,h=(e.clientY-s.top)/i,c=this._positionObject;c.code="PosX",c.value=l,c.movement=a,this.dispatchInputEvent(c),c.code="PosY",c.value=h,c.movement=o,this.dispatchInputEvent(c)}getCanvasFromEventTarget(e){return e instanceof HTMLCanvasElement?e:e.canvas||e.querySelector("canvas")||e.shadowRoot&&e.shadowRoot.querySelector("canvas")||e}},Hs=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,zs=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Pt=class extends HTMLElement{static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Hs,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=zs,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(e){this.toggleAttribute("disabled",e)}get value(){return this._value}set value(e){this.setAttribute("value",e)}get name(){return this._name}set name(e){this.setAttribute("name",e)}constructor(){super();let e=this.constructor,n=this.attachShadow({mode:"open"});n.appendChild(e[Symbol.for("templateNode")].content.cloneNode(!0)),n.appendChild(e[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=n.querySelector("kbd"),this._nameElement=n.querySelector("#name"),this._valueElement=n.querySelector("#value")}attributeChangedCallback(e,n,r){switch(e){case"name":this._name=r,this._nameElement.textContent=r;break;case"value":this._value=r,r!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=r,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=r!==null,this._kbdElement.classList.toggle("disabled",r!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let e=this.name;delete this.name,this.name=e}if(Object.prototype.hasOwnProperty.call(this,"value")){let e=this.value;delete this.value,this.value=e}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let e=this.disabled;delete this.disabled,this.disabled=e}}};Pt.define();var Ks=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,$s=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,$n=class{constructor(e){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=e}get running(){return this.animationFrameHandle!==null}start(){let e=this.animationFrameHandle;e&&cancelAnimationFrame(e),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let e=this.animationFrameHandle;e&&cancelAnimationFrame(e),this.animationFrameHandle=null}onAnimationFrame(e){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(e)}},Un=class{constructor(e){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=e}onPoll(e){for(let n of this.bindings.getInputs())n.onPoll(e)}onInput(e){let{device:n,code:r,event:i,value:s,movement:a,control:o,shift:l,alt:h}=e,c=this.bindings.getBindings(n,r);switch(i){case"pressed":for(let{input:u,index:f}of c)u.onUpdate(f,1,1);break;case"released":for(let{input:u,index:f}of c)u.onUpdate(f,0,-1);break;case"move":for(let{input:u,index:f}of c)u.onUpdate(f,s,a);break;case"wheel":for(let{input:u,index:f}of c)u.onUpdate(f,void 0,a);break}return c.length>0}},Ht=class{constructor(e,n,r,i){this.device=e,this.code=n,this.input=r,this.index=i}},Yn=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let e of this.inputMap.keys())e.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(e,n,r,i={inverted:!1}){let s,a=this.inputMap;if(a.has(e)){let l=a.get(e),h=e.size;e.onBind(h,i),s=new Ht(n,r,e,h),l.push(s)}else{let l=[];a.set(e,l);let h=0;e.onBind(h,i),s=new Ht(n,r,e,h),l.push(s)}let o=this.bindingMap;n in o?r in o[n]?o[n][r].push(s):o[n][r]=[s]:o[n]={[r]:[s]}}unbind(e){let n=this.inputMap;if(n.has(e)){let r=this.bindingMap,i=n.get(e);for(let s of i){let{device:a,code:o}=s,l=r[a][o],h=l.indexOf(s);l.splice(h,1)}i.length=0,e.onUnbind(),n.delete(e)}}isBound(e){return this.inputMap.has(e)}getInputs(){return this.inputMap.keys()}getBindingsByInput(e){return this.inputMap.get(e)}getBindings(e,n){let r=this.bindingMap;if(e in r){let i=r[e];if(n in i)return i[n]}return[]}},Fn=class{constructor(e,n=void 0){this.inputs={},this.devices=[new Kn("Mouse",e),new zn("Keyboard",e)],this.bindings=new Yn,this.adapter=new Un(this.bindings),this.autopoller=new $n(this.adapter),this.eventTarget=e,this.anyButton=new st(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new ze(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),e.addEventListener("focus",this.onEventTargetFocus),e.addEventListener("blur",this.onEventTargetBlur);for(let r of this.devices)r.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(e){this.toggleAutoPoll(e)}destroy(){let e=this.listeners;for(let r in e)e[r].length=0;this.autopoller.running&&this.autopoller.stop();for(let r of this.devices)r.removeEventListener("input",this.onInput),r.destroy();let n=this.eventTarget;n.removeEventListener("focus",this.onEventTargetFocus),n.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(e){let n=this.eventTarget;n.removeEventListener("focus",this.onEventTargetFocus),n.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=e;for(let r of this.devices)r.setEventTarget(e);e.addEventListener("focus",this.onEventTargetFocus),e.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(e=void 0){let n=this.autopoller.running,r=typeof e=="undefined"?!n:Boolean(e);r!==n&&(r?this.autopoller.start():this.autopoller.stop())}addEventListener(e,n){let r=this.listeners;e in r?r[e].push(n):r[e]=[n]}removeEventListener(e,n){let r=this.listeners;if(e in r){let i=r[e],s=i.indexOf(n);s>=0&&i.splice(s,1)}}dispatchEvent(e){let{type:n}=e,r=0;for(let i of this.listeners[n])r|=i(e)?1:0;return Boolean(r)}poll(e=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(e)}onInput(e){let n=this.adapter.onInput(e);switch(e.event){case"pressed":this.anyButtonDevice=e.device,this.anyButtonCode=e.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=e.device,this.anyButtonCode=e.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=e.device,this.anyAxisCode=e.code,this.anyAxis.onUpdate(0,e.value,e.movement);break}return n}onPoll(e){this.adapter.onPoll(e),this.anyButton.onPoll(e),this.anyAxis.onPoll(e)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let e of this.bindings.getInputs())e.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindKeys(e){if(Array.isArray(e))for(let n of e)n.bindKeys(this);else if(typeof e.bindKeys=="function")e.bindKeys(this);else{e=Object.values(e);for(let n of e)n.bindKeys(this)}}bindButton(e,n,r,i=void 0){let s;this.hasButton(e)?s=this.getButton(e):(s=new st(1),this.inputs[e]=s),this.bindings.bind(s,n,r,i),this.onBind()}bindAxis(e,n,r,i=void 0){let s;this.hasAxis(e)?s=this.getAxis(e):(s=new ze(1),this.inputs[e]=s),this.bindings.bind(s,n,r,i),this.onBind()}bindAxisButtons(e,n,r,i){let s;this.hasAxis(e)?s=this.getAxis(e):(s=new ze(2),this.inputs[e]=s),this.bindings.bind(s,n,i),this.bindings.bind(s,n,r,{inverted:!0}),this.onBind()}unbindButton(e){if(this.hasButton(e)){let n=this.getButton(e);delete this.inputs[e],this.bindings.unbind(n),this.onUnbind()}}unbindAxis(e){if(this.hasAxis(e)){let n=this.getAxis(e);delete this.inputs[e],this.bindings.unbind(n),this.onUnbind()}}getInput(e){return this.inputs[e]}getButton(e){return this.inputs[e]}getAxis(e){return this.inputs[e]}hasButton(e){return e in this.inputs&&this.inputs[e]instanceof st}hasAxis(e){return e in this.inputs&&this.inputs[e]instanceof ze}isButtonDown(e){return this.inputs[e].down}isButtonPressed(e){return this.inputs[e].pressed}isButtonReleased(e){return this.inputs[e].released}getInputValue(e){return this.inputs[e].value}getButtonValue(e){return this.inputs[e].value}getAxisValue(e){return this.inputs[e].value}getAxisDelta(e){return this.inputs[e].delta}isAnyButtonDown(e=void 0){if(typeof e=="undefined")return this.anyButton.down;{let n=this.inputs;for(let r of e)if(n[r].down)return!0}return!1}isAnyButtonPressed(e=void 0){if(typeof e=="undefined")return this.anyButton.pressed;{let n=this.inputs;for(let r of e)if(n[r].pressed)return!0}return!1}isAnyButtonReleased(e=void 0){if(typeof e=="undefined")return this.anyButton.released;{let n=this.inputs;for(let r of e)if(n[r].released)return!0}return!1}getAnyAxisValue(e=void 0){if(typeof e=="undefined")return this.anyAxis.value;{let n=this.inputs;for(let r of e){let i=n[r];if(i.value)return i.value}}return 0}getAnyAxisDelta(e=void 0){if(typeof e=="undefined")return this.anyAxis.delta;{let n=this.inputs;for(let r of e){let i=n[r];if(i.delta)return i.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},at=class extends HTMLElement{static create(e={}){let{root:n=document.body,id:r=void 0,for:i=void 0,autopoll:s=!1}=e||{},a=new at;return a.id=r,a.for=i,a.autopoll=s,n.appendChild(a),a}static get[Symbol.for("templateNode")](){let e=document.createElement("template");return e.innerHTML=Ks,Object.defineProperty(this,Symbol.for("templateNode"),{value:e}),e}static get[Symbol.for("styleNode")](){let e=document.createElement("style");return e.innerHTML=$s,Object.defineProperty(this,Symbol.for("styleNode"),{value:e}),e}static define(e=window.customElements){e.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(e){this.toggleAttribute("autopoll",e)}get for(){return this._for}set for(e){this.setAttribute("for",e)}constructor(){super();let e=this.attachShadow({mode:"open"});e.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=e.querySelector("#title"),this._pollElement=e.querySelector("#poll"),this._focusElement=e.querySelector("#focus"),this._bodyElement=e.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let n=this;this._for="",this._eventTarget=n,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let e=this.for;delete this.for,this.for=e}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let e=this.autopoll;delete this.autopoll,this.autopoll=e}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let e=this._context;e&&(e.removeEventListener("bind",this.onInputContextBind),e.removeEventListener("unbind",this.onInputContextUnbind),e.removeEventListener("blur",this.onInputContextBlur),e.removeEventListener("focus",this.onInputContextFocus),e.destroy(),this._context=null)}attributeChangedCallback(e,n,r){switch(e){case"for":{this._for=r;let i,s;r?(i=document.getElementById(r),s=`${i.tagName.toLowerCase()}#${r}`):(i=this,s="input-port"),this._eventTarget=i,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${s}`}break;case"autopoll":this._autopoll=r!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(e="axisbutton",n=void 0){switch(e){case"axisbutton":if(!this._context){let r=new Fn(this._eventTarget,n);r.addEventListener("bind",this.onInputContextBind),r.addEventListener("unbind",this.onInputContextUnbind),r.addEventListener("blur",this.onInputContextBlur),r.addEventListener("focus",this.onInputContextFocus),this._autopoll&&r.toggleAutoPoll(!0),this._context=r}return this._context;default:throw new Error(`Input context id '${e}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let e=this._context,n=e.inputs,r=e.bindings,i={},s=[];for(let a of Object.keys(n)){let o=n[a],l=!0;for(let h of r.getBindingsByInput(o)){let c=Us(`${o.constructor.name}.${a}`,`${h.device}.${h.code}`,0,l);s.push(c),l&&(i[a]=c.querySelector("output"),l=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let a of s)this._bodyElement.appendChild(a)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let n=this._context.inputs;for(let r of Object.keys(this._outputElements)){let i=this._outputElements[r],s=n[r].value;i.innerText=Number(s).toFixed(2)}}else{for(let e of Object.keys(this._outputElements)){let n=this._outputElements[e];n.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let n=this._context.inputs;for(let r of Object.values(n))if(!r.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};at.define();function Us(t,e,n,r=!0){let i=document.createElement("tr");r&&i.classList.add("primary");{let s=document.createElement("td");s.textContent=t,s.classList.add("name"),i.appendChild(s)}{let s=document.createElement("td"),a=document.createElement("output");r?a.innerText=Number(n).toFixed(2):a.innerText="---",a.classList.add("value"),s.appendChild(a),i.appendChild(s)}{let s=document.createElement("td");s.classList.add("key");let a=new Pt;a.innerText=e,s.appendChild(a),i.appendChild(s)}return i}var xu=Symbol("keyboardSource");var yu=Symbol("mouseSource");window.addEventListener("error",Wn,!0);window.addEventListener("unhandledrejection",Wn,!0);function Wn(t){t instanceof PromiseRejectionEvent?window.alert(t.reason.stack):t instanceof ErrorEvent?window.alert(t.error.stack):window.alert(JSON.stringify(t))}var zt=class{next(){return 0}},jn=class extends zt{next(){return Math.random()}},Xn=class extends zt{constructor(e){super();this.seed=e,this.a=e}next(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}},j=class{static get RAND(){let e=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:e}),e}constructor(e=void 0){typeof e=="number"?this.generator=new Xn(e):e?this.generator=e:this.generator=new jn,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(e){return this.RAND.choose(e)}choose(e){return e[Math.floor(this.generator.next()*e.length)]}static range(e,n){return this.RAND.range(e,n)}range(e,n){return(n-e)*this.generator.next()+e}static rangeInt(e,n){return this.RAND.rangeInt(e,n)}rangeInt(e,n){return Math.trunc(this.range(e,n))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}};var Kt={on(t,e,n=e){let r;if(this.__events.has(t)?r=this.__events.get(t):(r=new Map,this.__events.set(t,r)),!r.has(n))r.set(n,e);else throw new Error(`Found callback for event '${t}' with the same handle '${n}'.`);return this},off(t,e){if(this.__events.has(t)){let n=this.__events.get(t);if(n.has(e))n.delete(e);else throw new Error(`Unable to find callback for event '${t}' with handle '${e}'.`)}else throw new Error(`Unable to find event '${t}'.`);return this},once(t,e,n=e){let r=(...i)=>{this.off(t,n),e.apply(this.__context||this,i)};return this.on(t,r,n)},emit(t,...e){if(this.__events.has(t)){let n=[],r=Array.from(this.__events.get(t).values());for(let i of r){let s=i.apply(this.__context||this,e);s&&n.push(s)}return n}else return this.__events.set(t,new Map),[]}};function Ys(t=void 0){let e=Object.create(Kt);return e.__events=new Map,e.__context=t,e}function Fs(t,e=void 0){let n=Object.assign(t,Kt);return n.__events=new Map,n.__context=e,n}function Ws(t,e=void 0){let n=t.prototype;return Object.assign(n,Kt),n.__events=new Map,n.__context=e,n}var Gn={create:Ys,assign:Fs,mixin:Ws},js=5,Xs=4,Gs=3,qs=2,Vs=1,Zs=0,Mu={[js]:Ke("#7F8C8D"),[Xs]:Ke("#2ECC71"),[Gs]:Ke("#4794C8"),[qs]:Ke("#F39C12"),[Vs]:Ke("#C0392B"),[Zs]:[""]};function Ke(t){return[`background: ${t}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}var bu=Symbol("level"),Au=Symbol("domain");function qn(t,e){Qs(t,Js(e))}function Qs(t,e){let n=document.createElement("a"),r=e.indexOf(";");e=e.substring(0,r+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+t+";"+e.substring(r+1),n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Js(t){return"data:text/plain; charset=utf-8,"+encodeURIComponent(t)}async function Vn(t=[],e=!1){return new Promise((n,r)=>{let i=document.createElement("input");i.addEventListener("change",s=>{n(e?s.target.files:s.target.files[0])}),i.type="file",i.accept=t.join(","),i.style.display="none",i.toggleAttribute("multiple",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)})}var Le=0,ea=class{constructor(e){this._heap=[],this._comparator=e}get size(){return this._heap.length}clear(){this._heap.length=0}push(...e){for(let n of e)this._heap.push(n),this._shiftUp()}pop(){let e=this.peek(),n=ta(this);return n>Le&&this._swap(Le,n),this._heap.pop(),this._shiftDown(),e}replace(e){let n=this.peek();return this._heap[Le]=e,this._shiftDown(),n}peek(){return this._heap[Le]}at(e){return this._heap[e]}indexOf(e,n=void 0){return this._heap.indexOf(e,n)}splice(e,n=void 0){return this._heap.splice(e,n)}_compare(e,n){return this._comparator(this._heap[e],this._heap[n])}_swap(e,n){let r=this._heap[e];this._heap[e]=this._heap[n],this._heap[n]=r}_shiftUp(){let e=this._heap.length-1,n;for(;e>Le&&this._compare(e,n=na(e));)this._swap(e,n),e=n}_shiftDown(){let e=this._heap.length,n=Le,r,i=Zn(n),s=i<e,a=Qn(n),o=a<e;for(;s&&this._compare(i,n)||o&&this._compare(a,n);)r=o&&this._compare(a,i)?a:i,this._swap(n,r),n=r,i=Zn(n),s=i<e,a=Qn(n),o=a<e}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}};function ta(t){return t._heap.length-1}function na(t){return(t+1>>>1)-1}function Zn(t){return(t<<1)+1}function Qn(t){return t+1<<1}function $t(t,e,n){return t+(e-t)*n}function Jn(t,e,n,r){let i=n-t,s=r-e;return Math.sqrt(i*i+s*s)}var Cu=Math.PI/180,Su=180/Math.PI;var $=1e-6,X=typeof Float32Array!="undefined"?Float32Array:Array,Me=Math.random;var Tu=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function er(){var t=new X(9);return X!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}var fe={};rt(fe,{add:()=>Ka,adjoint:()=>ca,clone:()=>ia,copy:()=>sa,create:()=>ra,determinant:()=>ua,equals:()=>Fa,exactEquals:()=>Ya,frob:()=>za,fromQuat:()=>Ta,fromQuat2:()=>ba,fromRotation:()=>Ea,fromRotationTranslation:()=>rr,fromRotationTranslationScale:()=>Sa,fromRotationTranslationScaleOrigin:()=>ka,fromScaling:()=>ya,fromTranslation:()=>xa,fromValues:()=>aa,fromXRotation:()=>wa,fromYRotation:()=>_a,fromZRotation:()=>Ma,frustum:()=>Ia,getRotation:()=>Ca,getScaling:()=>ir,getTranslation:()=>Aa,identity:()=>tr,invert:()=>ha,lookAt:()=>Da,mul:()=>Wa,multiply:()=>nr,multiplyScalar:()=>$a,multiplyScalarAndAdd:()=>Ua,ortho:()=>Oa,orthoNO:()=>ar,orthoZO:()=>Na,perspective:()=>Ra,perspectiveFromFieldOfView:()=>Ba,perspectiveNO:()=>sr,perspectiveZO:()=>La,rotate:()=>da,rotateX:()=>va,rotateY:()=>ma,rotateZ:()=>ga,scale:()=>pa,set:()=>oa,str:()=>Ha,sub:()=>ja,subtract:()=>or,targetTo:()=>Pa,translate:()=>fa,transpose:()=>la});function ra(){var t=new X(16);return X!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ia(t){var e=new X(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sa(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function aa(t,e,n,r,i,s,a,o,l,h,c,u,f,d,g,y){var p=new X(16);return p[0]=t,p[1]=e,p[2]=n,p[3]=r,p[4]=i,p[5]=s,p[6]=a,p[7]=o,p[8]=l,p[9]=h,p[10]=c,p[11]=u,p[12]=f,p[13]=d,p[14]=g,p[15]=y,p}function oa(t,e,n,r,i,s,a,o,l,h,c,u,f,d,g,y,p){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=a,t[6]=o,t[7]=l,t[8]=h,t[9]=c,t[10]=u,t[11]=f,t[12]=d,t[13]=g,t[14]=y,t[15]=p,t}function tr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function la(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ha(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],f=e[10],d=e[11],g=e[12],y=e[13],p=e[14],E=e[15],R=n*o-r*a,_=n*l-i*a,S=n*h-s*a,b=r*l-i*o,k=r*h-s*o,P=i*h-s*l,w=c*y-u*g,T=c*p-f*g,N=c*E-d*g,v=u*p-f*y,L=u*E-d*y,B=f*E-d*p,O=R*B-_*L+S*v+b*N-k*T+P*w;return O?(O=1/O,t[0]=(o*B-l*L+h*v)*O,t[1]=(i*L-r*B-s*v)*O,t[2]=(y*P-p*k+E*b)*O,t[3]=(f*k-u*P-d*b)*O,t[4]=(l*N-a*B-h*T)*O,t[5]=(n*B-i*N+s*T)*O,t[6]=(p*S-g*P-E*_)*O,t[7]=(c*P-f*S+d*_)*O,t[8]=(a*L-o*N+h*w)*O,t[9]=(r*N-n*L-s*w)*O,t[10]=(g*k-y*S+E*R)*O,t[11]=(u*S-c*k-d*R)*O,t[12]=(o*T-a*v-l*w)*O,t[13]=(n*v-r*T+i*w)*O,t[14]=(y*_-g*b-p*R)*O,t[15]=(c*b-u*_+f*R)*O,t):null}function ca(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],f=e[10],d=e[11],g=e[12],y=e[13],p=e[14],E=e[15];return t[0]=o*(f*E-d*p)-u*(l*E-h*p)+y*(l*d-h*f),t[1]=-(r*(f*E-d*p)-u*(i*E-s*p)+y*(i*d-s*f)),t[2]=r*(l*E-h*p)-o*(i*E-s*p)+y*(i*h-s*l),t[3]=-(r*(l*d-h*f)-o*(i*d-s*f)+u*(i*h-s*l)),t[4]=-(a*(f*E-d*p)-c*(l*E-h*p)+g*(l*d-h*f)),t[5]=n*(f*E-d*p)-c*(i*E-s*p)+g*(i*d-s*f),t[6]=-(n*(l*E-h*p)-a*(i*E-s*p)+g*(i*h-s*l)),t[7]=n*(l*d-h*f)-a*(i*d-s*f)+c*(i*h-s*l),t[8]=a*(u*E-d*y)-c*(o*E-h*y)+g*(o*d-h*u),t[9]=-(n*(u*E-d*y)-c*(r*E-s*y)+g*(r*d-s*u)),t[10]=n*(o*E-h*y)-a*(r*E-s*y)+g*(r*h-s*o),t[11]=-(n*(o*d-h*u)-a*(r*d-s*u)+c*(r*h-s*o)),t[12]=-(a*(u*p-f*y)-c*(o*p-l*y)+g*(o*f-l*u)),t[13]=n*(u*p-f*y)-c*(r*p-i*y)+g*(r*f-i*u),t[14]=-(n*(o*p-l*y)-a*(r*p-i*y)+g*(r*l-i*o)),t[15]=n*(o*f-l*u)-a*(r*f-i*u)+c*(r*l-i*o),t}function ua(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],a=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],f=t[11],d=t[12],g=t[13],y=t[14],p=t[15],E=e*a-n*s,R=e*o-r*s,_=e*l-i*s,S=n*o-r*a,b=n*l-i*a,k=r*l-i*o,P=h*g-c*d,w=h*y-u*d,T=h*p-f*d,N=c*y-u*g,v=c*p-f*g,L=u*p-f*y;return E*L-R*v+_*N+S*T-b*w+k*P}function nr(t,e,n){var r=e[0],i=e[1],s=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],f=e[9],d=e[10],g=e[11],y=e[12],p=e[13],E=e[14],R=e[15],_=n[0],S=n[1],b=n[2],k=n[3];return t[0]=_*r+S*o+b*u+k*y,t[1]=_*i+S*l+b*f+k*p,t[2]=_*s+S*h+b*d+k*E,t[3]=_*a+S*c+b*g+k*R,_=n[4],S=n[5],b=n[6],k=n[7],t[4]=_*r+S*o+b*u+k*y,t[5]=_*i+S*l+b*f+k*p,t[6]=_*s+S*h+b*d+k*E,t[7]=_*a+S*c+b*g+k*R,_=n[8],S=n[9],b=n[10],k=n[11],t[8]=_*r+S*o+b*u+k*y,t[9]=_*i+S*l+b*f+k*p,t[10]=_*s+S*h+b*d+k*E,t[11]=_*a+S*c+b*g+k*R,_=n[12],S=n[13],b=n[14],k=n[15],t[12]=_*r+S*o+b*u+k*y,t[13]=_*i+S*l+b*f+k*p,t[14]=_*s+S*h+b*d+k*E,t[15]=_*a+S*c+b*g+k*R,t}function fa(t,e,n){var r=n[0],i=n[1],s=n[2],a,o,l,h,c,u,f,d,g,y,p,E;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],l=e[2],h=e[3],c=e[4],u=e[5],f=e[6],d=e[7],g=e[8],y=e[9],p=e[10],E=e[11],t[0]=a,t[1]=o,t[2]=l,t[3]=h,t[4]=c,t[5]=u,t[6]=f,t[7]=d,t[8]=g,t[9]=y,t[10]=p,t[11]=E,t[12]=a*r+c*i+g*s+e[12],t[13]=o*r+u*i+y*s+e[13],t[14]=l*r+f*i+p*s+e[14],t[15]=h*r+d*i+E*s+e[15]),t}function pa(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function da(t,e,n,r){var i=r[0],s=r[1],a=r[2],o=Math.hypot(i,s,a),l,h,c,u,f,d,g,y,p,E,R,_,S,b,k,P,w,T,N,v,L,B,O,m;return o<$?null:(o=1/o,i*=o,s*=o,a*=o,l=Math.sin(n),h=Math.cos(n),c=1-h,u=e[0],f=e[1],d=e[2],g=e[3],y=e[4],p=e[5],E=e[6],R=e[7],_=e[8],S=e[9],b=e[10],k=e[11],P=i*i*c+h,w=s*i*c+a*l,T=a*i*c-s*l,N=i*s*c-a*l,v=s*s*c+h,L=a*s*c+i*l,B=i*a*c+s*l,O=s*a*c-i*l,m=a*a*c+h,t[0]=u*P+y*w+_*T,t[1]=f*P+p*w+S*T,t[2]=d*P+E*w+b*T,t[3]=g*P+R*w+k*T,t[4]=u*N+y*v+_*L,t[5]=f*N+p*v+S*L,t[6]=d*N+E*v+b*L,t[7]=g*N+R*v+k*L,t[8]=u*B+y*O+_*m,t[9]=f*B+p*O+S*m,t[10]=d*B+E*O+b*m,t[11]=g*B+R*O+k*m,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function va(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+h*r,t[5]=a*i+c*r,t[6]=o*i+u*r,t[7]=l*i+f*r,t[8]=h*i-s*r,t[9]=c*i-a*r,t[10]=u*i-o*r,t[11]=f*i-l*r,t}function ma(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],a=e[1],o=e[2],l=e[3],h=e[8],c=e[9],u=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-h*r,t[1]=a*i-c*r,t[2]=o*i-u*r,t[3]=l*i-f*r,t[8]=s*r+h*i,t[9]=a*r+c*i,t[10]=o*r+u*i,t[11]=l*r+f*i,t}function ga(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],a=e[1],o=e[2],l=e[3],h=e[4],c=e[5],u=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+h*r,t[1]=a*i+c*r,t[2]=o*i+u*r,t[3]=l*i+f*r,t[4]=h*i-s*r,t[5]=c*i-a*r,t[6]=u*i-o*r,t[7]=f*i-l*r,t}function xa(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ya(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ea(t,e,n){var r=n[0],i=n[1],s=n[2],a=Math.hypot(r,i,s),o,l,h;return a<$?null:(a=1/a,r*=a,i*=a,s*=a,o=Math.sin(e),l=Math.cos(e),h=1-l,t[0]=r*r*h+l,t[1]=i*r*h+s*o,t[2]=s*r*h-i*o,t[3]=0,t[4]=r*i*h-s*o,t[5]=i*i*h+l,t[6]=s*i*h+r*o,t[7]=0,t[8]=r*s*h+i*o,t[9]=i*s*h-r*o,t[10]=s*s*h+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function wa(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _a(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ma(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rr(t,e,n){var r=e[0],i=e[1],s=e[2],a=e[3],o=r+r,l=i+i,h=s+s,c=r*o,u=r*l,f=r*h,d=i*l,g=i*h,y=s*h,p=a*o,E=a*l,R=a*h;return t[0]=1-(d+y),t[1]=u+R,t[2]=f-E,t[3]=0,t[4]=u-R,t[5]=1-(c+y),t[6]=g+p,t[7]=0,t[8]=f+E,t[9]=g-p,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ba(t,e){var n=new X(3),r=-e[0],i=-e[1],s=-e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=r*r+i*i+s*s+a*a;return u>0?(n[0]=(o*a+c*r+l*s-h*i)*2/u,n[1]=(l*a+c*i+h*r-o*s)*2/u,n[2]=(h*a+c*s+o*i-l*r)*2/u):(n[0]=(o*a+c*r+l*s-h*i)*2,n[1]=(l*a+c*i+h*r-o*s)*2,n[2]=(h*a+c*s+o*i-l*r)*2),rr(t,e,n),t}function Aa(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ir(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],a=e[5],o=e[6],l=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,a,o),t[2]=Math.hypot(l,h,c),t}function Ca(t,e){var n=new X(3);ir(n,e);var r=1/n[0],i=1/n[1],s=1/n[2],a=e[0]*r,o=e[1]*i,l=e[2]*s,h=e[4]*r,c=e[5]*i,u=e[6]*s,f=e[8]*r,d=e[9]*i,g=e[10]*s,y=a+c+g,p=0;return y>0?(p=Math.sqrt(y+1)*2,t[3]=.25*p,t[0]=(u-d)/p,t[1]=(f-l)/p,t[2]=(o-h)/p):a>c&&a>g?(p=Math.sqrt(1+a-c-g)*2,t[3]=(u-d)/p,t[0]=.25*p,t[1]=(o+h)/p,t[2]=(f+l)/p):c>g?(p=Math.sqrt(1+c-a-g)*2,t[3]=(f-l)/p,t[0]=(o+h)/p,t[1]=.25*p,t[2]=(u+d)/p):(p=Math.sqrt(1+g-a-c)*2,t[3]=(o-h)/p,t[0]=(f+l)/p,t[1]=(u+d)/p,t[2]=.25*p),t}function Sa(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=e[3],l=i+i,h=s+s,c=a+a,u=i*l,f=i*h,d=i*c,g=s*h,y=s*c,p=a*c,E=o*l,R=o*h,_=o*c,S=r[0],b=r[1],k=r[2];return t[0]=(1-(g+p))*S,t[1]=(f+_)*S,t[2]=(d-R)*S,t[3]=0,t[4]=(f-_)*b,t[5]=(1-(u+p))*b,t[6]=(y+E)*b,t[7]=0,t[8]=(d+R)*k,t[9]=(y-E)*k,t[10]=(1-(u+g))*k,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ka(t,e,n,r,i){var s=e[0],a=e[1],o=e[2],l=e[3],h=s+s,c=a+a,u=o+o,f=s*h,d=s*c,g=s*u,y=a*c,p=a*u,E=o*u,R=l*h,_=l*c,S=l*u,b=r[0],k=r[1],P=r[2],w=i[0],T=i[1],N=i[2],v=(1-(y+E))*b,L=(d+S)*b,B=(g-_)*b,O=(d-S)*k,m=(1-(f+E))*k,x=(p+R)*k,F=(g+_)*P,K=(p-R)*P,Z=(1-(f+y))*P;return t[0]=v,t[1]=L,t[2]=B,t[3]=0,t[4]=O,t[5]=m,t[6]=x,t[7]=0,t[8]=F,t[9]=K,t[10]=Z,t[11]=0,t[12]=n[0]+w-(v*w+O*T+F*N),t[13]=n[1]+T-(L*w+m*T+K*N),t[14]=n[2]+N-(B*w+x*T+Z*N),t[15]=1,t}function Ta(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=n+n,o=r+r,l=i+i,h=n*a,c=r*a,u=r*o,f=i*a,d=i*o,g=i*l,y=s*a,p=s*o,E=s*l;return t[0]=1-u-g,t[1]=c+E,t[2]=f-p,t[3]=0,t[4]=c-E,t[5]=1-h-g,t[6]=d+y,t[7]=0,t[8]=f+p,t[9]=d-y,t[10]=1-h-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ia(t,e,n,r,i,s,a){var o=1/(n-e),l=1/(i-r),h=1/(s-a);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(i+r)*l,t[10]=(a+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*h,t[15]=0,t}function sr(t,e,n,r,i){var s=1/Math.tan(e/2),a;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==Infinity?(a=1/(r-i),t[10]=(i+r)*a,t[14]=2*i*r*a):(t[10]=-1,t[14]=-2*r),t}var Ra=sr;function La(t,e,n,r,i){var s=1/Math.tan(e/2),a;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==Infinity?(a=1/(r-i),t[10]=i*a,t[14]=i*r*a):(t[10]=-1,t[14]=-r),t}function Ba(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),l=2/(a+o),h=2/(i+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-((a-o)*l*.5),t[9]=(i-s)*h*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function ar(t,e,n,r,i,s,a){var o=1/(e-n),l=1/(r-i),h=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*o,t[13]=(i+r)*l,t[14]=(a+s)*h,t[15]=1,t}var Oa=ar;function Na(t,e,n,r,i,s,a){var o=1/(e-n),l=1/(r-i),h=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(e+n)*o,t[13]=(i+r)*l,t[14]=s*h,t[15]=1,t}function Da(t,e,n,r){var i,s,a,o,l,h,c,u,f,d,g=e[0],y=e[1],p=e[2],E=r[0],R=r[1],_=r[2],S=n[0],b=n[1],k=n[2];return Math.abs(g-S)<$&&Math.abs(y-b)<$&&Math.abs(p-k)<$?tr(t):(c=g-S,u=y-b,f=p-k,d=1/Math.hypot(c,u,f),c*=d,u*=d,f*=d,i=R*f-_*u,s=_*c-E*f,a=E*u-R*c,d=Math.hypot(i,s,a),d?(d=1/d,i*=d,s*=d,a*=d):(i=0,s=0,a=0),o=u*a-f*s,l=f*i-c*a,h=c*s-u*i,d=Math.hypot(o,l,h),d?(d=1/d,o*=d,l*=d,h*=d):(o=0,l=0,h=0),t[0]=i,t[1]=o,t[2]=c,t[3]=0,t[4]=s,t[5]=l,t[6]=u,t[7]=0,t[8]=a,t[9]=h,t[10]=f,t[11]=0,t[12]=-(i*g+s*y+a*p),t[13]=-(o*g+l*y+h*p),t[14]=-(c*g+u*y+f*p),t[15]=1,t)}function Pa(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=r[0],l=r[1],h=r[2],c=i-n[0],u=s-n[1],f=a-n[2],d=c*c+u*u+f*f;d>0&&(d=1/Math.sqrt(d),c*=d,u*=d,f*=d);var g=l*f-h*u,y=h*c-o*f,p=o*u-l*c;return d=g*g+y*y+p*p,d>0&&(d=1/Math.sqrt(d),g*=d,y*=d,p*=d),t[0]=g,t[1]=y,t[2]=p,t[3]=0,t[4]=u*p-f*y,t[5]=f*g-c*p,t[6]=c*y-u*g,t[7]=0,t[8]=c,t[9]=u,t[10]=f,t[11]=0,t[12]=i,t[13]=s,t[14]=a,t[15]=1,t}function Ha(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function za(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ka(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function or(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function $a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Ua(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Ya(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Fa(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],f=t[10],d=t[11],g=t[12],y=t[13],p=t[14],E=t[15],R=e[0],_=e[1],S=e[2],b=e[3],k=e[4],P=e[5],w=e[6],T=e[7],N=e[8],v=e[9],L=e[10],B=e[11],O=e[12],m=e[13],x=e[14],F=e[15];return Math.abs(n-R)<=$*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(r-_)<=$*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-S)<=$*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-b)<=$*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-k)<=$*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(o-P)<=$*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(l-w)<=$*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(h-T)<=$*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(c-N)<=$*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(u-v)<=$*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(f-L)<=$*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(d-B)<=$*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(g-O)<=$*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(y-m)<=$*Math.max(1,Math.abs(y),Math.abs(m))&&Math.abs(p-x)<=$*Math.max(1,Math.abs(p),Math.abs(x))&&Math.abs(E-F)<=$*Math.max(1,Math.abs(E),Math.abs(F))}var Wa=nr,ja=or;var ut={};rt(ut,{add:()=>Xo,calculateW:()=>Do,clone:()=>Yo,conjugate:()=>Ko,copy:()=>Wo,create:()=>Ft,dot:()=>Or,equals:()=>Jo,exactEquals:()=>Qo,exp:()=>Ir,fromEuler:()=>$o,fromMat3:()=>Lr,fromValues:()=>Fo,getAngle:()=>Lo,getAxisAngle:()=>Ro,identity:()=>Io,invert:()=>zo,len:()=>Vo,length:()=>Nr,lerp:()=>qo,ln:()=>Rr,mul:()=>Go,multiply:()=>Tr,normalize:()=>Wt,pow:()=>Po,random:()=>Ho,rotateX:()=>Bo,rotateY:()=>Oo,rotateZ:()=>No,rotationTo:()=>el,scale:()=>Br,set:()=>jo,setAxes:()=>nl,setAxisAngle:()=>kr,slerp:()=>ct,sqlerp:()=>tl,sqrLen:()=>Zo,squaredLength:()=>Dr,str:()=>Uo});var oe={};rt(oe,{add:()=>Va,angle:()=>go,bezier:()=>lo,ceil:()=>Za,clone:()=>Xa,copy:()=>Ga,create:()=>ot,cross:()=>$e,dist:()=>Ao,distance:()=>fr,div:()=>bo,divide:()=>ur,dot:()=>ht,equals:()=>wo,exactEquals:()=>Eo,floor:()=>Qa,forEach:()=>ko,fromValues:()=>lt,hermite:()=>oo,inverse:()=>so,len:()=>Yt,length:()=>lr,lerp:()=>ao,max:()=>eo,min:()=>Ja,mul:()=>Mo,multiply:()=>cr,negate:()=>io,normalize:()=>Ut,random:()=>ho,rotateX:()=>po,rotateY:()=>vo,rotateZ:()=>mo,round:()=>to,scale:()=>no,scaleAndAdd:()=>ro,set:()=>qa,sqrDist:()=>Co,sqrLen:()=>So,squaredDistance:()=>pr,squaredLength:()=>dr,str:()=>yo,sub:()=>_o,subtract:()=>hr,transformMat3:()=>uo,transformMat4:()=>co,transformQuat:()=>fo,zero:()=>xo});function ot(){var t=new X(3);return X!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Xa(t){var e=new X(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function lr(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function lt(t,e,n){var r=new X(3);return r[0]=t,r[1]=e,r[2]=n,r}function Ga(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function qa(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Va(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function hr(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function cr(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ur(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Za(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Qa(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Ja(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function eo(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function to(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function no(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ro(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function fr(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function pr(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function dr(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function io(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function so(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ut(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function ht(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $e(t,e,n){var r=e[0],i=e[1],s=e[2],a=n[0],o=n[1],l=n[2];return t[0]=i*l-s*o,t[1]=s*a-r*l,t[2]=r*o-i*a,t}function ao(t,e,n,r){var i=e[0],s=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=a+r*(n[2]-a),t}function oo(t,e,n,r,i,s){var a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,h=a*(s-1),c=a*(3-2*s);return t[0]=e[0]*o+n[0]*l+r[0]*h+i[0]*c,t[1]=e[1]*o+n[1]*l+r[1]*h+i[1]*c,t[2]=e[2]*o+n[2]*l+r[2]*h+i[2]*c,t}function lo(t,e,n,r,i,s){var a=1-s,o=a*a,l=s*s,h=o*a,c=3*s*o,u=3*l*a,f=l*s;return t[0]=e[0]*h+n[0]*c+r[0]*u+i[0]*f,t[1]=e[1]*h+n[1]*c+r[1]*u+i[1]*f,t[2]=e[2]*h+n[2]*c+r[2]*u+i[2]*f,t}function ho(t,e){e=e||1;var n=Me()*2*Math.PI,r=Me()*2-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function co(t,e,n){var r=e[0],i=e[1],s=e[2],a=n[3]*r+n[7]*i+n[11]*s+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/a,t}function uo(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function fo(t,e,n){var r=n[0],i=n[1],s=n[2],a=n[3],o=e[0],l=e[1],h=e[2],c=i*h-s*l,u=s*o-r*h,f=r*l-i*o,d=i*f-s*u,g=s*c-r*f,y=r*u-i*c,p=a*2;return c*=p,u*=p,f*=p,d*=2,g*=2,y*=2,t[0]=o+c+d,t[1]=l+u+g,t[2]=h+f+y,t}function po(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function vo(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function mo(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function go(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],a=e[1],o=e[2],l=Math.sqrt(n*n+r*r+i*i),h=Math.sqrt(s*s+a*a+o*o),c=l*h,u=c&&ht(t,e)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function xo(t){return t[0]=0,t[1]=0,t[2]=0,t}function yo(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Eo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function wo(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],a=e[1],o=e[2];return Math.abs(n-s)<=$*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=$*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=$*Math.max(1,Math.abs(i),Math.abs(o))}var _o=hr,Mo=cr,bo=ur,Ao=fr,Co=pr,Yt=lr,So=dr,ko=function(){var t=ot();return function(e,n,r,i,s,a){var o,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,o=r;o<l;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}();function To(){var t=new X(4);return X!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function vr(t){var e=new X(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function mr(t,e,n,r){var i=new X(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function gr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function xr(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function yr(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Er(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function wr(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function _r(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function Mr(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=n*n+r*r+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=s*a,t}function br(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ar(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=a+r*(n[2]-a),t[3]=o+r*(n[3]-o),t}function Cr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Sr(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],a=e[0],o=e[1],l=e[2],h=e[3];return Math.abs(n-a)<=$*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=$*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-l)<=$*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-h)<=$*Math.max(1,Math.abs(s),Math.abs(h))}var Du=function(){var t=To();return function(e,n,r,i,s,a){var o,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,o=r;o<l;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}();function Ft(){var t=new X(4);return X!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Io(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function kr(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Ro(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>$?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Lo(t,e){var n=Or(t,e);return Math.acos(2*n*n-1)}function Tr(t,e,n){var r=e[0],i=e[1],s=e[2],a=e[3],o=n[0],l=n[1],h=n[2],c=n[3];return t[0]=r*c+a*o+i*h-s*l,t[1]=i*c+a*l+s*o-r*h,t[2]=s*c+a*h+r*l-i*o,t[3]=a*c-r*o-i*l-s*h,t}function Bo(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(n),l=Math.cos(n);return t[0]=r*l+a*o,t[1]=i*l+s*o,t[2]=s*l-i*o,t[3]=a*l-r*o,t}function Oo(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(n),l=Math.cos(n);return t[0]=r*l-s*o,t[1]=i*l+a*o,t[2]=s*l+r*o,t[3]=a*l-i*o,t}function No(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*o,t[1]=i*l-r*o,t[2]=s*l+a*o,t[3]=a*l-s*o,t}function Do(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Ir(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=Math.sqrt(n*n+r*r+i*i),o=Math.exp(s),l=a>0?o*Math.sin(a)/a:0;return t[0]=n*l,t[1]=r*l,t[2]=i*l,t[3]=o*Math.cos(a),t}function Rr(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=Math.sqrt(n*n+r*r+i*i),o=a>0?Math.atan2(a,s)/a:0;return t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=.5*Math.log(n*n+r*r+i*i+s*s),t}function Po(t,e,n){return Rr(t,e),Br(t,t,n),Ir(t,t),t}function ct(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=e[3],l=n[0],h=n[1],c=n[2],u=n[3],f,d,g,y,p;return d=i*l+s*h+a*c+o*u,d<0&&(d=-d,l=-l,h=-h,c=-c,u=-u),1-d>$?(f=Math.acos(d),g=Math.sin(f),y=Math.sin((1-r)*f)/g,p=Math.sin(r*f)/g):(y=1-r,p=r),t[0]=y*i+p*l,t[1]=y*s+p*h,t[2]=y*a+p*c,t[3]=y*o+p*u,t}function Ho(t){var e=Me(),n=Me(),r=Me(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=s*Math.sin(2*Math.PI*r),t[3]=s*Math.cos(2*Math.PI*r),t}function zo(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=n*n+r*r+i*i+s*s,o=a?1/a:0;return t[0]=-n*o,t[1]=-r*o,t[2]=-i*o,t[3]=s*o,t}function Ko(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Lr(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),t[i]=.5*r,r=.5/r,t[3]=(e[s*3+a]-e[a*3+s])*r,t[s]=(e[s*3+i]+e[i*3+s])*r,t[a]=(e[a*3+i]+e[i*3+a])*r}return t}function $o(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var s=Math.sin(e),a=Math.cos(e),o=Math.sin(n),l=Math.cos(n),h=Math.sin(r),c=Math.cos(r);return t[0]=s*l*c-a*o*h,t[1]=a*o*c+s*l*h,t[2]=a*l*h-s*o*c,t[3]=a*l*c+s*o*h,t}function Uo(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Yo=vr,Fo=mr,Wo=gr,jo=xr,Xo=yr,Go=Tr,Br=Er,Or=br,qo=Ar,Nr=wr,Vo=Nr,Dr=_r,Zo=Dr,Wt=Mr,Qo=Cr,Jo=Sr,el=function(){var t=ot(),e=lt(1,0,0),n=lt(0,1,0);return function(r,i,s){var a=ht(i,s);return a<-.999999?($e(t,e,i),Yt(t)<1e-6&&$e(t,n,i),Ut(t,t),kr(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):($e(t,i,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,Wt(r,r))}}(),tl=function(){var t=Ft(),e=Ft();return function(n,r,i,s,a,o){return ct(t,r,a,o),ct(e,i,s,o),ct(n,t,e,2*o*(1-o)),n}}(),nl=function(){var t=er();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Wt(e,Lr(e,t))}}();var pe=class{static screenToWorld(e,n,r,i){let s=fe.multiply(fe.create(),i,r);fe.invert(s,s);let a=oe.fromValues(e,n,0);return oe.transformMat4(a,a,s),a}constructor(e=-1,n=1,r=-1,i=1,s=0,a=1){this.position=oe.create(),this.rotation=ut.create(),this.scale=oe.fromValues(1,1,1),this.clippingPlane={left:e,right:n,top:r,bottom:i,near:s,far:a},this._viewMatrix=fe.create(),this._projectionMatrix=fe.create()}get x(){return this.position[0]}set x(e){this.position[0]=e}get y(){return this.position[1]}set y(e){this.position[1]=e}get z(){return this.position[2]}set z(e){this.position[2]=e}moveTo(e,n,r=0,i=1){let s=oe.fromValues(e,n,r);oe.lerp(this.position,this.position,s,Math.min(1,i))}getViewMatrix(e=this._viewMatrix){let n=-Math.round(this.x),r=-Math.round(this.y),i=this.z===0?1:1/this.z,s=oe.fromValues(n,r,0),a=oe.fromValues(this.scale[0]*i,this.scale[1]*i,1);return fe.fromRotationTranslationScale(e,this.rotation,s,a),e}getProjectionMatrix(e=this._projectionMatrix){let{left:n,right:r,top:i,bottom:s,near:a,far:o}=this.clippingPlane;return fe.ortho(e,n,r,i,s,a,o),e}};function Ue(t,e){return t+","+e}function ft(t){let e=t.indexOf(","),n=Number(t.substring(0,e)),r=Number(t.substring(e+1));return[n,r]}var Ye=class{constructor(e,n,r,i,s){this.chunkManager=e,this.chunkId=n,this.chunkCoordX=r,this.chunkCoordY=i,this._data=s}get data(){return this._data}},Fe=class{constructor(e,n){let r=e*n;this.block=new Uint8Array(r).fill(0),this.meta=new Uint8Array(r).fill(0),this.neighbor=new Uint8Array(r).fill(15)}};var We=class{constructor(e,n){this._chunkWidth=e,this._chunkHeight=n,this._x=0,this._y=0,this._blockCoordX=0,this._blockCoordY=0,this._index=0,this._chunkCoordX=0,this._chunkCoordY=0,this._chunkId=null}get x(){return this._x}get y(){return this._y}get blockCoordX(){return this._blockCoordX}get blockCoordY(){return this._blockCoordY}get index(){return this._index}get chunkCoordX(){return this._chunkCoordX}get chunkCoordY(){return this._chunkCoordY}get chunkId(){return this._chunkId}clone(){return new We(this._chunkWidth,this._chunkHeight)}set(e,n){this._x=e,this._y=n;let r=this._chunkWidth,i=this._chunkHeight;return e<0?this._blockCoordX=Math.abs(r+Math.floor(e))%r:this._blockCoordX=Math.floor(e)%r,n<0?this._blockCoordY=Math.abs(i+Math.floor(n))%i:this._blockCoordY=Math.floor(n)%i,this._index=this._blockCoordX+this._blockCoordY*r,this._chunkCoordX=Math.floor(e/r),this._chunkCoordY=Math.floor(n/i),this._chunkId=Ue(this._chunkCoordX,this._chunkCoordY),this}copy(e=this.clone()){return e._x=this.x,e._y=this.y,e._blockCoordX=this.blockCoordX,e._blockCoordY=this.blockCoordY,e._index=this.index,e._chunkCoordX=this.chunkCoordX,e._chunkCoordY=this.chunkCoordY,e._chunkId=this.chunkId,e}offset(e=this,n=0,r=0){return e.set(this.x+n,this.y+r)}down(e=this,n=1){return e.set(this.x,this.y+n)}up(e=this,n=1){return e.set(this.x,this.y-n)}right(e=this,n=1){return e.set(this.x+n,this.y)}left(e=this,n=1){return e.set(this.x-n,this.y)}reset(e=null){return e?e.copy(this):this.set(0,0)}equals(e){return Math.abs(this.x-e.x)<Number.EPSILON&&Math.abs(this.y-e.y)<Number.EPSILON}toString(e=!1){return`BlockPos(${this.x},${this.y})`+(e?`:Chunk[${this.chunkId}]@{${this.blockCoordX},${this.blockCoordY}}[${this.index}],`:"")}};var jt=class{constructor(e,n){this.chunkWidth=e,this.chunkHeight=n,this.chunks={}}clear(){this.chunks={}}getChunkById(e){if(e in this.chunks)return this.chunks[e];{let[n,r]=ft(e),i=new Fe(this.chunkWidth,this.chunkHeight),s=new Ye(this,e,n,r,i);return this.chunks[e]=s,s}}getChunkByCoord(e,n){let r=Ue(e,n);return this.getChunkById(r)}getChunksWithinBounds(e,n){let r=[],i=e.chunkCoordX,s=e.chunkCoordY,a=n.chunkCoordX,o=n.chunkCoordY;for(let l=s;l<=o;++l)for(let h=i;h<=a;++h){let c=Ue(h,l);r.push(this.getChunkById(c))}return r}getLoadedChunks(){let e=[];for(let n of Object.keys(this.chunks)){let r=this.chunks[n];e.push(r)}return e}};var je=class extends jt{constructor(e=-Infinity,n=-Infinity,r=Infinity,i=Infinity,s=Number.isFinite(r-e)?r-e:16,a=Number.isFinite(i-n)?i-n:16){super(s,a);this.bounds={left:e,right:r,top:n,bottom:i}}isWithinBounds(e){if(!e)return!1;let{x:n,y:r}=e;return n<=this.bounds.right&&n>=this.bounds.left&&r<=this.bounds.bottom&&r>=this.bounds.top}isWithinLoaded(e){return e.chunkId in this.chunks}getChunk(e){return this.getChunkById(e.chunkId)}getBlockId(e){return this.getChunkById(e.chunkId).data.block[e.index]}getBlockMeta(e){return this.getChunkById(e.chunkId).data.meta[e.index]}getBlockNeighbor(e){return this.getChunkById(e.chunkId).data.neighbor[e.index]}setBlockId(e,n){return this.getChunkById(e.chunkId).data.block[e.index]=n,this}setBlockMeta(e,n){return this.getChunkById(e.chunkId).data.meta[e.index]=n,this}setBlockNeighbor(e,n){return this.getChunkById(e.chunkId).data.neighbor[e.index]=n,this}at(e,n){return new We(this.chunkWidth,this.chunkHeight).set(e,n)}};var Pr=class{constructor(){this.blocks={},this.components={}}register(e,...n){if(e in this.blocks)throw new Error(`BlockId '${e}' already registered.`);let r=n.map(s=>Array.isArray(s)?s:[s,!0]);for(let[s,a]of r){s in this.components||(this.components[s]={});let o=this.components[s];if(e in o)throw new Error(`Component '${s}' for block '${e}' already registered.`);let l;typeof a=="object"?l=Object.assign({},a):l=a,o[e]=l}let i=new Hr(this,e,r);return this.blocks[e]=i,i}getBlock(e){return e in this.blocks?this.blocks[e]:null}getBlocks(){return Object.values(this.blocks)}getBlockIds(){return Object.keys(this.blocks)}getBlockComponents(e){let n=[];for(let r of this.components)e in r&&n.push(r[e]);return n}hasComponent(e,n){return e in this.components&&n in this.components[e]}getComponent(e,n){if(e in this.components){let r=this.components[e];if(n in r)return r[n]}return null}getComponents(e){if(e in this.components){let n=this.components[e];return Object.values(n)}}getComponentNames(){return Object.keys(this.components)}},Hr=class{constructor(e,n,r){this.blockRegistry=e,this.blockId=n,this.blockOpts=r;for(let[i,s]of r)this[i]=e.getComponent(i,n)}toString(){return`Block#${this.blockId}`}},D=new Pr;var tf=D.register(0,"air"),nf=D.register(1,"fluid",["color","dodgerblue"],["material","fluid"]),zr=D.register(3,"solid","grassSoil",["color","saddlebrown"],["material","dirt"]),Te=D.register(4,"solid",["color","gold"],["material","metal"]),Kr=D.register(5,"solid",["color","limegreen"],["material","dirt"]),rf=D.register(6,"solid",["color","slategray"],["material","stone"]),sf=D.register(7,"solid",["color","salmon"],["material","stone"]),af=D.register(8,"solid",["color","powderblue"],["material","metal"]),of=D.register(9,"solid",["color","rebeccapurple"],["material","stone"]),lf=D.register(10,"solid",["color","teal"],["material","stone"]),hf=D.register(11,"solid",["color","mediumvioletred"],["material","stone"]),cf=D.register(12,"solid",["color","navajowhite"],["material","dirt"]);var rl="update",Xe="worldUpdate",il="chunkUpdate",Xt="blockUpdate";function $r(t){t.emit(rl,t)}function Ur(t){t.emit(Xe,t)}function Yr(t,e){t.emit(il,t,e)}function Fr(t,e,n){t.emit(Xt,t,e,n)}var Gt="place",sl="break";function Wr(t,e,n){t.emit(Gt,t,e,n)}function jr(t,e,n){t.emit(sl,t,e,n)}var ye="air",de="fluid",ve=3;function Xr(t){t.on(Gt,al),t.on(Xe,ol)}function al(t,e,n){D.hasComponent(de,n)&&t.map.setBlockMeta(e,ve)}function ol(t){let e=ll(t.map.getLoadedChunks());for(let n of e)hl(t,n)}function ll(t){return t.sort((e,n)=>e.chunkCoordY<n.chunkCoordY?1:e.chunkCoordY>n.chunkCoordY?-1:e.chunkCoordX<n.chunkCoordX?1:e.chunkCoordX>n.chunkCoordX?-1:0)}function hl(t,e){let n=t.map,r=e.chunkCoordX*n.chunkWidth,i=e.chunkCoordY*n.chunkHeight,s=n.at(0,0);for(let a=n.chunkHeight-1;a>=0;--a)for(let o=0;o<n.chunkWidth;++o){s.set(o+r,a+i);let l=n.getBlockId(s);D.hasComponent(de,l)&&cl(t,s)}}function cl(t,e){let n=t.map;!ul(n,e)&&!fl(n,e)}function ul(t,e){let n=e.copy().down();return pt(t,e,n,ve)}function fl(t,e){let n=!1,r=t.getBlockMeta(e),i=e.copy();return r<=1?(e.offset(i,1*j.sign(),0),n|=pt(t,e,i,1,!1)):(e.offset(i,1*j.sign(),0),n|=pt(t,e,i,1,!1),e.offset(i,1*j.sign(),0),n|=pt(t,e,i,1,!1)),n}function pt(t,e,n,r,i=!0){if(!t.isWithinBounds(n))return!1;if(!t.isWithinLoaded(n))return t.setBlockId(e,0),t.setBlockMeta(e,0),!0;let s=t.getBlockId(e),a=t.getBlockMeta(e),o=t.getBlockId(n),l=t.getBlockMeta(n);if(r>a&&(r=a),D.hasComponent(ye,o)){let h=a-r;return h<=0?(t.setBlockId(n,s).setBlockMeta(n,a).setBlockId(e,0).setBlockMeta(e,0),!0):(t.setBlockId(n,s).setBlockMeta(n,r).setBlockMeta(e,h),!0)}else if(D.hasComponent(de,o)&&l<ve){if(!i&&a<=l)return!1;if(l+r<=ve)return t.setBlockMeta(n,l+r),r>=a?t.setBlockId(e,0).setBlockMeta(e,0):t.setBlockMeta(e,a-r),!0;{t.setBlockMeta(n,ve);let h=r-(ve-l);return t.setBlockMeta(e,h),!0}}}function Gr(t){return(t&2)>>1>0}function qr(t,e,n){let r=t.map,i=e.clone(),s=0;r.isWithinBounds(e.right(i))&&r.getBlockId(i)===n&&(s|=1,r.setBlockNeighbor(i,r.getBlockNeighbor(i)|4)),r.isWithinBounds(e.up(i))&&r.getBlockId(i)===n&&(s|=2,r.setBlockNeighbor(i,r.getBlockNeighbor(i)|8)),r.isWithinBounds(e.left(i))&&r.getBlockId(i)===n&&(s|=4,r.setBlockNeighbor(i,r.getBlockNeighbor(i)|1)),r.isWithinBounds(e.down(i))&&r.getBlockId(i)===n&&(s|=8,r.setBlockNeighbor(i,r.getBlockNeighbor(i)|2)),r.setBlockNeighbor(e,s)}function Vr(t,e,n){let r=t.map,i=e.clone();r.isWithinBounds(e.right(i))&&r.getBlockId(i)===n&&r.setBlockNeighbor(i,r.getBlockNeighbor(i)&11),r.isWithinBounds(e.up(i))&&r.getBlockId(i)===n&&r.setBlockNeighbor(i,r.getBlockNeighbor(i)&7),r.isWithinBounds(e.left(i))&&r.getBlockId(i)===n&&r.setBlockNeighbor(i,r.getBlockNeighbor(i)&14),r.isWithinBounds(e.down(i))&&r.getBlockId(i)===n&&r.setBlockNeighbor(i,r.getBlockNeighbor(i)&13),r.setBlockNeighbor(e,0)}function Zr(t){}function me(t,e,n,r=0){let i=t.map.getBlockId(e),s=D.hasComponent(de,n);if(!s)jr(t,e,i),D.hasComponent(de,i)||Vr(t,e,i);else if(!D.hasComponent(ye,i))return;t.map.setBlockId(e,n),t.map.setBlockMeta(e,r),s||qr(t,e,n),Wr(t,e,n)}var pl="grassSoil",dl=5;function Qr(t){t.on(Xt,vl)}function vl(t,e,n){let r=t.map,i=r.getBlockId(n);if(D.hasComponent(pl,i)){let s=r.getBlockId(n.up());D.hasComponent(ye,s)&&j.next()<.001&&me(t,n,dl)}}function Jr(t){}var ei=new AudioContext;gl(ei);async function be(t,e={}){let n=ei,r=new ArrayBuffer(t.byteLength);new Uint8Array(r).set(t);let i=await n.decodeAudioData(r);return new ti(n,i,Boolean(e.loop))}var ml={gain:0,pitch:0,pan:0,loop:!1},ti=class{constructor(e,n,r=!1){this.context=e,this.buffer=n,this._source=null,this.playing=!1,this.loop=r,this.onAudioSourceEnded=this.onAudioSourceEnded.bind(this)}onAudioSourceEnded(){this._playing=!1}play(e=ml){if(!this.buffer)return;this._source&&this.destroy();let n=this.context,r=n.createBufferSource();r.addEventListener("ended",this.onAudioSourceEnded),r.buffer=this.buffer,r.loop=e.loop;let i=r;if(e.pitch&&(r.detune.value=e.pitch*100),e.gain){let s=n.createGain();s.gain.value=e.gain,i=i.connect(s)}if(e.pan){let s=n.createStereoPanner();s.pan.value=e.pan,i=i.connect(s)}i.connect(n.destination),r.start(),this._source=r,this._playing=!0}pause(){this._source.stop(),this._playing=!1}destroy(){this._source&&this._source.disconnect(),this._source=null}};async function gl(t){let e=()=>{t.state==="suspended"&&t.resume()};document.addEventListener("click",e)}var V={};var ni="material";async function ri(t){V["audio:dirt"]=await be(t.get("raw://dirt.wav")),V["audio:stone"]=await be(t.get("raw://stone.wav")),V["audio:fluid"]=await be(t.get("raw://waterpop.wav")),V["audio:metal"]=await be(t.get("raw://ding.wav"))}function ii(t){}function si(t){switch(xl(t)){case"dirt":V["audio:dirt"].play({pitch:j.range(-5,5)});break;case"fluid":V["audio:fluid"].play({pitch:j.range(-5,5)});break;case"metal":V["audio:metal"].play({gain:4,pitch:j.range(-5,5)});break;case"stone":default:V["audio:stone"].play({gain:1.5,pitch:j.range(-5,5)});break}}function xl(t){return D.hasComponent(ni,t)?D.getComponent(ni,t):"stone"}var yl="air",El="falling";function ai(t){t.on(Xe,wl)}function wl(t){let e=_l(t.map.getLoadedChunks());for(let n of e)Ml(t,n)}function _l(t){return t.sort((e,n)=>e.chunkCoordY<n.chunkCoordY?1:e.chunkCoordY>n.chunkCoordY?-1:e.chunkCoordX<n.chunkCoordX?1:e.chunkCoordX>n.chunkCoordX?-1:0)}function Ml(t,e){let n=t.map,r=e.chunkCoordX*n.chunkWidth,i=e.chunkCoordY*n.chunkHeight,s=n.at(0,0);for(let a=n.chunkHeight-1;a>=0;--a)for(let o=0;o<n.chunkWidth;++o){s.set(o+r,a+i);let l=n.getBlockId(s);D.hasComponent(El,l)&&bl(t,s)}}function bl(t,e){let n=t.map;!Al(n,e)}function Al(t,e){let n=e.copy().down();return Cl(t,e,n)}function Cl(t,e,n){if(!t.isWithinBounds(n))return!1;if(!t.isWithinLoaded(n))return t.setBlockId(e,0),!0;let r=t.getBlockId(e),i=t.getBlockId(n);if(D.hasComponent(yl,i))return t.setBlockId(n,r).setBlockId(e,0),!0}var Sl=[{w:1,h:4,m:[1,1,1,1]},{w:4,h:1,m:[1,1,1,1]}],kl=[{w:2,h:2,m:[1,1,1,1]}],Tl=[{w:3,h:2,m:[0,1,0,1,1,1]},{w:2,h:3,m:[1,0,1,1,1,0]},{w:3,h:2,m:[1,1,1,0,1,0]},{w:2,h:3,m:[0,1,1,1,0,1]}],Il=[{w:2,h:3,m:[1,0,1,0,1,1]},{w:3,h:2,m:[0,0,1,1,1,1]},{w:2,h:3,m:[1,1,0,1,0,1]},{w:3,h:2,m:[1,1,1,1,0,0]}],Rl=[{w:2,h:3,m:[0,1,0,1,1,1]},{w:3,h:2,m:[1,0,0,1,1,1]},{w:2,h:3,m:[1,1,1,0,1,0]},{w:3,h:2,m:[1,1,1,0,0,1]}],Ll=[{w:3,h:2,m:[1,1,0,0,1,1]},{w:2,h:3,m:[0,1,1,1,1,0]}],Bl=[{w:3,h:2,m:[0,1,1,1,1,0]},{w:2,h:3,m:[1,0,1,1,0,1]}],qt=[Sl,kl,Tl,Rl,Il,Bl,Ll],oi=Infinity,li=Infinity,Vt=1,Zt=1;for(let t of qt)for(let e of t)oi=Math.min(e.w,oi),li=Math.min(e.h,li),Vt=Math.max(e.w,Vt),Zt=Math.max(e.h,Zt);var hi=Vt,ci=Zt;var Ol=30,Nl=[1,3,4,6,7,8,9,10,11,12];function ui(){return{placing:!1,floating:!0,shape:null,shapeType:null,shapeMap:new je(0,0,hi,ci),value:0,placeX:0,placeY:0,placeTicks:0}}function fi(t,e,n,r,i,s,a,o,l){let h=i.map;if(e.placing){let c=e.shape,u=Math.min(h.bounds.right-c.w,Math.max(h.bounds.left,s-Math.floor((c.w-1)/2))),f=Math.min(h.bounds.bottom-c.h,Math.max(h.bounds.top,a-Math.floor((c.h-1)/2)));if(e.floating){let d=Math.sign(u-e.placeX),g=Math.sign(f-e.placeY);Ge(c,e.placeX+d,e.placeY+g,h)||(e.floating=!1),e.placeX+=d,e.placeY+=g,e.valid=!1}else{let d=e.placeX;d<u?Ge(c,d+1,e.placeY,h)||(e.placeX+=1):d>u&&(Ge(c,d-1,e.placeY,h)||(e.placeX-=1));let g=e.placeY;g<f?Ge(c,e.placeX,g+1,h)||(e.placeY+=1):g>f&&(Ge(c,e.placeX,g-1,h)||(e.placeY-=1)),e.valid=Dl(e.value,c,e.placeX,e.placeY,h)}}e.placeTicks<=0?e.placing?(n.value&&e.valid&&(Pl(e.value,e.shape,e.placeX,e.placeY,i),e.placing=!1,e.placeTicks=Ol,o(e)),r.value&&(e.placing=!1)):(zl(e),e.placing=!0,e.floating=!0,e.valid=!1,l(e)):e.placeTicks-=t}function Ge(t,e,n,r){let{w:i,h:s,m:a}=t,o=r.at(0,0);for(let l=0;l<s;++l)for(let h=0;h<i;++h){let c=h+l*i;if(a[c]){if(o.set(h+e,l+n),!r.isWithinLoaded(o))continue;let u=r.getBlockId(o);if(D.hasComponent(de,u)){if(r.getBlockMeta(o)>=ve)return!0}else if(!D.hasComponent(ye,u))return!0}}return!1}function Dl(t,e,n,r,i){if(D.hasComponent(de,t))return!0;let s=i.at(n,r),{w:a,h:o,m:l}=e;for(let h=0;h<o;++h)for(let c=0;c<a;++c){s.set(c+n,h+r);let u=c+h*a;if(l[u]){if(!i.isWithinLoaded(s))continue;if(i.getBlockNeighbor(s)!==15)return!0}}return!1}function Pl(t,e,n,r,i){let{w:s,h:a,m:o}=e,l=i.map.at(0,0);for(let h=0;h<a;++h)for(let c=0;c<s;++c){let u=c+h*s;o[u]&&(l.set(c+n,h+r),me(i,l,t))}}function Hl(t,e,n,r,i){let{w:s,h:a,m:o}=e,l=i.at(0,0);for(let h=0;h<a;++h)for(let c=0;c<s;++c){let u=c+h*s;o[u]&&(l.set(c+n,h+r),i.setBlockId(l,t))}}function zl(t){let e=j.choose(qt),n=Math.floor(j.range(0,e.length)),r=t.value,i=!1;switch(r){case 0:i=!0;break;case 1:i=j.next()<1/4;break;case 3:i=j.next()<1/8;break;case 4:i=j.next()<1/4;break;case 6:i=j.next()<1/8;break;default:i=j.next()<1/6;break}let s=i?j.choose(Nl):r;t.value=s,t.shapeType=e,t.shape=e[n],t.shapeMap.clear(),Hl(s,t.shape,0,0,t.shapeMap)}function pi(t,e,n,r,i,s,a){let o=0,l=0;switch((t<=.5?0:2)+(e<=.5?0:1)){case 0:{let c=pe.screenToWorld(0,0,s,a);o=c[0],l=c[1]}break;case 1:{let c=pe.screenToWorld(0,i,s,a);o=c[0],l=c[1]}break;case 2:{let c=pe.screenToWorld(r,0,s,a);o=c[0],l=c[1]}break;case 3:{let c=pe.screenToWorld(r,i,s,a);o=c[0],l=c[1]}break}return[Math.floor(o/n),Math.floor(l/n)]}function Qt(t,e){let n=t.map.chunkWidth,r=t.map.chunkHeight;if(n!==e.chunkWidth||r!==e.chunkHeight)return null;t.score=e.score||0,t.cameraX=e.cameraX||0,t.cameraY=e.cameraY||0;let i=n*r;for(let s of Object.keys(e.chunks)){let a=e.chunks[s],[o,l]=ft(s),h=new Fe(n,r);for(let u=0;u<i;++u)h.block[u]=a.block[u],h.meta[u]=a.meta[u],h.neighbor[u]=a.neighbor[u];let c=new Ye(this,s,o,l,h);t.map.chunks[s]=c}return t}function Jt(t,e){let n=t.map.chunkWidth,r=t.map.chunkHeight;e.score=t.score,e.cameraX=t.cameraX,e.cameraY=t.cameraY,e.chunkWidth=n,e.chunkHeight=r;let i={},s=n*r;for(let a of t.map.getLoadedChunks()){let o=a.chunkId,l={block:new Array(s),meta:new Array(s),neighbor:new Array(s)};for(let h=0;h<s;++h)l.block[h]=a.data.block[h],l.meta[h]=a.data.meta[h],l.neighbor[h]=a.data.neighbor[h];i[o]=l}return e.chunks=i,e}var en=class{constructor(){this.prevTransformMatrix=null,this.domProjectionMatrix=new DOMMatrix,this.domViewMatrix=new DOMMatrix,this.ctx=null}begin(e,n,r){if(this.ctx)throw new Error("View already begun - maybe missing end() call?");n&&di(this.domViewMatrix,n),r&&di(this.domProjectionMatrix,r),this.prevTransformMatrix=e.getTransform(),e.setTransform(this.domProjectionMatrix);let{a:i,b:s,c:a,d:o,e:l,f:h}=this.domViewMatrix;e.transform(i,s,a,o,l,h),this.ctx=e}end(e){e.setTransform(this.prevTransformMatrix),this.ctx=null}};function di(t,e){return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.e=e[12],t.f=e[13],t}var vi=10,mi=100,tn=300,J=4,nn=.1;function gi(t,e,n,r){let i=e.map.getBlockId(n);if(!D.hasComponent("air",i)){if(D.hasComponent("fluid",i)){Kl(t,e,n,r,i);return}if(D.hasComponent("solid",i)){$l(t,e,n,r,i);return}}}function Kl(t,e,n,r,i){let s=e.map,a=s.getBlockMeta(n),o=a<=0?1:a/ve,l=D.getComponent("color",i);t.fillStyle=l,t.fillRect(0,(1-o)*r,r,r*o);let h=Date.now()/2e3,c=n.x/s.chunkWidth,u=n.y/s.chunkHeight,f=n.blockCoordX%2==0,d=n.blockCoordY%2==0,g=Math.sin(h+c-u+(f?.3:0)+(d?.1:0));t.fillStyle=`rgba(0, 0, 100, ${(g+1)/2*.4})`,t.fillRect(0,(1-o)*r,r,r*o)}function $l(t,e,n,r,i){let s=e.map,a=D.getComponent("color",i);if(t.fillStyle=a,t.fillRect(0,0,r,r),i===Te.blockId){let o=Date.now()/500,l=n.x/s.chunkWidth,h=n.y/s.chunkHeight,c=Math.sin(o+l*4+h*4);t.fillStyle=`rgba(255, 255, 255, ${Math.max(0,c-.6)})`,t.fillRect(0,0,r,r)}else if(i===zr.blockId){let o=n.blockCoordX%2==0,l=n.blockCoordY%2==0;t.fillStyle=`rgba(0, 0, 0, ${o&&l?.1:0})`,t.fillRect(0,0,r,r);let h=s.getBlockNeighbor(n),c=Math.ceil(r/4);if(!Gr(h)){let u=s.getBlockId(n.up());D.hasComponent(ye,u)&&(t.fillStyle="limegreen",t.fillRect(0,0,r,c)),n.down()}}else if(i===Kr.blockId){let o=n.blockCoordX%2==0;t.fillStyle=`rgba(0, 0, 0, ${o?.1:0})`,t.fillRect(0,0,r,r)}}async function xi(){}function rn(t,e,n){let r=e.chunkWidth*n,i=e.chunkHeight*n;for(let s of e.getLoadedChunks()){let a=s.chunkCoordX*r,o=s.chunkCoordY*i;t.translate(a,o),Ul(t,e,s,n),t.translate(-a,-o)}}function yi(t,e,n){rn(t,e.shapeMap,n)}function Ul(t,e,n,r){let i=e.chunkWidth,s=e.chunkHeight,a=n.chunkCoordX*i,o=n.chunkCoordY*s,l=e.at(a,o);for(let h=0;h<s;++h)for(let c=0;c<i;++c)l.set(c+a,h+o),t.translate(c*r,h*r),gi(t,{map:e},l,r),t.translate(-c*r,-h*r)}async function Ei(t){await xi();let e=t.display,n=e.canvas.getContext("2d");n.imageSmoothingEnabled=!1;let r=new en,i=t.world,s=t.camera,a=t.placement;return function(){let o=s.getViewMatrix(),l=s.getProjectionMatrix();n.clearRect(0,0,e.width,e.height),r.begin(n,o,l),rn(n,i.map,J),a.placing&&(n.translate(a.placeX*J,a.placeY*J),yi(n,a,J),n.translate(-a.placeX*J,-a.placeY*J)),r.end(n),i.time<tn&&(n.fillStyle=`rgba(0, 0, 0, ${1-i.time/tn})`,n.fillRect(0,0,e.width,e.height)),n.fillStyle="white",n.fillText(i.score,4,12)}}var ds=Ts(Vi());var Zi={},Ah=function(t,e,n,r,i){var s=new Worker(Zi[e]||(Zi[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return s.onmessage=function(a){var o=a.data,l=o.$e$;if(l){var h=new Error(l[0]);h.code=l[1],h.stack=l[2],i(h,null)}else i(null,o)},s.postMessage(n,r),s},ne=Uint8Array,Ae=Uint16Array,yn=Uint32Array,En=new ne([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wn=new ne([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Qi=new ne([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ji=function(t,e){for(var n=new Ae(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var i=new yn(n[30]),r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},es=Ji(En,2),_n=es[0],Ch=es[1];_n[28]=258,Ch[258]=28;var ts=Ji(wn,0),ns=ts[0],bp=ts[1],wt=new Ae(32768);for(var Y=0;Y<32768;++Y)we=(Y&43690)>>>1|(Y&21845)<<1,we=(we&52428)>>>2|(we&13107)<<2,we=(we&61680)>>>4|(we&3855)<<4,wt[Y]=((we&65280)>>>8|(we&255)<<8)>>>1;var we,Oe=function(t,e,n){for(var r=t.length,i=0,s=new Ae(e);i<r;++i)t[i]&&++s[t[i]-1];var a=new Ae(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;if(n){o=new Ae(1<<e);var l=15-e;for(i=0;i<r;++i)if(t[i])for(var h=i<<4|t[i],c=e-t[i],u=a[t[i]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)o[wt[u]>>>l]=h}else for(o=new Ae(r),i=0;i<r;++i)t[i]&&(o[i]=wt[a[t[i]-1]++]>>>15-t[i]);return o},Ze=new ne(288);for(var Y=0;Y<144;++Y)Ze[Y]=8;for(var Y=144;Y<256;++Y)Ze[Y]=9;for(var Y=256;Y<280;++Y)Ze[Y]=7;for(var Y=280;Y<288;++Y)Ze[Y]=8;var rs=new ne(32);for(var Y=0;Y<32;++Y)rs[Y]=5;var is=Oe(Ze,9,1);var ss=Oe(rs,5,1),_t=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},ae=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&n},Mt=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(e&7)},as=function(t){return(t+7)/8|0},bt=function(t,e,n){(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length);var r=new(t.BYTES_PER_ELEMENT==2?Ae:t.BYTES_PER_ELEMENT==4?yn:ne)(n-e);return r.set(t.subarray(e,n)),r};var os=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ie=function(t,e,n){var r=new Error(e||os[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,ie),!n)throw r;return r},ls=function(t,e,n){var r=t.length;if(!r||n&&n.f&&!n.l)return e||new ne(0);var i=!e||n,s=!n||n.i;n||(n={}),e||(e=new ne(r*3));var a=function(H){var Ce=e.length;if(H>Ce){var et=new ne(Math.max(Ce*2,H));et.set(e),e=et}},o=n.f||0,l=n.p||0,h=n.b||0,c=n.l,u=n.d,f=n.m,d=n.n,g=r*8;do{if(!c){o=ae(t,l,1);var y=ae(t,l+1,3);if(l+=3,y)if(y==1)c=is,u=ss,f=9,d=5;else if(y==2){var _=ae(t,l,31)+257,S=ae(t,l+10,15)+4,b=_+ae(t,l+5,31)+1;l+=14;for(var k=new ne(b),P=new ne(19),w=0;w<S;++w)P[Qi[w]]=ae(t,l+w*3,7);l+=S*3;for(var T=_t(P),N=(1<<T)-1,v=Oe(P,T,1),w=0;w<b;){var L=v[ae(t,l,N)];l+=L&15;var p=L>>>4;if(p<16)k[w++]=p;else{var B=0,O=0;for(p==16?(O=3+ae(t,l,3),l+=2,B=k[w-1]):p==17?(O=3+ae(t,l,7),l+=3):p==18&&(O=11+ae(t,l,127),l+=7);O--;)k[w++]=B}}var m=k.subarray(0,_),x=k.subarray(_);f=_t(m),d=_t(x),c=Oe(m,f,1),u=Oe(x,d,1)}else ie(1);else{var p=as(l)+4,E=t[p-4]|t[p-3]<<8,R=p+E;if(R>r){s&&ie(0);break}i&&a(h+E),e.set(t.subarray(p,R),h),n.b=h+=E,n.p=l=R*8,n.f=o;continue}if(l>g){s&&ie(0);break}}i&&a(h+131072);for(var F=(1<<f)-1,K=(1<<d)-1,Z=l;;Z=l){var B=c[Mt(t,l)&F],Q=B>>>4;if(l+=B&15,l>g){s&&ie(0);break}if(B||ie(2),Q<256)e[h++]=Q;else if(Q==256){Z=l,c=null;break}else{var ee=Q-254;if(Q>264){var w=Q-257,he=En[w];ee=ae(t,l,(1<<he)-1)+_n[w],l+=he}var De=u[Mt(t,l)&K],_e=De>>>4;De||ie(3),l+=De&15;var x=ns[_e];if(_e>3){var he=wn[_e];x+=Mt(t,l)&(1<<he)-1,l+=he}if(l>g){s&&ie(0);break}i&&a(h+131072);for(var ce=h+ee;h<ce;h+=4)e[h]=e[h-x],e[h+1]=e[h+1-x],e[h+2]=e[h+2-x],e[h+3]=e[h+3-x];h=ce}}n.l=c,n.p=Z,n.b=h,n.f=o,c&&(o=1,n.m=f,n.d=u,n.n=d)}while(!o);return h==e.length?e:bt(e,0,h)};var Sh=new ne(0);var kh=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},hs=function(t,e,n){for(var r=t(),i=t.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<r.length;++a){var o=r[a],l=s[a];if(typeof o=="function"){e+=";"+l+"=";var h=o.toString();if(o.prototype)if(h.indexOf("[native code]")!=-1){var c=h.indexOf(" ",8)+1;e+=h.slice(c,h.indexOf("(",c))}else{e+=h;for(var u in o.prototype)e+=";"+l+".prototype."+u+"="+o.prototype[u].toString()}else e+=h}else n[l]=o}return[e,n]},At=[],Th=function(t){var e=[];for(var n in t)t[n].buffer&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e},Ih=function(t,e,n,r){var i;if(!At[n]){for(var s="",a={},o=t.length-1,l=0;l<o;++l)i=hs(t[l],s,a),s=i[0],a=i[1];At[n]=hs(t[o],s,a)}var h=kh({},At[n][1]);return Ah(At[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,h,Th(h),r)},Rh=function(){return[ne,Ae,yn,En,wn,Qi,_n,ns,is,ss,wt,os,Oe,_t,ae,Mt,as,bt,ie,ls,bn,cs,us]};var cs=function(t){return postMessage(t,[t.buffer])},us=function(t){return t&&t.size&&new ne(t.size)},Lh=function(t,e,n,r,i,s){var a=Ih(n,r,i,function(o,l){a.terminate(),s(o,l)});return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}};var xe=function(t,e){return t[e]|t[e+1]<<8},le=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Mn=function(t,e){return le(t,e)+le(t,e+4)*4294967296};function Bh(t,e,n){return n||(n=e,e={}),typeof n!="function"&&ie(7),Lh(t,e,[Rh],function(r){return cs(bn(r.data[0],us(r.data[1])))},1,n)}function bn(t,e){return ls(t,e)}var Ap=typeof TextEncoder!="undefined"&&new TextEncoder,An=typeof TextDecoder!="undefined"&&new TextDecoder,Oh=0;try{An.decode(Sh,{stream:!0}),Oh=1}catch(t){}var Nh=function(t){for(var e="",n=0;;){var r=t[n++],i=(r>127)+(r>223)+(r>239);if(n+i>t.length)return[e,bt(t,n-1)];i?i==3?(r=((r&15)<<18|(t[n++]&63)<<12|(t[n++]&63)<<6|t[n++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?e+=String.fromCharCode((r&31)<<6|t[n++]&63):e+=String.fromCharCode((r&15)<<12|(t[n++]&63)<<6|t[n++]&63):e+=String.fromCharCode(r)}};function Dh(t,e){if(e){for(var n="",r=0;r<t.length;r+=16384)n+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return n}else{if(An)return An.decode(t);var i=Nh(t),s=i[0],a=i[1];return a.length&&ie(8),s}}var Ph=function(t,e){return e+30+xe(t,e+26)+xe(t,e+28)},Hh=function(t,e,n){var r=xe(t,e+28),i=Dh(t.subarray(e+46,e+46+r),!(xe(t,e+8)&2048)),s=e+46+r,a=le(t,e+20),o=n&&a==4294967295?zh(t,s):[a,le(t,e+24),le(t,e+42)],l=o[0],h=o[1],c=o[2];return[xe(t,e+10),l,h,i,s+xe(t,e+30)+xe(t,e+32),c]},zh=function(t,e){for(;xe(t,e)!=1;e+=4+xe(t,e+2));return[Mn(t,e+12),Mn(t,e+4),Mn(t,e+20)]};var fs=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(t){t()};function ps(t,e,n){n||(n=e,e={}),typeof n!="function"&&ie(7);var r=[],i=function(){for(var p=0;p<r.length;++p)r[p]()},s={},a=function(p,E){fs(function(){n(p,E)})};fs(function(){a=n});for(var o=t.length-22;le(t,o)!=101010256;--o)if(!o||t.length-o>65558)return a(ie(13,0,1),null),i;var l=xe(t,o+8);if(l){var h=l,c=le(t,o+16),u=c==4294967295||h==65535;if(u){var f=le(t,o-12);u=le(t,f)==101075792,u&&(h=l=le(t,f+32),c=le(t,f+48))}for(var d=e&&e.filter,g=function(p){var E=Hh(t,c,u),R=E[0],_=E[1],S=E[2],b=E[3],k=E[4],P=E[5],w=Ph(t,P);c=k;var T=function(v,L){v?(i(),a(v,null)):(L&&(s[b]=L),--l||a(null,s))};if(!d||d({name:b,size:_,originalSize:S,compression:R}))if(!R)T(null,bt(t,w,w+_));else if(R==8){var N=t.subarray(w,w+_);if(_<32e4)try{T(null,bn(N,new ne(S)))}catch(v){T(v,null)}else r.push(Bh(N,{size:S},T))}else T(ie(14,"unknown compression type "+R,1),null);else T(null,null)},y=0;y<h;++y)g(y)}else a(null,{});return i}var Qe=class{constructor(e){let n;typeof e=="object"&&e instanceof Qe?n=e.source:n=String(e),this.source=n,this._re=(0,ds.makeRe)(n)}test(e){return this._re.test(e)}},Kh=/^([_\w\d]+)\:\/\//;async function vs(t,e,n,r,i,s){let{loadings:a}=t,o;e in a?o=a[e]:(o=new Ne(s),a[e]=o);let l=Ne.nextAttempt(o),h=[o.promise];return Kh.test(n)?h.push(ms(t,n,s).then(c=>r(c,i)).then(c=>Ne.isCurrentAttempt(o,l)?Je(t,e,c):void 0)):h.push(r(n).then(c=>Ne.isCurrentAttempt(o,l)?Je(t,e,c):void 0)),await Promise.race(h)}function Je(t,e,n){let{store:r,loadings:i}=t;return r[e]=n,e in i&&(i[e].resolve(n),delete i[e]),n}function $h(t,e,n){let{defaults:r}=t;typeof e=="string"&&(e=new Qe(e));let i=`__default://[${r.length}]`;return Je(t,i,n),r.push(new ys(e,i)),n}function Uh(t,e){let{store:n,loadings:r}=t;e in r&&(r[e].reject(new Error("Stop loading to delete asset.")),delete r[e]),e in n&&delete n[e]}function Yh(t,e){typeof e=="string"&&(e=new Qe(e));let{store:n,loadings:r}=t;for(let[i,s]of Object.entries(r))e.test(i)&&(s.reject(new Error(`Stop loading to clear assets matching ${e}`)),delete r[i]);for(let i of Object.keys(n))e.test(i)&&delete n[i]}function Fh(t){let{store:e,loadings:n,defaults:r}=t;for(let[i,s]of Object.entries(n))s.reject(new Error("Stop loading to clear all assets.")),delete n[i];for(let i of Object.keys(e))delete e[i];r.length=0}function Wh(t,e){let{loadings:n}=t;return e in n?n[e].promise:null}async function ms(t,e,n){let{store:r,loadings:i}=t;if(e in r)return r[e];if(e in i)return i[e].promise;{let s=new Ne(n);return i[e]=s,s.promise}}function jh(t,e){let{defaults:n}=t;for(let r of n)if(r.glob.test(e))return Ct(t,r.uri);return null}function Ct(t,e){return t.store[e]}function Xh(t,e){return Boolean(t.store[e])}function Gh(t){return Object.keys(t.store)}function gs(t,e){return e in t.store}function xs(t,e){return e in t.loadings}var ys=class{constructor(e,n){this.glob=e,this.uri=n}},Ne=class{static nextAttempt(e){return++e._promiseHandle}static isCurrentAttempt(e,n){return e._promiseHandle===n}constructor(e){this._promiseHandle=0,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(e)&&e>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${e} ms.`)},e):null,this._promise=new Promise((n,r)=>{this._value?n(this._value):this._resolve=n,this._reason?r(this._reason):this._reject=r})}get promise(){return this._promise}resolve(e){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(e):this._value=e}reject(e){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(e):this._reason=e}},Cn=class{constructor(e=null){this.parent=e,this.store={},this.loadings={},this.defaults=[]}get(e){let n=this;if(gs(n,e))return Ct(n,e);let r=jh(n,e);return r||null}async resolve(e,n,r,i,s){return this.get(e)||await this.load(e,n,r,i,s)}fallback(e,n){return $h(this,e,n)}cache(e,n){return Je(this,e,n)}async load(e,n,r,i,s){let a=this;return gs(a,e)?Ct(a,e):xs(a,e)?await ms(a,e,s):await vs(a,e,n,r,i,s)}async reload(e,n,r,i,s){return await vs(this,e,n,r,i,s)}unload(e){Uh(this,e)}clear(e){Yh(this,e)}current(e){return Ct(this,e)}exists(e){return Xh(this,e)}loading(e){let n=this;return xs(n,e)?Wh(n,e):null}keys(){return Gh(this)}reset(){Fh(this)}};async function Es(t,e,n=void 0){let r=t,i="raw://",a=await(await fetch(e)).arrayBuffer();await new Promise((o,l)=>{ps(new Uint8Array(a),(h,c)=>{if(h)l(h);else{for(let[u,f]of Object.entries(c)){u=u.replaceAll("\\","/");let d=u.indexOf("/");d>=0&&(u=u.substring(d+1));let g=i+u;Je(r,g,f),n&&n(f,g,u)}o()}})})}Pe.define();document.addEventListener("DOMContentLoaded",Vh);async function qh(t){V["audio:flick"]=await be(t.get("raw://flick.wav")),V["audio:melt"]=await be(t.get("raw://melt.mp3")),V["audio:reset"]=V["audio:flick"],V["audio:background"]=V["audio:melt"],await ri(t)}async function Vh(){let t=document.querySelector("#display"),e=document.querySelector("#inputs").getContext("axisbutton");e.bindAxis("PointerX","Mouse","PosX"),e.bindAxis("PointerY","Mouse","PosY"),e.bindButton("Place","Mouse","Button0"),e.bindButton("Change","Mouse","Button2"),e.bindButton("Reset","Keyboard","KeyR"),e.bindButton("Rotate","Keyboard","KeyQ"),e.bindButton("Save","Keyboard","KeyS"),e.bindButton("Load","Keyboard","KeyL");let n=new Cn;await Es(n,"res.pack"),await qh(n);let r={map:new je,score:0,cameraX:0,cameraY:0,time:0,firstPlace:!0};Gn.assign(r),Xr(r),Zr(r),Qr(r),Jr(r),ii(r),ai(r);let i=localStorage.getItem("worldData");(!i||!Qt(r,JSON.parse(i)))&&Sn(r,t);let s=ui(),a=new pe;a.moveTo(r.cameraX,r.cameraY);let o={display:t,input:e,world:r,camera:a,placement:s,blockTicks:0,autoSaveTicks:0},l=await Ei(o);t.addEventListener("frame",h=>{let u=h.detail.deltaTime/1e3*60;Qh(o)||(r.time+=u,tc(o,u,a),Zh(o,u),Jh(o,u),ec(o,u),l())})}function Zh(t,e){let n=t.world,r=t.display,i=t.input,s=t.camera,a=t.placement,o=s.getViewMatrix(),l=s.getProjectionMatrix(),[h,c]=pe.screenToWorld(i.getInputValue("PointerX")*r.width,i.getInputValue("PointerY")*r.height,o,l),u=Math.floor(h/J),f=Math.floor(c/J);function d(y){let[p,E]=pe.screenToWorld(r.width/2,r.height/2,o,l),R=Math.floor(p/J),_=Math.floor(E/J),S=Math.ceil((y.placeX-R)/4),b=Math.ceil((y.placeY-_)/4);n.cameraX+=S*J,n.cameraY+=b*J,n.score+=1,si(y.value),n.firstPlace&&(n.firstPlace=!1,V["audio:background"].play())}function g(y){let[p,E]=pi(i.getInputValue("PointerX"),i.getInputValue("PointerY"),J,r.width,r.height,o,l);y.placeX=p,y.placeY=E,V["audio:reset"].play({pitch:j.range(-5,5)})}fi(e,a,i.getInput("Place"),i.getInput("Rotate"),n,u,f,d,g)}function Qh(t){let e=t.world,n=t.display,r=t.input;if(r.isButtonReleased("Reset"))return localStorage.removeItem("worldData"),e.map.clear(),Sn(e,n),!0;if(r.isButtonReleased("Save")){let i=Jt(e,{});return qn("worldData.json",JSON.stringify(i)),!0}else if(r.isButtonReleased("Load"))return Vn([".json"],!1).then(i=>i.text()).then(i=>{let s=JSON.parse(i);e.map.clear(),(!s||!Qt(e,s))&&Sn(e,n)}),!0;return!1}function Sn(t,e){t.score=0,t.time=0,t.firstPlace=!0;let n=t.map.at(0,0),r=n.clone();me(t,n,Te.blockId),me(t,n.offset(r,-1,0),Te.blockId),me(t,n.offset(r,0,-1),Te.blockId),me(t,n.offset(r,-1,-1),Te.blockId),t.cameraX=-e.width/2,t.cameraY=-e.height/2}function Jh(t,e){let n=t.blockTicks||0,r=t.world;if($r(r),n<=0){n=vi;{Ur(r);let i=r.map.getLoadedChunks(),s=r.map.chunkWidth,a=r.map.chunkHeight,o=r.map.at(0,0);for(let l of i){let h=l.chunkCoordX*s,c=l.chunkCoordY*a;Yr(r,l);for(let u=0;u<a;++u)for(let f=0;f<s;++f)o.set(f+h,u+c),Fr(r,l,o)}}}else n-=e;t.blockTicks=n}function ec(t,e){let n=t.autoSaveTicks||0,r=t.world;if(n<=0){n=mi;let i=Jt(r,{});localStorage.setItem("worldData",JSON.stringify(i))}else n-=e;t.autoSaveTicks=n}function tc(t,e,n){let r=t.display,i=t.input,s=t.world,a=i.getInput("PointerX"),o=i.getInput("PointerY"),l=r.width/r.height,h=l<=1?l:1,c=l<=1?1:1/l,u=a.value-.5,f=o.value-.5,d=4,g=Math.atan2(f,u),y=Jn(0,0,u,f),p=y<.3?0:y-.3,E=Math.cos(g)*p*J*s.map.chunkWidth*h*d,R=Math.sin(g)*p*J*s.map.chunkWidth*c*d;n.moveTo($t(n.x,s.cameraX+E,e*nn),$t(n.y,s.cameraY+R,e*nn))}})();
//# sourceMappingURL=main.js.map
