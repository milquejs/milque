(()=>{var Ar=Object.create,qt=Object.defineProperty,Cr=Object.getPrototypeOf,xr=Object.prototype.hasOwnProperty,Tr=Object.getOwnPropertyNames,Sr=Object.getOwnPropertyDescriptor;var Rr=n=>qt(n,"__esModule",{value:!0});var Or=(n,t)=>()=>(n&&(t=n(n=0)),t),At=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Lr=(n,t)=>{for(var e in t)qt(n,e,{get:t[e],enumerable:!0})},Mr=(n,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Tr(t))!xr.call(n,i)&&i!=="default"&&qt(n,i,{get:()=>t[i],enumerable:!(e=Sr(t,i))||e.enumerable});return n},kr=n=>Mr(Rr(qt(n!=null?Ar(Cr(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Gn={};Lr(Gn,{basename:()=>Zn,default:()=>us,delimiter:()=>Xn,dirname:()=>Vn,extname:()=>Qn,isAbsolute:()=>Ne,join:()=>Yn,normalize:()=>Ie,relative:()=>zn,resolve:()=>ne,sep:()=>qn});function Wn(n,t){for(var e=0,i=n.length-1;i>=0;i--){var r=n[i];r==="."?n.splice(i,1):r===".."?(n.splice(i,1),e++):e&&(n.splice(i,1),e--)}if(t)for(;e--;e)n.unshift("..");return n}function ne(){for(var n="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var i=e>=0?arguments[e]:"/";if(typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!i)continue;n=i+"/"+n,t=i.charAt(0)==="/"}return n=Wn(De(n.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+n||"."}function Ie(n){var t=Ne(n),e=ls(n,-1)==="/";return n=Wn(De(n.split("/"),function(i){return!!i}),!t).join("/"),!n&&!t&&(n="."),n&&e&&(n+="/"),(t?"/":"")+n}function Ne(n){return n.charAt(0)==="/"}function Yn(){var n=Array.prototype.slice.call(arguments,0);return Ie(De(n,function(t,e){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function zn(n,t){n=ne(n).substr(1),t=ne(t).substr(1);function e(u){for(var h=0;h<u.length&&u[h]==="";h++);for(var f=u.length-1;f>=0&&u[f]==="";f--);return h>f?[]:u.slice(h,f-h+1)}for(var i=e(n.split("/")),r=e(t.split("/")),s=Math.min(i.length,r.length),o=s,a=0;a<s;a++)if(i[a]!==r[a]){o=a;break}for(var l=[],a=o;a<i.length;a++)l.push("..");return l=l.concat(r.slice(o)),l.join("/")}function Vn(n){var t=ke(n),e=t[0],i=t[1];return!e&&!i?".":(i&&(i=i.substr(0,i.length-1)),e+i)}function Zn(n,t){var e=ke(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function Qn(n){return ke(n)[3]}function De(n,t){if(n.filter)return n.filter(t);for(var e=[],i=0;i<n.length;i++)t(n[i],i,n)&&e.push(n[i]);return e}var as,ke,qn,Xn,us,ls,ti=Or(()=>{as=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ke=function(n){return as.exec(n).slice(1)};qn="/",Xn=":";us={extname:Qn,basename:Zn,dirname:Vn,sep:qn,delimiter:Xn,relative:zn,join:Yn,isAbsolute:Ne,normalize:Ie,resolve:ne};ls="ab".substr(-1)==="b"?function(n,t,e){return n.substr(t,e)}:function(n,t,e){return t<0&&(t=n.length+t),n.substr(t,e)}});var re=At((el,ie)=>{var yt=(ti(),Gn);yt&&yt.default?ie.exports=yt.default:yt&&(ie.exports=yt);if(yt)for(let n in yt)ie.exports[n]=yt[n]});var Ut=At((nl,ei)=>{"use strict";var hs=re(),dt="\\\\/",ni=`[^${dt}]`,Et="\\.",cs="\\+",fs="\\?",se="\\/",ps="(?=.)",ii="[^/]",Pe=`(?:${se}|$)`,ri=`(?:^|${se})`,He=`${Et}{1,2}${Pe}`,ds=`(?!${Et})`,gs=`(?!${ri}${He})`,vs=`(?!${Et}{0,1}${Pe})`,ms=`(?!${He})`,Es=`[^.${se}]`,ws=`${ii}*?`,si={DOT_LITERAL:Et,PLUS_LITERAL:cs,QMARK_LITERAL:fs,SLASH_LITERAL:se,ONE_CHAR:ps,QMARK:ii,END_ANCHOR:Pe,DOTS_SLASH:He,NO_DOT:ds,NO_DOTS:gs,NO_DOT_SLASH:vs,NO_DOTS_SLASH:ms,QMARK_NO_DOT:Es,STAR:ws,START_ANCHOR:ri},ys={...si,SLASH_LITERAL:`[${dt}]`,QMARK:ni,STAR:`${ni}*?`,DOTS_SLASH:`${Et}{1,2}(?:[${dt}]|$)`,NO_DOT:`(?!${Et})`,NO_DOTS:`(?!(?:^|[${dt}])${Et}{1,2}(?:[${dt}]|$))`,NO_DOT_SLASH:`(?!${Et}{0,1}(?:[${dt}]|$))`,NO_DOTS_SLASH:`(?!${Et}{1,2}(?:[${dt}]|$))`,QMARK_NO_DOT:`[^.${dt}]`,START_ANCHOR:`(?:^|[${dt}])`,END_ANCHOR:`(?:[${dt}]|$)`},_s={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};ei.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:_s,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:hs.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?ys:si}}});var oe=At(et=>{"use strict";var bs=re(),As=!1,{REGEX_BACKSLASH:Cs,REGEX_REMOVE_BACKSLASH:xs,REGEX_SPECIAL_CHARS:Ts,REGEX_SPECIAL_CHARS_GLOBAL:Ss}=Ut();et.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);et.hasRegexChars=n=>Ts.test(n);et.isRegexChar=n=>n.length===1&&et.hasRegexChars(n);et.escapeRegex=n=>n.replace(Ss,"\\$1");et.toPosixSlashes=n=>n.replace(Cs,"/");et.removeBackslashes=n=>n.replace(xs,t=>t==="\\"?"":t);et.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};et.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:As===!0||bs.sep==="\\";et.escapeLast=(n,t,e)=>{let i=n.lastIndexOf(t,e);return i===-1?n:n[i-1]==="\\"?et.escapeLast(n,t,i-1):`${n.slice(0,i)}\\${n.slice(i)}`};et.removePrefix=(n,t={})=>{let e=n;return e.startsWith("./")&&(e=e.slice(2),t.prefix="./"),e};et.wrapOutput=(n,t={},e={})=>{let i=e.contains?"":"^",r=e.contains?"":"$",s=`${i}(?:${n})${r}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var pi=At((rl,oi)=>{"use strict";var ai=oe(),{CHAR_ASTERISK:Be,CHAR_AT:Rs,CHAR_BACKWARD_SLASH:Jt,CHAR_COMMA:Os,CHAR_DOT:Fe,CHAR_EXCLAMATION_MARK:Ue,CHAR_FORWARD_SLASH:li,CHAR_LEFT_CURLY_BRACE:Je,CHAR_LEFT_PARENTHESES:Ke,CHAR_LEFT_SQUARE_BRACKET:Ls,CHAR_PLUS:Ms,CHAR_QUESTION_MARK:ui,CHAR_RIGHT_CURLY_BRACE:ks,CHAR_RIGHT_PARENTHESES:hi,CHAR_RIGHT_SQUARE_BRACKET:Ds}=Ut(),ci=n=>n===li||n===Jt,fi=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},Ns=(n,t)=>{let e=t||{},i=n.length-1,r=e.parts===!0||e.scanToEnd===!0,s=[],o=[],a=[],l=n,u=-1,h=0,f=0,g=!1,w=!1,b=!1,A=!1,x=!1,D=!1,N=!1,C=!1,P=!1,M=!1,U=0,I,y,R={value:"",depth:0,isGlob:!1},J=()=>u>=i,d=()=>l.charCodeAt(u+1),k=()=>(I=y,l.charCodeAt(++u));for(;u<i;){y=k();let j;if(y===Jt){N=R.backslashes=!0,y=k(),y===Je&&(D=!0);continue}if(D===!0||y===Je){for(U++;J()!==!0&&(y=k());){if(y===Jt){N=R.backslashes=!0,k();continue}if(y===Je){U++;continue}if(D!==!0&&y===Fe&&(y=k())===Fe){if(g=R.isBrace=!0,b=R.isGlob=!0,M=!0,r===!0)continue;break}if(D!==!0&&y===Os){if(g=R.isBrace=!0,b=R.isGlob=!0,M=!0,r===!0)continue;break}if(y===ks&&(U--,U===0)){D=!1,g=R.isBrace=!0,M=!0;break}}if(r===!0)continue;break}if(y===li){if(s.push(u),o.push(R),R={value:"",depth:0,isGlob:!1},M===!0)continue;if(I===Fe&&u===h+1){h+=2;continue}f=u+1;continue}if(e.noext!==!0&&(y===Ms||y===Rs||y===Be||y===ui||y===Ue)===!0&&d()===Ke){if(b=R.isGlob=!0,A=R.isExtglob=!0,M=!0,y===Ue&&u===h&&(P=!0),r===!0){for(;J()!==!0&&(y=k());){if(y===Jt){N=R.backslashes=!0,y=k();continue}if(y===hi){b=R.isGlob=!0,M=!0;break}}continue}break}if(y===Be){if(I===Be&&(x=R.isGlobstar=!0),b=R.isGlob=!0,M=!0,r===!0)continue;break}if(y===ui){if(b=R.isGlob=!0,M=!0,r===!0)continue;break}if(y===Ls){for(;J()!==!0&&(j=k());){if(j===Jt){N=R.backslashes=!0,k();continue}if(j===Ds){w=R.isBracket=!0,b=R.isGlob=!0,M=!0;break}}if(r===!0)continue;break}if(e.nonegate!==!0&&y===Ue&&u===h){C=R.negated=!0,h++;continue}if(e.noparen!==!0&&y===Ke){if(b=R.isGlob=!0,r===!0){for(;J()!==!0&&(y=k());){if(y===Ke){N=R.backslashes=!0,y=k();continue}if(y===hi){M=!0;break}}continue}break}if(b===!0){if(M=!0,r===!0)continue;break}}e.noext===!0&&(A=!1,b=!1);let O=l,z="",p="";h>0&&(z=l.slice(0,h),l=l.slice(h),f-=h),O&&b===!0&&f>0?(O=l.slice(0,f),p=l.slice(f)):b===!0?(O="",p=l):O=l,O&&O!==""&&O!=="/"&&O!==l&&ci(O.charCodeAt(O.length-1))&&(O=O.slice(0,-1)),e.unescape===!0&&(p&&(p=ai.removeBackslashes(p)),O&&N===!0&&(O=ai.removeBackslashes(O)));let c={prefix:z,input:n,start:h,base:O,glob:p,isBrace:g,isBracket:w,isGlob:b,isExtglob:A,isGlobstar:x,negated:C,negatedExtglob:P};if(e.tokens===!0&&(c.maxDepth=0,ci(y)||o.push(R),c.tokens=o),e.parts===!0||e.tokens===!0){let j;for(let L=0;L<s.length;L++){let tt=j?j+1:h,q=s[L],X=n.slice(tt,q);e.tokens&&(L===0&&h!==0?(o[L].isPrefix=!0,o[L].value=z):o[L].value=X,fi(o[L]),c.maxDepth+=o[L].depth),(L!==0||X!=="")&&a.push(X),j=q}if(j&&j+1<n.length){let L=n.slice(j+1);a.push(L),e.tokens&&(o[o.length-1].value=L,fi(o[o.length-1]),c.maxDepth+=o[o.length-1].depth)}c.slashes=s,c.parts=a}return c};oi.exports=Ns});var mi=At((sl,di)=>{"use strict";var ae=Ut(),it=oe(),{MAX_LENGTH:le,POSIX_REGEX_SOURCE:Is,REGEX_NON_SPECIAL_CHARS:Ps,REGEX_SPECIAL_CHARS_BACKREF:Hs,REPLACEMENTS:gi}=ae,Bs=(n,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...n,t);n.sort();let e=`[${n.join("-")}]`;try{new RegExp(e)}catch(i){return n.map(r=>it.escapeRegex(r)).join("..")}return e},Ot=(n,t)=>`Missing ${n}: "${t}" - use "\\\\${t}" to match literal characters`,vi=(n,t)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=gi[n]||n;let e={...t},i=typeof e.maxLength=="number"?Math.min(le,e.maxLength):le,r=n.length;if(r>i)throw new SyntaxError(`Input length: ${r}, exceeds maximum allowed length: ${i}`);let s={type:"bos",value:"",output:e.prepend||""},o=[s],a=e.capture?"":"?:",l=it.isWindows(t),u=ae.globChars(l),h=ae.extglobChars(u),{DOT_LITERAL:f,PLUS_LITERAL:g,SLASH_LITERAL:w,ONE_CHAR:b,DOTS_SLASH:A,NO_DOT:x,NO_DOT_SLASH:D,NO_DOTS_SLASH:N,QMARK:C,QMARK_NO_DOT:P,STAR:M,START_ANCHOR:U}=u,I=E=>`(${a}(?:(?!${U}${E.dot?A:f}).)*?)`,y=e.dot?"":x,R=e.dot?C:P,J=e.bash===!0?I(e):M;e.capture&&(J=`(${J})`),typeof e.noext=="boolean"&&(e.noextglob=e.noext);let d={input:n,index:-1,start:0,dot:e.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=it.removePrefix(n,d),r=n.length;let k=[],O=[],z=[],p=s,c,j=()=>d.index===r-1,L=d.peek=(E=1)=>n[d.index+E],tt=d.advance=()=>n[++d.index]||"",q=()=>n.slice(d.index+1),X=(E="",H=0)=>{d.consumed+=E,d.index+=H},ut=E=>{d.output+=E.output!=null?E.output:E.value,X(E.value)},Pt=()=>{let E=1;for(;L()==="!"&&(L(2)!=="("||L(3)==="?");)tt(),d.start++,E++;return E%2==0?!1:(d.negated=!0,d.start++,!0)},wt=E=>{d[E]++,z.push(E)},ht=E=>{d[E]--,z.pop()},T=E=>{if(p.type==="globstar"){let H=d.braces>0&&(E.type==="comma"||E.type==="brace"),v=E.extglob===!0||k.length&&(E.type==="pipe"||E.type==="paren");E.type!=="slash"&&E.type!=="paren"&&!H&&!v&&(d.output=d.output.slice(0,-p.output.length),p.type="star",p.value="*",p.output=J,d.output+=p.output)}if(k.length&&E.type!=="paren"&&(k[k.length-1].inner+=E.value),(E.value||E.output)&&ut(E),p&&p.type==="text"&&E.type==="text"){p.value+=E.value,p.output=(p.output||"")+E.value;return}E.prev=p,o.push(E),p=E},bt=(E,H)=>{let v={...h[H],conditions:1,inner:""};v.prev=p,v.parens=d.parens,v.output=d.output;let S=(e.capture?"(":"")+v.open;wt("parens"),T({type:E,value:H,output:d.output?"":b}),T({type:"paren",extglob:!0,value:tt(),output:S}),k.push(v)},Yt=E=>{let H=E.close+(e.capture?")":""),v;if(E.type==="negate"){let S=J;E.inner&&E.inner.length>1&&E.inner.includes("/")&&(S=I(e)),(S!==J||j()||/^\)+$/.test(q()))&&(H=E.close=`)$))${S}`),E.inner.includes("*")&&(v=q())&&/^\.[^\\/.]+$/.test(v)&&(H=E.close=`)${v})${S})`),E.prev.type==="bos"&&(d.negatedExtglob=!0)}T({type:"paren",extglob:!0,value:c,output:H}),ht("parens")};if(e.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let E=!1,H=n.replace(Hs,(v,S,K,Q,G,de)=>Q==="\\"?(E=!0,v):Q==="?"?S?S+Q+(G?C.repeat(G.length):""):de===0?R+(G?C.repeat(G.length):""):C.repeat(K.length):Q==="."?f.repeat(K.length):Q==="*"?S?S+Q+(G?J:""):J:S?v:`\\${v}`);return E===!0&&(e.unescape===!0?H=H.replace(/\\/g,""):H=H.replace(/\\+/g,v=>v.length%2==0?"\\\\":v?"\\":"")),H===n&&e.contains===!0?(d.output=n,d):(d.output=it.wrapOutput(H,d,t),d)}for(;!j();){if(c=tt(),c==="\0")continue;if(c==="\\"){let v=L();if(v==="/"&&e.bash!==!0||v==="."||v===";")continue;if(!v){c+="\\",T({type:"text",value:c});continue}let S=/^\\+/.exec(q()),K=0;if(S&&S[0].length>2&&(K=S[0].length,d.index+=K,K%2!=0&&(c+="\\")),e.unescape===!0?c=tt():c+=tt(),d.brackets===0){T({type:"text",value:c});continue}}if(d.brackets>0&&(c!=="]"||p.value==="["||p.value==="[^")){if(e.posix!==!1&&c===":"){let v=p.value.slice(1);if(v.includes("[")&&(p.posix=!0,v.includes(":"))){let S=p.value.lastIndexOf("["),K=p.value.slice(0,S),Q=p.value.slice(S+2),G=Is[Q];if(G){p.value=K+G,d.backtrack=!0,tt(),!s.output&&o.indexOf(p)===1&&(s.output=b);continue}}}(c==="["&&L()!==":"||c==="-"&&L()==="]")&&(c=`\\${c}`),c==="]"&&(p.value==="["||p.value==="[^")&&(c=`\\${c}`),e.posix===!0&&c==="!"&&p.value==="["&&(c="^"),p.value+=c,ut({value:c});continue}if(d.quotes===1&&c!=='"'){c=it.escapeRegex(c),p.value+=c,ut({value:c});continue}if(c==='"'){d.quotes=d.quotes===1?0:1,e.keepQuotes===!0&&T({type:"text",value:c});continue}if(c==="("){wt("parens"),T({type:"paren",value:c});continue}if(c===")"){if(d.parens===0&&e.strictBrackets===!0)throw new SyntaxError(Ot("opening","("));let v=k[k.length-1];if(v&&d.parens===v.parens+1){Yt(k.pop());continue}T({type:"paren",value:c,output:d.parens?")":"\\)"}),ht("parens");continue}if(c==="["){if(e.nobracket===!0||!q().includes("]")){if(e.nobracket!==!0&&e.strictBrackets===!0)throw new SyntaxError(Ot("closing","]"));c=`\\${c}`}else wt("brackets");T({type:"bracket",value:c});continue}if(c==="]"){if(e.nobracket===!0||p&&p.type==="bracket"&&p.value.length===1){T({type:"text",value:c,output:`\\${c}`});continue}if(d.brackets===0){if(e.strictBrackets===!0)throw new SyntaxError(Ot("opening","["));T({type:"text",value:c,output:`\\${c}`});continue}ht("brackets");let v=p.value.slice(1);if(p.posix!==!0&&v[0]==="^"&&!v.includes("/")&&(c=`/${c}`),p.value+=c,ut({value:c}),e.literalBrackets===!1||it.hasRegexChars(v))continue;let S=it.escapeRegex(p.value);if(d.output=d.output.slice(0,-p.value.length),e.literalBrackets===!0){d.output+=S,p.value=S;continue}p.value=`(${a}${S}|${p.value})`,d.output+=p.value;continue}if(c==="{"&&e.nobrace!==!0){wt("braces");let v={type:"brace",value:c,output:"(",outputIndex:d.output.length,tokensIndex:d.tokens.length};O.push(v),T(v);continue}if(c==="}"){let v=O[O.length-1];if(e.nobrace===!0||!v){T({type:"text",value:c,output:c});continue}let S=")";if(v.dots===!0){let K=o.slice(),Q=[];for(let G=K.length-1;G>=0&&(o.pop(),K[G].type!=="brace");G--)K[G].type!=="dots"&&Q.unshift(K[G].value);S=Bs(Q,e),d.backtrack=!0}if(v.comma!==!0&&v.dots!==!0){let K=d.output.slice(0,v.outputIndex),Q=d.tokens.slice(v.tokensIndex);v.value=v.output="\\{",c=S="\\}",d.output=K;for(let G of Q)d.output+=G.output||G.value}T({type:"brace",value:c,output:S}),ht("braces"),O.pop();continue}if(c==="|"){k.length>0&&k[k.length-1].conditions++,T({type:"text",value:c});continue}if(c===","){let v=c,S=O[O.length-1];S&&z[z.length-1]==="braces"&&(S.comma=!0,v="|"),T({type:"comma",value:c,output:v});continue}if(c==="/"){if(p.type==="dot"&&d.index===d.start+1){d.start=d.index+1,d.consumed="",d.output="",o.pop(),p=s;continue}T({type:"slash",value:c,output:w});continue}if(c==="."){if(d.braces>0&&p.type==="dot"){p.value==="."&&(p.output=f);let v=O[O.length-1];p.type="dots",p.output+=c,p.value+=c,v.dots=!0;continue}if(d.braces+d.parens===0&&p.type!=="bos"&&p.type!=="slash"){T({type:"text",value:c,output:f});continue}T({type:"dot",value:c,output:f});continue}if(c==="?"){if(!(p&&p.value==="(")&&e.noextglob!==!0&&L()==="("&&L(2)!=="?"){bt("qmark",c);continue}if(p&&p.type==="paren"){let S=L(),K=c;if(S==="<"&&!it.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(p.value==="("&&!/[!=<:]/.test(S)||S==="<"&&!/<([!=]|\w+>)/.test(q()))&&(K=`\\${c}`),T({type:"text",value:c,output:K});continue}if(e.dot!==!0&&(p.type==="slash"||p.type==="bos")){T({type:"qmark",value:c,output:P});continue}T({type:"qmark",value:c,output:C});continue}if(c==="!"){if(e.noextglob!==!0&&L()==="("&&(L(2)!=="?"||!/[!=<:]/.test(L(3)))){bt("negate",c);continue}if(e.nonegate!==!0&&d.index===0){Pt();continue}}if(c==="+"){if(e.noextglob!==!0&&L()==="("&&L(2)!=="?"){bt("plus",c);continue}if(p&&p.value==="("||e.regex===!1){T({type:"plus",value:c,output:g});continue}if(p&&(p.type==="bracket"||p.type==="paren"||p.type==="brace")||d.parens>0){T({type:"plus",value:c});continue}T({type:"plus",value:g});continue}if(c==="@"){if(e.noextglob!==!0&&L()==="("&&L(2)!=="?"){T({type:"at",extglob:!0,value:c,output:""});continue}T({type:"text",value:c});continue}if(c!=="*"){(c==="$"||c==="^")&&(c=`\\${c}`);let v=Ps.exec(q());v&&(c+=v[0],d.index+=v[0].length),T({type:"text",value:c});continue}if(p&&(p.type==="globstar"||p.star===!0)){p.type="star",p.star=!0,p.value+=c,p.output=J,d.backtrack=!0,d.globstar=!0,X(c);continue}let E=q();if(e.noextglob!==!0&&/^\([^?]/.test(E)){bt("star",c);continue}if(p.type==="star"){if(e.noglobstar===!0){X(c);continue}let v=p.prev,S=v.prev,K=v.type==="slash"||v.type==="bos",Q=S&&(S.type==="star"||S.type==="globstar");if(e.bash===!0&&(!K||E[0]&&E[0]!=="/")){T({type:"star",value:c,output:""});continue}let G=d.braces>0&&(v.type==="comma"||v.type==="brace"),de=k.length&&(v.type==="pipe"||v.type==="paren");if(!K&&v.type!=="paren"&&!G&&!de){T({type:"star",value:c,output:""});continue}for(;E.slice(0,3)==="/**";){let zt=n[d.index+4];if(zt&&zt!=="/")break;E=E.slice(3),X("/**",3)}if(v.type==="bos"&&j()){p.type="globstar",p.value+=c,p.output=I(e),d.output=p.output,d.globstar=!0,X(c);continue}if(v.type==="slash"&&v.prev.type!=="bos"&&!Q&&j()){d.output=d.output.slice(0,-(v.output+p.output).length),v.output=`(?:${v.output}`,p.type="globstar",p.output=I(e)+(e.strictSlashes?")":"|$)"),p.value+=c,d.globstar=!0,d.output+=v.output+p.output,X(c);continue}if(v.type==="slash"&&v.prev.type!=="bos"&&E[0]==="/"){let zt=E[1]!==void 0?"|$":"";d.output=d.output.slice(0,-(v.output+p.output).length),v.output=`(?:${v.output}`,p.type="globstar",p.output=`${I(e)}${w}|${w}${zt})`,p.value+=c,d.output+=v.output+p.output,d.globstar=!0,X(c+tt()),T({type:"slash",value:"/",output:""});continue}if(v.type==="bos"&&E[0]==="/"){p.type="globstar",p.value+=c,p.output=`(?:^|${w}|${I(e)}${w})`,d.output=p.output,d.globstar=!0,X(c+tt()),T({type:"slash",value:"/",output:""});continue}d.output=d.output.slice(0,-p.output.length),p.type="globstar",p.output=I(e),p.value+=c,d.output+=p.output,d.globstar=!0,X(c);continue}let H={type:"star",value:c,output:J};if(e.bash===!0){H.output=".*?",(p.type==="bos"||p.type==="slash")&&(H.output=y+H.output),T(H);continue}if(p&&(p.type==="bracket"||p.type==="paren")&&e.regex===!0){H.output=c,T(H);continue}(d.index===d.start||p.type==="slash"||p.type==="dot")&&(p.type==="dot"?(d.output+=D,p.output+=D):e.dot===!0?(d.output+=N,p.output+=N):(d.output+=y,p.output+=y),L()!=="*"&&(d.output+=b,p.output+=b)),T(H)}for(;d.brackets>0;){if(e.strictBrackets===!0)throw new SyntaxError(Ot("closing","]"));d.output=it.escapeLast(d.output,"["),ht("brackets")}for(;d.parens>0;){if(e.strictBrackets===!0)throw new SyntaxError(Ot("closing",")"));d.output=it.escapeLast(d.output,"("),ht("parens")}for(;d.braces>0;){if(e.strictBrackets===!0)throw new SyntaxError(Ot("closing","}"));d.output=it.escapeLast(d.output,"{"),ht("braces")}if(e.strictSlashes!==!0&&(p.type==="star"||p.type==="bracket")&&T({type:"maybe_slash",value:"",output:`${w}?`}),d.backtrack===!0){d.output="";for(let E of d.tokens)d.output+=E.output!=null?E.output:E.value,E.suffix&&(d.output+=E.suffix)}return d};vi.fastpaths=(n,t)=>{let e={...t},i=typeof e.maxLength=="number"?Math.min(le,e.maxLength):le,r=n.length;if(r>i)throw new SyntaxError(`Input length: ${r}, exceeds maximum allowed length: ${i}`);n=gi[n]||n;let s=it.isWindows(t),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:l,DOTS_SLASH:u,NO_DOT:h,NO_DOTS:f,NO_DOTS_SLASH:g,STAR:w,START_ANCHOR:b}=ae.globChars(s),A=e.dot?f:h,x=e.dot?g:h,D=e.capture?"":"?:",N={negated:!1,prefix:""},C=e.bash===!0?".*?":w;e.capture&&(C=`(${C})`);let P=y=>y.noglobstar===!0?C:`(${D}(?:(?!${b}${y.dot?u:o}).)*?)`,M=y=>{switch(y){case"*":return`${A}${l}${C}`;case".*":return`${o}${l}${C}`;case"*.*":return`${A}${C}${o}${l}${C}`;case"*/*":return`${A}${C}${a}${l}${x}${C}`;case"**":return A+P(e);case"**/*":return`(?:${A}${P(e)}${a})?${x}${l}${C}`;case"**/*.*":return`(?:${A}${P(e)}${a})?${x}${C}${o}${l}${C}`;case"**/.*":return`(?:${A}${P(e)}${a})?${o}${l}${C}`;default:{let R=/^(.*?)\.(\w+)$/.exec(y);if(!R)return;let J=M(R[1]);return J?J+o+R[2]:void 0}}},U=it.removePrefix(n,N),I=M(U);return I&&e.strictSlashes!==!0&&(I+=`${a}?`),I};di.exports=vi});var wi=At((ol,Ei)=>{"use strict";var Fs=re(),Us=pi(),$e=mi(),je=oe(),Js=Ut(),Ks=n=>n&&typeof n=="object"&&!Array.isArray(n),$=(n,t,e=!1)=>{if(Array.isArray(n)){let h=n.map(g=>$(g,t,e));return g=>{for(let w of h){let b=w(g);if(b)return b}return!1}}let i=Ks(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!i)throw new TypeError("Expected pattern to be a non-empty string");let r=t||{},s=je.isWindows(t),o=i?$.compileRe(n,t):$.makeRe(n,t,!1,!0),a=o.state;delete o.state;let l=()=>!1;if(r.ignore){let h={...t,ignore:null,onMatch:null,onResult:null};l=$(r.ignore,h,e)}let u=(h,f=!1)=>{let{isMatch:g,match:w,output:b}=$.test(h,o,t,{glob:n,posix:s}),A={glob:n,state:a,regex:o,posix:s,input:h,output:b,match:w,isMatch:g};return typeof r.onResult=="function"&&r.onResult(A),g===!1?(A.isMatch=!1,f?A:!1):l(h)?(typeof r.onIgnore=="function"&&r.onIgnore(A),A.isMatch=!1,f?A:!1):(typeof r.onMatch=="function"&&r.onMatch(A),f?A:!0)};return e&&(u.state=a),u};$.test=(n,t,e,{glob:i,posix:r}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let s=e||{},o=s.format||(r?je.toPosixSlashes:null),a=n===i,l=a&&o?o(n):n;return a===!1&&(l=o?o(n):n,a=l===i),(a===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?a=$.matchBase(n,t,e,r):a=t.exec(l)),{isMatch:Boolean(a),match:a,output:l}};$.matchBase=(n,t,e,i=je.isWindows(e))=>(t instanceof RegExp?t:$.makeRe(t,e)).test(Fs.basename(n));$.isMatch=(n,t,e)=>$(t,e)(n);$.parse=(n,t)=>Array.isArray(n)?n.map(e=>$.parse(e,t)):$e(n,{...t,fastpaths:!1});$.scan=(n,t)=>Us(n,t);$.compileRe=(n,t,e=!1,i=!1)=>{if(e===!0)return n.output;let r=t||{},s=r.contains?"":"^",o=r.contains?"":"$",a=`${s}(?:${n.output})${o}`;n&&n.negated===!0&&(a=`^(?!${a}).*$`);let l=$.toRegex(a,t);return i===!0&&(l.state=n),l};$.makeRe=(n,t={},e=!1,i=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let r={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(r.output=$e.fastpaths(n,t)),r.output||(r=$e(n,t)),$.compileRe(r,t,e,i)};$.toRegex=(n,t)=>{try{let e=t||{};return new RegExp(n,e.flags||(e.nocase?"i":""))}catch(e){if(t&&t.debug===!0)throw e;return/$^/}};$.constants=Js;Ei.exports=$});var _i=At((al,yi)=>{"use strict";yi.exports=wi()});var Dr=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,Nr=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,mn="noscale",ge="fit",En="scale",wn="fill",yn="stretch",Ir=300,Pr=150,Hr=ge,Br=200,_n=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Dr,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Nr,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=t.querySelector("canvas"),this._contentElement=t.querySelector(".content"),this._innerElement=t.querySelector("#inner"),this._titleElement=t.querySelector("#title"),this._fpsElement=t.querySelector("#fps"),this._dimensionElement=t.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=Ir,this._height=Pr,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){St(this,"mode"),St(this,"debug"),St(this,"disabled"),St(this,"width"),St(this,"height"),St(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",Hr),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,i){switch(t){case"debug":this._debug=i!==null;break;case"disabled":this._disabled=i!==null;break;case"width":this._width=Number(i);break;case"height":this._height=Number(i);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+i+"}}").bind(this);break}switch(t){case"disabled":i?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",i),this._fpsElement.classList.toggle("hidden",i),this._dimensionElement.classList.toggle("hidden",i);break}}getContext(t="2d",e=void 0){return this._canvasElement.getContext(t,e)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);let e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let s=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._fpsElement.textContent!==s&&(this._fpsElement.textContent=s),this.mode===mn){let a=`${this._width}x${this._height}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}else{let a=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}}let r=this._frameEvent.detail;r.now=t,r.prevTime=this._prevAnimationFrameTime,r.deltaTime=e,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(t,e){(t!==this._resizeCanvasWidth||e!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,Br))}updateCanvasSize(t=!0){let e=this.shadowRoot.host.getBoundingClientRect(),i=e.width,r=e.height,s=this._canvasElement,o=this._width,a=this._height,l=this.mode;if(l===yn||l===wn)o=i,a=r;else if(l!==mn&&(i<o||r<a||l===ge||l==En)){let h=i/o,f=r/a;h<f?(o=i,a=a*h):(o=o*f,a=r)}if(o=Math.floor(o),a=Math.floor(a),typeof t=="undefined"&&(t=s.clientWidth!==o||s.clientHeight!==a),!t){this.delayCanvasResize(o,a);return}let u=Math.min(o/this._width,a/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${u}em`,t){l===En?(s.width=this._width,s.height=this._height):l!==yn&&(s.width=o,s.height=a);let h=this._contentElement.style;h.width=`${o}px`,h.height=`${a}px`,(l===ge||l===wn)&&(this._width=o,this._height=a);let g=this._resizeEvent.detail;g.width=o,g.height=a,this.dispatchEvent(this._resizeEvent)}}};_n.define();function St(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var ve=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,i){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e={}){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Ht=class extends ve{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array;for(let i=0;i<t;++i)e.push(this.constructor.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e=this._state,i=e.length,r;if(t<=i)r=e.slice(0,t);else{r=e;for(let s=i;s<t;++s)r.push(this.constructor.createAxisBindingState())}this._state=r,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,i=0,r=0,s=e.length;for(let o=0;o<s;++o){let a=e[o];i+=a.value*(a.inverted?-1:1),r+=a.delta,e[o].delta=0}this._value=i,this._delta=r,super.onPoll(t)}onUpdate(t,e,i){typeof e=="undefined"?this.onAxisChange(t,i):this.onAxisMove(t,e,i)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e={}){super.onBind(t,e);let{inverted:i=!1}=e,r=this._state;r[t].inverted=i}onAxisMove(t,e,i){let r=this._state[t];r.value=e,r.delta+=i}onAxisChange(t,e){let i=this._state[t];i.value+=e,i.delta+=e}onAxisStatus(t,e){let i=this._state[t],r=i.value;i.value=e,i.delta=e-r}},Fr=241,bn=254,Ur=239,Ct=1,me=2,Ee=4,we=8,ye=16,Xt=class extends ve{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e=this._state,i=e.length,r;t<=i?r=e.slice(0,t):(r=new Uint8Array(t),r.set(e)),this._state=r,super.resize(t)}getState(t){let e=this._state[t],i=e&ye?-1:1;return(e&Ct?1:0)*i}onPoll(t){let e=this._state,i=0,r=0,s=0,o=0,a=0,l=e.length;for(let u=0;u<l;++u){let h=e[u],f=h&Ct,g=h&ye;r|=f,s|=h&me,o|=h&Ee,a|=h&we,i+=(f?1:0)*(g?-1:1),e[u]&=Fr}this._value=i,this._down=r!==0,this._pressed=s!==0,this._repeated=o!==0,this._released=a!==0,super.onPoll(t)}onUpdate(t,e,i){i>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,e!==0)}onBind(t,e={}){super.onBind(t,e);let{inverted:i=!1}=e,r=this._state;i?r[t]|=ye:r[t]&=Ur}onButtonPressed(t){let e=this._state,i=e[t];i&Ct||(i|=me,i|=Ct),i|=Ee,e[t]=i}onButtonReleased(t){let e=this._state,i=e[t];i&Ct&&(i|=we,i&=bn),e[t]=i}onButtonStatus(t,e){let i=this._state,r=i[t],s=Boolean(r&Ct);e?r|=Ct:r&=bn,s&&!e&&(r|=we),!s&&e&&(r|=me,r|=Ee),i[t]=r}};var m=class{static parse(t){t=t.trim();let e=t.indexOf(".");if(e<0)throw new Error("Missing device separator for key code.");let i=t.substring(0,e);if(i.length<0)throw new Error("Missing device for key code.");let r=t.substring(e+1);if(r.length<0)throw new Error("Missing code for key code.");return new m(i,r)}constructor(t,e){this.device=t,this.code=e}toString(){return`${this.device}.${this.code}`}};var _="Keyboard",ct="Mouse",Po=new m(_,"KeyA"),Ho=new m(_,"KeyB"),Bo=new m(_,"KeyC"),Fo=new m(_,"KeyD"),Uo=new m(_,"KeyE"),Jo=new m(_,"KeyF"),Ko=new m(_,"KeyG"),$o=new m(_,"KeyH"),jo=new m(_,"KeyI"),Go=new m(_,"KeyJ"),Wo=new m(_,"KeyK"),Yo=new m(_,"KeyL"),zo=new m(_,"KeyM"),qo=new m(_,"KeyN"),Xo=new m(_,"KeyO"),Vo=new m(_,"KeyP"),Zo=new m(_,"KeyQ"),Qo=new m(_,"KeyR"),ta=new m(_,"KeyS"),ea=new m(_,"KeyT"),na=new m(_,"KeyU"),ia=new m(_,"KeyV"),ra=new m(_,"KeyW"),sa=new m(_,"KeyX"),oa=new m(_,"KeyY"),aa=new m(_,"KeyZ"),la=new m(_,"Digit0"),ua=new m(_,"Digit1"),ha=new m(_,"Digit2"),ca=new m(_,"Digit3"),fa=new m(_,"Digit4"),pa=new m(_,"Digit5"),da=new m(_,"Digit6"),ga=new m(_,"Digit7"),va=new m(_,"Digit8"),ma=new m(_,"Digit9"),Ea=new m(_,"Minus"),wa=new m(_,"Equal"),ya=new m(_,"BracketLeft"),_a=new m(_,"BracketRight"),ba=new m(_,"Semicolon"),Aa=new m(_,"Quote"),Ca=new m(_,"Backquote"),xa=new m(_,"Backslash"),Ta=new m(_,"Comma"),Sa=new m(_,"Period"),Ra=new m(_,"Slash"),Oa=new m(_,"Escape"),La=new m(_,"Space"),Ma=new m(_,"CapsLock"),ka=new m(_,"Backspace"),Da=new m(_,"Delete"),Na=new m(_,"Tab"),Ia=new m(_,"Enter"),Pa=new m(_,"ArrowUp"),Ha=new m(_,"ArrowDown"),Ba=new m(_,"ArrowLeft"),Fa=new m(_,"ArrowRight"),Ua=new m(ct,"Button0"),Ja=new m(ct,"Button1"),Ka=new m(ct,"Button2"),$a=new m(ct,"Button3"),ja=new m(ct,"Button4"),Ga=new m(ct,"PosX"),Wa=new m(ct,"PosY"),Ya=new m(ct,"WheelX"),za=new m(ct,"WheelY"),qa=new m(ct,"WheelZ");var _e=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let i=this.listeners;t in i?i[t].push(e):i[t]=[e]}removeEventListener(t,e){let i=this.listeners;if(t in i){let r=i[t],s=r.indexOf(e);s>=0&&r.splice(s,1)}}dispatchInputEvent(t){let e=0;for(let i of this.listeners.input)e|=i(t);return Boolean(e)}},An=class extends _e{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,i={}){super(t,e);let{ignoreRepeat:r=!0}=i;this.ignoreRepeat=r,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;if(e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}},be=10,Ae=100,Cn=class extends _e{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,e,i={}){super(t,e);let{eventsOnFocus:r=!0}=i;this.eventsOnFocus=r,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,i,r;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=t.deltaX*be,i=t.deltaY*be,r=t.deltaZ*be;break;case WheelEvent.DOM_DELTA_PAGE:e=t.deltaX*Ae,i=t.deltaY*Ae,r=t.deltaZ*Ae;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,i=t.deltaY,r=t.deltaZ;break}let s=0,o=this._wheelObject;if(o.code="WheelX",o.movement=e,s|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=i,s|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=r,s|=this.dispatchInputEvent(o),s)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;if(e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let e=this.canvasTarget,{clientWidth:i,clientHeight:r}=e,s=e.getBoundingClientRect(),o=t.movementX/i,a=t.movementY/r,l=(t.clientX-s.left)/i,u=(t.clientY-s.top)/r,h=this._positionObject;h.code="PosX",h.value=l,h.movement=o,this.dispatchInputEvent(h),h.code="PosY",h.value=u,h.movement=a,this.dispatchInputEvent(h)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},Jr=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,Kr=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Ce=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Jr,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Kr,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,e,i){switch(t){case"name":this._name=i,this._nameElement.textContent=i;break;case"value":this._value=i,i!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=i,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=i!==null,this._kbdElement.classList.toggle("disabled",i!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};Ce.define();var $r=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,jr=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,xn=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},Tn=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){let{device:e,code:i,event:r,value:s,movement:o,control:a,shift:l,alt:u}=t,h=this.bindings.getBindings(e,i);switch(r){case"pressed":for(let{input:f,index:g}of h)f.onUpdate(g,1,1);break;case"released":for(let{input:f,index:g}of h)f.onUpdate(g,0,-1);break;case"move":for(let{input:f,index:g}of h)f.onUpdate(g,s,o);break;case"wheel":for(let{input:f,index:g}of h)f.onUpdate(g,void 0,o);break}return h.length>0}},xe=class{constructor(t,e,i,r){this.device=t,this.code=e,this.input=i,this.index=r}},Sn=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,i,r={inverted:!1}){let s,o=this.inputMap;if(o.has(t)){let l=o.get(t),u=t.size;t.onBind(u,r),s=new xe(e,i,t,u),l.push(s)}else{let l=[];o.set(t,l);let u=0;t.onBind(u,r),s=new xe(e,i,t,u),l.push(s)}let a=this.bindingMap;e in a?i in a[e]?a[e][i].push(s):a[e][i]=[s]:a[e]={[i]:[s]}}unbind(t){let e=this.inputMap;if(e.has(t)){let i=this.bindingMap,r=e.get(t);for(let s of r){let{device:o,code:a}=s,l=i[o][a],u=l.indexOf(s);l.splice(u,1)}r.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let i=this.bindingMap;if(t in i){let r=i[t];if(e in r)return r[e]}return[]}},Rn=class{constructor(t,e={}){this.inputs={},this.devices=[new Cn("Mouse",t),new An("Keyboard",t)],this.bindings=new Sn,this.adapter=new Tn(this.bindings),this.autopoller=new xn(this.adapter),this.eventTarget=t,this.anyButton=new Xt(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Ht(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let i of this.devices)i.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let i in t)t[i].length=0;this.autopoller.running&&this.autopoller.stop();for(let i of this.devices)i.removeEventListener("input",this.onInput),i.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let i of this.devices)i.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let e=this.autopoller.running,i=typeof t=="undefined"?!e:Boolean(t);i!==e&&(i?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let i=this.listeners;t in i?i[t].push(e):i[t]=[e]}removeEventListener(t,e){let i=this.listeners;if(t in i){let r=i[t],s=r.indexOf(e);s>=0&&r.splice(s,1)}}dispatchEvent(t){let{type:e}=t,i=0;for(let r of this.listeners[e])i|=r(t)?1:0;return Boolean(i)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){for(let e of t)e.register(this)}bindButton(t,e,i,r=void 0){let s;this.hasButton(t)?s=this.getButton(t):(s=new Xt(1),this.inputs[t]=s),this.bindings.bind(s,e,i,r),this.onBind()}bindAxis(t,e,i,r=void 0){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Ht(1),this.inputs[t]=s),this.bindings.bind(s,e,i,r),this.onBind()}bindAxisButtons(t,e,i,r){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Ht(2),this.inputs[t]=s),this.bindings.bind(s,e,r),this.bindings.bind(s,e,i,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof Xt}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Ht}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let e=this.inputs;for(let i of t)if(e[i].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let e=this.inputs;for(let i of t)if(e[i].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let e=this.inputs;for(let i of t)if(e[i].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let e=this.inputs;for(let i of t){let r=e[i];if(r.value)return r.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let e=this.inputs;for(let i of t){let r=e[i];if(r.delta)return r.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},On=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=$r,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=jr,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=t.querySelector("#title"),this._pollElement=t.querySelector("#poll"),this._focusElement=t.querySelector("#focus"),this._bodyElement=t.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let e=this;this._for="",this._eventTarget=e,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let t=this._context;t&&(t.removeEventListener("bind",this.onInputContextBind),t.removeEventListener("unbind",this.onInputContextUnbind),t.removeEventListener("blur",this.onInputContextBlur),t.removeEventListener("focus",this.onInputContextFocus),t.destroy(),this._context=null)}attributeChangedCallback(t,e,i){switch(t){case"for":{this._for=i;let r,s;i?(r=document.getElementById(i),s=`${r.tagName.toLowerCase()}#${i}`):(r=this,s="input-port"),this._eventTarget=r,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${s}`}break;case"autopoll":this._autopoll=i!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(t="axisbutton",e=void 0){switch(t){case"axisbutton":if(!this._context){let i=new Rn(this._eventTarget,e);i.addEventListener("bind",this.onInputContextBind),i.addEventListener("unbind",this.onInputContextUnbind),i.addEventListener("blur",this.onInputContextBlur),i.addEventListener("focus",this.onInputContextFocus),this._autopoll&&i.toggleAutoPoll(!0),this._context=i}return this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,e=t.inputs,i=t.bindings,r={},s=[];for(let o of Object.keys(e)){let a=e[o],l=!0;for(let u of i.getBindingsByInput(a)){let h=Gr(`${a.constructor.name}.${o}`,`${u.device}.${u.code}`,0,l);s.push(h),l&&(r[o]=h.querySelector("output"),l=!1)}}this._outputElements=r,this._bodyElement.innerHTML="";for(let o of s)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let i of Object.keys(this._outputElements)){let r=this._outputElements[i],s=e[i].value;r.innerText=Number(s).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let e=this._outputElements[t];e.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let i of Object.values(e))if(!i.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};On.define();function Gr(n,t,e,i=!0){let r=document.createElement("tr");i&&r.classList.add("primary");{let s=document.createElement("td");s.textContent=n,s.classList.add("name"),r.appendChild(s)}{let s=document.createElement("td"),o=document.createElement("output");i?o.innerText=Number(e).toFixed(2):o.innerText="---",o.classList.add("value"),s.appendChild(o),r.appendChild(s)}{let s=document.createElement("td");s.classList.add("key");let o=new Ce;o.innerText=t,s.appendChild(o),r.appendChild(s)}return r}var Xa=Symbol("keyboardSource");var Va=Symbol("mouseSource");var Ln={},Wr=function(n,t,e,i,r){var s=new Worker(Ln[t]||(Ln[t]=URL.createObjectURL(new Blob([n],{type:"text/javascript"}))));return s.onerror=function(o){return r(o.error,null)},s.onmessage=function(o){return r(null,o.data)},s.postMessage(e,i),s},V=Uint8Array,ft=Uint16Array,Bt=Uint32Array,Te=new V([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Se=new V([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mn=new V([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kn=function(n,t){for(var e=new ft(31),i=0;i<31;++i)e[i]=t+=1<<n[i-1];for(var r=new Bt(e[30]),i=1;i<30;++i)for(var s=e[i];s<e[i+1];++s)r[s]=s-e[i]<<5|i;return[e,r]},Dn=kn(Te,2),Re=Dn[0],Yr=Dn[1];Re[28]=258,Yr[258]=28;var Nn=kn(Se,0),In=Nn[0],Qa=Nn[1],Vt=new ft(32768);for(var B=0;B<32768;++B)mt=(B&43690)>>>1|(B&21845)<<1,mt=(mt&52428)>>>2|(mt&13107)<<2,mt=(mt&61680)>>>4|(mt&3855)<<4,Vt[B]=((mt&65280)>>>8|(mt&255)<<8)>>>1;var mt,Rt=function(n,t,e){for(var i=n.length,r=0,s=new ft(t);r<i;++r)++s[n[r]-1];var o=new ft(t);for(r=0;r<t;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(e){a=new ft(1<<t);var l=15-t;for(r=0;r<i;++r)if(n[r])for(var u=r<<4|n[r],h=t-n[r],f=o[n[r]-1]++<<h,g=f|(1<<h)-1;f<=g;++f)a[Vt[f]>>>l]=u}else for(a=new ft(i),r=0;r<i;++r)n[r]&&(a[r]=Vt[o[n[r]-1]++]>>>15-n[r]);return a},Ft=new V(288);for(var B=0;B<144;++B)Ft[B]=8;for(var B=144;B<256;++B)Ft[B]=9;for(var B=256;B<280;++B)Ft[B]=7;for(var B=280;B<288;++B)Ft[B]=8;var Pn=new V(32);for(var B=0;B<32;++B)Pn[B]=5;var Hn=Rt(Ft,9,1);var Bn=Rt(Pn,5,1),Zt=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},rt=function(n,t,e){var i=t/8|0;return(n[i]|n[i+1]<<8)>>(t&7)&e},Qt=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},Fn=function(n){return(n/8|0)+(n&7&&1)},te=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var i=new(n instanceof ft?ft:n instanceof Bt?Bt:V)(e-t);return i.set(n.subarray(t,e)),i},Un=function(n,t,e){var i=n.length;if(!i||e&&!e.l&&i<5)return t||new V(0);var r=!t||e,s=!e||e.i;e||(e={}),t||(t=new V(i*3));var o=function(T){var bt=t.length;if(T>bt){var Yt=new V(Math.max(bt*2,T));Yt.set(t),t=Yt}},a=e.f||0,l=e.p||0,u=e.b||0,h=e.l,f=e.d,g=e.m,w=e.n,b=i*8;do{if(!h){e.f=a=rt(n,l,1);var A=rt(n,l+1,3);if(l+=3,A)if(A==1)h=Hn,f=Bn,g=9,w=5;else if(A==2){var C=rt(n,l,31)+257,P=rt(n,l+10,15)+4,M=C+rt(n,l+5,31)+1;l+=14;for(var U=new V(M),I=new V(19),y=0;y<P;++y)I[Mn[y]]=rt(n,l+y*3,7);l+=P*3;for(var R=Zt(I),J=(1<<R)-1,d=Rt(I,R,1),y=0;y<M;){var k=d[rt(n,l,J)];l+=k&15;var x=k>>>4;if(x<16)U[y++]=x;else{var O=0,z=0;for(x==16?(z=3+rt(n,l,3),l+=2,O=U[y-1]):x==17?(z=3+rt(n,l,7),l+=3):x==18&&(z=11+rt(n,l,127),l+=7);z--;)U[y++]=O}}var p=U.subarray(0,C),c=U.subarray(C);g=Zt(p),w=Zt(c),h=Rt(p,g,1),f=Rt(c,w,1)}else throw"invalid block type";else{var x=Fn(l)+4,D=n[x-4]|n[x-3]<<8,N=x+D;if(N>i){if(s)throw"unexpected EOF";break}r&&o(u+D),t.set(n.subarray(x,N),u),e.b=u+=D,e.p=l=N*8;continue}if(l>b){if(s)throw"unexpected EOF";break}}r&&o(u+131072);for(var j=(1<<g)-1,L=(1<<w)-1,tt=l;;tt=l){var O=h[Qt(n,l)&j],q=O>>>4;if(l+=O&15,l>b){if(s)throw"unexpected EOF";break}if(!O)throw"invalid length/literal";if(q<256)t[u++]=q;else if(q==256){tt=l,h=null;break}else{var X=q-254;if(q>264){var y=q-257,ut=Te[y];X=rt(n,l,(1<<ut)-1)+Re[y],l+=ut}var Pt=f[Qt(n,l)&L],wt=Pt>>>4;if(!Pt)throw"invalid distance";l+=Pt&15;var c=In[wt];if(wt>3){var ut=Se[wt];c+=Qt(n,l)&(1<<ut)-1,l+=ut}if(l>b){if(s)throw"unexpected EOF";break}r&&o(u+131072);for(var ht=u+X;u<ht;u+=4)t[u]=t[u-c],t[u+1]=t[u+1-c],t[u+2]=t[u+2-c],t[u+3]=t[u+3-c];u=ht}}e.l=h,e.p=tt,e.b=u,h&&(a=1,e.m=g,e.d=f,e.n=w)}while(!a);return u==t.length?t:te(t,0,u)};var zr=new V(0);var qr=function(n,t){var e={};for(var i in n)e[i]=n[i];for(var i in t)e[i]=t[i];return e},Jn=function(n,t,e){for(var i=n(),r=n.toString(),s=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=s[o];if(typeof a=="function"){t+=";"+l+"=";var u=a.toString();if(a.prototype)if(u.indexOf("[native code]")!=-1){var h=u.indexOf(" ",8)+1;t+=u.slice(h,u.indexOf("(",h))}else{t+=u;for(var f in a.prototype)t+=";"+l+".prototype."+f+"="+a.prototype[f].toString()}else t+=u}else e[l]=a}return[t,e]},ee=[],Xr=function(n){var t=[];for(var e in n)(n[e]instanceof V||n[e]instanceof ft||n[e]instanceof Bt)&&t.push((n[e]=new n[e].constructor(n[e])).buffer);return t},Vr=function(n,t,e,i){var r;if(!ee[e]){for(var s="",o={},a=n.length-1,l=0;l<a;++l)r=Jn(n[l],s,o),s=r[0],o=r[1];ee[e]=Jn(n[a],s,o)}var u=qr({},ee[e][1]);return Wr(ee[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",e,u,Xr(u),i)},Zr=function(){return[V,ft,Bt,Te,Se,Mn,Re,In,Hn,Bn,Vt,Rt,Zt,rt,Qt,Fn,te,Un,Oe,Kn,$n]};var Kn=function(n){return postMessage(n,[n.buffer])},$n=function(n){return n&&n.size&&new V(n.size)},Qr=function(n,t,e,i,r,s){var o=Vr(e,i,r,function(a,l){o.terminate(),s(a,l)});return o.postMessage([n,t],t.consume?[n.buffer]:[]),function(){o.terminate()}};var pt=function(n,t){return n[t]|n[t+1]<<8},ot=function(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0},Le=function(n,t){return ot(n,t)+ot(n,t+4)*4294967296};function ts(n,t,e){if(e||(e=t,t={}),typeof e!="function")throw"no callback";return Qr(n,t,[Zr],function(i){return Kn(Oe(i.data[0],$n(i.data[1])))},1,e)}function Oe(n,t){return Un(n,t)}var tl=typeof TextEncoder!="undefined"&&new TextEncoder,Me=typeof TextDecoder!="undefined"&&new TextDecoder,es=0;try{Me.decode(zr,{stream:!0}),es=1}catch(n){}var ns=function(n){for(var t="",e=0;;){var i=n[e++],r=(i>127)+(i>223)+(i>239);if(e+r>n.length)return[t,te(n,e-1)];r?r==3?(i=((i&15)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,t+=String.fromCharCode(55296|i>>10,56320|i&1023)):r&1?t+=String.fromCharCode((i&31)<<6|n[e++]&63):t+=String.fromCharCode((i&15)<<12|(n[e++]&63)<<6|n[e++]&63):t+=String.fromCharCode(i)}};function is(n,t){if(t){for(var e="",i=0;i<n.length;i+=16384)e+=String.fromCharCode.apply(null,n.subarray(i,i+16384));return e}else{if(Me)return Me.decode(n);var r=ns(n),s=r[0],o=r[1];if(o.length)throw"invalid utf-8 data";return s}}var rs=function(n,t){return t+30+pt(n,t+26)+pt(n,t+28)},os=function(n,t,e){var i=pt(n,t+28),r=is(n.subarray(t+46,t+46+i),!(pt(n,t+8)&2048)),s=t+46+i,o=ot(n,t+20),a=e&&o==4294967295?ss(n,s):[o,ot(n,t+24),ot(n,t+42)],l=a[0],u=a[1],h=a[2];return[pt(n,t+10),l,u,r,s+pt(n,t+30)+pt(n,t+32),h]},ss=function(n,t){for(;pt(n,t)!=1;t+=4+pt(n,t+2));return[Le(n,t+12),Le(n,t+4),Le(n,t+20)]};function jn(n,t){if(typeof t!="function")throw"no callback";for(var e=[],i=function(){for(var g=0;g<e.length;++g)e[g]()},r={},s=n.length-22;ot(n,s)!=101010256;--s)if(!s||n.length-s>65558){t("invalid zip file",null);return}var o=pt(n,s+8);o||t(null,{});var a=o,l=ot(n,s+16),u=l==4294967295;if(u){if(s=ot(n,s-12),ot(n,s)!=101075792){t("invalid zip file",null);return}a=o=ot(n,s+32),l=ot(n,s+48)}for(var h=function(g){var w=os(n,l,u),b=w[0],A=w[1],x=w[2],D=w[3],N=w[4],C=w[5],P=rs(n,C);l=N;var M=function(I,y){I?(i(),t(I,null)):(r[D]=y,--o||t(null,r))};if(!b)M(null,te(n,P,P+A));else if(b==8){var U=n.subarray(P,P+A);if(A<32e4)try{M(null,Oe(U,new V(x)))}catch(I){M(I,null)}else e.push(ts(U,{size:x},M))}else M("unknown compression type "+b,null)},f=0;f<a;++f)h(f);return i}var bi=kr(_i()),Ai=class{constructor(){this._buffers={}}clear(){this._buffers={}}put(t,e){this._buffers[t]=e}get(t){return this._buffers[t]}keys(){return Object.keys(this._buffers)}},$s="",js="",Gs=5e3;function Ci(n){return this.test(n)}function Ws(n,t){console.error(n,t)}var ue=class extends HTMLElement{static createFileMatcher(t){if(typeof t=="string"){let e=(0,bi.makeRe)(t),i=Ci.bind(e);return i.key=t,i}else if(t instanceof RegExp){let e=t,i=Ci.bind(e);return i.key=t.source,i}else throw new Error("Filter must be either a RegExp or glob string.")}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=$s,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=js,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("asset-pack",ue)}static get observedAttributes(){return["src"]}set src(t){this.setAttribute("src",t)}get src(){return this._src}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._src="",this._files=new Ai,this._cache={},this._loading={},this.onLoad=this.onLoad.bind(this),this.loaded=!1}get files(){return this._files}cacheAsset(t,e,i={}){let{ephemeral:r}=i,s=this._cache[t],o=this._loading[t];this._cache[t]=e,this.dispatchEvent(new CustomEvent("cache",{composed:!0,bubbles:!1,detail:{uri:t,current:e}})),o&&(o.resolve(e),delete this._loading[e]),r&&this._cache[e]===e&&(s?this._cache[e]=s:delete this._cache[e])}async loadAsset(t,e=Gs){let i=this._cache[t];if(i)return i;if(t in this._loading)return this._loading[t].promise;{let r=new xi(e);return this._loading[t]=r,r.promise}}clearAssets(){for(let t of Object.values(this._loading))t.reject(new Error("Stop loading to clear all assets."));this._loading={},this._cache={}}deleteAsset(t){t in this._loading&&(this._loading[t].reject(new Error("Stop loading to delete asset.")),delete this._loading[t]),t in this._cache&&delete this._cache[t]}getAsset(t){return this._cache[t]}getAssetURIs(){return Object.keys(this._cache)}hasAsset(t){let e=this._cache[t];return e?Boolean(e):!1}isAssetCached(t){return t in this._cache}isAssetLoading(t){return t in this._loading}connectedCallback(){Ys(this,"src")}attributeChangedCallback(t,e,i){switch(t){case"src":this._src=i,i&&(this.loaded=!1,fetch(i).then(this.onLoad).catch(r=>Ws("Failed to load asset pack:",r)));break}}async onLoad(t){let e=await t.arrayBuffer();await new Promise((i,r)=>{jn(new Uint8Array(e),(s,o)=>{if(s)r(s);else{let a=this._files;Promise.all(Object.entries(o).map(([l,u])=>(a.put(l,u),this.cacheAsset(l,u)))).then(()=>i()).catch(r)}})}),this.dispatchEvent(new CustomEvent("load",{composed:!0})),this.loaded=!0}};ue.define();function Ys(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var xi=class{constructor(t){this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((e,i)=>{this._value?e(this._value):this._resolve=e,this._reason?i(this._reason):this._reject=i})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}};window.addEventListener("error",he,!0);window.addEventListener("unhandledrejection",he,!0);function he(n){typeof n=="object"?n instanceof PromiseRejectionEvent?he(n.reason):n instanceof ErrorEvent?he(n.error):n instanceof Error?window.alert(n.stack):window.alert(JSON.stringify(n)):window.alert(n)}var Lt=8,gt={EAST:1<<0,NORTHEAST:1<<1,NORTH:1<<2,NORTHWEST:1<<3,WEST:1<<4,SOUTHWEST:1<<5,SOUTH:1<<6,SOUTHEAST:1<<7},gl=Object.values(gt),Ge=0;function Ti(n){return Number.isInteger(n)&&n>0&&n<=gt.SOUTHEAST}function Si(){return 1<<Math.floor(Math.random()*Lt)}function Ri(n,t=1){t=t%Lt,t<0&&(t=Lt+t);let e=Lt-t;return 240&n<<e|n>>t}function Kt(n){switch(n){case gt.EAST:return[1,0];case gt.NORTHEAST:return[1,-1];case gt.NORTH:return[0,-1];case gt.NORTHWEST:return[-1,-1];case gt.WEST:return[-1,0];case gt.SOUTHWEST:return[-1,1];case gt.SOUTH:return[0,1];case gt.SOUTHEAST:return[1,1];case Ge:throw new Error("Cannot get delta vector from null encoding.");default:throw new Error("Cannot get delta vector from multi-directional encoding.")}}var We=6,Ye=class{constructor(t,e){this.width=t,this.height=e,this.length=t*e,this.juncs={},this.lanes={}}hasJunction(t){return t<0?!1:Boolean(this.juncs[t])}getJunction(t){let e=this.juncs[t];if(!e)throw new Error(`Cannot get non-existant junction at index ${t}.`);return e}setJunction(t,e){if(this.juncs[t])throw new Error(`Cannot replace existing junction at index ${t}`);this.juncs[t]=e}deleteJunction(t){if(!this.juncs[t])throw new Error(`Cannot delete non-existant junction at index ${t}.`);this.juncs[t]=void 0}getJunctions(){return Object.values(this.juncs).filter(t=>Boolean(t))}},Oi=class{constructor(t,e,i){this.coordX=t,this.coordY=e,this.outlets=[],this.inlets=[],this.lanes={},this.passing=null,this.parkingCapacity=i,this.parking=0}getInlets(){return Array.from(this.inlets)}getOutlets(){return Array.from(this.outlets)}hasInlet(t){return this.inlets.includes(t)}hasOutlet(t){return this.outlets.includes(t)}addInlet(t,e){if(e.inlet!==t)throw new Error("Lane inlet does not match junction inlet.");this.inlets.push(t)}addOutlet(t,e){if(e.outlet!==t)throw new Error("Lane outlet does not match junction outlet.");if(this.outlets.push(t),this.lanes[t])throw new Error(`Cannot replace existing lane at outlet ${t}`);this.lanes[t]=e}removeInlet(t){let e=this.inlets.indexOf(t);if(e>=0)this.inlets.splice(e,1);else throw new Error(`Cannot remove non-existant inlet ${t} for junction.`)}removeOutlet(t){let e=this.outlets.indexOf(t);if(e>=0){if(this.outlets.splice(e,1),!this.lanes[t])throw new Error(`Cannot delete non-existant lane for outlet ${t}.`);this.lanes[t]=void 0}else throw new Error(`Cannot remove non-existant outlet ${t} for junction.`)}getLane(t){let e=this.lanes[t];if(!e)throw new Error(`Cannot get non-existant lane for outlet ${t}.`);return e}getLanes(){return Object.values(this.lanes).filter(t=>Boolean(t))}isEmpty(){return this.inlets.length<=0&&this.outlets.length<=0}},Li=class{constructor(t,e,i){if(t===e)throw new Error("Cannot create lane with the same inlet and outlet.");this.inlet=t,this.outlet=e,this.slots=new Array(i),this.length=i,this.blocking=i}};function ze(n,t){let e=n.getJunction(t).getOutlets();return e[Math.floor(Math.random()*e.length)]}function qe(n,t){return n.getJunction(t)}function Mi(n,t,e){if(typeof n!="object")throw new Error("Missing map.");return qe(n,t).lanes[e]}function _t(n,t,e,i=0){let r=new Oi(t,e,i),s=W(n,t,e);return n.setJunction(s,r),r}function F(n,t){if(typeof n!="object")throw new Error("Missing map.");return[t%n.width,Math.floor(t/n.width)]}function W(n,t,e){if(typeof n!="object")throw new Error("Missing map.");return t+e*n.width}function zs(n,t,e,i){let r=n.getJunction(t),s=n.getJunction(e),o=new Li(t,e,i);return r.addOutlet(e,o),s.addInlet(t,o),o}function qs(n,t,e){let i=n.getJunction(t),r=n.getJunction(e);i.removeOutlet(e),r.removeInlet(t)}function Xs(n,t,e){return n.getJunction(t).getLane(e)}function at(n,t,e,i=We){zs(n,t,e,i)}function Mt(n,t,e){let i=Xs(n,t,e);if(i.blocking<i.length)throw new Error("Cannot disconnect junctions with a non-vacated lane.");qs(n,t,e)}function kt(n,t,e){return n.getJunction(t).hasOutlet(e)}function Z(n,t,e){return t>=0&&e>=0&&t<n.width&&e<n.height}function ce(n,t){let e=n.getJunction(t);if(!xt(n,t)){let i=e.getOutlets();for(let s of i)Mt(n,t,s),xt(n,s)&&n.deleteJunction(s);let r=e.getInlets();for(let s of r)Mt(n,s,t),xt(n,s)&&n.deleteJunction(s)}n.deleteJunction(t)}function Xe(n,t,e){let i=n.getJunction(t);for(let r of i.getOutlets())e.includes(r)&&(Mt(n,t,r),xt(n,r)&&ce(n,r));for(let r of i.getInlets())e.includes(r)&&(Mt(n,r,t),xt(n,r)&&ce(n,r))}function ki(n,t,e){let i=n.getJunction(t);for(let r of i.getOutlets())e.includes(r)||(Mt(n,t,r),xt(n,r)&&ce(n,r));for(let r of i.getInlets())e.includes(r)||(Mt(n,r,t),xt(n,r)&&ce(n,r))}function xt(n,t){return n.getJunction(t).isEmpty()}function lt(n,t){return t===-1||!n.hasJunction(t)}var Vs=.5;function Di(n,t,e){let i=e/2,r=(e-i)/2,s=i/3;n.lineWidth=s,n.strokeStyle="teal";for(let o of t.getJunctions()){let{coordX:a,coordY:l}=o,u=a*e,h=l*e;n.strokeRect(u+r,h+r,i,i)}}function Ni(n,t,e){let r=e/2/3;n.lineWidth=r/4;for(let s=0;s<t.height;++s)for(let o=0;o<t.width;++o){let a=o+s*t.width;if(!t.hasJunction(a))continue;let l=t.getJunction(a),u=(o+.5)*e,h=(s+.5)*e;for(let f of l.getLanes()){let[g,w]=F(t,f.outlet),b=(g+.5)*e,A=(w+.5)*e,x=b-u,D=A-h,N=Math.atan2(D,x),C=f.length,P=e/3/C;l.passing?n.strokeStyle="red":n.strokeStyle="lime",n.beginPath(),n.arc(u,h,r/2,0,Math.PI*2),n.stroke();for(let M=0;M<C;++M){let U=(M+Vs)/C,I=u+x*U,y=h+D*U;f.slots[M]?n.strokeStyle="red":n.strokeStyle="white",n.beginPath(),n.arc(I,y,P,N,N+Math.PI),n.stroke()}}}}function Ii(n,t,e){let r=e/2;n.lineWidth=r,n.lineCap="round",n.strokeStyle="#333333";for(let s=0;s<t.height;++s)for(let o=0;o<t.width;++o){let a=o+s*t.width;if(!t.hasJunction(a))continue;let l=t.getJunction(a),u=(o+.5)*e,h=(s+.5)*e;for(let f of l.outlets){let[g,w]=F(t,f),b=(g+.5)*e,A=(w+.5)*e;n.beginPath(),n.moveTo(u,h),n.lineTo(b,A),n.stroke()}}}function Pi(n,t,e,i,r="#222222"){for(let s=0;s<e;++s)for(let o=0;o<t;++o){let a=o*i,l=s*i;n.strokeStyle=r,n.strokeRect(a,l,i,i)}}var Ve=class{constructor(t){this.junctionMap=t,this.directs=new Array(t.length).fill(-1)}markDirectableJunction(t,e){let i=this.junctionMap;if(!i.hasJunction(t))throw new Error("Cannot mark directable for non-existant junction.");if(!i.hasJunction(e))throw new Error("Cannot mark directable child as non-existant junction.");if(this.directs[e]!==-1)throw new Error("Cannot mark directable child as another directable junction.");if(this.directs[t]!==-1)throw new Error("Cannot mark directable for junction already directable.");this.directs[t]=e}unmarkDirectableJunction(t){if(this.directs[t]===-1)throw new Error("Cannot unmark directable for junction already non-directable.");this.directs[t]=-1}isDirectableJunction(t){return this.directs[t]!==-1}getDirectableJunctionChild(t){return this.directs[t]}redirectDirectableJunction(t,e,i){let r=this.junctionMap;if(e===i)throw new Error("Cannot redirect directable junction to the same child.");if(!this.isDirectableJunction(t))throw new Error("Cannot redirect non-directable junction.");if(this.isDirectableJunction(i))throw new Error("Cannot redirect directable junction to another directable junction.");if(this.getDirectableJunctionChild(t)!==e)throw new Error("Found mismatched child index for directable junction.");if(!r.hasJunction(i))throw new Error("Cannot redirect junction to non-existant child.");this.directs[t]=i,kt(r,t,i)||at(r,t,i),kt(r,i,t)||at(r,i,t)}};function Hi(n,t,e,i){let[r,s]=F(n,t),o=e;for(let a=0;a<Lt;++a){let[l,u]=Kt(o),h=r+l,f=s+u;if(!Z(n,h,f))continue;let g=W(n,h,f);if(i(g))return o;o=Ri(o)}return Ge}var Ze=class{constructor(t){this.junctionMap=t,this.persists={}}clear(){this.persists={}}markPersistentJunction(t,e=t){this.markPersistentJunctionImpl(t,e),t!==e&&this.markPersistentJunctionImpl(e,t)}markPersistentJunctionImpl(t,e){let i=this.persists[t];if(i||(i=this.persists[t]=[]),i.indexOf(e)<0)i.push(e);else throw new Error("Cannot mark persistence for junction already persistent.")}unmarkPersistentJunction(t,e=t){this.unmarkPersistentJunctionImpl(t,e),t!==e&&this.unmarkPersistentJunctionImpl(e,t)}unmarkPersistentJunctionImpl(t,e){let i=this.persists[t],r=i.indexOf(e);if(r>=0)i.splice(r,1);else throw new Error("Cannot unmark persistence for junction already non-persistent.")}isPersistentJunction(t){let e=this.persists[t];return e?e.length>0:!1}retainOnlyPersistentJunctionConnections(t){let e=this.junctionMap,i=this.persists[t];if(!i||i.length<=0)throw new Error("Cannot retain non-persistent junction.");ki(e,t,i)}};var Zs=5,Qs=4,to=3,eo=2,no=1,io=0,Cl={[Zs]:$t("#7F8C8D"),[Qs]:$t("#2ECC71"),[to]:$t("#4794C8"),[eo]:$t("#F39C12"),[no]:$t("#C0392B"),[io]:[""]};function $t(n){return[`background: ${n}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}var xl=Symbol("level"),Tl=Symbol("domain");function Bi(n,t,e,i,r){let s=Math.floor(n),o=Math.floor(t),a=Math.floor(e),l=Math.floor(i),u=Math.abs(e-n),h=n<e?1:-1,f=-Math.abs(i-t),g=t<i?1:-1,w=u+f,b=s,A=o,x=r(b,A);if(typeof x!="undefined")return x;let D=u*u+f*f,N=0;for(;N<D&&(b!==a||A!==l);){++N;let C=w*2;if(C>=f&&(w+=f,b+=h),C<=u&&(w+=u,A+=g),x=r(b,A),typeof x!="undefined")return x}}var Dt=0,ro=class{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(let e of t)this._heap.push(e),this._shiftUp()}pop(){let t=this.peek(),e=so(this);return e>Dt&&this._swap(Dt,e),this._heap.pop(),this._shiftDown(),t}replace(t){let e=this.peek();return this._heap[Dt]=t,this._shiftDown(),e}peek(){return this._heap[Dt]}_compare(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){let i=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=i}_shiftUp(){let t=this._heap.length-1,e;for(;t>Dt&&this._compare(t,e=oo(t));)this._swap(t,e),t=e}_shiftDown(){let t=this._heap.length,e=Dt,i,r=Fi(e),s=r<t,o=Ui(e),a=o<t;for(;s&&this._compare(r,e)||a&&this._compare(o,e);)i=a&&this._compare(o,r)?o:r,this._swap(e,i),e=i,r=Fi(e),s=r<t,o=Ui(e),a=o<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}};function so(n){return n._heap.length-1}function oo(n){return(n+1>>>1)-1}function Fi(n){return(n<<1)+1}function Ui(n){return n+1<<1}function jt(n=void 0){return n?(n^Math.random()*16>>n/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,jt)}function Qe(n,t,e){return n+(t-n)*e}function ao(n,t,e){return Math.min(e,Math.max(t,n))}function tn(n,t,e){let i=e-t,r=(n-t)%i;return r<0&&(r+=i),r+t}function Ji(n,t,e){let i=tn(t-n,-Math.PI,Math.PI);return ao(n+i,n-e,n+e)}var Sl=Math.PI/180,Rl=180/Math.PI;var nt={NONE:0,ACTIVATING:1,DEACTIVATING:2};function Ki(n,t,e,i,r,s,o,a){let l=n/o,u=t/o,h=Math.floor(l),f=Math.floor(u);switch(e){case nt.ACTIVATING:lo(i,h,f,l,u,r,a);break;case nt.DEACTIVATING:uo(i,h,f,s);break;case nt.NONE:i.status=nt.NONE;break}}function lo(n,t,e,i,r,s,o){let{status:a,dragCellX:l,dragCellY:u}=n;a!==nt.ACTIVATING&&(n.status=nt.ACTIVATING,n.dragCellX=l=t,n.dragCellY=u=e);let h=l+.5,f=u+.5,g=i,w=r,b=g-h,A=w-f;Math.sqrt(b*b+A*A)>=o&&(h=l,f=u,g=t,w=e,Bi(h,f,g,w,(D,N)=>{s.call(void 0,h,f,D,N),g=h=D,w=f=N}),n.dragCellX=g,n.dragCellY=w)}function uo(n,t,e,i){let{status:r,dragCellX:s,dragCellY:o}=n;r!==nt.DEACTIVATING&&(n.status=nt.DEACTIVATING,n.dragCellX=s=-1,n.dragCellY=o=-1),(t!==s||e!==o)&&(i.call(void 0,t,e),n.dragCellX=t,n.dragCellY=e)}var Y=-1,en=-1,nn=0,Nt=1,Gt=2,ho=4,rn=class{constructor(t,e){this.junctionMap=t,this.planner=e,this.agents={},this.paths={},this.ticks=0}spawnAgent(t){let e=this.junctionMap;if(!e.hasJunction(t))throw new Error("Cannot spawn agent on non-existant junction as home.");let i=jt(),r=new $i(i,t);return this.agents[i]=r,sn(e,r,t),ji(e,r,t),r}getAgent(t){return this.agents[t]}getAgents(){return Object.values(this.agents)}tick(){let t=this.junctionMap,e=this.ticks++,i=Object.values(this.agents);for(let r of i)if(r.lastUpdatedTick<e){r.lastUpdatedTick=e;let s=r.passing;lt(t,s)||fo(t,r,s),r.speed=r.maxSpeed}this.moveAgents(i)}moveAgents(t){let e=this.junctionMap,i=[];for(let r of t){let s=r.target;if(!lt(e,s)){if(r.junction===s){r.clearTarget(),i.push(r);continue}let o=r.speed;if(o>0){let a=co(e,r,s,r.intent,o);if(r.speed=a,o<a)throw new Error("Agent gained speed after moving? How is that possible?")}r.junction===s&&(r.clearTarget(),i.push(r))}}this.planner(i),i.length>0&&this.moveAgents(i)}},$i=class{constructor(t,e){this.id=t,this.home=e,this.junction=Y,this.outlet=Y,this.slot=en,this.speed=0,this.maxSpeed=ho,this.parking=Y,this.passing=Y,this.target=Y,this.nextTarget=Y,this.intent=nn,this.lastUpdatedTick=-1}setTarget(t,e,i){this.target=t,this.nextTarget=e,this.intent=i}clearTarget(){this.target=Y,this.nextTarget=Y,this.intent=nn}};function co(n,t,e,i,r){let s=t.junction,o=n.getJunction(s);if(!o.hasOutlet(e))throw new Error(`Missing outlet '${F(n,e)}' at junction '${F(n,s)}' to move cart towards.`);let a=o.getLane(e);if(lt(n,t.outlet)){let l=on(n,a,0);if(l>0){let u=Math.min(l,r-1);return Yi(n,t,s,e,u),r-u}else return 0}else{if(t.outlet!==e)throw new Error("Agent is changing lanes!");{let l=t.slot,u=l+r,h=on(n,a,l+1);if(h>=a.length&&u>=a.length&&i!==nn)switch(i){case Nt:if(lt(n,t.nextTarget))throw new Error("Agent must have next target if passing junction.");if(Gi(n,e)&&go(n,e,t.nextTarget)){vo(n,t,e),sn(n,t,e),Yi(n,t,e,t.nextTarget,0);let f=po(n,e);return Math.max(0,u-a.length-f)}else return u=Math.min(a.length-1,h,u),an(n,t,s,e,u),0;case Gt:return Wi(n,e)?(sn(n,t,e),ji(n,t,e),0):(u=a.length-1,an(n,t,s,e,u),0)}else return u=Math.min(a.length-1,h,u),an(n,t,s,e,u),0}}}function po(n,t){let e=qe(n,t);return Math.max(0,e.getInlets().length-2)}function go(n,t,e){if(t<0||e<0)throw new Error("Junction index must be non-negative.");let i=Mi(n,t,e);if(!i)throw new Error(`Cannot find lane for given inlet '${F(n,t)}' and outlet '${F(n,e)}'.`);return on(n,i,0)>=0}function on(n,t,e){if(e<0)throw new Error("Slot must be non-negative.");for(let i=e;i<t.length;++i)if(t.slots[i])return i-1;return t.length}function Gi(n,t){return n.hasJunction(t)?n.getJunction(t).passing===null:!1}function vo(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot pass on non-existant junction.");if(!Gi(n,e))throw new Error("Cannot pass on blocked junction.");let i=n.getJunction(e);t.passing=e,i.passing=t.id}function fo(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot release pass on non-existant junction.");if(t.passing!==e)throw new Error("Cannot release pass for agent not passing at junction.");let i=n.getJunction(e);t.passing=Y,i.passing=null}function Wi(n,t){if(!n.hasJunction(t))return!1;let e=n.getJunction(t);return e.parking<e.parkingCapacity}function ji(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot park on non-existant junction.");if(!Wi(n,e))throw new Error("Junction is already full for parking.");let i=n.getJunction(e);t.parking=e,i.parking+=1}function mo(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot release park on non-existant junction.");if(t.parking!==e)throw new Error("Cannot release parking for agent not parked at junction.");let i=n.getJunction(e);if(i.parking<=0)throw new Error("Cannot release parking at junction with no agents.");t.parking=Y,i.parking-=1}function Yi(n,t,e,i,r){if(!n.hasJunction(e))throw new Error("Cannot park on non-existant junction.");if(t.junction!==e)throw new Error("Cannot enter lane with agent not on same junction.");if(!lt(n,t.outlet))throw new Error("Cannot enter lane when agent already on another.");let o=n.getJunction(e).lanes[i];t.outlet=i,t.slot=r,o.slots[r]=t.id}function an(n,t,e,i,r){if(!n.hasJunction(e))throw new Error("Cannot park on non-existant junction.");if(t.junction!==e)throw new Error("Cannot move on lane with agent not on same junction.");if(t.outlet!==i)throw new Error("Cannot move on lane with agent not on same outlet.");let o=n.getJunction(e).lanes[i],a=t.slot;t.slot=r,o.slots[a]=void 0,o.slots[r]=t.id}function Eo(n,t,e,i){let s=n.getJunction(e).lanes[i];s.slots[t.slot]=void 0,t.outlet=Y,t.slot=en}function sn(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot force on non-existant junction.");let i=t.junction;if(!lt(n,i)){let r=t.outlet;lt(n,r)||Eo(n,t,i,r);let s=t.parking;lt(n,s)||mo(n,t,s)}t.junction=e,t.outlet=Y,t.slot=en}function zi(n,t,e,i){let r=i/8;for(let s of e.getAgents()){let[o,a]=F(t,s.junction);if(n.fillStyle="red",n.fillRect((o+.5)*i-r,(a+.5)*i-r,r*2,r*2),s.target!==-1){let[l,u]=F(t,s.target);n.fillStyle="green",n.fillRect((l+.5)*i-r,(u+.5)*i-r,r*2,r*2)}if(s.outlet!==-1){let[l,u]=F(t,s.outlet);n.strokeStyle="gold",n.lineWidth=2,n.strokeRect((l+.5)*i-r,(u+.5)*i-r,r*2,r*2)}}}function Xi(n,t,e,i,r){let s=wo();qi(s,n);let o=new Set,a=new Set;for(o.add(n);o.size>0;){let l;for(let h of o)l?s.fscore[h]<s.fscore[l]&&(l=h):l=h;let u=l;if(u===t){let h=[];for(;s.parents[u];)h.push(u),u=s.parents[u];return h.push(u),h.reverse()}else{a.add(u),o.delete(u);for(let h of e(u)){if(a.has(h))continue;let f=r(u,h);if(!Number.isFinite(f))continue;let g=s.gscore[u]+f,w=!1;o.has(h)?g<s.gscore[h]&&(w=!0):(w=!0,qi(s,h),s.hscore[h]=i(h,t),o.add(h)),w&&(s.parents[h]=u,s.gscore[h]=g,s.fscore[h]=g+s.hscore[h])}}}return[]}function wo(){return{fscore:{},gscore:{},hscore:{},parents:{}}}function qi(n,t,e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,r=Number.NaN,s=null){return n.fscore[t]=e,n.gscore[t]=i,n.hscore[t]=r,n.parents[t]=s,t}var ln=-1,un=class{constructor(t){this.junctionMap=t,this.paths={},this.used=new Uint8Array(t.length),this.weighted=new Float32Array(t.length).fill(1),this.neighbors=this.neighbors.bind(this),this.heuristics=this.heuristics.bind(this),this.weights=this.weights.bind(this)}acquirePath(t,e){if(!this.junctionMap.hasJunction(t)||!this.junctionMap.hasJunction(e))throw new Error("Cannot acquire path between non-existant junctions.");let i=jt(),r;if(i in this.paths)r=this.paths[i];else{if(r=Xi(t,e,this.neighbors,this.heuristics,this.weights),r.length<=0)return null;this.paths[i]=r}for(let s of r){let o=this.used[s];this.used[s]=o+1}return i}releasePath(t){let e=this.paths[t];if(!e)throw new Error("Cannot release non-existant path.");delete this.paths[t];for(let i of e)this.used[i]-=1}prunePath(t,e){let i=this.paths[t];if(!i)throw new Error("Cannot prune non-existant path.");for(let r=0;r<e;++r){let s=i[r];s!==ln&&(this.used[s]-=1,i[r]=ln)}}isJunctionUsedForAnyPath(t){return this.used[t]>0}getPathById(t){return this.paths[t]}getNextInPath(t,e){let i=this.paths[t];return e<=0?i[0]:e>=i.length?ln:i[e]}setWeight(t,e){this.weighted[t]=e}resetWeight(t){this.weighted[t]=1}getWeight(t){return this.weighted[t]}neighbors(t){return this.junctionMap.getJunction(t).getOutlets()}heuristics(t,e){let[i,r]=F(this.junctionMap,t),[s,o]=F(this.junctionMap,e);return Math.abs(s-i)+Math.abs(o-r)}weights(t,e){return this.weighted[e]}};var It=class{constructor(t,e){this.color={main:t,shadow:e}}},hn={lime:new It("lime","green"),tomato:new It("tomato","maroon"),banana:new It("yellow","gold"),blueberry:new It("aqua","royalblue"),plum:new It("plum","blueviolet")},vt=Object.keys(hn);function Tt(n){return hn[n].color.main}function Wt(n){return hn[n].color.shadow}function Vi(n,t){return n===t}var Zi=-1,Qi=-1,fe=30,jl=fe/2;var cn=class{constructor(t,e){this.junctionMap=t,this.trafficSimulator=e,this.carts={}}createCart(t,e,i,r){let s=this.junctionMap,o=this.trafficSimulator,a=W(s,t,e),u=o.spawnAgent(a).id,h=new tr(u,t+.5,e+.5,i,r);return this.carts[u]=h,h}getCartById(t){return this.carts[t]}getCartByAgentId(t){return this.carts[t]}},tr=class{constructor(t,e,i,r,s){this.id=t,this.prevX=e,this.prevY=i,this.prevJunction=Zi,this.prevOutlet=Zi,this.prevSlot=Qi,this.x=e,this.y=i,this.radians=r,this.cargo=s}getAgentId(){return this.id}};function nr(n,t,e,i,r){let s=t.trafficSimulator,o=t.junctionMap,a=e/i,l=We;for(let u of Object.values(t.carts)){let h=s.getAgent(u.getAgentId()),f=h.junction,g=h.outlet,w=h.slot,b=u.x,A=u.y,x=u.radians;if(f!==-1&&g!==-1){e<=0?(u.prevX=u.x,u.prevY=u.y):e>=i&&(u.prevJunction=f,u.prevOutlet=g,u.prevSlot=w);let C,P,M=u.prevSlot!==Qi?l-u.prevSlot:0,I=u.currentSlot+M;a<M/I?[C,P]=er(o,u.prevJunction,u.prevOutlet,0,1):[C,P]=er(o,f,g,0,w/l);let y=u.prevX,R=u.prevY,J=Qe(y,C,a),d=Qe(R,P,a),k=C-y,O=P-R,z;if(Math.abs(k)<=Number.EPSILON&&Math.abs(O)<=Number.EPSILON)z=u.radians;else{let p=Math.atan2(O,k),c=u.radians,j=tn(p-c,-Math.PI,Math.PI);z=Ji(c,p,j/(Math.PI*2))}u.x=J,u.y=d,u.radians=z}let D=Tt(u.cargo),N=Wt(u.cargo);yo(n,b*r,A*r,x,D,N,r)}}function yo(n,t,e,i,r,s,o){let a=o*.2,l=o*.3,u=a/2,h=l/2,f=2,g=l*.4,w=l*.2;n.translate(t,e),n.rotate(i+Math.PI/2),n.fillStyle=s,n.fillRect(-u,-h,a,l),n.fillStyle=r,n.fillRect(-u+f,-h+g,a-f*2,g+w),n.fillStyle="gold",n.fillRect(-u+f,-h,f,f),n.fillRect(u-f*2,-h,f,f),n.rotate(-i-Math.PI/2),n.translate(-t,-e)}var ir=Math.PI*.5;function er(n,t,e,i,r){let[s,o]=F(n,t),[a,l]=F(n,e),u=a-s,h=l-o,f=Math.atan2(h,u),g=Math.cos(f+ir)*(.15+.2*i),w=Math.sin(f+ir)*(.15+.2*i);return[s+.5+g+u*r,o+.5+w+h*r]}function fn(n,t,e,i){return t.acquirePath(e,i)}function rr(n,t,e){if(!e)throw new Error("Non-existant cart.");let i=Object.values(n.factory).filter(a=>Vi(a.cargo,e.cargo));if(i.length<=0)return Y;let r=Math.floor(Math.random()*i.length),o=i[r].parking;return o.length<=0?Y:(r=Math.floor(Math.random()*o.length),o[r])}var pn=class{constructor(t,e,i){this.junctionMap=t,this.pathFinder=e,this.persistence=i,this.demolished=new Uint8Array(t.length),this.lanes={}}update(){let t=this.junctionMap.length;for(let e=0;e<t;++e)if(this.isJunctionMarkedForDemolition(e)){if(!this.junctionMap.hasJunction(e))throw new Error("Trying to demolish non-existant, but marked, junction.");this.pathFinder.isJunctionUsedForAnyPath(e)||(_o(this.junctionMap,this.persistence,e,this.lanes[e]),this.unmarkForDemolition(e))}}clear(){let t=this.junctionMap.length;for(let e=0;e<t;++e)this.isJunctionMarkedForDemolition(e)&&this.unmarkForDemolition(e)}markForDemolition(t){let e=this.junctionMap.getJunction(t);this.lanes[t]=e.getOutlets(),this.demolished[t]=1,this.pathFinder.setWeight(t,Number.POSITIVE_INFINITY)}unmarkForDemolition(t){this.demolished[t]=0,delete this.lanes[t],this.pathFinder.resetWeight(t)}unmarkLaneForDemolition(t,e){if(!this.isJunctionMarkedForDemolition(t))return;let i=this.lanes[t],r=i.indexOf(e);r<0||i.splice(r,1)}isJunctionMarkedForDemolition(t){return this.demolished[t]>0}isLaneMarkedForDemolition(t,e){return this.isJunctionMarkedForDemolition(t)&&this.lanes[t].includes(e)}};function _o(n,t,e,i){if(t.isPersistentJunction(e)){let r=i.filter(s=>!t.isPersistentJunction(s));Xe(n,e,r)}else Xe(n,e,i)}function sr(n,t,e,i){let s=i/2;n.lineWidth=s,n.lineCap="round",n.strokeStyle="#660000";for(let o=0;o<t.height;++o)for(let a=0;a<t.width;++a){let l=a+o*t.width;if(!t.hasJunction(l)||!e.isJunctionMarkedForDemolition(l))continue;let u=t.getJunction(l),h=(a+.5)*i,f=(o+.5)*i;for(let g of u.outlets){if(!e.isLaneMarkedForDemolition(l,g))continue;let[w,b]=F(t,g),A=(w+.5)*i,x=(b+.5)*i;n.beginPath(),n.moveTo(h,f),n.lineTo(A,x),n.stroke()}}}function or(n,t,e,i){let r=n.junctionMap;if(!Z(r,t,e))return!1;let s=W(r,t,e);if(r.hasJunction(s)||!Ti(i))return!1;let[o,a]=Kt(i),l=t+o,u=e+a,h=W(r,l,u);return!(!Z(r,l,u)||n.solids.isSolidJunction(h))}function ar(n,t,e,i,r){let s=n.junctionMap,[o,a]=Kt(i),l=t+o,u=e+a;if(!Z(s,l,u))throw new Error("Cannot place outlet outside of boundary.");let h=W(s,t,e),f=W(s,l,u);_t(s,t,e,2),n.solids.markSolidJunction(h),s.hasJunction(f)||_t(s,l,u,0),n.directable.markDirectableJunction(h,f),n.persistence.markPersistentJunction(h,f),at(s,h,f),at(s,f,h);let g=t+e*s.width,w=n.cartManager.createCart(t,e,Math.atan2(a,o),r),b=n.cartManager.createCart(t,e,Math.atan2(a,o),r);n.housing[g]={coordX:t,coordY:e,junction:h,cargo:r,carts:[w.id,b.id]}}function lr(n,t,e){return t+e*n.junctionMap.width in n.housing}function ur(n,t,e,i){let r=n.junctionMap;if(!Z(r,t,e)||!Z(r,t+3,e+3))throw new Error("Cannot place factory out of bounds.");let s=2,o=3;for(let h=0;h<s;++h)for(let f=0;f<o;++f){let g=t+h+1+(e+f)*r.width;n.solids.markSolidJunction(g)}let a=W(r,t,e+2);r.hasJunction(r,a)?r.getJunction(a):_t(r,t,e+2,0);let l=W(r,t+1,e+2);_t(r,t+1,e+2,4),n.persistence.markPersistentJunction(a,l),at(r,a,l),at(r,l,a);let u=t+e*r.width;n.factory[u]={coordX:t,coordY:e,width:s,height:o,cargo:i,entries:[a],parking:[l]}}function hr(n,t,e){for(let i of Object.values(t.housing))bo(n,i.coordX,i.coordY,Tt(i.cargo),Wt(i.cargo),e)}function bo(n,t,e,i,r,s){let o=s*.8,a=s*.2/2,l=t*s+a,u=e*s+a;n.fillStyle=i,n.fillRect(l,u,o,o),n.fillStyle=r,n.fillRect(l,u+o/2,o,o/2)}function cr(n,t,e){for(let i of Object.values(t.factory)){let r=Tt(i.cargo),s=Wt(i.cargo);Ao(n,i.coordX,i.coordY,r,s,e)}}function Ao(n,t,e,i,r,s){let o=s*.1,a=t*s+o,l=e*s+o;n.fillStyle="#666666",n.fillRect(a+s,l,s*2-o*2,s*3-o*2);let u=s*.1;n.fillStyle=i;let h=a+s+u,f=l+u,g=s*2-o*2-u*2,w=s*2-o*2-u*2;n.fillRect(h,f,g,w),n.fillStyle=r,n.fillRect(h,f+w/2,g,w/2)}var dn=class{constructor(t){this.junctionMap=t,this.solids=new Uint8Array(t.length)}clear(){this.solids={}}markSolidJunction(t){this.solids[t]=1}unmarkSolidJunction(t){this.solids[t]=0}isSolidJunction(t){return this.solids[t]}};function fr(n,t,e,i,r="#663366"){for(let s=0;s<e.height;++s)for(let o=0;o<e.width;++o){let a=o+s*e.width;t.solids.isSolidJunction(a)&&(n.fillStyle=r,n.fillRect(o*i,s*i,i,i))}}var gn=class{constructor(){this.cargos={};for(let t of vt)this.cargos[t]=0}recordCargo(t,e){let i=this.cargos[t];this.cargos[t]=i+e}getCargoCount(t){return this.cargos[t]}};var st=32,Co=.9,pr=class{constructor(t,e){this.cursor={screenX:0,screenY:0,dragCellX:0,dragCellY:0,status:0},this.debugMode=!1,this.framesToTick=0,this.spawnTicks=0,this.spawnCargoLevel=0,this.spawnFactoryChance=0;let i=new Ye(t,e);this.junctionMap=i,this.trafficSimulator=new rn(i,r=>dr(this,r)),this.pathFinder=new un(i),this.cartManager=new cn(i,this.trafficSimulator),this.persistence=new Ze(i),this.directable=new Ve(i),this.demolition=new pn(i,this.pathFinder,this.persistence),this.solids=new dn(i),this.scoreKeeper=new gn,this.housing={},this.factory={}}};function mr(){let n=new pr(24,16),t=n.junctionMap,e,i,r,s=vt[n.spawnCargoLevel];do[e,i]=pe(t,0,0,1,1),r=!vr(n,e,i,s);while(r);do[e,i]=pe(t,0,0,1,1),r=!gr(n,e,i,s);while(r);return n.spawnTicks=1e3,n}function wr(n,t,e){let i=e.cursor,r=e.junctionMap,s=t.getAxisValue("cursorX")*n.width,o=t.getAxisValue("cursorY")*n.height;i.screenX=s,i.screenY=o;let a=t.isButtonDown("activate")?nt.ACTIVATING:t.isButtonDown("deactivate")?nt.DEACTIVATING:nt.NONE;Ki(s,o,a,i,(l,u,h,f)=>{if(!Z(r,l,u)||!Z(r,h,f))return;let[g,w]=vn(e,l,u),b=W(r,g,w),[A,x]=vn(e,h,f),D=W(r,A,x);b!==D&&Er(e,r,g,w)&&Er(e,r,A,x)&&To(e,r,b,D)},(l,u)=>{let[h,f]=vn(e,l,u);if(!Z(r,h,f))return;let g=W(r,h,f);r.hasJunction(g)&&e.demolition.markForDemolition(g)},st,Co),++e.framesToTick>=fe&&(e.framesToTick=0,dr(e,e.trafficSimulator.getAgents().filter(l=>l.target===-1)),e.trafficSimulator.tick()),e.demolition.update(),--e.spawnTicks<=0&&(e.spawnTicks=100+Math.floor(1e3*Math.random()),xo(e))}function xo(n){let t=vt[n.spawnCargoLevel],e;if(n.scoreKeeper.getCargoCount(t)>0&&Math.random()<.3){let r=Math.min(vt.length-1,n.spawnCargoLevel+1);n.spawnCargoLevel=r,e=vt[r],n.spawnFactoryChance=.5,n.spawnTicks=100}else e=vt[Math.min(n.spawnCargoLevel,Math.floor(Math.random()*vt.length))];let i;Math.random()<n.spawnFactoryChance?(i=Ro(n,e),i&&(n.spawnFactoryChance=0)):(i=So(n,e),i&&(n.spawnFactoryChance+=.05))}function So(n,t){let e=n.junctionMap,i,r,s,o=0;do[i,r]=pe(e,0,0,1,1),s=gr(n,i,r,t),++o;while(!s&&o<10);return s}function Ro(n,t){let e=n.junctionMap,i,r,s,o=0;do[i,r]=pe(e,0,0,1,1),s=vr(n,i,r,t),++o;while(!s&&o<10);return s}function dr(n,t){let e=n.junctionMap;for(let i of t)switch("path"){case"random":{let r=typeof i.savedTarget!="undefined"?i.savedTarget:ze(e,i.junction),s=ze(e,r);i.savedTarget=s;let o=Nt;i.setTarget(r,s,o)}break;case"path":if(i.pathId){let r=i.pathId,s=n.pathFinder.getPathById(r),o=s.indexOf(i.junction);if(o>=0)if(o<s.length-2)i.setTarget(s[o+1],s[o+2],Nt),n.pathFinder.prunePath(r,o);else if(o<s.length-1)i.setTarget(s[o+1],Y,Gt),n.pathFinder.prunePath(r,o);else{if(i.junction!==i.home){let a=n.cartManager.getCartByAgentId(i.id);n.scoreKeeper.recordCargo(a.cargo,1)}i.pathId=null,i.clearTarget(),n.pathFinder.releasePath(r)}else i.pathId=null,i.clearTarget(),n.pathFinder.releasePath(r)}else{let r;if(i.junction===i.home){let s=n.cartManager.getCartByAgentId(i.id);r=rr(n,e,s)}else{let s=i.homePathId,o=n.pathFinder.getPathById(s);i.homePathId=null,i.pathId=s,o===2?i.setTarget(o[1],Y,Gt):i.setTarget(o[1],o[2],Nt);break}if(!lt(e,r)){let s=fn(n,n.pathFinder,i.junction,r),o=n.pathFinder.getPathById(s);if(!o||o.length<2)break;let a=fn(n,n.pathFinder,r,i.home),l=n.pathFinder.getPathById(a);if(!l||l.length<2)break;i.pathId=s,i.homePathId=a,o===2?i.setTarget(o[1],Y,Gt):i.setTarget(o[1],o[2],Nt)}}break}}function gr(n,t,e,i){let r=n.junctionMap,s=n.directable,o=n.solids;if(!Z(r,t-1,e-1)||!Z(r,t+1,e+1))return!1;for(let u=-1;u<=1;++u)for(let h=-1;h<=1;++h){let f=t+u,g=e+h,w=W(r,f,g);if(o.isSolidJunction(w)&&!lr(n,f,g))return!1}let a=W(r,t,e),l=Hi(r,a,Si(),u=>!s.isDirectableJunction(u)&&!o.isSolidJunction(u));return or(n,t,e,l)?(ar(n,t,e,l,i),!0):!1}function vr(n,t,e,i){let r=n.junctionMap,s=n.solids;if(!Z(r,t-1,e-1)||!Z(r,t+4,e+5))return!1;for(let o=-1;o<=4;++o)for(let a=-1;a<=5;++a){let l=t+o+(e+a)*r.width;if(s.isSolidJunction(l))return!1}for(let o=1;o<3;++o)for(let a=0;a<3;++a){let l=t+o+(e+a)*r.width;if(r.hasJunction(l))return!1}return ur(n,t,e,i),!0}function vn(n,t,e){return[t,e]}function pe(n,t=0,e=0,i=0,r=0){let s=n.width-t-i*2,o=n.height-e-r*2,a=Math.floor(Math.random()*s)+t+i,l=Math.floor(Math.random()*o)+e+r;return[a,l]}function Er(n,t,e,i){let r=W(t,e,i);return n.directable.isDirectableJunction(r)?!0:n.solids.isSolidJunction(r)?!1:(t.hasJunction(r)||_t(t,e,i,0),!0)}function To(n,t,e,i){if(e===i)return!1;let r=n.directable.isDirectableJunction(e),s=n.directable.isDirectableJunction(i);return r?yr(n,t,e,i):s?yr(n,t,i,e):(kt(t,e,i)||at(t,e,i),kt(t,i,e)||at(t,i,e),n.demolition.unmarkLaneForDemolition(e,i),n.demolition.unmarkLaneForDemolition(i,e),!0)}function yr(n,t,e,i){let r=n.directable.getDirectableJunctionChild(e);if(i===r)return!0;if(n.directable.isDirectableJunction(i)||!n.directable.isDirectableJunction(e)||n.solids.isSolidJunction(i))return!1;if(!t.hasJunction(i)){let[s,o]=F(t,i);_t(t,s,o,0)}return n.demolition.markForDemolition(r),n.directable.redirectDirectableJunction(e,r,i),n.persistence.unmarkPersistentJunction(e,r),n.persistence.markPersistentJunction(e,i),!0}function _r(n,t){let e=t.junctionMap,i=t.cartManager;if(t.cursor.status!==nt.NONE){let s=e.width,o=e.height;n.lineWidth=1,Pi(n,s,o,st)}fr(n,t,e,st),Ii(n,e,st),sr(n,e,t.demolition,st),nr(n,i,t.framesToTick,fe,st),hr(n,t,st),cr(n,t,st),t.debugMode&&(Di(n,e,st),Ni(n,e,st),zi(n,e,t.trafficSimulator,st)),t.cursor.status!==nt.NONE&&(n.lineWidth=2,Oo(n,t.cursor.screenX,t.cursor.screenY,st,"#333333"));let r=new DOMMatrix;n.setTransform(r),Mo(n,t),n.setTransform(r.translate(0,20)),Lo(n,t.scoreKeeper),n.setTransform(r)}function Oo(n,t,e,i,r="#FFFFFF"){let s=Math.floor(t/i)*i,o=Math.floor(e/i)*i;n.strokeStyle=r,n.strokeRect(s,o,i,i)}function Lo(n,t){n.font="16px monospace",n.lineWidth=1,n.textBaseline="top";let e=0;for(let i of vt){let r=t.getCargoCount(i);if(r>0){let s=Tt(i);n.fillStyle=s,n.fillText(`\u2588 ${r}`,0,e*20),e+=1}}}function Mo(n,t){n.font="16px monospace",n.lineWidth=1,n.textBaseline="top",n.fillStyle="white",n.fillText(`% ${t.spawnTicks}`,0,0)}async function br(n,t,e){t.bindAxis("cursorX","Mouse","PosX"),t.bindAxis("cursorY","Mouse","PosY"),t.bindButton("activate","Mouse","Button0"),t.bindButton("deactivate","Mouse","Button2");let i=n.getContext("2d"),r=mr();n.addEventListener("frame",s=>{let{now:o}=s.detail;t.poll(o),wr(n,t,r),i.fillStyle="black",i.fillRect(0,0,i.canvas.width,i.canvas.height),_r(i,r)})}window.addEventListener("DOMContentLoaded",ko);async function ko(){let n=document.querySelector("#display"),t=document.querySelector("#inputs").getContext("axisbutton"),e=document.querySelector("#assets"),i=new Promise((r,s)=>{e.addEventListener("load",r),e.addEventListener("error",s)});e.src="res.pack",await i,await br(n,t,e)}})();
//# sourceMappingURL=main.js.map
