(()=>{var Bi=Object.create,Zt=Object.defineProperty;var Pi=Object.getOwnPropertyDescriptor;var Fi=Object.getOwnPropertyNames;var Hi=Object.getPrototypeOf,Ui=Object.prototype.hasOwnProperty;var Ji=n=>Zt(n,"__esModule",{value:!0});var $i=(n,t)=>()=>(n&&(t=n(n=0)),t),At=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Ki=(n,t)=>{for(var e in t)Zt(n,e,{get:t[e],enumerable:!0})},ji=(n,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Fi(t))!Ui.call(n,r)&&r!=="default"&&Zt(n,r,{get:()=>t[r],enumerable:!(e=Pi(t,r))||e.enumerable});return n},Gi=n=>ji(Ji(Zt(n!=null?Bi(Hi(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var jr={};Ki(jr,{basename:()=>$r,default:()=>Us,delimiter:()=>Ur,dirname:()=>Jr,extname:()=>Kr,isAbsolute:()=>sn,join:()=>Pr,normalize:()=>rn,relative:()=>Fr,resolve:()=>oe,sep:()=>Hr});function Br(n,t){for(var e=0,r=n.length-1;r>=0;r--){var i=n[r];i==="."?n.splice(r,1):i===".."?(n.splice(r,1),e++):e&&(n.splice(r,1),e--)}if(t)for(;e--;e)n.unshift("..");return n}function oe(){for(var n="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var r=e>=0?arguments[e]:"/";if(typeof r!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!r)continue;n=r+"/"+n,t=r.charAt(0)==="/"}return n=Br(on(n.split("/"),function(i){return!!i}),!t).join("/"),(t?"/":"")+n||"."}function rn(n){var t=sn(n),e=Js(n,-1)==="/";return n=Br(on(n.split("/"),function(r){return!!r}),!t).join("/"),!n&&!t&&(n="."),n&&e&&(n+="/"),(t?"/":"")+n}function sn(n){return n.charAt(0)==="/"}function Pr(){var n=Array.prototype.slice.call(arguments,0);return rn(on(n,function(t,e){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function Fr(n,t){n=oe(n).substr(1),t=oe(t).substr(1);function e(l){for(var c=0;c<l.length&&l[c]==="";c++);for(var h=l.length-1;h>=0&&l[h]==="";h--);return c>h?[]:l.slice(c,h-c+1)}for(var r=e(n.split("/")),i=e(t.split("/")),s=Math.min(r.length,i.length),o=s,a=0;a<s;a++)if(r[a]!==i[a]){o=a;break}for(var u=[],a=o;a<r.length;a++)u.push("..");return u=u.concat(i.slice(o)),u.join("/")}function Jr(n){var t=nn(n),e=t[0],r=t[1];return!e&&!r?".":(r&&(r=r.substr(0,r.length-1)),e+r)}function $r(n,t){var e=nn(n)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function Kr(n){return nn(n)[3]}function on(n,t){if(n.filter)return n.filter(t);for(var e=[],r=0;r<n.length;r++)t(n[r],r,n)&&e.push(n[r]);return e}var Hs,nn,Hr,Ur,Us,Js,Gr=$i(()=>{Hs=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,nn=function(n){return Hs.exec(n).slice(1)};Hr="/",Ur=":";Us={extname:Kr,basename:$r,dirname:Jr,sep:Hr,delimiter:Ur,relative:Fr,join:Pr,isAbsolute:sn,normalize:rn,resolve:oe};Js="ab".substr(-1)==="b"?function(n,t,e){return n.substr(t,e)}:function(n,t,e){return t<0&&(t=n.length+t),n.substr(t,e)}});var le=At((Cu,ae)=>{var St=(Gr(),jr);if(St&&St.default){ae.exports=St.default;for(let n in St)ae.exports[n]=St[n]}else St&&(ae.exports=St)});var Gt=At((xu,Xr)=>{"use strict";var $s=le(),gt="\\\\/",Wr=`[^${gt}]`,mt="\\.",Ks="\\+",js="\\?",ue="\\/",Gs="(?=.)",Yr="[^/]",an=`(?:${ue}|$)`,zr=`(?:^|${ue})`,ln=`${mt}{1,2}${an}`,Ws=`(?!${mt})`,Ys=`(?!${zr}${ln})`,zs=`(?!${mt}{0,1}${an})`,qs=`(?!${ln})`,Xs=`[^.${ue}]`,Vs=`${Yr}*?`,qr={DOT_LITERAL:mt,PLUS_LITERAL:Ks,QMARK_LITERAL:js,SLASH_LITERAL:ue,ONE_CHAR:Gs,QMARK:Yr,END_ANCHOR:an,DOTS_SLASH:ln,NO_DOT:Ws,NO_DOTS:Ys,NO_DOT_SLASH:zs,NO_DOTS_SLASH:qs,QMARK_NO_DOT:Xs,STAR:Vs,START_ANCHOR:zr},Zs={...qr,SLASH_LITERAL:`[${gt}]`,QMARK:Wr,STAR:`${Wr}*?`,DOTS_SLASH:`${mt}{1,2}(?:[${gt}]|$)`,NO_DOT:`(?!${mt})`,NO_DOTS:`(?!(?:^|[${gt}])${mt}{1,2}(?:[${gt}]|$))`,NO_DOT_SLASH:`(?!${mt}{0,1}(?:[${gt}]|$))`,NO_DOTS_SLASH:`(?!${mt}{1,2}(?:[${gt}]|$))`,QMARK_NO_DOT:`[^.${gt}]`,START_ANCHOR:`(?:^|[${gt}])`,END_ANCHOR:`(?:[${gt}]|$)`},Qs={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};Xr.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Qs,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:$s.sep,extglobChars(n){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${n.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(n){return n===!0?Zs:qr}}});var ce=At(nt=>{"use strict";var to=le(),eo=!1,{REGEX_BACKSLASH:no,REGEX_REMOVE_BACKSLASH:ro,REGEX_SPECIAL_CHARS:io,REGEX_SPECIAL_CHARS_GLOBAL:so}=Gt();nt.isObject=n=>n!==null&&typeof n=="object"&&!Array.isArray(n);nt.hasRegexChars=n=>io.test(n);nt.isRegexChar=n=>n.length===1&&nt.hasRegexChars(n);nt.escapeRegex=n=>n.replace(so,"\\$1");nt.toPosixSlashes=n=>n.replace(no,"/");nt.removeBackslashes=n=>n.replace(ro,t=>t==="\\"?"":t);nt.supportsLookbehinds=()=>{let n=process.version.slice(1).split(".").map(Number);return n.length===3&&n[0]>=9||n[0]===8&&n[1]>=10};nt.isWindows=n=>n&&typeof n.windows=="boolean"?n.windows:eo===!0||to.sep==="\\";nt.escapeLast=(n,t,e)=>{let r=n.lastIndexOf(t,e);return r===-1?n:n[r-1]==="\\"?nt.escapeLast(n,t,r-1):`${n.slice(0,r)}\\${n.slice(r)}`};nt.removePrefix=(n,t={})=>{let e=n;return e.startsWith("./")&&(e=e.slice(2),t.prefix="./"),e};nt.wrapOutput=(n,t={},e={})=>{let r=e.contains?"":"^",i=e.contains?"":"$",s=`${r}(?:${n})${i}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var ii=At((Su,ri)=>{"use strict";var Vr=ce(),{CHAR_ASTERISK:un,CHAR_AT:oo,CHAR_BACKWARD_SLASH:Wt,CHAR_COMMA:ao,CHAR_DOT:cn,CHAR_EXCLAMATION_MARK:hn,CHAR_FORWARD_SLASH:Zr,CHAR_LEFT_CURLY_BRACE:fn,CHAR_LEFT_PARENTHESES:pn,CHAR_LEFT_SQUARE_BRACKET:lo,CHAR_PLUS:uo,CHAR_QUESTION_MARK:Qr,CHAR_RIGHT_CURLY_BRACE:co,CHAR_RIGHT_PARENTHESES:ti,CHAR_RIGHT_SQUARE_BRACKET:ho}=Gt(),ei=n=>n===Zr||n===Wt,ni=n=>{n.isPrefix!==!0&&(n.depth=n.isGlobstar?Infinity:1)},fo=(n,t)=>{let e=t||{},r=n.length-1,i=e.parts===!0||e.scanToEnd===!0,s=[],o=[],a=[],u=n,l=-1,c=0,h=0,g=!1,E=!1,_=!1,A=!1,C=!1,O=!1,I=!1,x=!1,F=!1,D=!1,K=0,k,w,T={value:"",depth:0,isGlob:!1},H=()=>l>=r,d=()=>u.charCodeAt(l+1),M=()=>(k=w,u.charCodeAt(++l));for(;l<r;){w=M();let j;if(w===Wt){I=T.backslashes=!0,w=M(),w===fn&&(O=!0);continue}if(O===!0||w===fn){for(K++;H()!==!0&&(w=M());){if(w===Wt){I=T.backslashes=!0,M();continue}if(w===fn){K++;continue}if(O!==!0&&w===cn&&(w=M())===cn){if(g=T.isBrace=!0,_=T.isGlob=!0,D=!0,i===!0)continue;break}if(O!==!0&&w===ao){if(g=T.isBrace=!0,_=T.isGlob=!0,D=!0,i===!0)continue;break}if(w===co&&(K--,K===0)){O=!1,g=T.isBrace=!0,D=!0;break}}if(i===!0)continue;break}if(w===Zr){if(s.push(l),o.push(T),T={value:"",depth:0,isGlob:!1},D===!0)continue;if(k===cn&&l===c+1){c+=2;continue}h=l+1;continue}if(e.noext!==!0&&(w===uo||w===oo||w===un||w===Qr||w===hn)===!0&&d()===pn){if(_=T.isGlob=!0,A=T.isExtglob=!0,D=!0,w===hn&&l===c&&(F=!0),i===!0){for(;H()!==!0&&(w=M());){if(w===Wt){I=T.backslashes=!0,w=M();continue}if(w===ti){_=T.isGlob=!0,D=!0;break}}continue}break}if(w===un){if(k===un&&(C=T.isGlobstar=!0),_=T.isGlob=!0,D=!0,i===!0)continue;break}if(w===Qr){if(_=T.isGlob=!0,D=!0,i===!0)continue;break}if(w===lo){for(;H()!==!0&&(j=M());){if(j===Wt){I=T.backslashes=!0,M();continue}if(j===ho){E=T.isBracket=!0,_=T.isGlob=!0,D=!0;break}}if(i===!0)continue;break}if(e.nonegate!==!0&&w===hn&&l===c){x=T.negated=!0,c++;continue}if(e.noparen!==!0&&w===pn){if(_=T.isGlob=!0,i===!0){for(;H()!==!0&&(w=M());){if(w===pn){I=T.backslashes=!0,w=M();continue}if(w===ti){D=!0;break}}continue}break}if(_===!0){if(D=!0,i===!0)continue;break}}e.noext===!0&&(A=!1,_=!1);let L=u,z="",p="";c>0&&(z=u.slice(0,c),u=u.slice(c),h-=c),L&&_===!0&&h>0?(L=u.slice(0,h),p=u.slice(h)):_===!0?(L="",p=u):L=u,L&&L!==""&&L!=="/"&&L!==u&&ei(L.charCodeAt(L.length-1))&&(L=L.slice(0,-1)),e.unescape===!0&&(p&&(p=Vr.removeBackslashes(p)),L&&I===!0&&(L=Vr.removeBackslashes(L)));let f={prefix:z,input:n,start:c,base:L,glob:p,isBrace:g,isBracket:E,isGlob:_,isExtglob:A,isGlobstar:C,negated:x,negatedExtglob:F};if(e.tokens===!0&&(f.maxDepth=0,ei(w)||o.push(T),f.tokens=o),e.parts===!0||e.tokens===!0){let j;for(let N=0;N<s.length;N++){let tt=j?j+1:c,q=s[N],X=n.slice(tt,q);e.tokens&&(N===0&&c!==0?(o[N].isPrefix=!0,o[N].value=z):o[N].value=X,ni(o[N]),f.maxDepth+=o[N].depth),(N!==0||X!=="")&&a.push(X),j=q}if(j&&j+1<n.length){let N=n.slice(j+1);a.push(N),e.tokens&&(o[o.length-1].value=N,ni(o[o.length-1]),f.maxDepth+=o[o.length-1].depth)}f.slashes=s,f.parts=a}return f};ri.exports=fo});var ai=At((Ru,oi)=>{"use strict";var he=Gt(),it=ce(),{MAX_LENGTH:fe,POSIX_REGEX_SOURCE:po,REGEX_NON_SPECIAL_CHARS:go,REGEX_SPECIAL_CHARS_BACKREF:vo,REPLACEMENTS:si}=he,mo=(n,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...n,t);n.sort();let e=`[${n.join("-")}]`;try{new RegExp(e)}catch(r){return n.map(i=>it.escapeRegex(i)).join("..")}return e},kt=(n,t)=>`Missing ${n}: "${t}" - use "\\\\${t}" to match literal characters`,dn=(n,t)=>{if(typeof n!="string")throw new TypeError("Expected a string");n=si[n]||n;let e={...t},r=typeof e.maxLength=="number"?Math.min(fe,e.maxLength):fe,i=n.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);let s={type:"bos",value:"",output:e.prepend||""},o=[s],a=e.capture?"":"?:",u=it.isWindows(t),l=he.globChars(u),c=he.extglobChars(l),{DOT_LITERAL:h,PLUS_LITERAL:g,SLASH_LITERAL:E,ONE_CHAR:_,DOTS_SLASH:A,NO_DOT:C,NO_DOT_SLASH:O,NO_DOTS_SLASH:I,QMARK:x,QMARK_NO_DOT:F,STAR:D,START_ANCHOR:K}=l,k=y=>`(${a}(?:(?!${K}${y.dot?A:h}).)*?)`,w=e.dot?"":C,T=e.dot?x:F,H=e.bash===!0?k(e):D;e.capture&&(H=`(${H})`),typeof e.noext=="boolean"&&(e.noextglob=e.noext);let d={input:n,index:-1,start:0,dot:e.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};n=it.removePrefix(n,d),i=n.length;let M=[],L=[],z=[],p=s,f,j=()=>d.index===i-1,N=d.peek=(y=1)=>n[d.index+y],tt=d.advance=()=>n[++d.index]||"",q=()=>n.slice(d.index+1),X=(y="",B=0)=>{d.consumed+=y,d.index+=B},ct=y=>{d.output+=y.output!=null?y.output:y.value,X(y.value)},Ft=()=>{let y=1;for(;N()==="!"&&(N(2)!=="("||N(3)==="?");)tt(),d.start++,y++;return y%2==0?!1:(d.negated=!0,d.start++,!0)},wt=y=>{d[y]++,z.push(y)},ht=y=>{d[y]--,z.pop()},S=y=>{if(p.type==="globstar"){let B=d.braces>0&&(y.type==="comma"||y.type==="brace"),v=y.extglob===!0||M.length&&(y.type==="pipe"||y.type==="paren");y.type!=="slash"&&y.type!=="paren"&&!B&&!v&&(d.output=d.output.slice(0,-p.output.length),p.type="star",p.value="*",p.output=H,d.output+=p.output)}if(M.length&&y.type!=="paren"&&(M[M.length-1].inner+=y.value),(y.value||y.output)&&ct(y),p&&p.type==="text"&&y.type==="text"){p.value+=y.value,p.output=(p.output||"")+y.value;return}y.prev=p,o.push(y),p=y},_t=(y,B)=>{let v={...c[B],conditions:1,inner:""};v.prev=p,v.parens=d.parens,v.output=d.output;let R=(e.capture?"(":"")+v.open;wt("parens"),S({type:y,value:B,output:d.output?"":_}),S({type:"paren",extglob:!0,value:tt(),output:R}),M.push(v)},Xt=y=>{let B=y.close+(e.capture?")":""),v;if(y.type==="negate"){let R=H;if(y.inner&&y.inner.length>1&&y.inner.includes("/")&&(R=k(e)),(R!==H||j()||/^\)+$/.test(q()))&&(B=y.close=`)$))${R}`),y.inner.includes("*")&&(v=q())&&/^\.[^\\/.]+$/.test(v)){let U=dn(v,{...t,fastpaths:!1}).output;B=y.close=`)${U})${R})`}y.prev.type==="bos"&&(d.negatedExtglob=!0)}S({type:"paren",extglob:!0,value:f,output:B}),ht("parens")};if(e.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(n)){let y=!1,B=n.replace(vo,(v,R,U,Z,G,we)=>Z==="\\"?(y=!0,v):Z==="?"?R?R+Z+(G?x.repeat(G.length):""):we===0?T+(G?x.repeat(G.length):""):x.repeat(U.length):Z==="."?h.repeat(U.length):Z==="*"?R?R+Z+(G?H:""):H:R?v:`\\${v}`);return y===!0&&(e.unescape===!0?B=B.replace(/\\/g,""):B=B.replace(/\\+/g,v=>v.length%2==0?"\\\\":v?"\\":"")),B===n&&e.contains===!0?(d.output=n,d):(d.output=it.wrapOutput(B,d,t),d)}for(;!j();){if(f=tt(),f==="\0")continue;if(f==="\\"){let v=N();if(v==="/"&&e.bash!==!0||v==="."||v===";")continue;if(!v){f+="\\",S({type:"text",value:f});continue}let R=/^\\+/.exec(q()),U=0;if(R&&R[0].length>2&&(U=R[0].length,d.index+=U,U%2!=0&&(f+="\\")),e.unescape===!0?f=tt():f+=tt(),d.brackets===0){S({type:"text",value:f});continue}}if(d.brackets>0&&(f!=="]"||p.value==="["||p.value==="[^")){if(e.posix!==!1&&f===":"){let v=p.value.slice(1);if(v.includes("[")&&(p.posix=!0,v.includes(":"))){let R=p.value.lastIndexOf("["),U=p.value.slice(0,R),Z=p.value.slice(R+2),G=po[Z];if(G){p.value=U+G,d.backtrack=!0,tt(),!s.output&&o.indexOf(p)===1&&(s.output=_);continue}}}(f==="["&&N()!==":"||f==="-"&&N()==="]")&&(f=`\\${f}`),f==="]"&&(p.value==="["||p.value==="[^")&&(f=`\\${f}`),e.posix===!0&&f==="!"&&p.value==="["&&(f="^"),p.value+=f,ct({value:f});continue}if(d.quotes===1&&f!=='"'){f=it.escapeRegex(f),p.value+=f,ct({value:f});continue}if(f==='"'){d.quotes=d.quotes===1?0:1,e.keepQuotes===!0&&S({type:"text",value:f});continue}if(f==="("){wt("parens"),S({type:"paren",value:f});continue}if(f===")"){if(d.parens===0&&e.strictBrackets===!0)throw new SyntaxError(kt("opening","("));let v=M[M.length-1];if(v&&d.parens===v.parens+1){Xt(M.pop());continue}S({type:"paren",value:f,output:d.parens?")":"\\)"}),ht("parens");continue}if(f==="["){if(e.nobracket===!0||!q().includes("]")){if(e.nobracket!==!0&&e.strictBrackets===!0)throw new SyntaxError(kt("closing","]"));f=`\\${f}`}else wt("brackets");S({type:"bracket",value:f});continue}if(f==="]"){if(e.nobracket===!0||p&&p.type==="bracket"&&p.value.length===1){S({type:"text",value:f,output:`\\${f}`});continue}if(d.brackets===0){if(e.strictBrackets===!0)throw new SyntaxError(kt("opening","["));S({type:"text",value:f,output:`\\${f}`});continue}ht("brackets");let v=p.value.slice(1);if(p.posix!==!0&&v[0]==="^"&&!v.includes("/")&&(f=`/${f}`),p.value+=f,ct({value:f}),e.literalBrackets===!1||it.hasRegexChars(v))continue;let R=it.escapeRegex(p.value);if(d.output=d.output.slice(0,-p.value.length),e.literalBrackets===!0){d.output+=R,p.value=R;continue}p.value=`(${a}${R}|${p.value})`,d.output+=p.value;continue}if(f==="{"&&e.nobrace!==!0){wt("braces");let v={type:"brace",value:f,output:"(",outputIndex:d.output.length,tokensIndex:d.tokens.length};L.push(v),S(v);continue}if(f==="}"){let v=L[L.length-1];if(e.nobrace===!0||!v){S({type:"text",value:f,output:f});continue}let R=")";if(v.dots===!0){let U=o.slice(),Z=[];for(let G=U.length-1;G>=0&&(o.pop(),U[G].type!=="brace");G--)U[G].type!=="dots"&&Z.unshift(U[G].value);R=mo(Z,e),d.backtrack=!0}if(v.comma!==!0&&v.dots!==!0){let U=d.output.slice(0,v.outputIndex),Z=d.tokens.slice(v.tokensIndex);v.value=v.output="\\{",f=R="\\}",d.output=U;for(let G of Z)d.output+=G.output||G.value}S({type:"brace",value:f,output:R}),ht("braces"),L.pop();continue}if(f==="|"){M.length>0&&M[M.length-1].conditions++,S({type:"text",value:f});continue}if(f===","){let v=f,R=L[L.length-1];R&&z[z.length-1]==="braces"&&(R.comma=!0,v="|"),S({type:"comma",value:f,output:v});continue}if(f==="/"){if(p.type==="dot"&&d.index===d.start+1){d.start=d.index+1,d.consumed="",d.output="",o.pop(),p=s;continue}S({type:"slash",value:f,output:E});continue}if(f==="."){if(d.braces>0&&p.type==="dot"){p.value==="."&&(p.output=h);let v=L[L.length-1];p.type="dots",p.output+=f,p.value+=f,v.dots=!0;continue}if(d.braces+d.parens===0&&p.type!=="bos"&&p.type!=="slash"){S({type:"text",value:f,output:h});continue}S({type:"dot",value:f,output:h});continue}if(f==="?"){if(!(p&&p.value==="(")&&e.noextglob!==!0&&N()==="("&&N(2)!=="?"){_t("qmark",f);continue}if(p&&p.type==="paren"){let R=N(),U=f;if(R==="<"&&!it.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(p.value==="("&&!/[!=<:]/.test(R)||R==="<"&&!/<([!=]|\w+>)/.test(q()))&&(U=`\\${f}`),S({type:"text",value:f,output:U});continue}if(e.dot!==!0&&(p.type==="slash"||p.type==="bos")){S({type:"qmark",value:f,output:F});continue}S({type:"qmark",value:f,output:x});continue}if(f==="!"){if(e.noextglob!==!0&&N()==="("&&(N(2)!=="?"||!/[!=<:]/.test(N(3)))){_t("negate",f);continue}if(e.nonegate!==!0&&d.index===0){Ft();continue}}if(f==="+"){if(e.noextglob!==!0&&N()==="("&&N(2)!=="?"){_t("plus",f);continue}if(p&&p.value==="("||e.regex===!1){S({type:"plus",value:f,output:g});continue}if(p&&(p.type==="bracket"||p.type==="paren"||p.type==="brace")||d.parens>0){S({type:"plus",value:f});continue}S({type:"plus",value:g});continue}if(f==="@"){if(e.noextglob!==!0&&N()==="("&&N(2)!=="?"){S({type:"at",extglob:!0,value:f,output:""});continue}S({type:"text",value:f});continue}if(f!=="*"){(f==="$"||f==="^")&&(f=`\\${f}`);let v=go.exec(q());v&&(f+=v[0],d.index+=v[0].length),S({type:"text",value:f});continue}if(p&&(p.type==="globstar"||p.star===!0)){p.type="star",p.star=!0,p.value+=f,p.output=H,d.backtrack=!0,d.globstar=!0,X(f);continue}let y=q();if(e.noextglob!==!0&&/^\([^?]/.test(y)){_t("star",f);continue}if(p.type==="star"){if(e.noglobstar===!0){X(f);continue}let v=p.prev,R=v.prev,U=v.type==="slash"||v.type==="bos",Z=R&&(R.type==="star"||R.type==="globstar");if(e.bash===!0&&(!U||y[0]&&y[0]!=="/")){S({type:"star",value:f,output:""});continue}let G=d.braces>0&&(v.type==="comma"||v.type==="brace"),we=M.length&&(v.type==="pipe"||v.type==="paren");if(!U&&v.type!=="paren"&&!G&&!we){S({type:"star",value:f,output:""});continue}for(;y.slice(0,3)==="/**";){let Vt=n[d.index+4];if(Vt&&Vt!=="/")break;y=y.slice(3),X("/**",3)}if(v.type==="bos"&&j()){p.type="globstar",p.value+=f,p.output=k(e),d.output=p.output,d.globstar=!0,X(f);continue}if(v.type==="slash"&&v.prev.type!=="bos"&&!Z&&j()){d.output=d.output.slice(0,-(v.output+p.output).length),v.output=`(?:${v.output}`,p.type="globstar",p.output=k(e)+(e.strictSlashes?")":"|$)"),p.value+=f,d.globstar=!0,d.output+=v.output+p.output,X(f);continue}if(v.type==="slash"&&v.prev.type!=="bos"&&y[0]==="/"){let Vt=y[1]!==void 0?"|$":"";d.output=d.output.slice(0,-(v.output+p.output).length),v.output=`(?:${v.output}`,p.type="globstar",p.output=`${k(e)}${E}|${E}${Vt})`,p.value+=f,d.output+=v.output+p.output,d.globstar=!0,X(f+tt()),S({type:"slash",value:"/",output:""});continue}if(v.type==="bos"&&y[0]==="/"){p.type="globstar",p.value+=f,p.output=`(?:^|${E}|${k(e)}${E})`,d.output=p.output,d.globstar=!0,X(f+tt()),S({type:"slash",value:"/",output:""});continue}d.output=d.output.slice(0,-p.output.length),p.type="globstar",p.output=k(e),p.value+=f,d.output+=p.output,d.globstar=!0,X(f);continue}let B={type:"star",value:f,output:H};if(e.bash===!0){B.output=".*?",(p.type==="bos"||p.type==="slash")&&(B.output=w+B.output),S(B);continue}if(p&&(p.type==="bracket"||p.type==="paren")&&e.regex===!0){B.output=f,S(B);continue}(d.index===d.start||p.type==="slash"||p.type==="dot")&&(p.type==="dot"?(d.output+=O,p.output+=O):e.dot===!0?(d.output+=I,p.output+=I):(d.output+=w,p.output+=w),N()!=="*"&&(d.output+=_,p.output+=_)),S(B)}for(;d.brackets>0;){if(e.strictBrackets===!0)throw new SyntaxError(kt("closing","]"));d.output=it.escapeLast(d.output,"["),ht("brackets")}for(;d.parens>0;){if(e.strictBrackets===!0)throw new SyntaxError(kt("closing",")"));d.output=it.escapeLast(d.output,"("),ht("parens")}for(;d.braces>0;){if(e.strictBrackets===!0)throw new SyntaxError(kt("closing","}"));d.output=it.escapeLast(d.output,"{"),ht("braces")}if(e.strictSlashes!==!0&&(p.type==="star"||p.type==="bracket")&&S({type:"maybe_slash",value:"",output:`${E}?`}),d.backtrack===!0){d.output="";for(let y of d.tokens)d.output+=y.output!=null?y.output:y.value,y.suffix&&(d.output+=y.suffix)}return d};dn.fastpaths=(n,t)=>{let e={...t},r=typeof e.maxLength=="number"?Math.min(fe,e.maxLength):fe,i=n.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);n=si[n]||n;let s=it.isWindows(t),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:u,DOTS_SLASH:l,NO_DOT:c,NO_DOTS:h,NO_DOTS_SLASH:g,STAR:E,START_ANCHOR:_}=he.globChars(s),A=e.dot?h:c,C=e.dot?g:c,O=e.capture?"":"?:",I={negated:!1,prefix:""},x=e.bash===!0?".*?":E;e.capture&&(x=`(${x})`);let F=w=>w.noglobstar===!0?x:`(${O}(?:(?!${_}${w.dot?l:o}).)*?)`,D=w=>{switch(w){case"*":return`${A}${u}${x}`;case".*":return`${o}${u}${x}`;case"*.*":return`${A}${x}${o}${u}${x}`;case"*/*":return`${A}${x}${a}${u}${C}${x}`;case"**":return A+F(e);case"**/*":return`(?:${A}${F(e)}${a})?${C}${u}${x}`;case"**/*.*":return`(?:${A}${F(e)}${a})?${C}${x}${o}${u}${x}`;case"**/.*":return`(?:${A}${F(e)}${a})?${o}${u}${x}`;default:{let T=/^(.*?)\.(\w+)$/.exec(w);if(!T)return;let H=D(T[1]);return H?H+o+T[2]:void 0}}},K=it.removePrefix(n,I),k=D(K);return k&&e.strictSlashes!==!0&&(k+=`${a}?`),k};oi.exports=dn});var ui=At((Ou,li)=>{"use strict";var yo=le(),wo=ii(),gn=ai(),vn=ce(),Eo=Gt(),bo=n=>n&&typeof n=="object"&&!Array.isArray(n),$=(n,t,e=!1)=>{if(Array.isArray(n)){let c=n.map(g=>$(g,t,e));return g=>{for(let E of c){let _=E(g);if(_)return _}return!1}}let r=bo(n)&&n.tokens&&n.input;if(n===""||typeof n!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let i=t||{},s=vn.isWindows(t),o=r?$.compileRe(n,t):$.makeRe(n,t,!1,!0),a=o.state;delete o.state;let u=()=>!1;if(i.ignore){let c={...t,ignore:null,onMatch:null,onResult:null};u=$(i.ignore,c,e)}let l=(c,h=!1)=>{let{isMatch:g,match:E,output:_}=$.test(c,o,t,{glob:n,posix:s}),A={glob:n,state:a,regex:o,posix:s,input:c,output:_,match:E,isMatch:g};return typeof i.onResult=="function"&&i.onResult(A),g===!1?(A.isMatch=!1,h?A:!1):u(c)?(typeof i.onIgnore=="function"&&i.onIgnore(A),A.isMatch=!1,h?A:!1):(typeof i.onMatch=="function"&&i.onMatch(A),h?A:!0)};return e&&(l.state=a),l};$.test=(n,t,e,{glob:r,posix:i}={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");if(n==="")return{isMatch:!1,output:""};let s=e||{},o=s.format||(i?vn.toPosixSlashes:null),a=n===r,u=a&&o?o(n):n;return a===!1&&(u=o?o(n):n,a=u===r),(a===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?a=$.matchBase(n,t,e,i):a=t.exec(u)),{isMatch:Boolean(a),match:a,output:u}};$.matchBase=(n,t,e,r=vn.isWindows(e))=>(t instanceof RegExp?t:$.makeRe(t,e)).test(yo.basename(n));$.isMatch=(n,t,e)=>$(t,e)(n);$.parse=(n,t)=>Array.isArray(n)?n.map(e=>$.parse(e,t)):gn(n,{...t,fastpaths:!1});$.scan=(n,t)=>wo(n,t);$.compileRe=(n,t,e=!1,r=!1)=>{if(e===!0)return n.output;let i=t||{},s=i.contains?"":"^",o=i.contains?"":"$",a=`${s}(?:${n.output})${o}`;n&&n.negated===!0&&(a=`^(?!${a}).*$`);let u=$.toRegex(a,t);return r===!0&&(u.state=n),u};$.makeRe=(n,t={},e=!1,r=!1)=>{if(!n||typeof n!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(n[0]==="."||n[0]==="*")&&(i.output=gn.fastpaths(n,t)),i.output||(i=gn(n,t)),$.compileRe(i,t,e,r)};$.toRegex=(n,t)=>{try{let e=t||{};return new RegExp(n,e.flags||(e.nocase?"i":""))}catch(e){if(t&&t.debug===!0)throw e;return/$^/}};$.constants=Eo;li.exports=$});var hi=At((Lu,ci)=>{"use strict";ci.exports=ui()});var Wi=`<div class="container">
  <label class="hidden" id="title">display-port</label>
  <label class="hidden" id="fps">00</label>
  <label class="hidden" id="dimension">0x0</label>
  <div class="content">
    <canvas> Oh no! Your browser does not support canvas. </canvas>
    <slot id="inner"></slot>
  </div>
  <slot name="frame"></slot>
</div>
`,Yi=`:host {
  display: inline-block;
  color: #555555;
}

.container {
  display: flex;
  position: relative;
  width: 100%;
  height: 100%;
}

.content {
  position: relative;
  margin: auto;
}

.content > *:not(canvas) {
  width: 100%;
  height: 100%;
}

canvas {
  background: #000000;
  image-rendering: pixelated;
}

label {
  position: absolute;
  font-family: monospace;
  color: currentColor;
}

#inner {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
}

#title {
  left: 0.5rem;
  top: 0.5rem;
}

#fps {
  right: 0.5rem;
  top: 0.5rem;
}

#dimension {
  left: 0.5rem;
  bottom: 0.5rem;
}

.hidden {
  display: none;
}

:host([debug]) .container {
  outline: 6px dashed rgba(0, 0, 0, 0.1);
  outline-offset: -4px;
  background-color: rgba(0, 0, 0, 0.1);
}

:host([mode='noscale']) canvas {
  margin: 0;
  top: 0;
  left: 0;
}

:host([mode='stretch']) canvas,
:host([mode='scale']) canvas {
  width: 100%;
  height: 100%;
}

:host([mode='fit']),
:host([mode='scale']),
:host([mode='center']),
:host([mode='stretch']),
:host([mode='fill']) {
  width: 100%;
  height: 100%;
}

:host([full]) {
  width: 100vw !important;
  height: 100vh !important;
}

:host([disabled]) {
  display: none;
}

slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
}

::slotted(*) {
  pointer-events: auto;
}
`,xn="noscale";var Ee="fit",Tn="scale",Sn="fill",Rn="stretch",On=300,Ln=150,Nn=Ee,zi=200,Qt=class extends HTMLElement{static create(t={}){let{root:e=document.body,mode:r=Nn,width:i=On,height:s=Ln,debug:o=!1}=t||{},a=new Qt;return a.mode=r,a.width=i,a.height=s,a.debug=o,e.appendChild(a),a}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Wi,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Yi,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=t.querySelector("canvas"),this._contentElement=t.querySelector(".content"),this._innerElement=t.querySelector("#inner"),this._titleElement=t.querySelector("#title"),this._fpsElement=t.querySelector("#fps"),this._dimensionElement=t.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=On,this._height=Ln,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){Rt(this,"mode"),Rt(this,"debug"),Rt(this,"disabled"),Rt(this,"width"),Rt(this,"height"),Rt(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode",Nn),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,r){switch(t){case"debug":this._debug=r!==null;break;case"disabled":this._disabled=r!==null;break;case"width":this._width=Number(r);break;case"height":this._height=Number(r);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+r+"}}").bind(this);break}switch(t){case"disabled":r?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",r),this._fpsElement.classList.toggle("hidden",r),this._dimensionElement.classList.toggle("hidden",r);break}}getContext(t="2d",e=void 0){return this._canvasElement.getContext(t,e)}pause(){window.cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=window.requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=window.requestAnimationFrame(this.update),this.updateCanvasSize(!1);let e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){let s=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");if(this._fpsElement.textContent!==s&&(this._fpsElement.textContent=s),this.mode===xn){let a=`${this._width}x${this._height}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}else{let a=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==a&&(this._dimensionElement.textContent=a)}}let i=this._frameEvent.detail;i.now=t,i.prevTime=this._prevAnimationFrameTime,i.deltaTime=e,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=null,this.updateCanvasSize(!0)}delayCanvasResize(t,e){(t!==this._resizeCanvasWidth||e!==this._resizeCanvasHeight)&&(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&window.clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=window.setTimeout(this.onDelayCanvasResize,zi))}updateCanvasSize(t=!0){let e=this.shadowRoot.host.getBoundingClientRect(),r=e.width,i=e.height,s=this._canvasElement,o=this._width,a=this._height,u=this.mode;if(u===Rn||u===Sn)o=r,a=i;else if(u!==xn&&(r<o||i<a||u===Ee||u==Tn)){let c=r/o,h=i/a;c<h?(o=r,a=a*c):(o=o*h,a=i)}if(o=Math.floor(o),a=Math.floor(a),typeof t=="undefined"&&(t=s.clientWidth!==o||s.clientHeight!==a),!t){this.delayCanvasResize(o,a);return}let l=Math.min(o/this._width,a/this._height)*.5;if(this._innerElement.style.fontSize=`font-size: ${l}em`,t){u===Tn?(s.width=this._width,s.height=this._height):u!==Rn&&(s.width=o,s.height=a);let c=this._contentElement.style;c.width=`${o}px`,c.height=`${a}px`,(u===Ee||u===Sn)&&(this._width=o,this._height=a);let g=this._resizeEvent.detail;g.width=o,g.height=a,this.dispatchEvent(this._resizeEvent)}}};Qt.define();function Rt(n,t){if(Object.prototype.hasOwnProperty.call(n,t)){let e=n[t];delete n[t],n[t]=e}}var be=class{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,r){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e=void 0){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}},Ht=class extends be{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array,r=this.constructor;for(let i=0;i<t;++i)e.push(r.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e=this._state,r=e.length,i;if(t<=r)i=e.slice(0,t);else{i=e;let s=this.constructor;for(let o=r;o<t;++o)i.push(s.createAxisBindingState())}this._state=i,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,r=0,i=0,s=e.length;for(let o=0;o<s;++o){let a=e[o];r+=a.value*(a.inverted?-1:1),i+=a.delta,e[o].delta=0}this._value=r,this._delta=i,super.onPoll(t)}onUpdate(t,e,r){typeof e=="undefined"?this.onAxisChange(t,r):this.onAxisMove(t,e,r)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e=void 0){super.onBind(t,e);let{inverted:r=!1}=e||{},i=this._state;i[t].inverted=r}onAxisMove(t,e,r){let i=this._state[t];i.value=e,i.delta+=r}onAxisChange(t,e){let r=this._state[t];r.value+=e,r.delta+=e}onAxisStatus(t,e){let r=this._state[t],i=r.value;r.value=e,r.delta=e-i}},qi=241,Mn=254,Xi=239,Ct=1,_e=2,Ae=4,Ce=8,xe=16,te=class extends be{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t);this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e=this._state,r=e.length,i;t<=r?i=e.slice(0,t):(i=new Uint8Array(t),i.set(e)),this._state=i,super.resize(t)}getState(t){let e=this._state[t],r=e&xe?-1:1;return(e&Ct?1:0)*r}onPoll(t){let e=this._state,r=0,i=0,s=0,o=0,a=0,u=e.length;for(let l=0;l<u;++l){let c=e[l],h=c&Ct,g=c&xe;i|=h,s|=c&_e,o|=c&Ae,a|=c&Ce,r+=(h?1:0)*(g?-1:1),e[l]&=qi}this._value=r,this._down=i!==0,this._pressed=s!==0,this._repeated=o!==0,this._released=a!==0,super.onPoll(t)}onUpdate(t,e,r){r>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,e!==0)}onBind(t,e={inverted:!1}){super.onBind(t,e);let{inverted:r=!1}=e,i=this._state;r?i[t]|=xe:i[t]&=Xi}onButtonPressed(t){let e=this._state,r=e[t];r&Ct||(r|=_e,r|=Ct),r|=Ae,e[t]=r}onButtonReleased(t){let e=this._state,r=e[t];r&Ct&&(r|=Ce,r&=Mn),e[t]=r}onButtonStatus(t,e){let r=this._state,i=r[t],s=Boolean(i&Ct);e?i|=Ct:i&=Mn,s&&!e&&(i|=Ce),!s&&e&&(i|=_e,i|=Ae),r[t]=i}},m=class{static parse(t){t=t.trim();let e=t.indexOf(".");if(e<0)throw new Error("Missing device separator for key code.");let r=t.substring(0,e);if(r.length<0)throw new Error("Missing device for key code.");let i=t.substring(e+1);if(i.length<0)throw new Error("Missing code for key code.");return new m(r,i)}constructor(t,e){this.device=t,this.code=e}toString(){return`${this.device}.${this.code}`}};var b="Keyboard",ft="Mouse",qo=new m(b,"KeyA"),Xo=new m(b,"KeyB"),Vo=new m(b,"KeyC"),Zo=new m(b,"KeyD"),Qo=new m(b,"KeyE"),ta=new m(b,"KeyF"),ea=new m(b,"KeyG"),na=new m(b,"KeyH"),ra=new m(b,"KeyI"),ia=new m(b,"KeyJ"),sa=new m(b,"KeyK"),oa=new m(b,"KeyL"),aa=new m(b,"KeyM"),la=new m(b,"KeyN"),ua=new m(b,"KeyO"),ca=new m(b,"KeyP"),ha=new m(b,"KeyQ"),fa=new m(b,"KeyR"),pa=new m(b,"KeyS"),da=new m(b,"KeyT"),ga=new m(b,"KeyU"),va=new m(b,"KeyV"),ma=new m(b,"KeyW"),ya=new m(b,"KeyX"),wa=new m(b,"KeyY"),Ea=new m(b,"KeyZ"),ba=new m(b,"Digit0"),_a=new m(b,"Digit1"),Aa=new m(b,"Digit2"),Ca=new m(b,"Digit3"),xa=new m(b,"Digit4"),Ta=new m(b,"Digit5"),Sa=new m(b,"Digit6"),Ra=new m(b,"Digit7"),Oa=new m(b,"Digit8"),La=new m(b,"Digit9"),Na=new m(b,"Minus"),Ma=new m(b,"Equal"),Ia=new m(b,"BracketLeft"),Da=new m(b,"BracketRight"),ka=new m(b,"Semicolon"),Ba=new m(b,"Quote"),Pa=new m(b,"Backquote"),Fa=new m(b,"Backslash"),Ha=new m(b,"Comma"),Ua=new m(b,"Period"),Ja=new m(b,"Slash"),$a=new m(b,"Escape"),Ka=new m(b,"Space"),ja=new m(b,"CapsLock"),Ga=new m(b,"Backspace"),Wa=new m(b,"Delete"),Ya=new m(b,"Tab"),za=new m(b,"Enter"),qa=new m(b,"ArrowUp"),Xa=new m(b,"ArrowDown"),Va=new m(b,"ArrowLeft"),Za=new m(b,"ArrowRight"),Qa=new m(ft,"Button0"),tl=new m(ft,"Button1"),el=new m(ft,"Button2"),nl=new m(ft,"Button3"),rl=new m(ft,"Button4"),il=new m(ft,"PosX"),sl=new m(ft,"PosY"),ol=new m(ft,"WheelX"),al=new m(ft,"WheelY"),ll=new m(ft,"WheelZ");var Te=class{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let r=this.listeners;t in r?r[t].push(e):r[t]=[e]}removeEventListener(t,e){let r=this.listeners;if(t in r){let i=r[t],s=i.indexOf(e);s>=0&&i.splice(s,1)}}dispatchInputEvent(t){let e=0;for(let r of this.listeners.input)e|=r(t);return Boolean(e)}},In=class extends Te{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,r={}){super(t,e);let{ignoreRepeat:i=!0}=r;this.ignoreRepeat=i,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;if(e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}},Se=10,Re=100,Dn=class extends Te{static isAxis(t){return t==="PosX"||t==="PosY"||t==="WheelX"||t==="WheelY"||t==="WheelZ"}static isButton(t){return!this.isAxis(t)}constructor(t,e,r={}){super(t,e);let{eventsOnFocus:i=!0}=r;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,r,i;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=t.deltaX*Se,r=t.deltaY*Se,i=t.deltaZ*Se;break;case WheelEvent.DOM_DELTA_PAGE:e=t.deltaX*Re,r=t.deltaY*Re,i=t.deltaZ*Re;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,r=t.deltaY,i=t.deltaZ;break}let s=0,o=this._wheelObject;if(o.code="WheelX",o.movement=e,s|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=r,s|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=i,s|=this.dispatchInputEvent(o),s)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;if(e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;let e=this.canvasTarget,{clientWidth:r,clientHeight:i}=e,s=e.getBoundingClientRect(),o=t.movementX/r,a=t.movementY/i,u=(t.clientX-s.left)/r,l=(t.clientY-s.top)/i,c=this._positionObject;c.code="PosX",c.value=u,c.movement=o,this.dispatchInputEvent(c),c.code="PosY",c.value=l,c.movement=a,this.dispatchInputEvent(c)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}},Vi=`<kbd>
  <span id="name"><slot></slot></span>
  <span id="value" class="hidden"></span>
</kbd>
`,Zi=`kbd {
  position: relative;
  display: inline-block;
  border-radius: 3px;
  border: 1px solid #888888;
  font-size: 0.85em;
  font-weight: 700;
  text-rendering: optimizeLegibility;
  line-height: 12px;
  height: 14px;
  padding: 2px 4px;
  color: #444444;
  background-color: #eeeeee;
  box-shadow: inset 0 -3px 0 #aaaaaa;
  overflow: hidden;
}

kbd:empty::after {
  content: '<?>';
  opacity: 0.6;
}

.disabled {
  opacity: 0.6;
  box-shadow: none;
  background-color: #aaaaaa;
}

.hidden {
  display: none;
}

#value {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  font-size: 0.85em;
  padding: 0 4px;
  padding-top: 2px;
  color: #cccccc;
  background-color: #333333;
  box-shadow: inset 0 3px 0 #222222;
}
`,Oe=class extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Vi,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=Zi,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super();let t=this.constructor,e=this.attachShadow({mode:"open"});e.appendChild(t[Symbol.for("templateNode")].content.cloneNode(!0)),e.appendChild(t[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=e.querySelector("kbd"),this._nameElement=e.querySelector("#name"),this._valueElement=e.querySelector("#value")}attributeChangedCallback(t,e,r){switch(t){case"name":this._name=r,this._nameElement.textContent=r;break;case"value":this._value=r,r!==null?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=r,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=r!==null,this._kbdElement.classList.toggle("disabled",r!==null);break}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}};Oe.define();var Qi=`<table>
  <thead>
    <tr class="tableHeader">
      <th colspan="3">
        <span class="tableTitle">
          <label id="title"> input-source </label>
          <span id="slotContainer">
            <slot></slot>
          </span>
          <p>
            <label for="poll">poll</label>
            <output id="poll"></output>
          </p>
          <p>
            <label for="focus">focus</label>
            <output id="focus"></output>
          </p>
        </span>
      </th>
    </tr>
    <tr class="colHeader">
      <th>name</th>
      <th>value</th>
      <th>key</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
`,ts=`:host {
  display: block;
}

table {
  border-collapse: collapse;
  font-family: monospace;
}

table,
th,
td {
  border: 1px solid #666666;
}

th,
td {
  padding: 5px 10px;
}

td {
  text-align: center;
}

thead th {
  padding: 0;
}

.colHeader > th {
  font-size: 0.8em;
  padding: 0 10px;
  letter-spacing: 3px;
  background-color: #aaaaaa;
  color: #666666;
}

tbody output {
  border-radius: 0.3em;
  padding: 3px;
}

tr:not(.primary) .name,
tr:not(.primary) .value {
  opacity: 0.3;
}

tr:nth-child(2n) {
  background-color: #eeeeee;
}

.tableHeader {
  color: #666666;
}

.tableTitle {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 4px;
}

#slotContainer {
  flex: 1;
}

p {
  display: inline;
  margin: 0;
  padding: 0;
  padding-right: 10px;
}

#poll:empty::after,
#focus:empty::after {
  content: '\u2717';
  color: #ff0000;
}
`,kn=class{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return this.animationFrameHandle!==null}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}},Bn=class{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){let{device:e,code:r,event:i,value:s,movement:o,control:a,shift:u,alt:l}=t,c=this.bindings.getBindings(e,r);switch(i){case"pressed":for(let{input:h,index:g}of c)h.onUpdate(g,1,1);break;case"released":for(let{input:h,index:g}of c)h.onUpdate(g,0,-1);break;case"move":for(let{input:h,index:g}of c)h.onUpdate(g,s,o);break;case"wheel":for(let{input:h,index:g}of c)h.onUpdate(g,void 0,o);break}return c.length>0}},Le=class{constructor(t,e,r,i){this.device=t,this.code=e,this.input=r,this.index=i}},Pn=class{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,r,i={inverted:!1}){let s,o=this.inputMap;if(o.has(t)){let u=o.get(t),l=t.size;t.onBind(l,i),s=new Le(e,r,t,l),u.push(s)}else{let u=[];o.set(t,u);let l=0;t.onBind(l,i),s=new Le(e,r,t,l),u.push(s)}let a=this.bindingMap;e in a?r in a[e]?a[e][r].push(s):a[e][r]=[s]:a[e]={[r]:[s]}}unbind(t){let e=this.inputMap;if(e.has(t)){let r=this.bindingMap,i=e.get(t);for(let s of i){let{device:o,code:a}=s,u=r[o][a],l=u.indexOf(s);u.splice(l,1)}i.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let r=this.bindingMap;if(t in r){let i=r[t];if(e in i)return i[e]}return[]}},Fn=class{constructor(t,e=void 0){this.inputs={},this.devices=[new Dn("Mouse",t),new In("Keyboard",t)],this.bindings=new Pn,this.adapter=new Bn(this.bindings),this.autopoller=new kn(this.adapter),this.eventTarget=t,this.anyButton=new te(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new Ht(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let r of this.devices)r.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let r in t)t[r].length=0;this.autopoller.running&&this.autopoller.stop();for(let r of this.devices)r.removeEventListener("input",this.onInput),r.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let r of this.devices)r.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t=void 0){let e=this.autopoller.running,r=typeof t=="undefined"?!e:Boolean(t);r!==e&&(r?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let r=this.listeners;t in r?r[t].push(e):r[t]=[e]}removeEventListener(t,e){let r=this.listeners;if(t in r){let i=r[t],s=i.indexOf(e);s>=0&&i.splice(s,1)}}dispatchEvent(t){let{type:e}=t,r=0;for(let i of this.listeners[e])r|=i(t)?1:0;return Boolean(r)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement);break}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){Array.isArray(t)||(t=Object.values(t));for(let e of t)e.bindTo(this)}bindBinding(t){t.bindTo(this)}bindButton(t,e,r,i=void 0){let s;this.hasButton(t)?s=this.getButton(t):(s=new te(1),this.inputs[t]=s),this.bindings.bind(s,e,r,i),this.onBind()}bindAxis(t,e,r,i=void 0){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Ht(1),this.inputs[t]=s),this.bindings.bind(s,e,r,i),this.onBind()}bindAxisButtons(t,e,r,i){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new Ht(2),this.inputs[t]=s),this.bindings.bind(s,e,i),this.bindings.bind(s,e,r,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof te}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof Ht}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t=void 0){if(typeof t=="undefined")return this.anyButton.down;{let e=this.inputs;for(let r of t)if(e[r].down)return!0}return!1}isAnyButtonPressed(t=void 0){if(typeof t=="undefined")return this.anyButton.pressed;{let e=this.inputs;for(let r of t)if(e[r].pressed)return!0}return!1}isAnyButtonReleased(t=void 0){if(typeof t=="undefined")return this.anyButton.released;{let e=this.inputs;for(let r of t)if(e[r].released)return!0}return!1}getAnyAxisValue(t=void 0){if(typeof t=="undefined")return this.anyAxis.value;{let e=this.inputs;for(let r of t){let i=e[r];if(i.value)return i.value}}return 0}getAnyAxisDelta(t=void 0){if(typeof t=="undefined")return this.anyAxis.delta;{let e=this.inputs;for(let r of t){let i=e[r];if(i.delta)return i.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}},ee=class extends HTMLElement{static create(t={}){let{root:e=document.body,for:r=void 0,autopoll:i=!1}=t||{},s=new ee;return s.for=r,s.autopoll=i,e.appendChild(s),s}static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML=Qi,Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=ts,Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();let t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=t.querySelector("#title"),this._pollElement=t.querySelector("#poll"),this._focusElement=t.querySelector("#focus"),this._bodyElement=t.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;let e=this;this._for="",this._eventTarget=e,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let t=this._context;t&&(t.removeEventListener("bind",this.onInputContextBind),t.removeEventListener("unbind",this.onInputContextUnbind),t.removeEventListener("blur",this.onInputContextBlur),t.removeEventListener("focus",this.onInputContextFocus),t.destroy(),this._context=null)}attributeChangedCallback(t,e,r){switch(t){case"for":{this._for=r;let i,s;r?(i=document.getElementById(r),s=`${i.tagName.toLowerCase()}#${r}`):(i=this,s="input-port"),this._eventTarget=i,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${s}`}break;case"autopoll":this._autopoll=r!==null,this._context&&this._context.toggleAutoPoll(this._autopoll);break}}onAnimationFrame(){this.animationFrameHandle=window.requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="\u2713",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(t="axisbutton",e=void 0){switch(t){case"axisbutton":if(!this._context){let r=new Fn(this._eventTarget,e);r.addEventListener("bind",this.onInputContextBind),r.addEventListener("unbind",this.onInputContextUnbind),r.addEventListener("blur",this.onInputContextBlur),r.addEventListener("focus",this.onInputContextFocus),this._autopoll&&r.toggleAutoPoll(!0),this._context=r}return this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected)if(this._context){let t=this._context,e=t.inputs,r=t.bindings,i={},s=[];for(let o of Object.keys(e)){let a=e[o],u=!0;for(let l of r.getBindingsByInput(a)){let c=es(`${a.constructor.name}.${o}`,`${l.device}.${l.code}`,0,u);s.push(c),u&&(i[o]=c.querySelector("output"),u=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let o of s)this._bodyElement.appendChild(o)}else{this._outputElements={},this._bodyElement.innerHTML="";return}else return}updateTableValues(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let r of Object.keys(this._outputElements)){let i=this._outputElements[r],s=e[r].value;i.innerText=Number(s).toFixed(2)}}else{for(let t of Object.keys(this._outputElements)){let e=this._outputElements[t];e.innerText="---"}return}else return}updatePollStatus(){if(this.isConnected)if(this._context){let e=this._context.inputs;for(let r of Object.values(e))if(!r.polling){this._pollElement.innerHTML="";return}this._pollElement.innerHTML="\u2713"}else{this._pollElement.innerHTML="-";return}else return}};ee.define();function es(n,t,e,r=!0){let i=document.createElement("tr");r&&i.classList.add("primary");{let s=document.createElement("td");s.textContent=n,s.classList.add("name"),i.appendChild(s)}{let s=document.createElement("td"),o=document.createElement("output");r?o.innerText=Number(e).toFixed(2):o.innerText="---",o.classList.add("value"),s.appendChild(o),i.appendChild(s)}{let s=document.createElement("td");s.classList.add("key");let o=new Oe;o.innerText=t,s.appendChild(o),i.appendChild(s)}return i}var ul=Symbol("keyboardSource");var cl=Symbol("mouseSource");window.addEventListener("error",ne,!0);window.addEventListener("unhandledrejection",ne,!0);function ne(n){typeof n=="object"?n instanceof PromiseRejectionEvent?ne(n.reason):n instanceof ErrorEvent?ne(n.error):n instanceof Error?window.alert(n.stack):window.alert(JSON.stringify(n)):window.alert(n)}var Ot=8,pt={EAST:1<<0,NORTHEAST:1<<1,NORTH:1<<2,NORTHWEST:1<<3,WEST:1<<4,SOUTHWEST:1<<5,SOUTH:1<<6,SOUTHEAST:1<<7},vl=Object.values(pt),Ne=0;function Hn(n){return Number.isInteger(n)&&n>0&&n<=pt.SOUTHEAST}function Un(){return 1<<Math.floor(Math.random()*Ot)}function Jn(n,t=1){t=t%Ot,t<0&&(t=Ot+t);let e=Ot-t;return 240&n<<e|n>>t}function Ut(n){switch(n){case pt.EAST:return[1,0];case pt.NORTHEAST:return[1,-1];case pt.NORTH:return[0,-1];case pt.NORTHWEST:return[-1,-1];case pt.WEST:return[-1,0];case pt.SOUTHWEST:return[-1,1];case pt.SOUTH:return[0,1];case pt.SOUTHEAST:return[1,1];case Ne:throw new Error("Cannot get delta vector from null encoding.");default:throw new Error("Cannot get delta vector from multi-directional encoding.")}}var Me=6,Ie=class{constructor(t,e){this.width=t,this.height=e,this.length=t*e,this.juncs={},this.lanes={}}hasJunction(t){return t<0?!1:Boolean(this.juncs[t])}getJunction(t){let e=this.juncs[t];if(!e)throw new Error(`Cannot get non-existant junction at index ${t}.`);return e}setJunction(t,e){if(this.juncs[t])throw new Error(`Cannot replace existing junction at index ${t}`);this.juncs[t]=e}deleteJunction(t){if(!this.juncs[t])throw new Error(`Cannot delete non-existant junction at index ${t}.`);this.juncs[t]=void 0}getJunctions(){return Object.values(this.juncs).filter(t=>Boolean(t))}},$n=class{constructor(t,e,r){this.coordX=t,this.coordY=e,this.outlets=[],this.inlets=[],this.lanes={},this.passing=null,this.parkingCapacity=r,this.parking=0}getInlets(){return Array.from(this.inlets)}getOutlets(){return Array.from(this.outlets)}hasInlet(t){return this.inlets.includes(t)}hasOutlet(t){return this.outlets.includes(t)}addInlet(t,e){if(e.inlet!==t)throw new Error("Lane inlet does not match junction inlet.");this.inlets.push(t)}addOutlet(t,e){if(e.outlet!==t)throw new Error("Lane outlet does not match junction outlet.");if(this.outlets.push(t),this.lanes[t])throw new Error(`Cannot replace existing lane at outlet ${t}`);this.lanes[t]=e}removeInlet(t){let e=this.inlets.indexOf(t);if(e>=0)this.inlets.splice(e,1);else throw new Error(`Cannot remove non-existant inlet ${t} for junction.`)}removeOutlet(t){let e=this.outlets.indexOf(t);if(e>=0){if(this.outlets.splice(e,1),!this.lanes[t])throw new Error(`Cannot delete non-existant lane for outlet ${t}.`);this.lanes[t]=void 0}else throw new Error(`Cannot remove non-existant outlet ${t} for junction.`)}getLane(t){let e=this.lanes[t];if(!e)throw new Error(`Cannot get non-existant lane for outlet ${t}.`);return e}getLanes(){return Object.values(this.lanes).filter(t=>Boolean(t))}isEmpty(){return this.inlets.length<=0&&this.outlets.length<=0}},Kn=class{constructor(t,e,r){if(t===e)throw new Error("Cannot create lane with the same inlet and outlet.");this.inlet=t,this.outlet=e,this.slots=new Array(r),this.length=r,this.blocking=r}};function De(n,t){let e=n.getJunction(t).getOutlets();return e[Math.floor(Math.random()*e.length)]}function ke(n,t){return n.getJunction(t)}function jn(n,t,e){if(typeof n!="object")throw new Error("Missing map.");return ke(n,t).lanes[e]}function Et(n,t,e,r=0){let i=new $n(t,e,r),s=W(n,t,e);return n.setJunction(s,i),i}function J(n,t){if(typeof n!="object")throw new Error("Missing map.");return[t%n.width,Math.floor(t/n.width)]}function W(n,t,e){if(typeof n!="object")throw new Error("Missing map.");return t+e*n.width}function ns(n,t,e,r){let i=n.getJunction(t),s=n.getJunction(e),o=new Kn(t,e,r);return i.addOutlet(e,o),s.addInlet(t,o),o}function rs(n,t,e){let r=n.getJunction(t),i=n.getJunction(e);r.removeOutlet(e),i.removeInlet(t)}function is(n,t,e){return n.getJunction(t).getLane(e)}function at(n,t,e,r=Me){ns(n,t,e,r)}function Lt(n,t,e){let r=is(n,t,e);if(r.blocking<r.length)throw new Error("Cannot disconnect junctions with a non-vacated lane.");rs(n,t,e)}function Nt(n,t,e){return n.getJunction(t).hasOutlet(e)}function V(n,t,e){return t>=0&&e>=0&&t<n.width&&e<n.height}function re(n,t){let e=n.getJunction(t);if(!xt(n,t)){let r=e.getOutlets();for(let s of r)Lt(n,t,s),xt(n,s)&&n.deleteJunction(s);let i=e.getInlets();for(let s of i)Lt(n,s,t),xt(n,s)&&n.deleteJunction(s)}n.deleteJunction(t)}function Be(n,t,e){let r=n.getJunction(t);for(let i of r.getOutlets())e.includes(i)&&(Lt(n,t,i),xt(n,i)&&re(n,i));for(let i of r.getInlets())e.includes(i)&&(Lt(n,i,t),xt(n,i)&&re(n,i))}function Gn(n,t,e){let r=n.getJunction(t);for(let i of r.getOutlets())e.includes(i)||(Lt(n,t,i),xt(n,i)&&re(n,i));for(let i of r.getInlets())e.includes(i)||(Lt(n,i,t),xt(n,i)&&re(n,i))}function xt(n,t){return n.getJunction(t).isEmpty()}function lt(n,t){return t===-1||!n.hasJunction(t)}var ss=.5;function Wn(n,t,e){let r=e/2,i=(e-r)/2,s=r/3;n.lineWidth=s,n.strokeStyle="teal";for(let o of t.getJunctions()){let{coordX:a,coordY:u}=o,l=a*e,c=u*e;n.strokeRect(l+i,c+i,r,r)}}function Yn(n,t,e){let i=e/2/3;n.lineWidth=i/4;for(let s=0;s<t.height;++s)for(let o=0;o<t.width;++o){let a=o+s*t.width;if(!t.hasJunction(a))continue;let u=t.getJunction(a),l=(o+.5)*e,c=(s+.5)*e;for(let h of u.getLanes()){let[g,E]=J(t,h.outlet),_=(g+.5)*e,A=(E+.5)*e,C=_-l,O=A-c,I=Math.atan2(O,C),x=h.length,F=e/3/x;u.passing?n.strokeStyle="red":n.strokeStyle="lime",n.beginPath(),n.arc(l,c,i/2,0,Math.PI*2),n.stroke();for(let D=0;D<x;++D){let K=(D+ss)/x,k=l+C*K,w=c+O*K;h.slots[D]?n.strokeStyle="red":n.strokeStyle="white",n.beginPath(),n.arc(k,w,F,I,I+Math.PI),n.stroke()}}}}function zn(n,t,e){let i=e/2;n.lineWidth=i,n.lineCap="round",n.strokeStyle="#333333";for(let s=0;s<t.height;++s)for(let o=0;o<t.width;++o){let a=o+s*t.width;if(!t.hasJunction(a))continue;let u=t.getJunction(a),l=(o+.5)*e,c=(s+.5)*e;for(let h of u.outlets){let[g,E]=J(t,h),_=(g+.5)*e,A=(E+.5)*e;n.beginPath(),n.moveTo(l,c),n.lineTo(_,A),n.stroke()}}}function qn(n,t,e,r,i="#222222"){for(let s=0;s<e;++s)for(let o=0;o<t;++o){let a=o*r,u=s*r;n.strokeStyle=i,n.strokeRect(a,u,r,r)}}var Pe=class{constructor(t){this.junctionMap=t,this.directs=new Array(t.length).fill(-1)}markDirectableJunction(t,e){let r=this.junctionMap;if(!r.hasJunction(t))throw new Error("Cannot mark directable for non-existant junction.");if(!r.hasJunction(e))throw new Error("Cannot mark directable child as non-existant junction.");if(this.directs[e]!==-1)throw new Error("Cannot mark directable child as another directable junction.");if(this.directs[t]!==-1)throw new Error("Cannot mark directable for junction already directable.");this.directs[t]=e}unmarkDirectableJunction(t){if(this.directs[t]===-1)throw new Error("Cannot unmark directable for junction already non-directable.");this.directs[t]=-1}isDirectableJunction(t){return this.directs[t]!==-1}getDirectableJunctionChild(t){return this.directs[t]}redirectDirectableJunction(t,e,r){let i=this.junctionMap;if(e===r)throw new Error("Cannot redirect directable junction to the same child.");if(!this.isDirectableJunction(t))throw new Error("Cannot redirect non-directable junction.");if(this.isDirectableJunction(r))throw new Error("Cannot redirect directable junction to another directable junction.");if(this.getDirectableJunctionChild(t)!==e)throw new Error("Found mismatched child index for directable junction.");if(!i.hasJunction(r))throw new Error("Cannot redirect junction to non-existant child.");this.directs[t]=r,Nt(i,t,r)||at(i,t,r),Nt(i,r,t)||at(i,r,t)}};function Xn(n,t,e,r){let[i,s]=J(n,t),o=e;for(let a=0;a<Ot;++a){let[u,l]=Ut(o),c=i+u,h=s+l;if(!V(n,c,h))continue;let g=W(n,c,h);if(r(g))return o;o=Jn(o)}return Ne}var Fe=class{constructor(t){this.junctionMap=t,this.persists={}}clear(){this.persists={}}markPersistentJunction(t,e=t){this.markPersistentJunctionImpl(t,e),t!==e&&this.markPersistentJunctionImpl(e,t)}markPersistentJunctionImpl(t,e){let r=this.persists[t];if(r||(r=this.persists[t]=[]),r.indexOf(e)<0)r.push(e);else throw new Error("Cannot mark persistence for junction already persistent.")}unmarkPersistentJunction(t,e=t){this.unmarkPersistentJunctionImpl(t,e),t!==e&&this.unmarkPersistentJunctionImpl(e,t)}unmarkPersistentJunctionImpl(t,e){let r=this.persists[t],i=r.indexOf(e);if(i>=0)r.splice(i,1);else throw new Error("Cannot unmark persistence for junction already non-persistent.")}isPersistentJunction(t){let e=this.persists[t];return e?e.length>0:!1}retainOnlyPersistentJunctionConnections(t){let e=this.junctionMap,r=this.persists[t];if(!r||r.length<=0)throw new Error("Cannot retain non-persistent junction.");Gn(e,t,r)}};var os=5,as=4,ls=3,us=2,cs=1,hs=0,xl={[os]:Jt("#7F8C8D"),[as]:Jt("#2ECC71"),[ls]:Jt("#4794C8"),[us]:Jt("#F39C12"),[cs]:Jt("#C0392B"),[hs]:[""]};function Jt(n){return[`background: ${n}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}var Tl=Symbol("level"),Sl=Symbol("domain");function Vn(n,t,e,r,i){let s=Math.floor(n),o=Math.floor(t),a=Math.floor(e),u=Math.floor(r),l=Math.abs(e-n),c=n<e?1:-1,h=-Math.abs(r-t),g=t<r?1:-1,E=l+h,_=s,A=o,C=i(_,A);if(typeof C!="undefined")return C;let O=l*l+h*h,I=0;for(;I<O&&(_!==a||A!==u);){++I;let x=E*2;if(x>=h&&(E+=h,_+=c),x<=l&&(E+=l,A+=g),C=i(_,A),typeof C!="undefined")return C}}var Mt=0,fs=class{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(let e of t)this._heap.push(e),this._shiftUp()}pop(){let t=this.peek(),e=ps(this);return e>Mt&&this._swap(Mt,e),this._heap.pop(),this._shiftDown(),t}replace(t){let e=this.peek();return this._heap[Mt]=t,this._shiftDown(),e}peek(){return this._heap[Mt]}at(t){return this._heap[t]}indexOf(t,e=void 0){return this._heap.indexOf(t,e)}splice(t,e=void 0){return this._heap.splice(t,e)}_compare(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){let r=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=r}_shiftUp(){let t=this._heap.length-1,e;for(;t>Mt&&this._compare(t,e=ds(t));)this._swap(t,e),t=e}_shiftDown(){let t=this._heap.length,e=Mt,r,i=Zn(e),s=i<t,o=Qn(e),a=o<t;for(;s&&this._compare(i,e)||a&&this._compare(o,e);)r=a&&this._compare(o,i)?o:i,this._swap(e,r),e=r,i=Zn(e),s=i<t,o=Qn(e),a=o<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}};function ps(n){return n._heap.length-1}function ds(n){return(n+1>>>1)-1}function Zn(n){return(n<<1)+1}function Qn(n){return n+1<<1}function $t(n=void 0){return n?(n^Math.random()*16>>n/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,$t)}function He(n,t,e){return n+(t-n)*e}function gs(n,t,e){return Math.min(e,Math.max(t,n))}function Ue(n,t,e){let r=e-t,i=(n-t)%r;return i<0&&(i+=r),i+t}function tr(n,t,e){let r=Ue(t-n,-Math.PI,Math.PI);return gs(n+r,n-e,n+e)}var Rl=Math.PI/180,Ol=180/Math.PI;var et={NONE:0,ACTIVATING:1,DEACTIVATING:2};function er(n,t,e,r,i,s,o,a){let u=n/o,l=t/o,c=Math.floor(u),h=Math.floor(l);switch(e){case et.ACTIVATING:vs(r,c,h,u,l,i,a);break;case et.DEACTIVATING:ms(r,c,h,s);break;case et.NONE:r.status=et.NONE;break}}function vs(n,t,e,r,i,s,o){let{status:a,dragCellX:u,dragCellY:l}=n;a!==et.ACTIVATING&&(n.status=et.ACTIVATING,n.dragCellX=u=t,n.dragCellY=l=e);let c=u+.5,h=l+.5,g=r,E=i,_=g-c,A=E-h;Math.sqrt(_*_+A*A)>=o&&(c=u,h=l,g=t,E=e,Vn(c,h,g,E,(O,I)=>{s.call(void 0,c,h,O,I),g=c=O,E=h=I}),n.dragCellX=g,n.dragCellY=E)}function ms(n,t,e,r){let{status:i,dragCellX:s,dragCellY:o}=n;i!==et.DEACTIVATING&&(n.status=et.DEACTIVATING,n.dragCellX=s=-1,n.dragCellY=o=-1),(t!==s||e!==o)&&(r.call(void 0,t,e),n.dragCellX=t,n.dragCellY=e)}var Y=-1,Je=-1,$e=0,It=1,Kt=2,ys=4,Ke=class{constructor(t,e){this.junctionMap=t,this.planner=e,this.agents={},this.paths={},this.ticks=0}spawnAgent(t){let e=this.junctionMap;if(!e.hasJunction(t))throw new Error("Cannot spawn agent on non-existant junction as home.");let r=$t(),i=new nr(r,t);return this.agents[r]=i,We(e,i,t),sr(e,i,t),i}getAgent(t){return this.agents[t]}getAgents(){return Object.values(this.agents)}tick(){let t=this.junctionMap,e=this.ticks++,r=Object.values(this.agents);for(let i of r)if(i.lastUpdatedTick<e){i.lastUpdatedTick=e;let s=i.passing;lt(t,s)||As(t,i,s),i.speed=i.maxSpeed}this.moveAgents(r)}moveAgents(t){let e=this.junctionMap,r=[];for(let i of t){let s=i.target;if(!lt(e,s)){if(i.junction===s){i.clearTarget(),r.push(i);continue}let o=i.speed;if(o>0){let a=ws(e,i,s,i.intent,o);if(i.speed=a,o<a)throw new Error("Agent gained speed after moving? How is that possible?")}i.junction===s&&(i.clearTarget(),r.push(i))}}this.planner(r),r.length>0&&this.moveAgents(r)}},nr=class{constructor(t,e){this.id=t,this.home=e,this.junction=Y,this.outlet=Y,this.slot=Je,this.speed=0,this.maxSpeed=ys,this.parking=Y,this.passing=Y,this.target=Y,this.nextTarget=Y,this.intent=$e,this.lastUpdatedTick=-1}setTarget(t,e,r){this.target=t,this.nextTarget=e,this.intent=r}clearTarget(){this.target=Y,this.nextTarget=Y,this.intent=$e}};function ws(n,t,e,r,i){let s=t.junction,o=n.getJunction(s);if(!o.hasOutlet(e))throw new Error(`Missing outlet '${J(n,e)}' at junction '${J(n,s)}' to move cart towards.`);let a=o.getLane(e);if(lt(n,t.outlet)){let u=je(n,a,0);if(u>0){let l=Math.min(u,i-1);return or(n,t,s,e,l),i-l}else return 0}else{if(t.outlet!==e)throw new Error("Agent is changing lanes!");{let u=t.slot,l=u+i,c=je(n,a,u+1);if(c>=a.length&&l>=a.length&&r!==$e)switch(r){case It:if(lt(n,t.nextTarget))throw new Error("Agent must have next target if passing junction.");if(rr(n,e)&&bs(n,e,t.nextTarget)){_s(n,t,e),We(n,t,e),or(n,t,e,t.nextTarget,0);let h=Es(n,e);return Math.max(0,l-a.length-h)}else return l=Math.min(a.length-1,c,l),Ge(n,t,s,e,l),0;case Kt:return ir(n,e)?(We(n,t,e),sr(n,t,e),0):(l=a.length-1,Ge(n,t,s,e,l),0)}else return l=Math.min(a.length-1,c,l),Ge(n,t,s,e,l),0}}}function Es(n,t){let e=ke(n,t);return Math.max(0,e.getInlets().length-2)}function bs(n,t,e){if(t<0||e<0)throw new Error("Junction index must be non-negative.");let r=jn(n,t,e);if(!r)throw new Error(`Cannot find lane for given inlet '${J(n,t)}' and outlet '${J(n,e)}'.`);return je(n,r,0)>=0}function je(n,t,e){if(e<0)throw new Error("Slot must be non-negative.");for(let r=e;r<t.length;++r)if(t.slots[r])return r-1;return t.length}function rr(n,t){return n.hasJunction(t)?n.getJunction(t).passing===null:!1}function _s(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot pass on non-existant junction.");if(!rr(n,e))throw new Error("Cannot pass on blocked junction.");let r=n.getJunction(e);t.passing=e,r.passing=t.id}function As(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot release pass on non-existant junction.");if(t.passing!==e)throw new Error("Cannot release pass for agent not passing at junction.");let r=n.getJunction(e);t.passing=Y,r.passing=null}function ir(n,t){if(!n.hasJunction(t))return!1;let e=n.getJunction(t);return e.parking<e.parkingCapacity}function sr(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot park on non-existant junction.");if(!ir(n,e))throw new Error("Junction is already full for parking.");let r=n.getJunction(e);t.parking=e,r.parking+=1}function Cs(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot release park on non-existant junction.");if(t.parking!==e)throw new Error("Cannot release parking for agent not parked at junction.");let r=n.getJunction(e);if(r.parking<=0)throw new Error("Cannot release parking at junction with no agents.");t.parking=Y,r.parking-=1}function or(n,t,e,r,i){if(!n.hasJunction(e))throw new Error("Cannot park on non-existant junction.");if(t.junction!==e)throw new Error("Cannot enter lane with agent not on same junction.");if(!lt(n,t.outlet))throw new Error("Cannot enter lane when agent already on another.");let o=n.getJunction(e).lanes[r];t.outlet=r,t.slot=i,o.slots[i]=t.id}function Ge(n,t,e,r,i){if(!n.hasJunction(e))throw new Error("Cannot park on non-existant junction.");if(t.junction!==e)throw new Error("Cannot move on lane with agent not on same junction.");if(t.outlet!==r)throw new Error("Cannot move on lane with agent not on same outlet.");let o=n.getJunction(e).lanes[r],a=t.slot;t.slot=i,o.slots[a]=void 0,o.slots[i]=t.id}function xs(n,t,e,r){let s=n.getJunction(e).lanes[r];s.slots[t.slot]=void 0,t.outlet=Y,t.slot=Je}function We(n,t,e){if(!n.hasJunction(e))throw new Error("Cannot force on non-existant junction.");let r=t.junction;if(!lt(n,r)){let i=t.outlet;lt(n,i)||xs(n,t,r,i);let s=t.parking;lt(n,s)||Cs(n,t,s)}t.junction=e,t.outlet=Y,t.slot=Je}function ar(n,t,e,r){let i=r/8;for(let s of e.getAgents()){let[o,a]=J(t,s.junction);if(n.fillStyle="red",n.fillRect((o+.5)*r-i,(a+.5)*r-i,i*2,i*2),s.target!==-1){let[u,l]=J(t,s.target);n.fillStyle="green",n.fillRect((u+.5)*r-i,(l+.5)*r-i,i*2,i*2)}if(s.outlet!==-1){let[u,l]=J(t,s.outlet);n.strokeStyle="gold",n.lineWidth=2,n.strokeRect((u+.5)*r-i,(l+.5)*r-i,i*2,i*2)}}}function lr(n,t,e,r,i){let s=Ts();ur(s,n);let o=new Set,a=new Set;for(o.add(n);o.size>0;){let u;for(let c of o)u?s.fscore[c]<s.fscore[u]&&(u=c):u=c;let l=u;if(l===t){let c=[];for(;s.parents[l];)c.push(l),l=s.parents[l];return c.push(l),c.reverse()}else{a.add(l),o.delete(l);for(let c of e(l)){if(a.has(c))continue;let h=i(l,c);if(!Number.isFinite(h))continue;let g=s.gscore[l]+h,E=!1;o.has(c)?g<s.gscore[c]&&(E=!0):(E=!0,ur(s,c),s.hscore[c]=r(c,t),o.add(c)),E&&(s.parents[c]=l,s.gscore[c]=g,s.fscore[c]=g+s.hscore[c])}}}return[]}function Ts(){return{fscore:{},gscore:{},hscore:{},parents:{}}}function ur(n,t,e=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.NaN,s=null){return n.fscore[t]=e,n.gscore[t]=r,n.hscore[t]=i,n.parents[t]=s,t}var Ye=-1,ze=class{constructor(t){this.junctionMap=t,this.paths={},this.used=new Uint8Array(t.length),this.weighted=new Float32Array(t.length).fill(1),this.neighbors=this.neighbors.bind(this),this.heuristics=this.heuristics.bind(this),this.weights=this.weights.bind(this)}acquirePath(t,e){if(!this.junctionMap.hasJunction(t)||!this.junctionMap.hasJunction(e))throw new Error("Cannot acquire path between non-existant junctions.");let r=$t(),i;if(r in this.paths)i=this.paths[r];else{if(i=lr(t,e,this.neighbors,this.heuristics,this.weights),i.length<=0)return null;this.paths[r]=i}for(let s of i){let o=this.used[s];this.used[s]=o+1}return r}releasePath(t){let e=this.paths[t];if(!e)throw new Error("Cannot release non-existant path.");delete this.paths[t];for(let r of e)this.used[r]-=1}prunePath(t,e){let r=this.paths[t];if(!r)throw new Error("Cannot prune non-existant path.");for(let i=0;i<e;++i){let s=r[i];s!==Ye&&(this.used[s]-=1,r[i]=Ye)}}isJunctionUsedForAnyPath(t){return this.used[t]>0}getPathById(t){return this.paths[t]}getNextInPath(t,e){let r=this.paths[t];return e<=0?r[0]:e>=r.length?Ye:r[e]}setWeight(t,e){this.weighted[t]=e}resetWeight(t){this.weighted[t]=1}getWeight(t){return this.weighted[t]}neighbors(t){return this.junctionMap.getJunction(t).getOutlets()}heuristics(t,e){let[r,i]=J(this.junctionMap,t),[s,o]=J(this.junctionMap,e);return Math.abs(s-r)+Math.abs(o-i)}weights(t,e){return this.weighted[e]}};var Dt=class{constructor(t,e){this.color={main:t,shadow:e}}},qe={lime:new Dt("lime","green"),tomato:new Dt("tomato","maroon"),banana:new Dt("yellow","gold"),blueberry:new Dt("aqua","royalblue"),plum:new Dt("plum","blueviolet")},dt=Object.keys(qe);function Tt(n){return qe[n].color.main}function jt(n){return qe[n].color.shadow}function cr(n,t){return n===t}var hr=-1,fr=-1,ie=30,Gl=ie/2;var Xe=class{constructor(t,e){this.junctionMap=t,this.trafficSimulator=e,this.carts={}}createCart(t,e,r,i){let s=this.junctionMap,o=this.trafficSimulator,a=W(s,t,e),l=o.spawnAgent(a).id,c=new pr(l,t+.5,e+.5,r,i);return this.carts[l]=c,c}getCartById(t){return this.carts[t]}getCartByAgentId(t){return this.carts[t]}},pr=class{constructor(t,e,r,i,s){this.id=t,this.prevX=e,this.prevY=r,this.prevJunction=hr,this.prevOutlet=hr,this.prevSlot=fr,this.x=e,this.y=r,this.radians=i,this.cargo=s}getAgentId(){return this.id}};function dr(n,t,e,r,i){let s=t.trafficSimulator,o=t.junctionMap,a=e/r,u=Me;for(let l of Object.values(t.carts)){let c=s.getAgent(l.getAgentId()),h=c.junction,g=c.outlet,E=c.slot,_=l.x,A=l.y,C=l.radians;if(h!==-1&&g!==-1){e<=0?(l.prevX=l.x,l.prevY=l.y):e>=r&&(l.prevJunction=h,l.prevOutlet=g,l.prevSlot=E);let x,F,D=l.prevSlot!==fr?u-l.prevSlot:0,k=l.currentSlot+D;a<D/k?[x,F]=vr(o,l.prevJunction,l.prevOutlet,0,1):[x,F]=vr(o,h,g,0,E/u);let w=l.prevX,T=l.prevY,H=He(w,x,a),d=He(T,F,a),M=x-w,L=F-T,z;if(Math.abs(M)<=Number.EPSILON&&Math.abs(L)<=Number.EPSILON)z=l.radians;else{let p=Math.atan2(L,M),f=l.radians,j=Ue(p-f,-Math.PI,Math.PI);z=tr(f,p,j/(Math.PI*2))}l.x=H,l.y=d,l.radians=z}let O=Tt(l.cargo),I=jt(l.cargo);Ss(n,_*i,A*i,C,O,I,i)}}function Ss(n,t,e,r,i,s,o){let a=o*.2,u=o*.3,l=a/2,c=u/2,h=2,g=u*.4,E=u*.2;n.translate(t,e),n.rotate(r+Math.PI/2),n.fillStyle=s,n.fillRect(-l,-c,a,u),n.fillStyle=i,n.fillRect(-l+h,-c+g,a-h*2,g+E),n.fillStyle="gold",n.fillRect(-l+h,-c,h,h),n.fillRect(l-h*2,-c,h,h),n.rotate(-r-Math.PI/2),n.translate(-t,-e)}var gr=Math.PI*.5;function vr(n,t,e,r,i){let[s,o]=J(n,t),[a,u]=J(n,e),l=a-s,c=u-o,h=Math.atan2(c,l),g=Math.cos(h+gr)*(.15+.2*r),E=Math.sin(h+gr)*(.15+.2*r);return[s+.5+g+l*i,o+.5+E+c*i]}function Ve(n,t,e,r){return t.acquirePath(e,r)}function mr(n,t,e){if(!e)throw new Error("Non-existant cart.");let r=Object.values(n.factory).filter(a=>cr(a.cargo,e.cargo));if(r.length<=0)return Y;let i=Math.floor(Math.random()*r.length),o=r[i].parking;return o.length<=0?Y:(i=Math.floor(Math.random()*o.length),o[i])}var Ze=class{constructor(t,e,r){this.junctionMap=t,this.pathFinder=e,this.persistence=r,this.demolished=new Uint8Array(t.length),this.lanes={}}update(){let t=this.junctionMap.length;for(let e=0;e<t;++e)if(this.isJunctionMarkedForDemolition(e)){if(!this.junctionMap.hasJunction(e))throw new Error("Trying to demolish non-existant, but marked, junction.");this.pathFinder.isJunctionUsedForAnyPath(e)||(Rs(this.junctionMap,this.persistence,e,this.lanes[e]),this.unmarkForDemolition(e))}}clear(){let t=this.junctionMap.length;for(let e=0;e<t;++e)this.isJunctionMarkedForDemolition(e)&&this.unmarkForDemolition(e)}markForDemolition(t){let e=this.junctionMap.getJunction(t);this.lanes[t]=e.getOutlets(),this.demolished[t]=1,this.pathFinder.setWeight(t,Number.POSITIVE_INFINITY)}unmarkForDemolition(t){this.demolished[t]=0,delete this.lanes[t],this.pathFinder.resetWeight(t)}unmarkLaneForDemolition(t,e){if(!this.isJunctionMarkedForDemolition(t))return;let r=this.lanes[t],i=r.indexOf(e);i<0||r.splice(i,1)}isJunctionMarkedForDemolition(t){return this.demolished[t]>0}isLaneMarkedForDemolition(t,e){return this.isJunctionMarkedForDemolition(t)&&this.lanes[t].includes(e)}};function Rs(n,t,e,r){if(t.isPersistentJunction(e)){let i=r.filter(s=>!t.isPersistentJunction(s));Be(n,e,i)}else Be(n,e,r)}function yr(n,t,e,r){let s=r/2;n.lineWidth=s,n.lineCap="round",n.strokeStyle="#660000";for(let o=0;o<t.height;++o)for(let a=0;a<t.width;++a){let u=a+o*t.width;if(!t.hasJunction(u)||!e.isJunctionMarkedForDemolition(u))continue;let l=t.getJunction(u),c=(a+.5)*r,h=(o+.5)*r;for(let g of l.outlets){if(!e.isLaneMarkedForDemolition(u,g))continue;let[E,_]=J(t,g),A=(E+.5)*r,C=(_+.5)*r;n.beginPath(),n.moveTo(c,h),n.lineTo(A,C),n.stroke()}}}function wr(n,t,e,r){let i=n.junctionMap;if(!V(i,t,e))return!1;let s=W(i,t,e);if(i.hasJunction(s)||!Hn(r))return!1;let[o,a]=Ut(r),u=t+o,l=e+a,c=W(i,u,l);return!(!V(i,u,l)||n.solids.isSolidJunction(c))}function Er(n,t,e,r,i){let s=n.junctionMap,[o,a]=Ut(r),u=t+o,l=e+a;if(!V(s,u,l))throw new Error("Cannot place outlet outside of boundary.");let c=W(s,t,e),h=W(s,u,l);Et(s,t,e,2),n.solids.markSolidJunction(c),s.hasJunction(h)||Et(s,u,l,0),n.directable.markDirectableJunction(c,h),n.persistence.markPersistentJunction(c,h),at(s,c,h),at(s,h,c);let g=t+e*s.width,E=n.cartManager.createCart(t,e,Math.atan2(a,o),i),_=n.cartManager.createCart(t,e,Math.atan2(a,o),i);n.housing[g]={coordX:t,coordY:e,junction:c,cargo:i,carts:[E.id,_.id]}}function br(n,t,e){return t+e*n.junctionMap.width in n.housing}function _r(n,t,e,r){let i=n.junctionMap;if(!V(i,t,e)||!V(i,t+3,e+3))throw new Error("Cannot place factory out of bounds.");let s=2,o=3;for(let c=0;c<s;++c)for(let h=0;h<o;++h){let g=t+c+1+(e+h)*i.width;n.solids.markSolidJunction(g)}let a=W(i,t,e+2);i.hasJunction(i,a)?i.getJunction(a):Et(i,t,e+2,0);let u=W(i,t+1,e+2);Et(i,t+1,e+2,4),n.persistence.markPersistentJunction(a,u),at(i,a,u),at(i,u,a);let l=t+e*i.width;n.factory[l]={coordX:t,coordY:e,width:s,height:o,cargo:r,entries:[a],parking:[u]}}function Ar(n,t,e){for(let r of Object.values(t.housing))Os(n,r.coordX,r.coordY,Tt(r.cargo),jt(r.cargo),e)}function Os(n,t,e,r,i,s){let o=s*.8,a=s*.2/2,u=t*s+a,l=e*s+a;n.fillStyle=r,n.fillRect(u,l,o,o),n.fillStyle=i,n.fillRect(u,l+o/2,o,o/2)}function Cr(n,t,e){for(let r of Object.values(t.factory)){let i=Tt(r.cargo),s=jt(r.cargo);Ls(n,r.coordX,r.coordY,i,s,e)}}function Ls(n,t,e,r,i,s){let o=s*.1,a=t*s+o,u=e*s+o;n.fillStyle="#666666",n.fillRect(a+s,u,s*2-o*2,s*3-o*2);let l=s*.1;n.fillStyle=r;let c=a+s+l,h=u+l,g=s*2-o*2-l*2,E=s*2-o*2-l*2;n.fillRect(c,h,g,E),n.fillStyle=i,n.fillRect(c,h+E/2,g,E/2)}var Qe=class{constructor(t){this.junctionMap=t,this.solids=new Uint8Array(t.length)}clear(){this.solids={}}markSolidJunction(t){this.solids[t]=1}unmarkSolidJunction(t){this.solids[t]=0}isSolidJunction(t){return this.solids[t]}};function xr(n,t,e,r,i="#663366"){for(let s=0;s<e.height;++s)for(let o=0;o<e.width;++o){let a=o+s*e.width;t.solids.isSolidJunction(a)&&(n.fillStyle=i,n.fillRect(o*r,s*r,r,r))}}var tn=class{constructor(){this.cargos={};for(let t of dt)this.cargos[t]=0}recordCargo(t,e){let r=this.cargos[t];this.cargos[t]=r+e}getCargoCount(t){return this.cargos[t]}};var st=32,Ns=.9,Tr=class{constructor(t,e){this.cursor={screenX:0,screenY:0,dragCellX:0,dragCellY:0,status:0},this.debugMode=!1,this.framesToTick=0,this.spawnTicks=0,this.spawnCargoLevel=0,this.spawnFactoryChance=0;let r=new Ie(t,e);this.junctionMap=r,this.trafficSimulator=new Ke(r,i=>Or(this,i)),this.pathFinder=new ze(r),this.cartManager=new Xe(r,this.trafficSimulator),this.persistence=new Fe(r),this.directable=new Pe(r),this.demolition=new Ze(r,this.pathFinder,this.persistence),this.solids=new Qe(r),this.scoreKeeper=new tn,this.housing={},this.factory={}}};function Sr(){let n=new Tr(24,16),t=n.junctionMap,e,r,i,s=dt[n.spawnCargoLevel];do[e,r]=se(t,0,0,1,1),i=!Nr(n,e,r,s);while(i);do[e,r]=se(t,0,0,1,1),i=!Lr(n,e,r,s);while(i);return n.spawnTicks=1e3,n}function Rr(n,t,e){let r=e.cursor,i=e.junctionMap,s=t.getAxisValue("cursorX")*n.width,o=t.getAxisValue("cursorY")*n.height;r.screenX=s,r.screenY=o;let a=t.isButtonDown("activate")?et.ACTIVATING:t.isButtonDown("deactivate")?et.DEACTIVATING:et.NONE;er(s,o,a,r,(u,l,c,h)=>{if(!V(i,u,l)||!V(i,c,h))return;let[g,E]=en(e,u,l),_=W(i,g,E),[A,C]=en(e,c,h),O=W(i,A,C);_!==O&&Mr(e,i,g,E)&&Mr(e,i,A,C)&&ks(e,i,_,O)},(u,l)=>{let[c,h]=en(e,u,l);if(!V(i,c,h))return;let g=W(i,c,h);i.hasJunction(g)&&e.demolition.markForDemolition(g)},st,Ns),++e.framesToTick>=ie&&(e.framesToTick=0,Or(e,e.trafficSimulator.getAgents().filter(u=>u.target===-1)),e.trafficSimulator.tick()),e.demolition.update(),--e.spawnTicks<=0&&(e.spawnTicks=100+Math.floor(1e3*Math.random()),Ms(e))}function Ms(n){let t=dt[n.spawnCargoLevel],e;if(n.scoreKeeper.getCargoCount(t)>0&&Math.random()<.3){let i=Math.min(dt.length-1,n.spawnCargoLevel+1);n.spawnCargoLevel=i,e=dt[i],n.spawnFactoryChance=.5,n.spawnTicks=100}else e=dt[Math.min(n.spawnCargoLevel,Math.floor(Math.random()*dt.length))];let r;Math.random()<n.spawnFactoryChance?(r=Ds(n,e),r&&(n.spawnFactoryChance=0)):(r=Is(n,e),r&&(n.spawnFactoryChance+=.05))}function Is(n,t){let e=n.junctionMap,r,i,s,o=0;do[r,i]=se(e,0,0,1,1),s=Lr(n,r,i,t),++o;while(!s&&o<10);return s}function Ds(n,t){let e=n.junctionMap,r,i,s,o=0;do[r,i]=se(e,0,0,1,1),s=Nr(n,r,i,t),++o;while(!s&&o<10);return s}function Or(n,t){let e=n.junctionMap;for(let r of t)switch("path"){case"random":{let i=typeof r.savedTarget!="undefined"?r.savedTarget:De(e,r.junction),s=De(e,i);r.savedTarget=s;let o=It;r.setTarget(i,s,o)}break;case"path":if(r.pathId){let i=r.pathId,s=n.pathFinder.getPathById(i),o=s.indexOf(r.junction);if(o>=0)if(o<s.length-2)r.setTarget(s[o+1],s[o+2],It),n.pathFinder.prunePath(i,o);else if(o<s.length-1)r.setTarget(s[o+1],Y,Kt),n.pathFinder.prunePath(i,o);else{if(r.junction!==r.home){let a=n.cartManager.getCartByAgentId(r.id);n.scoreKeeper.recordCargo(a.cargo,1)}r.pathId=null,r.clearTarget(),n.pathFinder.releasePath(i)}else r.pathId=null,r.clearTarget(),n.pathFinder.releasePath(i)}else{let i;if(r.junction===r.home){let s=n.cartManager.getCartByAgentId(r.id);i=mr(n,e,s)}else{let s=r.homePathId,o=n.pathFinder.getPathById(s);r.homePathId=null,r.pathId=s,o===2?r.setTarget(o[1],Y,Kt):r.setTarget(o[1],o[2],It);break}if(!lt(e,i)){let s=Ve(n,n.pathFinder,r.junction,i),o=n.pathFinder.getPathById(s);if(!o||o.length<2)break;let a=Ve(n,n.pathFinder,i,r.home),u=n.pathFinder.getPathById(a);if(!u||u.length<2)break;r.pathId=s,r.homePathId=a,o===2?r.setTarget(o[1],Y,Kt):r.setTarget(o[1],o[2],It)}}break}}function Lr(n,t,e,r){let i=n.junctionMap,s=n.directable,o=n.solids;if(!V(i,t-1,e-1)||!V(i,t+1,e+1))return!1;for(let l=-1;l<=1;++l)for(let c=-1;c<=1;++c){let h=t+l,g=e+c,E=W(i,h,g);if(o.isSolidJunction(E)&&!br(n,h,g))return!1}let a=W(i,t,e),u=Xn(i,a,Un(),l=>!s.isDirectableJunction(l)&&!o.isSolidJunction(l));return wr(n,t,e,u)?(Er(n,t,e,u,r),!0):!1}function Nr(n,t,e,r){let i=n.junctionMap,s=n.solids;if(!V(i,t-1,e-1)||!V(i,t+4,e+5))return!1;for(let o=-1;o<=4;++o)for(let a=-1;a<=5;++a){let u=t+o+(e+a)*i.width;if(s.isSolidJunction(u))return!1}for(let o=1;o<3;++o)for(let a=0;a<3;++a){let u=t+o+(e+a)*i.width;if(i.hasJunction(u))return!1}return _r(n,t,e,r),!0}function en(n,t,e){return[t,e]}function se(n,t=0,e=0,r=0,i=0){let s=n.width-t-r*2,o=n.height-e-i*2,a=Math.floor(Math.random()*s)+t+r,u=Math.floor(Math.random()*o)+e+i;return[a,u]}function Mr(n,t,e,r){let i=W(t,e,r);return n.directable.isDirectableJunction(i)?!0:n.solids.isSolidJunction(i)?!1:(t.hasJunction(i)||Et(t,e,r,0),!0)}function ks(n,t,e,r){if(e===r)return!1;let i=n.directable.isDirectableJunction(e),s=n.directable.isDirectableJunction(r);return i?Ir(n,t,e,r):s?Ir(n,t,r,e):(Nt(t,e,r)||at(t,e,r),Nt(t,r,e)||at(t,r,e),n.demolition.unmarkLaneForDemolition(e,r),n.demolition.unmarkLaneForDemolition(r,e),!0)}function Ir(n,t,e,r){let i=n.directable.getDirectableJunctionChild(e);if(r===i)return!0;if(n.directable.isDirectableJunction(r)||!n.directable.isDirectableJunction(e)||n.solids.isSolidJunction(r))return!1;if(!t.hasJunction(r)){let[s,o]=J(t,r);Et(t,s,o,0)}return n.demolition.markForDemolition(i),n.directable.redirectDirectableJunction(e,i,r),n.persistence.unmarkPersistentJunction(e,i),n.persistence.markPersistentJunction(e,r),!0}function Dr(n,t){let e=t.junctionMap,r=t.cartManager;if(t.cursor.status!==et.NONE){let s=e.width,o=e.height;n.lineWidth=1,qn(n,s,o,st)}xr(n,t,e,st),zn(n,e,st),yr(n,e,t.demolition,st),dr(n,r,t.framesToTick,ie,st),Ar(n,t,st),Cr(n,t,st),t.debugMode&&(Wn(n,e,st),Yn(n,e,st),ar(n,e,t.trafficSimulator,st)),t.cursor.status!==et.NONE&&(n.lineWidth=2,Bs(n,t.cursor.screenX,t.cursor.screenY,st,"#333333"));let i=new DOMMatrix;n.setTransform(i),Fs(n,t),n.setTransform(i.translate(0,20)),Ps(n,t.scoreKeeper),n.setTransform(i)}function Bs(n,t,e,r,i="#FFFFFF"){let s=Math.floor(t/r)*r,o=Math.floor(e/r)*r;n.strokeStyle=i,n.strokeRect(s,o,r,r)}function Ps(n,t){n.font="16px monospace",n.lineWidth=1,n.textBaseline="top";let e=0;for(let r of dt){let i=t.getCargoCount(r);if(i>0){let s=Tt(r);n.fillStyle=s,n.fillText(`\u2588 ${i}`,0,e*20),e+=1}}}function Fs(n,t){n.font="16px monospace",n.lineWidth=1,n.textBaseline="top",n.fillStyle="white",n.fillText(`% ${t.spawnTicks}`,0,0)}async function kr(n,t,e){t.bindAxis("cursorX","Mouse","PosX"),t.bindAxis("cursorY","Mouse","PosY"),t.bindButton("activate","Mouse","Button0"),t.bindButton("deactivate","Mouse","Button2");let r=n.getContext("2d"),i=Sr();n.addEventListener("frame",s=>{let{now:o}=s.detail;t.poll(o),Rr(n,t,i),r.fillStyle="black",r.fillRect(0,0,r.canvas.width,r.canvas.height),Dr(r,i)})}var Oi=Gi(hi());var fi={},_o=function(n,t,e,r,i){var s=new Worker(fi[t]||(fi[t]=URL.createObjectURL(new Blob([n+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return s.onmessage=function(o){var a=o.data,u=a.$e$;if(u){var l=new Error(u[0]);l.code=u[1],l.stack=u[2],i(l,null)}else i(null,a)},s.postMessage(e,r),s},Q=Uint8Array,bt=Uint16Array,mn=Uint32Array,yn=new Q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wn=new Q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pi=new Q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),di=function(n,t){for(var e=new bt(31),r=0;r<31;++r)e[r]=t+=1<<n[r-1];for(var i=new mn(e[30]),r=1;r<30;++r)for(var s=e[r];s<e[r+1];++s)i[s]=s-e[r]<<5|r;return[e,i]},gi=di(yn,2),En=gi[0],Ao=gi[1];En[28]=258,Ao[258]=28;var vi=di(wn,0),mi=vi[0],Nu=vi[1],pe=new bt(32768);for(var P=0;P<32768;++P)yt=(P&43690)>>>1|(P&21845)<<1,yt=(yt&52428)>>>2|(yt&13107)<<2,yt=(yt&61680)>>>4|(yt&3855)<<4,pe[P]=((yt&65280)>>>8|(yt&255)<<8)>>>1;var yt,Bt=function(n,t,e){for(var r=n.length,i=0,s=new bt(t);i<r;++i)n[i]&&++s[n[i]-1];var o=new bt(t);for(i=0;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(e){a=new bt(1<<t);var u=15-t;for(i=0;i<r;++i)if(n[i])for(var l=i<<4|n[i],c=t-n[i],h=o[n[i]-1]++<<c,g=h|(1<<c)-1;h<=g;++h)a[pe[h]>>>u]=l}else for(a=new bt(r),i=0;i<r;++i)n[i]&&(a[i]=pe[o[n[i]-1]++]>>>15-n[i]);return a},Yt=new Q(288);for(var P=0;P<144;++P)Yt[P]=8;for(var P=144;P<256;++P)Yt[P]=9;for(var P=256;P<280;++P)Yt[P]=7;for(var P=280;P<288;++P)Yt[P]=8;var yi=new Q(32);for(var P=0;P<32;++P)yi[P]=5;var wi=Bt(Yt,9,1);var Ei=Bt(yi,5,1),de=function(n){for(var t=n[0],e=1;e<n.length;++e)n[e]>t&&(t=n[e]);return t},ot=function(n,t,e){var r=t/8|0;return(n[r]|n[r+1]<<8)>>(t&7)&e},ge=function(n,t){var e=t/8|0;return(n[e]|n[e+1]<<8|n[e+2]<<16)>>(t&7)},bi=function(n){return(n+7)/8|0},ve=function(n,t,e){(t==null||t<0)&&(t=0),(e==null||e>n.length)&&(e=n.length);var r=new(n.BYTES_PER_ELEMENT==2?bt:n.BYTES_PER_ELEMENT==4?mn:Q)(e-t);return r.set(n.subarray(t,e)),r};var _i=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rt=function(n,t,e){var r=new Error(t||_i[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,rt),!e)throw r;return r},Ai=function(n,t,e){var r=n.length;if(!r||e&&e.f&&!e.l)return t||new Q(0);var i=!t||e,s=!e||e.i;e||(e={}),t||(t=new Q(r*3));var o=function(S){var _t=t.length;if(S>_t){var Xt=new Q(Math.max(_t*2,S));Xt.set(t),t=Xt}},a=e.f||0,u=e.p||0,l=e.b||0,c=e.l,h=e.d,g=e.m,E=e.n,_=r*8;do{if(!c){a=ot(n,u,1);var A=ot(n,u+1,3);if(u+=3,A)if(A==1)c=wi,h=Ei,g=9,E=5;else if(A==2){var x=ot(n,u,31)+257,F=ot(n,u+10,15)+4,D=x+ot(n,u+5,31)+1;u+=14;for(var K=new Q(D),k=new Q(19),w=0;w<F;++w)k[pi[w]]=ot(n,u+w*3,7);u+=F*3;for(var T=de(k),H=(1<<T)-1,d=Bt(k,T,1),w=0;w<D;){var M=d[ot(n,u,H)];u+=M&15;var C=M>>>4;if(C<16)K[w++]=C;else{var L=0,z=0;for(C==16?(z=3+ot(n,u,3),u+=2,L=K[w-1]):C==17?(z=3+ot(n,u,7),u+=3):C==18&&(z=11+ot(n,u,127),u+=7);z--;)K[w++]=L}}var p=K.subarray(0,x),f=K.subarray(x);g=de(p),E=de(f),c=Bt(p,g,1),h=Bt(f,E,1)}else rt(1);else{var C=bi(u)+4,O=n[C-4]|n[C-3]<<8,I=C+O;if(I>r){s&&rt(0);break}i&&o(l+O),t.set(n.subarray(C,I),l),e.b=l+=O,e.p=u=I*8,e.f=a;continue}if(u>_){s&&rt(0);break}}i&&o(l+131072);for(var j=(1<<g)-1,N=(1<<E)-1,tt=u;;tt=u){var L=c[ge(n,u)&j],q=L>>>4;if(u+=L&15,u>_){s&&rt(0);break}if(L||rt(2),q<256)t[l++]=q;else if(q==256){tt=u,c=null;break}else{var X=q-254;if(q>264){var w=q-257,ct=yn[w];X=ot(n,u,(1<<ct)-1)+En[w],u+=ct}var Ft=h[ge(n,u)&N],wt=Ft>>>4;Ft||rt(3),u+=Ft&15;var f=mi[wt];if(wt>3){var ct=wn[wt];f+=ge(n,u)&(1<<ct)-1,u+=ct}if(u>_){s&&rt(0);break}i&&o(l+131072);for(var ht=l+X;l<ht;l+=4)t[l]=t[l-f],t[l+1]=t[l+1-f],t[l+2]=t[l+2-f],t[l+3]=t[l+3-f];l=ht}}e.l=c,e.p=tt,e.b=l,e.f=a,c&&(a=1,e.m=g,e.d=h,e.n=E)}while(!a);return l==t.length?t:ve(t,0,l)};var Co=new Q(0);var xo=function(n,t){var e={};for(var r in n)e[r]=n[r];for(var r in t)e[r]=t[r];return e},Ci=function(n,t,e){for(var r=n(),i=n.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<r.length;++o){var a=r[o],u=s[o];if(typeof a=="function"){t+=";"+u+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var c=l.indexOf(" ",8)+1;t+=l.slice(c,l.indexOf("(",c))}else{t+=l;for(var h in a.prototype)t+=";"+u+".prototype."+h+"="+a.prototype[h].toString()}else t+=l}else e[u]=a}return[t,e]},me=[],To=function(n){var t=[];for(var e in n)n[e].buffer&&t.push((n[e]=new n[e].constructor(n[e])).buffer);return t},So=function(n,t,e,r){var i;if(!me[e]){for(var s="",o={},a=n.length-1,u=0;u<a;++u)i=Ci(n[u],s,o),s=i[0],o=i[1];me[e]=Ci(n[a],s,o)}var l=xo({},me[e][1]);return _o(me[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",e,l,To(l),r)},Ro=function(){return[Q,bt,mn,yn,wn,pi,En,mi,wi,Ei,pe,_i,Bt,de,ot,ge,bi,ve,rt,Ai,_n,xi,Ti]};var xi=function(n){return postMessage(n,[n.buffer])},Ti=function(n){return n&&n.size&&new Q(n.size)},Oo=function(n,t,e,r,i,s){var o=So(e,r,i,function(a,u){o.terminate(),s(a,u)});return o.postMessage([n,t],t.consume?[n.buffer]:[]),function(){o.terminate()}};var vt=function(n,t){return n[t]|n[t+1]<<8},ut=function(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0},bn=function(n,t){return ut(n,t)+ut(n,t+4)*4294967296};function Lo(n,t,e){return e||(e=t,t={}),typeof e!="function"&&rt(7),Oo(n,t,[Ro],function(r){return xi(_n(r.data[0],Ti(r.data[1])))},1,e)}function _n(n,t){return Ai(n,t)}var Mu=typeof TextEncoder!="undefined"&&new TextEncoder,An=typeof TextDecoder!="undefined"&&new TextDecoder,No=0;try{An.decode(Co,{stream:!0}),No=1}catch(n){}var Mo=function(n){for(var t="",e=0;;){var r=n[e++],i=(r>127)+(r>223)+(r>239);if(e+i>n.length)return[t,ve(n,e-1)];i?i==3?(r=((r&15)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?t+=String.fromCharCode((r&31)<<6|n[e++]&63):t+=String.fromCharCode((r&15)<<12|(n[e++]&63)<<6|n[e++]&63):t+=String.fromCharCode(r)}};function Io(n,t){if(t){for(var e="",r=0;r<n.length;r+=16384)e+=String.fromCharCode.apply(null,n.subarray(r,r+16384));return e}else{if(An)return An.decode(n);var i=Mo(n),s=i[0],o=i[1];return o.length&&rt(8),s}}var Do=function(n,t){return t+30+vt(n,t+26)+vt(n,t+28)},ko=function(n,t,e){var r=vt(n,t+28),i=Io(n.subarray(t+46,t+46+r),!(vt(n,t+8)&2048)),s=t+46+r,o=ut(n,t+20),a=e&&o==4294967295?Bo(n,s):[o,ut(n,t+24),ut(n,t+42)],u=a[0],l=a[1],c=a[2];return[vt(n,t+10),u,l,i,s+vt(n,t+30)+vt(n,t+32),c]},Bo=function(n,t){for(;vt(n,t)!=1;t+=4+vt(n,t+2));return[bn(n,t+12),bn(n,t+4),bn(n,t+20)]};var Si=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(n){n()};function Ri(n,t,e){e||(e=t,t={}),typeof e!="function"&&rt(7);var r=[],i=function(){for(var C=0;C<r.length;++C)r[C]()},s={},o=function(C,O){Si(function(){e(C,O)})};Si(function(){o=e});for(var a=n.length-22;ut(n,a)!=101010256;--a)if(!a||n.length-a>65558)return o(rt(13,0,1),null),i;var u=vt(n,a+8);if(u){var l=u,c=ut(n,a+16),h=c==4294967295||l==65535;if(h){var g=ut(n,a-12);h=ut(n,g)==101075792,h&&(l=u=ut(n,g+32),c=ut(n,g+48))}for(var E=t&&t.filter,_=function(C){var O=ko(n,c,h),I=O[0],x=O[1],F=O[2],D=O[3],K=O[4],k=O[5],w=Do(n,k);c=K;var T=function(d,M){d?(i(),o(d,null)):(M&&(s[D]=M),--u||o(null,s))};if(!E||E({name:D,size:x,originalSize:F,compression:I}))if(!I)T(null,ve(n,w,w+x));else if(I==8){var H=n.subarray(w,w+x);if(x<32e4)try{T(null,_n(H,new Q(F)))}catch(d){T(d,null)}else r.push(Lo(H,{size:F},T))}else T(rt(14,"unknown compression type "+I,1),null);else T(null,null)},A=0;A<l;++A)_(A)}else o(null,{});return i}var zt=class{constructor(t){let e;typeof t=="object"&&t instanceof zt?e=t.source:e=String(t),this.source=e,this._re=(0,Oi.makeRe)(e)}test(t){return this._re.test(t)}},Po=/^([_\w\d]+)\:\/\//;async function Li(n,t,e,r,i,s){let{loadings:o}=n,a;t in o?a=o[t]:(a=new Pt(s),o[t]=a);let u=Pt.nextAttempt(a),l=[a.promise];return Po.test(e)?l.push(Ni(n,e,s).then(c=>r(c,i)).then(c=>Pt.isCurrentAttempt(a,u)?qt(n,t,c):void 0)):l.push(fetch(e).then(c=>c.arrayBuffer()).then(c=>r(c)).then(c=>Pt.isCurrentAttempt(a,u)?qt(n,t,c):void 0)),await Promise.race(l)}function qt(n,t,e){let{store:r,loadings:i}=n;return r[t]=e,t in i&&(i[t].resolve(e),delete i[t]),e}function Fo(n,t,e){let{defaults:r}=n;typeof t=="string"&&(t=new zt(t));let i=`__default://[${r.length}]`;return qt(n,i,e),r.push(new Di(t,i)),e}function Ho(n,t){let{store:e,loadings:r}=n;t in r&&(r[t].reject(new Error("Stop loading to delete asset.")),delete r[t]),t in e&&delete e[t]}function Uo(n,t){typeof t=="string"&&(t=new zt(t));let{store:e,loadings:r}=n;for(let[i,s]of Object.entries(r))t.test(i)&&(s.reject(new Error(`Stop loading to clear assets matching ${t}`)),delete r[i]);for(let i of Object.keys(e))t.test(i)&&delete e[i]}function Jo(n){let{store:t,loadings:e,defaults:r}=n;for(let[i,s]of Object.entries(e))s.reject(new Error("Stop loading to clear all assets.")),delete e[i];for(let i of Object.keys(t))delete t[i];r.length=0}function $o(n,t){let{loadings:e}=n;return t in e?e[t].promise:null}async function Ni(n,t,e){let{store:r,loadings:i}=n;if(t in r)return r[t];if(t in i)return i[t].promise;{let s=new Pt(e);return i[t]=s,s.promise}}function Ko(n,t){let{defaults:e}=n;for(let r of e)if(r.glob.test(t))return ye(n,r.uri);return null}function ye(n,t){return n.store[t]}function jo(n,t){return Boolean(n.store[t])}function Go(n){return Object.keys(n.store)}function Mi(n,t){return t in n.store}function Ii(n,t){return t in n.loadings}var Di=class{constructor(t,e){this.glob=t,this.uri=e}},Pt=class{static nextAttempt(t){return++t._promiseHandle}static isCurrentAttempt(t,e){return t._promiseHandle===e}constructor(t){this._promiseHandle=0,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(t)&&t>0?setTimeout(()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)},t):null,this._promise=new Promise((e,r)=>{this._value?e(this._value):this._resolve=e,this._reason?r(this._reason):this._reject=r})}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}},Cn=class{constructor(t=null){this.parent=t,this.store={},this.loadings={},this.defaults=[]}get(t){let e=this;if(Mi(e,t))return ye(e,t);let r=Ko(e,t);return r||null}async resolve(t,e,r,i,s){return this.get(t)||await this.load(t,e,r,i,s)}fallback(t,e){return Fo(this,t,e)}cache(t,e){return qt(this,t,e)}async load(t,e,r,i,s){let o=this;return Mi(o,t)?ye(o,t):Ii(o,t)?await Ni(o,t,s):await Li(o,t,e,r,i,s)}async reload(t,e,r,i,s){return await Li(this,t,e,r,i,s)}unload(t){Ho(this,t)}clear(t){Uo(this,t)}current(t){return ye(this,t)}exists(t){return jo(this,t)}loading(t){let e=this;return Ii(e,t)?$o(e,t):null}keys(){return Go(this)}reset(){Jo(this)}};async function ki(n,t,e=void 0){let r=n,i="raw://",o=await(await fetch(t)).arrayBuffer();await new Promise((a,u)=>{Ri(new Uint8Array(o),(l,c)=>{if(l)u(l);else{for(let[h,g]of Object.entries(c)){h=h.replaceAll("\\","/");let E=h.indexOf("/");E>=0&&(h=h.substring(E+1));let _=i+h;qt(r,_,g),e&&e(g,_,h)}a()}})})}window.addEventListener("DOMContentLoaded",Wo);async function Wo(){let n=document.querySelector("#display"),t=document.querySelector("#inputs").getContext("axisbutton"),e=new Cn;await ki(e,"res.pack"),await kr(n,t,e)}})();
//# sourceMappingURL=main.js.map
