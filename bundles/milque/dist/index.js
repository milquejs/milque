!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).milque={})}(this,(function(t){"use strict";function e(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return r.exec(t).slice(1)};function s(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var i=r>=0?arguments[r]:"/";if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(t=i+"/"+t,e="/"===i.charAt(0))}return(e?"/":"")+(t=n(p(t.split("/"),(function(t){return!!t})),!e).join("/"))||"."}function o(t){var e=a(t),r="/"===_(t,-1);return(t=n(p(t.split("/"),(function(t){return!!t})),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t}function a(t){return"/"===t.charAt(0)}function u(){var t=Array.prototype.slice.call(arguments,0);return o(p(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))}function l(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=s(t).substr(1),e=s(e).substr(1);for(var r=n(t.split("/")),i=n(e.split("/")),o=Math.min(r.length,i.length),a=o,u=0;u<o;u++)if(r[u]!==i[u]){a=u;break}var l=[];for(u=a;u<r.length;u++)l.push("..");return(l=l.concat(i.slice(a))).join("/")}function h(t){var e=i(t),n=e[0],r=e[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."}function c(t,e){var n=i(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n}function d(t){return i(t)[3]}var f={extname:d,basename:c,dirname:h,sep:"/",delimiter:":",relative:l,join:u,isAbsolute:a,normalize:o,resolve:s};function p(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}var _="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)},g=e(Object.freeze({__proto__:null,resolve:s,normalize:o,isAbsolute:a,join:u,relative:l,sep:"/",delimiter:":",dirname:h,basename:c,extname:d,default:f})),m={};const v=g,A="[^\\\\/]",E="\\.",b="\\/",y="[^/]",w="(?:\\/|$)",T="(?:^|\\/)",R="\\.{1,2}(?:\\/|$)",S={DOT_LITERAL:E,PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:b,ONE_CHAR:"(?=.)",QMARK:y,END_ANCHOR:w,DOTS_SLASH:R,NO_DOT:"(?!\\.)",NO_DOTS:`(?!(?:^|\\/)${R})`,NO_DOT_SLASH:"(?!\\.{0,1}(?:\\/|$))",NO_DOTS_SLASH:`(?!${R})`,QMARK_NO_DOT:"[^.\\/]",STAR:"[^/]*?",START_ANCHOR:T},x={...S,SLASH_LITERAL:"[\\\\/]",QMARK:A,STAR:"[^\\\\/]*?",DOTS_SLASH:"\\.{1,2}(?:[\\\\/]|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|[\\\\/])\\.{1,2}(?:[\\\\/]|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:[\\\\/]|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:[\\\\/]|$))",QMARK_NO_DOT:"[^.\\\\/]",START_ANCHOR:"(?:^|[\\\\/])",END_ANCHOR:"(?:[\\\\/]|$)"};var L={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:v.sep,extglobChars:t=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${t.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:t=>!0===t?x:S};!function(t){const e=g,n="win32"===process.platform,{REGEX_BACKSLASH:r,REGEX_REMOVE_BACKSLASH:i,REGEX_SPECIAL_CHARS:s,REGEX_SPECIAL_CHARS_GLOBAL:o}=L;t.isObject=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),t.hasRegexChars=t=>s.test(t),t.isRegexChar=e=>1===e.length&&t.hasRegexChars(e),t.escapeRegex=t=>t.replace(o,"\\$1"),t.toPosixSlashes=t=>t.replace(r,"/"),t.removeBackslashes=t=>t.replace(i,(t=>"\\"===t?"":t)),t.supportsLookbehinds=()=>{const t=process.version.slice(1).split(".").map(Number);return 3===t.length&&t[0]>=9||8===t[0]&&t[1]>=10},t.isWindows=t=>t&&"boolean"==typeof t.windows?t.windows:!0===n||"\\"===e.sep,t.escapeLast=(e,n,r)=>{const i=e.lastIndexOf(n,r);return-1===i?e:"\\"===e[i-1]?t.escapeLast(e,n,i-1):`${e.slice(0,i)}\\${e.slice(i)}`},t.removePrefix=(t,e={})=>{let n=t;return n.startsWith("./")&&(n=n.slice(2),e.prefix="./"),n},t.wrapOutput=(t,e={},n={})=>{let r=`${n.contains?"":"^"}(?:${t})${n.contains?"":"$"}`;return!0===e.negated&&(r=`(?:^(?!${r}).*$)`),r}}(m);const C=m,{CHAR_ASTERISK:O,CHAR_AT:I,CHAR_BACKWARD_SLASH:N,CHAR_COMMA:M,CHAR_DOT:B,CHAR_EXCLAMATION_MARK:D,CHAR_FORWARD_SLASH:F,CHAR_LEFT_CURLY_BRACE:P,CHAR_LEFT_PARENTHESES:U,CHAR_LEFT_SQUARE_BRACKET:H,CHAR_PLUS:k,CHAR_QUESTION_MARK:$,CHAR_RIGHT_CURLY_BRACE:K,CHAR_RIGHT_PARENTHESES:G,CHAR_RIGHT_SQUARE_BRACKET:V}=L,Y=t=>t===F||t===N,j=t=>{!0!==t.isPrefix&&(t.depth=t.isGlobstar?1/0:1)};var z=(t,e)=>{const n=e||{},r=t.length-1,i=!0===n.parts||!0===n.scanToEnd,s=[],o=[],a=[];let u,l,h=t,c=-1,d=0,f=0,p=!1,_=!1,g=!1,m=!1,v=!1,A=!1,E=!1,b=!1,y=!1,w=!1,T=0,R={value:"",depth:0,isGlob:!1};const S=()=>c>=r,x=()=>(u=l,h.charCodeAt(++c));for(;c<r;){let t;if(l=x(),l!==N){if(!0===A||l===P){for(T++;!0!==S()&&(l=x());)if(l!==N)if(l!==P){if(!0!==A&&l===B&&(l=x())===B){if(p=R.isBrace=!0,g=R.isGlob=!0,w=!0,!0===i)continue;break}if(!0!==A&&l===M){if(p=R.isBrace=!0,g=R.isGlob=!0,w=!0,!0===i)continue;break}if(l===K&&(T--,0===T)){A=!1,p=R.isBrace=!0,w=!0;break}}else T++;else E=R.backslashes=!0,x();if(!0===i)continue;break}if(l!==F){if(!0!==n.noext){if(!0===(l===k||l===I||l===O||l===$||l===D)&&h.charCodeAt(c+1)===U){if(g=R.isGlob=!0,m=R.isExtglob=!0,w=!0,l===D&&c===d&&(y=!0),!0===i){for(;!0!==S()&&(l=x());)if(l!==N){if(l===G){g=R.isGlob=!0,w=!0;break}}else E=R.backslashes=!0,l=x();continue}break}}if(l===O){if(u===O&&(v=R.isGlobstar=!0),g=R.isGlob=!0,w=!0,!0===i)continue;break}if(l===$){if(g=R.isGlob=!0,w=!0,!0===i)continue;break}if(l===H){for(;!0!==S()&&(t=x());)if(t!==N){if(t===V){_=R.isBracket=!0,g=R.isGlob=!0,w=!0;break}}else E=R.backslashes=!0,x();if(!0===i)continue;break}if(!0===n.nonegate||l!==D||c!==d){if(!0!==n.noparen&&l===U){if(g=R.isGlob=!0,!0===i){for(;!0!==S()&&(l=x());)if(l!==U){if(l===G){w=!0;break}}else E=R.backslashes=!0,l=x();continue}break}if(!0===g){if(w=!0,!0===i)continue;break}}else b=R.negated=!0,d++}else{if(s.push(c),o.push(R),R={value:"",depth:0,isGlob:!1},!0===w)continue;if(u===B&&c===d+1){d+=2;continue}f=c+1}}else E=R.backslashes=!0,l=x(),l===P&&(A=!0)}!0===n.noext&&(m=!1,g=!1);let L=h,z="",W="";d>0&&(z=h.slice(0,d),h=h.slice(d),f-=d),L&&!0===g&&f>0?(L=h.slice(0,f),W=h.slice(f)):!0===g?(L="",W=h):L=h,L&&""!==L&&"/"!==L&&L!==h&&Y(L.charCodeAt(L.length-1))&&(L=L.slice(0,-1)),!0===n.unescape&&(W&&(W=C.removeBackslashes(W)),L&&!0===E&&(L=C.removeBackslashes(L)));const q={prefix:z,input:t,start:d,base:L,glob:W,isBrace:p,isBracket:_,isGlob:g,isExtglob:m,isGlobstar:v,negated:b,negatedExtglob:y};if(!0===n.tokens&&(q.maxDepth=0,Y(l)||o.push(R),q.tokens=o),!0===n.parts||!0===n.tokens){let e;for(let r=0;r<s.length;r++){const i=e?e+1:d,u=s[r],l=t.slice(i,u);n.tokens&&(0===r&&0!==d?(o[r].isPrefix=!0,o[r].value=z):o[r].value=l,j(o[r]),q.maxDepth+=o[r].depth),0===r&&""===l||a.push(l),e=u}if(e&&e+1<t.length){const r=t.slice(e+1);a.push(r),n.tokens&&(o[o.length-1].value=r,j(o[o.length-1]),q.maxDepth+=o[o.length-1].depth)}q.slashes=s,q.parts=a}return q};const W=L,q=m,{MAX_LENGTH:X,POSIX_REGEX_SOURCE:Q,REGEX_NON_SPECIAL_CHARS:Z,REGEX_SPECIAL_CHARS_BACKREF:J,REPLACEMENTS:tt}=W,et=(t,e)=>{if("function"==typeof e.expandRange)return e.expandRange(...t,e);t.sort();const n=`[${t.join("-")}]`;try{new RegExp(n)}catch(e){return t.map((t=>q.escapeRegex(t))).join("..")}return n},nt=(t,e)=>`Missing ${t}: "${e}" - use "\\\\${e}" to match literal characters`,rt=(t,e)=>{if("string"!=typeof t)throw new TypeError("Expected a string");t=tt[t]||t;const n={...e},r="number"==typeof n.maxLength?Math.min(X,n.maxLength):X;let i=t.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);const s={type:"bos",value:"",output:n.prepend||""},o=[s],a=n.capture?"":"?:",u=q.isWindows(e),l=W.globChars(u),h=W.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:d,SLASH_LITERAL:f,ONE_CHAR:p,DOTS_SLASH:_,NO_DOT:g,NO_DOT_SLASH:m,NO_DOTS_SLASH:v,QMARK:A,QMARK_NO_DOT:E,STAR:b,START_ANCHOR:y}=l,w=t=>`(${a}(?:(?!${y}${t.dot?_:c}).)*?)`,T=n.dot?"":g,R=n.dot?A:E;let S=!0===n.bash?w(n):b;n.capture&&(S=`(${S})`),"boolean"==typeof n.noext&&(n.noextglob=n.noext);const x={input:t,index:-1,start:0,dot:!0===n.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};t=q.removePrefix(t,x),i=t.length;const L=[],C=[],O=[];let I,N=s;const M=()=>x.index===i-1,B=x.peek=(e=1)=>t[x.index+e],D=x.advance=()=>t[++x.index]||"",F=()=>t.slice(x.index+1),P=(t="",e=0)=>{x.consumed+=t,x.index+=e},U=t=>{x.output+=null!=t.output?t.output:t.value,P(t.value)},H=()=>{let t=1;for(;"!"===B()&&("("!==B(2)||"?"===B(3));)D(),x.start++,t++;return t%2!=0&&(x.negated=!0,x.start++,!0)},k=t=>{x[t]++,O.push(t)},$=t=>{x[t]--,O.pop()},K=t=>{if("globstar"===N.type){const e=x.braces>0&&("comma"===t.type||"brace"===t.type),n=!0===t.extglob||L.length&&("pipe"===t.type||"paren"===t.type);"slash"===t.type||"paren"===t.type||e||n||(x.output=x.output.slice(0,-N.output.length),N.type="star",N.value="*",N.output=S,x.output+=N.output)}if(L.length&&"paren"!==t.type&&(L[L.length-1].inner+=t.value),(t.value||t.output)&&U(t),N&&"text"===N.type&&"text"===t.type)return N.value+=t.value,void(N.output=(N.output||"")+t.value);t.prev=N,o.push(t),N=t},G=(t,e)=>{const r={...h[e],conditions:1,inner:""};r.prev=N,r.parens=x.parens,r.output=x.output;const i=(n.capture?"(":"")+r.open;k("parens"),K({type:t,value:e,output:x.output?"":p}),K({type:"paren",extglob:!0,value:D(),output:i}),L.push(r)},V=t=>{let e,r=t.close+(n.capture?")":"");if("negate"===t.type){let i=S;t.inner&&t.inner.length>1&&t.inner.includes("/")&&(i=w(n)),(i!==S||M()||/^\)+$/.test(F()))&&(r=t.close=`)$))${i}`),t.inner.includes("*")&&(e=F())&&/^\.[^\\/.]+$/.test(e)&&(r=t.close=`)${e})${i})`),"bos"===t.prev.type&&(x.negatedExtglob=!0)}K({type:"paren",extglob:!0,value:I,output:r}),$("parens")};if(!1!==n.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(t)){let r=!1,i=t.replace(J,((t,e,n,i,s,o)=>"\\"===i?(r=!0,t):"?"===i?e?e+i+(s?A.repeat(s.length):""):0===o?R+(s?A.repeat(s.length):""):A.repeat(n.length):"."===i?c.repeat(n.length):"*"===i?e?e+i+(s?S:""):S:e?t:`\\${t}`));return!0===r&&(i=!0===n.unescape?i.replace(/\\/g,""):i.replace(/\\+/g,(t=>t.length%2==0?"\\\\":t?"\\":""))),i===t&&!0===n.contains?(x.output=t,x):(x.output=q.wrapOutput(i,x,e),x)}for(;!M();){if(I=D(),"\0"===I)continue;if("\\"===I){const t=B();if("/"===t&&!0!==n.bash)continue;if("."===t||";"===t)continue;if(!t){I+="\\",K({type:"text",value:I});continue}const e=/^\\+/.exec(F());let r=0;if(e&&e[0].length>2&&(r=e[0].length,x.index+=r,r%2!=0&&(I+="\\")),!0===n.unescape?I=D():I+=D(),0===x.brackets){K({type:"text",value:I});continue}}if(x.brackets>0&&("]"!==I||"["===N.value||"[^"===N.value)){if(!1!==n.posix&&":"===I){const t=N.value.slice(1);if(t.includes("[")&&(N.posix=!0,t.includes(":"))){const t=N.value.lastIndexOf("["),e=N.value.slice(0,t),n=N.value.slice(t+2),r=Q[n];if(r){N.value=e+r,x.backtrack=!0,D(),s.output||1!==o.indexOf(N)||(s.output=p);continue}}}("["===I&&":"!==B()||"-"===I&&"]"===B())&&(I=`\\${I}`),"]"!==I||"["!==N.value&&"[^"!==N.value||(I=`\\${I}`),!0===n.posix&&"!"===I&&"["===N.value&&(I="^"),N.value+=I,U({value:I});continue}if(1===x.quotes&&'"'!==I){I=q.escapeRegex(I),N.value+=I,U({value:I});continue}if('"'===I){x.quotes=1===x.quotes?0:1,!0===n.keepQuotes&&K({type:"text",value:I});continue}if("("===I){k("parens"),K({type:"paren",value:I});continue}if(")"===I){if(0===x.parens&&!0===n.strictBrackets)throw new SyntaxError(nt("opening","("));const t=L[L.length-1];if(t&&x.parens===t.parens+1){V(L.pop());continue}K({type:"paren",value:I,output:x.parens?")":"\\)"}),$("parens");continue}if("["===I){if(!0!==n.nobracket&&F().includes("]"))k("brackets");else{if(!0!==n.nobracket&&!0===n.strictBrackets)throw new SyntaxError(nt("closing","]"));I=`\\${I}`}K({type:"bracket",value:I});continue}if("]"===I){if(!0===n.nobracket||N&&"bracket"===N.type&&1===N.value.length){K({type:"text",value:I,output:`\\${I}`});continue}if(0===x.brackets){if(!0===n.strictBrackets)throw new SyntaxError(nt("opening","["));K({type:"text",value:I,output:`\\${I}`});continue}$("brackets");const t=N.value.slice(1);if(!0===N.posix||"^"!==t[0]||t.includes("/")||(I=`/${I}`),N.value+=I,U({value:I}),!1===n.literalBrackets||q.hasRegexChars(t))continue;const e=q.escapeRegex(N.value);if(x.output=x.output.slice(0,-N.value.length),!0===n.literalBrackets){x.output+=e,N.value=e;continue}N.value=`(${a}${e}|${N.value})`,x.output+=N.value;continue}if("{"===I&&!0!==n.nobrace){k("braces");const t={type:"brace",value:I,output:"(",outputIndex:x.output.length,tokensIndex:x.tokens.length};C.push(t),K(t);continue}if("}"===I){const t=C[C.length-1];if(!0===n.nobrace||!t){K({type:"text",value:I,output:I});continue}let e=")";if(!0===t.dots){const t=o.slice(),r=[];for(let e=t.length-1;e>=0&&(o.pop(),"brace"!==t[e].type);e--)"dots"!==t[e].type&&r.unshift(t[e].value);e=et(r,n),x.backtrack=!0}if(!0!==t.comma&&!0!==t.dots){const n=x.output.slice(0,t.outputIndex),r=x.tokens.slice(t.tokensIndex);t.value=t.output="\\{",I=e="\\}",x.output=n;for(const t of r)x.output+=t.output||t.value}K({type:"brace",value:I,output:e}),$("braces"),C.pop();continue}if("|"===I){L.length>0&&L[L.length-1].conditions++,K({type:"text",value:I});continue}if(","===I){let t=I;const e=C[C.length-1];e&&"braces"===O[O.length-1]&&(e.comma=!0,t="|"),K({type:"comma",value:I,output:t});continue}if("/"===I){if("dot"===N.type&&x.index===x.start+1){x.start=x.index+1,x.consumed="",x.output="",o.pop(),N=s;continue}K({type:"slash",value:I,output:f});continue}if("."===I){if(x.braces>0&&"dot"===N.type){"."===N.value&&(N.output=c);const t=C[C.length-1];N.type="dots",N.output+=I,N.value+=I,t.dots=!0;continue}if(x.braces+x.parens===0&&"bos"!==N.type&&"slash"!==N.type){K({type:"text",value:I,output:c});continue}K({type:"dot",value:I,output:c});continue}if("?"===I){if(!(N&&"("===N.value)&&!0!==n.noextglob&&"("===B()&&"?"!==B(2)){G("qmark",I);continue}if(N&&"paren"===N.type){const t=B();let e=I;if("<"===t&&!q.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");("("===N.value&&!/[!=<:]/.test(t)||"<"===t&&!/<([!=]|\w+>)/.test(F()))&&(e=`\\${I}`),K({type:"text",value:I,output:e});continue}if(!0!==n.dot&&("slash"===N.type||"bos"===N.type)){K({type:"qmark",value:I,output:E});continue}K({type:"qmark",value:I,output:A});continue}if("!"===I){if(!0!==n.noextglob&&"("===B()&&("?"!==B(2)||!/[!=<:]/.test(B(3)))){G("negate",I);continue}if(!0!==n.nonegate&&0===x.index){H();continue}}if("+"===I){if(!0!==n.noextglob&&"("===B()&&"?"!==B(2)){G("plus",I);continue}if(N&&"("===N.value||!1===n.regex){K({type:"plus",value:I,output:d});continue}if(N&&("bracket"===N.type||"paren"===N.type||"brace"===N.type)||x.parens>0){K({type:"plus",value:I});continue}K({type:"plus",value:d});continue}if("@"===I){if(!0!==n.noextglob&&"("===B()&&"?"!==B(2)){K({type:"at",extglob:!0,value:I,output:""});continue}K({type:"text",value:I});continue}if("*"!==I){"$"!==I&&"^"!==I||(I=`\\${I}`);const t=Z.exec(F());t&&(I+=t[0],x.index+=t[0].length),K({type:"text",value:I});continue}if(N&&("globstar"===N.type||!0===N.star)){N.type="star",N.star=!0,N.value+=I,N.output=S,x.backtrack=!0,x.globstar=!0,P(I);continue}let e=F();if(!0!==n.noextglob&&/^\([^?]/.test(e)){G("star",I);continue}if("star"===N.type){if(!0===n.noglobstar){P(I);continue}const r=N.prev,i=r.prev,s="slash"===r.type||"bos"===r.type,o=i&&("star"===i.type||"globstar"===i.type);if(!0===n.bash&&(!s||e[0]&&"/"!==e[0])){K({type:"star",value:I,output:""});continue}const a=x.braces>0&&("comma"===r.type||"brace"===r.type),u=L.length&&("pipe"===r.type||"paren"===r.type);if(!s&&"paren"!==r.type&&!a&&!u){K({type:"star",value:I,output:""});continue}for(;"/**"===e.slice(0,3);){const n=t[x.index+4];if(n&&"/"!==n)break;e=e.slice(3),P("/**",3)}if("bos"===r.type&&M()){N.type="globstar",N.value+=I,N.output=w(n),x.output=N.output,x.globstar=!0,P(I);continue}if("slash"===r.type&&"bos"!==r.prev.type&&!o&&M()){x.output=x.output.slice(0,-(r.output+N.output).length),r.output=`(?:${r.output}`,N.type="globstar",N.output=w(n)+(n.strictSlashes?")":"|$)"),N.value+=I,x.globstar=!0,x.output+=r.output+N.output,P(I);continue}if("slash"===r.type&&"bos"!==r.prev.type&&"/"===e[0]){const t=void 0!==e[1]?"|$":"";x.output=x.output.slice(0,-(r.output+N.output).length),r.output=`(?:${r.output}`,N.type="globstar",N.output=`${w(n)}${f}|${f}${t})`,N.value+=I,x.output+=r.output+N.output,x.globstar=!0,P(I+D()),K({type:"slash",value:"/",output:""});continue}if("bos"===r.type&&"/"===e[0]){N.type="globstar",N.value+=I,N.output=`(?:^|${f}|${w(n)}${f})`,x.output=N.output,x.globstar=!0,P(I+D()),K({type:"slash",value:"/",output:""});continue}x.output=x.output.slice(0,-N.output.length),N.type="globstar",N.output=w(n),N.value+=I,x.output+=N.output,x.globstar=!0,P(I);continue}const r={type:"star",value:I,output:S};!0!==n.bash?!N||"bracket"!==N.type&&"paren"!==N.type||!0!==n.regex?(x.index!==x.start&&"slash"!==N.type&&"dot"!==N.type||("dot"===N.type?(x.output+=m,N.output+=m):!0===n.dot?(x.output+=v,N.output+=v):(x.output+=T,N.output+=T),"*"!==B()&&(x.output+=p,N.output+=p)),K(r)):(r.output=I,K(r)):(r.output=".*?","bos"!==N.type&&"slash"!==N.type||(r.output=T+r.output),K(r))}for(;x.brackets>0;){if(!0===n.strictBrackets)throw new SyntaxError(nt("closing","]"));x.output=q.escapeLast(x.output,"["),$("brackets")}for(;x.parens>0;){if(!0===n.strictBrackets)throw new SyntaxError(nt("closing",")"));x.output=q.escapeLast(x.output,"("),$("parens")}for(;x.braces>0;){if(!0===n.strictBrackets)throw new SyntaxError(nt("closing","}"));x.output=q.escapeLast(x.output,"{"),$("braces")}if(!0===n.strictSlashes||"star"!==N.type&&"bracket"!==N.type||K({type:"maybe_slash",value:"",output:`${f}?`}),!0===x.backtrack){x.output="";for(const t of x.tokens)x.output+=null!=t.output?t.output:t.value,t.suffix&&(x.output+=t.suffix)}return x};rt.fastpaths=(t,e)=>{const n={...e},r="number"==typeof n.maxLength?Math.min(X,n.maxLength):X,i=t.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);t=tt[t]||t;const s=q.isWindows(e),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:u,DOTS_SLASH:l,NO_DOT:h,NO_DOTS:c,NO_DOTS_SLASH:d,STAR:f,START_ANCHOR:p}=W.globChars(s),_=n.dot?c:h,g=n.dot?d:h,m=n.capture?"":"?:";let v=!0===n.bash?".*?":f;n.capture&&(v=`(${v})`);const A=t=>!0===t.noglobstar?v:`(${m}(?:(?!${p}${t.dot?l:o}).)*?)`,E=t=>{switch(t){case"*":return`${_}${u}${v}`;case".*":return`${o}${u}${v}`;case"*.*":return`${_}${v}${o}${u}${v}`;case"*/*":return`${_}${v}${a}${u}${g}${v}`;case"**":return _+A(n);case"**/*":return`(?:${_}${A(n)}${a})?${g}${u}${v}`;case"**/*.*":return`(?:${_}${A(n)}${a})?${g}${v}${o}${u}${v}`;case"**/.*":return`(?:${_}${A(n)}${a})?${o}${u}${v}`;default:{const e=/^(.*?)\.(\w+)$/.exec(t);if(!e)return;const n=E(e[1]);if(!n)return;return n+o+e[2]}}},b=q.removePrefix(t,{negated:!1,prefix:""});let y=E(b);return y&&!0!==n.strictSlashes&&(y+=`${a}?`),y};const it=g,st=z,ot=rt,at=m,ut=L,lt=(t,e,n=!1)=>{if(Array.isArray(t)){const r=t.map((t=>lt(t,e,n)));return t=>{for(const e of r){const n=e(t);if(n)return n}return!1}}const r=(i=t)&&"object"==typeof i&&!Array.isArray(i)&&t.tokens&&t.input;var i;if(""===t||"string"!=typeof t&&!r)throw new TypeError("Expected pattern to be a non-empty string");const s=e||{},o=at.isWindows(e),a=r?lt.compileRe(t,e):lt.makeRe(t,e,!1,!0),u=a.state;delete a.state;let l=()=>!1;if(s.ignore){const t={...e,ignore:null,onMatch:null,onResult:null};l=lt(s.ignore,t,n)}const h=(n,r=!1)=>{const{isMatch:i,match:h,output:c}=lt.test(n,a,e,{glob:t,posix:o}),d={glob:t,state:u,regex:a,posix:o,input:n,output:c,match:h,isMatch:i};return"function"==typeof s.onResult&&s.onResult(d),!1===i?(d.isMatch=!1,!!r&&d):l(n)?("function"==typeof s.onIgnore&&s.onIgnore(d),d.isMatch=!1,!!r&&d):("function"==typeof s.onMatch&&s.onMatch(d),!r||d)};return n&&(h.state=u),h};lt.test=(t,e,n,{glob:r,posix:i}={})=>{if("string"!=typeof t)throw new TypeError("Expected input to be a string");if(""===t)return{isMatch:!1,output:""};const s=n||{},o=s.format||(i?at.toPosixSlashes:null);let a=t===r,u=a&&o?o(t):t;return!1===a&&(u=o?o(t):t,a=u===r),!1!==a&&!0!==s.capture||(a=!0===s.matchBase||!0===s.basename?lt.matchBase(t,e,n,i):e.exec(u)),{isMatch:Boolean(a),match:a,output:u}},lt.matchBase=(t,e,n,r=at.isWindows(n))=>(e instanceof RegExp?e:lt.makeRe(e,n)).test(it.basename(t)),lt.isMatch=(t,e,n)=>lt(e,n)(t),lt.parse=(t,e)=>Array.isArray(t)?t.map((t=>lt.parse(t,e))):ot(t,{...e,fastpaths:!1}),lt.scan=(t,e)=>st(t,e),lt.compileRe=(t,e,n=!1,r=!1)=>{if(!0===n)return t.output;const i=e||{},s=i.contains?"":"^",o=i.contains?"":"$";let a=`${s}(?:${t.output})${o}`;t&&!0===t.negated&&(a=`^(?!${a}).*$`);const u=lt.toRegex(a,e);return!0===r&&(u.state=t),u},lt.makeRe=(t,e={},n=!1,r=!1)=>{if(!t||"string"!=typeof t)throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return!1===e.fastpaths||"."!==t[0]&&"*"!==t[0]||(i.output=ot.fastpaths(t,e)),i.output||(i=ot(t,e)),lt.compileRe(i,e,n,r)},lt.toRegex=(t,e)=>{try{const n=e||{};return new RegExp(t,n.flags||(n.nocase?"i":""))}catch(t){if(e&&!0===e.debug)throw t;return/$^/}},lt.constants=ut;var ht=lt,ct={},dt=Uint8Array,ft=Uint16Array,pt=Uint32Array,_t=new dt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gt=new dt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),mt=new dt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vt=function(t,e){for(var n=new ft(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new pt(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},At=vt(_t,2),Et=At[0],bt=At[1];Et[28]=258,bt[258]=28;for(var yt=vt(gt,0)[0],wt=new ft(32768),Tt=0;Tt<32768;++Tt){var Rt=(43690&Tt)>>>1|(21845&Tt)<<1;Rt=(61680&(Rt=(52428&Rt)>>>2|(13107&Rt)<<2))>>>4|(3855&Rt)<<4,wt[Tt]=((65280&Rt)>>>8|(255&Rt)<<8)>>>1}var St=function(t,e,n){for(var r=t.length,i=0,s=new ft(e);i<r;++i)++s[t[i]-1];var o,a=new ft(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;if(n){o=new ft(1<<e);var u=15-e;for(i=0;i<r;++i)if(t[i])for(var l=i<<4|t[i],h=e-t[i],c=a[t[i]-1]++<<h,d=c|(1<<h)-1;c<=d;++c)o[wt[c]>>>u]=l}else for(o=new ft(r),i=0;i<r;++i)t[i]&&(o[i]=wt[a[t[i]-1]++]>>>15-t[i]);return o},xt=new dt(288);for(Tt=0;Tt<144;++Tt)xt[Tt]=8;for(Tt=144;Tt<256;++Tt)xt[Tt]=9;for(Tt=256;Tt<280;++Tt)xt[Tt]=7;for(Tt=280;Tt<288;++Tt)xt[Tt]=8;var Lt=new dt(32);for(Tt=0;Tt<32;++Tt)Lt[Tt]=5;var Ct=St(xt,9,1),Ot=St(Lt,5,1),It=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Nt=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},Mt=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},Bt=function(t){return(t/8|0)+(7&t&&1)},Dt=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var r=new(t instanceof ft?ft:t instanceof pt?pt:dt)(n-e);return r.set(t.subarray(e,n)),r},Ft=function(t,e,n){var r=t.length;if(!r||n&&!n.l&&r<5)return e||new dt(0);var i=!e||n,s=!n||n.i;n||(n={}),e||(e=new dt(3*r));var o=function(t){var n=e.length;if(t>n){var r=new dt(Math.max(2*n,t));r.set(e),e=r}},a=n.f||0,u=n.p||0,l=n.b||0,h=n.l,c=n.d,d=n.m,f=n.n,p=8*r;do{if(!h){n.f=a=Nt(t,u,1);var _=Nt(t,u+1,3);if(u+=3,!_){var g=t[(x=Bt(u)+4)-4]|t[x-3]<<8,m=x+g;if(m>r){if(s)throw"unexpected EOF";break}i&&o(l+g),e.set(t.subarray(x,m),l),n.b=l+=g,n.p=u=8*m;continue}if(1==_)h=Ct,c=Ot,d=9,f=5;else{if(2!=_)throw"invalid block type";var v=Nt(t,u,31)+257,A=Nt(t,u+10,15)+4,E=v+Nt(t,u+5,31)+1;u+=14;for(var b=new dt(E),y=new dt(19),w=0;w<A;++w)y[mt[w]]=Nt(t,u+3*w,7);u+=3*A;var T=It(y),R=(1<<T)-1,S=St(y,T,1);for(w=0;w<E;){var x,L=S[Nt(t,u,R)];if(u+=15&L,(x=L>>>4)<16)b[w++]=x;else{var C=0,O=0;for(16==x?(O=3+Nt(t,u,3),u+=2,C=b[w-1]):17==x?(O=3+Nt(t,u,7),u+=3):18==x&&(O=11+Nt(t,u,127),u+=7);O--;)b[w++]=C}}var I=b.subarray(0,v),N=b.subarray(v);d=It(I),f=It(N),h=St(I,d,1),c=St(N,f,1)}if(u>p){if(s)throw"unexpected EOF";break}}i&&o(l+131072);for(var M=(1<<d)-1,B=(1<<f)-1,D=u;;D=u){var F=(C=h[Mt(t,u)&M])>>>4;if((u+=15&C)>p){if(s)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(F<256)e[l++]=F;else{if(256==F){D=u,h=null;break}var P=F-254;if(F>264){var U=_t[w=F-257];P=Nt(t,u,(1<<U)-1)+Et[w],u+=U}var H=c[Mt(t,u)&B],k=H>>>4;if(!H)throw"invalid distance";u+=15&H;N=yt[k];if(k>3){U=gt[k];N+=Mt(t,u)&(1<<U)-1,u+=U}if(u>p){if(s)throw"unexpected EOF";break}i&&o(l+131072);for(var $=l+P;l<$;l+=4)e[l]=e[l-N],e[l+1]=e[l+1-N],e[l+2]=e[l+2-N],e[l+3]=e[l+3-N];l=$}}n.l=h,n.p=D,n.b=l,h&&(a=1,n.m=d,n.d=c,n.n=f)}while(!a);return l==e.length?e:Dt(e,0,l)},Pt=new dt(0),Ut=function(t,e,n){for(var r=t(),i=t.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<r.length;++o){var a=r[o],u=s[o];if("function"==typeof a){e+=";"+u+"=";var l=a.toString();if(a.prototype)if(-1!=l.indexOf("[native code]")){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else for(var c in e+=l,a.prototype)e+=";"+u+".prototype."+c+"="+a.prototype[c].toString();else e+=l}else n[u]=a}return[e,n]},Ht=[],kt=function(t,e,n,r){var i;if(!Ht[n]){for(var s="",o={},a=t.length-1,u=0;u<a;++u)s=(i=Ut(t[u],s,o))[0],o=i[1];Ht[n]=Ut(t[a],s,o)}var l=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}({},Ht[n][1]);return function(t,e,n,r,i){var s=new Worker(ct[e]||(ct[e]=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))));return s.onerror=function(t){return i(t.error,null)},s.onmessage=function(t){return i(null,t.data)},s.postMessage(n,r),s}(Ht[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",n,l,function(t){var e=[];for(var n in t)(t[n]instanceof dt||t[n]instanceof ft||t[n]instanceof pt)&&e.push((t[n]=new t[n].constructor(t[n])).buffer);return e}(l),r)},$t=function(){return[dt,ft,pt,_t,gt,mt,Et,yt,Ct,Ot,wt,St,It,Nt,Mt,Bt,Dt,Ft,Wt,Kt,Gt]},Kt=function(t){return postMessage(t,[t.buffer])},Gt=function(t){return t&&t.size&&new dt(t.size)},Vt=function(t,e){return t[e]|t[e+1]<<8},Yt=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},jt=function(t,e){return Yt(t,e)+4294967296*Yt(t,e+4)};function zt(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return function(t,e,n,r,i,s){var o=kt(n,r,i,(function(t,e){o.terminate(),s(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}}(t,e,[$t],(function(t){return Kt(Wt(t.data[0],Gt(t.data[1])))}),1,n)}function Wt(t,e){return Ft(t,e)}var qt="undefined"!=typeof TextDecoder&&new TextDecoder;try{qt.decode(Pt,{stream:!0}),1}catch(t){}function Xt(t,e){if(e){for(var n="",r=0;r<t.length;r+=16384)n+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return n}if(qt)return qt.decode(t);var i=function(t){for(var e="",n=0;;){var r=t[n++],i=(r>127)+(r>223)+(r>239);if(n+i>t.length)return[e,Dt(t,n-1)];i?3==i?(r=((15&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|r>>10,56320|1023&r)):e+=1&i?String.fromCharCode((31&r)<<6|63&t[n++]):String.fromCharCode((15&r)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(r)}}(t),s=i[0];if(i[1].length)throw"invalid utf-8 data";return s}var Qt=function(t,e){for(;1!=Vt(t,e);e+=4+Vt(t,e+2));return[jt(t,e+12),jt(t,e+4),jt(t,e+20)]};function Zt(t,e){if("function"!=typeof e)throw"no callback";for(var n=[],r=function(){for(var t=0;t<n.length;++t)n[t]()},i={},s=t.length-22;101010256!=Yt(t,s);--s)if(!s||t.length-s>65558)return void e("invalid zip file",null);var o=Vt(t,s+8);o||e(null,{});var a=o,u=Yt(t,s+16),l=4294967295==u;if(l){if(s=Yt(t,s-12),101075792!=Yt(t,s))return void e("invalid zip file",null);a=o=Yt(t,s+32),u=Yt(t,s+48)}for(var h=function(s){var a=function(t,e,n){var r=Vt(t,e+28),i=Xt(t.subarray(e+46,e+46+r),!(2048&Vt(t,e+8))),s=e+46+r,o=Yt(t,e+20),a=n&&4294967295==o?Qt(t,s):[o,Yt(t,e+24),Yt(t,e+42)],u=a[0],l=a[1],h=a[2];return[Vt(t,e+10),u,l,i,s+Vt(t,e+30)+Vt(t,e+32),h]}(t,u,l),h=a[0],c=a[1],d=a[2],f=a[3],p=a[4],_=a[5],g=function(t,e){return e+30+Vt(t,e+26)+Vt(t,e+28)}(t,_);u=p;var m=function(t,n){t?(r(),e(t,null)):(i[f]=n,--o||e(null,i))};if(h)if(8==h){var v=t.subarray(g,g+c);if(c<32e4)try{m(null,Wt(v,new dt(d)))}catch(t){m(t,null)}else n.push(zt(v,{size:d},m))}else m("unknown compression type "+h,null);else m(null,Dt(t,g,g+c))},c=0;c<a;++c)h();return r}class Jt{constructor(t){let e;e="object"==typeof t&&t instanceof Jt?t.source:String(t),this.source=e,this._re=ht.makeRe(e)}test(t){return this._re.test(t)}}const te=/^([_\w\d]+)\:\/\//;function ee(t,e,n){const{cache:r,loadings:i}=t;return r[e]=n,e in i&&(i[e].resolve(n),delete i[e]),n}async function ne(t,e,n=5e3){const{cache:r,loadings:i}=t;if(e in r)return r[e];if(e in i)return i[e].promise;{let t=new ie(n);return i[e]=t,t.promise}}function re(t,e){return t.cache[e]}class ie{constructor(t){this.active=!1,this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=Number.isFinite(t)&&t>0?setTimeout((()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)}),t):null,this._promise=new Promise(((t,e)=>{this._value?t(this._value):this._resolve=t,this._reason?e(this._reason):this._reject=e}))}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}}const se={cache:{},loadings:{},defaults:[]};function oe(t){return re(se,t)}var ae=Object.freeze({__proto__:null,loadAssetPackAsRaw:async function(t,e){let n=await fetch(t),r=await n.arrayBuffer();await new Promise(((t,n)=>{Zt(new Uint8Array(r),((r,i)=>{if(r)n(r);else{for(let[t,n]of Object.entries(i)){t=t.replaceAll("\\","/");let r=t.indexOf("/");r>=0&&(t=t.substring(r+1));let i="raw://"+t;ee(se,i,n),e&&e(n,i,t)}t()}}))}))},loadAssetPack:async function(t,e){let n=await fetch(t),r=await n.arrayBuffer();await new Promise(((t,n)=>{Zt(new Uint8Array(r),((r,i)=>{if(r)n(r);else{for(let[t,n]of Object.entries(i))t=t.replaceAll("\\","/"),e(n,t);t()}}))}))},loadAssetRefs:async function(t,e=5e3){let n=[];for(let r of t)n.push(r.preload(se,e));await Promise.allSettled(n)},cache:function(t,e){return ee(se,t,e)},keys:function(){return t=se,Object.keys(t.cache);var t},current:oe,get:function(t){return oe(t)}}),ue=Object.freeze({__proto__:null,AssetManager:ae,AssetRef:class{constructor(t,e,n){this.uri=t,this.source=e,this.loader=n,this.store=null}get current(){return re(this.store,this.uri)}set current(t){ee(this.store,this.uri,t)}get default(){return function(t,e){const{defaults:n}=t;for(let r of n)if(r.glob.test(e))return re(t,r.uri);return null}(this.store,this.uri)}get loaded(){return ne(this.store,this.uri)}async preload(t,e,n){return this.store=t,void 0!==n?ee(t,this.uri,n):await async function(t,e,n,r,i=5e3){const{cache:s,loadings:o}=t;if(e in s)return s[e];let a;if(e in o){if(a=o[e],a.active)return o[e].promise}else a=new ie(i),o[e]=a;let u=[a.promise];return te.test(n)?u.push(ne(t,n,i).then((t=>r(t))).then((n=>ee(t,e,n)))):u.push(fetch(n).then((t=>t.arrayBuffer())).then((t=>r(t))).then((n=>ee(t,e,n)))),await Promise.race(u)}(this.store,this.uri,this.source,this.loader,e),this}async unload(){return function(t,e){const{cache:n,loadings:r}=t;e in r&&(r[e].reject(new Error("Stop loading to delete asset.")),delete r[e]),e in n&&delete n[e]}(this.store,this.uri),this.store=null,this}},GlobExp:Jt});const le="noscale",he="fit",ce="scale",de="fill",fe="stretch";class pe extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<div class="container">\n  <label class="hidden" id="title">display-port</label>\n  <label class="hidden" id="fps">00</label>\n  <label class="hidden" id="dimension">0x0</label>\n  <div class="content">\n    <canvas> Oh no! Your browser does not support canvas. </canvas>\n    <slot id="inner"></slot>\n  </div>\n  <slot name="frame"></slot>\n</div>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=":host {\n  display: inline-block;\n  color: #555555;\n}\n\n.container {\n  display: flex;\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.content {\n  position: relative;\n  margin: auto;\n}\n\n.content > *:not(canvas) {\n  width: 100%;\n  height: 100%;\n}\n\ncanvas {\n  background: #000000;\n  image-rendering: pixelated;\n}\n\nlabel {\n  position: absolute;\n  font-family: monospace;\n  color: currentColor;\n}\n\n#inner {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n}\n\n#title {\n  left: 0.5rem;\n  top: 0.5rem;\n}\n\n#fps {\n  right: 0.5rem;\n  top: 0.5rem;\n}\n\n#dimension {\n  left: 0.5rem;\n  bottom: 0.5rem;\n}\n\n.hidden {\n  display: none;\n}\n\n:host([debug]) .container {\n  outline: 6px dashed rgba(0, 0, 0, 0.1);\n  outline-offset: -4px;\n  background-color: rgba(0, 0, 0, 0.1);\n}\n\n:host([mode='noscale']) canvas {\n  margin: 0;\n  top: 0;\n  left: 0;\n}\n\n:host([mode='stretch']) canvas,\n:host([mode='scale']) canvas {\n  width: 100%;\n  height: 100%;\n}\n\n:host([mode='fit']),\n:host([mode='scale']),\n:host([mode='center']),\n:host([mode='stretch']),\n:host([mode='fill']) {\n  width: 100%;\n  height: 100%;\n}\n\n:host([full]) {\n  width: 100vw !important;\n  height: 100vh !important;\n}\n\n:host([disabled]) {\n  display: none;\n}\n\nslot {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n}\n\n::slotted(*) {\n  pointer-events: auto;\n}\n",Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super();const t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=t.querySelector("canvas"),this._contentElement=t.querySelector(".content"),this._innerElement=t.querySelector("#inner"),this._titleElement=t.querySelector("#title"),this._fpsElement=t.querySelector("#fps"),this._dimensionElement=t.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=300,this._height=150,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this._frameEvent=new CustomEvent("frame",{composed:!0,bubbles:!1,detail:{now:0,prevTime:0,deltaTime:0,canvas:this._canvasElement}}),this._resizeEvent=new CustomEvent("resize",{composed:!0,bubbles:!1,detail:{width:0,height:0}}),this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){_e(this,"mode"),_e(this,"debug"),_e(this,"disabled"),_e(this,"width"),_e(this,"height"),_e(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,n){switch(t){case"debug":this._debug=null!==n;break;case"disabled":this._disabled=null!==n;break;case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this)}switch(t){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}getContext(t="2d",e){return this._canvasElement.getContext(t,e)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);const e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){const t=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");this._fpsElement.textContent!==t&&(this._fpsElement.textContent=t);if(this.mode===le){let t=`${this._width}x${this._height}`;this._dimensionElement.textContent!==t&&(this._dimensionElement.textContent=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==t&&(this._dimensionElement.textContent=t)}}let n=this._frameEvent.detail;n.now=t,n.prevTime=this._prevAnimationFrameTime,n.deltaTime=e,this.dispatchEvent(this._frameEvent)}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(t,e){t===this._resizeCanvasWidth&&e===this._resizeCanvasHeight||(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,200))}updateCanvasSize(t=!0){const e=this.shadowRoot.host.getBoundingClientRect(),n=e.width,r=e.height;let i=this._canvasElement,s=this._width,o=this._height;const a=this.mode;if(a===fe||a===de)s=n,o=r;else if(a!==le&&(n<s||r<o||a===he||a==ce)){let t=n/s,e=r/o;t<e?(s=n,o*=t):(s*=e,o=r)}if(s=Math.floor(s),o=Math.floor(o),void 0===t&&(t=i.clientWidth!==s||i.clientHeight!==o),!t)return void this.delayCanvasResize(s,o);let u=.5*Math.min(s/this._width,o/this._height);if(this._innerElement.style.fontSize=`font-size: ${u}em`,t){a===ce?(i.width=this._width,i.height=this._height):a!==fe&&(i.width=s,i.height=o);let t=this._contentElement.style;t.width=`${s}px`,t.height=`${o}px`,a!==he&&a!==de||(this._width=s,this._height=o);let e=this._resizeEvent.detail;e.width=s,e.height=o,this.dispatchEvent(this._resizeEvent)}}}function _e(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let n=t[e];delete t[e],t[e]=n}}pe.define();var ge=Object.freeze({__proto__:null,DisplayPort:pe});class me{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,n){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e={}){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}}class ve extends me{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array;for(let n=0;n<t;++n)e.push(this.constructor.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e,n=this._state,r=n.length;if(t<=r)e=n.slice(0,t);else{e=n;for(let n=r;n<t;++n)e.push(this.constructor.createAxisBindingState())}this._state=e,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,n=0,r=0;const i=e.length;for(let t=0;t<i;++t){let i=e[t];n+=i.value*(i.inverted?-1:1),r+=i.delta,e[t].delta=0}this._value=n,this._delta=r,super.onPoll(t)}onUpdate(t,e,n){void 0===e?this.onAxisChange(t,n):this.onAxisMove(t,e,n)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e={}){super.onBind(t,e);const{inverted:n=!1}=e;this._state[t].inverted=n}onAxisMove(t,e,n){let r=this._state[t];r.value=e,r.delta+=n}onAxisChange(t,e){let n=this._state[t];n.value+=e,n.delta+=e}onAxisStatus(t,e){let n=this._state[t],r=n.value;n.value=e,n.delta=e-r}}class Ae extends me{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t),this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e,n=this._state;t<=n.length?e=n.slice(0,t):(e=new Uint8Array(t),e.set(n)),this._state=e,super.resize(t)}getState(t){let e=this._state[t];return(1&e?1:0)*(16&e?-1:1)}onPoll(t){let e=this._state,n=0,r=0,i=0,s=0,o=0;const a=e.length;for(let t=0;t<a;++t){let a=e[t],u=1&a;r|=u,i|=2&a,s|=4&a,o|=8&a,n+=(u?1:0)*(16&a?-1:1),e[t]&=241}this._value=n,this._down=0!==r,this._pressed=0!==i,this._repeated=0!==s,this._released=0!==o,super.onPoll(t)}onUpdate(t,e,n){n>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,0!==e)}onBind(t,e={}){super.onBind(t,e);const{inverted:n=!1}=e;let r=this._state;n?r[t]|=16:r[t]&=239}onButtonPressed(t){let e=this._state,n=e[t];1&n||(n|=2,n|=1),n|=4,e[t]=n}onButtonReleased(t){let e=this._state,n=e[t];1&n&&(n|=8,n&=254),e[t]=n}onButtonStatus(t,e){let n=this._state,r=n[t],i=Boolean(1&r);e?r|=1:r&=254,i&&!e&&(r|=8),!i&&e&&(r|=2,r|=4),n[t]=r}}class Ee{static parse(t){let e=(t=t.trim()).indexOf(".");if(e<0)throw new Error("Missing device separator for key code.");let n=t.substring(0,e);if(n.length<0)throw new Error("Missing device for key code.");let r=t.substring(e+1);if(r.length<0)throw new Error("Missing code for key code.");return new Ee(n,r)}constructor(t,e){this.device=t,this.code=e}toString(){return`${this.device}.${this.code}`}}function be(t,e){return new Ee(t,e)}const ye="Keyboard",we="Mouse",Te=new Ee(ye,"KeyA"),Re=new Ee(ye,"KeyB"),Se=new Ee(ye,"KeyC"),xe=new Ee(ye,"KeyD"),Le=new Ee(ye,"KeyE"),Ce=new Ee(ye,"KeyF"),Oe=new Ee(ye,"KeyG"),Ie=new Ee(ye,"KeyH"),Ne=new Ee(ye,"KeyI"),Me=new Ee(ye,"KeyJ"),Be=new Ee(ye,"KeyK"),De=new Ee(ye,"KeyL"),Fe=new Ee(ye,"KeyM"),Pe=new Ee(ye,"KeyN"),Ue=new Ee(ye,"KeyO"),He=new Ee(ye,"KeyP"),ke=new Ee(ye,"KeyQ"),$e=new Ee(ye,"KeyR"),Ke=new Ee(ye,"KeyS"),Ge=new Ee(ye,"KeyT"),Ve=new Ee(ye,"KeyU"),Ye=new Ee(ye,"KeyV"),je=new Ee(ye,"KeyW"),ze=new Ee(ye,"KeyX"),We=new Ee(ye,"KeyY"),qe=new Ee(ye,"KeyZ"),Xe=new Ee(ye,"Digit0"),Qe=new Ee(ye,"Digit1"),Ze=new Ee(ye,"Digit2"),Je=new Ee(ye,"Digit3"),tn=new Ee(ye,"Digit4"),en=new Ee(ye,"Digit5"),nn=new Ee(ye,"Digit6"),rn=new Ee(ye,"Digit7"),sn=new Ee(ye,"Digit8"),on=new Ee(ye,"Digit9"),an=new Ee(ye,"Minus"),un=new Ee(ye,"Equal"),ln=new Ee(ye,"BracketLeft"),hn=new Ee(ye,"BracketRight"),cn=new Ee(ye,"Semicolon"),dn=new Ee(ye,"Quote"),fn=new Ee(ye,"Backquote"),pn=new Ee(ye,"Backslash"),_n=new Ee(ye,"Comma"),gn=new Ee(ye,"Period"),mn=new Ee(ye,"Slash"),vn=new Ee(ye,"Escape"),An=new Ee(ye,"Space"),En=new Ee(ye,"CapsLock"),bn=new Ee(ye,"Backspace"),yn=new Ee(ye,"Delete"),wn=new Ee(ye,"Tab"),Tn=new Ee(ye,"Enter"),Rn=new Ee(ye,"ArrowUp"),Sn=new Ee(ye,"ArrowDown"),xn=new Ee(ye,"ArrowLeft"),Ln=new Ee(ye,"ArrowRight"),Cn=new Ee(we,"Button0"),On=new Ee(we,"Button1"),In=new Ee(we,"Button2"),Nn=new Ee(we,"Button3"),Mn=new Ee(we,"Button4"),Bn=new Ee(we,"PosX"),Dn=new Ee(we,"PosY"),Fn=new Ee(we,"WheelX"),Pn=new Ee(we,"WheelY"),Un=new Ee(we,"WheelZ");var Hn=Object.freeze({__proto__:null,from:be,isKeyCode:function(t){return"device"in t&&"code"in t},KEYBOARD:ye,MOUSE:we,KEY_A:Te,KEY_B:Re,KEY_C:Se,KEY_D:xe,KEY_E:Le,KEY_F:Ce,KEY_G:Oe,KEY_H:Ie,KEY_I:Ne,KEY_J:Me,KEY_K:Be,KEY_L:De,KEY_M:Fe,KEY_N:Pe,KEY_O:Ue,KEY_P:He,KEY_Q:ke,KEY_R:$e,KEY_S:Ke,KEY_T:Ge,KEY_U:Ve,KEY_V:Ye,KEY_W:je,KEY_X:ze,KEY_Y:We,KEY_Z:qe,DIGIT_0:Xe,DIGIT_1:Qe,DIGIT_2:Ze,DIGIT_3:Je,DIGIT_4:tn,DIGIT_5:en,DIGIT_6:nn,DIGIT_7:rn,DIGIT_8:sn,DIGIT_9:on,MINUS:an,EQUAL:un,BRACKET_LEFT:ln,BRACKET_RIGHT:hn,SEMICOLON:cn,QUOTE:dn,BACKQUOTE:fn,BACKSLASH:pn,COMMA:_n,PERIOD:gn,SLASH:mn,ESCAPE:vn,SPACE:An,CAPS_LOCK:En,BACKSPACE:bn,DELETE:yn,TAB:wn,ENTER:Tn,ARROW_UP:Rn,ARROW_DOWN:Sn,ARROW_LEFT:xn,ARROW_RIGHT:Ln,MOUSE_BUTTON_0:Cn,MOUSE_BUTTON_1:On,MOUSE_BUTTON_2:In,MOUSE_BUTTON_3:Nn,MOUSE_BUTTON_4:Mn,MOUSE_POS_X:Bn,MOUSE_POS_Y:Dn,MOUSE_WHEEL_X:Fn,MOUSE_WHEEL_Y:Pn,MOUSE_WHEEL_Z:Un});class kn{get polling(){return!!this.ref&&this.ref.polling}get value(){return!this.ref||this.disabled?0:this.ref.value}constructor(t){this.name=t,this.ref=null,this.disabled=!1}register(t){throw new Error("Unsupported operation.")}disable(t=!0){return this.disabled=t,this}getState(t){return!this.ref||this.disabled?0:this.ref.getState(t)}}function $n(t){Array.isArray(t)||(t=[t]);let e=[];for(let n of t){let t;try{t=Ee.parse(n)}catch(e){let r=Kn(n).toUpperCase();if(!(r in Hn))throw new Error("Invalid key code string - "+e);t=Hn[r]}e.push(t)}return e}function Kn(t){return t.replace(/([a-z]|(?:[A-Z0-9]+))([A-Z0-9]|$)/g,(function(t,e,n){return e+(n&&"_"+n)})).toLowerCase()}class Gn extends kn{static fromBind(t,e,n,r){return new Gn(t,be(e,n),r)}static fromString(t,...e){let n=$n(e);return new Gn(t,n)}get delta(){return!this.ref||this.disabled?0:this.ref.delta}constructor(t,e,n){super(t),this.keyCodes=Array.isArray(e)?e:[e],this.opts=n}register(t){let e=this.name,n=this.opts;for(let r of this.keyCodes)t.bindAxis(e,r.device,r.code,n);return this.ref=t.getAxis(e),this}}class Vn extends kn{static fromBind(t,e,n,r){return new Vn(t,be(e,n),r)}static fromString(t,...e){let n=$n(e);return new Vn(t,n)}get pressed(){return!(!this.ref||this.disabled)&&this.ref.pressed}get repeated(){return!(!this.ref||this.disabled)&&this.ref.repeated}get released(){return!(!this.ref||this.disabled)&&this.ref.released}get down(){return!(!this.ref||this.disabled)&&this.ref.down}constructor(t,e,n){super(t),this.keyCodes=Array.isArray(e)?e:[e],this.opts=n}register(t){let e=this.name,n=this.opts;for(let r of this.keyCodes)t.bindButton(e,r.device,r.code,n);return this.ref=t.getButton(e),this}}class Yn extends Gn{static fromBind(t,e,n,r){return new Yn(t,be(e,n),be(e,r))}constructor(t,e,n){if(super(t,[]),e.device!==n.device)throw new Error("Cannot create axis-button codes for different devices.");this.negativeKeyCode=e,this.positiveKeyCode=n}register(t){let e=this.name,n=this.negativeKeyCode,r=this.positiveKeyCode;return t.bindAxisButtons(e,n.device,n.code,r.code),this.ref=t.getAxis(e),this}}class jn{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let n=this.listeners;t in n?n[t].push(e):n[t]=[e]}removeEventListener(t,e){let n=this.listeners;if(t in n){let r=n[t],i=r.indexOf(e);i>=0&&r.splice(i,1)}}dispatchInputEvent(t){let e=0;for(let n of this.listeners.input)e|=n(t);return Boolean(e)}}class zn extends jn{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,n={}){super(t,e);const{ignoreRepeat:r=!0}=n;this.ignoreRepeat=r,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;return e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}}class Wn extends jn{static isAxis(t){return"PosX"===t||"PosY"===t||"WheelX"===t||"WheelY"===t||"WheelZ"===t}static isButton(t){return!this.isAxis(t)}constructor(t,e,n={}){super(t,e);const{eventsOnFocus:r=!0}=n;this.eventsOnFocus=r,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,n,r;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=10*t.deltaX,n=10*t.deltaY,r=10*t.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:e=100*t.deltaX,n=100*t.deltaY,r=100*t.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,n=t.deltaY,r=t.deltaZ}let i=0,s=this._wheelObject;if(s.code="WheelX",s.movement=e,i|=this.dispatchInputEvent(s),s.code="WheelY",s.movement=n,i|=this.dispatchInputEvent(s),s.code="WheelZ",s.movement=r,i|=this.dispatchInputEvent(s),i)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;return e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const e=this.canvasTarget,{clientWidth:n,clientHeight:r}=e,i=e.getBoundingClientRect();let s=t.movementX/n,o=t.movementY/r,a=(t.clientX-i.left)/n,u=(t.clientY-i.top)/r,l=this._positionObject;l.code="PosX",l.value=a,l.movement=s,this.dispatchInputEvent(l),l.code="PosY",l.value=u,l.movement=o,this.dispatchInputEvent(l)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}}class qn extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<kbd>\n  <span id="name"><slot></slot></span>\n  <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML="kbd {\n  position: relative;\n  display: inline-block;\n  border-radius: 3px;\n  border: 1px solid #888888;\n  font-size: 0.85em;\n  font-weight: 700;\n  text-rendering: optimizeLegibility;\n  line-height: 12px;\n  height: 14px;\n  padding: 2px 4px;\n  color: #444444;\n  background-color: #eeeeee;\n  box-shadow: inset 0 -3px 0 #aaaaaa;\n  overflow: hidden;\n}\n\nkbd:empty::after {\n  content: '<?>';\n  opacity: 0.6;\n}\n\n.disabled {\n  opacity: 0.6;\n  box-shadow: none;\n  background-color: #aaaaaa;\n}\n\n.hidden {\n  display: none;\n}\n\n#value {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  right: 0;\n  font-size: 0.85em;\n  padding: 0 4px;\n  padding-top: 2px;\n  color: #cccccc;\n  background-color: #333333;\n  box-shadow: inset 0 3px 0 #222222;\n}\n",Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,e,n){switch(t){case"name":this._name=n,this._nameElement.textContent=n;break;case"value":this._value=n,null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=n,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=null!==n,this._kbdElement.classList.toggle("disabled",null!==n)}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}}qn.define();class Xn{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return null!==this.animationFrameHandle}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}}class Qn{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){const{device:e,code:n,event:r,value:i,movement:s,control:o,shift:a,alt:u}=t;let l=this.bindings.getBindings(e,n);switch(r){case"pressed":for(let{input:t,index:e}of l)t.onUpdate(e,1,1);break;case"released":for(let{input:t,index:e}of l)t.onUpdate(e,0,-1);break;case"move":for(let{input:t,index:e}of l)t.onUpdate(e,i,s);break;case"wheel":for(let{input:t,index:e}of l)t.onUpdate(e,void 0,s)}return l.length>0}}class Zn{constructor(t,e,n,r){this.device=t,this.code=e,this.input=n,this.index=r}}class Jn{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,n,r={inverted:!1}){let i,s=this.inputMap;if(s.has(t)){let o=s.get(t),a=t.size;t.onBind(a,r),i=new Zn(e,n,t,a),o.push(i)}else{let o=[];s.set(t,o);let a=0;t.onBind(a,r),i=new Zn(e,n,t,a),o.push(i)}let o=this.bindingMap;e in o?n in o[e]?o[e][n].push(i):o[e][n]=[i]:o[e]={[n]:[i]}}unbind(t){let e=this.inputMap;if(e.has(t)){let n=this.bindingMap,r=e.get(t);for(let t of r){let{device:e,code:r}=t,i=n[e][r],s=i.indexOf(t);i.splice(s,1)}r.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let n=this.bindingMap;if(t in n){let r=n[t];if(e in r)return r[e]}return[]}}class tr{constructor(t,e={}){this.inputs={},this.devices=[new Wn("Mouse",t),new zn("Keyboard",t)],this.bindings=new Jn,this.adapter=new Qn(this.bindings),this.autopoller=new Xn(this.adapter),this.eventTarget=t,this.anyButton=new Ae(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new ve(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let t of this.devices)t.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let e in t)t[e].length=0;this.autopoller.running&&this.autopoller.stop();for(let t of this.devices)t.removeEventListener("input",this.onInput),t.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let e of this.devices)e.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t){let e=this.autopoller.running,n=void 0===t?!e:Boolean(t);n!==e&&(n?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let n=this.listeners;t in n?n[t].push(e):n[t]=[e]}removeEventListener(t,e){let n=this.listeners;if(t in n){let r=n[t],i=r.indexOf(e);i>=0&&r.splice(i,1)}}dispatchEvent(t){const{type:e}=t;let n=0;for(let r of this.listeners[e])n|=r(t)?1:0;return Boolean(n)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement)}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){for(let e of t)e.register(this)}bindButton(t,e,n,r){let i;this.hasButton(t)?i=this.getButton(t):(i=new Ae(1),this.inputs[t]=i),this.bindings.bind(i,e,n,r),this.onBind()}bindAxis(t,e,n,r){let i;this.hasAxis(t)?i=this.getAxis(t):(i=new ve(1),this.inputs[t]=i),this.bindings.bind(i,e,n,r),this.onBind()}bindAxisButtons(t,e,n,r){let i;this.hasAxis(t)?i=this.getAxis(t):(i=new ve(2),this.inputs[t]=i),this.bindings.bind(i,e,r),this.bindings.bind(i,e,n,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof Ae}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof ve}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t){if(void 0===t)return this.anyButton.down;{let e=this.inputs;for(let n of t){if(e[n].down)return!0}}return!1}isAnyButtonPressed(t){if(void 0===t)return this.anyButton.pressed;{let e=this.inputs;for(let n of t){if(e[n].pressed)return!0}}return!1}isAnyButtonReleased(t){if(void 0===t)return this.anyButton.released;{let e=this.inputs;for(let n of t){if(e[n].released)return!0}}return!1}getAnyAxisValue(t){if(void 0===t)return this.anyAxis.value;{let e=this.inputs;for(let n of t){let t=e[n];if(t.value)return t.value}}return 0}getAnyAxisDelta(t){if(void 0===t)return this.anyAxis.delta;{let e=this.inputs;for(let n of t){let t=e[n];if(t.delta)return t.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}}class er extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<table>\n  <thead>\n    <tr class="tableHeader">\n      <th colspan="3">\n        <span class="tableTitle">\n          <label id="title"> input-source </label>\n          <span id="slotContainer">\n            <slot></slot>\n          </span>\n          <p>\n            <label for="poll">poll</label>\n            <output id="poll"></output>\n          </p>\n          <p>\n            <label for="focus">focus</label>\n            <output id="focus"></output>\n          </p>\n        </span>\n      </th>\n    </tr>\n    <tr class="colHeader">\n      <th>name</th>\n      <th>value</th>\n      <th>key</th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=":host {\n  display: block;\n}\n\ntable {\n  border-collapse: collapse;\n  font-family: monospace;\n}\n\ntable,\nth,\ntd {\n  border: 1px solid #666666;\n}\n\nth,\ntd {\n  padding: 5px 10px;\n}\n\ntd {\n  text-align: center;\n}\n\nthead th {\n  padding: 0;\n}\n\n.colHeader > th {\n  font-size: 0.8em;\n  padding: 0 10px;\n  letter-spacing: 3px;\n  background-color: #aaaaaa;\n  color: #666666;\n}\n\ntbody output {\n  border-radius: 0.3em;\n  padding: 3px;\n}\n\ntr:not(.primary) .name,\ntr:not(.primary) .value {\n  opacity: 0.3;\n}\n\ntr:nth-child(2n) {\n  background-color: #eeeeee;\n}\n\n.tableHeader {\n  color: #666666;\n}\n\n.tableTitle {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 4px;\n}\n\n#slotContainer {\n  flex: 1;\n}\n\np {\n  display: inline;\n  margin: 0;\n  padding: 0;\n  padding-right: 10px;\n}\n\n#poll:empty::after,\n#focus:empty::after {\n  content: '✗';\n  color: #ff0000;\n}\n",Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super();const t=this.attachShadow({mode:"open"});t.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),t.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=t.querySelector("#title"),this._pollElement=t.querySelector("#poll"),this._focusElement=t.querySelector("#focus"),this._bodyElement=t.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;this._for="",this._eventTarget=this,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){let t=this._context;t&&(t.removeEventListener("bind",this.onInputContextBind),t.removeEventListener("unbind",this.onInputContextUnbind),t.removeEventListener("blur",this.onInputContextBlur),t.removeEventListener("focus",this.onInputContextFocus),t.destroy(),this._context=null)}attributeChangedCallback(t,e,n){switch(t){case"for":{let t,e;this._for=n,n?(t=document.getElementById(n),e=`${t.tagName.toLowerCase()}#${n}`):(t=this,e="input-port"),this._eventTarget=t,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${e}`}break;case"autopoll":this._autopoll=null!==n,this._context&&this._context.toggleAutoPoll(this._autopoll)}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){return this.updateTable(),!0}onInputContextUnbind(){return this.updateTable(),!0}onInputContextFocus(){return this._focusElement.innerHTML="✓",!0}onInputContextBlur(){return this._focusElement.innerHTML="",!0}getContext(t="axisbutton",e){switch(t){case"axisbutton":if(!this._context){let t=new tr(this._eventTarget,e);t.addEventListener("bind",this.onInputContextBind),t.addEventListener("unbind",this.onInputContextUnbind),t.addEventListener("blur",this.onInputContextBlur),t.addEventListener("focus",this.onInputContextFocus),this._autopoll&&t.toggleAutoPoll(!0),this._context=t}return this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected){if(!this._context)return this._outputElements={},void(this._bodyElement.innerHTML="");{let t=this._context,e=t.inputs,n=t.bindings,r={},i=[];for(let t of Object.keys(e)){let s=e[t],o=!0;for(let e of n.getBindingsByInput(s)){let n=nr(`${s.constructor.name}.${t}`,`${e.device}.${e.code}`,0,o);i.push(n),o&&(r[t]=n.querySelector("output"),o=!1)}}this._outputElements=r,this._bodyElement.innerHTML="";for(let t of i)this._bodyElement.appendChild(t)}}}updateTableValues(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let e of Object.keys(this._outputElements)){let n=this._outputElements[e],r=t[e].value;n.innerText=Number(r).toFixed(2)}}else for(let t of Object.keys(this._outputElements)){this._outputElements[t].innerText="---"}}updatePollStatus(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let e of Object.values(t))if(!e.polling)return void(this._pollElement.innerHTML="");this._pollElement.innerHTML="✓"}else this._pollElement.innerHTML="-"}}function nr(t,e,n,r=!0){let i=document.createElement("tr");r&&i.classList.add("primary");{let e=document.createElement("td");e.textContent=t,e.classList.add("name"),i.appendChild(e)}{let t=document.createElement("td"),e=document.createElement("output");e.innerText=r?Number(n).toFixed(2):"---",e.classList.add("value"),t.appendChild(e),i.appendChild(t)}{let t=document.createElement("td");t.classList.add("key");let n=new qn;n.innerText=e,t.appendChild(n),i.appendChild(t)}return i}er.define();const rr=Symbol("keyboardSource");const ir=Symbol("mouseSource");var sr=Object.freeze({__proto__:null,AutoPoller:Xn,Axis:ve,AxisBinding:Gn,AxisButtonBinding:Yn,Button:Ae,ButtonBinding:Vn,CLEAR_DOWN_STATE_BITS:254,CLEAR_INVERTED_MODIFIER_BITS:239,CLEAR_POLL_BITS:241,DOWN_STATE_BIT:1,DeviceInputAdapter:Qn,INVERTED_MODIFIER_BIT:16,InputBase:me,InputBindings:Jn,InputCode:qn,InputContext:tr,InputDevice:jn,InputPort:er,KeyCodes:Hn,Keyboard:class{constructor(t,e){this.KeyA=new Ae,this.KeyB=new Ae,this.KeyC=new Ae,this.KeyD=new Ae,this.KeyE=new Ae,this.KeyF=new Ae,this.KeyG=new Ae,this.KeyH=new Ae,this.KeyI=new Ae,this.KeyJ=new Ae,this.KeyK=new Ae,this.KeyL=new Ae,this.KeyM=new Ae,this.KeyN=new Ae,this.KeyO=new Ae,this.KeyP=new Ae,this.KeyQ=new Ae,this.KeyR=new Ae,this.KeyS=new Ae,this.KeyT=new Ae,this.KeyU=new Ae,this.KeyV=new Ae,this.KeyW=new Ae,this.KeyX=new Ae,this.KeyY=new Ae,this.KeyZ=new Ae,this.Digit0=new Ae,this.Digit1=new Ae,this.Digit2=new Ae,this.Digit3=new Ae,this.Digit4=new Ae,this.Digit5=new Ae,this.Digit6=new Ae,this.Digit7=new Ae,this.Digit8=new Ae,this.Digit9=new Ae,this.Minus=new Ae,this.Equal=new Ae,this.BracketLeft=new Ae,this.BracketRight=new Ae,this.Semicolon=new Ae,this.Quote=new Ae,this.Backquote=new Ae,this.Backslash=new Ae,this.Comma=new Ae,this.Period=new Ae,this.Slash=new Ae,this.Escape=new Ae,this.Space=new Ae,this.CapsLock=new Ae,this.Backspace=new Ae,this.Delete=new Ae,this.Tab=new Ae,this.Enter=new Ae,this.ArrowUp=new Ae,this.ArrowDown=new Ae,this.ArrowLeft=new Ae,this.ArrowRight=new Ae;const n=ye,r=new zn(n,t,e),i=new Jn;for(let t in this)if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];i.bind(e,n,t)}const s=new Qn(i);r.addEventListener("input",s.onInput);const o=new Xn(s);o.start(),this[rr]={device:r,bindings:i,adapter:s,autopoller:o}}destroy(){const t=this[rr];t.autopoller.stop(),t.device.removeEventListener("input",t.adapter.onInput),t.device.destroy(),t.bindings.clear()}},KeyboardDevice:zn,Mouse:class{constructor(t,e){this.PosX=new ve,this.PosY=new ve,this.WheelX=new ve,this.WheelY=new ve,this.WheelZ=new ve,this.Button0=new Ae,this.Button1=new Ae,this.Button2=new Ae,this.Button3=new Ae,this.Button4=new Ae;const n=we,r=new Wn(n,t,e),i=new Jn;for(let t in this)if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];i.bind(e,n,t)}const s=new Qn(i);r.addEventListener("input",s.onInput);const o=new Xn(s);o.start(),this[ir]={device:r,bindings:i,adapter:s,autopoller:o}}destroy(){const t=this[ir];t.autopoller.stop(),t.device.removeEventListener("input",t.adapter.onInput),t.device.destroy(),t.bindings.clear()}},MouseDevice:Wn,PRESSED_STATE_BIT:2,RELEASED_STATE_BIT:8,REPEATED_STATE_BIT:4,stringsToKeyCodes:$n});function or(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext}var ar=Object.freeze({__proto__:null,isWebGL2Supported:or});class ur{constructor(t,e){this.gl=t,this.target=e}data(t,e){const n=this.gl,r=this.target;if("number"==typeof t)n.bufferData(r,t,e||n.STATIC_DRAW);else{if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");n.bufferData(r,t,e||n.STATIC_DRAW)}return this}subData(t,e=0,n,r){const i=this.gl,s=this.target;if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");if(void 0!==n)if(or(i))i.bufferSubData(s,e,t,n,r);else{const o=r?t.subarray(n,n+r):t.subarray(n);i.bufferSubData(s,e,o)}else i.bufferSubData(s,e,t);return this}}class lr{constructor(t,e,n){this.dataContext=new ur(t,e),this.handle=n||t.createBuffer(),t.bindBuffer(e,this.handle)}get gl(){return this.dataContext.gl}get target(){return this.dataContext.target}data(t,e){return this.dataContext.data(t,e),this}subData(t,e=0,n,r){return this.dataContext.subData(t,e,n,r),this}build(){return this.handle}}class hr{constructor(t,e,n,r){this.gl=t,this.target=e,this.handle=r,this.type=n,this.bindContext=new ur(t,this.target)}bind(t){return t.bindBuffer(this.target,this.handle),this.bindContext.gl=t,this.bindContext}}const cr={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131};function dr(t,e){let n=[];const r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){let r=t.getActiveUniform(e,i);if(!r)break;n.push(r)}return n}function fr(t,e){let n=[];const r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;++i){let r=t.getActiveAttrib(e,i);r&&n.push(r)}return n}function pr(t,e){switch(e){case t.FLOAT:case t.INT:case t.UNSIGNED_INT:case t.BOOL:return 1;case t.FLOAT_VEC2:case t.INT_VEC2:case t.BOOL_VEC2:return 2;case t.FLOAT_VEC3:case t.INT_VEC3:case t.BOOL_VEC3:return 3;case t.FLOAT_VEC4:case t.INT_VEC4:case t.BOOL_VEC4:case t.FLOAT_MAT2:return 4;case t.FLOAT_MAT3:return 9;case t.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function _r(t,e){switch(e){case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:return gr}if(or(t)){const n=t;switch(e){case t.INT:case t.INT_VEC2:case t.INT_VEC3:case t.INT_VEC4:case t.BOOL:case t.BOOL_VEC2:case t.BOOL_VEC3:case t.BOOL_VEC4:return mr;case t.FLOAT_MAT2:return Ar;case t.FLOAT_MAT3:return Er;case t.FLOAT_MAT4:return br;case n.UNSIGNED_INT:case n.UNSIGNED_INT_VEC2:case n.UNSIGNED_INT_VEC3:case n.UNSIGNED_INT_VEC4:return vr}}throw new Error("Cannot find attribute function for gl enum.")}function gr(t,e,n,r,i=!1,s=0,o=0,a){if(this.bindBuffer(this.ARRAY_BUFFER,e),this.enableVertexAttribArray(t),this.vertexAttribPointer(t,n,r,i,s,o),void 0!==a){if(!or(this))throw new Error("Cannot use attribute divisor in WebGL 1.");this.vertexAttribDivisor(t,a)}}function mr(t,e,n,r,i=!1,s=0,o=0,a){if(!or(this))throw new Error("Cannot use attribute divisor in WebGL 1.");const u=this;u.bindBuffer(u.ARRAY_BUFFER,e),u.enableVertexAttribArray(t),u.vertexAttribIPointer(t,n,r,s,o),void 0!==a&&u.vertexAttribDivisor(t,a)}function vr(t,e,n,r,i=!1,s=0,o=0,a){if(!or(this))throw new Error("Cannot use attribute divisor in WebGL 1.");const u=this;u.bindBuffer(u.ARRAY_BUFFER,e),u.enableVertexAttribArray(t),u.vertexAttribIPointer(t,n,r,s,o),void 0!==a&&u.vertexAttribDivisor(t,a)}function Ar(t,e,n,r,i=!1,s=0,o=0,a){let u=pr(this,this.FLOAT_MAT2);yr(u*u,u,t,e,n,r,i,s,o,a)}function Er(t,e,n,r,i=!1,s=0,o=0,a){let u=pr(this,this.FLOAT_MAT3);yr(u*u,u,t,e,n,r,i,s,o,a)}function br(t,e,n,r,i=!1,s=0,o=0,a){let u=pr(this,this.FLOAT_MAT4);yr(u*u,u,t,e,n,r,i,s,o,a)}function yr(t,e,n,r,i,s,o,a,u,l){if(!or(this))throw new Error("Cannot use attribute divisor in WebGL 1.");const h=this;h.bindBuffer(h.ARRAY_BUFFER,r);let c=i/e,d=t*i,f=a/e;for(let t=0;t<e;++t){let e=n+t;h.enableVertexAttribArray(e),h.vertexAttribPointer(e,c,s,o,d,u+f*t),void 0!==l&&h.vertexAttribDivisor(e,l)}}function wr(t,e){let n={};const r=fr(t,e);for(let i of r){const r=i.name,s=i.size,o=i.type,a=t.getAttribLocation(e,r),u=_r(t,o);n[r]={type:o,size:s,location:a,applier:u,set value([t,e,n,r,i,s,o]){this.applier(this.location,t,e,n,r,i,s,o)}}}return n}function Tr(t,e,n){let r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){let e=t.getShaderInfoLog(r)+`\nFailed to compile shader:\n${n}`;throw t.deleteShader(r),new Error(e)}return r}async function Rr(t,e,n){for(let r of n)t.attachShader(e,r);t.linkProgram(e);const r=t.getExtension("KHR_parallel_shader_compile");if(r){const n=1e3/60;let i;do{await new Promise(((t,e)=>setTimeout(t,n))),i=t.getProgramParameter(e,r.COMPLETION_STATUS_KHR)}while(!i)}for(let r of n)t.detachShader(e,r),t.deleteShader(r);if(!t.getProgramParameter(e,t.LINK_STATUS)){let n=t.getProgramInfoLog(e);throw t.deleteProgram(e),new Error(n)}return e}function Sr(t,e,n,r,i){i?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.drawElements(e,r,t.UNSIGNED_SHORT,n)):t.drawArrays(e,n,r)}var xr=Object.freeze({__proto__:null,createShader:Tr,createShaderProgram:Rr,draw:Sr,getProgramStatus:function(t,e){return{linkStatus:t.getProgramParameter(e,t.LINK_STATUS),deleteStatus:t.getProgramParameter(e,t.DELETE_STATUS),validateStatus:t.getProgramParameter(e,t.VALIDATE_STATUS),infoLog:t.getProgramInfoLog(e)}},getActiveUniforms:dr,getActiveAttribs:fr,createProgramInfo:function(t,e){return{handle:e,attributes:wr(t,e),uniforms:Wr(t,e)}},linkProgramShaders:async function(t,e,n,r=[t.VERTEX_SHADER,t.FRAGMENT_SHADER]){let i=0,s=[];for(let e of n){if(i>=r.length)throw new Error("Missing shader type for shader source.");let n=r[i++],o=Tr(t,n,e);s.push(o)}return await Rr(t,e,s),e},bindProgramAttributes:qr,bindProgramUniforms:function(t,e,n){let r=e.uniforms;for(let e in n){let i=n[e],{location:s,applier:o}=r[e];o.call(t,s,i)}}});function Lr(t,e){const n=t;switch(e){case n.FLOAT:return n.uniform1f;case n.FLOAT_VEC2:return n.uniform2fv;case n.FLOAT_VEC3:return n.uniform3fv;case n.FLOAT_VEC4:return n.uniform4fv;case n.INT:return n.uniform1i;case n.INT_VEC2:return n.uniform2iv;case n.INT_VEC3:return n.uniform3iv;case n.INT_VEC4:return n.uniform4iv;case n.BOOL:return n.uniform1i;case n.BOOL_VEC2:return n.uniform2iv;case n.BOOL_VEC3:return n.uniform3iv;case n.BOOL_VEC4:return n.uniform4iv;case n.FLOAT_MAT2:return Cr;case n.FLOAT_MAT3:return Ir;case n.FLOAT_MAT4:return Mr;case n.SAMPLER_2D:case n.SAMPLER_CUBE:return n.uniform1i}if(or(t)){const n=t;switch(e){case n.UNSIGNED_INT:return n.uniform1ui;case n.UNSIGNED_INT_VEC2:return n.uniform2uiv;case n.UNSIGNED_INT_VEC3:return n.uniform3uiv;case n.UNSIGNED_INT_VEC4:return n.uniform4uiv;case n.FLOAT_MAT2x3:return Dr;case n.FLOAT_MAT2x4:return Pr;case n.FLOAT_MAT3x2:return Hr;case n.FLOAT_MAT3x4:return $r;case n.FLOAT_MAT4x2:return Gr;case n.FLOAT_MAT4x3:return Yr;case n.SAMPLER_3D:case n.SAMPLER_2D_SHADOW:case n.SAMPLER_2D_ARRAY:case n.SAMPLER_2D_ARRAY_SHADOW:case n.SAMPLER_CUBE_SHADOW:case n.INT_SAMPLER_2D:case n.INT_SAMPLER_3D:case n.INT_SAMPLER_CUBE:case n.INT_SAMPLER_2D_ARRAY:case n.UNSIGNED_INT_SAMPLER_2D:case n.UNSIGNED_INT_SAMPLER_3D:case n.UNSIGNED_INT_SAMPLER_CUBE:case n.UNSIGNED_INT_SAMPLER_2D_ARRAY:return n.uniform1i}}throw new Error("Cannot find uniform function for gl enum.")}function Cr(t,e){this.uniformMatrix2fv(t,!1,e)}function Or(t,e,n,r,i){this.uniformMatrix2fv(t,!1,[e,n,r,i])}function Ir(t,e){this.uniformMatrix3fv(t,!1,e)}function Nr(t,e,n,r,i,s,o,a,u,l){this.uniformMatrix3fv(t,!1,[e,n,r,i,s,o,a,u,l])}function Mr(t,e){this.uniformMatrix4fv(t,!1,e)}function Br(t,e,n,r,i,s,o,a,u,l,h,c,d,f,p,_,g){this.uniformMatrix4fv(t,!1,[e,n,r,i,s,o,a,u,l,h,c,d,f,p,_,g])}function Dr(t,e){this.uniformMatrix2x3fv(t,!1,e)}function Fr(t,e,n,r,i,s,o){this.uniformMatrix2x3fv(t,!1,[e,n,r,i,s,o])}function Pr(t,e){this.uniformMatrix2x4fv(t,!1,e)}function Ur(t,e,n,r,i,s,o,a,u){this.uniformMatrix2x4fv(t,!1,[e,n,r,i,s,o,a,u])}function Hr(t,e){this.uniformMatrix3x2fv(t,!1,e)}function kr(t,e,n,r,i,s,o){this.uniformMatrix3x2fv(t,!1,[e,n,r,i,s,o])}function $r(t,e){this.uniformMatrix3x4fv(t,!1,e)}function Kr(t,e,n,r,i,s,o,a,u,l,h,c,d){this.uniformMatrix3x4fv(t,!1,[e,n,r,i,s,o,a,u,l,h,c,d])}function Gr(t,e){this.uniformMatrix4x2fv(t,!1,e)}function Vr(t,e,n,r,i,s,o,a,u){this.uniformMatrix4x2fv(t,!1,[e,n,r,i,s,o,a,u])}function Yr(t,e){this.uniformMatrix4x3fv(t,!1,e)}function jr(t,e,n,r,i,s,o,a,u,l,h,c,d){this.uniformMatrix4x3fv(t,!1,[e,n,r,i,s,o,a,u,l,h,c,d])}var zr=Object.freeze({__proto__:null,getUniformFunction:Lr,getUniformComponentFunction:function(t,e){const n=t;switch(e){case n.FLOAT:return n.uniform1f;case n.FLOAT_VEC2:return n.uniform2f;case n.FLOAT_VEC3:return n.uniform3f;case n.FLOAT_VEC4:return n.uniform4f;case n.INT:return n.uniform1i;case n.INT_VEC2:return n.uniform2i;case n.INT_VEC3:return n.uniform3i;case n.INT_VEC4:return n.uniform4i;case n.BOOL:return n.uniform1i;case n.BOOL_VEC2:return n.uniform2i;case n.BOOL_VEC3:return n.uniform3i;case n.BOOL_VEC4:return n.uniform4i;case n.FLOAT_MAT2:return Or;case n.FLOAT_MAT3:return Nr;case n.FLOAT_MAT4:return Br;case n.SAMPLER_2D:case n.SAMPLER_CUBE:return n.uniform1i}if(or(t)){const n=t;switch(e){case n.UNSIGNED_INT:return n.uniform1ui;case n.UNSIGNED_INT_VEC2:return n.uniform2ui;case n.UNSIGNED_INT_VEC3:return n.uniform3ui;case n.UNSIGNED_INT_VEC4:return n.uniform4ui;case n.FLOAT_MAT2x3:return Fr;case n.FLOAT_MAT2x4:return Ur;case n.FLOAT_MAT3x2:return kr;case n.FLOAT_MAT3x4:return Kr;case n.FLOAT_MAT4x2:return Vr;case n.FLOAT_MAT4x3:return jr;case n.SAMPLER_3D:case n.SAMPLER_2D_SHADOW:case n.SAMPLER_2D_ARRAY:case n.SAMPLER_2D_ARRAY_SHADOW:case n.SAMPLER_CUBE_SHADOW:case n.INT_SAMPLER_2D:case n.INT_SAMPLER_3D:case n.INT_SAMPLER_CUBE:case n.INT_SAMPLER_2D_ARRAY:case n.UNSIGNED_INT_SAMPLER_2D:case n.UNSIGNED_INT_SAMPLER_3D:case n.UNSIGNED_INT_SAMPLER_CUBE:case n.UNSIGNED_INT_SAMPLER_2D_ARRAY:return n.uniform1i}}throw new Error("Cannot find per component uniform function for gl enum.")},getUniformArrayFunction:function(t,e){const n=t;switch(e){case n.FLOAT:return n.uniform1fv;case n.FLOAT_VEC2:return n.uniform2fv;case n.FLOAT_VEC3:return n.uniform3fv;case n.FLOAT_VEC4:return n.uniform4fv;case n.INT:return n.uniform1iv;case n.INT_VEC2:return n.uniform2iv;case n.INT_VEC3:return n.uniform3iv;case n.INT_VEC4:return n.uniform4iv;case n.BOOL:return n.uniform1iv;case n.BOOL_VEC2:return n.uniform2iv;case n.BOOL_VEC3:return n.uniform3iv;case n.BOOL_VEC4:return n.uniform4iv;case n.FLOAT_MAT2:return Cr;case n.FLOAT_MAT3:return Ir;case n.FLOAT_MAT4:return Mr;case n.SAMPLER_2D:case n.SAMPLER_CUBE:return n.uniform1iv}if(or(t)){const n=t;switch(e){case n.UNSIGNED_INT:return n.uniform1uiv;case n.UNSIGNED_INT_VEC2:return n.uniform2uiv;case n.UNSIGNED_INT_VEC3:return n.uniform3uiv;case n.UNSIGNED_INT_VEC4:return n.uniform4uiv;case n.FLOAT_MAT2x3:return Dr;case n.FLOAT_MAT2x4:return Pr;case n.FLOAT_MAT3x2:return Hr;case n.FLOAT_MAT3x4:return $r;case n.FLOAT_MAT4x2:return Gr;case n.FLOAT_MAT4x3:return Yr;case n.SAMPLER_3D:case n.SAMPLER_2D_SHADOW:case n.SAMPLER_2D_ARRAY:case n.SAMPLER_2D_ARRAY_SHADOW:case n.SAMPLER_CUBE_SHADOW:case n.INT_SAMPLER_2D:case n.INT_SAMPLER_3D:case n.INT_SAMPLER_CUBE:case n.INT_SAMPLER_2D_ARRAY:case n.UNSIGNED_INT_SAMPLER_2D:case n.UNSIGNED_INT_SAMPLER_3D:case n.UNSIGNED_INT_SAMPLER_CUBE:case n.UNSIGNED_INT_SAMPLER_2D_ARRAY:return n.uniform1iv}}throw new Error("Cannot find array uniform function for gl enum.")}});function Wr(t,e){let n={};const r=dr(t,e);for(let i of r){const r=i.name,s=i.size,o=i.type,a=t.getUniformLocation(e,r),u=Lr(t,o);n[r]={type:o,size:s,location:a,applier:u,set value(e){this.applier.call(t,this.location,e)}}}return n}function qr(t,e,n){if("handle"in n&&n.handle instanceof WebGLVertexArrayObject){if(!or(t))throw new Error("Vertex array objects are only supported in WebGL 2.");let e=n;t.bindVertexArray(e.handle)}else{let r=n,i=e.attributes;for(let e in i){if(!(e in r.attributes))throw new Error(`Missing buffer for attribute '${e}'.`);let n=r.attributes[e],{location:s,applier:o}=i[n.name];o.call(t,s,n.buffer,n.size,n.type,n.normalize,n.stride,n.offset,n.divisor)}r.element&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.element.buffer)}}function Xr(t,e){let n;if(n=t.includes("texcoord")?2:t.includes("color")?4:3,e%n!=0)throw new Error(`Could not determine vertex size - guessed ${n} but array length ${e} is not evenly divisible.`);return n}function Qr(t,e,n,r,i,s,o,a,u){return{name:t,buffer:e,length:n,size:r,type:i,normalize:s,stride:o,offset:a,divisor:u}}function Zr(t,e){switch(e){case t.BYTE:return Int8Array;case t.UNSIGNED_BYTE:return Uint8Array;case t.SHORT:return Int16Array;case t.UNSIGNED_SHORT:return Uint16Array;case t.INT:return Int32Array;case t.UNSIGNED_INT:return Uint32Array;case t.FLOAT:return Float32Array;default:throw new Error(`Cannot find valid typed array for buffer type '${e}'.`)}}function Jr(t,e){if(e instanceof Int8Array)return t.BYTE;if(e instanceof Uint8Array)return t.UNSIGNED_BYTE;if(e instanceof Int16Array)return t.SHORT;if(e instanceof Uint16Array)return t.UNSIGNED_SHORT;if(e instanceof Int32Array)return t.INT;if(e instanceof Uint32Array)return t.UNSIGNED_INT;if(e instanceof Float32Array)return t.FLOAT;throw new Error("Cannot find valid data type for buffer source.")}const ti={[cr.BYTE]:1,[cr.UNSIGNED_BYTE]:1,[cr.SHORT]:2,[cr.UNSIGNED_SHORT]:2,[cr.INT]:4,[cr.UNSIGNED_INT]:4,[cr.FLOAT]:4,[cr.HALF_FLOAT]:2};function ei(t,e){return ti[e]}function ni(t,e,n){return t.bindBuffer(e,n),t.getBufferParameter(e,t.BUFFER_SIZE)}var ri=Object.freeze({__proto__:null,createBufferSource:function(t,e,n){return new(Zr(t,e))(n)},createBuffer:function(t,e,n,r=t.STATIC_DRAW){if(!ArrayBuffer.isView(n))throw new Error("Source data must be a typed array.");let i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,r),i},getTypedArrayForBufferType:Zr,getBufferTypeForBufferSource:Jr,getByteCountForBufferType:ei,getBufferTypeForTypedArray:function(t,e){switch(e){case Int8Array:return t.BYTE;case Uint8Array:return t.UNSIGNED_BYTE;case Int16Array:return t.SHORT;case Uint16Array:return t.UNSIGNED_SHORT;case Int32Array:return t.INT;case Uint32Array:return t.UNSIGNED_INT;case Float32Array:return t.FLOAT;default:throw new Error("Cannot find valid buffer type for typed array.")}},getBufferUsage:function(t,e,n){return t.bindBuffer(e,n),t.getBufferParameter(e,t.BUFFER_USAGE)},getBufferByteCount:ni,getBufferLength:function(t,e,n,r){return Math.trunc(ni(t,e,n)/ei(0,r))},createBufferInfo:function(t,e,n){let r,i=function(t,e){let n={};for(let r of Object.keys(e)){let i=e[r];if(!i)continue;if("object"!=typeof i)throw new Error("Array attribute options must be an object.");let{name:s=r,buffer:o,size:a=3,type:u,normalize:l=!1,stride:h=0,offset:c=0,divisor:d,usage:f=t.STATIC_DRAW,length:p}=i;if(o instanceof WebGLBuffer)t.bindBuffer(t.ARRAY_BUFFER,o);else if(ArrayBuffer.isView(o)){let e=o;o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,f),void 0===u&&(u=Jr(t,e)),void 0===p&&(p=e.length)}else if(Array.isArray(o)){let e=o;void 0===u&&(u=t.FLOAT),void 0===p&&(p=e.length),o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o);let n=Zr(t,u);t.bufferData(t.ARRAY_BUFFER,new n(e),f)}else{if("number"!=typeof o)throw new Error("Invalid buffer for array attribute options.");{let e=o;o=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,f),void 0===p&&(p=e)}}if(void 0===u&&(u=t.FLOAT),void 0===p){let e=t.getBufferParameter(t.ARRAY_BUFFER,t.BUFFER_SIZE);p=Math.trunc(e/ei(t,u))}void 0===a&&(a=Xr(s,p)),n[s]=Qr(s,o,p,a,u,l,h,c,d)}return n}(t,e),s=function(t,e){if(!e)return null;if("object"!=typeof e)throw new Error("Element attribute options must be an object.");let{type:n=t.UNSIGNED_SHORT,buffer:r,usage:i=t.STATIC_DRAW,length:s}=e;if(r instanceof WebGLBuffer)t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r);else if(ArrayBuffer.isView(r)){let e=r;r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,i),void 0===n&&(n=Jr(t,e)),void 0===s&&(s=e.length)}else if(Array.isArray(r)){let e=r;r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),i),void 0===s&&(s=e.length)}else{if("number"!=typeof r)throw new Error("Invalid buffer for element attribute options.");{let e=r;r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,i),void 0===s&&(s=e)}}void 0===n&&(n=t.UNSIGNED_SHORT);if(void 0===s){let e=t.getBufferParameter(t.ELEMENT_ARRAY_BUFFER,t.BUFFER_SIZE);s=Math.trunc(e/ei(t,n))}return function(t,e,n){return{buffer:t,type:e,length:n}}(r,n,s)}(t,n);if(s)r=s.length;else{let t=Object.keys(i);if(t.length>0){let e=i[t[0]];r=Math.trunc(e.length/e.size)}else r=0}return{attributes:i,element:s,vertexCount:r}},createVertexArrayInfo:function(t,e,n){if(!or(t))throw new Error("Vertex array objects is only supported on WebGL2.");const r=t;let i=r.createVertexArray();r.bindVertexArray(i);for(let t of n)qr(r,t,e);return r.bindVertexArray(null),{handle:i,element:e.element,vertexCount:e.vertexCount}},drawBufferInfo:function(t,e,n=t.TRIANGLES,r=0,i=e.vertexCount,s){let o=e.element;if(o){let e=o.type;if(void 0!==s){if(!or(t))throw new Error("Instanced element drawing is only supported on WebGL2.");t.drawElementsInstanced(n,i,e,r,s)}else t.drawElements(n,i,e,r)}else if(void 0!==s){if(!or(t))throw new Error("Instanced array drawing is only supported on WebGL2.");t.drawArraysInstanced(n,r,i,s)}else t.drawArrays(n,r,i)}});class ii{constructor(t,e){this.handle=e,this.activeUniforms=Wr(t,e),this.activeAttributes=wr(t,e),this.drawContext=new si(t,this)}bind(t){return t.useProgram(this.handle),this.drawContext.gl=t,this.drawContext}}class si{constructor(t,e){this.gl=t,this.parent=e}uniform(t,e){const n=this.parent.activeUniforms;if(t in n){let r=n[t],i=r.location;r.applier.call(this.gl,i,e)}return this}attribute(t,e,n,r=!1,i=0,s=0){const o=this.gl,a=this.parent.activeAttributes;if(t in a){let u=a[t],l=u.location,h=u.size;n?(o.bindBuffer(o.ARRAY_BUFFER,n),o.vertexAttribPointer(l,h,e,r,i,s),o.enableVertexAttribArray(l)):o.disableVertexAttribArray(l)}return this}draw(t,e,n,r,i=null){return Sr(t,e,n,r,i),this.parent}}class oi{constructor(t,e){this.handle=e||t.createProgram(),this.shaders=[],this.gl=t}shader(t,e){let n=Tr(this.gl,t,e);return this.shaders.push(n),this}link(){return Rr(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}var ai=Object.freeze({__proto__:null,BufferBuilder:lr,BufferDataContext:ur,BufferEnums:cr,BufferHelper:ri,BufferInfo:hr,BufferInfoBuilder:class{constructor(t,e,n){this.bufferBuilder=new lr(t,e,n),this.bufferType=t.FLOAT}get gl(){return this.bufferBuilder.gl}get handle(){return this.bufferBuilder.handle}get target(){return this.bufferBuilder.target}data(t,e){return this.bufferBuilder.data(t,e),"number"!=typeof t&&(this.bufferType=Jr(this.gl,t)),this}subData(t,e,n,r){return this.bufferBuilder.subData(t,e,n,r),this.bufferType=Jr(this.gl,t),this}build(){const t=this.bufferBuilder.build(),e=this.gl,n=this.target,r=this.bufferType;return new hr(e,n,r,t)}},GLHelper:ar,ProgramAttributeEnums:{BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126,HALF_FLOAT:5131},ProgramBuilder:oi,ProgramHelper:xr,ProgramInfo:ii,ProgramInfoBuilder:class{constructor(t,e){this.programBuilder=new oi(t,e)}get gl(){return this.programBuilder.gl}get handle(){return this.programBuilder.handle}get shaders(){return this.programBuilder.shaders}shader(t,e){return this.programBuilder.shader(t,e),this}link(){const t=this.programBuilder.link();return new ii(this.gl,t)}},ProgramInfoDrawContext:si,ProgramUniformEnums:{FLOAT:5126,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,UNSIGNED_INT:5125,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311},ProgramUniformFunctions:zr});class ui{next(){return 0}}class li extends ui{next(){return Math.random()}}class hi extends ui{constructor(t){super(),this.seed=t,this.a=t}next(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}var ci=Object.freeze({__proto__:null,MathRandom:li,Mulberry32:hi,Random:class{static get RAND(){let t=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:t}),t}constructor(t){this.generator="number"==typeof t?new hi(t):t||new li,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(t){return this.RAND.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return this.RAND.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static rangeInt(t,e){return this.RAND.rangeInt(t,e)}rangeInt(t,e){return Math.trunc(this.range(t,e))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}},RandomBase:ui,SmallFastCounter32:class extends ui{constructor(t,e,n,r){super(),this.a=t,this.b=e,this.c=n,this.d=r}next(){let{a:t,b:e,c:n,d:r}=this;t|=0,e|=0,n|=0,r|=0;let i=(t+e|0)+r|0;return r=r+1|0,t=e^e>>>9,e=n+(n<<3)|0,n=n<<21|n>>>11,n=n+i|0,this.a=t,this.b=e,this.c=n,this.d=r,(i>>>0)/4294967296}}}),di=1e-6,fi="undefined"!=typeof Float32Array?Float32Array:Array;function pi(){var t=new fi(16);return fi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _i(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],f=e[11],p=e[12],_=e[13],g=e[14],m=e[15],v=n*a-r*o,A=n*u-i*o,E=n*l-s*o,b=r*u-i*a,y=r*l-s*a,w=i*l-s*u,T=h*_-c*p,R=h*g-d*p,S=h*m-f*p,x=c*g-d*_,L=c*m-f*_,C=d*m-f*g,O=v*C-A*L+E*x+b*S-y*R+w*T;return O?(O=1/O,t[0]=(a*C-u*L+l*x)*O,t[1]=(i*L-r*C-s*x)*O,t[2]=(_*w-g*y+m*b)*O,t[3]=(d*y-c*w-f*b)*O,t[4]=(u*S-o*C-l*R)*O,t[5]=(n*C-i*S+s*R)*O,t[6]=(g*E-p*w-m*A)*O,t[7]=(h*w-d*E+f*A)*O,t[8]=(o*L-a*S+l*T)*O,t[9]=(r*S-n*L-s*T)*O,t[10]=(p*y-_*E+m*v)*O,t[11]=(c*E-h*y-f*v)*O,t[12]=(a*R-o*x-u*T)*O,t[13]=(n*x-r*R+i*T)*O,t[14]=(_*A-p*b-g*v)*O,t[15]=(h*b-c*A+d*v)*O,t):null}function gi(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function mi(t,e){var n=new fi(3);!function(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],l=e[9],h=e[10];t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,l,h)}(n,e);var r=1/n[0],i=1/n[1],s=1/n[2],o=e[0]*r,a=e[1]*i,u=e[2]*s,l=e[4]*r,h=e[5]*i,c=e[6]*s,d=e[8]*r,f=e[9]*i,p=e[10]*s,_=o+h+p,g=0;return _>0?(g=2*Math.sqrt(_+1),t[3]=.25*g,t[0]=(c-f)/g,t[1]=(d-u)/g,t[2]=(a-l)/g):o>h&&o>p?(g=2*Math.sqrt(1+o-h-p),t[3]=(c-f)/g,t[0]=.25*g,t[1]=(a+l)/g,t[2]=(d+u)/g):h>p?(g=2*Math.sqrt(1+h-o-p),t[3]=(d-u)/g,t[0]=(a+l)/g,t[1]=.25*g,t[2]=(c+f)/g):(g=2*Math.sqrt(1+p-o-h),t[3]=(a-l)/g,t[0]=(d+u)/g,t[1]=(c+f)/g,t[2]=.25*g),t}function vi(t,e,n,r,i,s,o){var a=1/(e-n),u=1/(r-i),l=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(o+s)*l,t[15]=1,t}function Ai(t,e,n,r){var i,s,o,a,u,l,h,c,d,f,p=e[0],_=e[1],g=e[2],m=r[0],v=r[1],A=r[2],E=n[0],b=n[1],y=n[2];return Math.abs(p-E)<di&&Math.abs(_-b)<di&&Math.abs(g-y)<di?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=p-E,c=_-b,d=g-y,i=v*(d*=f=1/Math.hypot(h,c,d))-A*(c*=f),s=A*(h*=f)-m*d,o=m*c-v*h,(f=Math.hypot(i,s,o))?(i*=f=1/f,s*=f,o*=f):(i=0,s=0,o=0),a=c*o-d*s,u=d*i-h*o,l=h*s-c*i,(f=Math.hypot(a,u,l))?(a*=f=1/f,u*=f,l*=f):(a=0,u=0,l=0),t[0]=i,t[1]=a,t[2]=h,t[3]=0,t[4]=s,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=d,t[11]=0,t[12]=-(i*p+s*_+o*g),t[13]=-(a*p+u*_+l*g),t[14]=-(h*p+c*_+d*g),t[15]=1,t)}function Ei(){var t=new fi(3);return fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bi(t,e,n){var r=new fi(3);return r[0]=t,r[1]=e,r[2]=n,r}function yi(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function wi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ti(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Ri(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Si(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function xi(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function Li(){var t=new fi(4);return fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ci(t,e,n,r){var i,s,o,a,u,l=e[0],h=e[1],c=e[2],d=e[3],f=n[0],p=n[1],_=n[2],g=n[3];return(s=l*f+h*p+c*_+d*g)<0&&(s=-s,f=-f,p=-p,_=-_,g=-g),1-s>di?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(a=1-r,u=r),t[0]=a*l+u*f,t[1]=a*h+u*p,t[2]=a*c+u*_,t[3]=a*d+u*g,t}Ei(),function(){var t,e=(t=new fi(4),fi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Oi;Ei(),bi(1,0,0),bi(0,1,0),Li(),Li(),Oi=new fi(9),fi!=Float32Array&&(Oi[1]=0,Oi[2]=0,Oi[3]=0,Oi[5]=0,Oi[6]=0,Oi[7]=0),Oi[0]=1,Oi[4]=1,Oi[8]=1;const Ii=bi(0,1,0);class Ni{constructor(t,e){this.projectionMatrix=t,this.viewMatrix=e}resize(t,e){return this}}const Mi=Math.PI/3;const Bi=Math.PI/180;function Di(t,e,n){t?(n.nodes[t].children.push(e),n.nodes[e].parent=t):(n.roots.push(e),n.nodes[e].parent=0)}function Fi(t,e,n){if(t){let r=n.nodes[t].children,i=r.indexOf(e);r.splice(i,1),n.nodes[e].parentNode=0}else{let t=n.roots,r=t.indexOf(e);t.splice(r,1),n.nodes[e].parentNode=0}}function Pi(t,e,n,r,i){if(n>=100)return;let s=r(e,t);if(!1===s)return;let o=t.nodes[e],a=i?i(o.children,e,t):o.children;for(let e of a)Pi(t,e,n+1,r,i);"function"==typeof s&&s(e,t)}function Ui(t,e){delete e.nodes[t]}var Hi=Object.freeze({__proto__:null,Camera:Ni,FirstPersonCameraController:class{constructor(t={locky:!1}){this.locky=t.locky,this.position=Ei(),this.forward=bi(0,0,-1),this.right=bi(1,0,0),this.up=bi(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(t,e,n=1){return n*=1e3,this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+e*n)),this.yaw=(this.yaw+t*n)%360,this}move(t,e=0,n=0,r=1){return this.forwardAmount+=t*r,this.rightAmount+=e*r,this.upAmount+=n*r,this}apply(t){let{position:e,forward:n,right:r,up:i,forwardAmount:s,rightAmount:o,upAmount:a,pitch:u,yaw:l}=this,h=l*Bi,c=u*Bi,d=Math.cos(h),f=Math.cos(c),p=Math.sin(h),_=d*f,g=Math.sin(c),m=p*f;Ri(n,yi(n,_,this.locky?0:g,m)),Ri(r,Si(r,n,i));let v=Ei();return Ti(v,n,s),wi(e,e,v),Ti(v,r,o),wi(e,e,v),Ti(v,i,a),wi(e,e,v),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.locky&&yi(n,_,g,m),Ai(t,e,wi(v,e,n),i),t}},OrthographicCamera:class extends Ni{constructor(t,e,n,r,i=-1e3,s=1e3){super(pi(),pi()),this.orthoBounds={left:void 0===t?void 0:Number(t),top:void 0===e?void 0:Number(e),right:void 0===n?void 0:Number(n),bottom:void 0===r?void 0:Number(r)},this.clippingPlane={near:Number(i),far:Number(s)}}resize(t,e){const{near:n,far:r}=this.clippingPlane,{left:i,top:s,right:o,bottom:a}=this.orthoBounds;let u=this.projectionMatrix,l=void 0!==i;if(void 0!==t)if(l){const l=t/e;vi(u,i*l,o*l,a,s,n,r)}else vi(u,0,t,e,0,n,r);else l?vi(u,i,o,a,s,n,r):vi(u,-1,1,1,-1,-1,1);return this}},PerspectiveCamera:class extends Ni{constructor(t=Mi,e=.1,n=1e3){super(pi(),pi()),this.fieldOfView=Number(t),this.clippingPlane={near:Number(e),far:Number(n)}}resize(t,e){const n=void 0===t?1:t/e,{near:r,far:i}=this.clippingPlane;return function(t,e,n,r,i){var s,o=1/Math.tan(e/2);t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r)}(this.projectionMatrix,this.fieldOfView,n,r,i),this}},SceneGraph:class{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(t){let e=this._nextAvailableSceneNodeId++,n={parent:0,children:[]};return this.nodes[e]=n,Di(t,e,this),e}createSceneNodes(t,e){let n=[];for(let r=0;r<t;++r)n.push(this.createSceneNode(e));return n}deleteSceneNode(t){if(!(t in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");Fi(this.nodes[t].parent,t,this),Pi(this,t,0,Ui)}deleteSceneNodes(t){for(let e of t)this.deleteSceneNode(e)}getSceneNodeInfo(t){return this.nodes[t]}parentSceneNode(t,e){Fi(this.nodes[t].parent,t,this),Di(e,t,this)}replaceSceneNode(t,e){let n=this.nodes[t],r=n.parent,i=n.children.slice();if(Fi(r,t,this),n.children.length=0,e){let t=this.nodes[e];Fi(t.parent,e,this),t.children.push(...i),Di(r,e,this)}else if(r){this.nodes[r].children.push(...i)}else this.roots.push(...i);for(let t of i)this.nodes[t].parent=r}walk(t,e={}){const{from:n,childFilter:r}=e;let i;i=n?Array.isArray(n)?n:[n]:this.roots,r&&(i=r(i,0,this));for(let e of i)Pi(this,e,0,t,r)}},lookAt:function(t,e,n,r=0,i=1){let s=Ei(),o=Li();gi(s,t),mi(o,t),Ai(t,s,bi(e,n,r),Ii);let a=Li();mi(a,t),Ci(o,o,a,i),function(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=r+r,u=i+i,l=s+s,h=r*a,c=r*u,d=r*l,f=i*u,p=i*l,_=s*l,g=o*a,m=o*u,v=o*l;t[0]=1-(f+_),t[1]=c+v,t[2]=d-m,t[3]=0,t[4]=c-v,t[5]=1-(h+_),t[6]=p+g,t[7]=0,t[8]=d+m,t[9]=p-g,t[10]=1-(h+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1}(t,o,s)},panTo:function(t,e,n,r=0,i=1){let s=Ei();gi(s,t),function(t,e,n){var r,i,s,o,a,u,l,h,c,d,f,p,_=n[0],g=n[1],m=n[2];e===t?(t[12]=e[0]*_+e[4]*g+e[8]*m+e[12],t[13]=e[1]*_+e[5]*g+e[9]*m+e[13],t[14]=e[2]*_+e[6]*g+e[10]*m+e[14],t[15]=e[3]*_+e[7]*g+e[11]*m+e[15]):(r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=e[9],f=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=d,t[10]=f,t[11]=p,t[12]=r*_+a*g+c*m+e[12],t[13]=i*_+u*g+d*m+e[13],t[14]=s*_+l*g+f*m+e[14],t[15]=o*_+h*g+p*m+e[15])}(t,t,bi((e-s[0])*i,(n-s[1])*i,(r-s[2])*i))},screenToWorldRay:function(t,e,n,r,i,s=!1){let o=function(t,e,n,r){var i=new fi(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}(e,n,-1,1),a=pi();return _i(a,r),xi(o,o,a),o[2]=-1,o[3]=0,_i(a,i),xi(o,o,a),t[0]=o[0],t[1]=o[1],t[2]=o[2],s&&Ri(t,t),t}});const ki={on(t,e,n=e){let r;if(this.__events.has(t)?r=this.__events.get(t):(r=new Map,this.__events.set(t,r)),r.has(n))throw new Error(`Found callback for event '${t}' with the same handle '${n}'.`);return r.set(n,e),this},off(t,e){if(!this.__events.has(t))throw new Error(`Unable to find event '${t}'.`);{const n=this.__events.get(t);if(!n.has(e))throw new Error(`Unable to find callback for event '${t}' with handle '${e}'.`);n.delete(e)}return this},once(t,e,n=e){return this.on(t,((...r)=>{this.off(t,n),e.apply(this.__context||this,r)}),n)},emit(t,...e){if(this.__events.has(t)){let n=[];const r=Array.from(this.__events.get(t).values());for(const t of r){let r=t.apply(this.__context||this,e);r&&n.push(r)}return n}return this.__events.set(t,new Map),[]}};const $i={create:function(t){const e=Object.create(ki);return e.__events=new Map,e.__context=t,e},assign:function(t,e){const n=Object.assign(t,ki);return n.__events=new Map,n.__context=e,n},mixin:function(t,e){const n=t.prototype;return Object.assign(n,ki),n.__events=new Map,n.__context=e,n}},Ki={5:Vi("#7F8C8D"),4:Vi("#2ECC71"),3:Vi("#4794C8"),2:Vi("#F39C12"),1:Vi("#C0392B"),0:[""]};function Gi(t,e){return t-e}function Vi(t){return[`background: ${t}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}function Yi(){}function ji(t){switch(t){case 5:return console.trace;case 4:case 3:return console.log;case 2:return console.warn;case 1:return console.error;case 0:return Yi;default:return console.log}}function zi(t,e,n,r){if(e&&t.unshift(`[${e}]`),n){let e=[`%c${n}`,Ki[r].join(";")];t.unshift(e[0],e[1])}return t}const Wi=Symbol("level"),qi=Symbol("domain"),Xi={};let Qi=2,Zi="app";class Ji{static get TRACE(){return 5}static get DEBUG(){return 4}static get INFO(){return 3}static get WARN(){return 2}static get ERROR(){return 1}static get OFF(){return 0}static getLogger(t){return t in Xi?Xi[t]:Xi[t]=new Ji(t)}static useDefaultLevel(t){return Qi=t,this}static useDefaultDomain(t){return Zi=t,this}constructor(t){this.name=t,this[Wi]=Qi,this[qi]=Zi}setLevel(t){return this[Wi]=t,this}getLevel(){return this[Wi]}setDomain(t){return this[qi]=t,this}getDomain(){return this[qi]}log(t,...e){if(Gi(this[Wi],t)<0)return this;zi(e,this.name,this[qi],t),ji(t)(...e)}trace(...t){if(Gi(this[Wi],5)<0)return this;zi(t,this.name,this[qi],5),ji(5)(...t)}debug(...t){if(Gi(this[Wi],4)<0)return this;zi(t,this.name,this[qi],4),ji(4)(...t)}info(...t){if(Gi(this[Wi],3)<0)return this;zi(t,this.name,this[qi],3),ji(3)(...t)}warn(...t){if(Gi(this[Wi],2)<0)return this;zi(t,this.name,this[qi],2),ji(2)(...t)}error(...t){if(Gi(this[Wi],1)<0)return this;zi(t,this.name,this[qi],1),ji(1)(...t)}}function ts(t,e){const n=document.createElement("a"),r=e.indexOf(";");e=e.substring(0,r+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+t+";"+e.substring(r+1),n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}const es=["svg","g"];function ns(t,e=t.cloneNode(!0)){let n=t.childNodes,r=e.childNodes;for(var i=0;i<r.length;i++){let t=r[i],e=t.tagName;if(-1!=es.indexOf(e))ns(n[i],t);else if(n[i]instanceof Element){const e=window.getComputedStyle(n[i]);let r=[];for(let t of Object.keys(e))r.push(`${t}:${e.getPropertyValue(t)};`);t.setAttribute("style",r.join(""))}}return e}class rs{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(const e of t)this._heap.push(e),this._shiftUp()}pop(){const t=this.peek();let e=this._heap.length-1;return e>0&&this._swap(0,e),this._heap.pop(),this._shiftDown(),t}replace(t){const e=this.peek();return this._heap[0]=t,this._shiftDown(),e}peek(){return this._heap[0]}_compare(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){let n=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=n}_shiftUp(){let t,e=this._heap.length-1;for(;e>0&&this._compare(e,t=is(e));)this._swap(e,t),e=t}_shiftDown(){const t=this._heap.length;let e,n=0,r=ss(n),i=r<t,s=os(n),o=s<t;for(;i&&this._compare(r,n)||o&&this._compare(s,n);)e=o&&this._compare(s,r)?s:r,this._swap(n,e),n=e,r=ss(n),i=r<t,s=os(n),o=s<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}}function is(t){return(t+1>>>1)-1}function ss(t){return 1+(t<<1)}function os(t){return t+1<<1}function as(t,e,n){return Math.min(n,Math.max(e,t))}function us(t,e,n){let r=n-e,i=(t-e)%r;return i<0&&(i+=r),i+e}const ls=Math.PI/180,hs=180/Math.PI;function cs(t,e,n){if(n.has(e))throw new Error(`Found cyclic dependency for '${e.name||e}'.`);if(!t.visited.has(e)){if(t.visited.add(e),t.edgeMap.has(e)){let r=t.edgeMap.get(e);if(r.size>0){n.add(e);for(let e of r)cs(t,e,n);n.delete(e)}}t.dst.push(e)}}function ds(t,e,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.NaN,s=null){return t.fscore[e]=n,t.gscore[e]=r,t.hscore[e]=i,t.parents[e]=s,e}var fs=Object.freeze({__proto__:null,Eventable:$i,FILE_TYPE_PNG:"png",FILE_TYPE_SVG:"svg",Logger:Ji,PriorityQueue:rs,astarSearch:function(t,e,n,r){let i={fscore:{},gscore:{},hscore:{},parents:{}};ds(i,t);let s=new Set,o=new Set;for(s.add(t);s.size>0;){let t;for(let e of s)t?i.fscore[e]<i.fscore[t]&&(t=e):t=e;let a=t;if(a===e){let t=[];for(;i.parents[a];)t.push(a),a=i.parents[a];return t.push(a),t.reverse()}o.add(a),s.delete(a);for(let t of n(a)){if(o.has(t))continue;let n=i.gscore[a]+1,u=!1;s.has(t)?n<i.gscore[t]&&(u=!0):(u=!0,ds(i,t),i.hscore[t]=r(t,e),s.add(t)),u&&(i.parents[t]=a,i.gscore[t]=n,i.fscore[t]=n+i.hscore[t])}}return[]},bitCount:function(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24},bresenhamLine:function(t,e,n,r,i){let s=Math.floor(t),o=Math.floor(e),a=Math.floor(n),u=Math.floor(r),l=Math.abs(n-t),h=t<n?1:-1,c=-Math.abs(r-e),d=e<r?1:-1,f=l+c,p=s,_=o,g=i(p,_);if(void 0!==g)return g;let m=l*l+c*c,v=0;for(;v<m&&(p!==a||_!==u);){++v;let t=2*f;if(t>=c&&(f+=c,p+=h),t<=l&&(f+=l,_+=d),g=i(p,_),void 0!==g)return g}},clamp:as,cycle:us,direction2:function(t,e,n,r){let i=n-t,s=r-e;return Math.atan2(s,i)},distance2:function(t,e,n,r){let i=n-t,s=r-e;return Math.sqrt(i*i+s*s)},downloadImageFromSVG:function(t,e,n,r,i){const s=function(t){const e=ns(t),n=(new XMLSerializer).serializeToString(e);return new Blob([n],{type:"image/svg+xml"})}(n);switch(e){case"png":{const n=URL.createObjectURL(s),o=document.createElement("canvas"),a=o.getContext("2d"),u=window.devicePixelRatio||1;o.width=r*u,o.height=i*u,o.style.width=r+"px",o.style.height=i+"px",a.setTransform(u,0,0,u,0,0);const l=new Image;l.onload=()=>{a.drawImage(l,0,0),URL.revokeObjectURL(n);const r=o.toDataURL("image/"+e).replace("image/"+e,"image/octet-stream");ts(t,r)},l.src=n}break;case"svg":{const e=new FileReader;e.onload=()=>{ts(t,e.result)},e.readAsDataURL(s)}break;default:throw new Error("Unknown file type '"+e+"'")}},downloadText:function(t,e){ts(t,"data:text/plain; charset=utf-8,"+encodeURIComponent(e))},downloadURL:ts,fisherYatesShuffle:function(t){for(let e=t.length-1;e>0;--e){let n=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[n],t[n]=r}return t},lerp:function(t,e,n){return t+(e-t)*n},lookAt2:function(t,e,n){return as(t+us(e-t,-Math.PI,Math.PI),t-n,t+n)},toDegrees:function(t){return t*hs},toRadians:function(t){return t*ls},topoSort:function(t,e){let n=[];for(let r of t){let t=e(r);if(Array.isArray(t))n.push([r,...t]);else if(t)throw new Error("Dependency callback must return an array.")}return function(t,e,n=[]){let r=new Map;for(let t of e)if(t.length>1){let e=t[0],n=t[1];r.has(e)||r.set(e,new Set),r.has(n)||r.set(n,new Set),r.get(e).add(n)}let i={edgeMap:r,index:t.length,visited:new Set,dst:n};for(let e of t)cs(i,e,new Set);return n}(function(t){let e=new Set;for(let n of t)for(let t of n)e.add(t);return Array.from(e)}(n),function(t){let e=[];for(let n of t){let t=n[0];for(let r=1;r<n.length;++r){let i=n[r];e.push([t,i])}}return e}(n))},uploadFile:async function(t=[],e=!1){return new Promise(((n,r)=>{const i=document.createElement("input");i.addEventListener("change",(t=>{n(e?t.target.files:t.target.files[0])})),i.type="file",i.accept=t.join(","),i.style.display="none",i.toggleAttribute("multiple",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}))},uuid:function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)},withinRadius:function(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o<=i*i}});t.asset=ue,t.display=ge,t.input=sr,t.mogli=ai,t.random=ci,t.scene=Hi,t.util=fs,Object.defineProperty(t,"__esModule",{value:!0})}));
