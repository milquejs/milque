!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).milque={})}(this,(function(t){"use strict";var e={},n=Uint8Array,i=Uint16Array,s=Uint32Array,r=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(t,e){for(var n=new i(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var o=new s(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)o[a]=a-n[r]<<5|r;return[n,o]},l=u(r,2),h=l[0],c=l[1];h[28]=258,c[258]=28;for(var d=u(o,0)[0],p=new i(32768),f=0;f<32768;++f){var _=(43690&f)>>>1|(21845&f)<<1;_=(61680&(_=(52428&_)>>>2|(13107&_)<<2))>>>4|(3855&_)<<4,p[f]=((65280&_)>>>8|(255&_)<<8)>>>1}var m=function(t,e,n){for(var s=t.length,r=0,o=new i(e);r<s;++r)++o[t[r]-1];var a,u=new i(e);for(r=0;r<e;++r)u[r]=u[r-1]+o[r-1]<<1;if(n){a=new i(1<<e);var l=15-e;for(r=0;r<s;++r)if(t[r])for(var h=r<<4|t[r],c=e-t[r],d=u[t[r]-1]++<<c,f=d|(1<<c)-1;d<=f;++d)a[p[d]>>>l]=h}else for(a=new i(s),r=0;r<s;++r)t[r]&&(a[r]=p[u[t[r]-1]++]>>>15-t[r]);return a},g=new n(288);for(f=0;f<144;++f)g[f]=8;for(f=144;f<256;++f)g[f]=9;for(f=256;f<280;++f)g[f]=7;for(f=280;f<288;++f)g[f]=8;var v=new n(32);for(f=0;f<32;++f)v[f]=5;var b=m(g,9,1),A=m(v,5,1),E=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},y=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},w=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},T=function(t){return(t/8|0)+(7&t&&1)},x=function(t,e,r){(null==e||e<0)&&(e=0),(null==r||r>t.length)&&(r=t.length);var o=new(t instanceof i?i:t instanceof s?s:n)(r-e);return o.set(t.subarray(e,r)),o},S=function(t,e,i){var s=t.length;if(!s||i&&!i.l&&s<5)return e||new n(0);var u=!e||i,l=!i||i.i;i||(i={}),e||(e=new n(3*s));var c=function(t){var i=e.length;if(t>i){var s=new n(Math.max(2*i,t));s.set(e),e=s}},p=i.f||0,f=i.p||0,_=i.b||0,g=i.l,v=i.d,S=i.m,R=i.n,C=8*s;do{if(!g){i.f=p=y(t,f,1);var L=y(t,f+1,3);if(f+=3,!L){var M=t[($=T(f)+4)-4]|t[$-3]<<8,O=$+M;if(O>s){if(l)throw"unexpected EOF";break}u&&c(_+M),e.set(t.subarray($,O),_),i.b=_+=M,i.p=f=8*O;continue}if(1==L)g=b,v=A,S=9,R=5;else{if(2!=L)throw"invalid block type";var N=y(t,f,31)+257,I=y(t,f+10,15)+4,B=N+y(t,f+5,31)+1;f+=14;for(var D=new n(B),P=new n(19),H=0;H<I;++H)P[a[H]]=y(t,f+3*H,7);f+=3*I;var k=E(P),F=(1<<k)-1,U=m(P,k,1);for(H=0;H<B;){var $,G=U[y(t,f,F)];if(f+=15&G,($=G>>>4)<16)D[H++]=$;else{var j=0,K=0;for(16==$?(K=3+y(t,f,3),f+=2,j=D[H-1]):17==$?(K=3+y(t,f,7),f+=3):18==$&&(K=11+y(t,f,127),f+=7);K--;)D[H++]=j}}var V=D.subarray(0,N),z=D.subarray(N);S=E(V),R=E(z),g=m(V,S,1),v=m(z,R,1)}if(f>C){if(l)throw"unexpected EOF";break}}u&&c(_+131072);for(var W=(1<<S)-1,Y=(1<<R)-1,q=f;;q=f){var X=(j=g[w(t,f)&W])>>>4;if((f+=15&j)>C){if(l)throw"unexpected EOF";break}if(!j)throw"invalid length/literal";if(X<256)e[_++]=X;else{if(256==X){q=f,g=null;break}var Q=X-254;if(X>264){var Z=r[H=X-257];Q=y(t,f,(1<<Z)-1)+h[H],f+=Z}var J=v[w(t,f)&Y],tt=J>>>4;if(!J)throw"invalid distance";f+=15&J;z=d[tt];if(tt>3){Z=o[tt];z+=w(t,f)&(1<<Z)-1,f+=Z}if(f>C){if(l)throw"unexpected EOF";break}u&&c(_+131072);for(var et=_+Q;_<et;_+=4)e[_]=e[_-z],e[_+1]=e[_+1-z],e[_+2]=e[_+2-z],e[_+3]=e[_+3-z];_=et}}i.l=g,i.p=q,i.b=_,g&&(p=1,i.m=S,i.d=v,i.n=R)}while(!p);return _==e.length?e:x(e,0,_)},R=new n(0),C=function(t,e,n){for(var i=t(),s=t.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],u=r[o];if("function"==typeof a){e+=";"+u+"=";var l=a.toString();if(a.prototype)if(-1!=l.indexOf("[native code]")){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else for(var c in e+=l,a.prototype)e+=";"+u+".prototype."+c+"="+a.prototype[c].toString();else e+=l}else n[u]=a}return[e,n]},L=[],M=function(t,r,o,a){var u;if(!L[o]){for(var l="",h={},c=t.length-1,d=0;d<c;++d)l=(u=C(t[d],l,h))[0],h=u[1];L[o]=C(t[c],l,h)}var p=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n}({},L[o][1]);return function(t,n,i,s,r){var o=new Worker(e[n]||(e[n]=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))));return o.onerror=function(t){return r(t.error,null)},o.onmessage=function(t){return r(null,t.data)},o.postMessage(i,s),o}(L[o][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+r.toString()+"}",o,p,function(t){var e=[];for(var r in t)(t[r]instanceof n||t[r]instanceof i||t[r]instanceof s)&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e}(p),a)},O=function(){return[n,i,s,r,o,a,h,d,b,A,p,m,E,y,w,T,x,S,k,N,I]},N=function(t){return postMessage(t,[t.buffer])},I=function(t){return t&&t.size&&new n(t.size)},B=function(t,e){return t[e]|t[e+1]<<8},D=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},P=function(t,e){return D(t,e)+4294967296*D(t,e+4)};function H(t,e,n){if(n||(n=e,e={}),"function"!=typeof n)throw"no callback";return function(t,e,n,i,s,r){var o=M(n,i,s,(function(t,e){o.terminate(),r(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}}(t,e,[O],(function(t){return N(k(t.data[0],I(t.data[1])))}),1,n)}function k(t,e){return S(t,e)}var F="undefined"!=typeof TextDecoder&&new TextDecoder;try{F.decode(R,{stream:!0}),1}catch(t){}function U(t,e){if(e){for(var n="",i=0;i<t.length;i+=16384)n+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return n}if(F)return F.decode(t);var s=function(t){for(var e="",n=0;;){var i=t[n++],s=(i>127)+(i>223)+(i>239);if(n+s>t.length)return[e,x(t,n-1)];s?3==s?(i=((15&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&s?String.fromCharCode((31&i)<<6|63&t[n++]):String.fromCharCode((15&i)<<12|(63&t[n++])<<6|63&t[n++]):e+=String.fromCharCode(i)}}(t),r=s[0];if(s[1].length)throw"invalid utf-8 data";return r}var $=function(t,e){for(;1!=B(t,e);e+=4+B(t,e+2));return[P(t,e+12),P(t,e+4),P(t,e+20)]};function G(t,e){if("function"!=typeof e)throw"no callback";for(var i=[],s=function(){for(var t=0;t<i.length;++t)i[t]()},r={},o=t.length-22;101010256!=D(t,o);--o)if(!o||t.length-o>65558)return void e("invalid zip file",null);var a=B(t,o+8);a||e(null,{});var u=a,l=D(t,o+16),h=4294967295==l;if(h){if(o=D(t,o-12),101075792!=D(t,o))return void e("invalid zip file",null);u=a=D(t,o+32),l=D(t,o+48)}for(var c=function(o){var u=function(t,e,n){var i=B(t,e+28),s=U(t.subarray(e+46,e+46+i),!(2048&B(t,e+8))),r=e+46+i,o=D(t,e+20),a=n&&4294967295==o?$(t,r):[o,D(t,e+24),D(t,e+42)],u=a[0],l=a[1],h=a[2];return[B(t,e+10),u,l,s,r+B(t,e+30)+B(t,e+32),h]}(t,l,h),c=u[0],d=u[1],p=u[2],f=u[3],_=u[4],m=u[5],g=function(t,e){return e+30+B(t,e+26)+B(t,e+28)}(t,m);l=_;var v=function(t,n){t?(s(),e(t,null)):(r[f]=n,--a||e(null,r))};if(c)if(8==c){var b=t.subarray(g,g+d);if(d<32e4)try{v(null,k(b,new n(p)))}catch(t){v(t,null)}else i.push(H(b,{size:p},v))}else v("unknown compression type "+c,null);else v(null,x(t,g,g+d))},d=0;d<u;++d)c();return s}function j(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})})),e}function K(t,e){for(var n=0,i=t.length-1;i>=0;i--){var s=t[i];"."===s?t.splice(i,1):".."===s?(t.splice(i,1),n++):n&&(t.splice(i,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var V=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,z=function(t){return V.exec(t).slice(1)};function W(){for(var t="",e=!1,n=arguments.length-1;n>=-1&&!e;n--){var i=n>=0?arguments[n]:"/";if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(t=i+"/"+t,e="/"===i.charAt(0))}return(e?"/":"")+(t=K(nt(t.split("/"),(function(t){return!!t})),!e).join("/"))||"."}function Y(t){var e=q(t),n="/"===it(t,-1);return(t=K(nt(t.split("/"),(function(t){return!!t})),!e).join("/"))||e||(t="."),t&&n&&(t+="/"),(e?"/":"")+t}function q(t){return"/"===t.charAt(0)}function X(){var t=Array.prototype.slice.call(arguments,0);return Y(nt(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))}function Q(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=W(t).substr(1),e=W(e).substr(1);for(var i=n(t.split("/")),s=n(e.split("/")),r=Math.min(i.length,s.length),o=r,a=0;a<r;a++)if(i[a]!==s[a]){o=a;break}var u=[];for(a=o;a<i.length;a++)u.push("..");return(u=u.concat(s.slice(o))).join("/")}function Z(t){var e=z(t),n=e[0],i=e[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."}function J(t,e){var n=z(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n}function tt(t){return z(t)[3]}var et={extname:tt,basename:J,dirname:Z,sep:"/",delimiter:":",relative:Q,join:X,isAbsolute:q,normalize:Y,resolve:W};function nt(t,e){if(t.filter)return t.filter(e);for(var n=[],i=0;i<t.length;i++)e(t[i],i,t)&&n.push(t[i]);return n}var it="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)},st=j(Object.freeze({__proto__:null,resolve:W,normalize:Y,isAbsolute:q,join:X,relative:Q,sep:"/",delimiter:":",dirname:Z,basename:J,extname:tt,default:et})),rt={};const ot=st,at="[^\\\\/]",ut="\\.",lt="\\/",ht="[^/]",ct="(?:\\/|$)",dt="(?:^|\\/)",pt="\\.{1,2}(?:\\/|$)",ft={DOT_LITERAL:ut,PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:lt,ONE_CHAR:"(?=.)",QMARK:ht,END_ANCHOR:ct,DOTS_SLASH:pt,NO_DOT:"(?!\\.)",NO_DOTS:`(?!(?:^|\\/)${pt})`,NO_DOT_SLASH:"(?!\\.{0,1}(?:\\/|$))",NO_DOTS_SLASH:`(?!${pt})`,QMARK_NO_DOT:"[^.\\/]",STAR:"[^/]*?",START_ANCHOR:dt},_t={...ft,SLASH_LITERAL:"[\\\\/]",QMARK:at,STAR:"[^\\\\/]*?",DOTS_SLASH:"\\.{1,2}(?:[\\\\/]|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|[\\\\/])\\.{1,2}(?:[\\\\/]|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:[\\\\/]|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:[\\\\/]|$))",QMARK_NO_DOT:"[^.\\\\/]",START_ANCHOR:"(?:^|[\\\\/])",END_ANCHOR:"(?:[\\\\/]|$)"};var mt={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:ot.sep,extglobChars:t=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${t.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:t=>!0===t?_t:ft};!function(t){const e=st,n="win32"===process.platform,{REGEX_BACKSLASH:i,REGEX_REMOVE_BACKSLASH:s,REGEX_SPECIAL_CHARS:r,REGEX_SPECIAL_CHARS_GLOBAL:o}=mt;t.isObject=t=>null!==t&&"object"==typeof t&&!Array.isArray(t),t.hasRegexChars=t=>r.test(t),t.isRegexChar=e=>1===e.length&&t.hasRegexChars(e),t.escapeRegex=t=>t.replace(o,"\\$1"),t.toPosixSlashes=t=>t.replace(i,"/"),t.removeBackslashes=t=>t.replace(s,(t=>"\\"===t?"":t)),t.supportsLookbehinds=()=>{const t=process.version.slice(1).split(".").map(Number);return 3===t.length&&t[0]>=9||8===t[0]&&t[1]>=10},t.isWindows=t=>t&&"boolean"==typeof t.windows?t.windows:!0===n||"\\"===e.sep,t.escapeLast=(e,n,i)=>{const s=e.lastIndexOf(n,i);return-1===s?e:"\\"===e[s-1]?t.escapeLast(e,n,s-1):`${e.slice(0,s)}\\${e.slice(s)}`},t.removePrefix=(t,e={})=>{let n=t;return n.startsWith("./")&&(n=n.slice(2),e.prefix="./"),n},t.wrapOutput=(t,e={},n={})=>{let i=`${n.contains?"":"^"}(?:${t})${n.contains?"":"$"}`;return!0===e.negated&&(i=`(?:^(?!${i}).*$)`),i}}(rt);const gt=rt,{CHAR_ASTERISK:vt,CHAR_AT:bt,CHAR_BACKWARD_SLASH:At,CHAR_COMMA:Et,CHAR_DOT:yt,CHAR_EXCLAMATION_MARK:wt,CHAR_FORWARD_SLASH:Tt,CHAR_LEFT_CURLY_BRACE:xt,CHAR_LEFT_PARENTHESES:St,CHAR_LEFT_SQUARE_BRACKET:Rt,CHAR_PLUS:Ct,CHAR_QUESTION_MARK:Lt,CHAR_RIGHT_CURLY_BRACE:Mt,CHAR_RIGHT_PARENTHESES:Ot,CHAR_RIGHT_SQUARE_BRACKET:Nt}=mt,It=t=>t===Tt||t===At,Bt=t=>{!0!==t.isPrefix&&(t.depth=t.isGlobstar?1/0:1)};var Dt=(t,e)=>{const n=e||{},i=t.length-1,s=!0===n.parts||!0===n.scanToEnd,r=[],o=[],a=[];let u,l,h=t,c=-1,d=0,p=0,f=!1,_=!1,m=!1,g=!1,v=!1,b=!1,A=!1,E=!1,y=!1,w=!1,T=0,x={value:"",depth:0,isGlob:!1};const S=()=>c>=i,R=()=>(u=l,h.charCodeAt(++c));for(;c<i;){let t;if(l=R(),l!==At){if(!0===b||l===xt){for(T++;!0!==S()&&(l=R());)if(l!==At)if(l!==xt){if(!0!==b&&l===yt&&(l=R())===yt){if(f=x.isBrace=!0,m=x.isGlob=!0,w=!0,!0===s)continue;break}if(!0!==b&&l===Et){if(f=x.isBrace=!0,m=x.isGlob=!0,w=!0,!0===s)continue;break}if(l===Mt&&(T--,0===T)){b=!1,f=x.isBrace=!0,w=!0;break}}else T++;else A=x.backslashes=!0,R();if(!0===s)continue;break}if(l!==Tt){if(!0!==n.noext){if(!0===(l===Ct||l===bt||l===vt||l===Lt||l===wt)&&h.charCodeAt(c+1)===St){if(m=x.isGlob=!0,g=x.isExtglob=!0,w=!0,l===wt&&c===d&&(y=!0),!0===s){for(;!0!==S()&&(l=R());)if(l!==At){if(l===Ot){m=x.isGlob=!0,w=!0;break}}else A=x.backslashes=!0,l=R();continue}break}}if(l===vt){if(u===vt&&(v=x.isGlobstar=!0),m=x.isGlob=!0,w=!0,!0===s)continue;break}if(l===Lt){if(m=x.isGlob=!0,w=!0,!0===s)continue;break}if(l===Rt){for(;!0!==S()&&(t=R());)if(t!==At){if(t===Nt){_=x.isBracket=!0,m=x.isGlob=!0,w=!0;break}}else A=x.backslashes=!0,R();if(!0===s)continue;break}if(!0===n.nonegate||l!==wt||c!==d){if(!0!==n.noparen&&l===St){if(m=x.isGlob=!0,!0===s){for(;!0!==S()&&(l=R());)if(l!==St){if(l===Ot){w=!0;break}}else A=x.backslashes=!0,l=R();continue}break}if(!0===m){if(w=!0,!0===s)continue;break}}else E=x.negated=!0,d++}else{if(r.push(c),o.push(x),x={value:"",depth:0,isGlob:!1},!0===w)continue;if(u===yt&&c===d+1){d+=2;continue}p=c+1}}else A=x.backslashes=!0,l=R(),l===xt&&(b=!0)}!0===n.noext&&(g=!1,m=!1);let C=h,L="",M="";d>0&&(L=h.slice(0,d),h=h.slice(d),p-=d),C&&!0===m&&p>0?(C=h.slice(0,p),M=h.slice(p)):!0===m?(C="",M=h):C=h,C&&""!==C&&"/"!==C&&C!==h&&It(C.charCodeAt(C.length-1))&&(C=C.slice(0,-1)),!0===n.unescape&&(M&&(M=gt.removeBackslashes(M)),C&&!0===A&&(C=gt.removeBackslashes(C)));const O={prefix:L,input:t,start:d,base:C,glob:M,isBrace:f,isBracket:_,isGlob:m,isExtglob:g,isGlobstar:v,negated:E,negatedExtglob:y};if(!0===n.tokens&&(O.maxDepth=0,It(l)||o.push(x),O.tokens=o),!0===n.parts||!0===n.tokens){let e;for(let i=0;i<r.length;i++){const s=e?e+1:d,u=r[i],l=t.slice(s,u);n.tokens&&(0===i&&0!==d?(o[i].isPrefix=!0,o[i].value=L):o[i].value=l,Bt(o[i]),O.maxDepth+=o[i].depth),0===i&&""===l||a.push(l),e=u}if(e&&e+1<t.length){const i=t.slice(e+1);a.push(i),n.tokens&&(o[o.length-1].value=i,Bt(o[o.length-1]),O.maxDepth+=o[o.length-1].depth)}O.slashes=r,O.parts=a}return O};const Pt=mt,Ht=rt,{MAX_LENGTH:kt,POSIX_REGEX_SOURCE:Ft,REGEX_NON_SPECIAL_CHARS:Ut,REGEX_SPECIAL_CHARS_BACKREF:$t,REPLACEMENTS:Gt}=Pt,jt=(t,e)=>{if("function"==typeof e.expandRange)return e.expandRange(...t,e);t.sort();const n=`[${t.join("-")}]`;try{new RegExp(n)}catch(e){return t.map((t=>Ht.escapeRegex(t))).join("..")}return n},Kt=(t,e)=>`Missing ${t}: "${e}" - use "\\\\${e}" to match literal characters`,Vt=(t,e)=>{if("string"!=typeof t)throw new TypeError("Expected a string");t=Gt[t]||t;const n={...e},i="number"==typeof n.maxLength?Math.min(kt,n.maxLength):kt;let s=t.length;if(s>i)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${i}`);const r={type:"bos",value:"",output:n.prepend||""},o=[r],a=n.capture?"":"?:",u=Ht.isWindows(e),l=Pt.globChars(u),h=Pt.extglobChars(l),{DOT_LITERAL:c,PLUS_LITERAL:d,SLASH_LITERAL:p,ONE_CHAR:f,DOTS_SLASH:_,NO_DOT:m,NO_DOT_SLASH:g,NO_DOTS_SLASH:v,QMARK:b,QMARK_NO_DOT:A,STAR:E,START_ANCHOR:y}=l,w=t=>`(${a}(?:(?!${y}${t.dot?_:c}).)*?)`,T=n.dot?"":m,x=n.dot?b:A;let S=!0===n.bash?w(n):E;n.capture&&(S=`(${S})`),"boolean"==typeof n.noext&&(n.noextglob=n.noext);const R={input:t,index:-1,start:0,dot:!0===n.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:o};t=Ht.removePrefix(t,R),s=t.length;const C=[],L=[],M=[];let O,N=r;const I=()=>R.index===s-1,B=R.peek=(e=1)=>t[R.index+e],D=R.advance=()=>t[++R.index]||"",P=()=>t.slice(R.index+1),H=(t="",e=0)=>{R.consumed+=t,R.index+=e},k=t=>{R.output+=null!=t.output?t.output:t.value,H(t.value)},F=()=>{let t=1;for(;"!"===B()&&("("!==B(2)||"?"===B(3));)D(),R.start++,t++;return t%2!=0&&(R.negated=!0,R.start++,!0)},U=t=>{R[t]++,M.push(t)},$=t=>{R[t]--,M.pop()},G=t=>{if("globstar"===N.type){const e=R.braces>0&&("comma"===t.type||"brace"===t.type),n=!0===t.extglob||C.length&&("pipe"===t.type||"paren"===t.type);"slash"===t.type||"paren"===t.type||e||n||(R.output=R.output.slice(0,-N.output.length),N.type="star",N.value="*",N.output=S,R.output+=N.output)}if(C.length&&"paren"!==t.type&&(C[C.length-1].inner+=t.value),(t.value||t.output)&&k(t),N&&"text"===N.type&&"text"===t.type)return N.value+=t.value,void(N.output=(N.output||"")+t.value);t.prev=N,o.push(t),N=t},j=(t,e)=>{const i={...h[e],conditions:1,inner:""};i.prev=N,i.parens=R.parens,i.output=R.output;const s=(n.capture?"(":"")+i.open;U("parens"),G({type:t,value:e,output:R.output?"":f}),G({type:"paren",extglob:!0,value:D(),output:s}),C.push(i)},K=t=>{let e,i=t.close+(n.capture?")":"");if("negate"===t.type){let s=S;t.inner&&t.inner.length>1&&t.inner.includes("/")&&(s=w(n)),(s!==S||I()||/^\)+$/.test(P()))&&(i=t.close=`)$))${s}`),t.inner.includes("*")&&(e=P())&&/^\.[^\\/.]+$/.test(e)&&(i=t.close=`)${e})${s})`),"bos"===t.prev.type&&(R.negatedExtglob=!0)}G({type:"paren",extglob:!0,value:O,output:i}),$("parens")};if(!1!==n.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(t)){let i=!1,s=t.replace($t,((t,e,n,s,r,o)=>"\\"===s?(i=!0,t):"?"===s?e?e+s+(r?b.repeat(r.length):""):0===o?x+(r?b.repeat(r.length):""):b.repeat(n.length):"."===s?c.repeat(n.length):"*"===s?e?e+s+(r?S:""):S:e?t:`\\${t}`));return!0===i&&(s=!0===n.unescape?s.replace(/\\/g,""):s.replace(/\\+/g,(t=>t.length%2==0?"\\\\":t?"\\":""))),s===t&&!0===n.contains?(R.output=t,R):(R.output=Ht.wrapOutput(s,R,e),R)}for(;!I();){if(O=D(),"\0"===O)continue;if("\\"===O){const t=B();if("/"===t&&!0!==n.bash)continue;if("."===t||";"===t)continue;if(!t){O+="\\",G({type:"text",value:O});continue}const e=/^\\+/.exec(P());let i=0;if(e&&e[0].length>2&&(i=e[0].length,R.index+=i,i%2!=0&&(O+="\\")),!0===n.unescape?O=D():O+=D(),0===R.brackets){G({type:"text",value:O});continue}}if(R.brackets>0&&("]"!==O||"["===N.value||"[^"===N.value)){if(!1!==n.posix&&":"===O){const t=N.value.slice(1);if(t.includes("[")&&(N.posix=!0,t.includes(":"))){const t=N.value.lastIndexOf("["),e=N.value.slice(0,t),n=N.value.slice(t+2),i=Ft[n];if(i){N.value=e+i,R.backtrack=!0,D(),r.output||1!==o.indexOf(N)||(r.output=f);continue}}}("["===O&&":"!==B()||"-"===O&&"]"===B())&&(O=`\\${O}`),"]"!==O||"["!==N.value&&"[^"!==N.value||(O=`\\${O}`),!0===n.posix&&"!"===O&&"["===N.value&&(O="^"),N.value+=O,k({value:O});continue}if(1===R.quotes&&'"'!==O){O=Ht.escapeRegex(O),N.value+=O,k({value:O});continue}if('"'===O){R.quotes=1===R.quotes?0:1,!0===n.keepQuotes&&G({type:"text",value:O});continue}if("("===O){U("parens"),G({type:"paren",value:O});continue}if(")"===O){if(0===R.parens&&!0===n.strictBrackets)throw new SyntaxError(Kt("opening","("));const t=C[C.length-1];if(t&&R.parens===t.parens+1){K(C.pop());continue}G({type:"paren",value:O,output:R.parens?")":"\\)"}),$("parens");continue}if("["===O){if(!0!==n.nobracket&&P().includes("]"))U("brackets");else{if(!0!==n.nobracket&&!0===n.strictBrackets)throw new SyntaxError(Kt("closing","]"));O=`\\${O}`}G({type:"bracket",value:O});continue}if("]"===O){if(!0===n.nobracket||N&&"bracket"===N.type&&1===N.value.length){G({type:"text",value:O,output:`\\${O}`});continue}if(0===R.brackets){if(!0===n.strictBrackets)throw new SyntaxError(Kt("opening","["));G({type:"text",value:O,output:`\\${O}`});continue}$("brackets");const t=N.value.slice(1);if(!0===N.posix||"^"!==t[0]||t.includes("/")||(O=`/${O}`),N.value+=O,k({value:O}),!1===n.literalBrackets||Ht.hasRegexChars(t))continue;const e=Ht.escapeRegex(N.value);if(R.output=R.output.slice(0,-N.value.length),!0===n.literalBrackets){R.output+=e,N.value=e;continue}N.value=`(${a}${e}|${N.value})`,R.output+=N.value;continue}if("{"===O&&!0!==n.nobrace){U("braces");const t={type:"brace",value:O,output:"(",outputIndex:R.output.length,tokensIndex:R.tokens.length};L.push(t),G(t);continue}if("}"===O){const t=L[L.length-1];if(!0===n.nobrace||!t){G({type:"text",value:O,output:O});continue}let e=")";if(!0===t.dots){const t=o.slice(),i=[];for(let e=t.length-1;e>=0&&(o.pop(),"brace"!==t[e].type);e--)"dots"!==t[e].type&&i.unshift(t[e].value);e=jt(i,n),R.backtrack=!0}if(!0!==t.comma&&!0!==t.dots){const n=R.output.slice(0,t.outputIndex),i=R.tokens.slice(t.tokensIndex);t.value=t.output="\\{",O=e="\\}",R.output=n;for(const t of i)R.output+=t.output||t.value}G({type:"brace",value:O,output:e}),$("braces"),L.pop();continue}if("|"===O){C.length>0&&C[C.length-1].conditions++,G({type:"text",value:O});continue}if(","===O){let t=O;const e=L[L.length-1];e&&"braces"===M[M.length-1]&&(e.comma=!0,t="|"),G({type:"comma",value:O,output:t});continue}if("/"===O){if("dot"===N.type&&R.index===R.start+1){R.start=R.index+1,R.consumed="",R.output="",o.pop(),N=r;continue}G({type:"slash",value:O,output:p});continue}if("."===O){if(R.braces>0&&"dot"===N.type){"."===N.value&&(N.output=c);const t=L[L.length-1];N.type="dots",N.output+=O,N.value+=O,t.dots=!0;continue}if(R.braces+R.parens===0&&"bos"!==N.type&&"slash"!==N.type){G({type:"text",value:O,output:c});continue}G({type:"dot",value:O,output:c});continue}if("?"===O){if(!(N&&"("===N.value)&&!0!==n.noextglob&&"("===B()&&"?"!==B(2)){j("qmark",O);continue}if(N&&"paren"===N.type){const t=B();let e=O;if("<"===t&&!Ht.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");("("===N.value&&!/[!=<:]/.test(t)||"<"===t&&!/<([!=]|\w+>)/.test(P()))&&(e=`\\${O}`),G({type:"text",value:O,output:e});continue}if(!0!==n.dot&&("slash"===N.type||"bos"===N.type)){G({type:"qmark",value:O,output:A});continue}G({type:"qmark",value:O,output:b});continue}if("!"===O){if(!0!==n.noextglob&&"("===B()&&("?"!==B(2)||!/[!=<:]/.test(B(3)))){j("negate",O);continue}if(!0!==n.nonegate&&0===R.index){F();continue}}if("+"===O){if(!0!==n.noextglob&&"("===B()&&"?"!==B(2)){j("plus",O);continue}if(N&&"("===N.value||!1===n.regex){G({type:"plus",value:O,output:d});continue}if(N&&("bracket"===N.type||"paren"===N.type||"brace"===N.type)||R.parens>0){G({type:"plus",value:O});continue}G({type:"plus",value:d});continue}if("@"===O){if(!0!==n.noextglob&&"("===B()&&"?"!==B(2)){G({type:"at",extglob:!0,value:O,output:""});continue}G({type:"text",value:O});continue}if("*"!==O){"$"!==O&&"^"!==O||(O=`\\${O}`);const t=Ut.exec(P());t&&(O+=t[0],R.index+=t[0].length),G({type:"text",value:O});continue}if(N&&("globstar"===N.type||!0===N.star)){N.type="star",N.star=!0,N.value+=O,N.output=S,R.backtrack=!0,R.globstar=!0,H(O);continue}let e=P();if(!0!==n.noextglob&&/^\([^?]/.test(e)){j("star",O);continue}if("star"===N.type){if(!0===n.noglobstar){H(O);continue}const i=N.prev,s=i.prev,r="slash"===i.type||"bos"===i.type,o=s&&("star"===s.type||"globstar"===s.type);if(!0===n.bash&&(!r||e[0]&&"/"!==e[0])){G({type:"star",value:O,output:""});continue}const a=R.braces>0&&("comma"===i.type||"brace"===i.type),u=C.length&&("pipe"===i.type||"paren"===i.type);if(!r&&"paren"!==i.type&&!a&&!u){G({type:"star",value:O,output:""});continue}for(;"/**"===e.slice(0,3);){const n=t[R.index+4];if(n&&"/"!==n)break;e=e.slice(3),H("/**",3)}if("bos"===i.type&&I()){N.type="globstar",N.value+=O,N.output=w(n),R.output=N.output,R.globstar=!0,H(O);continue}if("slash"===i.type&&"bos"!==i.prev.type&&!o&&I()){R.output=R.output.slice(0,-(i.output+N.output).length),i.output=`(?:${i.output}`,N.type="globstar",N.output=w(n)+(n.strictSlashes?")":"|$)"),N.value+=O,R.globstar=!0,R.output+=i.output+N.output,H(O);continue}if("slash"===i.type&&"bos"!==i.prev.type&&"/"===e[0]){const t=void 0!==e[1]?"|$":"";R.output=R.output.slice(0,-(i.output+N.output).length),i.output=`(?:${i.output}`,N.type="globstar",N.output=`${w(n)}${p}|${p}${t})`,N.value+=O,R.output+=i.output+N.output,R.globstar=!0,H(O+D()),G({type:"slash",value:"/",output:""});continue}if("bos"===i.type&&"/"===e[0]){N.type="globstar",N.value+=O,N.output=`(?:^|${p}|${w(n)}${p})`,R.output=N.output,R.globstar=!0,H(O+D()),G({type:"slash",value:"/",output:""});continue}R.output=R.output.slice(0,-N.output.length),N.type="globstar",N.output=w(n),N.value+=O,R.output+=N.output,R.globstar=!0,H(O);continue}const i={type:"star",value:O,output:S};!0!==n.bash?!N||"bracket"!==N.type&&"paren"!==N.type||!0!==n.regex?(R.index!==R.start&&"slash"!==N.type&&"dot"!==N.type||("dot"===N.type?(R.output+=g,N.output+=g):!0===n.dot?(R.output+=v,N.output+=v):(R.output+=T,N.output+=T),"*"!==B()&&(R.output+=f,N.output+=f)),G(i)):(i.output=O,G(i)):(i.output=".*?","bos"!==N.type&&"slash"!==N.type||(i.output=T+i.output),G(i))}for(;R.brackets>0;){if(!0===n.strictBrackets)throw new SyntaxError(Kt("closing","]"));R.output=Ht.escapeLast(R.output,"["),$("brackets")}for(;R.parens>0;){if(!0===n.strictBrackets)throw new SyntaxError(Kt("closing",")"));R.output=Ht.escapeLast(R.output,"("),$("parens")}for(;R.braces>0;){if(!0===n.strictBrackets)throw new SyntaxError(Kt("closing","}"));R.output=Ht.escapeLast(R.output,"{"),$("braces")}if(!0===n.strictSlashes||"star"!==N.type&&"bracket"!==N.type||G({type:"maybe_slash",value:"",output:`${p}?`}),!0===R.backtrack){R.output="";for(const t of R.tokens)R.output+=null!=t.output?t.output:t.value,t.suffix&&(R.output+=t.suffix)}return R};Vt.fastpaths=(t,e)=>{const n={...e},i="number"==typeof n.maxLength?Math.min(kt,n.maxLength):kt,s=t.length;if(s>i)throw new SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${i}`);t=Gt[t]||t;const r=Ht.isWindows(e),{DOT_LITERAL:o,SLASH_LITERAL:a,ONE_CHAR:u,DOTS_SLASH:l,NO_DOT:h,NO_DOTS:c,NO_DOTS_SLASH:d,STAR:p,START_ANCHOR:f}=Pt.globChars(r),_=n.dot?c:h,m=n.dot?d:h,g=n.capture?"":"?:";let v=!0===n.bash?".*?":p;n.capture&&(v=`(${v})`);const b=t=>!0===t.noglobstar?v:`(${g}(?:(?!${f}${t.dot?l:o}).)*?)`,A=t=>{switch(t){case"*":return`${_}${u}${v}`;case".*":return`${o}${u}${v}`;case"*.*":return`${_}${v}${o}${u}${v}`;case"*/*":return`${_}${v}${a}${u}${m}${v}`;case"**":return _+b(n);case"**/*":return`(?:${_}${b(n)}${a})?${m}${u}${v}`;case"**/*.*":return`(?:${_}${b(n)}${a})?${m}${v}${o}${u}${v}`;case"**/.*":return`(?:${_}${b(n)}${a})?${o}${u}${v}`;default:{const e=/^(.*?)\.(\w+)$/.exec(t);if(!e)return;const n=A(e[1]);if(!n)return;return n+o+e[2]}}},E=Ht.removePrefix(t,{negated:!1,prefix:""});let y=A(E);return y&&!0!==n.strictSlashes&&(y+=`${a}?`),y};const zt=st,Wt=Dt,Yt=Vt,qt=rt,Xt=mt,Qt=(t,e,n=!1)=>{if(Array.isArray(t)){const i=t.map((t=>Qt(t,e,n)));return t=>{for(const e of i){const n=e(t);if(n)return n}return!1}}const i=(s=t)&&"object"==typeof s&&!Array.isArray(s)&&t.tokens&&t.input;var s;if(""===t||"string"!=typeof t&&!i)throw new TypeError("Expected pattern to be a non-empty string");const r=e||{},o=qt.isWindows(e),a=i?Qt.compileRe(t,e):Qt.makeRe(t,e,!1,!0),u=a.state;delete a.state;let l=()=>!1;if(r.ignore){const t={...e,ignore:null,onMatch:null,onResult:null};l=Qt(r.ignore,t,n)}const h=(n,i=!1)=>{const{isMatch:s,match:h,output:c}=Qt.test(n,a,e,{glob:t,posix:o}),d={glob:t,state:u,regex:a,posix:o,input:n,output:c,match:h,isMatch:s};return"function"==typeof r.onResult&&r.onResult(d),!1===s?(d.isMatch=!1,!!i&&d):l(n)?("function"==typeof r.onIgnore&&r.onIgnore(d),d.isMatch=!1,!!i&&d):("function"==typeof r.onMatch&&r.onMatch(d),!i||d)};return n&&(h.state=u),h};Qt.test=(t,e,n,{glob:i,posix:s}={})=>{if("string"!=typeof t)throw new TypeError("Expected input to be a string");if(""===t)return{isMatch:!1,output:""};const r=n||{},o=r.format||(s?qt.toPosixSlashes:null);let a=t===i,u=a&&o?o(t):t;return!1===a&&(u=o?o(t):t,a=u===i),!1!==a&&!0!==r.capture||(a=!0===r.matchBase||!0===r.basename?Qt.matchBase(t,e,n,s):e.exec(u)),{isMatch:Boolean(a),match:a,output:u}},Qt.matchBase=(t,e,n,i=qt.isWindows(n))=>(e instanceof RegExp?e:Qt.makeRe(e,n)).test(zt.basename(t)),Qt.isMatch=(t,e,n)=>Qt(e,n)(t),Qt.parse=(t,e)=>Array.isArray(t)?t.map((t=>Qt.parse(t,e))):Yt(t,{...e,fastpaths:!1}),Qt.scan=(t,e)=>Wt(t,e),Qt.compileRe=(t,e,n=!1,i=!1)=>{if(!0===n)return t.output;const s=e||{},r=s.contains?"":"^",o=s.contains?"":"$";let a=`${r}(?:${t.output})${o}`;t&&!0===t.negated&&(a=`^(?!${a}).*$`);const u=Qt.toRegex(a,e);return!0===i&&(u.state=t),u},Qt.makeRe=(t,e={},n=!1,i=!1)=>{if(!t||"string"!=typeof t)throw new TypeError("Expected a non-empty string");let s={negated:!1,fastpaths:!0};return!1===e.fastpaths||"."!==t[0]&&"*"!==t[0]||(s.output=Yt.fastpaths(t,e)),s.output||(s=Yt(t,e)),Qt.compileRe(s,e,n,i)},Qt.toRegex=(t,e)=>{try{const n=e||{};return new RegExp(t,n.flags||(n.nocase?"i":""))}catch(t){if(e&&!0===e.debug)throw t;return/$^/}},Qt.constants=Xt;var Zt=Qt;class Jt{constructor(){this._buffers={}}clear(){this._buffers={}}put(t,e){this._buffers[t]=e}get(t){return this._buffers[t]}keys(){return Object.keys(this._buffers)}}class te extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML="",Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML="",Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("asset-pack",te)}static get observedAttributes(){return["src"]}set src(t){this.setAttribute("src",t)}get src(){return this._src}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._src="",this._files=new Jt,this._cache={},this._loading={},this._pipeline={},this.onLoad=this.onLoad.bind(this)}get files(){return this._files}async pipe(t,e){let n,i;if("string"==typeof t)n=t,n in this._pipeline||(t=Zt.makeRe(t));else{if(!(t instanceof RegExp))throw new Error("Filter must be either a RegExp or glob string.");n=t.source}n in this._pipeline?i=this._pipeline[n]:(i=new ee(t),this._pipeline[n]=i),i.addHandler(e),await Promise.all(Object.entries(this._cache).map((([t,n])=>i.matches(t)?e(n,t):null)))}async cache(t,e,n={}){const{ephemeral:i}=n,s=this._cache[t],r=this._loading[t];this._cache[t]=e,await Promise.all(Object.values(this._pipeline).map((n=>n.matches(t)?n.process(t,e):null))),r&&(r.resolve(e),delete this._loading[e]),i&&this._cache[e]===e&&(s?this._cache[e]=s:delete this._cache[e])}async loadAsset(t,e=5e3){let n=this._cache[t];if(n)return n;if(t in this._loading)return this._loading[t].promise;{let n=new ne(e);return this._loading[t]=n,n.promise}}clearAssets(){for(let t of Object.values(this._loading))t.reject(new Error("Stop loading to clear all assets."));this._loading={},this._cache={}}deleteAsset(t){t in this._loading&&(this._loading[t].reject(new Error("Stop loading to delete asset.")),delete this._loading[t]),t in this._cache&&delete this._cache[t]}getAsset(t){return this._cache[t]}hasAsset(t){let e=this._cache[t];return e||!1}connectedCallback(){!function(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let n=t[e];delete t[e],t[e]=n}}(this,"src")}attributeChangedCallback(t,e,n){switch(t){case"src":this._src=n,n&&fetch(n).then(this.onLoad).catch((t=>console.error(`Failed to load asset pack: ${t}`)))}}async onLoad(t){let e=await t.arrayBuffer();await new Promise(((t,n)=>{G(new Uint8Array(e),((e,i)=>{if(e)n(e);else{let e=this._files;Promise.all(Object.entries(i).map((([t,n])=>(e.put(t,n),this.cache(t,n))))).then((()=>t())).catch(n)}}))})),this.dispatchEvent(new CustomEvent("load",{composed:!0}))}}te.define();class ee{constructor(t){this.filter=t,this.handlers=[]}matches(t){return this.filter.test(t)}async process(t,e){return Promise.all(this.handlers.map((n=>n(t,e))))}addHandler(t){this.handlers.push(t)}}class ne{constructor(t){this._resolve=null,this._reject=null,this._reason=null,this._value=null,this._timeoutHandle=t>0?setTimeout((()=>{this.reject(`Asset loading exceeded timeout of ${t} ms.`)}),t):null,this._promise=new Promise(((t,e)=>{this._value?t(this._value):this._resolve=t,this._reason?e(this._reason):this._reject=e}))}get promise(){return this._promise}resolve(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._resolve?this._resolve(t):this._value=t}reject(t){this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null),this._reject?this._reject(t):this._reason=t}}var ie=Object.freeze({__proto__:null,AssetPack:te});const se="noscale",re="fit",oe="scale",ae="fill",ue="stretch";class le extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <div class="content">\n        <canvas>\n            Oh no! Your browser does not support canvas.\n        </canvas>\n        <slot id="inner"></slot>\n    </div>\n    <slot name="frame"></slot>\n</div>',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=':host {\n    display: inline-block;\n    color: #555555;\n}\n\n.container {\n    display: flex;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\n\n.content {\n    position: relative;\n    margin: auto;\n}\n\n.content > *:not(canvas) {\n    width: 100%;\n    height: 100%;\n}\n\ncanvas {\n    background: #000000;\n    image-rendering: pixelated;\n}\n\nlabel {\n    position: absolute;\n    font-family: monospace;\n    color: currentColor;\n}\n\n#inner {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n}\n\n#title {\n    left: 0.5rem;\n    top: 0.5rem;\n}\n\n#fps {\n    right: 0.5rem;\n    top: 0.5rem;\n}\n\n#dimension {\n    left: 0.5rem;\n    bottom: 0.5rem;\n}\n\n.hidden {\n    display: none;\n}\n\n:host([debug]) .container {\n    outline: 6px dashed rgba(0, 0, 0, 0.1);\n    outline-offset: -4px;\n    background-color: rgba(0, 0, 0, 0.1);\n}\n\n:host([mode="noscale"]) canvas {\n    margin: 0;\n    top: 0;\n    left: 0;\n}\n\n:host([mode="stretch"]) canvas,\n:host([mode="scale"]) canvas {\n    width: 100%;\n    height: 100%;\n}\n\n:host([mode="fit"]),\n:host([mode="scale"]),\n:host([mode="center"]),\n:host([mode="stretch"]),\n:host([mode="fill"]) {\n    width: 100%;\n    height: 100%;\n}\n\n:host([full]) {\n    width: 100vw !important;\n    height: 100vh !important;\n}\n\n:host([disabled]) {\n    display: none;\n}\n\nslot {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n}\n\n::slotted(*) {\n    pointer-events: auto;\n}\n',Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("display-port",this)}static get observedAttributes(){return["debug","disabled","width","height","onframe","id","class"]}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get debug(){return this._debug}set debug(t){this.toggleAttribute("debug",t)}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._contentElement=this.shadowRoot.querySelector(".content"),this._innerElement=this.shadowRoot.querySelector("#inner"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._debug=!1,this._disabled=!1,this._width=300,this._height=150,this._onframe=void 0,this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._resizeTimeoutHandle=0,this._resizeCanvasWidth=0,this._resizeCanvasHeight=0,this.update=this.update.bind(this),this.onDelayCanvasResize=this.onDelayCanvasResize.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){he(this,"mode"),he(this,"debug"),he(this,"disabled"),he(this,"width"),he(this,"height"),he(this,"onframe"),this.hasAttribute("mode")||this.setAttribute("mode","fit"),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.updateCanvasSize(!0),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,n){switch(t){case"debug":this._debug=null!==n;break;case"disabled":this._disabled=null!==n;break;case"width":this._width=Number(n);break;case"height":this._height=Number(n);break;case"onframe":this.onframe=new Function("event","with(document){with(this){"+n+"}}").bind(this)}switch(t){case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}getContext(t="2d",e){return this._canvasElement.getContext(t,e)}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}update(t){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize(!1);const e=t-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=t,this._debug){const t=e<=0?"--":String(Math.round(1e3/e)).padStart(2,"0");this._fpsElement.textContent!==t&&(this._fpsElement.textContent=t);if(this.mode===se){let t=`${this._width}x${this._height}`;this._dimensionElement.textContent!==t&&(this._dimensionElement.textContent=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.textContent!==t&&(this._dimensionElement.textContent=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:t,prevTime:this._prevAnimationFrameTime,deltaTime:e,canvas:this._canvasElement},bubbles:!1,composed:!0}))}onDelayCanvasResize(){this._resizeTimeoutHandle=0,this.updateCanvasSize(!0)}delayCanvasResize(t,e){t===this._resizeCanvasWidth&&e===this._resizeCanvasHeight||(this._resizeCanvasWidth=t,this._resizeCanvasHeight=e,this._resizeTimeoutHandle&&clearTimeout(this._resizeTimeoutHandle),this._resizeTimeoutHandle=setTimeout(this.onDelayCanvasResize,200))}updateCanvasSize(t=!0){const e=this.shadowRoot.host.getBoundingClientRect(),n=e.width,i=e.height;let s=this._canvasElement,r=this._width,o=this._height;const a=this.mode;if(a===ue||a===ae)r=n,o=i;else if(a!==se&&(n<r||i<o||a===re||a==oe)){let t=n/r,e=i/o;t<e?(r=n,o*=t):(r*=e,o=i)}if(r=Math.floor(r),o=Math.floor(o),void 0===t&&(t=s.clientWidth!==r||s.clientHeight!==o),!t)return void this.delayCanvasResize(r,o);let u=.5*Math.min(r/this._width,o/this._height);if(this._innerElement.style.fontSize=`font-size: ${u}em`,t){a===oe?(s.width=this._width,s.height=this._height):a!==ue&&(s.width=r,s.height=o);let t=this._contentElement.style;t.width=`${r}px`,t.height=`${o}px`,a!==re&&a!==ae||(this._width=r,this._height=o),this.dispatchEvent(new CustomEvent("resize",{detail:{width:r,height:o},bubbles:!1,composed:!0}))}}}function he(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let n=t[e];delete t[e],t[e]=n}}le.define();var ce=Object.freeze({__proto__:null,DisplayPort:le});class de{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,n){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e={}){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}}class pe extends de{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array;for(let n=0;n<t;++n)e.push(this.constructor.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e,n=this._state,i=n.length;if(t<=i)e=n.slice(0,t);else{e=n;for(let n=i;n<t;++n)e.push(this.constructor.createAxisBindingState())}this._state=e,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,n=0,i=0;const s=e.length;for(let t=0;t<s;++t){let s=e[t];n+=s.value*(s.inverted?-1:1),i+=s.delta,e[t].delta=0}this._value=n,this._delta=i,super.onPoll(t)}onUpdate(t,e,n){void 0===e?this.onAxisChange(t,n):this.onAxisMove(t,e,n)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e={}){super.onBind(t,e);const{inverted:n=!1}=e;this._state[t].inverted=n}onAxisMove(t,e,n){let i=this._state[t];i.value=e,i.delta+=n}onAxisChange(t,e){let n=this._state[t];n.value+=e,n.delta+=e}onAxisStatus(t,e){let n=this._state[t],i=n.value;n.value=e,n.delta=e-i}}class fe extends de{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t),this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e,n=this._state;t<=n.length?e=n.slice(0,t):(e=new Uint8Array(t),e.set(n)),this._state=e,super.resize(t)}getState(t){let e=this._state[t];return(1&e?1:0)*(16&e?-1:1)}onPoll(t){let e=this._state,n=0,i=0,s=0,r=0,o=0;const a=e.length;for(let t=0;t<a;++t){let a=e[t],u=1&a;i|=u,s|=2&a,r|=4&a,o|=8&a,n+=(u?1:0)*(16&a?-1:1),e[t]&=241}this._value=n,this._down=0!==i,this._pressed=0!==s,this._repeated=0!==r,this._released=0!==o,super.onPoll(t)}onUpdate(t,e,n){n>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,0!==e)}onBind(t,e={}){super.onBind(t,e);const{inverted:n=!1}=e;let i=this._state;n?i[t]|=16:i[t]&=239}onButtonPressed(t){let e=this._state,n=e[t];1&n||(n|=2,n|=1),n|=4,e[t]=n}onButtonReleased(t){let e=this._state,n=e[t];1&n&&(n|=8,n&=254),e[t]=n}onButtonStatus(t,e){let n=this._state,i=n[t],s=Boolean(1&i);e?i|=1:i&=254,s&&!e&&(i|=8),!s&&e&&(i|=2,i|=4),n[t]=i}}class _e{get polling(){return!!this.ref&&this.ref.polling}get value(){return this.ref?this.ref.value:0}constructor(t,e,n,i){this.name=t,this.device=e,this.code=n,this.opts=i,this.ref=null}setRef(t){return this.ref=t,this}getState(t){return this.ref?this.ref.getState(t):0}}class me extends _e{get delta(){return this.ref?this.ref.delta:0}constructor(t,e,n,i){super(t,e,n,i)}}class ge extends _e{get pressed(){return!!this.ref&&this.ref.pressed}get repeated(){return!!this.ref&&this.ref.repeated}get released(){return!!this.ref&&this.ref.released}get down(){return!!this.ref&&this.ref.down}constructor(t,e,n,i){super(t,e,n,i)}}class ve extends me{constructor(t,e,n,i){super(t,e,i,void 0),this.negativeCode=n}}class be{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let n=this.listeners;t in n?n[t].push(e):n[t]=[e]}removeEventListener(t,e){let n=this.listeners;if(t in n){let i=n[t],s=i.indexOf(e);s>=0&&i.splice(s,1)}}dispatchInputEvent(t){let e=0;for(let n of this.listeners.input)e|=n(t);return Boolean(e)}}class Ae extends be{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,n={}){super(t,e);const{ignoreRepeat:i=!0}=n;this.ignoreRepeat=i,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;return e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}}class Ee extends be{static isAxis(t){return"PosX"===t||"PosY"===t||"WheelX"===t||"WheelY"===t||"WheelZ"===t}static isButton(t){return!this.isAxis(t)}constructor(t,e,n={}){super(t,e);const{eventsOnFocus:i=!0}=n;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,n,i;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=10*t.deltaX,n=10*t.deltaY,i=10*t.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:e=100*t.deltaX,n=100*t.deltaY,i=100*t.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,n=t.deltaY,i=t.deltaZ}let s=0,r=this._wheelObject;if(r.code="WheelX",r.movement=e,s|=this.dispatchInputEvent(r),r.code="WheelY",r.movement=n,s|=this.dispatchInputEvent(r),r.code="WheelZ",r.movement=i,s|=this.dispatchInputEvent(r),s)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;return e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const e=this.canvasTarget,{clientWidth:n,clientHeight:i}=e,s=e.getBoundingClientRect();let r=t.movementX/n,o=t.movementY/i,a=(t.clientX-s.left)/n,u=(t.clientY-s.top)/i,l=this._positionObject;l.code="PosX",l.value=a,l.movement=r,this.dispatchInputEvent(l),l.code="PosY",l.value=u,l.movement=o,this.dispatchInputEvent(l)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}}class ye extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<kbd>\n    <span id="name"><slot></slot></span>\n    <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML='kbd {\n    position: relative;\n    display: inline-block;\n    border-radius: 3px;\n    border: 1px solid #888888;\n    font-size: 0.85em;\n    font-weight: 700;\n    text-rendering: optimizeLegibility;\n    line-height: 12px;\n    height: 14px;\n    padding: 2px 4px;\n    color: #444444;\n    background-color: #eeeeee;\n    box-shadow: inset 0 -3px 0 #aaaaaa;\n    overflow: hidden;\n}\n\nkbd:empty::after {\n    content: "<?>";\n    opacity: 0.6;\n}\n\n.disabled {\n    opacity: 0.6;\n    box-shadow: none;\n    background-color: #aaaaaa;\n}\n\n.hidden {\n    display: none;\n}\n\n#value {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    font-size: 0.85em;\n    padding: 0 4px;\n    padding-top: 2px;\n    color: #cccccc;\n    background-color: #333333;\n    box-shadow: inset 0 3px 0 #222222;\n}\n',Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,e,n){switch(t){case"name":this._name=n,this._nameElement.textContent=n;break;case"value":this._value=n,null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=n,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=null!==n,this._kbdElement.classList.toggle("disabled",null!==n)}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}}ye.define();class we{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return null!==this.animationFrameHandle}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}}class Te{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){const{device:e,code:n,event:i,value:s,movement:r,control:o,shift:a,alt:u}=t;let l=this.bindings.getBindings(e,n);switch(i){case"pressed":for(let{input:t,index:e}of l)t.onUpdate(e,1,1);break;case"released":for(let{input:t,index:e}of l)t.onUpdate(e,0,-1);break;case"move":for(let{input:t,index:e}of l)t.onUpdate(e,s,r);break;case"wheel":for(let{input:t,index:e}of l)t.onUpdate(e,void 0,r)}return l.length>0}}class xe{constructor(t,e,n,i){this.device=t,this.code=e,this.input=n,this.index=i}}class Se{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,n,i={}){let s,r=this.inputMap;if(r.has(t)){let o=r.get(t),a=t.size;t.onBind(a,i),s=new xe(e,n,t,a),o.push(s)}else{let o=[];r.set(t,o);let a=0;t.onBind(a,i),s=new xe(e,n,t,a),o.push(s)}let o=this.bindingMap;e in o?n in o[e]?o[e][n].push(s):o[e][n]=[s]:o[e]={[n]:[s]}}unbind(t){let e=this.inputMap;if(e.has(t)){let n=this.bindingMap,i=e.get(t);for(let t of i){let{device:e,code:i}=t,s=n[e][i],r=s.indexOf(t);s.splice(r,1)}i.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let n=this.bindingMap;if(t in n){let i=n[t];if(e in i)return i[e]}return[]}}class Re{constructor(t,e={}){this.inputs={},this.devices=[new Ee("Mouse",t),new Ae("Keyboard",t)],this.bindings=new Se,this.adapter=new Te(this.bindings),this.autopoller=new we(this.adapter),this.eventTarget=t,this.anyButton=new fe(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new pe(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let t of this.devices)t.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let e in t)t[e].length=0;this.autopoller.running&&this.autopoller.stop();for(let t of this.devices)t.removeEventListener("input",this.onInput),t.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let e of this.devices)e.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t){let e=this.autopoller.running,n=void 0===t?!e:Boolean(t);n!==e&&(n?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let n=this.listeners;t in n?n[t].push(e):n[t]=[e]}removeEventListener(t,e){let n=this.listeners;if(t in n){let i=n[t],s=i.indexOf(e);s>=0&&i.splice(s,1)}}dispatchEvent(t){const{type:e}=t;let n=0;for(let i of this.listeners[e])n|=i(t);return Boolean(n)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement)}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindBindings(t){for(let e of t){const t=e.name;if(e instanceof me)this.bindAxis(t,e.device,e.code,e.opts),e.setRef(this.getAxis(t));else if(e instanceof ge)this.bindButton(t,e.device,e.code,e.opts),e.setRef(this.getButton(t));else{if(!(e instanceof ve))throw new Error("Unknown binding type.");this.bindAxisButtons(t,e.device,e.negativeCode,e.code),e.setRef(this.getAxis(t))}}}bindButton(t,e,n,i){let s;this.hasButton(t)?s=this.getButton(t):(s=new fe(1),this.inputs[t]=s),this.bindings.bind(s,e,n,i),this.onBind()}bindAxis(t,e,n,i){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new pe(1),this.inputs[t]=s),this.bindings.bind(s,e,n,i),this.onBind()}bindAxisButtons(t,e,n,i){let s;this.hasAxis(t)?s=this.getAxis(t):(s=new pe(2),this.inputs[t]=s),this.bindings.bind(s,e,i),this.bindings.bind(s,e,n,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof fe}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof pe}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.inputs[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t){if(void 0===t)return this.anyButton.down;{let e=this.inputs;for(let n of t){if(e[n].down)return!0}}return!1}isAnyButtonPressed(t){if(void 0===t)return this.anyButton.pressed;{let e=this.inputs;for(let n of t){if(e[n].pressed)return!0}}return!1}isAnyButtonReleased(t){if(void 0===t)return this.anyButton.released;{let e=this.inputs;for(let n of t){if(e[n].released)return!0}}return!1}getAnyAxisValue(t){if(void 0===t)return this.anyAxis.value;{let e=this.inputs;for(let n of t){let t=e[n];if(t.value)return t.value}}return 0}getAnyAxisDelta(t){if(void 0===t)return this.anyAxis.delta;{let e=this.inputs;for(let n of t){let t=e[n];if(t.delta)return t.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}}class Ce extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<table>\n    <thead>\n        <tr class="tableHeader">\n            <th colspan=3>\n                <span class="tableTitle">\n                    <label id="title">\n                        input-source\n                    </label>\n                    <span id="slotContainer">\n                        <slot></slot>\n                    </span>\n                    <p>\n                        <label for="poll">poll</label>\n                        <output id="poll"></output>\n                    </p>\n                    <p>\n                        <label for="focus">focus</label>\n                        <output id="focus"></output>\n                    </p>\n                </span>\n            </th>\n        </tr>\n        <tr class="colHeader">\n            <th>name</th>\n            <th>value</th>\n            <th>key</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=':host {\n    display: block;\n}\n\ntable {\n    border-collapse: collapse;\n    font-family: monospace;\n}\n\ntable,\nth,\ntd {\n    border: 1px solid #666666;\n}\n\nth,\ntd {\n    padding: 5px 10px;\n}\n\ntd {\n    text-align: center;\n}\n\nthead th {\n    padding: 0;\n}\n\n.colHeader > th {\n    font-size: 0.8em;\n    padding: 0 10px;\n    letter-spacing: 3px;\n    background-color: #aaaaaa;\n    color: #666666;\n}\n\ntbody output {\n    border-radius: 0.3em;\n    padding: 3px;\n}\n\ntr:not(.primary) .name,\ntr:not(.primary) .value {\n    opacity: 0.3;\n}\n\ntr:nth-child(2n) {\n    background-color: #eeeeee;\n}\n\n.tableHeader {\n    color: #666666;\n}\n\n.tableTitle {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding: 4px;\n}\n\n#slotContainer {\n    flex: 1;\n}\n\np {\n    display: inline;\n    margin: 0;\n    padding: 0;\n    padding-right: 10px;\n}\n\n#poll:empty::after,\n#focus:empty::after {\n    content: "";\n    color: #ff0000;\n}\n',Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;this._for="",this._eventTarget=this,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){this._context&&(this._context.removeEventListener("bind",this.onInputContextBind),this._context.removeEventListener("unbind",this.onInputContextUnbind),this._context.removeEventListener("blur",this.onInputContextBlur),this._context.removeEventListener("focus",this.onInputContextFocus),this._context.destroy(),this._context=null)}attributeChangedCallback(t,e,n){switch(t){case"for":{let t,e;this._for=n,n?(t=document.getElementById(n),e=`${t.tagName.toLowerCase()}#${n}`):(t=this,e="input-port"),this._eventTarget=t,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${e}`}break;case"autopoll":this._autopoll=null!==n,this._context&&this._context.toggleAutoPoll(this._autopoll)}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){this.updateTable()}onInputContextUnbind(){this.updateTable()}onInputContextFocus(){this._focusElement.innerHTML=""}onInputContextBlur(){this._focusElement.innerHTML=""}getContext(t="axisbutton",e){switch(t){case"axisbutton":return this._context||(this._context=new Re(this._eventTarget,e),this._context.addEventListener("bind",this.onInputContextBind),this._context.addEventListener("unbind",this.onInputContextUnbind),this._context.addEventListener("blur",this.onInputContextBlur),this._context.addEventListener("focus",this.onInputContextFocus),this._autopoll&&this._context.toggleAutoPoll(!0)),this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected){if(!this._context)return this._outputElements={},void(this._bodyElement.innerHTML="");{let t=this._context,e=t.inputs,n=t.bindings,i={},s=[];for(let t of Object.keys(e)){let r=e[t],o=!0;for(let e of n.getBindingsByInput(r)){let n=Le(`${r.constructor.name}.${t}`,`${e.device}.${e.code}`,0,o);s.push(n),o&&(i[t]=n.querySelector("output"),o=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let t of s)this._bodyElement.appendChild(t)}}}updateTableValues(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let e of Object.keys(this._outputElements)){let n=this._outputElements[e],i=t[e].value;n.innerText=Number(i).toFixed(2)}}else for(let t of Object.keys(this._outputElements)){this._outputElements[t].innerText="---"}}updatePollStatus(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let e of Object.values(t))if(!e.polling)return void(this._pollElement.innerHTML="");this._pollElement.innerHTML=""}else this._pollElement.innerHTML="-"}}function Le(t,e,n,i=!0){let s=document.createElement("tr");i&&s.classList.add("primary");{let e=document.createElement("td");e.textContent=t,e.classList.add("name"),s.appendChild(e)}{let t=document.createElement("td"),e=document.createElement("output");e.innerText=i?Number(n).toFixed(2):"---",e.classList.add("value"),t.appendChild(e),s.appendChild(t)}{let t=document.createElement("td");t.classList.add("key");let n=new ye;n.innerText=e,t.appendChild(n),s.appendChild(t)}return s}Ce.define();const Me=Symbol("keyboardSource");const Oe=Symbol("mouseSource");var Ne=Object.freeze({__proto__:null,AutoPoller:we,Axis:pe,AxisBinding:me,AxisButtonBinding:ve,Button:fe,ButtonBinding:ge,CLEAR_DOWN_STATE_BITS:254,CLEAR_INVERTED_MODIFIER_BITS:239,CLEAR_POLL_BITS:241,DOWN_STATE_BIT:1,DeviceInputAdapter:Te,INVERTED_MODIFIER_BIT:16,InputBase:de,InputBindings:Se,InputCode:ye,InputContext:Re,InputDevice:be,InputPort:Ce,Keyboard:class{constructor(t,e){this.KeyA=new fe,this.KeyB=new fe,this.KeyC=new fe,this.KeyD=new fe,this.KeyE=new fe,this.KeyF=new fe,this.KeyG=new fe,this.KeyH=new fe,this.KeyI=new fe,this.KeyJ=new fe,this.KeyK=new fe,this.KeyL=new fe,this.KeyM=new fe,this.KeyN=new fe,this.KeyO=new fe,this.KeyP=new fe,this.KeyQ=new fe,this.KeyR=new fe,this.KeyS=new fe,this.KeyT=new fe,this.KeyU=new fe,this.KeyV=new fe,this.KeyW=new fe,this.KeyX=new fe,this.KeyY=new fe,this.KeyZ=new fe,this.Digit0=new fe,this.Digit1=new fe,this.Digit2=new fe,this.Digit3=new fe,this.Digit4=new fe,this.Digit5=new fe,this.Digit6=new fe,this.Digit7=new fe,this.Digit8=new fe,this.Digit9=new fe,this.Minus=new fe,this.Equal=new fe,this.BracketLeft=new fe,this.BracketRight=new fe,this.Semicolon=new fe,this.Quote=new fe,this.Backquote=new fe,this.Backslash=new fe,this.Comma=new fe,this.Period=new fe,this.Slash=new fe,this.Escape=new fe,this.Space=new fe,this.CapsLock=new fe,this.Backspace=new fe,this.Delete=new fe,this.Tab=new fe,this.Enter=new fe,this.ArrowUp=new fe,this.ArrowDown=new fe,this.ArrowLeft=new fe,this.ArrowRight=new fe;const n="Keyboard",i=new Ae(n,t,e),s=new Se;for(let t in this)if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];s.bind(e,n,t)}const r=new Te(s);i.addEventListener("input",r.onInput);const o=new we(r);o.start(),this[Me]={device:i,bindings:s,adapter:r,autopoller:o}}destroy(){const t=this[Me];t.autopoller.stop(),t.device.removeEventListener("input",t.adapter.onInput),t.device.destroy(),t.bindings.clear()}},KeyboardDevice:Ae,Mouse:class{constructor(t,e){this.PosX=new pe,this.PosY=new pe,this.WheelX=new pe,this.WheelY=new pe,this.WheelZ=new pe,this.Button0=new fe,this.Button1=new fe,this.Button2=new fe,this.Button3=new fe,this.Button4=new fe;const n="Mouse",i=new Ee(n,t,e),s=new Se;for(let t in this)if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];s.bind(e,n,t)}const r=new Te(s);i.addEventListener("input",r.onInput);const o=new we(r);o.start(),this[Oe]={device:i,bindings:s,adapter:r,autopoller:o}}destroy(){const t=this[Oe];t.autopoller.stop(),t.device.removeEventListener("input",t.adapter.onInput),t.device.destroy(),t.bindings.clear()}},MouseDevice:Ee,PRESSED_STATE_BIT:2,RELEASED_STATE_BIT:8,REPEATED_STATE_BIT:4});function Ie(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext}var Be=Object.freeze({__proto__:null,isWebGL2Supported:Ie});class De{constructor(t,e){this.gl=t,this.target=e}data(t,e){const n=this.gl,i=this.target;if("number"==typeof t)n.bufferData(i,t,e||n.STATIC_DRAW);else{if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");n.bufferData(i,t,e||n.STATIC_DRAW)}return this}subData(t,e=0,n,i){const s=this.gl,r=this.target;if(!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");if(n)if(Ie(s))s.bufferSubData(r,e,t,n,i);else{const o=i?t.subarray(n,n+i):t.subarray(n);s.bufferSubData(r,e,o)}else s.bufferSubData(r,e,t);return this}}class Pe{constructor(t,e,n){this.dataContext=new De(t,e),this.handle=n||t.createBuffer(),t.bindBuffer(e,this.handle)}get gl(){return this.dataContext.gl}get target(){return this.dataContext.target}data(t,e){return this.dataContext.data(t,e),this}subData(t,e=0,n,i){return this.dataContext.subData(t,e,n,i),this}build(){return this.handle}}class He{constructor(t,e,n,i){this.gl=t,this.target=e,this.handle=i,this.type=n,this.bindContext=new De(t,this.target)}bind(t){return t.bindBuffer(this.target,this.handle),this.bindContext.gl=t,this.bindContext}}function ke(t,e){switch(e){case t.BYTE:return Int8Array;case t.UNSIGNED_BYTE:return Uint8Array;case t.SHORT:return Int16Array;case t.UNSIGNED_SHORT:return Uint16Array;case t.INT:return Int32Array;case t.UNSIGNED_INT:return Uint32Array;case t.FLOAT:return Float32Array;default:throw new Error("Cannot find valid typed array for buffer type.")}}function Fe(t,e){switch(e){case Int8Array:return t.BYTE;case Uint8Array:return t.UNSIGNED_BYTE;case Int16Array:return t.SHORT;case Uint16Array:return t.UNSIGNED_SHORT;case Int32Array:return t.INT;case Uint32Array:return t.UNSIGNED_INT;case Float32Array:return t.FLOAT;default:throw new Error("Cannot find valid buffer type for typed array.")}}var Ue=Object.freeze({__proto__:null,createBufferSource:function(t,e,n){return new(ke(t,e))(n)},createBuffer:function(t,e,n,i){let s=t.createBuffer();if(t.bindBuffer(e,s),!ArrayBuffer.isView(n))throw new Error("Source data must be a typed array.");return t.bufferData(e,n,i||t.STATIC_DRAW),s},getBufferTypedArray:ke,getTypedArrayBufferType:Fe,getBufferUsage:function(t,e,n){return t.bindBuffer(e,n),t.getBufferParameter(e,t.BUFFER_USAGE)}});function $e(t,e){switch(e){case t.FLOAT:return t.uniform1f;case t.FLOAT_VEC2:return t.uniform2fv;case t.FLOAT_VEC3:return t.uniform3fv;case t.FLOAT_VEC4:return t.uniform4fv;case t.INT:return t.uniform1i;case t.INT_VEC2:return t.uniform2iv;case t.INT_VEC3:return t.uniform3iv;case t.INT_VEC4:return t.uniform4iv;case t.BOOL:return t.uniform1i;case t.BOOL_VEC2:return t.uniform2iv;case t.BOOL_VEC3:return t.uniform3iv;case t.BOOL_VEC4:return t.uniform4iv;case t.FLOAT_MAT2:return je;case t.FLOAT_MAT3:return Ve;case t.FLOAT_MAT4:return We;case t.SAMPLER_2D:case t.SAMPLER_CUBE:return t.uniform1i}if(Ie(t))switch(e){case t.UNSIGNED_INT:return t.uniform1ui;case t.UNSIGNED_INT_VEC2:return t.uniform2uiv;case t.UNSIGNED_INT_VEC3:return t.uniform3uiv;case t.UNSIGNED_INT_VEC4:return t.uniform4uiv;case t.FLOAT_MAT2x3:return qe;case t.FLOAT_MAT2x4:return Qe;case t.FLOAT_MAT3x2:return Je;case t.FLOAT_MAT3x4:return en;case t.FLOAT_MAT4x2:return sn;case t.FLOAT_MAT4x3:return on;case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:return t.uniform1i}throw new Error("Cannot find uniform function for gl enum.")}function Ge(t,e){switch(e){case t.FLOAT:return t.uniform1fv;case t.FLOAT_VEC2:return t.uniform2fv;case t.FLOAT_VEC3:return t.uniform3fv;case t.FLOAT_VEC4:return t.uniform4fv;case t.INT:return t.uniform1iv;case t.INT_VEC2:return t.uniform2iv;case t.INT_VEC3:return t.uniform3iv;case t.INT_VEC4:return t.uniform4iv;case t.BOOL:return t.uniform1iv;case t.BOOL_VEC2:return t.uniform2iv;case t.BOOL_VEC3:return t.uniform3iv;case t.BOOL_VEC4:return t.uniform4iv;case t.FLOAT_MAT2:return je;case t.FLOAT_MAT3:return Ve;case t.FLOAT_MAT4:return We;case t.SAMPLER_2D:case t.SAMPLER_CUBE:return t.uniform1iv}if(Ie(t))switch(e){case t.UNSIGNED_INT:return t.uniform1uiv;case t.UNSIGNED_INT_VEC2:return t.uniform2uiv;case t.UNSIGNED_INT_VEC3:return t.uniform3uiv;case t.UNSIGNED_INT_VEC4:return t.uniform4uiv;case t.FLOAT_MAT2x3:return qe;case t.FLOAT_MAT2x4:return Qe;case t.FLOAT_MAT3x2:return Je;case t.FLOAT_MAT3x4:return en;case t.FLOAT_MAT4x2:return sn;case t.FLOAT_MAT4x3:return on;case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:return t.uniform1iv}throw new Error("Cannot find array uniform function for gl enum.")}function je(t,e){this.uniformMatrix2fv(t,!1,e)}function Ke(t,e,n,i,s){this.uniformMatrix2fv(t,!1,[e,n,i,s])}function Ve(t,e){this.uniformMatrix3fv(t,!1,e)}function ze(t,e,n,i,s,r,o,a,u,l){this.uniformMatrix3fv(t,!1,[e,n,i,s,r,o,a,u,l])}function We(t,e){this.uniformMatrix4fv(t,!1,e)}function Ye(t,e,n,i,s,r,o,a,u,l,h,c,d,p,f,_,m){this.uniformMatrix4fv(t,!1,[e,n,i,s,r,o,a,u,l,h,c,d,p,f,_,m])}function qe(t,e){this.uniformMatrix2x3fv(t,!1,e)}function Xe(t,e,n,i,s,r,o){this.uniformMatrix2x3fv(t,!1,[e,n,i,s,r,o])}function Qe(t,e){this.uniformMatrix2x4fv(t,!1,e)}function Ze(t,e,n,i,s,r,o,a,u){this.uniformMatrix2x4fv(t,!1,[e,n,i,s,r,o,a,u])}function Je(t,e){this.uniformMatrix3x2fv(t,!1,e)}function tn(t,e,n,i,s,r,o){this.uniformMatrix3x2fv(t,!1,[e,n,i,s,r,o])}function en(t,e){this.uniformMatrix3x4fv(t,!1,e)}function nn(t,e,n,i,s,r,o,a,u,l,h,c,d){this.uniformMatrix3x4fv(t,!1,[e,n,i,s,r,o,a,u,l,h,c,d])}function sn(t,e){this.uniformMatrix4x2fv(t,!1,e)}function rn(t,e,n,i,s,r,o,a,u){this.uniformMatrix4x2fv(t,!1,[e,n,i,s,r,o,a,u])}function on(t,e){this.uniformMatrix4x3fv(t,!1,e)}function an(t,e,n,i,s,r,o,a,u,l,h,c,d){this.uniformMatrix4x3fv(t,!1,[e,n,i,s,r,o,a,u,l,h,c,d])}var un=Object.freeze({__proto__:null,getUniformFunction:$e,getUniformFunctionForComponent:function(t,e){switch(e){case t.FLOAT:return t.uniform1f;case t.FLOAT_VEC2:return t.uniform2f;case t.FLOAT_VEC3:return t.uniform3f;case t.FLOAT_VEC4:return t.uniform4f;case t.INT:return t.uniform1i;case t.INT_VEC2:return t.uniform2i;case t.INT_VEC3:return t.uniform3i;case t.INT_VEC4:return t.uniform4i;case t.BOOL:return t.uniform1i;case t.BOOL_VEC2:return t.uniform2i;case t.BOOL_VEC3:return t.uniform3i;case t.BOOL_VEC4:return t.uniform4i;case t.FLOAT_MAT2:return Ke;case t.FLOAT_MAT3:return ze;case t.FLOAT_MAT4:return Ye;case t.SAMPLER_2D:case t.SAMPLER_CUBE:return t.uniform1i}if(Ie(t))switch(e){case t.UNSIGNED_INT:return t.uniform1ui;case t.UNSIGNED_INT_VEC2:return t.uniform2ui;case t.UNSIGNED_INT_VEC3:return t.uniform3ui;case t.UNSIGNED_INT_VEC4:return t.uniform4ui;case t.FLOAT_MAT2x3:return Xe;case t.FLOAT_MAT2x4:return Ze;case t.FLOAT_MAT3x2:return tn;case t.FLOAT_MAT3x4:return nn;case t.FLOAT_MAT4x2:return rn;case t.FLOAT_MAT4x3:return an;case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:return t.uniform1i}throw new Error("Cannot find per component uniform function for gl enum.")},getUniformFunctionForArray:Ge});function ln(t,e){let n=[];const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){let i=t.getActiveUniform(e,s);if(!i)break;n.push(i)}return n}function hn(t,e){let n=[];const i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;++s){let i=t.getActiveAttrib(e,s);i&&n.push(i)}return n}function cn(t,e){let n={};const i=ln(t,e);for(let s of i){const i=s.name,r=s.size,o=s.type,a=t.getUniformLocation(e,i);let u;u=r<=1?$e(t,o):Ge(t,o),n[i]={type:o,length:r,location:a,set:u}}return n}function dn(t,e){switch(e){case t.FLOAT:return 1;case t.FLOAT_VEC2:return 2;case t.FLOAT_VEC3:return 3;case t.FLOAT_VEC4:case t.FLOAT_MAT2:return 4;case t.FLOAT_MAT3:return 9;case t.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function pn(t,e){let n={};const i=hn(t,e);for(let s of i){const i=s.name,r=s.size,o=s.type,a=t.getAttribLocation(e,i),u=dn(t,o);n[i]={type:o,length:r,location:a,size:u}}return n}function fn(t,e,n){let i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||(console.error(t.getShaderInfoLog(i)+`\nFailed to compile shader:\n${n}`),t.deleteShader(i)),i}function _n(t,e,n){for(let i of n)t.attachShader(e,i);t.linkProgram(e);for(let i of n)t.detachShader(e,i),t.deleteShader(i);return t.getProgramParameter(e,t.LINK_STATUS)||(console.error(t.getProgramInfoLog(e)),t.deleteProgram(e)),e}function mn(t,e,n,i,s){s?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.drawElements(e,i,t.UNSIGNED_SHORT,n)):t.drawArrays(e,n,i)}var gn=Object.freeze({__proto__:null,createShader:fn,createShaderProgram:_n,draw:mn,getProgramInfo:function(t,e){return{linkStatus:t.getProgramParameter(e,t.LINK_STATUS),deleteStatus:t.getProgramParameter(e,t.DELETE_STATUS),validateStatus:t.getProgramParameter(e,t.VALIDATE_STATUS),validationLog:t.getProgramInfoLog(e),activeUniforms:cn(t,e),activeAttributes:pn(t,e)}},getActiveUniforms:ln,getActiveAttribs:hn});class vn{constructor(t,e){this.handle=e,this.activeUniforms=cn(t,e),this.activeAttributes=pn(t,e),this.drawContext=new bn(t,this)}bind(t){return t.useProgram(this.handle),this.drawContext.gl=t,this.drawContext}}class bn{constructor(t,e){this.gl=t,this.parent=e}uniform(t,e){const n=this.parent.activeUniforms;if(t in n){let i=n[t],s=i.location;i.set.call(this.gl,s,e)}return this}attribute(t,e,n,i=!1,s=0,r=0){const o=this.gl,a=this.parent.activeAttributes;if(t in a){let u=a[t],l=u.location,h=u.size;n?(o.bindBuffer(o.ARRAY_BUFFER,n),o.vertexAttribPointer(l,h,e,i,s,r),o.enableVertexAttribArray(l)):o.disableVertexAttribArray(l)}return this}draw(t,e,n,i,s=null){return mn(t,e,n,i,s),this.parent}}class An{constructor(t,e){this.handle=e||t.createProgram(),this.shaders=[],this.gl=t}shader(t,e){let n=fn(this.gl,t,e);return this.shaders.push(n),this}link(){return _n(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}var En=Object.freeze({__proto__:null,BufferBuilder:Pe,BufferDataContext:De,BufferEnums:{BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},BufferHelper:Ue,BufferInfo:He,BufferInfoBuilder:class{constructor(t,e,n){this.bufferBuilder=new Pe(t,e,n),this.bufferType=t.FLOAT}get gl(){return this.bufferBuilder.gl}get handle(){return this.bufferBuilder.handle}get target(){return this.bufferBuilder.target}data(t,e){if(this.bufferBuilder.data(t,e),"number"!=typeof t){const e=t.constructor;this.bufferType=Fe(this.gl,e)}return this}subData(t,e,n,i){this.bufferBuilder.subData(t,e,n,i);const s=t.constructor;return this.bufferType=Fe(this.gl,s),this}build(){const t=this.bufferBuilder.build(),e=this.gl,n=this.target,i=this.bufferType;return new He(e,n,i,t)}},GLHelper:Be,ProgramAttributeEnums:{BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126,HALF_FLOAT:5131},ProgramBuilder:An,ProgramHelper:gn,ProgramInfo:vn,ProgramInfoBuilder:class{constructor(t,e){this.programBuilder=new An(t,e)}get gl(){return this.programBuilder.gl}get handle(){return this.programBuilder.handle}get shaders(){return this.programBuilder.shaders}shader(t,e){return this.programBuilder.shader(t,e),this}link(){const t=this.programBuilder.link();return new vn(this.gl,t)}},ProgramInfoDrawContext:bn,ProgramUniformEnums:{FLOAT:5126,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,UNSIGNED_INT:5125,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311},ProgramUniformFunctions:un});class yn{next(){return 0}}class wn extends yn{next(){return Math.random()}}class Tn extends yn{constructor(t){super(),this.seed=t,this.a=t}next(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}var xn=Object.freeze({__proto__:null,MathRandom:wn,Mulberry32:Tn,Random:class{static get RAND(){let t=new this;return this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this),Object.defineProperty(this,"RAND",{value:t}),t}constructor(t){this.generator="number"==typeof t?new Tn(t):t||new wn,this.next=this.next.bind(this),this.choose=this.choose.bind(this),this.range=this.range.bind(this),this.rangeInt=this.rangeInt.bind(this),this.sign=this.sign.bind(this)}static next(){return this.RAND.next()}next(){return this.generator.next()}static choose(t){return this.RAND.choose(t)}choose(t){return t[Math.floor(this.generator.next()*t.length)]}static range(t,e){return this.RAND.range(t,e)}range(t,e){return(e-t)*this.generator.next()+t}static rangeInt(t,e){return this.RAND.rangeInt(t,e)}rangeInt(t,e){return Math.trunc(this.range(t,e))}static sign(){return this.RAND.sign()}sign(){return this.generator.next()<.5?-1:1}},RandomBase:yn,SmallFastCounter32:class extends yn{constructor(t,e,n,i){super(),this.a=t,this.b=e,this.c=n,this.d=i}next(){let{a:t,b:e,c:n,d:i}=this;t|=0,e|=0,n|=0,i|=0;let s=(t+e|0)+i|0;return i=i+1|0,t=e^e>>>9,e=n+(n<<3)|0,n=n<<21|n>>>11,n=n+s|0,this.a=t,this.b=e,this.c=n,this.d=i,(s>>>0)/4294967296}}}),Sn=1e-6,Rn="undefined"!=typeof Float32Array?Float32Array:Array;function Cn(){var t=new Rn(16);return Rn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ln(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],_=e[13],m=e[14],g=e[15],v=n*a-i*o,b=n*u-s*o,A=n*l-r*o,E=i*u-s*a,y=i*l-r*a,w=s*l-r*u,T=h*_-c*f,x=h*m-d*f,S=h*g-p*f,R=c*m-d*_,C=c*g-p*_,L=d*g-p*m,M=v*L-b*C+A*R+E*S-y*x+w*T;return M?(M=1/M,t[0]=(a*L-u*C+l*R)*M,t[1]=(s*C-i*L-r*R)*M,t[2]=(_*w-m*y+g*E)*M,t[3]=(d*y-c*w-p*E)*M,t[4]=(u*S-o*L-l*x)*M,t[5]=(n*L-s*S+r*x)*M,t[6]=(m*A-f*w-g*b)*M,t[7]=(h*w-d*A+p*b)*M,t[8]=(o*C-a*S+l*T)*M,t[9]=(i*S-n*C-r*T)*M,t[10]=(f*y-_*A+g*v)*M,t[11]=(c*A-h*y-p*v)*M,t[12]=(a*x-o*R-u*T)*M,t[13]=(n*R-i*x+s*T)*M,t[14]=(_*b-f*E-m*v)*M,t[15]=(h*E-c*b+d*v)*M,t):null}function Mn(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function On(t,e){var n=new Rn(3);!function(t,e){var n=e[0],i=e[1],s=e[2],r=e[4],o=e[5],a=e[6],u=e[8],l=e[9],h=e[10];t[0]=Math.hypot(n,i,s),t[1]=Math.hypot(r,o,a),t[2]=Math.hypot(u,l,h)}(n,e);var i=1/n[0],s=1/n[1],r=1/n[2],o=e[0]*i,a=e[1]*s,u=e[2]*r,l=e[4]*i,h=e[5]*s,c=e[6]*r,d=e[8]*i,p=e[9]*s,f=e[10]*r,_=o+h+f,m=0;return _>0?(m=2*Math.sqrt(_+1),t[3]=.25*m,t[0]=(c-p)/m,t[1]=(d-u)/m,t[2]=(a-l)/m):o>h&&o>f?(m=2*Math.sqrt(1+o-h-f),t[3]=(c-p)/m,t[0]=.25*m,t[1]=(a+l)/m,t[2]=(d+u)/m):h>f?(m=2*Math.sqrt(1+h-o-f),t[3]=(d-u)/m,t[0]=(a+l)/m,t[1]=.25*m,t[2]=(c+p)/m):(m=2*Math.sqrt(1+f-o-h),t[3]=(a-l)/m,t[0]=(d+u)/m,t[1]=(c+p)/m,t[2]=.25*m),t}function Nn(t,e,n,i,s,r,o){var a=1/(e-n),u=1/(i-s),l=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(s+i)*u,t[14]=(o+r)*l,t[15]=1,t}function In(t,e,n,i){var s,r,o,a,u,l,h,c,d,p,f=e[0],_=e[1],m=e[2],g=i[0],v=i[1],b=i[2],A=n[0],E=n[1],y=n[2];return Math.abs(f-A)<Sn&&Math.abs(_-E)<Sn&&Math.abs(m-y)<Sn?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=f-A,c=_-E,d=m-y,s=v*(d*=p=1/Math.hypot(h,c,d))-b*(c*=p),r=b*(h*=p)-g*d,o=g*c-v*h,(p=Math.hypot(s,r,o))?(s*=p=1/p,r*=p,o*=p):(s=0,r=0,o=0),a=c*o-d*r,u=d*s-h*o,l=h*r-c*s,(p=Math.hypot(a,u,l))?(a*=p=1/p,u*=p,l*=p):(a=0,u=0,l=0),t[0]=s,t[1]=a,t[2]=h,t[3]=0,t[4]=r,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=l,t[10]=d,t[11]=0,t[12]=-(s*f+r*_+o*m),t[13]=-(a*f+u*_+l*m),t[14]=-(h*f+c*_+d*m),t[15]=1,t)}function Bn(){var t=new Rn(3);return Rn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dn(t,e,n){var i=new Rn(3);return i[0]=t,i[1]=e,i[2]=n,i}function Pn(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function Hn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function kn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Fn(t,e){var n=e[0],i=e[1],s=e[2],r=n*n+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Un(t,e,n){var i=e[0],s=e[1],r=e[2],o=n[0],a=n[1],u=n[2];return t[0]=s*u-r*a,t[1]=r*o-i*u,t[2]=i*a-s*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function $n(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*r+n[12]*o,t[1]=n[1]*i+n[5]*s+n[9]*r+n[13]*o,t[2]=n[2]*i+n[6]*s+n[10]*r+n[14]*o,t[3]=n[3]*i+n[7]*s+n[11]*r+n[15]*o,t}function Gn(){var t=new Rn(4);return Rn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function jn(t,e,n,i){var s,r,o,a,u,l=e[0],h=e[1],c=e[2],d=e[3],p=n[0],f=n[1],_=n[2],m=n[3];return(r=l*p+h*f+c*_+d*m)<0&&(r=-r,p=-p,f=-f,_=-_,m=-m),1-r>Sn?(s=Math.acos(r),o=Math.sin(s),a=Math.sin((1-i)*s)/o,u=Math.sin(i*s)/o):(a=1-i,u=i),t[0]=a*l+u*p,t[1]=a*h+u*f,t[2]=a*c+u*_,t[3]=a*d+u*m,t}Bn(),function(){var t,e=(t=new Rn(4),Rn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Kn;Bn(),Dn(1,0,0),Dn(0,1,0),Gn(),Gn(),Kn=new Rn(9),Rn!=Float32Array&&(Kn[1]=0,Kn[2]=0,Kn[3]=0,Kn[5]=0,Kn[6]=0,Kn[7]=0),Kn[0]=1,Kn[4]=1,Kn[8]=1;const Vn=Dn(0,1,0);class zn{constructor(t,e){this.projectionMatrix=t,this.viewMatrix=e}resize(t,e){return this}}const Wn=Math.PI/3;const Yn=Math.PI/180;function qn(t,e,n){t?(n.nodes[t].children.push(e),n.nodes[e].parent=t):(n.roots.push(e),n.nodes[e].parent=0)}function Xn(t,e,n){if(t){let i=n.nodes[t].children,s=i.indexOf(e);i.splice(s,1),n.nodes[e].parentNode=0}else{let t=n.roots,i=t.indexOf(e);t.splice(i,1),n.nodes[e].parentNode=0}}function Qn(t,e,n,i,s){if(n>=100)return;let r=i(e,t);if(!1===r)return;let o=t.nodes[e],a=s?s(o.children,e,t):o.children;for(let e of a)Qn(t,e,n+1,i,s);"function"==typeof r&&r(e,t)}function Zn(t,e){delete e.nodes[t]}var Jn=Object.freeze({__proto__:null,Camera:zn,FirstPersonCameraController:class{constructor(t={locky:!1}){this.locky=t.locky,this.position=Bn(),this.forward=Dn(0,0,-1),this.right=Dn(1,0,0),this.up=Dn(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(t,e,n=1){return this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+e*n)),this.yaw=(this.yaw+t*n)%360,this}move(t,e=0,n=0,i=1){return this.forwardAmount+=t*i,this.rightAmount+=e*i,this.upAmount+=n*i,this}apply(t){let{position:e,forward:n,right:i,up:s,forwardAmount:r,rightAmount:o,upAmount:a,pitch:u,yaw:l}=this,h=l*Yn,c=u*Yn,d=Math.cos(h),p=Math.cos(c),f=Math.sin(h),_=d*p,m=Math.sin(c),g=f*p;Fn(n,Pn(n,_,this.locky?0:m,g)),Fn(i,Un(i,n,s));let v=Bn();return kn(v,n,r),Hn(e,e,v),kn(v,i,o),Hn(e,e,v),kn(v,s,a),Hn(e,e,v),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.locky&&Pn(n,_,m,g),In(t,e,Hn(v,e,n),s),t}},OrthographicCamera:class extends zn{constructor(t,e,n,i,s=-1e3,r=1e3){super(Cn(),Cn()),this.orthoBounds={left:void 0===t?void 0:Number(t),top:void 0===e?void 0:Number(e),right:void 0===n?void 0:Number(n),bottom:void 0===i?void 0:Number(i)},this.clippingPlane={near:Number(s),far:Number(r)}}resize(t,e){const{near:n,far:i}=this.clippingPlane,{left:s,top:r,right:o,bottom:a}=this.orthoBounds;let u=this.projectionMatrix,l=void 0!==s;if(void 0!==t)if(l){const l=t/e;Nn(u,s*l,o*l,a,r,n,i)}else Nn(u,0,t,e,0,n,i);else l?Nn(u,s,o,a,r,n,i):Nn(u,-1,1,1,-1,-1,1);return this}},PerspectiveCamera:class extends zn{constructor(t=Wn,e=.1,n=1e3){super(Cn(),Cn()),this.fieldOfView=Number(t),this.clippingPlane={near:Number(e),far:Number(n)}}resize(t,e){const n=void 0===t?1:t/e,{near:i,far:s}=this.clippingPlane;return function(t,e,n,i,s){var r,o=1/Math.tan(e/2);t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(r=1/(i-s),t[10]=(s+i)*r,t[14]=2*s*i*r):(t[10]=-1,t[14]=-2*i)}(this.projectionMatrix,this.fieldOfView,n,i,s),this}},SceneGraph:class{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(t){let e=this._nextAvailableSceneNodeId++,n={parent:0,children:[]};return this.nodes[e]=n,qn(t,e,this),e}createSceneNodes(t,e){let n=[];for(let i=0;i<t;++i)n.push(this.createSceneNode(e));return n}deleteSceneNode(t){if(!(t in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");Xn(this.nodes[t].parent,t,this),Qn(this,t,0,Zn)}deleteSceneNodes(t){for(let e of t)this.deleteSceneNode(e)}getSceneNodeInfo(t){return this.nodes[t]}parentSceneNode(t,e){Xn(this.nodes[t].parent,t,this),qn(e,t,this)}replaceSceneNode(t,e){let n=this.nodes[t],i=n.parent,s=n.children.slice();if(Xn(i,t,this),n.children.length=0,e){let t=this.nodes[e];Xn(t.parent,e,this),t.children.push(...s),qn(i,e,this)}else if(i){this.nodes[i].children.push(...s)}else this.roots.push(...s);for(let t of s)this.nodes[t].parent=i}walk(t,e={}){const{from:n,childFilter:i}=e;let s;s=n?Array.isArray(n)?n:[n]:this.roots,i&&(s=i(s,0,this));for(let e of s)Qn(this,e,0,t,i)}},lookAt:function(t,e,n,i=0,s=1){let r=Bn(),o=Gn();Mn(r,t),On(o,t),In(t,r,Dn(e,n,i),Vn);let a=Gn();On(a,t),jn(o,o,a,s),function(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3],a=i+i,u=s+s,l=r+r,h=i*a,c=i*u,d=i*l,p=s*u,f=s*l,_=r*l,m=o*a,g=o*u,v=o*l;t[0]=1-(p+_),t[1]=c+v,t[2]=d-g,t[3]=0,t[4]=c-v,t[5]=1-(h+_),t[6]=f+m,t[7]=0,t[8]=d+g,t[9]=f-m,t[10]=1-(h+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1}(t,o,r)},panTo:function(t,e,n,i=0,s=1){let r=Bn();Mn(r,t),function(t,e,n){var i,s,r,o,a,u,l,h,c,d,p,f,_=n[0],m=n[1],g=n[2];e===t?(t[12]=e[0]*_+e[4]*m+e[8]*g+e[12],t[13]=e[1]*_+e[5]*m+e[9]*g+e[13],t[14]=e[2]*_+e[6]*m+e[10]*g+e[14],t[15]=e[3]*_+e[7]*m+e[11]*g+e[15]):(i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=e[9],p=e[10],f=e[11],t[0]=i,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=d,t[10]=p,t[11]=f,t[12]=i*_+a*m+c*g+e[12],t[13]=s*_+u*m+d*g+e[13],t[14]=r*_+l*m+p*g+e[14],t[15]=o*_+h*m+f*g+e[15])}(t,t,Dn((e-r[0])*s,(n-r[1])*s,(i-r[2])*s))},screenToWorldRay:function(t,e,n,i,s,r=!1){let o=function(t,e,n,i){var s=new Rn(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s}(e,n,-1,1),a=Cn();return Ln(a,i),$n(o,o,a),o[2]=-1,o[3]=0,Ln(a,s),$n(o,o,a),t[0]=o[0],t[1]=o[1],t[2]=o[2],r&&Fn(t,t),t}});const ti={on(t,e,n=e){let i;if(this.__events.has(t)?i=this.__events.get(t):(i=new Map,this.__events.set(t,i)),i.has(n))throw new Error(`Found callback for event '${t}' with the same handle '${n}'.`);return i.set(n,e),this},off(t,e){if(!this.__events.has(t))throw new Error(`Unable to find event '${t}'.`);{const n=this.__events.get(t);if(!n.has(e))throw new Error(`Unable to find callback for event '${t}' with handle '${e}'.`);n.delete(e)}return this},once(t,e,n=e){return this.on(t,((...i)=>{this.off(t,n),e.apply(this.__context||this,i)}),n)},emit(t,...e){if(this.__events.has(t)){let n=[];const i=Array.from(this.__events.get(t).values());for(const t of i){let i=t.apply(this.__context||this,e);i&&n.push(i)}return n}return this.__events.set(t,new Map),[]}};const ei={create:function(t){const e=Object.create(ti);return e.__events=new Map,e.__context=t,e},assign:function(t,e){const n=Object.assign(t,ti);return n.__events=new Map,n.__context=e,n},mixin:function(t,e){const n=t.prototype;return Object.assign(n,ti),n.__events=new Map,n.__context=e,n}},ni={5:si("#7F8C8D"),4:si("#2ECC71"),3:si("#4794C8"),2:si("#F39C12"),1:si("#C0392B"),0:[""]};function ii(t,e){return t-e}function si(t){return[`background: ${t}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}function ri(){}function oi(t){switch(t){case 5:return console.trace;case 4:case 3:return console.log;case 2:return console.warn;case 1:return console.error;case 0:return ri;default:return console.log}}function ai(t,e,n,i){if(e&&t.unshift(`[${e}]`),n){let e=[`%c${n}`,ni[i].join(";")];t.unshift(e[0],e[1])}return t}const ui=Symbol("level"),li=Symbol("domain"),hi={};let ci=2,di="app";class pi{static get TRACE(){return 5}static get DEBUG(){return 4}static get INFO(){return 3}static get WARN(){return 2}static get ERROR(){return 1}static get OFF(){return 0}static getLogger(t){return t in hi?hi[t]:hi[t]=new pi(t)}static useDefaultLevel(t){return ci=t,this}static useDefaultDomain(t){return di=t,this}constructor(t){this.name=t,this[ui]=ci,this[li]=di}setLevel(t){return this[ui]=t,this}getLevel(){return this[ui]}setDomain(t){return this[li]=t,this}getDomain(){return this[li]}log(t,...e){if(ii(this[ui],t)<0)return this;ai(e,this.name,this[li],t),oi(t)(...e)}trace(...t){if(ii(this[ui],5)<0)return this;ai(t,this.name,this[li],5),oi(5)(...t)}debug(...t){if(ii(this[ui],4)<0)return this;ai(t,this.name,this[li],4),oi(4)(...t)}info(...t){if(ii(this[ui],3)<0)return this;ai(t,this.name,this[li],3),oi(3)(...t)}warn(...t){if(ii(this[ui],2)<0)return this;ai(t,this.name,this[li],2),oi(2)(...t)}error(...t){if(ii(this[ui],1)<0)return this;ai(t,this.name,this[li],1),oi(1)(...t)}}function fi(t,e){const n=document.createElement("a"),i=e.indexOf(";");e=e.substring(0,i+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+t+";"+e.substring(i+1),n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}const _i=["svg","g"];function mi(t,e=t.cloneNode(!0)){let n=t.childNodes,i=e.childNodes;for(var s=0;s<i.length;s++){let t=i[s],e=t.tagName;if(-1!=_i.indexOf(e))mi(n[s],t);else if(n[s]instanceof Element){const e=window.getComputedStyle(n[s]);let i=[];for(let t of Object.keys(e))i.push(`${t}:${e.getPropertyValue(t)};`);t.setAttribute("style",i.join(""))}}return e}class gi{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(const e of t)this._heap.push(e),this._shiftUp()}pop(){const t=this.peek();let e=this._heap.length-1;return e>0&&this._swap(0,e),this._heap.pop(),this._shiftDown(),t}replace(t){const e=this.peek();return this._heap[0]=t,this._shiftDown(),e}peek(){return this._heap[0]}_compare(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){let n=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=n}_shiftUp(){let t,e=this._heap.length-1;for(;e>0&&this._compare(e,t=vi(e));)this._swap(e,t),e=t}_shiftDown(){const t=this._heap.length;let e,n=0,i=bi(n),s=i<t,r=Ai(n),o=r<t;for(;s&&this._compare(i,n)||o&&this._compare(r,n);)e=o&&this._compare(r,i)?r:i,this._swap(n,e),n=e,i=bi(n),s=i<t,r=Ai(n),o=r<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}}function vi(t){return(t+1>>>1)-1}function bi(t){return 1+(t<<1)}function Ai(t){return t+1<<1}function Ei(t,e,n){return Math.min(n,Math.max(e,t))}function yi(t,e,n){let i=n-e,s=(t-e)%i;return s<0&&(s+=i),s+e}const wi=Math.PI/180,Ti=180/Math.PI;function xi(t,e,n){if(n.has(e))throw new Error(`Found cyclic dependency for '${e.name||e}'.`);if(!t.visited.has(e)){if(t.visited.add(e),t.edgeMap.has(e)){let i=t.edgeMap.get(e);if(i.size>0){n.add(e);for(let e of i)xi(t,e,n);n.delete(e)}}t.dst.push(e)}}function Si(t,e,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NaN,r=null){return t.fscore[e]=n,t.gscore[e]=i,t.hscore[e]=s,t.parents[e]=r,e}var Ri=Object.freeze({__proto__:null,Eventable:ei,FILE_TYPE_PNG:"png",FILE_TYPE_SVG:"svg",Logger:pi,PriorityQueue:gi,astarSearch:function(t,e,n,i){let s={fscore:{},gscore:{},hscore:{},parents:{}};Si(s,t);let r=new Set,o=new Set;for(r.add(t);r.size>0;){let t;for(let e of r)t?s.fscore[e]<s.fscore[t]&&(t=e):t=e;let a=t;if(a===e){let t=[];for(;s.parents[a];)t.push(a),a=s.parents[a];return t.push(a),t.reverse()}o.add(a),r.delete(a);for(let t of n(a)){if(o.has(t))continue;let n=s.gscore[a]+1,u=!1;r.has(t)?n<s.gscore[t]&&(u=!0):(u=!0,Si(s,t),s.hscore[t]=i(t,e),r.add(t)),u&&(s.parents[t]=a,s.gscore[t]=n,s.fscore[t]=n+s.hscore[t])}}return[]},bitCount:function(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24},bresenhamLine:function(t,e,n,i,s){let r=Math.floor(t),o=Math.floor(e),a=Math.floor(n),u=Math.floor(i),l=Math.abs(n-t),h=t<n?1:-1,c=-Math.abs(i-e),d=e<i?1:-1,p=l+c,f=r,_=o,m=s(f,_);if(void 0!==m)return m;let g=l*l+c*c,v=0;for(;v<g&&(f!==a||_!==u);){++v;let t=2*p;if(t>=c&&(p+=c,f+=h),t<=l&&(p+=l,_+=d),m=s(f,_),void 0!==m)return m}},clamp:Ei,cycle:yi,direction2:function(t,e,n,i){let s=n-t,r=i-e;return Math.atan2(r,s)},distance2:function(t,e,n,i){let s=n-t,r=i-e;return Math.sqrt(s*s+r*r)},downloadImageFromSVG:function(t,e,n,i,s){const r=function(t){const e=mi(t),n=(new XMLSerializer).serializeToString(e);return new Blob([n],{type:"image/svg+xml"})}(n);switch(e){case"png":{const n=URL.createObjectURL(r),o=document.createElement("canvas"),a=o.getContext("2d"),u=window.devicePixelRatio||1;o.width=i*u,o.height=s*u,o.style.width=i+"px",o.style.height=s+"px",a.setTransform(u,0,0,u,0,0);const l=new Image;l.onload=()=>{a.drawImage(l,0,0),URL.revokeObjectURL(n);const i=o.toDataURL("image/"+e).replace("image/"+e,"image/octet-stream");fi(t,i)},l.src=n}break;case"svg":{const e=new FileReader;e.onload=()=>{fi(t,e.result)},e.readAsDataURL(r)}break;default:throw new Error("Unknown file type '"+e+"'")}},downloadText:function(t,e){fi(t,"data:text/plain; charset=utf-8,"+encodeURIComponent(e))},downloadURL:fi,fisherYatesShuffle:function(t){for(let e=t.length-1;e>0;--e){let n=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[n],t[n]=i}return t},lerp:function(t,e,n){return t+(e-t)*n},lookAt2:function(t,e,n){return Ei(t+yi(e-t,-Math.PI,Math.PI),t-n,t+n)},toDegrees:function(t){return t*Ti},toRadians:function(t){return t*wi},topoSort:function(t,e){let n=[];for(let i of t){let t=e(i);if(Array.isArray(t))n.push([i,...t]);else if(t)throw new Error("Dependency callback must return an array.")}return function(t,e,n=[]){let i=new Map;for(let t of e)if(t.length>1){let e=t[0],n=t[1];i.has(e)||i.set(e,new Set),i.has(n)||i.set(n,new Set),i.get(e).add(n)}let s={edgeMap:i,index:t.length,visited:new Set,dst:n};for(let e of t)xi(s,e,new Set);return n}(function(t){let e=new Set;for(let n of t)for(let t of n)e.add(t);return Array.from(e)}(n),function(t){let e=[];for(let n of t){let t=n[0];for(let i=1;i<n.length;++i){let s=n[i];e.push([t,s])}}return e}(n))},uploadFile:async function(t=[],e=!1){return new Promise(((n,i)=>{const s=document.createElement("input");s.addEventListener("change",(t=>{n(e?t.target.files:t.target.files[0])})),s.type="file",s.accept=t.join(","),s.style.display="none",s.toggleAttribute("multiple",e),document.body.appendChild(s),s.click(),document.body.removeChild(s)}))},uuid:function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)},withinRadius:function(t,e,n,i,s){const r=t-n,o=e-i;return r*r+o*o<=s*s}});t.asset=ie,t.display=ce,t.input=Ne,t.mogli=En,t.random=xn,t.scene=Jn,t.util=Ri,Object.defineProperty(t,"__esModule",{value:!0})}));
