!function(){"use strict";const t="noscale",e="stretch",n=Symbol("template"),s=Symbol("style");class i extends HTMLElement{static get[n](){let t=document.createElement("template");return t.innerHTML='\n<div class="container">\n    <label class="hidden" id="title">display-port</label>\n    <label class="hidden" id="fps">00</label>\n    <label class="hidden" id="dimension">0x0</label>\n    <canvas></canvas>\n    <slot></slot>\n</div>',Object.defineProperty(this,n,{value:t}),t}static get[s](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n    color: #555555;\n}\n.container {\n    display: flex;\n    position: relative;\n    width: 100%;\n    height: 100%;\n}\ncanvas {\n    background: #000000;\n    margin: auto;\n    image-rendering: pixelated;\n}\nlabel {\n    font-family: monospace;\n    color: currentColor;\n    position: absolute;\n}\n#title {\n    left: 0.5rem;\n    top: 0.5rem;\n}\n#fps {\n    right: 0.5rem;\n    top: 0.5rem;\n}\n#dimension {\n    left: 0.5rem;\n    bottom: 0.5rem;\n}\n.hidden {\n    display: none;\n}\n:host([debug]) .container {\n    outline: 6px dashed rgba(0, 0, 0, 0.1);\n    outline-offset: -4px;\n    background-color: rgba(0, 0, 0, 0.1);\n}\n:host([mode="noscale"]) canvas {\n    margin: 0;\n    top: 0;\n    left: 0;\n}\n:host([mode="fit"]), :host([mode="center"]), :host([mode="stretch"]) {\n    width: 100%;\n    height: 100%;\n}\n:host([full]) {\n    width: 100vw!important;\n    height: 100vh!important;\n}\n:host([disabled]) {\n    display: none;\n}\nslot {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n\n    pointer-events: none;\n}\n::slotted(*) {\n    pointer-events: auto;\n}',Object.defineProperty(this,s,{value:t}),t}static get observedAttributes(){return["width","height","disabled","onframe","debug","id","class"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[n].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[s].cloneNode(!0)),this._canvasElement=this.shadowRoot.querySelector("canvas"),this._titleElement=this.shadowRoot.querySelector("#title"),this._fpsElement=this.shadowRoot.querySelector("#fps"),this._dimensionElement=this.shadowRoot.querySelector("#dimension"),this._animationRequestHandle=0,this._prevAnimationFrameTime=0,this._width=300,this._height=150,this._onframe=null,this.update=this.update.bind(this)}get canvas(){return this._canvasElement}connectedCallback(){this.hasAttribute("mode")||(this.mode="noscale"),this.hasAttribute("tabindex")||this.setAttribute("tabindex",0),this.updateCanvasSize(),this.resume()}disconnectedCallback(){this.pause()}attributeChangedCallback(t,e,n){switch(t){case"width":this._width=n;break;case"height":this._height=n;break;case"disabled":n?(this.update(0),this.pause()):this.resume();break;case"onframe":this.onframe=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`display-port${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`;break;case"debug":this._titleElement.classList.toggle("hidden",n),this._fpsElement.classList.toggle("hidden",n),this._dimensionElement.classList.toggle("hidden",n)}}update(e){this._animationRequestHandle=requestAnimationFrame(this.update),this.updateCanvasSize();const n=e-this._prevAnimationFrameTime;if(this._prevAnimationFrameTime=e,this.debug){const e=n<=0?"--":String(Math.round(1e3/n)).padStart(2,"0");if(this._fpsElement.innerText!==e&&(this._fpsElement.innerText=e),this.mode===t){let t=`${this._width}x${this._height}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}else{let t=`${this._width}x${this._height}|${this.shadowRoot.host.clientWidth}x${this.shadowRoot.host.clientHeight}`;this._dimensionElement.innerText!==t&&(this._dimensionElement.innerText=t)}}this.dispatchEvent(new CustomEvent("frame",{detail:{now:e,prevTime:this._prevAnimationFrameTime,deltaTime:n,canvas:this._canvasElement,get context(){let t=this.canvas.getContext("2d");return t.imageSmoothingEnabled=!1,t}},bubbles:!1,composed:!0}))}pause(){cancelAnimationFrame(this._animationRequestHandle)}resume(){this._animationRequestHandle=requestAnimationFrame(this.update)}updateCanvasSize(){let n=this.shadowRoot.host.getBoundingClientRect();const s=n.width,i=n.height;let r=this._canvasElement,o=this._width,a=this._height;const h=this.mode;if(h===e)o=s,a=i;else if(h!==t){if(s<o||i<a||"fit"===h){let t=s/o,e=i/a;t<e?(o=s,a*=t):(o*=e,a=i)}}o=Math.floor(o),a=Math.floor(a),r.clientWidth===o&&r.clientHeight===a||(r.width=this._width,r.height=this._height,r.style=`width: ${o}px; height: ${a}px`,this.dispatchEvent(new CustomEvent("resize",{detail:{width:o,height:a},bubbles:!1,composed:!0})))}get onframe(){return this._onframe}set onframe(t){this._onframe&&this.removeEventListener("frame",this._onframe),this._onframe=t,this._onframe&&this.addEventListener("frame",t)}get width(){return this._width}set width(t){this.setAttribute("width",t)}get height(){return this._height}set height(t){this.setAttribute("height",t)}get mode(){return this.getAttribute("mode")}set mode(t){this.setAttribute("mode",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get debug(){return this.hasAttribute("debug")}set debug(t){t?this.setAttribute("debug",""):this.removeAttribute("debug")}}window.customElements.define("display-port",i);class r{static addInputEventListener(t,e){}static removeInputEventListener(t,e){}constructor(t){this.eventTarget=t}}class o{constructor(){this.down=0,this.up=0,this.value=0,this.next={up:0,down:0}}update(t,e){"down"===t?this.next.down=e:this.next.up=e}poll(){this.value?this.up&&!this.next.up&&(this.value=0):this.next.down&&(this.value=1),this.down=this.next.down,this.up=this.next.up,this.next.down=0,this.next.up=0}toString(){return this.value}}class a{constructor(){this.value=0}update(t,e){this.value=e}poll(){}toString(){return this.value}}class h extends a{constructor(){super(),this.next=0}update(t,e){this.next+=e}poll(){this.value=this.next,this.next=0}}const l=Symbol("keyboardEventContext");class u extends r{static addInputEventListener(t,e){let n;if(l in e)n=e[l];else{n={handler:e,target:t,down:null,up:null,_keyEvent:{type:"key",target:t,device:"keyboard",key:null,event:null,value:null,control:!1,shift:!1,alt:!1}};let s=d.bind(n),i=c.bind(n);n.down=s,n.up=i,e[l]=n}return t.addEventListener("keyup",n.up),t.addEventListener("keydown",n.down),t}static removeInputEventListener(t,e){if(l in e){let n=e[l];t.removeEventListener("keyup",n.up),t.removeEventListener("keydown",n.down)}return t}constructor(t,e){if(super(t),this._buttons=[],this._managed=Array.isArray(e),this.onManagedKeyEvent=this.onManagedKeyEvent.bind(this),this.onUnmanagedKeyEvent=this.onUnmanagedKeyEvent.bind(this),this._managed){for(let t of e){let e=new o;this[t]=e,this._buttons.push(e)}u.addInputEventListener(t,this.onManagedKeyEvent)}else u.addInputEventListener(t,this.onUnmanagedKeyEvent)}get Up(){return Math.min((this.ArrowUp||0)+(this.KeyW||0),1)}get Down(){return Math.min((this.ArrowDown||0)+(this.KeyS||0),1)}get Left(){return Math.min((this.ArrowLeft||0)+(this.KeyA||0),1)}get Right(){return Math.min((this.ArrowRight||0)+(this.KeyD||0),1)}destroy(){this._managed?u.removeInputEventListener(this.eventTarget,this.onManagedKeyEvent):u.removeInputEventListener(this.eventTarget,this.onUnmanagedKeyEvent),this.eventTarget=null}poll(){for(let t of this._buttons)t.poll();return this}onUnmanagedKeyEvent(t){if(!(t.key in this)){let e=new o;this[t.key]=e,this._buttons.push(e)}return this[t.key].update(t.event,t.value),!0}onManagedKeyEvent(t){if(t.key in this)return this[t.key].update(t.event,t.value),!0}}function d(t){if(t.repeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._keyEvent;return e.key=t.code,e.event="down",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.handler.call(void 0,e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}function c(t){let e=this._keyEvent;if(e.key=t.code,e.event="up",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.handler.call(void 0,e))return t.preventDefault(),t.stopPropagation(),!1}const p=Symbol("mouseEventContext");class m extends r{static addInputEventListener(t,e){let n;if(p in e)n=e[p];else{n={handler:e,target:t,down:null,up:null,move:null,contextmenu:null,_down:!1,_keyEvent:{type:"key",target:t,device:"mouse",key:null,event:null,value:null},_posEvent:{type:"pos",target:t,device:"mouse",key:"pos",event:"move",x:0,y:0,dx:0,dy:0}};let s=f.bind(n),i=y.bind(n),r=g.bind(n),o=b.bind(n);n.down=s,n.up=i,n.move=r,n.contextmenu=o,e[p]=n}return t.addEventListener("mousedown",n.down),document.addEventListener("mouseup",n.up),t.addEventListener("contextmenu",n.contextmenu),document.addEventListener("mousemove",n.move),t}static removeInputEventListener(t,e){if(p in e){let n=e[p];t.removeEventListener("mousedown",n.down),document.removeEventListener("mouseup",n.up),t.removeEventListener("contextmenu",n.contextmenu),document.removeEventListener("mousemove",n.move)}return t}constructor(t){super(t),this.x=new a,this.y=new a,this.dx=new h,this.dy=new h,this.Button0=new o,this.Button1=new o,this.Button2=new o,this.Button3=new o,this.Button4=new o,this.onMouseEvent=this.onMouseEvent.bind(this),m.addInputEventListener(t,this.onMouseEvent)}get Left(){return this.Button0}get Middle(){return this.Button1}get Right(){return this.Button2}destroy(){m.removeInputEventListener(this.eventTarget,this.onMouseEvent),this.eventTarget=null}poll(){return this.x.poll(),this.y.poll(),this.dx.poll(),this.dy.poll(),this.Button0.poll(),this.Button1.poll(),this.Button2.poll(),this.Button3.poll(),this.Button4.poll(),this}onMouseEvent(t){let{key:e,event:n}=t;switch(e){case 0:this.Button0.update(n,t.value);break;case 1:this.Button1.update(n,t.value);break;case 2:this.Button2.update(n,t.value);break;case 3:this.Button3.update(n,t.value);break;case 4:this.Button4.update(n,t.value);break;case"pos":return this.x.update(n,t.x),this.y.update(n,t.y),this.dx.update(n,t.dx),void this.dy.update(n,t.dy)}return!0}}function f(t){this._down=!0;let e=this._keyEvent;if(e.key=t.button,e.event="down",e.value=1,this.handler.call(void 0,e)&&document.activeElement===this.target)return t.preventDefault(),t.stopPropagation(),!1}function y(t){if(this._down){this._down=!1;let e=this._keyEvent;if(e.key=t.button,e.event="up",e.value=1,this.handler.call(void 0,e))return t.preventDefault(),t.stopPropagation(),!1}}function g(t){let e=this.target,{clientWidth:n,clientHeight:s}=e,i=this.target.getBoundingClientRect(),r=t.movementX/n,o=t.movementY/s,a=(t.clientX-i.left)/n,h=(t.clientY-i.top)/s,l=this._posEvent;if(l.x=a,l.y=h,l.dx=r,l.dy=o,void 0!==this.handler.call(void 0,l))throw new Error("Return value must be 'undefined'. Mouse position and movement events cannot be consumed.")}function b(t){return t.preventDefault(),t.stopPropagation(),!1}const w=Symbol("template"),v=Symbol("style");class x extends HTMLElement{static toInputMap(t){let e={};for(let n of t)if(n instanceof x){let t,s=n.input;switch(s in e?t=e[s]:e[s]=t=[],n.type){case"action":t.push({key:n.key,event:n.event});break;case"range":t.push({key:n.key,scale:n.scale});break;default:throw new Error("Unknown input type.")}}return e}static get[w](){let t=document.createElement("template");return t.innerHTML="\n<kbd></kbd>",Object.defineProperty(this,w,{value:t}),t}static get[v](){let t=document.createElement("style");return t.innerHTML="\n:host {\n    display: inline-block;\n}\nkbd {\n    background-color: #EEEEEE;\n    border-radius: 3px;\n    border: 1px solid #B4B4B4;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;\n    color: #333333;\n    font-size: 0.85em;\n    font-weight: 700;\n    line-height: 1;\n    padding: 2px 4px;\n    white-space: nowrap;\n}\n",Object.defineProperty(this,v,{value:t}),t}static get observedAttributes(){return["input","key","scale","event"]}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[w].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[v].cloneNode(!0)),this.keyElement=this.shadowRoot.querySelector("kbd")}attributeChangedCallback(t,e,n){switch(t){case"key":this.keyElement.textContent=n}}get type(){return this.hasAttribute("event")?"action":"range"}get input(){return this.getAttribute("input")}set input(t){this.setAttribute("input",t)}get key(){return this.getAttribute("key")}set key(t){this.setAttribute("key",t)}get scale(){return Number(this.getAttribute("scale"))}set scale(t){this.setAttribute("scale",t)}get event(){return this.getAttribute("event")}set event(t){this.setAttribute("event",t)}}window.customElements.define("input-key",x);class E{constructor(t,e){this.inputName=t,this.inputType=e,this.value=0,this._onchange=null,this._eventListeners=new Map}update(t){if(this.value!==t){if(this.value=t,this._eventListeners.has("change"))for(let t of this._eventListeners.get("change"))t.call(void 0,this);return!0}return!1}get onchange(){return this._onchange}set onchange(t){this._onchange&&this.removeEventListener("change",this._onchange),this._onchange=t,this.addEventListener("change",t)}addEventListener(t,e){if(this._eventListeners.has(t)){this._eventListeners.get(t).push(e)}else this._eventListeners.set(t,[e])}removeEventListener(t,e){if(this._eventListeners.has(t)){let n=this._eventListeners.get(t);n.splice(n.indexOf(e),1)}}toString(){return this.value}}class k{constructor(t,e,n){this.keyName=t,this.keyEvent=e,this.scale=n,this.value=0}consumeKey(){this.value=0}updateKey(t,e){if(e===this.keyName)if(this.keyEvent){if(this.keyEvent===t.event)return this.value=t.value*this.scale,!0}else switch(t.event){case"down":return this.value=this.scale,!0;case"up":return this.value=0,!0;default:return void(this.value=t.value*this.scale)}}}const N=Symbol("template"),M=Symbol("style");class _ extends HTMLElement{static get[N](){let t=document.createElement("template");return t.innerHTML='\n<table>\n    <thead>\n        <tr class="header">\n            <th id="title" colspan=3>input-context</th>\n            <th id="poll">&nbsp;</th>\n        </tr>\n        <tr class="hint">\n            <th>input</th>\n            <th>key</th>\n            <th>mod</th>\n            <th>value</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n<slot></slot>',Object.defineProperty(this,N,{value:t}),t}static get[M](){let t=document.createElement("style");return t.innerHTML='\n:host {\n    display: inline-block;\n}\nslot {\n    display: none;\n}\ntable {\n    border-collapse: collapse;\n}\ntable, th, td {\n    border: 1px solid gray;\n}\n#poll {\n    position: relative;\n    font-size: 0.9em;\n}\n#poll:after {\n    content: "(poll)";\n    position: absolute;\n    left: 0;\n    right: 0;\n    z-index: -1;\n    opacity: 0.1;\n    font-family: monospace;\n    letter-spacing: 3px;\n    overflow: hidden;\n}\n.hint > th {\n    font-size: 0.5em;\n    font-family: monospace;\n    padding: 0 10px;\n    letter-spacing: 3px;\n    background-color: #AAA;\n    color: #666666;\n}\nth, td {\n    padding: 5px 10px;\n}\ntd {\n    text-align: center;\n}\nkbd {\n    display: inline-block;\n    background-color: #EEEEEE;\n    border-radius: 3px;\n    border: 1px solid #B4B4B4;\n    box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;\n    color: #333333;\n    font-size: 0.85em;\n    font-weight: 700;\n    line-height: 1;\n    padding: 2px 4px;\n    white-space: nowrap;\n}\noutput {\n    font-family: monospace;\n    border-radius: 0.3em;\n    padding: 3px;\n}\n.flash {\n    animation: fadein 4s;\n}\n@keyframes fadein {\n    0%, 10% { background-color: rgba(0, 0, 255, 0.3); }\n    100% { background-color: rgba(0, 0, 255, 0); }\n}\n',Object.defineProperty(this,M,{value:t}),t}static get observedAttributes(){return["for","strict","onattach","ondetach","id","class"]}constructor(t=null){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[N].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[M].cloneNode(!0)),this._onattach=null,this._ondetach=null,this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._tableBody=this.shadowRoot.querySelector("tbody"),this._children=this.shadowRoot.querySelector("slot"),this._tableInputs={},this._lastPollTime=0,this._pollWarningTimeoutHandle=0,this._animationFrameHandle=0,this._inputTarget=null,this._inputMap=t,this._inputs={},this._inputKeys={},this._keys={},this.onInputEvent=this.onInputEvent.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this),t&&I(this,t)}connectedCallback(){if(this.hasAttribute("for")||this.setAttribute("for",""),!this._inputMap){this._inputMap={};const t=x.toInputMap(this._children.assignedNodes()),e=this.src;e?fetch(e).then(t=>t.json()).then(e=>{this._inputMap={...e,...t},I(this,this._inputMap)}):(this._inputMap={...t},I(this,this._inputMap))}this._lastPollTime=0,this._pollWarningTimeoutHandle=setTimeout(()=>{this._lastPollTime<=0?(this._pollElement.textContent="✗",console.warn("[INPUT] No input updated. Did you forget to poll() the input context?")):this._pollElement.textContent="✓"},3e3),this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){cancelAnimationFrame(this._animationFrameHandle),clearTimeout(this._pollWarningTimeoutHandle)}attributeChangedCallback(t,e,n){switch(t){case"for":let t;t=n?document.getElementById(n):document.querySelector("display-port")||document.querySelector("canvas"),this._inputTarget&&this.detach(),t&&this.attach(t);break;case"onattach":this.onattach=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"ondetach":this.ondetach=new Function("event",`with(document){with(this){${n}}}`).bind(this);break;case"id":case"class":this._titleElement.innerHTML=`input-context${this.className?"."+this.className:""}${this.hasAttribute("id")?"#"+this.getAttribute("id"):""}`}}get src(){return this.getAttribute("src")}set src(t){this.setAttribute("src",t)}get for(){return this.getAttribute("for")}set for(t){this.setAttribute("for",t)}get strict(){return this.hasAttribute("strict")}set strict(t){t?this.setAttribute("strict",""):this.removeAttribute("strict")}get auto(){return this.hasAttribute("auto")}set auto(t){t?this.setAttribute("auto",""):this.removeAttribute("auto")}get onattach(){return this._onattach}set onattach(t){this._onattach&&this.removeEventListener("attach",this._onattach),this._onattach=t,this._onattach&&this.addEventListener("attach",t)}get ondetach(){return this._ondetach}set ondetach(t){this._ondetach&&this.removeEventListener("detach",this._ondetach),this._ondetach=t,this._ondetach&&this.addEventListener("detach",t)}attach(t){if(!t)throw new Error("Cannot attach input context to null.");if(this._inputTarget){if(this._inputTarget!==t)throw new Error("Input context already attached to another element.");return this}let e=t;return e&&(e.canvas?(u.addInputEventListener(e,this.onInputEvent),m.addInputEventListener(e.canvas,this.onInputEvent)):(u.addInputEventListener(e,this.onInputEvent),m.addInputEventListener(e,this.onInputEvent)),this.dispatchEvent(new CustomEvent("attach",{composed:!0,bubbles:!1,detail:{eventTarget:e,inputCallback:this.onInputEvent}}))),this._inputTarget=e,this}detach(){if(!this._inputTarget)return this;let t=this._inputTarget;return this._inputTarget=null,t.canvas?(u.removeInputEventListener(t,this.onInputEvent),m.removeInputEventListener(t.canvas,this.onInputEvent)):(u.removeInputEventListener(t,this.onInputEvent),m.removeInputEventListener(t,this.onInputEvent)),this.dispatchEvent(new CustomEvent("detach",{composed:!0,bubbles:!1,detail:{eventTarget:t,inputCallback:this.onInputEvent}})),this}poll(){this._lastPollTime=performance.now();for(let t in this._inputs){let e=this._inputs[t];switch(e.inputType){case"action":let n=!1;for(let s of this._inputKeys[t]){let t=s.value;if(t){e.update(t,s),s.consumeKey(),n=!0;break}}n||e.update(0,null);break;case"range":let s=0;for(let e of this._inputKeys[t])s+=e.value;e.update(s,null);break;default:throw new Error("Unknown input type.")}}}onInputEvent(t){let e=t.type;switch(e){case"key":{const e=t.device+":"+t.key;if(e in this._keys){let n=!1;for(let s of this._keys[e])s.updateKey(t,e)&&(n=!0);if(n)return!0}}break;case"pos":{const e=["x","y","dx","dy"];for(let n of e){t.value=t[n];const e=t.device+":"+t.key+"."+n;if(e in this._keys){let n=!1;for(let s of this._keys[e])s.updateKey(t,e)&&(n=!0);if(n)return!0}}}break;default:throw new Error(`Unknown input event type '${e}'.`)}}onAnimationFrame(t){this._animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.auto&&this.poll();for(let t in this._inputs){let e,n=this._inputs[t];e=n.value?Number(n.value).toFixed(2):0;let s=this._tableInputs[t];if(s.textContent!=e){s.textContent=e;let t=s.parentNode;s.parentNode.removeChild(s),t.appendChild(s)}}}getInput(t){if(t in this._inputs)return this._inputs[t];if(this.strict)throw new Error(`Cannot find input with name '${t}'.`);{let e=new E(t,"range");return this._inputs[t]=e,e}}getInputValue(t){if(t in this._inputs)return this._inputs[t].value;if(this.strict)throw new Error(`Cannot find input with name '${t}'.`);return 0}}function I(t,e){for(let n in e){let s=e[n];if(Array.isArray(s))for(let e of s)S(t,n,e),"string"==typeof e&&(e={key:e,event:"down"}),C(t,n,e);else S(t,n,s),"string"==typeof s&&(s={key:s,event:"down"}),C(t,n,s)}}function A(t){if("object"==typeof t){if("type"in t)return t.type;if("scale"in t)return"range";if("event"in t)return"action";throw new Error(`Missing 'scale' or 'event' for input option '${inputName}'.`)}if("string"==typeof t)return"action";throw new Error("Invalid type for input mapping option.")}function C(t,e,n){let s=document.createElement("tr");{let t=document.createElement("td");t.textContent=e,t.classList.add("name"),s.appendChild(t)}{let t=document.createElement("td");t.classList.add("key");let e=document.createElement("kbd");e.textContent=n.key,t.appendChild(e),s.appendChild(t)}{let t=document.createElement("td"),e=document.createElement("samp");switch(A(n)){case"action":e.textContent=n.event;break;case"range":e.textContent=Number(n.scale).toFixed(2);break;default:e.textContent="<?>"}t.classList.add("mod"),t.appendChild(e),s.appendChild(t)}if(e in t._tableInputs){let t=document.createElement("td");t.classList.add("value"),s.appendChild(t)}else{let n=document.createElement("td"),i=document.createElement("output");i.textContent=0,i.classList.add("flash"),n.classList.add("value"),n.appendChild(i),s.appendChild(n),t._tableInputs[e]=i}t._tableBody.appendChild(s)}function S(t,e,n){let s=A(n);switch(s){case"action":T(t,e,"string"==typeof n?{key:n,event:"down"}:n);break;case"range":!function(t,e,n){const{key:s,scale:i}=n;let r,o,a;if(e in t._inputs){if(r=t._inputs[e],o=t._inputKeys[e],"range"!==r.inputType)throw new Error(`Cannot register mismatched 'range' type input for '${r.inputType}' type input '${e}'.`)}else r=new E(e,"range"),o=[],t._inputs[e]=r,t._inputKeys[e]=o;s in t._keys?a=t._keys[s]:(a=[],t._keys[s]=a);let h=new k(s,null,i);a.push(h),o.push(h)}(t,e,n);break;default:throw new Error(`Unknown input type '${s}'.`)}}function T(t,e,n){const{key:s,event:i}=n;let r,o,a;if(e in t._inputs){if(r=t._inputs[e],o=t._inputKeys[e],"action"!==r.inputType)throw new Error(`Cannot register mismatched 'action' type input for '${r.inputType}' type input '${e}'.`)}else r=new E(e,"action"),o=[],t._inputs[e]=r,t._inputKeys[e]=o;s in t._keys?a=t._keys[s]:(a=[],t._keys[s]=a);let h=new k(s,i,1);a.push(h),o.push(h)}async function L(t,e){return new Promise((e,n)=>{let s=new Image;s.addEventListener("load",()=>{e(s)}),s.addEventListener("error",t=>{n(t)}),s.src=t})}window.customElements.define("input-context",_);var F=Object.freeze({__proto__:null,loadImage:L});function R(t){const e=[],n=[],s=[],i=[],r=[],o=[],a=/v\s+(\S+)\s+(\S+)\s+(\S+)/g,h=/vn\s+(\S+)\s+(\S+)\s+(\S+)/g,l=/vt\s+(\S+)\s+(\S+)/g,u=/f\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*))\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*))\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*))(\s+(([^\/\s]*)\/([^\/\s]*)\/?([^\/\s]*)))?/g,d=/f\s+([^\/\s]+)\s+([^\/\s]+)\s+([^\/\s]+)/g;let c,p,m,f,y,g,b=!1,w=null;for(t=t.replace(/^#.*/g,"");null!=(w=a.exec(t));)c=Number.parseFloat(w[1]),p=Number.parseFloat(w[2]),m=Number.parseFloat(w[3]),e.push(c),e.push(p),e.push(m);for(;null!=(w=h.exec(t));)c=Number.parseFloat(w[1]),p=Number.parseFloat(w[2]),m=Number.parseFloat(w[3]),s.push(c),s.push(p),s.push(m);for(;null!=(w=l.exec(t));)c=Number.parseFloat(w[1]),p=Number.parseFloat(w[2]),n.push(c),n.push(p);for(;null!=(w=u.exec(t));)c=Number.parseInt(w[2]),Number.isNaN(c)&&(c=1),p=Number.parseInt(w[6]),Number.isNaN(p)&&(p=1),m=Number.parseInt(w[10]),Number.isNaN(m)&&(m=1),i.push(c),i.push(p),i.push(m),c=Number.parseInt(w[4]),Number.isNaN(c)?(c=Number.parseInt(w[3]),p=Number.parseInt(w[7]),m=Number.parseInt(w[11]),o.push(c),o.push(p),o.push(m),r.push(1),r.push(1),r.push(1)):(p=Number.parseInt(w[8]),Number.isNaN(p)&&(p=1),m=Number.parseInt(w[12]),Number.isNaN(m)&&(m=1),o.push(c),o.push(p),o.push(m),c=Number.parseInt(w[3]),Number.isNaN(c)&&(c=1),p=Number.parseInt(w[7]),Number.isNaN(p)&&(p=1),m=Number.parseInt(w[11]),Number.isNaN(m)&&(m=1),r.push(c),r.push(p),r.push(m)),void 0!==w[13]&&(f=Number.parseInt(w[15]),Number.isNaN(f)&&(f=1),i.push(f),f=Number.parseInt(w[17]),Number.isNaN(f)?(f=Number.parseInt(w[16]),o.push(f),r.push(1)):(o.push(f),f=Number.parseInt(w[16]),r.push(f)),b=!0);for(;null!=(w=d.exec(t));)c=Number.parseInt(w[2]),p=Number.parseInt(w[6]),m=Number.parseInt(w[10]),i.push(c),i.push(p),i.push(m),r.push(1),r.push(1),r.push(1),o.push(1),o.push(1),o.push(1),void 0!==w[13]&&(f=Number.parseInt(w[14]),i.push(f),r.push(1),o.push(1),b=!0);g=i.length;const v=new Float32Array(3*g);for(let t=0;t<g;++t)y=i[t]-1,v[3*t+0]=e[3*y+0],v[3*t+1]=e[3*y+1],v[3*t+2]=e[3*y+2];g=r.length;const x=new Float32Array(2*g);for(let t=0;t<g;++t)y=r[t]-1,x[2*t+0]=n[2*y+0],x[2*t+1]=n[2*y+1];g=o.length;const E=new Float32Array(3*g);for(let t=0;t<g;++t)y=o[t]-1,E[3*t+0]=s[3*y+0],E[3*t+1]=s[3*y+1],E[3*t+2]=s[3*y+2];g=i.length;const k=new Uint16Array(g);for(let t=0;t<g;++t)k[t]=t;return b&&console.warn("WebGL does not support quad faces, only triangles."),{positions:v,texcoords:x,normals:E,indices:k}}function q(t){const e=[],n=[],s=[],i=[],r=[],o=[],a=/v( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,h=/vn( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,l=/vt( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g,u=/f( +([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))( ([\d]*)\/([\d]*)\/([\d]*))?/g,d=/f( +[\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)( [\d|\.|\+|\-|e]+)/g;let c,p,m,f,y,g,b=!1,w=null;for(t=t.replace(/^#.*/g,"");null!=(w=a.exec(t));)c=Number.parseFloat(w[1]),p=Number.parseFloat(w[2]),m=Number.parseFloat(w[3]),e.push(c),e.push(p),e.push(m);for(;null!=(w=h.exec(t));)c=Number.parseFloat(w[1]),p=Number.parseFloat(w[2]),m=Number.parseFloat(w[3]),s.push(c),s.push(p),s.push(m);for(;null!=(w=l.exec(t));)c=Number.parseFloat(w[1]),p=Number.parseFloat(w[2]),n.push(c),n.push(p);for(;null!=(w=u.exec(t));)c=Number.parseInt(w[2]),Number.isNaN(c)&&(c=1),p=Number.parseInt(w[6]),Number.isNaN(p)&&(p=1),m=Number.parseInt(w[10]),Number.isNaN(m)&&(m=1),i.push(c),i.push(p),i.push(m),c=Number.parseInt(w[3]),Number.isNaN(c)&&(c=1),p=Number.parseInt(w[7]),Number.isNaN(p)&&(p=1),m=Number.parseInt(w[11]),Number.isNaN(m)&&(m=1),r.push(c),r.push(p),r.push(m),c=Number.parseInt(w[4]),Number.isNaN(c)&&(c=1),p=Number.parseInt(w[8]),Number.isNaN(p)&&(p=1),m=Number.parseInt(w[12]),Number.isNaN(m)&&(m=1),o.push(c),o.push(p),o.push(m),void 0!==w[13]&&(f=Number.parseInt(w[14]),Number.isNaN(f)&&(f=1),i.push(f),f=Number.parseInt(w[15]),Number.isNaN(f)&&(f=1),r.push(f),f=Number.parseInt(w[16]),Number.isNaN(f)&&(f=1),o.push(f),b=!0);for(;null!=(w=d.exec(t));)c=Number.parseInt(w[2]),p=Number.parseInt(w[6]),m=Number.parseInt(w[10]),i.push(c),i.push(p),i.push(m),r.push(1),r.push(1),r.push(1),o.push(1),o.push(1),o.push(1),void 0!==w[13]&&(f=Number.parseInt(w[14]),i.push(f),r.push(1),o.push(1),b=!0);g=i.length;const v=new Float32Array(3*g);for(let t=0;t<g;++t)y=i[t]-1,v[3*t+0]=e[3*y+0],v[3*t+1]=e[3*y+1],v[3*t+2]=e[3*y+2];g=r.length;const x=new Float32Array(2*g);for(let t=0;t<g;++t)y=r[t]-1,x[2*t+0]=n[2*y+0],x[2*t+1]=n[2*y+1];g=o.length;const E=new Float32Array(3*g);for(let t=0;t<g;++t)y=o[t]-1,E[3*t+0]=s[3*y+0],E[3*t+1]=s[3*y+1],E[3*t+2]=s[3*y+2];g=i.length;const k=new Uint16Array(g);for(let t=0;t<g;++t)k[t]=t;return b&&console.warn("WebGL does not support quad faces, only triangles."),{positions:v,texcoords:x,normals:E,indices:k}}let j={};function K(t,e){j[t]=e}function B(t){if(t in j)return j[t];throw new Error(`Unknown asset type '${t}'.`)}async function $(t,e={},n="."){if(t.indexOf(":")<0)throw new Error("Missing type for asset source.");let[s,i]=t.split(":"),r=B(s);return await r(n+"/"+i,e)}K("image",L),K("text",(async function(t,e){return(await fetch(t)).text()})),K("json",(async function(t,e){let n=await fetch(t);return await n.json()})),K("bytes",(async function(t,e){let n=await fetch(t);return await n.arrayBuffer()})),K("obj",(async function(t,e){let n=await fetch(t),s=await n.text();{const t=10;for(let e=0;e<t;++e){performance.now();q(s);performance.now()}}{const t=10;for(let e=0;e<t;++e){performance.now();R(s);performance.now()}}return R(s)}));var P=Object.freeze({__proto__:null,defineAssetLoader:K,getAssetLoader:B,loadAssetMap:async function(t,e="."){let n={};for(let s of Object.keys(t)){let i=t[s];if("string"==typeof i)n[s]=await $(i,void 0,e);else{if("object"!=typeof i)throw new Error("Unknown entry type in asset map.");if(!("src"in i))throw new Error("Missing required field 'src' for entry in asset map.");if("name"in i&&i.name!==s)throw new Error(`Cannot redefine name for asset '${s}' for entry in asset map.`);n[s]=await $(i.src,i,e)}}return n},loadAssetList:async function(t,e="."){let n={};for(let s of t)if("string"==typeof s)n[s]=await $(s,void 0,e);else{if("object"!=typeof s)throw new Error("Unknown entry type in asset list.");if(!("src"in s))throw new Error("Missing required field 'src' for entry in asset list.");n["name"in s?s.name:s.src]=await $(s.src,s,e)}return n},loadAsset:$});!async function(t){document.addEventListener("click",()=>{"suspended"===t.state&&t.resume()})}(new AudioContext);class O{static createBounds(t,e,n,s){return{x:t,y:e,rx:n,ry:s}}constructor(t=0,e=O.createBounds(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)){this.level=t,this.bounds=e,this.boxes=[],this.nodes=new Array(4)}insertAll(t){for(let e of t)this.insert(e)}insert(t){let e=this.nodes[0];if(e){let e=this.findQuadIndex(t);if(e>=0)return void this.nodes[e].insert(t)}if(this.boxes.push(t),this.boxes.length>10&&this.level<5){e||this.split();for(let t=this.boxes.length-1;t>=0;--t){let e=this.boxes[t],n=this.findQuadIndex(e);n>=0&&(this.boxes.splice(t,1),this.nodes[n].insert(e))}}}retrieve(t,e=[],n={}){const{includeSelf:s=!1}=n;if(this.nodes[0]){let n=this.findQuadIndex(t);n>=0&&this.nodes[n].retrieve(t,e)}let i=this.boxes;if(s)e.push(...i);else{let n=i.indexOf(t);for(let t=0;t<n;++t)e.push(i[t]);let s=i.length;for(let t=n+1;t<s;++t)e.push(i[t])}return e}clear(){this.boxes.length=0;for(let t=0;t<this.nodes.length;++t){let e=this.nodes[t];e&&(e.clear(),this.nodes[t]=null)}}split(){let{x:t,y:e,rx:n,ry:s}=this.bounds,i=this.level+1,r=this.constructor;this.nodes[0]=new r(i,O.createBounds(t+n,e,n,s)),this.nodes[1]=new r(i,O.createBounds(t,e,n,s)),this.nodes[2]=new r(i,O.createBounds(t,e+s,n,s)),this.nodes[3]=new r(i,O.createBounds(t+n,e+s,n,s))}findQuadIndex(t){const{x:e,y:n,rx:s,ry:i}=this.bounds,r=e+s,o=n+i,{x:a,y:h,rx:l,ry:u}=t,d=h<o&&h+2*u<o,c=h>o;let p=-1;return a<r&&a+2*l<r?d?p=1:c&&(p=2):a>r&&(d?p=0:c&&(p=3)),p}}function W(t,e,n,s,i,r,o){return{x:t,y:e,dx:n,dy:s,nx:i,ny:r,time:o}}function H(t,e){let n=e.x-t.x,s=e.rx+t.rx-Math.abs(n);if(s<0)return null;let i=e.y-t.y,r=e.ry+t.ry-Math.abs(i);if(r<0)return null;if(s<r){let i=Math.sign(n);return W(t.x+t.rx*i,e.y,s*i,0,i,0,0)}{let n=Math.sign(i);return W(e.x,t.y+t.ry*n,0,r*n,0,n,0)}}const D=Symbol("maskCount");class G{constructor(t={}){this.masks=new Map,this.boxes=new Set,this.dynamics=new Map,this.quadtree=new O}add(t,e,n={}){let s=function(t,e,n,s){return{owner:t,name:e,box:n,get:s}}(t,e,null,null);if(this.masks.has(t)){if(e in this.masks.get(t))throw new Error(`Mask ${e} already exists for owner.`);{let n=this.masks.get(t);n[e]=s,n[D]++}}else this.masks.set(t,{[D]:1,[e]:s});if(Array.isArray(n)){const t=n[0]||0,e=n[1]||0,i=n[2]/2||0,r=n[3]/2||0;let o=new z(this,s,t,e,i,r);this.boxes.add(o),s.box=o}else if("object"==typeof n){let e=n.x||0,i=n.y||0,r=n.rx||n.width/2||0,o=n.ry||n.height/2||0;"object"==typeof t&&(e||(e=t.x||0),i||(i=t.y||0),r||(r=t.width/2||0),o||(o=t.height/2||0));let a=new z(this,s,e,i,r,o);this.boxes.add(a),s.box=a,"get"in n&&(s.get=n.get,s.get(a,t),this.dynamics.set(s,{halfdx:0,halfdy:0}))}else{if("function"!=typeof n)throw new Error("Invalid mask option type.");{let e=new z(this,s,0,0,0,0);this.boxes.add(e),s.box=e,s.get=n,s.get(e,t),this.dynamics.set(s,{halfdx:0,halfdy:0})}}}remove(t,e){if(this.masks.has(t)){let n=this.masks.get(t),s=n[e];if(s){return s.get&&this.dynamics.delete(s),this.boxes.delete(s.box),n[e]=null,--n[D]<=0&&this.masks.delete(t),!0}return!1}return!1}get(t,e){return this.masks.has(t)?this.masks.get(t)[e]:null}count(t){return this.masks.has(t)?this.masks.get(t)[D]:0}clear(){this.boxes.clear(),this.masks.clear(),this.dynamics.clear(),this.quadtree.clear()}solve(t){for(let t of this.dynamics.keys()){let{box:e,owner:n}=t,s=e.x,i=e.y;t.get(e,n);let r=this.dynamics.get(t),o=(e.x-s)/2,a=(e.y-i)/2;r.halfMotionX=o,r.halfMotionY=a,e.x-=o,e.y-=a,e.rx+=Math.abs(o),e.ry+=Math.abs(a)}null==t&&(t=this.masks.keys());let e=[],n=this.quadtree;n.clear(),n.insertAll(this.boxes);for(let t of this.dynamics.keys()){const{box:e}=t,{halfMotionX:n,halfMotionY:s}=this.dynamics.get(t);e.x+=n,e.y+=s,e.rx-=Math.abs(n),e.ry-=Math.abs(s)}let s=[];for(let i of t){let t=Object.values(this.masks.get(i));for(let r of t){const{box:t}=r;n.retrieve(t,s);let o=0,a=0;if(this.dynamics.has(r)){const{halfMotionX:t,halfMotionY:e}=this.dynamics.get(r);o=2*t,a=2*e}for(let n of s){let s=H(t,n);s&&e.push({owner:i,other:n.mask.owner,ownerMask:r,otherMask:n.mask,hit:s,dx:o,dy:a})}s.length=0}}return e}}class z{constructor(t,e,n,s,i,r){this.aabbGraph=t,this.mask=e,this.x=n,this.y=s,this.rx=i,this.ry=r}setPosition(t,e){return this.x=t,this.y=e,this}setSize(t,e){return this.setHalfSize(t/2,e/2)}setHalfSize(t,e){return this.rx=t,this.ry=e,this}}const X={};class U{constructor(t={}){const{componentFactoryMap:e={},strictMode:n=!1}=t;let s={},i={};for(let t in e){let n,r,o=e[t];try{n="create"in o?o.create:"function"==typeof o?o:null,r="destroy"in o?o.destroy:null}catch(t){throw new Error("Unsupported component factory options.")}s[t]={owner:o,create:n,destroy:r},i[t]={}}this.factoryMap=s,this.instances=i,this.entities=new Set,this.nextAvailableEntityId=1,this.strictMode=n}create(t){if(void 0!==t){if("string"!=typeof t)throw new Error("Invalid type for entity id - must be a string.")}else t=String(this.nextAvailableEntityId++);if(this.entities.has(t))throw new Error(`Invalid duplicate entity id '${t}' allocated for new entity.`);return this.entities.add(t),t}destroy(t){for(let e in this.instances)this.remove(e,t);this.entities.delete(t)}add(t,e,n){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);this.factoryMap[t]={owner:{},create:null,destroy:null},this.instances[t]={}}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);if(!this.entities.has(e))throw new Error(`Entity '${e}' does not exist.`);if(this.instances[t][e])throw new Error(`Entity already has component '${t}'.`);const{create:s}=this.factoryMap[t];let i=s?s(void 0!==n?n:X,e,this):n?{...n}:{};i&&(this.instances[t][e]=i)}remove(t,e){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);return}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);let n=this.instances[t],s=n[e];if(s){n[e]=null;const{destroy:i}=this.factoryMap[t];i&&i(s,e,this)}}get(t,e){if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);return this.instances[t][e]||null}has(t,e){return t in this.instances&&Boolean(this.instances[t][e])}clear(t){if(!(t in this.factoryMap)){if(this.strictMode)throw new Error(`Missing component factory for '${t}'.`);return}if(!(t in this.instances))throw new Error(`Missing component instance mapping for '${t}'.`);let e=this.instances[t];const{destroy:n}=this.factoryMap[t];if(n)for(let s in e){let i=e[s];e[s]=null,n(i,t,s,this)}this.instances[t]={}}getEntityIds(){return this.entities}getComponentFactory(t){return t in this.factoryMap?this.factoryMap[t].owner:null}getComponentNames(){return Object.keys(this.factoryMap)}getComponentEntityIds(t){return t in this.instances?Object.keys(this.instances[t]):[]}getComponentInstances(t){return t in this.instances?Object.values(this.instances[t]):[]}}class Y{constructor(t={}){this.nodeConstructor=t.nodeConstructor||tt,this.nodes=new Map,this.rootNodes=[]}add(t,e=null){if(null===t)throw new Error("Cannot add null as child to scene graph.");if(null===e||this.nodes.has(e)){let n=null===e?null:this.nodes.get(e);if(this.nodes.has(t)){let e=this.nodes.get(t);return Q(e.parentNode,e,this),V(n,e,this),e}{let e=new this.nodeConstructor(this,t,null,[]);return this.nodes.set(t,e),V(n,e,this),e}}throw new Error("No node in scene graph exists for parent.")}remove(t){if(null===t)return this.clear(),!0;if(this.nodes.has(t)){let e=this.nodes.get(t);return Q(e.parentNode,e,this),Z(this,e,0,t=>{this.nodes.delete(t)}),!0}return!1}replace(t,e){if(null===t)throw new Error("Cannot replace null for child in scene graph.");if(this.nodes.has(t)){let n=this.nodes.get(t),s=n.parentNode,i=[...n.childNodes];if(Q(s,n,this),n.childNodes.length=0,null===e)null===s?this.rootNodes.push(...i):s.childNodes.push(...i);else{let t;this.nodes.has(e)?(t=this.nodes.get(e),Q(t.parentNode,t,this),t.childNodes.push(...i)):(t=new this.nodeConstructor(this,e,null,i),this.nodes.set(e,t)),V(s,t,this)}for(let t of i)t.parentNode=s;return e}if(null===t)return this.replace(this.root.owner,e);throw new Error("Cannot find target object to replace in scene graph.")}clear(){this.nodes.clear(),this.rootNodes.length=0}get(t){return this.nodes.get(t)}walk(t,e,n={}){const{childrenOnly:s=!0,childrenCallback:i}=n;if(null===t){J(this.nodes,this.rootNodes,null,i);for(let t of this.rootNodes)Z(this,t,0,e,i)}else{const n=this.get(t);if(n)throw new Error("No node in scene graph exists for walk start.");if(s){J(this.nodes,n.childNodes,n,i);for(let t of n.childNodes)Z(this,t,0,e,i)}else Z(this,n,0,e,i)}}}function V(t,e,n){null===t?(n.rootNodes.push(e),e.parentNode=null):(t.childNodes.push(e),e.parentNode=t)}function Q(t,e,n){if(null===t){let t=n.rootNodes.indexOf(e);n.rootNodes.splice(t,1),e.parentNode=void 0}else{let n=t.childNodes.indexOf(e);t.childNodes.splice(n,1),e.parentNode=void 0}}function Z(t,e,n,s,i){if(n>=100)return;let r=s(e.owner,e);if(!1===r)return;let o=e.childNodes;i&&J(t.nodes,o,e,i);for(let t of o)Z(t,n+1,s);"function"==typeof r&&r(e.owner,e)}function J(t,e,n,s){let i=e.map(t=>t.owner);s(i,n);for(let n=0;n<i.length;++n)e[n]=t.get(i[n]);e.length=i.length}class tt{constructor(t,e,n,s){this.sceneGraph=t,this.owner=e,this.parentNode=n,this.childNodes=s}}var et="undefined"!=typeof Float32Array?Float32Array:Array;function nt(){var t=new et(16);return et!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function st(t,e,n){var s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],d=e[8],c=e[9],p=e[10],m=e[11],f=e[12],y=e[13],g=e[14],b=e[15],w=n[0],v=n[1],x=n[2],E=n[3];return t[0]=w*s+v*a+x*d+E*f,t[1]=w*i+v*h+x*c+E*y,t[2]=w*r+v*l+x*p+E*g,t[3]=w*o+v*u+x*m+E*b,w=n[4],v=n[5],x=n[6],E=n[7],t[4]=w*s+v*a+x*d+E*f,t[5]=w*i+v*h+x*c+E*y,t[6]=w*r+v*l+x*p+E*g,t[7]=w*o+v*u+x*m+E*b,w=n[8],v=n[9],x=n[10],E=n[11],t[8]=w*s+v*a+x*d+E*f,t[9]=w*i+v*h+x*c+E*y,t[10]=w*r+v*l+x*p+E*g,t[11]=w*o+v*u+x*m+E*b,w=n[12],v=n[13],x=n[14],E=n[15],t[12]=w*s+v*a+x*d+E*f,t[13]=w*i+v*h+x*c+E*y,t[14]=w*r+v*l+x*p+E*g,t[15]=w*o+v*u+x*m+E*b,t}function it(t,e,n,s){var i=e[0],r=e[1],o=e[2],a=e[3],h=i+i,l=r+r,u=o+o,d=i*h,c=i*l,p=i*u,m=r*l,f=r*u,y=o*u,g=a*h,b=a*l,w=a*u,v=s[0],x=s[1],E=s[2];return t[0]=(1-(m+y))*v,t[1]=(c+w)*v,t[2]=(p-b)*v,t[3]=0,t[4]=(c-w)*x,t[5]=(1-(d+y))*x,t[6]=(f+g)*x,t[7]=0,t[8]=(p+b)*E,t[9]=(f-g)*E,t[10]=(1-(d+m))*E,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function rt(){var t=new et(3);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ot(t,e,n){var s=new et(3);return s[0]=t,s[1]=e,s[2]=n,s}function at(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t}function ht(t,e,n){var s=e[0],i=e[1],r=e[2],o=n[0],a=n[1],h=n[2];return t[0]=i*h-r*a,t[1]=r*o-s*h,t[2]=s*a-i*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var lt,ut=function(t){var e=t[0],n=t[1],s=t[2];return Math.hypot(e,n,s)};lt=rt();!function(){var t,e=(t=new et(4),et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function dt(){var t=new et(4);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ct(t,e,n,s){var i,r,o,a,h,l=e[0],u=e[1],d=e[2],c=e[3],p=n[0],m=n[1],f=n[2],y=n[3];return(r=l*p+u*m+d*f+c*y)<0&&(r=-r,p=-p,m=-m,f=-f,y=-y),1-r>1e-6?(i=Math.acos(r),o=Math.sin(i),a=Math.sin((1-s)*i)/o,h=Math.sin(s*i)/o):(a=1-s,h=s),t[0]=a*l+h*p,t[1]=a*u+h*m,t[2]=a*d+h*f,t[3]=a*c+h*y,t}var pt,mt,ft,yt,gt,bt,wt,vt=function(t,e){var n=e[0],s=e[1],i=e[2],r=e[3],o=n*n+s*s+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=s*o,t[2]=i*o,t[3]=r*o,t};pt=rt(),mt=ot(1,0,0),ft=ot(0,1,0),yt=dt(),gt=dt(),bt=new et(9),et!=Float32Array&&(bt[1]=0,bt[2]=0,bt[3]=0,bt[5]=0,bt[6]=0,bt[7]=0),bt[0]=1,bt[4]=1,bt[8]=1,wt=bt;class xt extends class{getViewMatrix(t){}getProjectionMatrix(t){}}{constructor(t=-1,e=1,n=-1,s=1,i=0,r=1){super(),this.position=rt(),this.rotation=dt(),this.scale=ot(1,1,1),this.clippingPlane={left:t,right:e,top:n,bottom:s,near:i,far:r}}get x(){return this.position[0]}set x(t){this.position[0]=t}get y(){return this.position[1]}set y(t){this.position[1]=t}get z(){return this.position[2]}set z(t){this.position[2]=t}moveTo(t,e,n=0,s=1){let i=ot(t,e,n);return function(t,e,n,s){var i=e[0],r=e[1],o=e[2];t[0]=i+s*(n[0]-i),t[1]=r+s*(n[1]-r),t[2]=o+s*(n[2]-o)}(this.position,this.position,i,Math.max(Math.min(s,1),0)),this}getViewMatrix(t){let e=-Math.round(this.x),n=-Math.round(this.y),s=0===this.z?1:1/this.z,i=ot(e,n,0),r=ot(this.scale[0]*s,this.scale[1]*s,1);return it(t,this.rotation,i,r),t}getProjectionMatrix(t){let{left:e,right:n,top:s,bottom:i,near:r,far:o}=this.clippingPlane;return function(t,e,n,s,i,r,o){var a=1/(e-n),h=1/(s-i),l=1/(r-o);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+s)*h,t[14]=(o+r)*l,t[15]=1}(t,e,n,s,i,r,o),t}}class Et{constructor(t,e=new xt){this.display=t,this.camera=e,this.viewTransformDOMMatrix=new DOMMatrix}transformScreenToWorld(t,e){let n=nt();this.getViewProjectionMatrix(n),function(t,e){var n=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],d=e[9],c=e[10],p=e[11],m=e[12],f=e[13],y=e[14],g=e[15],b=n*a-s*o,w=n*h-i*o,v=n*l-r*o,x=s*h-i*a,E=s*l-r*a,k=i*l-r*h,N=u*f-d*m,M=u*y-c*m,_=u*g-p*m,I=d*y-c*f,A=d*g-p*f,C=c*g-p*y,S=b*C-w*A+v*I+x*_-E*M+k*N;S&&(S=1/S,t[0]=(a*C-h*A+l*I)*S,t[1]=(i*A-s*C-r*I)*S,t[2]=(f*k-y*E+g*x)*S,t[3]=(c*E-d*k-p*x)*S,t[4]=(h*_-o*C-l*M)*S,t[5]=(n*C-i*_+r*M)*S,t[6]=(y*v-m*k-g*w)*S,t[7]=(u*k-c*v+p*w)*S,t[8]=(o*A-a*_+l*N)*S,t[9]=(s*_-n*A-r*N)*S,t[10]=(m*E-f*v+g*b)*S,t[11]=(d*v-u*E-p*b)*S,t[12]=(a*M-o*I-h*N)*S,t[13]=(n*I-s*M+i*N)*S,t[14]=(f*w-m*x-y*b)*S,t[15]=(u*x-d*w+c*b)*S)}(n,n);let s=vec3.fromValues(t,e,0);return vec3.transformMat4(s,s,n),s}transformCanvas(t){let e=this.viewTransformDOMMatrix,n=nt();this.getViewProjectionMatrix(n),kt(e,n);const{a:s,b:i,c:r,d:o,e:a,f:h}=e;t.transform(s,i,r,o,a,h)}getViewProjectionMatrix(t){const e=this.display.width,n=this.display.height;let s=nt();const i=this.camera.getProjectionMatrix(s);st(s,this.camera.getViewMatrix(t),i);const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(t,[e/2,n/2,0]);return st(t,r,s),t}}function kt(t,e){return t.a=e[0],t.b=e[1],t.c=e[4],t.d=e[5],t.e=e[12],t.f=e[13],t}const Nt=Symbol("worldInstance"),Mt=Symbol("worldProvided"),_t=Symbol("worldDependencies");class It{static getWorld(t={}){const{lazy:e=!0}=t;if(Nt in this){return this[Nt]}{if(!e)throw new Error("Invalid immediate access to uninitialized world. Must call World.provide() before this or be lazily loaded.");let t=new this(Nt);return this[Nt]=t,t}}static provide(t){let e=this.getWorld();if(e[Mt])throw new Error("Can only provide world values once.");let n=new Set(e[_t]);for(let[s,i]of Object.entries(t))e[s]=i,n.has(s)&&n.delete(s);if(e[Mt]=!0,n.size<=0)return Object.freeze(e),e;throw new Error("Missing required world dependencies: "+Array.from(n))}static require(...t){let e=this.getWorld();if(e[Mt]){let n=[];for(let s of t)e[_t].has(s)||n.push(s);if(n.length>0)throw new Error("Missing required world dependencies: "+n)}else for(let n of t)e[_t].add(n);return this}constructor(t){if(t!==Nt)throw new Error("World cannot be instantiated externally.");this[_t]=new Set,this[Mt]=!1}}It.require("sceneGraph");const At={create(t,e){const{parentId:n,x:s=0,y:i=0,z:r=0}=t,{sceneGraph:o}=It.getWorld();return o.add(e,n),{worldTransformation:nt(),localTransformation:nt(),x:s,y:i,z:r,pitch:0,yaw:0,roll:0,scaleX:1,scaleY:1,scaleZ:1}},destroy(t,e){const{sceneGraph:n}=It.getWorld();n.remove(e)}},Ct={create(t){const{renderType:e,...n}=t;if(!e)throw new Error("Component instantiation is missing required prop 'renderType'.");return{renderType:e,...n}}};It.require("aabbGraph");const St={create(t,e){const{aabbGraph:n}=It.getWorld(),{masks:s}=t;for(let t in s)n.add(e,t,s[t]);return{masks:s,collided:!1}},destroy(t,e){const{aabbGraph:n}=It.getWorld(),{masks:s}=t;for(let t in s)n.remove(e,t)}},Tt={create(t){const{motionX:e=0,motionY:n=0,speed:s=.6,friction:i=.25}=t;return{motionX:e,motionY:n,speed:s,friction:i,moving:!1,facing:1}}},Lt={create(t){const{textureStrip:e,offsetX:n=0,offsetY:s=0}=t;if(!e)throw new Error("Component instantiation is missing required prop 'textureStrip'.");return{textureStrip:e,spriteIndex:0,dt:0,offsetX:n,offsetY:s}},draw(t,e,n=e.spriteIndex){const s=e.textureStrip.unitWidth,i=e.textureStrip.unitHeight,{offsetX:r,offsetY:o}=e;e.textureStrip.unitDraw(t,-s/2+r,-i/2+o,n)},next(t,e=1){t.dt+=e;const n=Math.floor(t.dt);t.dt-=n,t.spriteIndex=(t.spriteIndex+n)%t.textureStrip.length}},Ft={create(t){const{masks:e}=t;if(!e)throw new Error("Component instantiation is missing required prop 'masks'.");return{masks:e}}};var Rt={moveUp:[{key:"keyboard:ArrowUp",scale:1},{key:"keyboard:KeyW",scale:1}],moveDown:[{key:"keyboard:ArrowDown",scale:1},{key:"keyboard:KeyS",scale:1}],moveLeft:[{key:"keyboard:ArrowLeft",scale:1},{key:"keyboard:KeyA",scale:1}],moveRight:[{key:"keyboard:ArrowRight",scale:1},{key:"keyboard:KeyD",scale:1}],mainAction:[{key:"keyboard:KeyE",scale:1},{key:"keyboard:Space",scale:1}],inventory:[{key:"keyboard:KeyF",event:"up"},{key:"keyboard:KeyI",event:"up"}],sprint:[{key:"keyboard:ShiftLeft",scale:1},{key:"keyboard:ShiftRight",scale:1}],sneak:[{key:"keyboard:ControlLeft",scale:1},{key:"keyboard:ControlRight",scale:1}]},qt={dungeon:{src:"atlas:dungeon/dungeon.atlas"}};It.require("entityManager");class jt{static getGameObjectById(t,e){return t.get("GameObject",e)}static create(t,e,n){if(t instanceof jt){if(void 0===t.entityId&&void 0===t.entityManager)return t;throw new Error("Cannot allocate multiple entity ids for a GameObject.")}throw new Error("Cannot create GameObject component without GameObject instance.")}static destroy(t,e,n){t.onDestroy()}constructor(){const{entityManager:t}=It.getWorld(),e=t.create();t.add("GameObject",e,this),this.entityId=e,this.entityManager=t}onDestroy(){}get(t){return this.entityManager.get(t,this.entityId)}has(t){return this.entityManager.has(t,this.entityId)}add(t,e){this.entityManager.add(t,this.entityId,e)}remove(t){this.entityManager.remove(t,this.entityId)}}It.require("entityManager");const Kt={renderType:"sprite"};class Bt extends jt{constructor(){super();const{assets:t}=It.getWorld();this.add("Transform"),this.add("Motion"),this.add("Renderable",Kt),this.add("PlayerControlled",!0),this.add("Collidable",Bt.maskProps),this.add("Sprite",{textureStrip:t.dungeon.getSubTexture("elf_m_run_anim"),offsetY:-8})}}Bt.maskProps={masks:{main:{rx:6,ry:6,get(t,e){const{entityManager:n}=It.getWorld(),s=n.get("Transform",e);t.x=s.x,t.y=s.y}}}};class $t extends jt{constructor(t=0,e=0,n=t+10,s=e+10){super();const i=(n-t)/2,r=(s-e)/2,o=t+i,a=e+r,{assets:h}=It.getWorld();this.add("Transform",{x:o,y:a}),this.add("Renderable",{renderType:"sprite"}),this.add("Sprite",{textureStrip:h.dungeon.getSubTexture("wall_mid")}),this.add("Collidable",{masks:{main:{x:o,y:a,rx:i,ry:r}}}),this.add("Solid",{masks:["main"]})}}class Pt{constructor(t,e){this.entityManager=t,this.input=e}update(t){const{entityManager:e,input:n}=this;for(let t of e.getComponentEntityIds("Motion")){let s=e.get("Motion",t);if(e.has("PlayerControlled",t)){let t=n.getInputValue("moveRight")-n.getInputValue("moveLeft"),e=n.getInputValue("moveDown")-n.getInputValue("moveUp");if(t||e){let n=Math.atan2(e,t),i=Math.cos(n),r=Math.sin(n);s.motionX+=i*s.speed,s.motionY+=r*s.speed,s.moving=!0,s.facing=Math.sign(i)}else s.moving=!1}let i=1-s.friction;if(s.motionX*=i,s.motionY*=i,e.has("Transform",t)){let n=e.get("Transform",t);n.x+=s.motionX,n.y+=s.motionY}}}}class Ot{constructor(t,e,n=1){this.entityManager=t,this.view=e,this.cameraSpeed=n}update(t){const{entityManager:e,view:n}=this;let s=e.getComponentEntityIds("PlayerControlled")[0],i=e.get("Transform",s);n.camera.moveTo(i.x,i.y,0,t*this.cameraSpeed)}}class Wt{constructor(t,e){this.entityManager=t,this.aabbGraph=e}update(t){const{entityManager:e,aabbGraph:n}=this;for(let t of e.getComponentInstances("Collidable"))t.collided=!1;let s=n.solve(e.getComponentEntityIds("Motion"));for(let t of s){{let n=t.owner;e.get("Collidable",n).collided=!0}{let n=t.other;e.get("Collidable",n).collided=!0}{let n=t.owner,s=t.other;if(e.has("Motion",n)&&e.has("Transform",n)&&e.has("Solid",s)){if(e.get("Solid",s).masks.includes(t.otherMask.name)){let s=e.get("Motion",n),i=e.get("Transform",n);i.x-=t.hit.dx,i.y-=t.hit.dy,t.hit.nx&&Math.sign(t.hit.nx)===Math.sign(s.motionX)&&(s.motionX=0),t.hit.ny&&Math.sign(t.hit.ny)===Math.sign(s.motionY)&&(s.motionY=0)}}}}}}class Ht{constructor(t){this.source=t,this.width=t.width,this.height=t.height}draw(t,e,n){this.subDraw(t,e,n,0,0,this.width,this.height)}subDraw(t,e,n,s,i,r,o){t.drawImage(this.source,s,i,r,o,e,n,r,o)}}class Dt extends Ht{constructor(t){super(t),this.textures={}}addSubTexture(t,e,n,s,i,r=1,o=1){return this.textures[t]=new Gt(this.source,e,n,s,i,r,o),this}remove(t){return delete this.textures[t],this}clear(){return this.textures={},this}getSubTexture(t){let e=this.textures[t];if(e)return e;throw new Error(`Textue '${t}' does not exist in texture atlas.`)}}class Gt extends Ht{constructor(t,e=0,n=0,s=t.width,i=t.height,r=1,o=1){super(t),this.length=r*o,this.width=s*r,this.height=i*o,this.unitWidth=s,this.unitHeight=i,this.u=e,this.v=n}subDraw(t,e,n,s,i,r,o){t.drawImage(this.source,this.u+s,this.v+i,r,o,e,n,r,o)}unitDraw(t,e,n,s){const{unitWidth:i,unitHeight:r,length:o}=this;let a=(s=Math.abs(s%o))%i*i,h=Math.floor(s/i)*r;this.subDraw(t,e,n,a,h,i,r)}}async function zt(t,e){let n=await fetch(t),s=await n.text();const i=t.substring(0,t.lastIndexOf("."))+".png";return function(t,e){let n=new Dt(t);for(let t of e.split("\n")){if(t=t.trim(),t.length<=0)continue;if(t.startsWith("//"))continue;if(t.startsWith("#"))continue;let[e,s,i,r,o,a,h]=t.split(/\s+/);s=Number(s),i=Number(i),r=Number(r),o=Number(o),a=void 0!==a?Number(a):1,h=void 0!==h?Number(h):1,n.addSubTexture(e,s,i,r,o,a,h)}return n}(await F.loadImage(i),s)}class Xt{constructor(t,e,n,s){this.entityManager=t,this.sceneGraph=e,this.aabbGraph=n,this.view=s,this.renderers={},this.renderScene=this.renderScene.bind(this),this.renderNode=this.renderNode.bind(this)}registerRenderer(t,e){return this.renderers[t]=e,this}unregisterRenderer(t){return delete this.renderers[t],this}render(t){!function(t,e,n){let s=e.getViewProjectionMatrix(nt()),i=new DOMMatrix;kt(i,s);let r=t.getTransform();t.setTransform(i),n(t),t.setTransform(r)}(t,this.view,this.renderScene)}renderScene(t){const{entityManager:e,sceneGraph:n,aabbGraph:s}=this;!function(t,e,n,s){let i=dt(),r=rt(),o=rt(),a=new DOMMatrix;e.walk(null,(e,h)=>{let l=n.get("Transform",e),{localTransformation:u,worldTransformation:d}=l;if(function(t,e,n,s){var i=.5*Math.PI/180;e*=i,n*=i,s*=i;var r=Math.sin(e),o=Math.cos(e),a=Math.sin(n),h=Math.cos(n),l=Math.sin(s),u=Math.cos(s);t[0]=r*h*u-o*a*l,t[1]=o*a*u+r*h*l,t[2]=o*h*l-r*a*u,t[3]=o*h*u+r*a*l}(i,l.pitch,l.yaw,l.roll),at(r,l.x,l.y,l.z),at(o,l.scaleX,l.scaleY,l.scaleZ),it(u,i,r,o),h.parentNode){let t=h.parentNode.owner,{worldTransformation:e}=n.get("Transform",t);st(d,e,u)}else!function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(d,u);kt(a,d);let c=t.getTransform();t.transform(a.a,a.b,a.c,a.d,a.e,a.f),s(t,e,h),t.setTransform(c)},{childrenCallback(t,e){t.sort((t,e)=>{let s=n.get("Transform",t),i=n.get("Transform",e);return Math.floor(s.z-i.z)||s.y-i.y})}})}(t,n,e,this.renderNode),function(t,e,n){for(let s of n.getComponentEntityIds("Collidable")){let i=n.get("Collidable",s);i.collided?t.strokeStyle="red":t.strokeStyle="limegreen";for(let n in i.masks){let i=e.get(s,n);if(i){let e=i.box;t.strokeRect(e.x-e.rx,e.y-e.ry,2*e.rx,2*e.ry)}}}}(t,s,e)}renderNode(t,e){const{entityManager:n}=this;if(n.has("Renderable",e)){const{renderType:s}=n.get("Renderable",e);s in this.renderers&&this.renderers[s](t,e,n)}else t.fillStyle="red",t.fillRect(-1,-1,2,2)}}const Ut={create(t){const{textureStrip:e,offsetX:n=0,offsetY:s=0}=t;if(!e)throw new Error("Component instantiation is missing required prop 'textureStrip'.");return{textureStrip:e,spriteIndex:0,dt:0,offsetX:n,offsetY:s}},draw(t,e,n=e.spriteIndex){const s=e.textureStrip.unitWidth,i=e.textureStrip.unitHeight,{offsetX:r,offsetY:o}=e;e.textureStrip.unitDraw(t,-s/2+r,-i/2+o,n)},next(t,e=1){t.dt+=e;const n=Math.floor(t.dt);t.dt-=n,t.spriteIndex=(t.spriteIndex+n)%t.textureStrip.length}};function Yt(t,e,n){let s=n.get("Sprite",e),i=1,r=0;if(n.has("Motion",e)){let t=n.get("Motion",e);r=t.moving?.2:0,i=t.facing<=0?-1:1}t.scale(i,1),r?(Ut.next(s,r),Ut.draw(t,s)):Ut.draw(t,s,0),t.scale(-i,1)}function Vt(t,e,n){const s=n.get("Renderable",e);t.fillStyle="white";let i=s.width/2,r=s.height/2;t.fillRect(-i,-r,s.width,s.height)}It.require("assets");class Qt extends jt{constructor(t=0,e=0){super();const{assets:n}=It.getWorld();this.add("Transform",{x:t,y:e}),this.add("Renderable",{renderType:"sprite"}),this.add("Sprite",{textureStrip:n.dungeon.getSubTexture("doors_all")}),this.add("Collidable",{masks:{main:{x:t,y:e+4,rx:32,ry:4},activate:{x:t,y:e,rx:16,ry:16}}}),this.add("Solid",{masks:["main"]})}}function Zt(t,e,n,s){const{entityManager:i}=It.getWorld(),r=n/2,o=s/2;return{walls:[new $t(t-r,e-o,t+r,e-o+4),new $t(t-r,e-o,t-r+4,e+o),new $t(t+r-4,e-o,t+r,e+o),new $t(t-r,e+o-4,t-32,e+o),new $t(t+32,e+o-4,t+r,e+o)],door:new Qt(t,e+o)}}document.addEventListener("DOMContentLoaded",(async function(){const t=It.provide(await async function(){const t=document.querySelector("display-port"),e=new _(Rt);document.body.appendChild(e);const n=new Et(t),s=new Y,i=new G,r=new U({componentFactoryMap:Jt});P.defineAssetLoader("atlas",zt);const o=await P.loadAssetMap(qt);return{display:t,input:e,view:n,sceneGraph:s,aabbGraph:i,entityManager:r,assets:o}}()),{entityManager:e,sceneGraph:n,aabbGraph:s,input:i,display:r,view:o,assets:a}=t,h=[new Pt(e,i),new Ot(e,o,4),new Wt(e,s),new Xt(e,n,s,o).registerRenderer("sprite",Yt).registerRenderer("wall",Vt)];Zt(0,0,128,128),new Bt;r.addEventListener("frame",t=>{{const e=t.detail.deltaTime/1e3;i.poll();for(let t of h)"update"in t&&t.update(e)}{const e=t.detail.context;e.clearRect(0,0,r.width,r.height);for(let t of h)"render"in t&&t.render(e)}})}));const Jt={Transform:At,Renderable:Ct,Motion:Tt,PlayerControlled:{},Collidable:St,GameObject:jt,Sprite:Lt,Solid:Ft}}();
