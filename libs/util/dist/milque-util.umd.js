!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).milque=e.milque||{},e.milque.util={}))}(this,(function(e){"use strict";const t={on(e,t,n=t){let r;if(this.__events.has(e)?r=this.__events.get(e):(r=new Map,this.__events.set(e,r)),r.has(n))throw new Error(`Found callback for event '${e}' with the same handle '${n}'.`);return r.set(n,t),this},off(e,t){if(!this.__events.has(e))throw new Error(`Unable to find event '${e}'.`);{const n=this.__events.get(e);if(!n.has(t))throw new Error(`Unable to find callback for event '${e}' with handle '${t}'.`);n.delete(t)}return this},once(e,t,n=t){return this.on(e,((...r)=>{this.off(e,n),t.apply(this.__context||this,r)}),n)},emit(e,...t){if(this.__events.has(e)){let n=[];const r=Array.from(this.__events.get(e).values());for(const e of r){let r=e.apply(this.__context||this,t);r&&n.push(r)}return n}return this.__events.set(e,new Map),[]}};const n={create:function(e){const n=Object.create(t);return n.__events=new Map,n.__context=e,n},assign:function(e,n){const r=Object.assign(e,t);return r.__events=new Map,r.__context=n,r},mixin:function(e,n){const r=e.prototype;return Object.assign(r,t),r.__events=new Map,r.__context=n,r}},r=5,s=4,i=3,o=2,a=1,h=0,c={[r]:l("#7F8C8D"),[s]:l("#2ECC71"),[i]:l("#4794C8"),[o]:l("#F39C12"),[a]:l("#C0392B"),[h]:[""]};function u(e,t){return e-t}function l(e){return[`background: ${e}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}function f(){}function d(e){switch(e){case r:return console.trace;case s:case i:return console.log;case o:return console.warn;case a:return console.error;case h:return f;default:return console.log}}function p(e,t,n,r){if(t&&e.unshift(`[${t}]`),n){let t=(s=n,i=c[r],[`%c${s}`,i.join(";")]);e.unshift(t[0],t[1])}var s,i;return e}const g=Symbol("level"),m=Symbol("domain"),_={};let w=o,b="app";class y{static get TRACE(){return r}static get DEBUG(){return s}static get INFO(){return i}static get WARN(){return o}static get ERROR(){return a}static get OFF(){return h}static getLogger(e){return e in _?_[e]:_[e]=new y(e)}static useDefaultLevel(e){return w=e,this}static useDefaultDomain(e){return b=e,this}constructor(e){this.name=e,this[g]=w,this[m]=b}setLevel(e){return this[g]=e,this}getLevel(){return this[g]}setDomain(e){return this[m]=e,this}getDomain(){return this[m]}log(e,...t){if(u(this[g],e)<0)return this;p(t,this.name,this[m],e),d(e)(...t)}trace(...e){if(u(this[g],r)<0)return this;p(e,this.name,this[m],r),d(r)(...e)}debug(...e){if(u(this[g],s)<0)return this;p(e,this.name,this[m],s),d(s)(...e)}info(...e){if(u(this[g],i)<0)return this;p(e,this.name,this[m],i),d(i)(...e)}warn(...e){if(u(this[g],o)<0)return this;p(e,this.name,this[m],o),d(o)(...e)}error(...e){if(u(this[g],a)<0)return this;p(e,this.name,this[m],a),d(a)(...e)}}const v="png",M="svg";function x(e,t){const n=document.createElement("a"),r=t.indexOf(";");t=t.substring(0,r+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+e+";"+t.substring(r+1),n.setAttribute("href",t),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}const E=["svg","g"];function S(e,t=e.cloneNode(!0)){let n=e.childNodes,r=t.childNodes;for(var s=0;s<r.length;s++){let e=r[s],t=e.tagName;if(-1!=E.indexOf(t))S(n[s],e);else if(n[s]instanceof Element){const t=window.getComputedStyle(n[s]);let r=[];for(let e of Object.keys(t))r.push(`${e}:${t.getPropertyValue(e)};`);e.setAttribute("style",r.join(""))}}return t}class I{constructor(e){this._heap=[],this._comparator=e}get size(){return this._heap.length}clear(){this._heap.length=0}push(...e){for(let t of e)this._heap.push(t),this._shiftUp()}pop(){const e=this.peek();let t=this._heap.length-1;return t>0&&this._swap(0,t),this._heap.pop(),this._shiftDown(),e}replace(e){const t=this.peek();return this._heap[0]=e,this._shiftDown(),t}peek(){return this._heap[0]}at(e){return this._heap[e]}indexOf(e,t){return this._heap.indexOf(e,t)}splice(e,t){return this._heap.splice(e,t)}_compare(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n}_shiftUp(){let e,t=this._heap.length-1;for(;t>0&&this._compare(t,e=(t+1>>>1)-1);)this._swap(t,e),t=e}_shiftDown(){const e=this._heap.length;let t,n=0,r=L(n),s=r<e,i=R(n),o=i<e;for(;s&&this._compare(r,n)||o&&this._compare(i,n);)t=o&&this._compare(i,r)?i:r,this._swap(n,t),n=t,r=L(n),s=r<e,i=R(n),o=i<e}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}}function L(e){return 1+(e<<1)}function R(e){return e+1<<1}function C(e,t,n){return Math.min(n,Math.max(t,e))}function N(e,t,n){let r=n-t,s=(e-t)%r;return s<0&&(s+=r),s+t}const k=Math.PI/180,D=180/Math.PI;function O(e,t,n){if(n.has(t))throw new Error(`Found cyclic dependency for '${t.name||t}'.`);if(!e.visited.has(t)){if(e.visited.add(t),e.edgeMap.has(t)){let r=e.edgeMap.get(t);if(r.size>0){n.add(t);for(let t of r)O(e,t,n);n.delete(t)}}e.dst.push(t)}}function F(e,t,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.NaN,i=null){return e.fscore[t]=n,e.gscore[t]=r,e.hscore[t]=s,e.parents[t]=i,t}e.Eventable=n,e.FILE_TYPE_PNG=v,e.FILE_TYPE_SVG=M,e.Logger=y,e.PriorityQueue=I,e.astarSearch=function(e,t,n,r){let s={fscore:{},gscore:{},hscore:{},parents:{}};F(s,e);let i=new Set,o=new Set;for(i.add(e);i.size>0;){let e;for(let t of i)e?s.fscore[t]<s.fscore[e]&&(e=t):e=t;let a=e;if(a===t){let e=[];for(;s.parents[a];)e.push(a),a=s.parents[a];return e.push(a),e.reverse()}o.add(a),i.delete(a);for(let e of n(a)){if(o.has(e))continue;let n=s.gscore[a]+1,h=!1;i.has(e)?n<s.gscore[e]&&(h=!0):(h=!0,F(s,e),s.hscore[e]=r(e,t),i.add(e)),h&&(s.parents[e]=a,s.gscore[e]=n,s.fscore[e]=n+s.hscore[e])}}return[]},e.bitCount=function(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24},e.bresenhamLine=function(e,t,n,r,s){let i=Math.floor(e),o=Math.floor(t),a=Math.floor(n),h=Math.floor(r),c=Math.abs(n-e),u=e<n?1:-1,l=-Math.abs(r-t),f=t<r?1:-1,d=c+l,p=i,g=o,m=s(p,g);if(void 0!==m)return m;let _=c*c+l*l,w=0;for(;w<_&&(p!==a||g!==h);){++w;let e=2*d;if(e>=l&&(d+=l,p+=u),e<=c&&(d+=c,g+=f),m=s(p,g),void 0!==m)return m}},e.clamp=C,e.cycle=N,e.direction2=function(e,t,n,r){let s=n-e,i=r-t;return Math.atan2(i,s)},e.distance2=function(e,t,n,r){let s=n-e,i=r-t;return Math.sqrt(s*s+i*i)},e.downloadImageFromSVG=function(e,t,n,r,s){const i=function(e){const t=S(e),n=(new XMLSerializer).serializeToString(t),r=new Blob([n],{type:"image/svg+xml"});return r}(n);switch(t){case v:{const n=URL.createObjectURL(i),o=document.createElement("canvas"),a=o.getContext("2d"),h=window.devicePixelRatio||1;o.width=r*h,o.height=s*h,o.style.width=r+"px",o.style.height=s+"px",a.setTransform(h,0,0,h,0,0);const c=new Image;c.onload=()=>{a.drawImage(c,0,0),URL.revokeObjectURL(n);const r=o.toDataURL("image/"+t).replace("image/"+t,"image/octet-stream");x(e,r)},c.src=n}break;case M:{const t=new FileReader;t.onload=()=>{x(e,t.result)},t.readAsDataURL(i)}break;default:throw new Error("Unknown file type '"+t+"'")}},e.downloadText=function(e,t){x(e,"data:text/plain; charset=utf-8,"+encodeURIComponent(t))},e.downloadURL=x,e.fisherYatesShuffle=function(e){for(let t=e.length-1;t>0;--t){let n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},e.lerp=function(e,t,n){return e+(t-e)*n},e.lookAt2=function(e,t,n){return C(e+N(t-e,-Math.PI,Math.PI),e-n,e+n)},e.toDegrees=function(e){return e*D},e.toRadians=function(e){return e*k},e.topoSort=function(e,t){let n=[];for(let r of e){let e=t(r);if(Array.isArray(e))n.push([r,...e]);else if(e)throw new Error("Dependency callback must return an array.")}return function(e,t,n=[]){let r=new Map;for(let e of t)if(e.length>1){let t=e[0],n=e[1];r.has(t)||r.set(t,new Set),r.has(n)||r.set(n,new Set),r.get(t).add(n)}let s={edgeMap:r,index:e.length,visited:new Set,dst:n};for(let t of e)O(s,t,new Set);return n}(function(e){let t=new Set;for(let n of e)for(let e of n)t.add(e);return Array.from(t)}(n),function(e){let t=[];for(let n of e){let e=n[0];for(let r=1;r<n.length;++r){let s=n[r];t.push([e,s])}}return t}(n))},e.uploadFile=async function(e=[],t=!1){return new Promise(((n,r)=>{const s=document.createElement("input");s.addEventListener("change",(e=>{n(t?e.target.files:e.target.files[0])})),s.type="file",s.accept=e.join(","),s.style.display="none",s.toggleAttribute("multiple",t),document.body.appendChild(s),s.click(),document.body.removeChild(s)}))},e.uuid=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},e.withinRadius=function(e,t,n,r,s){const i=e-n,o=t-r;return i*i+o*o<=s*s}}));
//# sourceMappingURL=milque-util.umd.js.map
