{"version":3,"file":"milque-asset.esm.js","sources":["../src/GlobExp.js","../src/AssetStore.js","../src/AssetRef.js","../src/AssetManager.js"],"sourcesContent":["import { makeRe } from 'picomatch';\n\nexport class GlobExp {\n    /**\n     * @param {string|GlobExp} pattern \n     */\n    constructor(pattern) {\n        let source;\n        if (typeof pattern === 'object' && pattern instanceof GlobExp) {\n            source = pattern.source;\n        } else {\n            source = String(pattern);\n        }\n        this.source = source;\n\n        /** @private */\n        this._re = makeRe(source);\n    }\n\n    /**\n     * @param {string} string \n     * @returns {boolean}\n     */\n    test(string) {\n        return this._re.test(string);\n    }\n}\n","import { GlobExp } from './GlobExp.js';\n\n/**\n * @typedef AssetStore\n * @property {Record<string, object>} cache\n * @property {Record<string, Loading>} loadings\n * @property {Array<Fallback>} defaults\n */\n\nconst FILE_URI_PREFIX_PATTERN = /^([_\\w\\d]+)\\:\\/\\//;\nconst DEFAULT_TIMEOUT = 5_000;\n\n/**\n * Load asset using a loader with the given src.\n * - If loading to transform a cached asset, the cached uri must start with `res://` (or equivalent).\n * - If loading to transform cached raw buffers from an asset pack, use `raw://`.\n * - Otherwise, it will call `fetch()` on src.\n * \n * @template T\n * @param {AssetStore} store\n * @param {string} uri \n * @param {string} src\n * @param {(src: string|ArrayBuffer) => Promise<T>} loader\n * @param {number} [timeout]\n * @returns {Promise<T>}\n */\n export async function loadInStore(store, uri, src, loader, timeout = DEFAULT_TIMEOUT) {\n    const { cache: globalCache, loadings } = store;\n    if (uri in globalCache) {\n        return globalCache[uri];\n    }\n\n    let loading;\n    if (uri in loadings) {\n        loading = loadings[uri];\n        if (loading.active) {\n            return loadings[uri].promise;\n        }\n    } else {\n        loading = new Loading(timeout);\n        loadings[uri] = loading;\n    }\n\n    /** @type {Array<Promise<T>>} */\n    let promises = [loading.promise];\n    if (FILE_URI_PREFIX_PATTERN.test(src)) {\n        // Loading from cached file\n        promises.push(getLoadedInStore(store, src, timeout)\n            .then(cached => loader(cached))\n            .then(value => cacheInStore(store, uri, value)));\n    } else {\n        // Fetching from network\n        promises.push(fetch(src)\n            .then(response => response.arrayBuffer())\n            .then(arr => loader(arr))\n            .then(value => cacheInStore(store, uri, value)));\n    }\n    return await Promise.race(promises);\n}\n\n/**\n * @template T\n * @param {AssetStore} store\n * @param {string} uri\n * @param {T} asset\n * @returns {T}\n */\nexport function cacheInStore(store, uri, asset) {\n    const { cache, loadings } = store;\n    cache[uri] = asset;\n    // Send asset to awaiting loaders...\n    if (uri in loadings) {\n        loadings[uri].resolve(asset);\n        delete loadings[uri];\n    }\n    return asset;\n}\n\n/**\n * @template T\n * @param {AssetStore} store\n * @param {string|GlobExp} glob\n * @param {T} asset\n * @returns {T}\n */\nexport function cacheDefaultInStore(store, glob, asset) {\n    const { defaults } = store;\n    if (typeof glob === 'string') {\n        glob = new GlobExp(glob);\n    }\n    const uri = `__default://[${defaults.length}]`;\n    cacheInStore(store, uri, asset);\n    defaults.push(new Fallback(glob, uri));\n    return asset;\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri\n */\nexport function unloadInStore(store, uri) {\n    const { cache, loadings } = store;\n    if (uri in loadings) {\n        loadings[uri].reject(new Error('Stop loading to delete asset.'));\n        delete loadings[uri];\n    }\n    if (uri in cache) {\n        delete cache[uri];\n    }\n}\n\n/**\n * @param {AssetStore} store\n * @param {string|GlobExp} [glob]\n * @param {object} [opts] \n * @param {boolean} [opts.preserveDefault]\n */\nexport function clearInStore(store, glob = undefined, opts = { preserveDefault: false }) {\n    const { preserveDefault } = opts;\n    if (typeof glob === 'string') {\n        glob = new GlobExp(glob);\n    }\n    const { cache, loadings, defaults } = store;\n    // Clear loadings\n    for (let [uri, loading] of Object.entries(loadings)) {\n        if (!glob || glob.test(uri)) {\n            loading.reject(new Error('Stop loading to clear all assets.'));\n            delete loadings[uri];\n        }\n    }\n    // Clear cache\n    for (let uri of Object.keys(cache)) {\n        if (!glob || glob.test(uri)) {\n            delete cache[uri];\n        }\n    }\n    // Clear defaults\n    if (!preserveDefault) {\n        defaults.length = 0;\n    }\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri\n * @param {number} [timeout]\n * @returns {Promise<object>}\n */\nexport async function getLoadedInStore(store, uri, timeout = DEFAULT_TIMEOUT) {\n    const { cache, loadings } = store;\n    if (uri in cache) {\n        return cache[uri];\n    } else if (uri in loadings) {\n        return loadings[uri].promise;\n    } else {\n        let loading = new Loading(timeout);\n        loadings[uri] = loading;\n        return loading.promise;\n    }\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri \n * @returns {object}\n */\nexport function getDefaultInStore(store, uri) {\n    const { defaults } = store;\n    for (let def of defaults) {\n        if (def.glob.test(uri)) {\n            return getCurrentInStore(store, def.uri);\n        }\n    }\n    return null;\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri\n * @returns {object}\n */\nexport function getCurrentInStore(store, uri) {\n    return store.cache[uri];\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri \n * @returns {boolean}\n */\nexport function hasInStore(store, uri) {\n    return Boolean(store.cache[uri]);\n}\n\n/**\n * @param {AssetStore} store\n * @returns {Array<string>}\n */\nexport function keysInStore(store) {\n    return Object.keys(store.cache);\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri \n * @returns {boolean}\n */\nexport function isAssetCachedInStore(store, uri) {\n    return uri in store.cache;\n}\n\n/**\n * @param {AssetStore} store\n * @param {string} uri \n * @returns {boolean}\n */\nexport function isAssetLoadingInStore(store, uri) {\n    return uri in store.loadings;\n}\n\nclass Fallback {\n    /**\n     * @param {GlobExp} glob \n     * @param {string} uri \n     */\n    constructor(glob, uri) {\n        this.glob = glob;\n        this.uri = uri;\n    }\n}\n\nclass Loading {\n    constructor(timeout) {\n        this.active = false;\n\n        /** @private */\n        this._resolve = null;\n        /** @private */\n        this._reject = null;\n        /** @private */\n        this._reason = null;\n        /** @private */\n        this._value = null;\n        /** @private */\n        this._timeoutHandle =\n            Number.isFinite(timeout) && timeout > 0\n                ? setTimeout(() => {\n                    this.reject(`Asset loading exceeded timeout of ${timeout} ms.`);\n                }, timeout)\n                : null;\n        /** @private */\n        this._promise = new Promise((resolve, reject) => {\n            if (this._value) {\n                resolve(this._value);\n            } else {\n                this._resolve = resolve;\n            }\n            if (this._reason) {\n                reject(this._reason);\n            } else {\n                this._reject = reject;\n            }\n        });\n    }\n\n    get promise() {\n        return this._promise;\n    }\n\n    resolve(value) {\n        if (this._timeoutHandle) {\n            clearTimeout(this._timeoutHandle);\n            this._timeoutHandle = null;\n        }\n        if (this._resolve) {\n            this._resolve(value);\n        } else {\n            this._value = value;\n        }\n    }\n\n    reject(reason) {\n        if (this._timeoutHandle) {\n            clearTimeout(this._timeoutHandle);\n            this._timeoutHandle = null;\n        }\n        if (this._reject) {\n            this._reject(reason);\n        } else {\n            this._reason = reason;\n        }\n    }\n}\n","import { cacheInStore, getCurrentInStore, getDefaultInStore, getLoadedInStore, loadInStore, unloadInStore } from './AssetStore.js';\n\n/** @typedef {import('./AssetStore.js').AssetStore} AssetStore */\n\n/**\n * @template T\n */\nexport class AssetRef {\n    /**\n     * @param {string} uri \n     * @param {string} src \n     * @param {(src: Uint8Array) => Promise<T>} loader \n     */\n    constructor(uri, src, loader) {\n        this.uri = uri;\n        /** @protected */\n        this.source = src;\n        /** @protected */\n        this.loader = loader;\n        /** @protected */\n        this.store = null;\n    }\n\n    /** @returns {T} */\n    get current() {\n        return getCurrentInStore(this.store, this.uri);\n    }\n\n    /** @param {T} value */\n    set current(value) {\n        cacheInStore(this.store, this.uri, value);\n    }\n\n    /** @returns {T} */\n    get default() {\n        return getDefaultInStore(this.store, this.uri);\n    }\n\n    /** @returns {Promise<T>} */\n    get loaded() {\n        return getLoadedInStore(this.store, this.uri);\n    }\n\n    /**\n     * @param {AssetStore} store\n     * @param {number} [timeout] The time to wait until error for loader.\n     * @param {T} [cached] If defined, will cache this value instead of fetch and loading from source.\n     * @returns {Promise<AssetRef<T>>}\n     */\n    async preload(store, timeout = undefined, cached = undefined) {\n        this.store = store;\n        if (typeof cached !== 'undefined') {\n            cacheInStore(store, this.uri, cached);\n        } else {\n            await loadInStore(this.store, this.uri, this.source, this.loader, timeout);\n        }\n        return this;\n    }\n\n    /**\n     * @returns {Promise<AssetRef<T>>}\n     */\n    async unload() {\n        unloadInStore(this.store, this.uri);\n        this.store = null;\n        return this;\n    }\n}\n","import { unzip } from 'fflate';\nimport { AssetRef } from './AssetRef.js';\nimport { cacheInStore, keysInStore, getCurrentInStore } from './AssetStore.js';\n\nconst DEFAULT_TIMEOUT = 5_000;\n/** @type {import('./AssetStore.js').AssetStore} */\nconst GLOBAL = {\n    cache: {},\n    loadings: {},\n    defaults: [],\n};\n\n/**\n * Fetch asset pack from url and cache raw file content under `raw://`.\n * \n * @param {string} url\n * @param {(src: Uint8Array, uri: string, path: string) => void} [callback]\n */\nexport async function loadAssetPackAsRaw(url, callback = undefined) {\n    let rootPath = 'raw://';\n    let response = await fetch(url);\n    let arrayBuffer = await response.arrayBuffer();\n    await new Promise((resolve, reject) => {\n        unzip(new Uint8Array(arrayBuffer), (err, data) => {\n            if (err) {\n                reject(err);\n            } else {\n                for (let [path, buf] of Object.entries(data)) {\n                    // Standardize WIN paths\n                    path = path.replaceAll('\\\\', '/');\n                    // Remove the zip directory name\n                    let i = path.indexOf('/');\n                    if (i >= 0) {\n                        path = path.substring(i + 1);\n                    }\n                    // Put the raw file in cache\n                    let uri = rootPath + path;\n                    cacheInStore(GLOBAL, uri, buf);\n                    if (callback) {\n                        callback(buf, uri, path);\n                    }\n                }\n                resolve();\n            }\n        });\n    });\n}\n\n/**\n * Fetch asset pack from url and cache raw file content under `raw://`.\n * \n * @param {string} url\n * @param {(src: Uint8Array, path: string) => void} callback\n */\n export async function loadAssetPack(url, callback) {\n    let response = await fetch(url);\n    let arrayBuffer = await response.arrayBuffer();\n    await new Promise((resolve, reject) => {\n        unzip(new Uint8Array(arrayBuffer), (err, data) => {\n            if (err) {\n                reject(err);\n            } else {\n                for (let [path, buf] of Object.entries(data)) {\n                    // Standardize WIN paths\n                    path = path.replaceAll('\\\\', '/');\n                    callback(buf, path);\n                }\n                resolve();\n            }\n        });\n    });\n}\n\n/**\n * This is the same as calling `await AssetRef.load()` for each ref.\n * \n * @param {Array<AssetRef>} refs \n * @param {number} [timeout] \n */\nexport async function loadAssetRefs(refs, timeout = DEFAULT_TIMEOUT) {\n    let promises = [];\n    for (let ref of refs) {\n        promises.push(ref.preload(GLOBAL, timeout));\n    }\n    await Promise.allSettled(promises);\n}\n\n/**\n * @template T\n * @param {string} uri\n * @param {T} asset\n * @returns {T}\n */\nexport function cache(uri, asset) {\n    return cacheInStore(GLOBAL, uri, asset);\n}\n\n/**\n * @returns {Array<string>}\n */\nexport function keys() {\n    return keysInStore(GLOBAL);\n}\n\n/**\n * @param {string} uri\n * @returns {object}\n */\nexport function current(uri) {\n    return getCurrentInStore(GLOBAL, uri);\n}\n\n/**\n * @param {string} uri\n * @returns {object}\n */\nexport function get(uri) {\n    return current(uri);\n}\n"],"names":["DEFAULT_TIMEOUT"],"mappings":"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"}