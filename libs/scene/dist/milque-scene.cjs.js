"use strict";var e=require("gl-matrix");const t=e.vec3.fromValues(0,1,0);class o{constructor(e,t){this.projectionMatrix=e,this.viewMatrix=t}resize(e,t){return this}}const r=Math.PI/3;const s=Math.PI/180;const i=100;function n(e,t,o){e?(o.nodes[e].children.push(t),o.nodes[t].parent=e):(o.roots.push(t),o.nodes[t].parent=0)}function a(e,t,o){if(e){let r=o.nodes[e].children,s=r.indexOf(t);r.splice(s,1),o.nodes[t].parentNode=0}else{let e=o.roots,r=e.indexOf(t);e.splice(r,1),o.nodes[t].parentNode=0}}function c(e,t,o,r,s){if(o>=i)return;let n=r(t,e);if(!1===n)return;let a=e.nodes[t],h=s?s(a.children,t,e):a.children;for(let t of h)c(e,t,o+1,r,s);"function"==typeof n&&n(t,e)}function h(e,t){delete t.nodes[e]}exports.Camera=o,exports.FirstPersonCameraController=class{constructor(t={locky:!1}){this.locky=t.locky,this.position=e.vec3.create(),this.forward=e.vec3.fromValues(0,0,-1),this.right=e.vec3.fromValues(1,0,0),this.up=e.vec3.fromValues(0,1,0),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.pitch=0,this.yaw=-90}look(e,t,o=1){return o*=1e3,this.pitch=Math.min(89.9,Math.max(-89.9,this.pitch+t*o)),this.yaw=(this.yaw+e*o)%360,this}move(e,t=0,o=0,r=1){return this.forwardAmount+=e*r,this.rightAmount+=t*r,this.upAmount+=o*r,this}apply(t){let{position:o,forward:r,right:i,up:n,forwardAmount:a,rightAmount:c,upAmount:h,pitch:l,yaw:d}=this,u=d*s,p=l*s,m=Math.cos(u),f=Math.cos(p),v=Math.sin(u),N=m*f,g=Math.sin(p),x=v*f;e.vec3.normalize(r,e.vec3.set(r,N,this.locky?0:g,x)),e.vec3.normalize(i,e.vec3.cross(i,r,n));let A=e.vec3.create();e.vec3.scale(A,r,a),e.vec3.add(o,o,A),e.vec3.scale(A,i,c),e.vec3.add(o,o,A),e.vec3.scale(A,n,h),e.vec3.add(o,o,A),this.forwardAmount=0,this.rightAmount=0,this.upAmount=0,this.locky&&e.vec3.set(r,N,g,x);let w=e.vec3.add(A,o,r);return e.mat4.lookAt(t,o,w,n),t}},exports.OrthographicCamera=class extends o{constructor(t,o,r,s,i=-1e3,n=1e3){super(e.mat4.create(),e.mat4.create()),this.orthoBounds={left:void 0===t?void 0:Number(t),top:void 0===o?void 0:Number(o),right:void 0===r?void 0:Number(r),bottom:void 0===s?void 0:Number(s)},this.clippingPlane={near:Number(i),far:Number(n)}}resize(t,o){const{near:r,far:s}=this.clippingPlane,{left:i,top:n,right:a,bottom:c}=this.orthoBounds;let h=this.projectionMatrix,l=void 0!==i;if(void 0!==t)if(l){const l=t/o;e.mat4.ortho(h,i*l,a*l,c,n,r,s)}else e.mat4.ortho(h,0,t,o,0,r,s);else l?e.mat4.ortho(h,i,a,c,n,r,s):e.mat4.ortho(h,-1,1,1,-1,-1,1);return this}},exports.PerspectiveCamera=class extends o{constructor(t=r,o=.1,s=1e3){super(e.mat4.create(),e.mat4.create()),this.fieldOfView=Number(t),this.clippingPlane={near:Number(o),far:Number(s)}}resize(t,o){const r=void 0===t?1:t/o,{near:s,far:i}=this.clippingPlane;return e.mat4.perspective(this.projectionMatrix,this.fieldOfView,r,s,i),this}},exports.SceneGraph=class{constructor(){this.nodes={},this.roots=[],this._nextAvailableSceneNodeId=1}createSceneNode(e){let t=this._nextAvailableSceneNodeId++,o={parent:0,children:[]};return this.nodes[t]=o,n(e,t,this),t}createSceneNodes(e,t){let o=[];for(let r=0;r<e;++r)o.push(this.createSceneNode(t));return o}deleteSceneNode(e){if(!(e in this.nodes))throw new Error("Cannot delete non-existant scene node for scene graph.");a(this.nodes[e].parent,e,this),c(this,e,0,h)}deleteSceneNodes(e){for(let t of e)this.deleteSceneNode(t)}getSceneNodeInfo(e){return this.nodes[e]}parentSceneNode(e,t){a(this.nodes[e].parent,e,this),n(t,e,this)}replaceSceneNode(e,t){let o=this.nodes[e],r=o.parent,s=o.children.slice();if(a(r,e,this),o.children.length=0,t){let e=this.nodes[t];a(e.parent,t,this),e.children.push(...s),n(r,t,this)}else if(r){this.nodes[r].children.push(...s)}else this.roots.push(...s);for(let e of s)this.nodes[e].parent=r}walk(e,t={}){const{from:o,childFilter:r}=t;let s;s=o?Array.isArray(o)?o:[o]:this.roots,r&&(s=r(s,0,this));for(let t of s)c(this,t,0,e,r)}},exports.lookAt=function(o,r,s,i=0,n=1){let a=e.vec3.create(),c=e.quat.create();e.mat4.getTranslation(a,o),e.mat4.getRotation(c,o);let h=e.vec3.fromValues(r,s,i);e.mat4.lookAt(o,a,h,t);let l=e.quat.create();e.mat4.getRotation(l,o),e.quat.slerp(c,c,l,n),e.mat4.fromRotationTranslation(o,c,a)},exports.panTo=function(t,o,r,s=0,i=1){let n=e.vec3.create();e.mat4.getTranslation(n,t);let a=e.vec3.fromValues((o-n[0])*i,(r-n[1])*i,(s-n[2])*i);e.mat4.translate(t,t,a)},exports.screenToWorldRay=function(t,o,r,s,i,n=!1){let a=e.vec4.fromValues(o,r,-1,1),c=e.mat4.create();return e.mat4.invert(c,s),e.vec4.transformMat4(a,a,c),a[2]=-1,a[3]=0,e.mat4.invert(c,i),e.vec4.transformMat4(a,a,c),t[0]=a[0],t[1]=a[1],t[2]=a[2],n&&e.vec3.normalize(t,t),t};
//# sourceMappingURL=milque-scene.cjs.js.map
