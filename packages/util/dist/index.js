!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).milque=t.milque||{},t.milque.util={}))}(this,(function(t){"use strict";const e={on(t,e,n=e){let r;if(this.__events.has(t)?r=this.__events.get(t):(r=new Map,this.__events.set(t,r)),r.has(n))throw new Error(`Found callback for event '${t}' with the same handle '${n}'.`);return r.set(n,e),this},off(t,e){if(!this.__events.has(t))throw new Error(`Unable to find event '${t}'.`);{const n=this.__events.get(t);if(!n.has(e))throw new Error(`Unable to find callback for event '${t}' with handle '${e}'.`);n.delete(e)}return this},once(t,e,n=e){return this.on(t,((...r)=>{this.off(t,n),e.apply(this.__context||this,r)}),n)},emit(t,...e){if(this.__events.has(t)){let n=[];const r=Array.from(this.__events.get(t).values());for(const t of r){let r=t.apply(this.__context||this,e);r&&n.push(r)}return n}return this.__events.set(t,new Map),[]}};const n={create:function(t){const n=Object.create(e);return n.__events=new Map,n.__context=t,n},assign:function(t,n){const r=Object.assign(t,e);return r.__events=new Map,r.__context=n,r},mixin:function(t,n){const r=t.prototype;return Object.assign(r,e),r.__events=new Map,r.__context=n,r}},r={5:s("#7F8C8D"),4:s("#2ECC71"),3:s("#4794C8"),2:s("#F39C12"),1:s("#C0392B"),0:[""]};function i(t,e){return t-e}function s(t){return[`background: ${t}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}function o(){}function a(t){switch(t){case 5:return console.trace;case 4:case 3:return console.log;case 2:return console.warn;case 1:return console.error;case 0:return o;default:return console.log}}function h(t,e,n,i){if(e&&t.unshift(`[${e}]`),n){let e=[`%c${n}`,r[i].join(";")];t.unshift(e[0],e[1])}return t}const u=Symbol("level"),l=Symbol("domain"),c={};let f=2,d="app";class p{static get TRACE(){return 5}static get DEBUG(){return 4}static get INFO(){return 3}static get WARN(){return 2}static get ERROR(){return 1}static get OFF(){return 0}static getLogger(t){return t in c?c[t]:c[t]=new p(t)}static useDefaultLevel(t){return f=t,this}static useDefaultDomain(t){return d=t,this}constructor(t){this.name=t,this[u]=f,this[l]=d}setLevel(t){return this[u]=t,this}getLevel(){return this[u]}setDomain(t){return this[l]=t,this}getDomain(){return this[l]}log(t,...e){if(i(this[u],t)<0)return this;h(e,this.name,this[l],t),a(t)(...e)}trace(...t){if(i(this[u],5)<0)return this;h(t,this.name,this[l],5),a(5)(...t)}debug(...t){if(i(this[u],4)<0)return this;h(t,this.name,this[l],4),a(4)(...t)}info(...t){if(i(this[u],3)<0)return this;h(t,this.name,this[l],3),a(3)(...t)}warn(...t){if(i(this[u],2)<0)return this;h(t,this.name,this[l],2),a(2)(...t)}error(...t){if(i(this[u],1)<0)return this;h(t,this.name,this[l],1),a(1)(...t)}}function g(t,e){const n=document.createElement("a"),r=e.indexOf(";");e=e.substring(0,r+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+t+";"+e.substring(r+1),n.setAttribute("href",e),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}const m=["svg","g"];function _(t,e=t.cloneNode(!0)){let n=t.childNodes,r=e.childNodes;for(var i=0;i<r.length;i++){let t=r[i],e=t.tagName;if(-1!=m.indexOf(e))_(n[i],t);else if(n[i]instanceof Element){const e=window.getComputedStyle(n[i]);let r=[];for(let t of Object.keys(e))r.push(`${t}:${e.getPropertyValue(t)};`);t.setAttribute("style",r.join(""))}}return e}class w{constructor(t){this._heap=[],this._comparator=t}get size(){return this._heap.length}clear(){this._heap.length=0}push(...t){for(const e of t)this._heap.push(e),this._shiftUp()}pop(){const t=this.peek();let e=this._heap.length-1;return e>0&&this._swap(0,e),this._heap.pop(),this._shiftDown(),t}replace(t){const e=this.peek();return this._heap[0]=t,this._shiftDown(),e}peek(){return this._heap[0]}_compare(t,e){return this._comparator(this._heap[t],this._heap[e])}_swap(t,e){let n=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=n}_shiftUp(){let t,e=this._heap.length-1;for(;e>0&&this._compare(e,t=(e+1>>>1)-1);)this._swap(e,t),e=t}_shiftDown(){const t=this._heap.length;let e,n=0,r=y(n),i=r<t,s=b(n),o=s<t;for(;i&&this._compare(r,n)||o&&this._compare(s,n);)e=o&&this._compare(s,r)?s:r,this._swap(n,e),n=e,r=y(n),i=r<t,s=b(n),o=s<t}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}}function y(t){return 1+(t<<1)}function b(t){return t+1<<1}function v(t,e,n){return Math.min(n,Math.max(e,t))}function x(t,e,n){let r=n-e,i=(t-e)%r;return i<0&&(i+=r),i+e}const M=Math.PI/180,E=180/Math.PI;function L(t,e,n){if(n.has(e))throw new Error(`Found cyclic dependency for '${e.name||e}'.`);if(!t.visited.has(e)){if(t.visited.add(e),t.edgeMap.has(e)){let r=t.edgeMap.get(e);if(r.size>0){n.add(e);for(let e of r)L(t,e,n);n.delete(e)}}t.dst.push(e)}}function R(t,e,n){let r=`${e},${n}`;if(r in t)return t[r];{let i=N(e,n);return t[r]=i,i}}function S(t,e,n){return[R(t,e-1,n-1),R(t,e-1,n+0),R(t,e-1,n+1),R(t,e+0,n+1),R(t,e+1,n+1),R(t,e+1,n+0),R(t,e+1,n-1),R(t,e+0,n-1)]}function N(t,e){return{id:`${t},${e}`,x:t,y:e,f:Number.NaN,g:Number.NaN,h:Number.NaN,parent:null}}t.Eventable=n,t.FILE_TYPE_PNG="png",t.FILE_TYPE_SVG="svg",t.Logger=p,t.PriorityQueue=w,t.astarSearch=function(t,e,n,r,i){let s=N(t,e),o={[s.id]:s},a=[],h=[];for(a.push(s.id);a.length>0;){let t=0,e=a[t],s=o[e];for(let n=1;n<a.length;++n){let r=a[n],i=o[r];i.f<s.f&&(t=n,e=r,s=i)}let u=a[t],l=o[u];if(l.x===n&&l.y===r){let t=[];for(;l.parent;)t.push([l.x,l.y]),l=l.parent;return t.push([l.x,l.y]),t.reverse()}{h.push(u);let t=a.indexOf(u);a.splice(t,1);let e=S(o,l.x,l.y);for(let t of e){if(h.indexOf(t.id)>=0||!i(l.x,l.y,t.x,t.y))continue;let e=l.g+1,s=!1;-1===a.indexOf(t.id)?(s=!0,t.h=Math.abs(n-t.x)+Math.abs(r-t.y),a.push(t.id)):e<t.g&&(s=!0),s&&(t.parent=l,t.g=e,t.f=e+t.h)}}}return[]},t.bresenhamLine=function(t,e,n,r,i){let s=Math.floor(t),o=Math.floor(e),a=Math.floor(n),h=Math.floor(r),u=Math.abs(n-t),l=t<n?1:-1,c=-Math.abs(r-e),f=e<r?1:-1,d=u+c,p=s,g=o,m=i(p,g);if(void 0!==m)return m;let _=u*u+c*c,w=0;for(;w<_&&(p!==a||g!==h);){++w;let t=2*d;if(t>=c&&(d+=c,p+=l),t<=u&&(d+=u,g+=f),m=i(p,g),void 0!==m)return m}},t.clamp=v,t.cycle=x,t.direction2=function(t,e,n,r){let i=n-t,s=r-e;return Math.atan2(s,i)},t.distance2=function(t,e,n,r){let i=n-t,s=r-e;return Math.sqrt(i*i+s*s)},t.downloadImageFromSVG=function(t,e,n,r,i){const s=function(t){const e=_(t),n=(new XMLSerializer).serializeToString(e);return new Blob([n],{type:"image/svg+xml"})}(n);switch(e){case"png":{const n=URL.createObjectURL(s),o=document.createElement("canvas"),a=o.getContext("2d"),h=window.devicePixelRatio||1;o.width=r*h,o.height=i*h,o.style.width=r+"px",o.style.height=i+"px",a.setTransform(h,0,0,h,0,0);const u=new Image;u.onload=()=>{a.drawImage(u,0,0),URL.revokeObjectURL(n);const r=o.toDataURL("image/"+e).replace("image/"+e,"image/octet-stream");g(t,r)},u.src=n}break;case"svg":{const e=new FileReader;e.onload=()=>{g(t,e.result)},e.readAsDataURL(s)}break;default:throw new Error("Unknown file type '"+e+"'")}},t.downloadText=function(t,e){g(t,"data:text/plain; charset=utf-8,"+encodeURIComponent(e))},t.downloadURL=g,t.lerp=function(t,e,n){return t+(e-t)*n},t.lookAt2=function(t,e,n){return v(t+x(e-t,-Math.PI,Math.PI),t-n,t+n)},t.toDegrees=function(t){return t*E},t.toRadians=function(t){return t*M},t.topoSort=function(t,e){let n=[];for(let r of t){let t=e(r);if(Array.isArray(t))n.push([r,...t]);else if(t)throw new Error("Dependency callback must return an array.")}return function(t,e,n=[]){let r=new Map;for(let t of e)if(t.length>1){let e=t[0],n=t[1];r.has(e)||r.set(e,new Set),r.has(n)||r.set(n,new Set),r.get(e).add(n)}let i={edgeMap:r,index:t.length,visited:new Set,dst:n};for(let e of t)L(i,e,new Set);return n}(function(t){let e=new Set;for(let n of t)for(let t of n)e.add(t);return Array.from(e)}(n),function(t){let e=[];for(let n of t){let t=n[0];for(let r=1;r<n.length;++r){let i=n[r];e.push([t,i])}}return e}(n))},t.uploadFile=async function(t=[],e=!1){return new Promise(((n,r)=>{const i=document.createElement("input");i.addEventListener("change",(t=>{n(e?t.target.files:t.target.files[0])})),i.type="file",i.accept=t.join(","),i.style.display="none",i.toggleAttribute("multiple",e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}))},t.uuid=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)},t.withinRadius=function(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o<=i*i},Object.defineProperty(t,"__esModule",{value:!0})}));
