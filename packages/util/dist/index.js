!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).milque=e.milque||{},e.milque.util={}))}(this,(function(e){"use strict";const t={on(e,t,n=t){let r;if(this.__events.has(e)?r=this.__events.get(e):(r=new Map,this.__events.set(e,r)),r.has(n))throw new Error(`Found callback for event '${e}' with the same handle '${n}'.`);return r.set(n,t),this},off(e,t){if(!this.__events.has(e))throw new Error(`Unable to find event '${e}'.`);{const n=this.__events.get(e);if(!n.has(t))throw new Error(`Unable to find callback for event '${e}' with handle '${t}'.`);n.delete(t)}return this},once(e,t,n=t){return this.on(e,((...r)=>{this.off(e,n),t.apply(this.__context||this,r)}),n)},emit(e,...t){if(this.__events.has(e)){let n=[];const r=Array.from(this.__events.get(e).values());for(const e of r){let r=e.apply(this.__context||this,t);r&&n.push(r)}return n}return this.__events.set(e,new Map),[]}};const n={create:function(e){const n=Object.create(t);return n.__events=new Map,n.__context=e,n},assign:function(e,n){const r=Object.assign(e,t);return r.__events=new Map,r.__context=n,r},mixin:function(e,n){const r=e.prototype;return Object.assign(r,t),r.__events=new Map,r.__context=n,r}},r={5:s("#7F8C8D"),4:s("#2ECC71"),3:s("#4794C8"),2:s("#F39C12"),1:s("#C0392B"),0:[""]};function o(e,t){return e-t}function s(e){return[`background: ${e}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"]}function i(){}function a(e){switch(e){case 5:return console.trace;case 4:case 3:return console.log;case 2:return console.warn;case 1:return console.error;case 0:return i;default:return console.log}}function h(e,t,n,o){if(t&&e.unshift(`[${t}]`),n){let t=[`%c${n}`,r[o].join(";")];e.unshift(t[0],t[1])}return e}const c=Symbol("level"),u=Symbol("domain"),l={};let f=2,d="app";class p{static get TRACE(){return 5}static get DEBUG(){return 4}static get INFO(){return 3}static get WARN(){return 2}static get ERROR(){return 1}static get OFF(){return 0}static getLogger(e){return e in l?l[e]:l[e]=new p(e)}static useDefaultLevel(e){return f=e,this}static useDefaultDomain(e){return d=e,this}constructor(e){this.name=e,this[c]=f,this[u]=d}setLevel(e){return this[c]=e,this}getLevel(){return this[c]}setDomain(e){return this[u]=e,this}getDomain(){return this[u]}log(e,...t){if(o(this[c],e)<0)return this;h(t,this.name,this[u],e),a(e)(...t)}trace(...e){if(o(this[c],5)<0)return this;h(e,this.name,this[u],5),a(5)(...e)}debug(...e){if(o(this[c],4)<0)return this;h(e,this.name,this[u],4),a(4)(...e)}info(...e){if(o(this[c],3)<0)return this;h(e,this.name,this[u],3),a(3)(...e)}warn(...e){if(o(this[c],2)<0)return this;h(e,this.name,this[u],2),a(2)(...e)}error(...e){if(o(this[c],1)<0)return this;h(e,this.name,this[u],1),a(1)(...e)}}function g(e,t){const n=document.createElement("a"),r=t.indexOf(";");t=t.substring(0,r+1)+"headers=Content-Disposition%3A%20attachment%3B%20filename="+e+";"+t.substring(r+1),n.setAttribute("href",t),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}const m=["svg","g"];function _(e,t=e.cloneNode(!0)){let n=e.childNodes,r=t.childNodes;for(var o=0;o<r.length;o++){let e=r[o],t=e.tagName;if(-1!=m.indexOf(t))_(n[o],e);else if(n[o]instanceof Element){const t=window.getComputedStyle(n[o]);let r=[];for(let e of Object.keys(t))r.push(`${e}:${t.getPropertyValue(e)};`);e.setAttribute("style",r.join(""))}}return t}class w{constructor(e){this._heap=[],this._comparator=e}get size(){return this._heap.length}clear(){this._heap.length=0}push(...e){for(const t of e)this._heap.push(t),this._shiftUp()}pop(){const e=this.peek();let t=this._heap.length-1;return t>0&&this._swap(0,t),this._heap.pop(),this._shiftDown(),e}replace(e){const t=this.peek();return this._heap[0]=e,this._shiftDown(),t}peek(){return this._heap[0]}_compare(e,t){return this._comparator(this._heap[e],this._heap[t])}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n}_shiftUp(){let e,t=this._heap.length-1;for(;t>0&&this._compare(t,e=(t+1>>>1)-1);)this._swap(t,e),t=e}_shiftDown(){const e=this._heap.length;let t,n=0,r=b(n),o=r<e,s=y(n),i=s<e;for(;o&&this._compare(r,n)||i&&this._compare(s,n);)t=i&&this._compare(s,r)?s:r,this._swap(n,t),n=t,r=b(n),o=r<e,s=y(n),i=s<e}values(){return this._heap}[Symbol.iterator](){return this._heap[Symbol.iterator]()}}function b(e){return 1+(e<<1)}function y(e){return e+1<<1}function v(e,t,n){return Math.min(n,Math.max(t,e))}function M(e,t,n){let r=n-t,o=(e-t)%r;return o<0&&(o+=r),o+t}const E=Math.PI/180,S=180/Math.PI;function x(e,t,n){if(n.has(t))throw new Error(`Found cyclic dependency for '${t.name||t}'.`);if(!e.visited.has(t)){if(e.visited.add(t),e.edgeMap.has(t)){let r=e.edgeMap.get(t);if(r.size>0){n.add(t);for(let t of r)x(e,t,n);n.delete(t)}}e.dst.push(t)}}function I(e,t,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NaN,s=null){return e.fscore[t]=n,e.gscore[t]=r,e.hscore[t]=o,e.parents[t]=s,t}e.Eventable=n,e.FILE_TYPE_PNG="png",e.FILE_TYPE_SVG="svg",e.Logger=p,e.PriorityQueue=w,e.astarSearch=function(e,t,n,r){let o={fscore:{},gscore:{},hscore:{},parents:{}};I(o,e);let s=new Set,i=new Set;for(s.add(e);s.size>0;){let e;for(let t of s)e?o.fscore[t]<o.fscore[e]&&(e=t):e=t;let a=e;if(a===t){let e=[];for(;o.parents[a];)e.push(a),a=o.parents[a];return e.push(a),e.reverse()}i.add(a),s.delete(a);for(let e of n(a)){if(i.has(e))continue;let n=o.gscore[a]+1,h=!1;s.has(e)?n<o.gscore[e]&&(h=!0):(h=!0,I(o,e),o.hscore[e]=r(e,t),s.add(e)),h&&(o.parents[e]=a,o.gscore[e]=n,o.fscore[e]=n+o.hscore[e])}}return[]},e.bitCount=function(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24},e.bresenhamLine=function(e,t,n,r,o){let s=Math.floor(e),i=Math.floor(t),a=Math.floor(n),h=Math.floor(r),c=Math.abs(n-e),u=e<n?1:-1,l=-Math.abs(r-t),f=t<r?1:-1,d=c+l,p=s,g=i,m=o(p,g);if(void 0!==m)return m;let _=c*c+l*l,w=0;for(;w<_&&(p!==a||g!==h);){++w;let e=2*d;if(e>=l&&(d+=l,p+=u),e<=c&&(d+=c,g+=f),m=o(p,g),void 0!==m)return m}},e.clamp=v,e.cycle=M,e.direction2=function(e,t,n,r){let o=n-e,s=r-t;return Math.atan2(s,o)},e.distance2=function(e,t,n,r){let o=n-e,s=r-t;return Math.sqrt(o*o+s*s)},e.downloadImageFromSVG=function(e,t,n,r,o){const s=function(e){const t=_(e),n=(new XMLSerializer).serializeToString(t);return new Blob([n],{type:"image/svg+xml"})}(n);switch(t){case"png":{const n=URL.createObjectURL(s),i=document.createElement("canvas"),a=i.getContext("2d"),h=window.devicePixelRatio||1;i.width=r*h,i.height=o*h,i.style.width=r+"px",i.style.height=o+"px",a.setTransform(h,0,0,h,0,0);const c=new Image;c.onload=()=>{a.drawImage(c,0,0),URL.revokeObjectURL(n);const r=i.toDataURL("image/"+t).replace("image/"+t,"image/octet-stream");g(e,r)},c.src=n}break;case"svg":{const t=new FileReader;t.onload=()=>{g(e,t.result)},t.readAsDataURL(s)}break;default:throw new Error("Unknown file type '"+t+"'")}},e.downloadText=function(e,t){g(e,"data:text/plain; charset=utf-8,"+encodeURIComponent(t))},e.downloadURL=g,e.fisherYatesShuffle=function(e){for(let t=e.length-1;t>0;--t){let n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},e.lerp=function(e,t,n){return e+(t-e)*n},e.lookAt2=function(e,t,n){return v(e+M(t-e,-Math.PI,Math.PI),e-n,e+n)},e.toDegrees=function(e){return e*S},e.toRadians=function(e){return e*E},e.topoSort=function(e,t){let n=[];for(let r of e){let e=t(r);if(Array.isArray(e))n.push([r,...e]);else if(e)throw new Error("Dependency callback must return an array.")}return function(e,t,n=[]){let r=new Map;for(let e of t)if(e.length>1){let t=e[0],n=e[1];r.has(t)||r.set(t,new Set),r.has(n)||r.set(n,new Set),r.get(t).add(n)}let o={edgeMap:r,index:e.length,visited:new Set,dst:n};for(let t of e)x(o,t,new Set);return n}(function(e){let t=new Set;for(let n of e)for(let e of n)t.add(e);return Array.from(t)}(n),function(e){let t=[];for(let n of e){let e=n[0];for(let r=1;r<n.length;++r){let o=n[r];t.push([e,o])}}return t}(n))},e.uploadFile=async function(e=[],t=!1){return new Promise(((n,r)=>{const o=document.createElement("input");o.addEventListener("change",(e=>{n(t?e.target.files:e.target.files[0])})),o.type="file",o.accept=e.join(","),o.style.display="none",o.toggleAttribute("multiple",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)}))},e.uuid=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},e.withinRadius=function(e,t,n,r,o){const s=e-n,i=t-r;return s*s+i*i<=o*o},Object.defineProperty(e,"__esModule",{value:!0})}));
