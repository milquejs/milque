!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).milque=t.milque||{},t.milque.input={}))}(this,(function(t){"use strict";class e{get polling(){return performance.now()-this._lastPollingTime<1e3}get value(){return 0}get size(){return this._size}constructor(t){this._size=t,this._lastPollingTime=Number.MIN_SAFE_INTEGER}resize(t){this._size=t}getState(t){throw new Error("Missing implementation.")}onUpdate(t,e,n){throw new Error("Missing implementation.")}onStatus(t,e){throw new Error("Missing implementation.")}onPoll(t){this._lastPollingTime=t}onBind(t,e={}){t>=this._size&&this.resize(t+1)}onUnbind(){this.resize(0)}}class n extends e{static createAxisBindingState(){return{value:0,delta:0,inverted:!1}}get delta(){return this._delta}get value(){return this._value}constructor(t=0){super(t);let e=new Array;for(let n=0;n<t;++n)e.push(this.constructor.createAxisBindingState());this._state=e,this._value=0,this._delta=0}resize(t){let e,n=this._state,i=n.length;if(t<=i)e=n.slice(0,t);else{e=n;for(let n=i;n<t;++n)e.push(this.constructor.createAxisBindingState())}this._state=e,super.resize(t)}getState(t){return this._state[t].value}onPoll(t){let e=this._state,n=0,i=0;const s=e.length;for(let t=0;t<s;++t){let s=e[t];n+=s.value*(s.inverted?-1:1),i+=s.delta,e[t].delta=0}this._value=n,this._delta=i,super.onPoll(t)}onUpdate(t,e,n){void 0===e?this.onAxisChange(t,n):this.onAxisMove(t,e,n)}onStatus(t,e){this.onAxisStatus(t,e)}onBind(t,e={}){super.onBind(t,e);const{inverted:n=!1}=e;this._state[t].inverted=n}onAxisMove(t,e,n){let i=this._state[t];i.value=e,i.delta+=n}onAxisChange(t,e){let n=this._state[t];n.value+=e,n.delta+=e}onAxisStatus(t,e){let n=this._state[t],i=n.value;n.value=e,n.delta=e-i}}class i extends e{get pressed(){return this._pressed}get repeated(){return this._repeated}get released(){return this._released}get down(){return this._down}get value(){return this._value}constructor(t=0){super(t),this._state=new Uint8Array(t),this._value=0,this._down=!1,this._pressed=!1,this._repeated=!1,this._released=!1}resize(t){let e,n=this._state;t<=n.length?e=n.slice(0,t):(e=new Uint8Array(t),e.set(n)),this._state=e,super.resize(t)}getState(t){let e=this._state[t];return(1&e?1:0)*(16&e?-1:1)}onPoll(t){let e=this._state,n=0,i=0,s=0,o=0,a=0;const r=e.length;for(let t=0;t<r;++t){let r=e[t],l=1&r;i|=l,s|=2&r,o|=4&r,a|=8&r,n+=(l?1:0)*(16&r?-1:1),e[t]&=241}this._value=n,this._down=0!==i,this._pressed=0!==s,this._repeated=0!==o,this._released=0!==a,super.onPoll(t)}onUpdate(t,e,n){n>0?this.onButtonPressed(t):this.onButtonReleased(t)}onStatus(t,e){this.onButtonStatus(t,0!==e)}onBind(t,e={}){super.onBind(t,e);const{inverted:n=!1}=e;let i=this._state;n?i[t]|=16:i[t]&=239}onButtonPressed(t){let e=this._state,n=e[t];1&n||(n|=2,n|=1),n|=4,e[t]=n}onButtonReleased(t){let e=this._state,n=e[t];1&n&&(n|=8,n&=254),e[t]=n}onButtonStatus(t,e){let n=this._state,i=n[t],s=Boolean(1&i);e?i|=1:i&=254,s&&!e&&(i|=8),!s&&e&&(i|=2,i|=4),n[t]=i}}class s{static isAxis(t){return!1}static isButton(t){return!1}constructor(t,e){if(!e)throw new Error(`Missing event target for device ${t}.`);this.name=t,this.eventTarget=e,this.listeners={input:[]}}setEventTarget(t){if(!t)throw new Error(`Missing event target for device ${this.name}.`);this.eventTarget=t}destroy(){let t=this.listeners;for(let e in t)t[e].length=0}addEventListener(t,e){let n=this.listeners;t in n?n[t].push(e):n[t]=[e]}removeEventListener(t,e){let n=this.listeners;if(t in n){let i=n[t],s=i.indexOf(e);s>=0&&i.splice(s,1)}}dispatchInputEvent(t){let e=0;for(let n of this.listeners.input)e|=n(t);return Boolean(e)}}class o extends s{static isAxis(t){return!1}static isButton(t){return!0}constructor(t,e,n={}){super(t,e);const{ignoreRepeat:i=!0}=n;this.ignoreRepeat=i,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("keyup",this.onKeyUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("keyup",this.onKeyUp)}destroy(){let t=this.eventTarget;t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("keyup",this.onKeyUp),super.destroy()}onKeyDown(t){if(t.repeat&&this.ignoreRepeat)return t.preventDefault(),t.stopPropagation(),!1;let e=this._eventObject;return e.code=t.code,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onKeyUp(t){let e=this._eventObject;if(e.code=t.code,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e))return t.preventDefault(),t.stopPropagation(),!1}}class a extends s{static isAxis(t){return"PosX"===t||"PosY"===t||"WheelX"===t||"WheelY"===t||"WheelZ"===t}static isButton(t){return!this.isAxis(t)}constructor(t,e,n={}){super(t,e);const{eventsOnFocus:i=!0}=n;this.eventsOnFocus=i,this.canvasTarget=this.getCanvasFromEventTarget(e),this._downHasFocus=!1,this._eventObject={target:e,device:t,code:"",event:"",value:0,control:!1,shift:!1,alt:!1},this._positionObject={target:e,device:t,code:"",event:"move",value:0,movement:0},this._wheelObject={target:e,device:t,code:"",event:"wheel",movement:0},this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}setEventTarget(t){this.eventTarget&&this.destroy(),super.setEventTarget(t),this.canvasTarget=this.getCanvasFromEventTarget(t),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("wheel",this.onWheel),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){let t=this.eventTarget;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("wheel",this.onWheel),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),super.destroy()}setPointerLock(t=!0){t?this.eventTarget.requestPointerLock():this.eventTarget.exitPointerLock()}hasPointerLock(){return document.pointerLockElement===this.eventTarget}onMouseDown(t){this._downHasFocus=!0;let e=this._eventObject;if(e.code="Button"+t.button,e.event="pressed",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)&&document.activeElement===this.eventTarget)return t.preventDefault(),t.stopPropagation(),!1}onContextMenu(t){return t.preventDefault(),t.stopPropagation(),!1}onWheel(t){let e,n,i;switch(t.deltaMode){case WheelEvent.DOM_DELTA_LINE:e=10*t.deltaX,n=10*t.deltaY,i=10*t.deltaZ;break;case WheelEvent.DOM_DELTA_PAGE:e=100*t.deltaX,n=100*t.deltaY,i=100*t.deltaZ;break;case WheelEvent.DOM_DELTA_PIXEL:default:e=t.deltaX,n=t.deltaY,i=t.deltaZ}let s=0,o=this._wheelObject;if(o.code="WheelX",o.movement=e,s|=this.dispatchInputEvent(o),o.code="WheelY",o.movement=n,s|=this.dispatchInputEvent(o),o.code="WheelZ",o.movement=i,s|=this.dispatchInputEvent(o),s)return t.preventDefault(),t.stopPropagation(),!1}onMouseUp(t){if(!this._downHasFocus)return;this._downHasFocus=!1;let e=this._eventObject;return e.code="Button"+t.button,e.event="released",e.value=1,e.control=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey,this.dispatchInputEvent(e)?(t.preventDefault(),t.stopPropagation(),!1):void 0}onMouseMove(t){if(this.eventsOnFocus&&document.activeElement!==this.eventTarget)return;const e=this.canvasTarget,{clientWidth:n,clientHeight:i}=e,s=e.getBoundingClientRect();let o=t.movementX/n,a=t.movementY/i,r=(t.clientX-s.left)/n,l=(t.clientY-s.top)/i,h=this._positionObject;h.code="PosX",h.value=r,h.movement=o,this.dispatchInputEvent(h),h.code="PosY",h.value=l,h.movement=a,this.dispatchInputEvent(h)}getCanvasFromEventTarget(t){return t instanceof HTMLCanvasElement?t:t.canvas||t.querySelector("canvas")||t.shadowRoot&&t.shadowRoot.querySelector("canvas")||t}}class r extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<kbd>\n    <span id="name"><slot></slot></span>\n    <span id="value" class="hidden"></span>\n</kbd>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML='kbd {\n    position: relative;\n    display: inline-block;\n    border-radius: 3px;\n    border: 1px solid #888888;\n    font-size: 0.85em;\n    font-weight: 700;\n    text-rendering: optimizeLegibility;\n    line-height: 12px;\n    height: 14px;\n    padding: 2px 4px;\n    color: #444444;\n    background-color: #eeeeee;\n    box-shadow: inset 0 -3px 0 #aaaaaa;\n    overflow: hidden;\n}\n\nkbd:empty::after {\n    content: "<?>";\n    opacity: 0.6;\n}\n\n.disabled {\n    opacity: 0.6;\n    box-shadow: none;\n    background-color: #aaaaaa;\n}\n\n.hidden {\n    display: none;\n}\n\n#value {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    font-size: 0.85em;\n    padding: 0 4px;\n    padding-top: 2px;\n    color: #cccccc;\n    background-color: #333333;\n    box-shadow: inset 0 3px 0 #222222;\n}\n',Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-code",this)}static get observedAttributes(){return["name","value","disabled"]}get disabled(){return this._disabled}set disabled(t){this.toggleAttribute("disabled",t)}get value(){return this._value}set value(t){this.setAttribute("value",t)}get name(){return this._name}set name(t){this.setAttribute("name",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._name="",this._value="",this._disabled=!1,this._kbdElement=this.shadowRoot.querySelector("kbd"),this._nameElement=this.shadowRoot.querySelector("#name"),this._valueElement=this.shadowRoot.querySelector("#value")}attributeChangedCallback(t,e,n){switch(t){case"name":this._name=n,this._nameElement.textContent=n;break;case"value":this._value=n,null!==n?(this._valueElement.classList.toggle("hidden",!1),this._valueElement.textContent=n,this._kbdElement.style.paddingRight=`${this._valueElement.clientWidth+4}px`):this._valueElement.classList.toggle("hidden",!0);break;case"disabled":this._disabled=null!==n,this._kbdElement.classList.toggle("disabled",null!==n)}}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"name")){let t=this.name;delete this.name,this.name=t}if(Object.prototype.hasOwnProperty.call(this,"value")){let t=this.value;delete this.value,this.value=t}if(Object.prototype.hasOwnProperty.call(this,"disabled")){let t=this.disabled;delete this.disabled,this.disabled=t}}}r.define();class l{constructor(t){this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null,this.pollable=t}get running(){return null!==this.animationFrameHandle}start(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}stop(){let t=this.animationFrameHandle;t&&cancelAnimationFrame(t),this.animationFrameHandle=null}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.pollable.onPoll(t)}}class h{constructor(t){this.onInput=this.onInput.bind(this),this.onPoll=this.onPoll.bind(this),this.bindings=t}onPoll(t){for(let e of this.bindings.getInputs())e.onPoll(t)}onInput(t){const{device:e,code:n,event:i,value:s,movement:o,control:a,shift:r,alt:l}=t;let h=this.bindings.getBindings(e,n);switch(i){case"pressed":for(let{input:t,index:e}of h)t.onUpdate(e,1,1);break;case"released":for(let{input:t,index:e}of h)t.onUpdate(e,0,-1);break;case"move":for(let{input:t,index:e}of h)t.onUpdate(e,s,o);break;case"wheel":for(let{input:t,index:e}of h)t.onUpdate(e,void 0,o)}return h.length>0}}class u{constructor(t,e,n,i){this.device=t,this.code=e,this.input=n,this.index=i}}class d{constructor(){this.bindingMap={},this.inputMap=new Map}clear(){for(let t of this.inputMap.keys())t.onUnbind();this.inputMap.clear(),this.bindingMap={}}bind(t,e,n,i={}){let s,o=this.inputMap;if(o.has(t)){let a=o.get(t),r=t.size;t.onBind(r,i),s=new u(e,n,t,r),a.push(s)}else{let a=[];o.set(t,a);let r=0;t.onBind(r,i),s=new u(e,n,t,r),a.push(s)}let a=this.bindingMap;e in a?n in a[e]?a[e][n].push(s):a[e][n]=[s]:a[e]={[n]:[s]}}unbind(t){let e=this.inputMap;if(e.has(t)){let n=this.bindingMap,i=e.get(t);for(let t of i){let{device:e,code:i}=t,s=n[e][i],o=s.indexOf(t);s.splice(o,1)}i.length=0,t.onUnbind(),e.delete(t)}}isBound(t){return this.inputMap.has(t)}getInputs(){return this.inputMap.keys()}getBindingsByInput(t){return this.inputMap.get(t)}getBindings(t,e){let n=this.bindingMap;if(t in n){let i=n[t];if(e in i)return i[e]}return[]}}class c{constructor(t,e={}){this.inputs={},this.devices=[new a("Mouse",t),new o("Keyboard",t)],this.bindings=new d,this.adapter=new h(this.bindings),this.autopoller=new l(this.adapter),this.eventTarget=t,this.anyButton=new i(1),this.anyButtonDevice="",this.anyButtonCode="",this.anyAxis=new n(1),this.anyAxisDevice="",this.anyAxisCode="",this.listeners={bind:[],unbind:[],focus:[],blur:[]},this.onInput=this.onInput.bind(this),this.onEventTargetBlur=this.onEventTargetBlur.bind(this),this.onEventTargetFocus=this.onEventTargetFocus.bind(this),t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur);for(let t of this.devices)t.addEventListener("input",this.onInput)}get autopoll(){return this.autopoller.running}set autopoll(t){this.toggleAutoPoll(t)}destroy(){let t=this.listeners;for(let e in t)t[e].length=0;this.autopoller.running&&this.autopoller.stop();for(let t of this.devices)t.removeEventListener("input",this.onInput),t.destroy();let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur)}setEventTarget(t){let e=this.eventTarget;e.removeEventListener("focus",this.onEventTargetFocus),e.removeEventListener("blur",this.onEventTargetBlur),this.eventTarget=t;for(let e of this.devices)e.setEventTarget(t);t.addEventListener("focus",this.onEventTargetFocus),t.addEventListener("blur",this.onEventTargetBlur)}toggleAutoPoll(t){let e=this.autopoller.running,n=void 0===t?!e:Boolean(t);n!==e&&(n?this.autopoller.start():this.autopoller.stop())}addEventListener(t,e){let n=this.listeners;t in n?n[t].push(e):n[t]=[e]}removeEventListener(t,e){let n=this.listeners;if(t in n){let i=n[t],s=i.indexOf(e);s>=0&&i.splice(s,1)}}dispatchEvent(t){const{type:e}=t;let n=0;for(let i of this.listeners[e])n|=i(t);return Boolean(n)}poll(t=performance.now()){if(this.autopoller.running)throw new Error("Should not manually poll() while autopolling.");this.onPoll(t)}onInput(t){let e=this.adapter.onInput(t);switch(t.event){case"pressed":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,1,1);break;case"released":this.anyButtonDevice=t.device,this.anyButtonCode=t.code,this.anyButton.onUpdate(0,0,-1);break;case"move":case"wheel":this.anyAxisDevice=t.device,this.anyAxisCode=t.code,this.anyAxis.onUpdate(0,t.value,t.movement)}return e}onPoll(t){this.adapter.onPoll(t),this.anyButton.onPoll(t),this.anyAxis.onPoll(t)}onBind(){this.dispatchEvent({type:"bind"})}onUnbind(){this.dispatchEvent({type:"unbind"})}onEventTargetFocus(){this.dispatchEvent({type:"focus"})}onEventTargetBlur(){for(let t of this.bindings.getInputs())t.onStatus(0,0);this.anyButton.onStatus(0,0),this.anyAxis.onStatus(0,0),this.dispatchEvent({type:"blur"})}bindButton(t,e,n,s){let o;this.hasButton(t)?o=this.getButton(t):(o=new i(1),this.inputs[t]=o),this.bindings.bind(o,e,n,s),this.onBind()}bindAxis(t,e,i,s){let o;this.hasAxis(t)?o=this.getAxis(t):(o=new n(1),this.inputs[t]=o),this.bindings.bind(o,e,i,s),this.onBind()}bindAxisButtons(t,e,i,s){let o;this.hasAxis(t)?o=this.getAxis(t):(o=new n(2),this.inputs[t]=o),this.bindings.bind(o,e,s),this.bindings.bind(o,e,i,{inverted:!0}),this.onBind()}unbindButton(t){if(this.hasButton(t)){let e=this.getButton(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}unbindAxis(t){if(this.hasAxis(t)){let e=this.getAxis(t);delete this.inputs[t],this.bindings.unbind(e),this.onUnbind()}}getInput(t){return this.inputs[t]}getButton(t){return this.inputs[t]}getAxis(t){return this.inputs[t]}hasButton(t){return t in this.inputs&&this.inputs[t]instanceof i}hasAxis(t){return t in this.inputs&&this.inputs[t]instanceof n}isButtonDown(t){return this.inputs[t].down}isButtonPressed(t){return this.inputs[t].pressed}isButtonReleased(t){return this.inputs[t].released}getInputValue(t){return this.inputs[t].value}getButtonValue(t){return this.buttons[t].value}getAxisValue(t){return this.inputs[t].value}getAxisDelta(t){return this.inputs[t].delta}isAnyButtonDown(t){if(void 0===t)return this.anyButton.down;{let e=this.inputs;for(let n of t){if(e[n].down)return!0}}return!1}isAnyButtonPressed(t){if(void 0===t)return this.anyButton.pressed;{let e=this.inputs;for(let n of t){if(e[n].pressed)return!0}}return!1}isAnyButtonReleased(t){if(void 0===t)return this.anyButton.released;{let e=this.inputs;for(let n of t){if(e[n].released)return!0}}return!1}getAnyAxisValue(t){if(void 0===t)return this.anyAxis.value;{let e=this.inputs;for(let n of t){let t=e[n];if(t.value)return t.value}}return 0}getAnyAxisDelta(t){if(void 0===t)return this.anyAxis.delta;{let e=this.inputs;for(let n of t){let t=e[n];if(t.delta)return t.delta}}return 0}getLastButtonDevice(){return this.anyButtonDevice}getLastButtonCode(){return this.anyButtonCode}getLastAxisDevice(){return this.anyAxisDevice}getLastAxisCode(){return this.anyAxisCode}getMouse(){return this.devices[0]}getKeyboard(){return this.devices[1]}}class p extends HTMLElement{static get[Symbol.for("templateNode")](){let t=document.createElement("template");return t.innerHTML='<table>\n    <thead>\n        <tr class="tableHeader">\n            <th colspan=3>\n                <span class="tableTitle">\n                    <label id="title">\n                        input-source\n                    </label>\n                    <span id="slotContainer">\n                        <slot></slot>\n                    </span>\n                    <p>\n                        <label for="poll">poll</label>\n                        <output id="poll"></output>\n                    </p>\n                    <p>\n                        <label for="focus">focus</label>\n                        <output id="focus"></output>\n                    </p>\n                </span>\n            </th>\n        </tr>\n        <tr class="colHeader">\n            <th>name</th>\n            <th>value</th>\n            <th>key</th>\n        </tr>\n    </thead>\n    <tbody>\n    </tbody>\n</table>\n',Object.defineProperty(this,Symbol.for("templateNode"),{value:t}),t}static get[Symbol.for("styleNode")](){let t=document.createElement("style");return t.innerHTML=':host {\n    display: block;\n}\n\ntable {\n    border-collapse: collapse;\n    font-family: monospace;\n}\n\ntable,\nth,\ntd {\n    border: 1px solid #666666;\n}\n\nth,\ntd {\n    padding: 5px 10px;\n}\n\ntd {\n    text-align: center;\n}\n\nthead th {\n    padding: 0;\n}\n\n.colHeader > th {\n    font-size: 0.8em;\n    padding: 0 10px;\n    letter-spacing: 3px;\n    background-color: #aaaaaa;\n    color: #666666;\n}\n\ntbody output {\n    border-radius: 0.3em;\n    padding: 3px;\n}\n\ntr:not(.primary) .name,\ntr:not(.primary) .value {\n    opacity: 0.3;\n}\n\ntr:nth-child(2n) {\n    background-color: #eeeeee;\n}\n\n.tableHeader {\n    color: #666666;\n}\n\n.tableTitle {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding: 4px;\n}\n\n#slotContainer {\n    flex: 1;\n}\n\np {\n    display: inline;\n    margin: 0;\n    padding: 0;\n    padding-right: 10px;\n}\n\n#poll:empty::after,\n#focus:empty::after {\n    content: "✗";\n    color: #ff0000;\n}\n',Object.defineProperty(this,Symbol.for("styleNode"),{value:t}),t}static define(t=window.customElements){t.define("input-port",this)}static get observedAttributes(){return["autopoll","for"]}get autopoll(){return this._autopoll}set autopoll(t){this.toggleAttribute("autopoll",t)}get for(){return this._for}set for(t){this.setAttribute("for",t)}constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.constructor[Symbol.for("templateNode")].content.cloneNode(!0)),this.shadowRoot.appendChild(this.constructor[Symbol.for("styleNode")].cloneNode(!0)),this._titleElement=this.shadowRoot.querySelector("#title"),this._pollElement=this.shadowRoot.querySelector("#poll"),this._focusElement=this.shadowRoot.querySelector("#focus"),this._bodyElement=this.shadowRoot.querySelector("tbody"),this._outputElements={},this.onAnimationFrame=this.onAnimationFrame.bind(this),this.animationFrameHandle=null;this._for="",this._eventTarget=this,this._autopoll=!1,this._context=null,this.onInputContextBind=this.onInputContextBind.bind(this),this.onInputContextUnbind=this.onInputContextUnbind.bind(this),this.onInputContextFocus=this.onInputContextFocus.bind(this),this.onInputContextBlur=this.onInputContextBlur.bind(this)}connectedCallback(){if(Object.prototype.hasOwnProperty.call(this,"for")){let t=this.for;delete this.for,this.for=t}if(Object.prototype.hasOwnProperty.call(this,"autopoll")){let t=this.autopoll;delete this.autopoll,this.autopoll=t}this.updateTable(),this.updateTableValues(),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)}disconnectedCallback(){this._context&&(this._context.removeEventListener("bind",this.onInputContextBind),this._context.removeEventListener("unbind",this.onInputContextUnbind),this._context.removeEventListener("blur",this.onInputContextBlur),this._context.removeEventListener("focus",this.onInputContextFocus),this._context.destroy(),this._context=null)}attributeChangedCallback(t,e,n){switch(t){case"for":{let t,e;this._for=n,n?(t=document.getElementById(n),e=`${t.tagName.toLowerCase()}#${n}`):(t=this,e="input-port"),this._eventTarget=t,this._context&&this._context.setEventTarget(this._eventTarget),this._titleElement.innerHTML=`for ${e}`}break;case"autopoll":this._autopoll=null!==n,this._context&&this._context.toggleAutoPoll(this._autopoll)}}onAnimationFrame(){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.updateTableValues(),this.updatePollStatus()}onInputContextBind(){this.updateTable()}onInputContextUnbind(){this.updateTable()}onInputContextFocus(){this._focusElement.innerHTML="✓"}onInputContextBlur(){this._focusElement.innerHTML=""}getContext(t="axisbutton",e){switch(t){case"axisbutton":return this._context||(this._context=new c(this._eventTarget,e),this._context.addEventListener("bind",this.onInputContextBind),this._context.addEventListener("unbind",this.onInputContextUnbind),this._context.addEventListener("blur",this.onInputContextBlur),this._context.addEventListener("focus",this.onInputContextFocus),this._autopoll&&this._context.toggleAutoPoll(!0)),this._context;default:throw new Error(`Input context id '${t}' is not supported.`)}}updateTable(){if(this.isConnected){if(!this._context)return this._outputElements={},void(this._bodyElement.innerHTML="");{let t=this._context,e=t.inputs,n=t.bindings,i={},s=[];for(let t of Object.keys(e)){let o=e[t],a=!0;for(let e of n.getBindingsByInput(o)){let n=v(`${o.constructor.name}.${t}`,`${e.device}.${e.code}`,0,a);s.push(n),a&&(i[t]=n.querySelector("output"),a=!1)}}this._outputElements=i,this._bodyElement.innerHTML="";for(let t of s)this._bodyElement.appendChild(t)}}}updateTableValues(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let e of Object.keys(this._outputElements)){let n=this._outputElements[e],i=t[e].value;n.innerText=Number(i).toFixed(2)}}else for(let t of Object.keys(this._outputElements)){this._outputElements[t].innerText="---"}}updatePollStatus(){if(this.isConnected)if(this._context){let t=this._context.inputs;for(let e of Object.values(t))if(!e.polling)return void(this._pollElement.innerHTML="");this._pollElement.innerHTML="✓"}else this._pollElement.innerHTML="-"}}function v(t,e,n,i=!0){let s=document.createElement("tr");i&&s.classList.add("primary");{let e=document.createElement("td");e.textContent=t,e.classList.add("name"),s.appendChild(e)}{let t=document.createElement("td"),e=document.createElement("output");e.innerText=i?Number(n).toFixed(2):"---",e.classList.add("value"),t.appendChild(e),s.appendChild(t)}{let t=document.createElement("td");t.classList.add("key");let n=new r;n.innerText=e,t.appendChild(n),s.appendChild(t)}return s}p.define();const m=Symbol("keyboardSource");const g=Symbol("mouseSource");t.AutoPoller=l,t.Axis=n,t.Button=i,t.CLEAR_DOWN_STATE_BITS=254,t.CLEAR_INVERTED_MODIFIER_BITS=239,t.CLEAR_POLL_BITS=241,t.DOWN_STATE_BIT=1,t.DeviceInputAdapter=h,t.INVERTED_MODIFIER_BIT=16,t.InputBase=e,t.InputBindings=d,t.InputCode=r,t.InputContext=c,t.InputDevice=s,t.InputPort=p,t.Keyboard=class{constructor(t,e){this.KeyA=new i,this.KeyB=new i,this.KeyC=new i,this.KeyD=new i,this.KeyE=new i,this.KeyF=new i,this.KeyG=new i,this.KeyH=new i,this.KeyI=new i,this.KeyJ=new i,this.KeyK=new i,this.KeyL=new i,this.KeyM=new i,this.KeyN=new i,this.KeyO=new i,this.KeyP=new i,this.KeyQ=new i,this.KeyR=new i,this.KeyS=new i,this.KeyT=new i,this.KeyU=new i,this.KeyV=new i,this.KeyW=new i,this.KeyX=new i,this.KeyY=new i,this.KeyZ=new i,this.Digit0=new i,this.Digit1=new i,this.Digit2=new i,this.Digit3=new i,this.Digit4=new i,this.Digit5=new i,this.Digit6=new i,this.Digit7=new i,this.Digit8=new i,this.Digit9=new i,this.Minus=new i,this.Equal=new i,this.BracketLeft=new i,this.BracketRight=new i,this.Semicolon=new i,this.Quote=new i,this.Backquote=new i,this.Backslash=new i,this.Comma=new i,this.Period=new i,this.Slash=new i,this.Escape=new i,this.Space=new i,this.CapsLock=new i,this.Backspace=new i,this.Delete=new i,this.Tab=new i,this.Enter=new i,this.ArrowUp=new i,this.ArrowDown=new i,this.ArrowLeft=new i,this.ArrowRight=new i;const n="Keyboard",s=new o(n,t,e),a=new d;for(let t in this)if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];a.bind(e,n,t)}const r=new h(a);s.addEventListener("input",r.onInput);const u=new l(r);u.start(),this[m]={device:s,bindings:a,adapter:r,autopoller:u}}destroy(){const t=this[m];t.autopoller.stop(),t.device.removeEventListener("input",t.adapter.onInput),t.device.destroy(),t.bindings.clear()}},t.KeyboardDevice=o,t.Mouse=class{constructor(t,e){this.PosX=new n,this.PosY=new n,this.WheelX=new n,this.WheelY=new n,this.WheelZ=new n,this.Button0=new i,this.Button1=new i,this.Button2=new i,this.Button3=new i,this.Button4=new i;const s="Mouse",o=new a(s,t,e),r=new d;for(let t in this)if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];r.bind(e,s,t)}const u=new h(r);o.addEventListener("input",u.onInput);const c=new l(u);c.start(),this[g]={device:o,bindings:r,adapter:u,autopoller:c}}destroy(){const t=this[g];t.autopoller.stop(),t.device.removeEventListener("input",t.adapter.onInput),t.device.destroy(),t.bindings.clear()}},t.MouseDevice=a,t.PRESSED_STATE_BIT=2,t.RELEASED_STATE_BIT=8,t.REPEATED_STATE_BIT=4,Object.defineProperty(t,"__esModule",{value:!0})}));
