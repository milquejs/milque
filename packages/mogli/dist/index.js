!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((r="undefined"!=typeof globalThis?globalThis:r||self).milque=r.milque||{},r.milque.mogli={}))}(this,(function(r){"use strict";function e(r){return"undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext}var t=Object.freeze({__proto__:null,isWebGL2Supported:e});class n{constructor(r,e){this.gl=r,this.target=e}data(r,e){const t=this.gl,n=this.target,a=e||t.STATIC_DRAW;if("number"==typeof r)t.bufferData(n,r,a);else{if(!ArrayBuffer.isView(r))throw new Error("Source data must be a typed array.");t.bufferData(n,r,a)}return this}subData(r,t=0,n,a){const u=this.gl,i=this.target;if(!ArrayBuffer.isView(r))throw new Error("Source data must be a typed array.");if(n)if(e(u))u.bufferSubData(i,t,r,n,a);else{const e=a?r.subarray(n,n+a):r.subarray(n);u.bufferSubData(i,t,e)}else u.bufferSubData(i,t,r);return this}}class a{constructor(r,e,t){this.dataContext=new n(r,e),this.handle=t||r.createBuffer(),r.bindBuffer(e,this.handle)}get gl(){return this.dataContext.gl}get target(){return this.dataContext.target}data(r,e){return this.dataContext.data(r,e),this}subData(r,e=0,t,n){return this.dataContext.subData(r,e,t,n),this}build(){return this.handle}}class u{constructor(r,e,t,a){this.gl=r,this.target=e,this.handle=a,this.type=t,this.bindContext=new n(r,this.target)}bind(r){return r.bindBuffer(this.target,this.handle),this.bindContext.gl=r,this.bindContext}}function i(r,e,t){return new(f(r,e))(t)}function s(r,e,t,n){let a=r.createBuffer();if(r.bindBuffer(e,a),!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");return r.bufferData(e,t,n||r.STATIC_DRAW),a}function f(r,e){switch(e){case r.BYTE:return Int8Array;case r.UNSIGNED_BYTE:return Uint8Array;case r.SHORT:return Int16Array;case r.UNSIGNED_SHORT:return Uint16Array;case r.INT:return Int32Array;case r.UNSIGNED_INT:return Uint32Array;case r.FLOAT:return Float32Array;default:throw new Error("Cannot find valid typed array for buffer type.")}}function o(r,e){switch(e){case Int8Array:return r.BYTE;case Uint8Array:return r.UNSIGNED_BYTE;case Int16Array:return r.SHORT;case Uint16Array:return r.UNSIGNED_SHORT;case Int32Array:return r.INT;case Uint32Array:return r.UNSIGNED_INT;case Float32Array:return r.FLOAT;default:throw new Error("Cannot find valid buffer type for typed array.")}}var _=Object.freeze({__proto__:null,createBufferSource:i,createBuffer:s,createBufferFromArray:function(r,e,t,n,a){return s(r,e,i(r,t,n),a)},getBufferTypedArray:f,getTypedArrayBufferType:o,getBufferUsage:function(r,e,t){return r.bindBuffer(e,t),r.getBufferParameter(e,r.BUFFER_USAGE)}});function c(r,e){switch(e){case r.FLOAT:return 1;case r.FLOAT_VEC2:return 2;case r.FLOAT_VEC3:return 3;case r.FLOAT_VEC4:case r.FLOAT_MAT2:return 4;case r.FLOAT_MAT3:return 9;case r.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function A(r,e){let t=[];const n=r.getProgramParameter(e,r.ACTIVE_UNIFORMS);for(let a=0;a<n;++a){let n=r.getActiveUniform(e,a);if(!n)break;t.push(n)}return t}function T(r,e){let t=[];const n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let a=0;a<n;++a){let n=r.getActiveAttrib(e,a);n&&t.push(n)}return t}function E(r,e){let t={};const n=T(r,e);for(let a of n){const n=a.name,u=a.size,i=a.type,s=r.getAttribLocation(e,n),f=c(r,i);t[n]={type:i,length:u,location:s,size:f}}return t}function S(r,t){switch(t){case r.FLOAT:return r.uniform1f;case r.FLOAT_VEC2:return r.uniform2fv;case r.FLOAT_VEC3:return r.uniform3fv;case r.FLOAT_VEC4:return r.uniform4fv;case r.INT:return r.uniform1i;case r.INT_VEC2:return r.uniform2iv;case r.INT_VEC3:return r.uniform3iv;case r.INT_VEC4:return r.uniform4iv;case r.BOOL:return r.uniform1i;case r.BOOL_VEC2:return r.uniform2iv;case r.BOOL_VEC3:return r.uniform3iv;case r.BOOL_VEC4:return r.uniform4iv;case r.FLOAT_MAT2:return N;case r.FLOAT_MAT3:return m;case r.FLOAT_MAT4:return O;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1i}if(e(r))switch(t){case r.UNSIGNED_INT:return r.uniform1ui;case r.UNSIGNED_INT_VEC2:return r.uniform2uiv;case r.UNSIGNED_INT_VEC3:return r.uniform3uiv;case r.UNSIGNED_INT_VEC4:return r.uniform4uiv;case r.FLOAT_MAT2x3:return l;case r.FLOAT_MAT2x4:return R;case r.FLOAT_MAT3x2:return g;case r.FLOAT_MAT3x4:return P;case r.FLOAT_MAT4x2:return F;case r.FLOAT_MAT4x3:return x;case r.SAMPLER_3D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE_SHADOW:case r.INT_SAMPLER_2D:case r.INT_SAMPLER_3D:case r.INT_SAMPLER_CUBE:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:return r.uniform1i}throw new Error("Cannot find uniform function for gl enum.")}function L(r,t){switch(t){case r.FLOAT:return r.uniform1fv;case r.FLOAT_VEC2:return r.uniform2fv;case r.FLOAT_VEC3:return r.uniform3fv;case r.FLOAT_VEC4:return r.uniform4fv;case r.INT:return r.uniform1iv;case r.INT_VEC2:return r.uniform2iv;case r.INT_VEC3:return r.uniform3iv;case r.INT_VEC4:return r.uniform4iv;case r.BOOL:return r.uniform1iv;case r.BOOL_VEC2:return r.uniform2iv;case r.BOOL_VEC3:return r.uniform3iv;case r.BOOL_VEC4:return r.uniform4iv;case r.FLOAT_MAT2:return N;case r.FLOAT_MAT3:return m;case r.FLOAT_MAT4:return O;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1iv}if(e(r))switch(t){case r.UNSIGNED_INT:return r.uniform1uiv;case r.UNSIGNED_INT_VEC2:return r.uniform2uiv;case r.UNSIGNED_INT_VEC3:return r.uniform3uiv;case r.UNSIGNED_INT_VEC4:return r.uniform4uiv;case r.FLOAT_MAT2x3:return l;case r.FLOAT_MAT2x4:return R;case r.FLOAT_MAT3x2:return g;case r.FLOAT_MAT3x4:return P;case r.FLOAT_MAT4x2:return F;case r.FLOAT_MAT4x3:return x;case r.SAMPLER_3D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE_SHADOW:case r.INT_SAMPLER_2D:case r.INT_SAMPLER_3D:case r.INT_SAMPLER_CUBE:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:return r.uniform1iv}throw new Error("Cannot find array uniform function for gl enum.")}function N(r,e){this.uniformMatrix2fv(r,!1,e)}function I(r,e,t,n,a){this.uniformMatrix2fv(r,!1,[e,t,n,a])}function m(r,e){this.uniformMatrix3fv(r,!1,e)}function h(r,e,t,n,a,u,i,s,f,o){this.uniformMatrix3fv(r,!1,[e,t,n,a,u,i,s,f,o])}function O(r,e){this.uniformMatrix4fv(r,!1,e)}function M(r,e,t,n,a,u,i,s,f,o,_,c,A,T,E,S,L){this.uniformMatrix4fv(r,!1,[e,t,n,a,u,i,s,f,o,_,c,A,T,E,S,L])}function l(r,e){this.uniformMatrix2x3fv(r,!1,e)}function D(r,e,t,n,a,u,i){this.uniformMatrix2x3fv(r,!1,[e,t,n,a,u,i])}function R(r,e){this.uniformMatrix2x4fv(r,!1,e)}function d(r,e,t,n,a,u,i,s,f){this.uniformMatrix2x4fv(r,!1,[e,t,n,a,u,i,s,f])}function g(r,e){this.uniformMatrix3x2fv(r,!1,e)}function C(r,e,t,n,a,u,i){this.uniformMatrix3x2fv(r,!1,[e,t,n,a,u,i])}function P(r,e){this.uniformMatrix3x4fv(r,!1,e)}function U(r,e,t,n,a,u,i,s,f,o,_,c,A){this.uniformMatrix3x4fv(r,!1,[e,t,n,a,u,i,s,f,o,_,c,A])}function F(r,e){this.uniformMatrix4x2fv(r,!1,e)}function B(r,e,t,n,a,u,i,s,f){this.uniformMatrix4x2fv(r,!1,[e,t,n,a,u,i,s,f])}function x(r,e){this.uniformMatrix4x3fv(r,!1,e)}function v(r,e,t,n,a,u,i,s,f,o,_,c,A){this.uniformMatrix4x3fv(r,!1,[e,t,n,a,u,i,s,f,o,_,c,A])}var b=Object.freeze({__proto__:null,getUniformFunction:S,getUniformFunctionForComponent:function(r,t){switch(t){case r.FLOAT:return r.uniform1f;case r.FLOAT_VEC2:return r.uniform2f;case r.FLOAT_VEC3:return r.uniform3f;case r.FLOAT_VEC4:return r.uniform4f;case r.INT:return r.uniform1i;case r.INT_VEC2:return r.uniform2i;case r.INT_VEC3:return r.uniform3i;case r.INT_VEC4:return r.uniform4i;case r.BOOL:return r.uniform1i;case r.BOOL_VEC2:return r.uniform2i;case r.BOOL_VEC3:return r.uniform3i;case r.BOOL_VEC4:return r.uniform4i;case r.FLOAT_MAT2:return I;case r.FLOAT_MAT3:return h;case r.FLOAT_MAT4:return M;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1i}if(e(r))switch(t){case r.UNSIGNED_INT:return r.uniform1ui;case r.UNSIGNED_INT_VEC2:return r.uniform2ui;case r.UNSIGNED_INT_VEC3:return r.uniform3ui;case r.UNSIGNED_INT_VEC4:return r.uniform4ui;case r.FLOAT_MAT2x3:return D;case r.FLOAT_MAT2x4:return d;case r.FLOAT_MAT3x2:return C;case r.FLOAT_MAT3x4:return U;case r.FLOAT_MAT4x2:return B;case r.FLOAT_MAT4x3:return v;case r.SAMPLER_3D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE_SHADOW:case r.INT_SAMPLER_2D:case r.INT_SAMPLER_3D:case r.INT_SAMPLER_CUBE:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:return r.uniform1i}throw new Error("Cannot find per component uniform function for gl enum.")},getUniformFunctionForArray:L});function y(r,e){let t={};const n=A(r,e);for(let a of n){const n=a.name,u=a.size,i=a.type,s=r.getUniformLocation(e,n);let f;f=u<=1?S(r,i):L(r,i),t[n]={type:i,length:u,location:s,set:f}}return t}function V(r,e,t){let n=r.createShader(e);if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){let e=r.getShaderInfoLog(n)+`\nFailed to compile shader:\n${t}`;throw r.deleteShader(n),new Error(e)}return n}function p(r,e,t){for(let n of t)r.attachShader(e,n);r.linkProgram(e);for(let n of t)r.detachShader(e,n),r.deleteShader(n);if(!r.getProgramParameter(e,r.LINK_STATUS)){let t=r.getProgramInfoLog(e);throw r.deleteProgram(e),new Error(t)}return e}var G=Object.freeze({__proto__:null,createShader:V,createShaderProgram:p,getProgramInfo:function(r,e){return{handle:e,linkStatus:r.getProgramParameter(e,r.LINK_STATUS),deleteStatus:r.getProgramParameter(e,r.DELETE_STATUS),validateStatus:r.getProgramParameter(e,r.VALIDATE_STATUS),validationLog:r.getProgramInfoLog(e),activeUniforms:y(r,e),activeAttributes:E(r,e)}},getActiveUniforms:A,getActiveAttribs:T});r.BufferBuilder=a,r.BufferDataContext=n,r.BufferEnums={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},r.BufferHelper=_,r.BufferInfo=u,r.BufferInfoBuilder=class{constructor(r,e,t){this.bufferBuilder=new a(r,e,t),this.bufferType=r.FLOAT}get gl(){return this.bufferBuilder.gl}get handle(){return this.bufferBuilder.handle}get target(){return this.bufferBuilder.target}data(r,e){if(this.bufferBuilder.data(r,e),"number"!=typeof r){const e=r.constructor;this.bufferType=o(this.gl,e)}return this}subData(r,e,t,n){this.bufferBuilder.subData(r,e,t,n);const a=r.constructor;return this.bufferType=o(this.gl,a),this}build(){const r=this.bufferBuilder.build(),e=this.gl,t=this.target,n=this.bufferType;return new u(e,t,n,r)}},r.GLHelper=t,r.ProgramAttributeEnums={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126,HALF_FLOAT:5131},r.ProgramBuilder=class{constructor(r,e){this.handle=e||r.createProgram(),this.shaders=[],this.gl=r}shader(r,e){let t=V(this.gl,r,e);return this.shaders.push(t),this}link(){return p(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}},r.ProgramHelper=G,r.ProgramUniformEnums={FLOAT:5126,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,UNSIGNED_INT:5125,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311},r.ProgramUniformFunctions=b,Object.defineProperty(r,"__esModule",{value:!0})}));
