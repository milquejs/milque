!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((r="undefined"!=typeof globalThis?globalThis:r||self).milque=r.milque||{},r.milque.mogli={}))}(this,(function(r){"use strict";function e(r){return"undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext}var t=Object.freeze({__proto__:null,isWebGL2Supported:e});class n{constructor(r,e){this.gl=r,this.target=e}data(r,e){const t=this.gl,n=this.target;if("number"==typeof r)t.bufferData(n,r,e||t.STATIC_DRAW);else{if(!ArrayBuffer.isView(r))throw new Error("Source data must be a typed array.");t.bufferData(n,r,e||t.STATIC_DRAW)}return this}subData(r,t=0,n,i){const a=this.gl,u=this.target;if(!ArrayBuffer.isView(r))throw new Error("Source data must be a typed array.");if(n)if(e(a))a.bufferSubData(u,t,r,n,i);else{const e=i?r.subarray(n,n+i):r.subarray(n);a.bufferSubData(u,t,e)}else a.bufferSubData(u,t,r);return this}}class i{constructor(r,e,t){this.dataContext=new n(r,e),this.handle=t||r.createBuffer(),r.bindBuffer(e,this.handle)}get gl(){return this.dataContext.gl}get target(){return this.dataContext.target}data(r,e){return this.dataContext.data(r,e),this}subData(r,e=0,t,n){return this.dataContext.subData(r,e,t,n),this}build(){return this.handle}}class a{constructor(r,e,t,i){this.gl=r,this.target=e,this.handle=i,this.type=t,this.bindContext=new n(r,this.target)}bind(r){return r.bindBuffer(this.target,this.handle),this.bindContext.gl=r,this.bindContext}}function u(r,e){switch(e){case r.BYTE:return Int8Array;case r.UNSIGNED_BYTE:return Uint8Array;case r.SHORT:return Int16Array;case r.UNSIGNED_SHORT:return Uint16Array;case r.INT:return Int32Array;case r.UNSIGNED_INT:return Uint32Array;case r.FLOAT:return Float32Array;default:throw new Error("Cannot find valid typed array for buffer type.")}}function s(r,e){switch(e){case Int8Array:return r.BYTE;case Uint8Array:return r.UNSIGNED_BYTE;case Int16Array:return r.SHORT;case Uint16Array:return r.UNSIGNED_SHORT;case Int32Array:return r.INT;case Uint32Array:return r.UNSIGNED_INT;case Float32Array:return r.FLOAT;default:throw new Error("Cannot find valid buffer type for typed array.")}}var o=Object.freeze({__proto__:null,createBufferSource:function(r,e,t){return new(u(r,e))(t)},createBuffer:function(r,e,t,n){let i=r.createBuffer();if(r.bindBuffer(e,i),!ArrayBuffer.isView(t))throw new Error("Source data must be a typed array.");return r.bufferData(e,t,n||r.STATIC_DRAW),i},getBufferTypedArray:u,getTypedArrayBufferType:s,getBufferUsage:function(r,e,t){return r.bindBuffer(e,t),r.getBufferParameter(e,r.BUFFER_USAGE)}});function f(r,t){switch(t){case r.FLOAT:return r.uniform1f;case r.FLOAT_VEC2:return r.uniform2fv;case r.FLOAT_VEC3:return r.uniform3fv;case r.FLOAT_VEC4:return r.uniform4fv;case r.INT:return r.uniform1i;case r.INT_VEC2:return r.uniform2iv;case r.INT_VEC3:return r.uniform3iv;case r.INT_VEC4:return r.uniform4iv;case r.BOOL:return r.uniform1i;case r.BOOL_VEC2:return r.uniform2iv;case r.BOOL_VEC3:return r.uniform3iv;case r.BOOL_VEC4:return r.uniform4iv;case r.FLOAT_MAT2:return c;case r.FLOAT_MAT3:return T;case r.FLOAT_MAT4:return h;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1i}if(e(r))switch(t){case r.UNSIGNED_INT:return r.uniform1ui;case r.UNSIGNED_INT_VEC2:return r.uniform2uiv;case r.UNSIGNED_INT_VEC3:return r.uniform3uiv;case r.UNSIGNED_INT_VEC4:return r.uniform4uiv;case r.FLOAT_MAT2x3:return N;case r.FLOAT_MAT2x4:return l;case r.FLOAT_MAT3x2:return I;case r.FLOAT_MAT3x4:return O;case r.FLOAT_MAT4x2:return D;case r.FLOAT_MAT4x3:return g;case r.SAMPLER_3D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE_SHADOW:case r.INT_SAMPLER_2D:case r.INT_SAMPLER_3D:case r.INT_SAMPLER_CUBE:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:return r.uniform1i}throw new Error("Cannot find uniform function for gl enum.")}function _(r,t){switch(t){case r.FLOAT:return r.uniform1fv;case r.FLOAT_VEC2:return r.uniform2fv;case r.FLOAT_VEC3:return r.uniform3fv;case r.FLOAT_VEC4:return r.uniform4fv;case r.INT:return r.uniform1iv;case r.INT_VEC2:return r.uniform2iv;case r.INT_VEC3:return r.uniform3iv;case r.INT_VEC4:return r.uniform4iv;case r.BOOL:return r.uniform1iv;case r.BOOL_VEC2:return r.uniform2iv;case r.BOOL_VEC3:return r.uniform3iv;case r.BOOL_VEC4:return r.uniform4iv;case r.FLOAT_MAT2:return c;case r.FLOAT_MAT3:return T;case r.FLOAT_MAT4:return h;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1iv}if(e(r))switch(t){case r.UNSIGNED_INT:return r.uniform1uiv;case r.UNSIGNED_INT_VEC2:return r.uniform2uiv;case r.UNSIGNED_INT_VEC3:return r.uniform3uiv;case r.UNSIGNED_INT_VEC4:return r.uniform4uiv;case r.FLOAT_MAT2x3:return N;case r.FLOAT_MAT2x4:return l;case r.FLOAT_MAT3x2:return I;case r.FLOAT_MAT3x4:return O;case r.FLOAT_MAT4x2:return D;case r.FLOAT_MAT4x3:return g;case r.SAMPLER_3D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE_SHADOW:case r.INT_SAMPLER_2D:case r.INT_SAMPLER_3D:case r.INT_SAMPLER_CUBE:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:return r.uniform1iv}throw new Error("Cannot find array uniform function for gl enum.")}function c(r,e){this.uniformMatrix2fv(r,!1,e)}function A(r,e,t,n,i){this.uniformMatrix2fv(r,!1,[e,t,n,i])}function T(r,e){this.uniformMatrix3fv(r,!1,e)}function E(r,e,t,n,i,a,u,s,o,f){this.uniformMatrix3fv(r,!1,[e,t,n,i,a,u,s,o,f])}function h(r,e){this.uniformMatrix4fv(r,!1,e)}function S(r,e,t,n,i,a,u,s,o,f,_,c,A,T,E,h,S){this.uniformMatrix4fv(r,!1,[e,t,n,i,a,u,s,o,f,_,c,A,T,E,h,S])}function N(r,e){this.uniformMatrix2x3fv(r,!1,e)}function L(r,e,t,n,i,a,u){this.uniformMatrix2x3fv(r,!1,[e,t,n,i,a,u])}function l(r,e){this.uniformMatrix2x4fv(r,!1,e)}function m(r,e,t,n,i,a,u,s,o){this.uniformMatrix2x4fv(r,!1,[e,t,n,i,a,u,s,o])}function I(r,e){this.uniformMatrix3x2fv(r,!1,e)}function d(r,e,t,n,i,a,u){this.uniformMatrix3x2fv(r,!1,[e,t,n,i,a,u])}function O(r,e){this.uniformMatrix3x4fv(r,!1,e)}function M(r,e,t,n,i,a,u,s,o,f,_,c,A){this.uniformMatrix3x4fv(r,!1,[e,t,n,i,a,u,s,o,f,_,c,A])}function D(r,e){this.uniformMatrix4x2fv(r,!1,e)}function R(r,e,t,n,i,a,u,s,o){this.uniformMatrix4x2fv(r,!1,[e,t,n,i,a,u,s,o])}function g(r,e){this.uniformMatrix4x3fv(r,!1,e)}function C(r,e,t,n,i,a,u,s,o,f,_,c,A){this.uniformMatrix4x3fv(r,!1,[e,t,n,i,a,u,s,o,f,_,c,A])}var P=Object.freeze({__proto__:null,getUniformFunction:f,getUniformFunctionForComponent:function(r,t){switch(t){case r.FLOAT:return r.uniform1f;case r.FLOAT_VEC2:return r.uniform2f;case r.FLOAT_VEC3:return r.uniform3f;case r.FLOAT_VEC4:return r.uniform4f;case r.INT:return r.uniform1i;case r.INT_VEC2:return r.uniform2i;case r.INT_VEC3:return r.uniform3i;case r.INT_VEC4:return r.uniform4i;case r.BOOL:return r.uniform1i;case r.BOOL_VEC2:return r.uniform2i;case r.BOOL_VEC3:return r.uniform3i;case r.BOOL_VEC4:return r.uniform4i;case r.FLOAT_MAT2:return A;case r.FLOAT_MAT3:return E;case r.FLOAT_MAT4:return S;case r.SAMPLER_2D:case r.SAMPLER_CUBE:return r.uniform1i}if(e(r))switch(t){case r.UNSIGNED_INT:return r.uniform1ui;case r.UNSIGNED_INT_VEC2:return r.uniform2ui;case r.UNSIGNED_INT_VEC3:return r.uniform3ui;case r.UNSIGNED_INT_VEC4:return r.uniform4ui;case r.FLOAT_MAT2x3:return L;case r.FLOAT_MAT2x4:return m;case r.FLOAT_MAT3x2:return d;case r.FLOAT_MAT3x4:return M;case r.FLOAT_MAT4x2:return R;case r.FLOAT_MAT4x3:return C;case r.SAMPLER_3D:case r.SAMPLER_2D_SHADOW:case r.SAMPLER_2D_ARRAY:case r.SAMPLER_2D_ARRAY_SHADOW:case r.SAMPLER_CUBE_SHADOW:case r.INT_SAMPLER_2D:case r.INT_SAMPLER_3D:case r.INT_SAMPLER_CUBE:case r.INT_SAMPLER_2D_ARRAY:case r.UNSIGNED_INT_SAMPLER_2D:case r.UNSIGNED_INT_SAMPLER_3D:case r.UNSIGNED_INT_SAMPLER_CUBE:case r.UNSIGNED_INT_SAMPLER_2D_ARRAY:return r.uniform1i}throw new Error("Cannot find per component uniform function for gl enum.")},getUniformFunctionForArray:_});function U(r,e){let t=[];const n=r.getProgramParameter(e,r.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){let n=r.getActiveUniform(e,i);if(!n)break;t.push(n)}return t}function B(r,e){let t=[];const n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;++i){let n=r.getActiveAttrib(e,i);n&&t.push(n)}return t}function F(r,e){let t={};const n=U(r,e);for(let i of n){const n=i.name,a=i.size,u=i.type,s=r.getUniformLocation(e,n);let o;o=a<=1?f(r,u):_(r,u),t[n]={type:u,length:a,location:s,set:o}}return t}function x(r,e){switch(e){case r.FLOAT:return 1;case r.FLOAT_VEC2:return 2;case r.FLOAT_VEC3:return 3;case r.FLOAT_VEC4:case r.FLOAT_MAT2:return 4;case r.FLOAT_MAT3:return 9;case r.FLOAT_MAT4:return 16;default:throw new Error("Invalid vertex attribute type.")}}function b(r,e){let t={};const n=B(r,e);for(let i of n){const n=i.name,a=i.size,u=i.type,s=r.getAttribLocation(e,n),o=x(r,u);t[n]={type:u,length:a,location:s,size:o}}return t}function v(r,e,t){let n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)||(console.error(r.getShaderInfoLog(n)+`\nFailed to compile shader:\n${t}`),r.deleteShader(n)),n}function y(r,e,t){for(let n of t)r.attachShader(e,n);r.linkProgram(e);for(let n of t)r.detachShader(e,n),r.deleteShader(n);return r.getProgramParameter(e,r.LINK_STATUS)||(console.error(r.getProgramInfoLog(e)),r.deleteProgram(e)),e}function V(r,e,t,n,i){i?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i),r.drawElements(e,n,r.UNSIGNED_SHORT,t)):r.drawArrays(e,t,n)}var p=Object.freeze({__proto__:null,createShader:v,createShaderProgram:y,draw:V,getProgramInfo:function(r,e){return{linkStatus:r.getProgramParameter(e,r.LINK_STATUS),deleteStatus:r.getProgramParameter(e,r.DELETE_STATUS),validateStatus:r.getProgramParameter(e,r.VALIDATE_STATUS),validationLog:r.getProgramInfoLog(e),activeUniforms:F(r,e),activeAttributes:b(r,e)}},getActiveUniforms:U,getActiveAttribs:B});class G{constructor(r,e){this.handle=e,this.activeUniforms=F(r,e),this.activeAttributes=b(r,e),this.drawContext=new w(r,this)}bind(r){return r.useProgram(this.handle),this.drawContext.gl=r,this.drawContext}}class w{constructor(r,e){this.gl=r,this.parent=e}uniform(r,e){const t=this.parent.activeUniforms;if(r in t){let n=t[r],i=n.location;n.set.call(this.gl,i,e)}return this}attribute(r,e,t,n=!1,i=0,a=0){const u=this.gl,s=this.parent.activeAttributes;if(r in s){let o=s[r],f=o.location,_=o.size;t?(u.bindBuffer(u.ARRAY_BUFFER,t),u.vertexAttribPointer(f,_,e,n,i,a),u.enableVertexAttribArray(f)):u.disableVertexAttribArray(f)}return this}draw(r,e,t,n,i=null){return V(r,e,t,n,i),this.parent}}class H{constructor(r,e){this.handle=e||r.createProgram(),this.shaders=[],this.gl=r}shader(r,e){let t=v(this.gl,r,e);return this.shaders.push(t),this}link(){return y(this.gl,this.handle,this.shaders),this.shaders.length=0,this.handle}}r.BufferBuilder=i,r.BufferDataContext=n,r.BufferEnums={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},r.BufferHelper=o,r.BufferInfo=a,r.BufferInfoBuilder=class{constructor(r,e,t){this.bufferBuilder=new i(r,e,t),this.bufferType=r.FLOAT}get gl(){return this.bufferBuilder.gl}get handle(){return this.bufferBuilder.handle}get target(){return this.bufferBuilder.target}data(r,e){if(this.bufferBuilder.data(r,e),"number"!=typeof r){const e=r.constructor;this.bufferType=s(this.gl,e)}return this}subData(r,e,t,n){this.bufferBuilder.subData(r,e,t,n);const i=r.constructor;return this.bufferType=s(this.gl,i),this}build(){const r=this.bufferBuilder.build(),e=this.gl,t=this.target,n=this.bufferType;return new a(e,t,n,r)}},r.GLHelper=t,r.ProgramAttributeEnums={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126,HALF_FLOAT:5131},r.ProgramBuilder=H,r.ProgramHelper=p,r.ProgramInfo=G,r.ProgramInfoBuilder=class{constructor(r,e){this.programBuilder=new H(r,e)}get gl(){return this.programBuilder.gl}get handle(){return this.programBuilder.handle}get shaders(){return this.programBuilder.shaders}shader(r,e){return this.programBuilder.shader(r,e),this}link(){const r=this.programBuilder.link();return new G(this.gl,r)}},r.ProgramInfoDrawContext=w,r.ProgramUniformEnums={FLOAT:5126,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,UNSIGNED_INT:5125,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311},r.ProgramUniformFunctions=P,Object.defineProperty(r,"__esModule",{value:!0})}));
