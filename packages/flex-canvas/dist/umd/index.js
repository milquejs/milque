!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Milque={})}(this,(function(t){"use strict";function e(t,e,n,s,h){const a=e.getBoundingClientRect(),o=a.width,r=a.height;switch(t){case"fill":case"fit":return void i(n,s,h,o,r);case"scale":return void function(t,e,i,n,s){const h=n/e,a=s/i;h<a?(t.style.setProperty("width",`${Math.floor(n)}px`),t.style.setProperty("height",`${Math.floor(i*h)}px`)):(t.style.setProperty("width",`${Math.floor(e*a)}px`),t.style.setProperty("height",`${Math.floor(s)}px`))}(n,s,h,o,r);case"stretch":return void function(t,e,i){t.style.setProperty("width",`${Math.floor(e)}px`),t.style.setProperty("height",`${Math.floor(i)}px`)}(n,o,r);default:return void function(t,e,i){t.style.setProperty("--width",`${e}px`),t.style.setProperty("--height",`${i}px`)}(e,s,h)}}function i(t,e,i,n,s){e=Math.floor(n),i=Math.floor(s),t.style.setProperty("width",`${e}px`),t.style.setProperty("height",`${i}px`),t.width!==e&&(t.width=e),t.height!==i&&(t.height=i)}const n="fit",s="scale",h="fill",a="none",o="container",r=Symbol.for("templateNode"),l=Symbol.for("styleNode");class d extends HTMLElement{static define(t="flex-canvas"){window.customElements.define(t,this)}static get[r](){let t=document.createElement("template");return t.innerHTML='\n<div class="container">\n  <div class="padding"></div>\n  <div class="innerContainer">\n    <div class="padding"></div>\n    <slot><canvas>Oh no! Your browser does not support canvas.</canvas></slot>\n    <div class="padding"></div>\n  </div>\n  <div class="padding"></div>\n</div>',Object.defineProperty(this,r,{value:t}),t}static get[l](){let t=document.createElement("style");return t.innerHTML='\n:host {\n  display: inline-block;\n  flex: 1;\n  --width: 300px;\n  --height: 150px;\n}\n:host([scaling="noscale"]) {\n  width: var(--width);\n  height: var(--height);\n}\n:host([sizing="viewport"]) {\n    position: fixed;\n    top: 0;\n    left: 0;\n}\n.container {\n  position: relative;\n  display: flex;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.innerContainer {\n  display: flex;\n  flex-direction: column;\n}\n.padding {\n  flex: 1;\n}',Object.defineProperty(this,l,{value:t}),t}static get observedAttributes(){return["sizing","width","height"]}get scaling(){return this.getAttribute("scaling")}set scaling(t){this.setAttribute("scaling",t)}get sizing(){return this._sizing}set sizing(t){this.setAttribute("sizing",String(t))}get width(){return this._width}set width(t){this.setAttribute("width",String(t))}get height(){return this._height}set height(t){this.setAttribute("height",String(t))}get canvas(){return this.canvasElement}constructor(t=void 0){super();const e=this.attachShadow({mode:"open"}),i=this.constructor,d=i[r],c=i[l];if(e.appendChild(d.content.cloneNode(!0)),e.appendChild(c.cloneNode(!0)),this._sizing="none",this._width=300,this._height=150,this.animationFrameHandle=0,this.resizeDelay=0,this.resizeTimeoutHandle=0,this.resizeCanvasWidth=0,this.resizeCanvasHeight=0,this.canvasSlotElement=e.querySelector("slot"),this.canvasElement=null,this.onResize=this.onResize.bind(this),this.onAnimationFrame=this.onAnimationFrame.bind(this),this.onSlotChange=this.onSlotChange.bind(this),void 0!==t){const e=void 0!==t.width||void 0!==t.height,i=void 0!==t.aspectRatio;if(e){let e=Math.round(Number(t.width)),n=Math.round(Number(t.height));if(this.width=e,this.height=n,i){let i=Number(t.aspectRatio),s=Math.round(n*i);if(s!==e)throw new Error(`Flex canvas width and height dimensions did not match given aspect ratio '${i}' - expected width to be ${s} but was ${e}.`)}t.forceScaling||(this.scaling=s)}else if(i){let e=150,i=e*Number(t.aspectRatio);this.width=i,this.height=e,t.forceScaling||(this.scaling=n)}else t.forceScaling||(this.scaling=h);t.forceScaling&&(this.scaling=t.forceScaling),t.sizing?this.sizing=t.sizing:this.sizing=i?o:a,t.root&&t.root.appendChild(this)}}connectedCallback(){if(c(this,"scaling"),c(this,"sizing"),c(this,"width"),c(this,"height"),this.hasAttribute("scaling")||this.setAttribute("scaling",s),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0"),this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.canvasSlotElement.addEventListener("slotchange",this.onSlotChange),!this.canvasElement){let t=this.canvasSlotElement.querySelector("canvas");this.setCanvasElement(t)}}disconnectedCallback(){cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=0,this.canvasSlotElement.removeEventListener("slotchange",this.onSlotChange)}attributeChangedCallback(t,e,i){switch(t){case"sizing":this._sizing=String(i),function(t,e){switch(t){case"none":return void function(t){t.style.removeProperty("width"),t.style.removeProperty("height")}(e);case"container":return void function(t){t.style.setProperty("width","100%"),t.style.setProperty("height","100%")}(e);case"viewport":!function(t){t.style.setProperty("width","100vw"),t.style.setProperty("height","100vh")}(e)}}(this._sizing,this);break;case"width":this._width=Number(i),this.canvasElement&&(this.canvasElement.width=this._width);break;case"height":this._height=Number(i),this.canvasElement&&(this.canvasElement.height=this._height)}}onAnimationFrame(t){this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame),this.clientWidth===this.resizeCanvasWidth&&this.clientHeight===this.resizeCanvasHeight||(this.resizeCanvasWidth=this.clientWidth,this.resizeCanvasHeight=this.clientHeight,this.resizeDelay>0?this.resizeTimeoutHandle||(this.resizeTimeoutHandle=window.setTimeout(this.onResize,this.resizeDelay)):this.onResize())}onResize(){window.clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=0;const t=this.canvasElement;if(!t)return;e(this.scaling,this,t,this._width,this._height)}onSlotChange(t){let e=t.target.assignedElements({flatten:!0}).find((t=>t instanceof HTMLCanvasElement));e&&this.setCanvasElement(e)}setCanvasElement(t){t.width=this._width,t.height=this._height,t.style.imageRendering="pixelated",this.canvasElement=t}getContext(t,e=void 0){let i=this.canvasElement?.getContext(t,e);return i&&"2d"===t&&(i.imageSmoothingEnabled=!1),i}}function c(t,e){if(Object.prototype.hasOwnProperty.call(t,e)){let i=t[e];delete t[e],t[e]=i}}d.define("flex-canvas"),t.FlexCanvas=d}));
//# sourceMappingURL=index.js.map
