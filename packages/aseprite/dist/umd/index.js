!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Milque={})}(this,(function(e){"use strict";class t{constructor(e,t=0,n=e.byteLength,r=!0){this.buffer=e,this.view=new DataView(e,t,n),this.littleEndian=r,this.offset=0}skipBytes(e){this.offset+=e}nextByte(){let e=this.view.getUint8(this.offset);return this.offset+=1,e}nextWord(){let e=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}nextShort(){let e=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}nextDoubleWord(){let e=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}nextLong(){let e=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}nextDoubleLong(){let e=this.view.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}nextQuadWord(){let e=this.view.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}nextFixed(){const e=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}nextFloat(){const e=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}nextDouble(){const e=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}nextBytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}remainingBytes(){let e=this.view.byteLength-this.offset;return this.nextBytes(e)}}function n(e,t,n,r=255){return(255&r)<<24|(255&e)<<16|(255&t)<<8|255&n}function r(e,t,r,o=1){return n(Math.floor(255*Math.max(Math.min(e,1),0)),Math.floor(255*Math.max(Math.min(t,1),0)),Math.floor(255*Math.max(Math.min(r,1),0)),Math.floor(255*Math.max(Math.min(o,1),0)))}function o(e){return e>>16&255}function i(e){return(e>>16&255)/255}function s(e){return e>>8&255}function u(e){return(e>>8&255)/255}function l(e){return 255&e}function a(e){return(255&e)/255}function c(e){let t=e>>24&255;return 0===t?255:t}function d(e){return c(e)/255}var x=Object.freeze({__proto__:null,alpha:c,alphaf:d,blue:l,bluef:a,create:function(){return 0},fromBytes:n,fromFloats:r,green:s,greenf:u,mix:function(e=0,t=16777215,n=.5){const o=i(e),s=u(e),l=a(e),c=d(e),x=(i(t)-o)*n+o,f=(u(t)-s)*n+s,h=(a(t)-l)*n+l;let p=(d(t)-c)*n+c;return p<.01&&(p=void 0),r(x,f,h,p)},red:o,redf:i,toCSSColorString:function(e){if("number"!=typeof e)throw new Error("Not a valid number for hex color value.");return`#${o(e).toString(16).padStart(2,"0")}${s(e).toString(16).padStart(2,"0")}${l(e).toString(16).padStart(2,"0")}`},toFloatVector:function(e){if("number"!=typeof e)throw new Error("Not a valid number for hex color value.");return[i(e),u(e),a(e),d(e)]}});function f(e,t=255){return(255&t)<<8|255&e}function h(e,t=1){return f(Math.floor(255*Math.max(Math.min(e,1),0)),Math.floor(255*Math.max(Math.min(t,1),0)))}function p(e){return 255&e}function E(e){return(255&e)/255}function y(e){let t=e>>8&255;return 0===t?255:t}function A(e){return y(e)/255}var D=Object.freeze({__proto__:null,alpha:y,alphaf:A,create:function(){return 0},fromBytes:f,fromFloats:h,gray:p,grayf:E,mix:function(e=0,t=65535,n=.5){const r=E(e),o=A(e),i=(E(t)-r)*n+r;let s=(A(t)-o)*n+o;return s<.01&&(s=void 0),h(i,s)},toCSSColorString:function(e){if("number"!=typeof e)throw new Error("Not a valid number for hex color value.");let t=p(e).toString(16).padStart(2,"0");return`#${t}${t}${t}`},toFloatVector:function(e){if("number"!=typeof e)throw new Error("Not a valid number for hex color value.");return[E(e),A(e)]}});function W(e,t){const n=e.nextWord(),r=e.nextBytes(n);return t.decode(r)}function m(e,t){let n=[];const r=e.nextDoubleWord(),o=e.nextDoubleWord(),i=e.nextDoubleWord();e.skipBytes(8);for(let o=0;o<r;++o){const r=e.nextWord(),o=e.nextByte(),i=e.nextByte(),s=e.nextByte(),u=e.nextByte();let l;1===r&&(l=W(e,t));let a=g(o,i,s,u,l);n.push(a)}return{paletteSize:r,firstColor:o,lastColor:i,colors:n}}function g(e,t,n,r,o="none"){return{name:o,value:x.fromBytes(e,t,n,r)}}function B(e,t){const n=e.nextWord(),r=e.nextWord(),o=e.nextWord();e.nextWord(),e.nextWord();const i=e.nextWord(),s=e.nextByte();e.skipBytes(3);const u=W(e,t);let l=0;return 2===r&&(l=e.nextDoubleWord()),{flags:n,layerType:r,childLevel:o,blendMode:i,opacity:s,layerName:u,tilesetIndex:l}}const L={RGBA:1,GRAYSCALE:2,INDEXED:3};function T(e){switch(e){case L.RGBA:return 4;case L.GRAYSCALE:return 2;case L.INDEXED:return 1;default:throw new Error(`Unsupported image pixel format "${e}".`)}}function b(e){if(32===e)return L.RGBA;if(16===e)return L.GRAYSCALE;if(8===e)return L.INDEXED;throw new Error(`Unsupported color depth "${e}" for image pixel format.`)}const S={RAW_IMAGE_DATA:0,LINKED_CEL:1,COMPRESSED_IMAGE:2,COMPRESSED_TILEMAP:3};function I(e,t){const n=e.nextWord(),r=e.nextShort(),o=e.nextShort(),i=e.nextByte(),s=e.nextWord(),u=e.nextShort();let l;switch(e.skipBytes(5),s){case S.RAW_IMAGE_DATA:l=function(e,t){const n=e.nextWord(),r=e.nextWord(),o=n*r,i=T(t),s=i*o,u=e.nextBytes(s);return{width:n,height:r,length:o,pixelFormat:t,pixelData:u}}(e,t);break;case S.LINKED_CEL:l=function(e){const t=e.nextWord();return{linkedFrame:t}}(e);break;case S.COMPRESSED_IMAGE:l=function(e){const t=e.nextWord(),n=e.nextWord(),r=e.remainingBytes();return{width:t,height:n,compressedPixels:r}}(e);break;case S.COMPRESSED_TILEMAP:l=function(e){const t=e.nextWord(),n=e.nextWord(),r=e.nextWord(),o=e.nextDoubleWord(),i=e.nextDoubleWord(),s=e.nextDoubleWord(),u=e.nextDoubleWord();e.skipBytes(10);const l=e.remainingBytes();return{width:t,height:n,bitsPerTile:r,bitmaskForTileId:o,bitmaskForFlipX:i,bitmaskForFlipY:s,bitmaskForDiagonalFlip:u,compressedTiles:l}}(e);break;default:throw new Error(`Unsupported cel type "${s}".`)}return{layerIndex:n,posX:r,posY:o,opacityLevel:i,celType:s,zIndex:u,celData:l}}function C(e){const t=e.nextDoubleWord(),n=e.nextFixed(),r=e.nextFixed(),o=e.nextFixed(),i=e.nextFixed();return e.skipBytes(16),{flags:t,posX:n,posY:r,celWidth:o,celHeight:i}}const R={NONE:0,SRGB:1,ICC:2};function w(e){const t=e.nextWord(),n=e.nextWord(),r=e.nextFixed();e.skipBytes(8);let o=null;if(t===R.ICC){const t=e.nextDoubleWord();o=e.nextBytes(t)}return{profileType:t,flags:n,fixedGamma:r,iccProfile:o}}function k(e,t){let n=[];const r=e.nextDoubleWord();e.skipBytes(8);for(let o=0;o<r;++o){const r=e.nextDoubleWord(),o=e.nextByte();e.skipBytes(7);const i=W(e,t);n.push(_(r,o,i))}return{entries:n}}function _(e,t,n){return{entryId:e,entryType:t,extensionId:n}}function F(e,t){let n=[];const r=e.nextWord();e.skipBytes(8);for(let o=0;o<r;++o){const r=e.nextWord(),o=e.nextWord(),i=e.nextByte(),s=e.nextWord();e.skipBytes(6),e.skipBytes(3),e.skipBytes(1);const u=W(e,t);n.push(N(r,o,i,s,u))}return{tags:n}}function N(e,t,n,r,o){return{fromFrame:e,toFrame:t,direction:n,nTimes:r,tagName:o}}const P=1,M=2,O=4,v=1,G=2,X=3,U=4,Y=5,H=6,z=7,$=8,K=9,V=10,j=11,Q=12,q=13,J=14,Z=15,ee=16,te=19;function ne(e,t){const n=e.nextDoubleWord();let r=null;n&P&&(r=W(e,t));let o=null;if(n&M){const t=e.nextByte(),n=e.nextByte(),r=e.nextByte(),i=e.nextByte();o=x.fromBytes(t,n,r,i)}let i=null;if(n&O){let n=[];const r=e.nextDoubleWord(),o=e.nextDoubleWord();for(let r=0;r<o;++r){const r=e.nextDoubleWord(),o=e.nextDoubleWord();let i={};for(let n=0;n<o;++n){const n=W(e,t),r=e.nextWord(),o=re(e,r,t);i[n]=o}n.push({mapKey:r,values:i})}i={mapSize:r,maps:n}}return{text:r,color:o,props:i}}function re(e,t,n){switch(t){case v:return 0!==e.nextByte();case G:case X:return e.nextByte();case U:return e.nextShort();case Y:return e.nextWord();case H:return e.nextLong();case z:return e.nextDoubleWord();case $:return e.nextDoubleLong();case K:return e.nextQuadWord();case V:return e.nextFixed();case j:return e.nextFloat();case Q:return e.nextDouble();case q:return W(e,n);case J:return{coordX:e.nextLong(),coordY:e.nextLong()};case Z:return{width:e.nextLong(),height:e.nextLong()};case ee:return{originX:e.nextLong(),originY:e.nextLong(),width:e.nextLong(),height:e.nextLong()};case te:{const t=e.nextBytes(16);return n.decode(t)}default:throw new Error(`Unsupported value type "${t}" for user data property.`)}}const oe=1,ie=2;function se(e,t){const n=e.nextDoubleWord(),r=e.nextDoubleWord();e.nextDoubleWord();const o=W(e,t);let i=[];for(let t=0;t<n;++t){const t=e.nextDoubleWord(),n=e.nextLong(),o=e.nextLong(),s=e.nextDoubleWord(),u=e.nextDoubleWord();let l=null;if(r&oe){l={centerX:e.nextLong(),centerY:e.nextLong(),centerWidth:e.nextDoubleWord(),centerHeight:e.nextDoubleWord()}}let a=null;if(r&ie){a={pivotX:e.nextLong(),pivotY:e.nextLong()}}i.push(ue(t,n,o,s,u,l,a))}return{name:o,keys:i}}function ue(e,t,n,r,o,i=null,s=null){return{frameNumber:e,originX:t,originY:n,sliceWidth:r,sliceHeight:o,ninePatch:i,pivot:s}}const le=1,ae=2;function ce(e,t){const n=e.nextDoubleWord(),r=e.nextDoubleWord(),o=e.nextDoubleWord(),i=e.nextWord(),s=e.nextWord(),u=e.nextShort();e.skipBytes(14);const l=W(e,t);let a=null;if(r&le){a={entryId:e.nextDoubleWord(),externalTilesetId:e.nextDoubleWord()}}let c=null;if(r&ae){const t=e.nextDoubleWord();c={compressedPixels:e.nextBytes(t)}}return{tilesetId:n,numTiles:o,tileWidth:i,tileHeight:s,baseIndex:u,name:l,externalTileset:a,includedTileset:c}}const de={PALETTE_0004:4,PALETTE_0011:17,LAYER:8196,CEL:8197,CEL_EXTRA:8198,COLOR_PROFILE:8199,EXTERNAL_FILE:8200,MASK:8214,PATH:8215,TAGS:8216,PALETTE:8217,USER_DATA:8224,SLICE:8226,TILESET:8227};function xe(e,n,r){const o=new t(n);switch(e){case de.PALETTE_0004:case de.PALETTE_0011:return null;case de.LAYER:return B(o,new TextDecoder);case de.CEL:return I(o,r);case de.CEL_EXTRA:return C(o);case de.COLOR_PROFILE:return w(o);case de.EXTERNAL_FILE:return k(o,new TextDecoder);case de.MASK:case de.PATH:return null;case de.TAGS:return F(o,new TextDecoder);case de.PALETTE:return m(o,new TextDecoder);case de.USER_DATA:return ne(o,new TextDecoder);case de.SLICE:return se(o,new TextDecoder);case de.TILESET:return ce(o,new TextDecoder)}}function fe(e){const t=he(e);let n=[];for(let r=0;r<t.frames;++r){const r=pe(e);let o=[];for(let n=0;n<r.chunks;++n){const n=Ee(e);let r=xe(n.chunkType,n.chunkData,b(t.colorDepth));o.push({chunkHeader:{chunkType:n.chunkType,chunkSize:n.chunkSize},...r})}n.push({frameHeader:r,chunks:o})}return{header:t,frames:n}}function he(e){const t=e.nextDoubleWord();if(42464!==e.nextWord())throw new Error("Invalid Aseprite header byte format.");const n=e.nextWord(),r=e.nextWord(),o=e.nextWord(),i=e.nextWord();e.nextDoubleWord(),e.nextWord(),e.nextDoubleWord(),e.nextDoubleWord();const s=e.nextByte();e.skipBytes(3);const u=e.nextWord(),l=e.nextByte(),a=e.nextByte(),c=e.nextShort(),d=e.nextShort(),x=e.nextWord(),f=e.nextWord();return e.skipBytes(84),{fileSize:t,frames:n,width:r,height:o,colorDepth:i,paletteIndex:s,numColors:u,pixelWidth:l,pixelHeight:a,gridX:c,gridY:d,gridWidth:x,gridHeight:f}}function pe(e){const t=e.nextDoubleWord();if(61946!==e.nextWord())throw new Error("Invalid Aseprite frame header byte format.");const n=e.nextWord(),r=e.nextWord();e.skipBytes(2);const o=e.nextDoubleWord();return{frameSize:t,frameDuration:r,chunks:o>0?o:n}}function Ee(e){const t=e.nextDoubleWord(),n=e.nextWord(),r=t-6;if(r<0)throw new Error("Invalid Aseprite chunk size - must be at least 6 bytes (to include chunk size and type info).");return{chunkSize:t,chunkType:n,chunkData:e.nextBytes(r)}}class ye{static fromArrayBuffer(e){const n=fe(new t(e));return new ye(n.header.fileSize,n.header.width,n.header.height,n.header.colorDepth,`${n.header.pixelWidth}:${n.header.pixelHeight}`,n)}constructor(e,t,n,r,o,i){this.fileSize=e,this.fileData=i,this.frames=[],this.layers=[],this.slices=[],this.tags=[],this.tilesets=[],this.width=t,this.height=n,this.colorDepth=r,this.pixelRatio=o,this.pixelFormat=b(this.colorDepth)}}e.Aseprite=ye,e.AsepriteAnimationDirections={FORWARD:0,REVERSE:1,PING_PONG:2,PING_PONG_REVERSE:3},e.AsepriteBlendModes={NORMAL:0,MULTIPLY:1,SCREEN:2,OVERLAY:3,DARKEN:4,LIGHTEN:5,COLOR_DODGE:6,COLOR_BURN:7,HARD_LIGHT:8,SOFT_LIGHT:9,DIFFERENCE:10,EXCLUSION:11,HUE:12,SATURATION:13,COLOR:14,LUMINOSITY:15,ADDITION:16,SUBTRACT:17,DIVIDE:18},e.AsepriteCelTypes=S,e.AsepriteChunkTypes=de,e.AsepriteColorProfiles=R,e.AsepriteExternalFileEntryTypes={EXTERNAL_PALETTE:0,EXTERNAL_TILESET:1,PROPERTIES_EXTENSION_NAME:2,TILE_MANAGER_EXTENSION_NAME:3},e.AsepriteLayerFlags={VISIBLE:1,EDITABLE:2,LOCK_MOVEMENT:4,BACKGROUND:8,PREFER_LINKED_CELS:16,COLLAPSED_LAYER_GROUP:32,IS_REFERENCE_LAYER:64},e.AsepritePixelFormats=L,e.ByteReader=t,e.countPixelFormatBytesPerPixel=T,e.getPixelFormatFromColorDepth=b,e.parseAsepriteChunk=xe,e.readAsepriteChunkBytes=Ee,e.readAsepriteChunkCel=I,e.readAsepriteChunkCelExtra=C,e.readAsepriteChunkColorProfile=w,e.readAsepriteChunkExternalFiles=k,e.readAsepriteChunkLayer=B,e.readAsepriteChunkPalette=m,e.readAsepriteChunkSlice=se,e.readAsepriteChunkTags=F,e.readAsepriteChunkTileset=ce,e.readAsepriteChunkUserData=ne,e.readAsepriteFileBytes=fe,e.readAsepriteFrameHeaderBytes=pe,e.readAsepriteGrayscalePixelBytes=function(e){const t=e.nextByte(),n=e.nextByte();return D.fromBytes(t,n)},e.readAsepriteHeaderBytes=he,e.readAsepriteIndexedPixelBytes=function(e){return e.nextByte()},e.readAsepriteRGBAPixelBytes=function(e){const t=e.nextByte(),n=e.nextByte(),r=e.nextByte(),o=e.nextByte();return x.fromBytes(t,n,r,o)},e.readAsepriteStringBytes=W}));
//# sourceMappingURL=index.js.map
