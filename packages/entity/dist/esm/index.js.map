{"version":3,"file":"index.js","sources":["../../src/component/ComponentFactory.js","../../src/local/ComponentInstanceMap.js","../../src/local/EntityId.js","../../src/match/MatchFilter.js","../../src/match/MatchFinder.js","../../src/local/LocalEntityPool.js","../../src/EntityManager.js"],"sourcesContent":["/**\n * @template T\n * @param {string} name\n * @param {() => T} newCallback \n * @param {(instance: T) => void} deleteCallback\n * @returns {import('./ComponentTypes').ComponentFactory<T>}\n */\nexport function create(name, newCallback, deleteCallback) {\n  return {\n    name,\n    new: newCallback,\n    delete: deleteCallback,\n  };\n}\n\n/**\n * @template T\n * @param {import('./ComponentTypes').ComponentClass<T>} componentClass \n */\nexport function newComponentInstance(componentClass) {\n  if ('new' in componentClass) {\n    return componentClass.new();\n  } else {\n    return new componentClass();\n  }\n}\n\n/**\n * @template T\n * @param {import('./ComponentTypes').ComponentClass<T>} componentClass \n * @param {T} instance \n */\nexport function deleteComponentInstance(componentClass, instance) {\n  if ('delete' in componentClass && typeof componentClass.delete === 'function') {\n    componentClass.delete(instance);\n  }\n}\n\n/**\n * @param {import('./ComponentTypes').ComponentClass<any>} componentClass \n * @param {import('./ComponentTypes').ComponentClass<any>} otherClass\n */\nexport function isSameComponentClass(componentClass, otherClass) {\n  return componentClass\n    && otherClass\n    && 'name' in componentClass\n    && 'name' in otherClass\n    && componentClass.name === otherClass.name;\n}\n","import { deleteComponentInstance, newComponentInstance } from '../component/ComponentFactory';\n\n/** @type {import('./EntityId').EntityId} */\nexport const MIN_ENTITY_ID = 1;\n/** @type {import('./EntityId').EntityId} */\nexport const MAX_ENTITY_ID = 4_294_967_295;\n\n/**\n * A sparse map of entityId-to-component instances (for a component class).\n *\n * @see https://skypjack.github.io/2019-03-07-ecs-baf-part-2/\n * @template T\n */\nexport class ComponentInstanceMap {\n  /**\n   * @param {import('../component').ComponentClass<T>} componentClass\n   * @param {number} [initialCapacity]\n   * @param {number} [maxCapacity]\n   */\n  constructor(componentClass, initialCapacity = 16, maxCapacity = 10_000) {\n    /**\n     * @readonly\n     * @type {import('../component').ComponentClass<T>}\n     */\n    this.componentClass = componentClass;\n\n    if (maxCapacity <= 0) {\n      throw new Error(\n        `Max capacity must be positive, but was \"${maxCapacity}\".`\n      );\n    }\n    if (initialCapacity > maxCapacity) {\n      throw new Error(`Cannot initialize capacity over max \"${maxCapacity}\".`);\n    }\n\n    const SparseTypedArray = typeOfUnsignedTypedArrayByMaxValue(maxCapacity);\n    const sparseBuffer = new ArrayBuffer(initialCapacity, {\n      maxByteLength: SparseTypedArray.BYTES_PER_ELEMENT * MAX_ENTITY_ID,\n    });\n    /**\n     * The sparse array of entityId-to-index\n     *\n     * @private\n     */\n    this.sparse = new SparseTypedArray(sparseBuffer);\n\n    const EntityIdTypedArray =\n      typeOfUnsignedTypedArrayByMaxValue(MAX_ENTITY_ID);\n    const entityIdBuffer = new ArrayBuffer(initialCapacity, {\n      maxByteLength: EntityIdTypedArray.BYTES_PER_ELEMENT * maxCapacity,\n    });\n    /**\n     * The dense array of index-to-entityId\n     * @private\n     */\n    this.entityIds = new EntityIdTypedArray(entityIdBuffer);\n    /** @private */\n    this.entityIdArrayType = EntityIdTypedArray;\n\n    /**\n     * The dense array of instance objects by index\n     *\n     * @private\n     * @type {Array<T>}\n     */\n    this.instances = new Array();\n\n    this.size = 0;\n\n    /** @readonly */\n    this.maxCapacity = maxCapacity;\n  }\n\n  get capacity() {\n    return Math.trunc(\n      this.entityIds.buffer.byteLength /\n        this.entityIdArrayType.BYTES_PER_ELEMENT\n    );\n  }\n\n  /**\n   * @param {number} newIndex\n   * @param {import('./EntityId').EntityId} newEntityId\n   */\n  ensureCapacity(newIndex, newEntityId) {\n    if (newEntityId >= this.sparse.length) {\n      const nearestByteLength = Math.pow(2, Math.ceil(Math.log2(newEntityId + 1)));\n      const currentByteLength = this.sparse.byteLength;\n      const byteLength = Math.min(\n        this.sparse.buffer.maxByteLength,\n        Math.max(this.sparse.BYTES_PER_ELEMENT, Math.max(currentByteLength * 2, nearestByteLength))\n      );\n      this.sparse.buffer.resize(byteLength);\n    }\n    const newSize = Math.max(this.size, newIndex + 1);\n    if (newSize > this.maxCapacity) {\n      throw new Error(\n        `Exceeded max capacity - cannot insert more objects than \"${this.maxCapacity}\".`\n      );\n    }\n    if (newSize > this.instances.length) {\n      this.size = newSize;\n      this.instances.length = newSize;\n    }\n    if (newSize >= this.entityIds.length) {\n      const nearestByteLength = Math.pow(2, Math.ceil(Math.log2(newSize)));\n      const currentByteLength = this.entityIds.byteLength;\n      const byteLength = Math.min(\n        this.entityIds.buffer.maxByteLength,\n        Math.max(this.entityIds.BYTES_PER_ELEMENT, Math.max(currentByteLength * 2, nearestByteLength))\n      );\n      this.entityIds.buffer.resize(byteLength);\n    }\n  }\n\n  /**\n   * @param {number} entityId\n   * @param {T} [instance]\n   */\n  insert(entityId, instance = undefined) {\n    if (typeof instance === 'undefined') {\n      instance = newComponentInstance(this.componentClass);\n    }\n    const prev = this.sparse[entityId];\n    if (prev >= 0 && this.entityIds[prev] === entityId) {\n      // This entity is already in this set, so just replace the instance.\n      this.instances[prev] = instance;\n      return instance;\n    }\n    // ...increase by 1 size...\n    const index = this.size;\n    this.ensureCapacity(index, entityId);\n    // ...and insert it at the end...\n    this.sparse[entityId] = index;\n    this.instances[index] = instance;\n    this.entityIds[index] = entityId;\n    return instance;\n  }\n\n  /**\n   * @param {number} entityId\n   */\n  delete(entityId) {\n    if (this.size <= 0) {\n      // Cannot delete from empty.\n      return false;\n    }\n    const prev = this.sparse[entityId];\n    if (!(prev >= 0 && this.entityIds[prev] === entityId)) {\n      // This entity is NOT in this set. Skip it.\n      return false;\n    }\n    let prevInstance = this.instances[prev];\n    this.sparse[entityId] = 0;\n    deleteComponentInstance(this.componentClass, prevInstance);\n    if (this.size > 1) {\n      const end = this.size - 1;\n      const endInstance = this.instances[end];\n      const endEntityId = this.entityIds[end];\n      // ...move last object to replace deleted entity...\n      this.sparse[endEntityId] = prev;\n      this.instances[prev] = endInstance;\n      this.entityIds[prev] = endEntityId;\n    }\n    // ...reduce by 1 size.\n    this.size -= 1;\n    this.instances.length = this.size;\n    return true;\n  }\n\n  clear() {\n    let result = Array.from(this.entityIds);\n    for(let entityId of result) {\n      this.delete(entityId);\n    }\n  }\n\n  /**\n   * Assumes the entity id exists in this map, otherwise you must check has() before this call.\n   * \n   * @param {number} entityId\n   */\n  lookup(entityId) {\n    return this.instances[this.sparse[entityId]];\n  }\n\n  /**\n   * @param {T} instance \n   * @returns {import('./EntityId').EntityId}\n   */\n  keyOf(instance) {\n    return this.entityIds[this.instances.indexOf(instance)];\n  }\n\n  /**\n   * @param {number} entityId\n   */\n  has(entityId) {\n    return this.entityIds[this.sparse[entityId]] === entityId;\n  }\n\n  /** @returns {Iterable<import('./EntityId').EntityId> & ArrayLike<import('./EntityId').EntityId>} Iterable of entity ids */\n  keys() {\n    return this.createEntityIdBufferView();\n  }\n\n  /** @returns {Iterable<T> & ArrayLike<T>} Iterable of component instances */\n  values() {\n    return this.instances;\n  }\n\n  /** @private */\n  createEntityIdBufferView() {\n    const TypedArray = this.entityIdArrayType;\n    return new TypedArray(this.entityIds.buffer, 0, this.size);\n  }\n}\n\n/**\n * @param {number} maxValue\n */\nfunction typeOfUnsignedTypedArrayByMaxValue(maxValue) {\n  if (maxValue <= 256) {\n    return Uint8Array;\n  } else if (maxValue <= 65_536) {\n    return Uint16Array;\n  } else if (maxValue <= 4_294_967_296) {\n    return Uint32Array;\n  } else {\n    throw new Error(\n      `Max value is too big - no typed uint array big enough for value \"${maxValue}\".`\n    );\n  }\n}\n","\n/** @typedef {number} EntityId */\n\n/**\n * Used to match for entity id in query result.\n * \n * @param {number} [value]\n */\nexport function EntityId(value) {\n  return /** @type {EntityId} */ (Math.trunc(Number(value ?? 0)));\n}\n\nEntityId.NONE = EntityId(0);\n","/**\n * @template {import('./MatchTypes').MatchClass<any>[]} Components\n * @typedef {MatchFilter<'SomeOf', Components, InstanceType<Components[number]> | null>} MatchFilterSomeOf\n */\n\n/**\n * @template {import('./MatchTypes').MatchClass<any>[]} Components\n * @typedef {MatchFilter<'NoneOf', Components, null>} MatchFilterNoneOf\n */\n\n/**\n * @template {'SomeOf'|'NoneOf'} Name\n * @template {import('./MatchTypes').MatchClass<any>[]} Components\n * @template OutputType\n */\nexport class MatchFilter {\n\n  /**\n   * Match some or none of the matching components.\n   * \n   * @template {import('./MatchTypes').MatchClass<any>[]} T\n   * @param {T} componentClasses \n   * @returns {MatchFilterSomeOf<T>}\n   */\n  static SomeOf(...componentClasses) {\n    return new MatchFilter('SomeOf', componentClasses, /** @type {InstanceType<T[number]> | null} */ (null));\n  }\n\n  /**\n   * Match none of the matching components.\n   * \n   * @template {import('./MatchTypes').MatchClass<any>[]} T\n   * @param {T} componentClasses \n   * @returns {MatchFilterNoneOf<T>}\n   */\n  static NoneOf(...componentClasses) {\n    return new MatchFilter('NoneOf', componentClasses, null);\n  }\n\n  /** @readonly */\n  name;\n  /** @readonly */\n  keys;\n  /** @readonly */\n  output;\n\n  /**\n   * @param {Name} name \n   * @param {Components} keys\n   * @param {OutputType} output\n   */\n  constructor(name, keys, output) {\n    this.name = name;\n    this.keys = keys;\n    this.output = output;\n  }\n}\n","import { EntityId } from '../local/EntityId';\nimport { MatchFilter } from './MatchFilter';\n\n/**\n * @template {import('./MatchTypes').MatchTemplate} T\n * @param {import('../local').EntityPoolLike} entityPool\n * @param {T} selector\n * @param {EntityId} [entityId]\n * @returns {import('./MatchTypes').MatchResult<T>|null}\n */\nexport function find(entityPool, selector, entityId = undefined) {\n  const allKeys = Object.keys(selector);\n  if (allKeys.length <= 0) {\n    return null;\n  }\n  const allEntries = Object.entries(selector);\n  const allValues = Object.values(selector);\n  if (typeof entityId === 'undefined') {\n    const smallest = findSmallestComponentClassByMapSize(\n      entityPool,\n      allValues\n    );\n    if (!smallest) {\n      return null;\n    }\n    entityId = entityPool.components[smallest.name]?.keys()[0];\n  }\n  /** @type {any} */\n  let result = {};\n  // Prepare this early...\n  for(let key of allKeys) {\n    result[key] = null;\n  }\n  forComponents:\n  for (let [key, componentClass] of allEntries) {\n    const componentName = componentClass.name;\n    switch(componentName) {\n      case EntityId.name:\n        result[key] = entityId;\n        // This is processed now. Next component...\n        continue forComponents;\n      case MatchFilter.NoneOf.name:\n        for (let matchedKey of /** @type {import('./MatchFilter').MatchFilterNoneOf<import('../component').ComponentClass<unknown>[]>} */ (componentClass).keys) {\n          const matchedName = matchedKey.name;\n          const instanceMap = entityPool.components[matchedName];\n          if (instanceMap.has(entityId)) {\n            // This is a none matcher! Exclude this entity...\n            return null;\n          }\n        }\n        break;\n      case MatchFilter.SomeOf.name:\n        for (let matchedKey of /** @type {import('./MatchFilter').MatchFilterSomeOf<import('../component').ComponentClass<unknown>[]>} */ (componentClass).keys) {\n          const matchedName = matchedKey.name;\n          const instanceMap = entityPool.components[matchedName];\n          if (instanceMap.has(entityId)) {\n            // This is an optional matcher and we found something! Next required component...\n            result[key] = instanceMap.lookup(entityId);\n            continue forComponents;\n          }\n        }\n        // ...or we did not find anything, but okay since optional. Next component...\n        result[key] = null;\n        break;\n      default:\n        const instanceMap = entityPool.components[componentName];\n        if (!instanceMap.has(entityId)) {\n          // This is not a matching entity :( Skip this entity...\n          return null;\n        }\n        result[key] = instanceMap.lookup(entityId);\n    }\n  }\n  return asMatchResult(result);\n}\n\n/**\n * @template T\n * @param {import('../local').EntityPoolLike} entityPool\n * @param {import('../component').ComponentClass<T>} componentClass\n * @param {EntityId} [entityId]\n * @returns {T|null}\n */\nexport function findOne(entityPool, componentClass, entityId = undefined) {\n  const map = entityPool.components[componentClass.name];\n  if (!map) {\n    return null;\n  }\n  const keys = map.keys();\n  if (keys.length <= 0) {\n    return null;\n  }\n  if (typeof entityId === 'undefined') {\n    entityId = keys[0];\n  }\n  return map.lookup(entityId);\n}\n\n/**\n * @template {import('./MatchTypes').MatchTemplate} T\n * @param {import('../local').EntityPoolLike} entityPool\n * @param {T} selector\n * @returns {Generator<import('./MatchTypes').MatchResult<T>>}\n */\nexport function* findAll(entityPool, selector) {\n  const templateKeys = Object.keys(selector);\n  if (templateKeys.length <= 0) {\n    return;\n  }\n  const templateEntries = Object.entries(selector);\n  const templateValues = Object.values(selector);\n  const smallest = findSmallestComponentClassByMapSize(\n    entityPool,\n    templateValues\n  );\n  if (!smallest) {\n    return;\n  }\n  /** @type {any} */\n  let result = {};\n  // Prepare this early...\n  for(let key of templateKeys) {\n    result[key] = null;\n  }\n  forEntityIds:\n  for (let entityId of entityPool.components[smallest.name]?.keys()) {\n    forComponents:\n    for (let [key, componentClass] of templateEntries) {\n      const componentName = componentClass.name;\n      switch(componentName) {\n        case EntityId.name:\n          result[key] = entityId;\n          // This is processed now. Next component...\n          continue forComponents;\n        case MatchFilter.NoneOf.name:\n          for (let matchedKey of /** @type {import('./MatchFilter').MatchFilterNoneOf<import('../component').ComponentClass<unknown>[]>} */ (componentClass).keys) {\n            const matchedName = matchedKey.name;\n            const instanceMap = entityPool.components[matchedName];\n            if (instanceMap.has(entityId)) {\n              // This is a none matcher! Exclude this entity...\n              continue forEntityIds;\n            }\n          }\n          break;\n        case MatchFilter.SomeOf.name:\n          for (let matchedKey of /** @type {import('./MatchFilter').MatchFilterSomeOf<import('../component').ComponentClass<unknown>[]>} */ (componentClass).keys) {\n            const matchedName = matchedKey.name;\n            const instanceMap = entityPool.components[matchedName];\n            if (instanceMap.has(entityId)) {\n              // This is an optional matcher and we found something! Next required component...\n              result[key] = instanceMap.lookup(entityId);\n              continue forComponents;\n            }\n          }\n          // ...or we did not find anything, but okay since optional. Next component...\n          result[key] = null;\n          break;\n        default:\n          const instanceMap = entityPool.components[componentName];\n          if (!instanceMap.has(entityId)) {\n            // This is not a matching entity :( Skip this entity...\n            continue forEntityIds;\n          }\n          result[key] = instanceMap.lookup(entityId);\n      }\n    }\n    yield asMatchResult(result);\n  }\n}\n\n/**\n * @param {import('../local').EntityPoolLike} entityPool\n * @param {Array<import('../component').ComponentClass<any>>} componentClasses\n */\nfunction findSmallestComponentClassByMapSize(\n  entityPool,\n  componentClasses\n) {\n  let smallest = null;\n  let smallestSize = Number.POSITIVE_INFINITY;\n  for (let nextClass of componentClasses) {\n    const nextClassName = nextClass.name;\n    if (nextClassName === EntityId.name) {\n      continue;\n    }\n    let instanceMap = entityPool.components[nextClassName];\n    if (!instanceMap) {\n      // NOTE: There's a component class with NO entities. This query will never succeed with results.\n      return null;\n    }\n    let nextSize = instanceMap.size;\n    if (nextSize < smallestSize) {\n      smallest = nextClass;\n      smallestSize = nextSize;\n    }\n  }\n  if (!smallest) {\n    // This was an empty or only-entity-id query. This should not happen since we checked during construction.\n    throw new Error(\n      'Cannot find any non-EntityId component class to match for query.'\n    );\n  }\n  return smallest;\n}\n\n/**\n * @template {import('./MatchTypes').MatchTemplate} T\n * @param {Record<string, any>} out\n * @returns {import('./MatchTypes').MatchResult<T>}\n */\nfunction asMatchResult(out) {\n  return /** @type {import('./MatchTypes').MatchResult<any>} */ (out);\n}\n","import { ComponentInstanceMap } from './ComponentInstanceMap';\nimport { EntityId } from './EntityId';\n\n// This is not usual, but for the api, we will export it here.\nexport * from '../match/MatchFinder';\n\n/** @returns {import('./EntityTypes').EntityPoolLike} */\nexport function createPool() {\n  return {\n    components: {},\n    nextAvailableEntityId: 1,\n    unclaimedEntityIds: [],\n    deadEntityIds: [],\n  };\n}\n\n/**\n * @param {import('./EntityTypes').EntityPoolLike} entityPool\n */\nexport function resetPool(entityPool) {\n  for(let instanceMap of Object.values(entityPool.components)) {\n    instanceMap.clear();\n  }\n  entityPool.nextAvailableEntityId = 1;\n  entityPool.unclaimedEntityIds.length = 0;\n  entityPool.deadEntityIds.length = 0;\n}\n\n/**\n * @param {import('./EntityTypes').EntityPoolLike} entityPool\n * @returns {import('./EntityId').EntityId}\n */\nexport function newEntity(entityPool) {\n  let result = entityPool.unclaimedEntityIds.pop();\n  if (typeof result === 'undefined') {\n    result = entityPool.nextAvailableEntityId;\n    entityPool.nextAvailableEntityId += 1;\n  }\n  return result;\n}\n\n/**\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('./EntityId').EntityId} entityId \n */\nexport function deleteEntity(entityPool, entityId) {\n  entityPool.deadEntityIds.push(entityId);\n  for (let instanceMap of Object.values(entityPool.components)) {\n    instanceMap.delete(entityId);\n  }\n  entityPool.deadEntityIds.splice(entityPool.deadEntityIds.indexOf(entityId), 1);\n  entityPool.unclaimedEntityIds.push(entityId);\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('./EntityId').EntityId} entityId\n * @param {import('../component').ComponentClass<T>} componentClass\n * @returns {T}\n */\nexport function attachComponent(entityPool, entityId, componentClass) {\n  if (entityPool.deadEntityIds.includes(entityId)) {\n    // NOTE: This makes sure that when executing clean-up code, we don't re-add anything back in.\n    throw new Error('Cannot attach components to a dead entity.');\n  }\n  if (!(componentClass.name in entityPool.components)) {\n    let result = new ComponentInstanceMap(componentClass);\n    entityPool.components[componentClass.name] = /** @type {any} */ (result);\n  }\n  return entityPool.components[componentClass.name].insert(entityId);\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('./EntityId').EntityId} entityId\n * @param {import('../component').ComponentClass<T>} componentClass\n */\nexport function detachComponent(entityPool, entityId, componentClass) {\n  if (!(componentClass.name in entityPool.components)) {\n    throw new Error(`Cannot detach component - no mapping exists for component class \"${componentClass.name}\".`);\n  }\n  return entityPool.components[componentClass.name].delete(entityId);\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('./EntityId').EntityId} entityId\n * @param {import('../component').ComponentClass<T>} componentClass\n * @returns {T|null}\n */\nexport function lookupComponent(entityPool, entityId, componentClass) {\n  let instanceMap = entityPool.components[componentClass.name];\n  if (!instanceMap?.has(entityId)) {\n    return null;\n  }\n  return instanceMap.lookup(entityId);\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('../component').ComponentClass<T>} componentClass\n * @param {T} componentInstance\n * @returns {import('./EntityId').EntityId}\n */\nexport function lookupEntity(entityPool, componentClass, componentInstance) {\n  let instanceMap = entityPool.components[componentClass.name];\n  return instanceMap.keyOf(componentInstance);\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('../component').ComponentClass<T>} componentClass \n * @returns {Iterable<EntityId> & ArrayLike<EntityId>}\n */\nexport function keysOf(entityPool, componentClass) {\n  return entityPool.components[componentClass.name]?.keys() ?? [];\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('../component').ComponentClass<T>} componentClass \n * @returns {Iterable<T> & ArrayLike<T>}\n */\nexport function instancesOf(entityPool, componentClass) {\n  return entityPool.components[componentClass.name]?.values() ?? [];\n}\n\n/**\n * @template T\n * @param {import('./EntityTypes').EntityPoolLike} entityPool \n * @param {import('../component').ComponentClass<T>} componentClass \n * @returns {number}\n */\nexport function countComponents(entityPool, componentClass) {\n  return entityPool.components[componentClass.name]?.values().length ?? 0;\n}\n","import { EntityId, LocalEntityPool } from './local';\n\nexport class EntityManager {\n\n  /** @type {import('./local').EntityPoolLike['components']} */\n  components = {};\n  /** @type {import('./local').EntityPoolLike['nextAvailableEntityId']} */\n  nextAvailableEntityId = 1;\n  /** @type {import('./local').EntityPoolLike['unclaimedEntityIds']} */\n  unclaimedEntityIds = [];\n  /** @type {import('./local').EntityPoolLike['deadEntityIds']} */\n  deadEntityIds = [];\n\n  newEntity() {\n    return LocalEntityPool.newEntity(this);\n  }\n\n  /**\n   * @param {EntityId} entityId\n   */\n  deleteEntity(entityId) {\n    LocalEntityPool.deleteEntity(this, entityId);\n  }\n\n  /**\n   * @template T\n   * @param {EntityId} entityId \n   * @param {import('./component').ComponentClass<T>} componentClass \n   */\n  attachComponent(entityId, componentClass) {\n    return LocalEntityPool.attachComponent(this, entityId, componentClass);\n  }\n\n  /**\n   * @template T\n   * @param {EntityId} entityId \n   * @param {import('./component').ComponentClass<T>} componentClass \n   */\n  detachComponent(entityId, componentClass) {\n    return LocalEntityPool.detachComponent(this, entityId, componentClass);\n  }\n\n  /**\n   * @template T\n   * @param {EntityId} entityId \n   * @param {import('./component').ComponentClass<T>} componentClass \n   */\n  lookupComponent(entityId, componentClass) {\n    return LocalEntityPool.lookupComponent(this, entityId, componentClass);\n  }\n\n  /**\n   * @template T\n   * @param {import('./component').ComponentClass<T>} componetClass \n   * @param {T} instance \n   */\n  lookupEntity(componetClass, instance) {\n    return LocalEntityPool.lookupEntity(this, componetClass, instance);\n  }\n\n  /**\n   * @template T\n   * @param {import('./component').ComponentClass<T>} componentClass \n   */\n  countComponents(componentClass) {\n    return LocalEntityPool.countComponents(this, componentClass);\n  }\n\n  /**\n   * @template T\n   * @param {import('./component').ComponentClass<T>} componentClass\n   */\n  keysOf(componentClass) {\n    return LocalEntityPool.keysOf(this, componentClass);\n  }\n\n  /**\n   * @template T\n   * @param {import('./component').ComponentClass<T>} componentClass\n   */\n  instancesOf(componentClass) {\n    return LocalEntityPool.instancesOf(this, componentClass);\n  }\n\n  /**\n   * @template {import('./match').MatchTemplate} T\n   * @param {T} selector \n   * @param {EntityId} [entityId]\n   */\n  find(selector, entityId) {\n    return LocalEntityPool.find(this, selector, entityId);\n  }\n\n  /**\n   * @template T\n   * @param {import('./component').ComponentClass<T>} componentClass \n   * @param {EntityId} [entityId]\n   */\n  findOne(componentClass, entityId) {\n    return LocalEntityPool.findOne(this, componentClass, entityId);\n  }\n\n  /**\n   * @template {import('./match').MatchTemplate} T\n   * @param {T} selector \n   */\n  *findAll(selector) {\n    yield* LocalEntityPool.findAll(this, selector);\n  }\n\n  resetPool() {\n    LocalEntityPool.resetPool(this);\n  }\n}\n"],"names":["LocalEntityPool.newEntity","LocalEntityPool.deleteEntity","LocalEntityPool.attachComponent","LocalEntityPool.detachComponent","LocalEntityPool.lookupComponent","LocalEntityPool.lookupEntity","LocalEntityPool.countComponents","LocalEntityPool.keysOf","LocalEntityPool.instancesOf","LocalEntityPool.find","LocalEntityPool.findOne","LocalEntityPool.findAll","LocalEntityPool.resetPool"],"mappings":"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"}