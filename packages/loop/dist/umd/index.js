!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Milque={})}(this,function(e){"use strict";class t extends EventTarget{static now(){return document.timeline.currentTime}prevTime=-1;currentTime=-1;deltaTime=0;accumulatedTime=0;skippedFrames=0;fixedFrames={min:0,max:0};#e=new CustomEvent("frame",{detail:this});#t=new CustomEvent("fixedframe",{detail:this});#i=new CustomEvent("postframe",{detail:this});animationFrameProvider;handle=0;constructor(e={}){super(),this.animationFrameProvider=e?.animationFrameProvider??window,this.currentTimeProvider=e?.currentTimeProvider??t.now,"object"==typeof e?.fixedFrames?(this.fixedFrames.max=Number(e.fixedFrames.max),this.fixedFrames.min=Number(e.fixedFrames.min)):"number"==typeof e?.fixedFrames?this.fixedFrames.max=this.fixedFrames.min=Number(e.fixedFrames):(this.fixedFrames.max=100,this.fixedFrames.min=30),this.next=this.next.bind(this),this.start=this.start.bind(this),this.cancel=this.cancel.bind(this)}get running(){return 0!==this.handle}addEventListener(e,t,i){super.addEventListener(e,t,i)}removeEventListener(e,t,i){super.removeEventListener(e,t,i)}next(e=performance.now()){this.handle=this.animationFrameProvider.requestAnimationFrame(this.next),this.prevTime=this.currentTime,this.currentTime=e,this.deltaTime=this.currentTime-this.prevTime,this.dispatchFrame(),this.dispatchFixedFrames(),e=performance.now(),this.currentTime=e,this.deltaTime=this.currentTime-this.prevTime,this.dispatchPostFrame()}dispatchFrame(){this.dispatchEvent(this.#e)}dispatchPostFrame(){this.dispatchEvent(this.#i)}dispatchFixedFrames(){let e=function(e,t,i,s){let n=e.accumulatedTime+t;const r=1e3/i,a=n-s*r;if(a>0){const t=Math.trunc(a/r);e.skippedFrames=t,n-=t*r}return e.accumulatedTime=n%r,Math.trunc(n/r)}(this,this.deltaTime,this.fixedFrames.min,this.fixedFrames.max);for(e>0&&this.dispatchEvent(this.#t),this.skippedFrames=0;e>1;--e)this.dispatchEvent(this.#t)}start(){return this.handle=this.animationFrameProvider.requestAnimationFrame(this.next),this}cancel(){return this.animationFrameProvider.cancelAnimationFrame(this.handle),this}}e.AnimationFrameLoop=t});
//# sourceMappingURL=index.js.map
